// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/m/Text","sap/m/library","sap/ui/base/ManagedObject","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/Device","sap/ui/thirdparty/jquery","sap/ushell/override","sap/ushell/library","sap/ushell/resources","sap/ushell/ui/launchpad/PlusTile","sap/ushell/utils","sap/ushell/ui/launchpad/TileContainerRenderer"],function(L,T,M,a,C,I,D,q,o,u,r,P,b){"use strict";var H=M.HeaderLevel;var c=C.extend("sap.ushell.ui.launchpad.TileContainer",{metadata:{library:"sap.ushell",properties:{scrollType:{type:"string",group:"Misc",defaultValue:"item"},animationSpeed:{type:"int",group:"Misc",defaultValue:500},groupId:{type:"string",group:"Misc",defaultValue:null},showHeader:{type:"boolean",group:"Misc",defaultValue:true},showPlaceholder:{type:"boolean",group:"Misc",defaultValue:true},defaultGroup:{type:"boolean",group:"Misc",defaultValue:false},isLastGroup:{type:"boolean",group:"Misc",defaultValue:false},headerText:{type:"string",group:"Misc",defaultValue:null},headerLevel:{type:"sap.m.HeaderLevel",group:"Misc",defaultValue:H.H2},groupHeaderLevel:{type:"sap.m.HeaderLevel",group:"Misc",defaultValue:H.H4},showGroupHeader:{type:"boolean",group:"Misc",defaultValue:true},homePageGroupDisplay:{type:"string",defaultValue:null},visible:{type:"boolean",group:"Misc",defaultValue:true},sortable:{type:"boolean",group:"Misc",defaultValue:true},showNoData:{type:"boolean",group:"Misc",defaultValue:false},noDataText:{type:"string",group:"Misc",defaultValue:null},isGroupLocked:{type:"boolean",group:"Misc",defaultValue:null},isGroupSelected:{type:"boolean",group:"Misc",defaultValue:false},editMode:{type:"boolean",group:"Misc",defaultValue:false},showBackground:{type:"boolean",group:"Misc",defaultValue:false},icon:{type:"string",group:"Misc",defaultValue:"sap-icon://locked"},showIcon:{type:"boolean",group:"Misc",defaultValue:false},deluminate:{type:"boolean",group:"Misc",defaultValue:false},showMobileActions:{type:"boolean",group:"Misc",defaultValue:false},enableHelp:{type:"boolean",group:"Misc",defaultValue:false},tileActionModeActive:{type:"boolean",group:"Misc",defaultValue:false},ieHtml5DnD:{type:"boolean",group:"Misc",defaultValue:false},showEmptyLinksArea:{type:"boolean",group:"Misc",defaultValue:false},showEmptyLinksAreaPlaceHolder:{type:"boolean",group:"Misc",defaultValue:false},hidden:{type:"boolean",group:"Misc",defaultValue:false},transformationError:{type:"boolean",group:"Misc",defaultValue:false},supportLinkPersonalization:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{tiles:{type:"sap.ui.core.Control",multiple:true,singularName:"tile"},links:{type:"sap.ui.core.Control",multiple:true,singularName:"link"},beforeContent:{type:"sap.ui.core.Control",multiple:true,singularName:"beforeContent"},afterContent:{type:"sap.ui.core.Control",multiple:true,singularName:"afterContent"},footerContent:{type:"sap.ui.core.Control",multiple:true,singularName:"footerContent"},headerActions:{type:"sap.ui.core.Control",multiple:true,singularName:"headerAction"}},events:{afterRendering:{},add:{},titleChange:{}}}});c.prototype.init=function(){this.bIsFirstTitleChange=true;this._sDefaultValue=r.i18n.getText("new_group_name");this._sOldTitle="";this.oNoLinksText=new T({text:r.i18n.getText("emptyLinkContainerInEditMode")}).addStyleClass("sapUshellNoLinksAreaPresentTextInner");this.oTransformationErrorText=new T({text:r.i18n.getText("transformationErrorText")}).addStyleClass("sapUshellTransformationErrorText");this.oTransformationErrorIcon=new I({src:"sap-icon://message-error"}).addStyleClass("sapUshellTransformationErrorIcon");this.oIcon=new I({src:this.getIcon()});this.oIcon.addStyleClass("sapUshellContainerIcon");this.oPlusTile=new P({groupId:this.getGroupId(),enableHelp:this.getEnableHelp(),press:[this.fireAdd,this]});this.oPlusTile.setParent(this);if(sap.ushell.Container){sap.ushell.Container.getServiceAsync("LaunchPage").then(function(l){if(l.isLinkPersonalizationSupported()){c.prototype.isLinkPersonalizationOveride();}});}};c.prototype.onAfterRendering=function(){var t=window.document.getElementById(this.getId()+"-titleText");if(t){t.addEventListener("click",function(){var E=this.getModel()&&this.getModel().getProperty("/enableRenameLockedGroup"),f=(E||!this.getIsGroupLocked())&&!this.getDefaultGroup()&&this.getTileActionModeActive();this.setEditMode(f);}.bind(this));}var d=this.getTiles().filter(function(f){return f.isA("sap.ui.integration.widgets.Card");});this._resizeCards(d);var e=sap.ui.getCore().getEventBus();e.publish("launchpad","GroupHeaderVisibility");this.fireAfterRendering();};c.prototype.getTransformationErrorText=function(){return this.oTransformationErrorText;};c.prototype.getTransformationErrorIcon=function(){return this.oTransformationErrorIcon;};c.prototype.getNoLinksText=function(){return this.oNoLinksText;};c.prototype.setTransformationError=function(t){this.setProperty("transformationError",t,true);if(t){this.$().find(".sapUshellTransformationError").show();}else{this.$().find(".sapUshellTransformationError").hide();}this.$().find(".sapUshellNoLinksAreaPresent").toggleClass("sapUshellNoLinksAreaPresentError",t);return this;};c.prototype.updateAggregation=o.updateAggregation;c.prototype.setNoDataText=function(n){this.setProperty("noDataText",n,true);if(this.getShowNoData()){this.$().find(".sapUshellNoFilteredItems").text(n);}return this;};c.prototype.setGroupId=function(v){this.setProperty("groupId",v,true);if(this.oPlusTile){this.oPlusTile.setGroupId(v);}return this;};c.prototype.setHeaderText=function(h){this.setProperty("headerText",h,true);this.$().find(".sapUshellContainerTitle").text(h);return this;};c.prototype.setVisible=function(v){this.setProperty("visible",v,true);this.toggleStyleClass("sapUshellHidden",!v);return this;};c.prototype.setShowMobileActions=function(s){var S=true;if(this.oHeaderButton){this.oHeaderButton.setVisible(s);}else if(s){S=false;}this.setProperty("showMobileActions",s,S);};c.prototype.setShowIcon=function(s){this.setProperty("showIcon",s,true);this.$().find(".sapUshellContainerIcon").toggleClass("sapUshellContainerIconHidden",!s);};c.prototype.setDeluminate=function(d){this.setProperty("deluminate",d,true);this.toggleStyleClass("sapUshellDisableLockedGroupDuringDrag",d);return this;};c.prototype.setHidden=function(h){this.setProperty("hidden",!!h,true);this.toggleStyleClass("sapUshellTileContainerEditModeHidden",!!h);return this;};c.prototype.groupHasTiles=function(){var p="",t=this.getTiles(),l=[];if(this.getBindingContext()){p=this.getBindingContext().sPath;t=this.getModel().getProperty(p).tiles;}return b.groupHasVisibleTiles(t,l);};c.prototype.getInnerContainerDomRef=function(){return this.$().find(".sapUshellTilesContainer-sortable")[0];};c.prototype.getInnerContainersDomRefs=function(){var d=this.getDomRef();if(!d){return null;}return[d.querySelector(".sapUshellTilesContainer-sortable"),d.querySelector(".sapUshellLineModeContainer")];};c.prototype.setEditMode=function(v){if(v){this.addStyleClass("sapUshellEditing");this._startEdit();}else{this.setProperty("editMode",v,false);this.removeStyleClass("sapUshellEditing");}};c.prototype.isLinkPersonalizationOveride=function(){c.prototype.updateLinks=function(R){var g=this.getParent(),t=g&&g.getDisplayMode&&g.getDisplayMode()==="tabs";if(t&&!this.getTileActionModeActive()){g.removeLinksFromUnselectedGroups();}if(this.getLinks().length>0){this.removeAllLinks();}a.prototype.updateAggregation.call(this,"links");};c.prototype.destroyLinks=function(R){L.debug("link is destroyed because: "+R,null,"sap.ushell.ui.launchpad.TileContainer");};};c.prototype.setShowEmptyLinksArea=function(v){this.setProperty("showEmptyLinksArea",v,true);this.toggleStyleClass("sapUshellLinksAreaHidden",!v);};c.prototype.setShowEmptyLinksAreaPlaceHolder=function(v){this.setProperty("showEmptyLinksArea",v,true);this.toggleStyleClass("sapUshellTileContainerEditMode",v);this.toggleStyleClass("sapUshellTileContainerTabsModeEmptyLinksArea",v);this.toggleStyleClass("sapUshellEmptyLinksAreaPlaceHolder",!v);};c.prototype._resizeCards=function(d){var e,m,s=5.5,t=0.4375,f,g,h,j;for(var i=0;i<d.length;i++){e=d[i];m=e.getManifest();f=m["sap.flp"].rows;g=m["sap.flp"].columns;h=g*s+(g-3)*t+"rem";j=f*s+(f-1)*t+"rem";e.setHeight(j);e.setWidth(h);}};c.prototype._startEdit=function(){var t=this;if(this.getModel()&&!this.getModel().getProperty("/editTitle")){this.getModel().setProperty("/editTitle",true,false);}if(!this.oEditInputField){sap.ui.require(["sap/m/Input"],function(d){t.setProperty("editMode",true,false);t.oEditInputField=new d({placeholder:t._sDefaultValue,value:t.getHeaderText()}).addStyleClass("sapUshellTileContainerTitleInput");t.oEditInputField.addEventDelegate({onAfterRendering:function(){setTimeout(function(){if(t.oEditInputField.$().is(":visible")){setTimeout(function(){t.oEditInputField.$().find("input").focus();},100);var w=q(window).height(),j=t.getDomRef(),g=j.offsetHeight,e=j.getBoundingClientRect().top,f=j.offsetTop;if(g+e>w){q(".sapUshellDashboardView section").stop().animate({scrollTop:f},0);}}},100);},onfocusout:function(){t._stopEdit();q.proxy(t.setEditMode,t,false)();},onsapenter:function(e){t._stopEdit();q.proxy(t.setEditMode,t,false)();setTimeout(function(){var f=e.srcControl,j=f.$().prev();j.focus();},0);}});t.oEditInputField.setValue(t.getHeaderText());});}else{this.oEditInputField.setValue(this.getHeaderText());t.setProperty("editMode",true,false);}this._sOldTitle=this._sDefaultValue;if(D.system.phone){setTimeout(function(){var e=sap.ui.getCore().getEventBus();e.publish("launchpad","scrollToGroup",{group:t,groupChanged:false,focus:false});},100);}};c.prototype._stopEdit=function(){var s=this.getHeaderText();var n=this.oEditInputField.getValue(),h;n=n.substring(0,256).trim()||this._sDefaultValue;h=n!==s;if(this.bIsFirstTitleChange&&n===this.oEditInputField.getPlaceholder()){h=true;}this.bIsFirstTitleChange=false;if(this.getModel()&&this.getModel().getProperty("/editTitle")){this.getModel().setProperty("/editTitle",false,false);}if(!this._sOldTitle){this._sOldTitle=s;this.setHeaderText(s);}else if(h){this.fireTitleChange({newTitle:n});this.setHeaderText(n);}};c.prototype.exit=function(){if(this.oPlusTile){this.oPlusTile.destroy();}if(this.oHeaderButton){this.oHeaderButton.destroy();}if(this.oActionSheet){this.oActionSheet.destroy();}if(C.prototype.exit){C.prototype.exit.apply(this,arguments);}};return c;});
