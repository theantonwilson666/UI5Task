// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/m/ButtonRenderer","sap/m/library","sap/ui/Device","sap/ui/thirdparty/jquery","sap/ushell/library","sap/ushell/resources","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/ushell/ui/launchpad/ActionItem"],function(L,B,m,D,q,u,r,A,a){"use strict";var b=m.ButtonType;var C=a.extend("sap.ushell.ui.footerbar.ContactSupportButton",{metadata:{library:"sap.ushell"},renderer:"sap.m.ButtonRenderer"});C.prototype.init=function(){if(a.prototype.init){a.prototype.init.apply(this,arguments);}this.setIcon("sap-icon://email");this.setText(r.i18n.getText("contactSupportBtn"));this.attachPress(this.showContactSupportDialog);this.setEnabled();};C.prototype.showContactSupportDialog=function(){sap.ui.require(["sap/ui/layout/form/SimpleForm","sap/ui/layout/form/SimpleFormLayout","sap/m/TextArea","sap/m/Link","sap/m/Label","sap/m/Text","sap/m/Dialog","sap/m/Button","sap/ushell/UserActivityLog"],function(S,c,T,d,e,f,g,h,U){var i="",j="",k="",l=[],o,n;n=function(){this.oDialog.removeContent(this.oBottomSimpleForm.getId());this.oBottomSimpleForm.destroy();if(this.oClientContext.navigationData.applicationInformation){i=this.oClientContext.navigationData.applicationInformation.applicationType;j=this.oClientContext.navigationData.applicationInformation.url;k=this.oClientContext.navigationData.applicationInformation.additionalInformation;}l.push(new f({text:this.translationBundle.getText("loginDetails")}).addStyleClass("sapUshellContactSupportHeaderInfoText"));l.push(new e({text:this.translationBundle.getText("userFld")}));l.push(new f({text:this.oClientContext.userDetails.fullName||""}));l.push(new e({text:this.translationBundle.getText("serverFld")}));l.push(new f({text:window.location.host}));if(this.oClientContext.userDetails.eMail&&this.oClientContext.userDetails.eMail!==""){l.push(new e({text:this.translationBundle.getText("eMailFld")}));l.push(new f({text:this.oClientContext.userDetails.eMail||""}));}l.push(new e({text:this.translationBundle.getText("languageFld")}));l.push(new f({text:this.oClientContext.userDetails.Language||""}));if(this.oClientContext.shellState==="app"||this.oClientContext.shellState==="standalone"){l.push(new f({text:""}));l.push(new f({text:this.translationBundle.getText("navigationDataFld")}).addStyleClass("sapUshellContactSupportHeaderInfoText"));l.push(new e({text:this.translationBundle.getText("hashFld")}));l.push(new f({text:this.oClientContext.navigationData.navigationHash||""}));l.push(new f({text:""}));l.push(new f({text:this.translationBundle.getText("applicationInformationFld")}).addStyleClass("sapUshellContactSupportHeaderInfoText"));l.push(new e({text:this.translationBundle.getText("applicationTypeFld")}));l.push(new f({text:i}));l.push(new e({text:this.translationBundle.getText("urlFld")}));l.push(new f({text:j}));l.push(new e({text:this.translationBundle.getText("additionalInfoFld")}));l.push(new f({text:k}));}this.oBottomSimpleForm=new S("technicalInfoBox",{layout:c.ResponsiveLayout,content:l}).addStyleClass("sapUshellTechnicalInfoBox");if(D.os.ios&&D.system.phone){this.oBottomSimpleForm.addStyleClass("sapUshellContactSupportFixWidth");}o=this.oBottomSimpleForm.onAfterRendering;this.oBottomSimpleForm.onAfterRendering=function(){o.apply(this,arguments);var p=q(this.getDomRef());p.attr("tabIndex",0);setTimeout(function(){this.focus();}.bind(p),700);};this.oDialog.addContent(this.oBottomSimpleForm);}.bind(this);this._embedLoginDetailsInBottomForm=n;this.translationBundle=r.i18n;this.oClientContext=U.getMessageInfo();this.oLink=new d({text:this.translationBundle.getText("technicalDataLink")});this.oBottomSimpleForm=new S("bottomForm",{editable:false,content:[this.oLink]});this.sendButton=new h("contactSupportSendBtn",{text:this.translationBundle.getText("sendBtn"),type:b.Emphasized,enabled:false,press:function(){sap.ushell.Container.getServiceAsync("SupportTicket").then(function(s){var t=this.oTextArea.getValue();s.createTicket({text:t,clientContext:this.oClientContext}).done(function(){sap.ushell.Container.getServiceAsync("Message").then(function(M){M.info(this.translationBundle.getText("supportTicketCreationSuccess"));}.bind(this));}.bind(this)).fail(function(){sap.ushell.Container.getServiceAsync("Message").then(function(M){M.error(this.translationBundle.getText("supportTicketCreationFailed"));}.bind(this));}.bind(this));this.oDialog.close();}.bind(this));}.bind(this)});this.cancelButton=new h("contactSupportCancelBtn",{text:this.translationBundle.getText("cancelBtn"),press:function(){this.oDialog.close();}.bind(this)});this.oTextArea=new T("textArea",{rows:7,liveChange:function(){if(/\S/.test(this.oTextArea.getValue())){this.sendButton.setEnabled(true);}else{this.sendButton.setEnabled(false);this.oTextArea.setValue("");}}.bind(this)});this.oTopSimpleForm=new S("topForm",{editable:false,content:[this.oTextArea],layout:c.ResponsiveGridLayout});this.oDialog=new g({id:"ContactSupportDialog",title:this.translationBundle.getText("contactSupportBtn"),contentWidth:"29.6rem",leftButton:this.sendButton,rightButton:this.cancelButton,initialFocus:"textArea",afterOpen:function(){q("#textArea").on("focusout",function(){window.scrollTo(0,0);});},afterClose:function(){this.oDialog.destroy();if(window.document.activeElement&&window.document.activeElement.tagName==="BODY"){window.document.getElementById("meAreaHeaderButton").focus();}}.bind(this)}).addStyleClass("sapUshellContactSupportDialog").addStyleClass("sapContrastPlus");this.oTextArea.setPlaceholder(this.translationBundle.getText("txtAreaPlaceHolderHeader"));this.oLink.attachPress(n.bind(this));this.oDialog.addCustomData(new A({key:"aria-label",value:this.translationBundle.getText("ContactSupportArialLabel"),writeToDom:true}));this.oDialog.addContent(this.oTopSimpleForm);this.oDialog.addContent(this.oBottomSimpleForm);this.oDialog.open();}.bind(this));};C.prototype.setEnabled=function(e){if(!sap.ushell.Container){if(this.getEnabled()){L.warning("Disabling 'Contact Support' button: unified shell container not initialized",null,"sap.ushell.ui.footerbar.ContactSupportButton");}e=false;}a.prototype.setEnabled.call(this,e);};return C;});
