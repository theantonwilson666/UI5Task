// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/base/Log","sap/ushell/resources","sap/ui/thirdparty/hasher","sap/ui/core/library"],function(C,L,r,h,c){"use strict";var V=c.ValueState;return C.extend("sap.ushell.ui.bookmark.SaveOnPage",{onInit:function(){var v=this.getView();v.setModel(r.i18nModel,"i18n");this.byId("bookmarkTitleInput").attachLiveChange(function(){if(this.getValue()===""){this.setValueStateText(r.i18n.getText("bookmarkTitleInputError"));this.setValueState(V.Error);}else{this.setValueState(V.None);}});this.byId("pageSelect").attachSelectionFinish(function(){if(this.getSelectedKeys().length===0){this.setValueStateText(r.i18n.getText("bookmarkPageSelectError"));this.setValueState(V.Error);}else{this.setValueState(V.None);}});},loadPagesIntoModel:function(s,p){if(s&&!p){return Promise.all([sap.ushell.Container.getServiceAsync("Menu"),sap.ushell.Container.getServiceAsync("CommonDataModel")]).then(function(S){return Promise.all([S[0].getSpacesPagesHierarchy(),S[1].getAllPages()]);}).then(function(R){var S=R[0].spaces;var a=R[1];var P={};a.forEach(function(o){P[o.identification.id]=o.identification.title;});return S.reduce(function(t,o){o.pages.map(function(b){if(P[b.id]){t.push({id:b.id,title:P[b.id],spaceTitle:o.title});}});return t;},[]);}).then(function(t){if(t.length<1){return Promise.reject();}this.getView().getModel().setProperty("/pages",t);}.bind(this)).catch(function(){var m=this.getView().getModel();m.setProperty("/pages",[]);m.setProperty("/cannotLoadPages",true);L.error("SaveOnPage controller: Unable to determine or use targets for bookmark placement.");}.bind(this));}return Promise.resolve();},removeFocusFromTile:function(){this.getView().getDomRef().querySelector(".sapMGT").removeAttribute("tabindex");},getBookmarkTileData:function(){var v=this.getView();var m=v.getModel();var o=v.getViewData();var u;if(o.customUrl){if(typeof(o.customUrl)==="function"){u=o.customUrl();}else{u=o.customUrl;}}else{u=h.getHash()?("#"+h.getHash()):window.location.href;}var p=this.byId("pageSelect");var d={title:m.getProperty("/title")||"",subtitle:m.getProperty("/subtitle")||"",url:u,icon:m.getProperty("/icon"),info:m.getProperty("/info")||"",numberUnit:m.getProperty("/numberUnit"),serviceUrl:typeof(o.serviceUrl)==="function"?o.serviceUrl():o.serviceUrl,serviceRefreshInterval:m.getProperty("/serviceRefreshInterval"),pages:p?p.getSelectedKeys():[],keywords:m.getProperty("/keywords")};d.title=d.title.substring(0,256).trim();d.subtitle=d.subtitle.substring(0,256).trim();d.info=d.info.substring(0,256).trim();return d;}});});
