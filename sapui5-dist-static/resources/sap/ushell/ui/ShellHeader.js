// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Control","sap/ui/core/theming/Parameters","sap/ui/Device","sap/ui/dom/units/Rem","sap/ushell/EventHub","sap/ushell/library","sap/ushell/ui/shell/ShellAppTitle","sap/ushell/ui/ShellHeaderRenderer","sap/ushell/utils"],function(C,T,D,R,E,u,S,a,b){"use strict";var s="sapUshellShellShowSearchOverlay";var _=0;var c;var d="data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";var f=sap.ui.require.toUrl("sap/ushell")+"/themes/base/img/SAPLogo.svg";var g=C.extend("sap.ushell.ui.ShellHeader",{metadata:{properties:{logo:{type:"sap.ui.core.URI",defaultValue:""},showLogo:{type:"boolean",defaultValue:true},homeUri:{type:"sap.ui.core.URI",defaultValue:"#"},searchState:{type:"string",defaultValue:"COL"},ariaLabel:{type:"string"},centralAreaElement:{type:"string",defaultValue:null},title:{type:"string",defaultValue:""}},aggregations:{headItems:{type:"sap.ushell.ui.shell.ShellHeadItem",multiple:true},headEndItems:{type:"sap.ui.core.Control",multiple:true},search:{type:"sap.ui.core.Control",multiple:false},appTitle:{type:"sap.ushell.ui.shell.ShellAppTitle",multiple:false}},associations:{shellLayout:{type:"sap.ui.base.ManagedObject",multiple:false}},events:{searchSizeChanged:{}}}});g.prototype.getShellLayoutControl=function(){return sap.ui.getCore().byId(this.getShellLayout());};g.prototype.createUIArea=function(){var h=window.document.getElementById("shell-hdr");if(!h){window.document.body.insertAdjacentHTML("afterbegin","<div id=\"shell-hdr\" class=\"sapContrastPlus sapUshellShellHead\"></div>");this.placeAt("shell-hdr");}};g.prototype.SearchState={COL:"COL",EXP:"EXP",EXP_S:"EXP_S"};g.prototype.init=function(){D.media.attachHandler(this.refreshLayout,this,D.media.RANGESETS.SAP_STANDARD);D.resize.attachHandler(this.refreshLayout,this);this._fnFocusListener=this._handleFocus.bind(this);this.addDelegate({onBeforeFastNavigationFocus:function(e){e.preventDefault();this._accessKeyHandler.sendFocusBackToShell(e);}.bind(this)});E.once("ShellNavigationInitialized").do(function(){sap.ushell.Container.getServiceAsync("ShellNavigation").then(function(o){this._rerenderLogoNavigationFilterBound=this._rerenderLogoNavigationFilter.bind(this);o.registerNavigationFilter(this._rerenderLogoNavigationFilterBound);this._rerenderLogoNavigationFilterBound.detach=function(){o.unregisterNavigationFilter(this._rerenderLogoNavigationFilterBound);};}.bind(this));}.bind(this));};g.prototype.exit=function(){D.media.detachHandler(this.refreshLayout,this,D.media.RANGESETS.SAP_STANDARD);D.resize.detachHandler(this.refreshLayout,this);var o=window.document.getElementById("shell-hdr");if(o){o.parentElement.removeChild(o);}if(this._rerenderLogoNavigationFilterfnRerenderLogoNavigationFilter){this._rerenderLogoNavigationFilterfnRerenderLogoNavigationFilter.detach();}};g.prototype._toggleFocusListener=function(t){var A=window.document.getElementById("sapUshellHeaderAccessibilityHelper");if(A){A[t?"addEventListener":"removeEventListener"]("focus",this._fnFocusListener);}};g.prototype.setAccessKeyHandler=function(A){this._accessKeyHandler=A;};g.prototype._handleFocus=function(e){var t=this;function h(){if(t._accessKeyHandler.bForwardNavigation){var H=t.getHeadItems();if(H.length>0){H[0].focus();}else{t.getAppTitle().focus();}}else{var k=t.getHeadEndItems();if(k.length>0){k[k.length-1].focus();}else{t.getAppTitle().focus();}}t._accessKeyHandler.fromOutside=false;}if(this._accessKeyHandler){if(this._accessKeyHandler.fromOutside||this._accessKeyHandler.bForwardNavigation){h();}else{this._accessKeyHandler._handleEventUsingExternalKeysHandler(e);var A=window.document.getElementById("sapUshellHeaderAccessibilityHelper");if(window.document.activeElement===A){var j=window.document.querySelectorAll("#canvas [tabindex='0']");var F;for(var i=j.length-1;i>=0;i--){if(j[i].offsetWidth>0&&j[i].offsetHeight>0){F=j[i];break;}}if(F){F.focus();}else{h();return;}}this._accessKeyHandler.bFocusOnShell=false;}}};g.prototype.onsapspace=function(e){if(e.target===this.getDomRef("logo")){window.location.href=e.target.href;}};g.prototype.onBeforeRendering=function(){this._toggleFocusListener(false);};g.prototype.onAfterRendering=function(){var h=this.getDomRef();if(!c&&h.parentElement.getBoundingClientRect().height>0){h.style.visibility="hidden";h.style.height="2.75rem";return;}this.refreshLayout();this._toggleFocusListener(true);};g.prototype.onThemeChanged=function(e){c=e.theme;this.invalidate();};g.prototype.getLogo=function(){return this.getProperty("logo")||(sap.ui.getCore().isThemeApplied()?T._getThemeImage()||f:d);};g.prototype.refreshLayout=function(){if(!this.getDomRef()){return;}this._setAppTitleFontSize();if(this.getSearchVisible()){var o=this.getDomRef("hdr-search");o.style.display="none";this._hideElementsForSearch();o.style.display="";o.style["max-width"]=_+"rem";this.fireSearchSizeChanged({remSize:R.fromPx(o.getBoundingClientRect().width),isFullWidth:this.isPhoneState()||this.getDomRef("hdr-end").style.display==="none"});}};g.prototype._setAppTitleFontSize=function(){var B=this.getDomRef("hdr-begin"),A=window.document.getElementById("shellAppTitle"),e="sapUshellHeadTitleWithSmallerFontSize";if(B&&A&&A.style.display!=="none"){var t=A.querySelector("h1");if(t){t.classList.remove(e);A.style.overflow="visible";var o=B.getBoundingClientRect(),i=o.x+o.width,h=A.getBoundingClientRect(),j=h.x+h.width;if(j>i){t.classList.add(e);A.style.overflow="hidden";}}}};g.prototype.removeHeadItem=function(i){if(typeof i==="number"){i=this.getHeadItems()[i];}this.removeAggregation("headItems",i);};g.prototype.addHeadItem=function(i){this.addAggregation("headItems",i);};g.prototype.isPhoneState=function(){var e=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name;var h=this.getDomRef().getBoundingClientRect().width>_;return(D.system.phone||e==="Phone"||!h);};g.prototype.setSearchState=function(e,m,w){if(this.SearchState[e]&&this.getSearchState()!==e){if(typeof m==="boolean"){w=m;m=undefined;}this.setProperty("searchState",e,false);var h=(e!=="COL");var i=this.getShellLayoutControl();if(i){i.toggleStyleClass(s,h&&w);}_=h?m||35:0;}};g.prototype._hideElementsForSearch=function(){var n,o=this.getDomRef("hdr-search-container"),B=this.getDomRef("hdr-begin"),h=this.getDomRef("hdr-center"),j=this.getDomRef("hdr-end");if(this.getSearchState()==="EXP"||this.isPhoneState()){n=R.toPx(_+3);}else{n=R.toPx(9+0.5);}var k=[B];Array.prototype.forEach.call(B.childNodes,function(e){k.unshift(e);});if(h){k.unshift(h);}B.style.flexBasis="";j.style.display="";k.forEach(function(e){e.style.display="";});for(var i=0;i<k.length;i++){if(n>o.getBoundingClientRect().width){k[i].style.display="none";if(h&&i===0){B.style.flexBasis="auto";}}else{return;}}if(R.toPx(_)>o.getBoundingClientRect().width){j.style.display="none";}};g.prototype.getSearchWidth=function(){return _;};g.prototype.isHomepage=function(){var h=(window.hasher&&"#"+window.hasher.getHash())||"";var r=new RegExp("[?]"+"(?:"+"(?!&[/])."+")*");var H=h.replace(r,"");return b.isRootIntent(H)||H==="#Launchpad-openFLPPage";};g.prototype._rerenderLogoNavigationFilter=function(n,o){var e=sap.ushell.Container.getService("ShellNavigation");var A=e.hashChanger.isInnerAppNavigation(n,o);if(A){this.invalidate();}return e.NavigationFilterStatus.Continue;};g.prototype.getSearchVisible=function(){return this.getSearchState()!==this.SearchState.COL;};g.prototype.getCentralControl=function(){return sap.ui.getCore().byId(this.getCentralAreaElement());};g.prototype.setNoLogo=function(){this.setLogo(d);};g.prototype._getLeanMode=function(){return(window.location.search||"").indexOf("appState=lean")>=0;};return g;},true);
