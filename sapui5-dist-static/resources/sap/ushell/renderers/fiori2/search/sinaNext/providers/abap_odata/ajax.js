// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sinaDefine(['../../core/core','../../core/ajax'],function(c,a){"use strict";var m={};m.Exception=c.Exception.derive({_init:function(d){c.Exception.prototype._init.apply(this,[d]);}});var p=function(d){try{var f=JSON.parse(d.responseText);var g=[];if(f&&f.error&&f.error.code){g.push(f.error.code);}if(f&&f.error&&f.error.message&&f.error.message.value){g.push(f.error.message.value);}if(g.length===0){return c.Promise.reject(d);}return c.Promise.reject(new m.Exception({message:g.join('\n'),previous:d}));}catch(e){return c.Promise.reject(d);}};var b=function(o){return function(){return o.apply(this,arguments).then(function(r){return r;},function(e){if(!(e instanceof a.Exception)){return c.Promise.reject(e);}return p(e);});};};var _=function(n){if(n.SubFilters!==undefined){delete n.ActAsQueryPart;for(var i=0;i<n.SubFilters.length;i++){_(n.SubFilters[i]);}}};m.createAjaxClient=function(){var d=new a.Client({csrf:true,requestNormalization:function(e){if(e===null){return{};}if(e.Events!==undefined){return{"NotToRecord":true};}delete e.SessionID;delete e.SessionTimestamp;if(e.d&&e.d.QueryOptions){delete e.d.QueryOptions.ClientSessionID;delete e.d.QueryOptions.ClientCallTimestamp;delete e.d.QueryOptions.ClientServiceName;delete e.d.QueryOptions.ClientLastExecutionID;}if(e.d){var f=JSON.stringify(e);var h='"DataSources":[';var g=']';var i=f.indexOf(h);var j=i+f.substring(i).indexOf(g)+g.length;var k=',"ExcludedDataSources":[]';f=[f.slice(0,j),k,f.slice(j)].join('');e=JSON.parse(f);}if(e.d.Filter){_(e.d.Filter);}return e;}});d.postJson=b(d.postJson);d.getJson=b(d.getJson);d.mergeJson=b(d.mergeJson);return d;};return m;});
