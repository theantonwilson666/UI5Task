// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define([],function(){"use strict";var m={};var e=function(u){return u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");};var a=function(o,h){for(var k in h){o[k]=h[k];}return o;};var d=function(h){var j=[['amp','&'],['apos','\''],['#x27','\''],['#x2F','/'],['#39','\''],['#47','/'],['lt','<'],['gt','>'],['nbsp',' '],['quot','"']];for(var i=0,k=j.length;i<k;++i){h=h.replace(new RegExp('&'+j[i][0]+';','g'),j[i][1]);}return h;};var b=function(s){return s.replace(/&#(\d+);/g,function(h,j){return String.fromCharCode(j);});};var c=function(h){return b(d(h));};m.Token=function(){};m.Token.prototype={init:function(){var h=arguments[0];if(h==='tokenize'){this.text=arguments[1];this.matches=[];this.startIndex=arguments[2];this.regExp.lastIndex=this.startIndex;var j=this.regExp.exec(this.text);this.endIndex=this.startIndex+j[0].length;}if(h==='set'){this.text=arguments[1];this.matches=arguments[2];this.startIndex=0;this.endIndex=this.text.length;}},match:function(h,j){this.regExp.lastIndex=0;return!!this.regExp.exec(h[j]);},getLength:function(){return this.endIndex-this.startIndex;},toString:function(){return this.text.slice(this.startIndex,this.endIndex);},toHighlightedString:function(){var p=[];var h=this.startIndex;for(var i=0;i<this.matches.length;++i){var j=this.matches[i];if(j[0]>h){p.push(e(this.text.slice(h,j[0])));}p.push('<b>'+e(this.text.slice(j[0],j[1]))+'</b>');h=j[1];}if(this.endIndex>h){p.push(e(this.text.slice(h,this.endIndex)));}return p.join('');}};m.TextToken=function(){this.init.apply(this,arguments);};m.TextToken.prototype=a(new m.Token(),{type:'Text',regExp:new RegExp('[\\w]+','g')});m.SpecialCharactersTextToken=function(){this.init.apply(this,arguments);};m.SpecialCharactersTextToken.prototype=a(new m.Token(),{type:'SpecialCharactersText',regExp:new RegExp('[^\\w\\s@#]+','g')});m.UserToken=function(){this.init.apply(this,arguments);};m.UserToken.prototype=a(new m.Token(),{type:'User',regExp:new RegExp('[@]+','g')});m.HashToken=function(){this.init.apply(this,arguments);};m.HashToken.prototype=a(new m.Token(),{type:'Hash',regExp:new RegExp('[#]+','g')});m.WhitespaceToken=function(){this.init.apply(this,arguments);};m.WhitespaceToken.prototype=a(new m.Token(),{type:'Whitespace',regExp:new RegExp('\\s+','g')});m.MatchStartToken=function(){this.init.apply(this,arguments);};m.MatchStartToken.prototype=a(new m.Token(),{type:'MatchStart',regExp:new RegExp('<b>','g'),match:function(h,j){return h.slice(j,j+3)==='<b>';}});m.MatchEndToken=function(){this.init.apply(this,arguments);};m.MatchEndToken.prototype=a(new m.Token(),{type:'MatchEnd',regExp:new RegExp('</b>','g'),match:function(h,j){return h.slice(j,j+4)==='</b>';}});var t=[m.WhitespaceToken,m.MatchStartToken,m.MatchEndToken,m.HashToken,m.UserToken,m.SpecialCharactersTextToken,m.TextToken];var f={};for(var i=0;i<t.length;++i){var g=t[i];f[g.prototype.type]=g;}m.Tokenizer=function(){this.init.apply(this,arguments);};m.Tokenizer.prototype={init:function(h){this.text=h;this.index=0;},getNextToken:function(){if(this.index>=this.text.length){return null;}for(var i=0;i<t.length;++i){var g=t[i];if(g.prototype.match(this.text,this.index)){var h=new g('tokenize',this.text,this.index);this.index+=h.getLength();return h;}}throw'tokenization error';},lookAhead:function(h){h=h||1;var p=this.getPosition();var j=[];for(var i=0;i<h;++i){var k=this.getNextToken();j.push(k);}this.setPosition(p);if(h===1){return j[0];}return j;},getPosition:function(){return this.index;},setPosition:function(p){this.index=p;}};m.MatchTokenizer=function(){this.init.apply(this,arguments);};m.MatchTokenizer.prototype={init:function(h){this.tokenizer=new m.Tokenizer(h);this.matchCounter=0;},getNextToken:function(){var h;var j=[];for(;;){var k=this.tokenizer.lookAhead(1);if(!k){break;}if(k.type==='MatchStart'||k.type==='MatchEnd'){this.tokenizer.getNextToken();switch(k.type){case'MatchStart':this.matchCounter++;break;case'MatchEnd':this.matchCounter--;break;}continue;}if(!h){this.tokenizer.getNextToken();h=k.type;k._match=this.matchCounter>0;j.push(k);continue;}if(h===k.type){this.tokenizer.getNextToken();k._match=this.matchCounter>0;j.push(k);continue;}break;}switch(j.length){case 0:return null;case 1:var r=j[0];if(r._match){r.matches=[[r.startIndex,r.endIndex]];}return r;default:return this.mergeTokens(h,j);}},mergeTokens:function(h,j){var k=[];var l=[];var n=0;for(var i=0;i<j.length;++i){var o=j[i];var p=o.toString();var q=p.length;k.push(p);if(o._match){l.push([n,n+q]);}n+=q;}var r=new f[h]('set',k.join(''),l);return r;},lookAhead:function(h){h=h||1;var p=this.getPosition();var j=[];for(var i=0;i<h;++i){var k=this.getNextToken();j.push(k);}this.setPosition(p);if(h===1){return j[0];}return j;},getPosition:function(){return{internalPosition:this.tokenizer.getPosition(),matchCounter:this.matchCounter};},setPosition:function(p){this.tokenizer.setPosition(p.internalPosition);this.matchCounter=p.matchCounter;}};m.TwitterDocument=function(){this.init.apply(this,arguments);};m.TwitterDocument.prototype={init:function(h){h=c(h);this.nodes=[];this.parse(h);},parse:function(h){var j=new m.MatchTokenizer(h);for(;;){var k=j.lookAhead(2);var l=k[0];var n=k[1];if(!l){break;}var o=null;switch(l.type){case'Whitespace':o=new m.TwitterTextNode();break;case'User':if(n&&n.type==='Text'){o=new m.TwitterUserNode();}else{o=new m.TwitterTextNode();}break;case'Hash':o=new m.TwitterHashNode();if(n&&n.type==='Text'){o=new m.TwitterHashNode();}else{o=new m.TwitterTextNode();}break;case'Text':o=new m.TwitterTextNode();if(l.toString().slice(0,4)==='http'){o=new m.TwitterLinkNode();}else{o=new m.TwitterTextNode();}break;case'SpecialCharactersText':o=new m.TwitterTextNode();break;}if(!o){throw'parse error '+l.toString();}o.parse(j);this.nodes.push(o);}},render:function(r){for(var i=0;i<this.nodes.length;++i){var n=this.nodes[i];n.render(r);}},log:function(){for(var i=0;i<this.nodes.length;++i){var n=this.nodes[i];n.log();}}};m.TwitterTextNode=function(){};m.TwitterTextNode.prototype={type:'TextNode',parse:function(h){var j=h.getNextToken();this.text=j.toString();this.textHighlighted=j.toHighlightedString();},render:function(r){r.write('<span style="display:inline" class="sapMText">');r.write(this.textHighlighted);r.write('</span>');},log:function(){}};m.TwitterUserNode=function(){};m.TwitterUserNode.prototype={type:'UserNode',parse:function(h){var j=h.getNextToken();this.at=j.toString();this.atHighlighted=j.toHighlightedString();var u=h.getNextToken();this.user=u.toString();this.userHighlighted=u.toHighlightedString();},render:function(r){r.write('<a target="_blank" rel="noopener noreferrer" style="display:inline" class="sapMLnk" href="https://twitter.com/'+this.user+'">');r.write(this.atHighlighted+this.userHighlighted);r.write('</a>');},log:function(){}};m.TwitterHashNode=function(){};m.TwitterHashNode.prototype={type:'HashNode',parse:function(h){var j=h.getNextToken();this.hash=j.toString();this.hashHighlighted=j.toHighlightedString();var k=h.getNextToken();this.tag=k.toString();this.tagHighlighted=k.toHighlightedString();},render:function(r){r.write('<a target="_blank" rel="noopener noreferrer" style="display:inline" class="sapMLnk" href="https://twitter.com/hashtag/'+this.tag+'?src=hash">');r.write(this.hashHighlighted+this.tagHighlighted);r.write('</a>');},log:function(){}};m.TwitterLinkNode=function(){};m.TwitterLinkNode.prototype={type:'LinkNode',parse:function(h){var p=[];var j=[];for(;;){var k=h.lookAhead();if(k&&(k.type==='Text'||k.type==='SpecialCharactersText')){h.getNextToken();p.push(k.toString());j.push(k.toHighlightedString());continue;}break;}this.url=p.join('');this.userHighlighted=j.join('');},render:function(r){},log:function(){}};m.renderTweet=function(r,h){var j=new m.TwitterDocument(h);j.render(r);};m.test1=function(){var h=new this.Tokenizer('this <b>i</b>s a #test');for(var i=0;i<20;++i){var j=h.getNextToken();if(!j){break;}}};m.test2=function(){var h=new this.MatchTokenizer('this <b>i</b>s a #test');for(var i=0;i<20;++i){var j=h.getNextToken();if(!j){break;}}};m.test=function(){var h=new m.TwitterDocument('this <b>@test1test2test3</b> is a h<b>tt</b>p://sap.com');h.log();};return m;});
