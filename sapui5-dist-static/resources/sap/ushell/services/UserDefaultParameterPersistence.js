// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/jquery","sap/base/util/ObjectPath","sap/base/Log"],function(q,O,L){"use strict";var v=["value","extendedValue","noEdit","alwaysAskPlugin","_shellData","pluginData"];function U(a){this._oAdapter=a;this._oData={};}U.prototype._cleanseValue=function(V){var r=q.extend(true,{},V);for(var a in r){if(r.hasOwnProperty(a)&&v.indexOf(a)<0){delete r[a];}}return r;};U.prototype._getSystemContextPromise=function(s){if(!s){L.warning("UserDefaultParameterPersistence: The systemContext was not provided, using defaultSystemContext as fallback");return sap.ushell.Container.getServiceAsync("ClientSideTargetResolution").then(function(c){return c.getSystemContext();});}return Promise.resolve(s);};U.prototype.loadParameterValue=function(p,s){var d=new q.Deferred();this._getSystemContextPromise(s).then(function(s){var V=O.get([s.id,p],this._oData);if(V!==undefined){d.resolve(V);}else{this._oAdapter.loadParameterValue(p,s).done(function(o){var c=this._cleanseValue(o);d.resolve(c);}.bind(this)).fail(d.reject.bind(this));}}.bind(this));return d.promise();};U.prototype.saveParameterValue=function(p,V,s){var d=new q.Deferred();var c;this._getSystemContextPromise(s).then(function(s){if(!V){return this.deleteParameter(p,s).done(d.resolve).fail(d.reject);}c=this._cleanseValue(V);if(V&&V.noStore===true){return d.resolve();}O.set([s.id,p],c,this._oData);return this._oAdapter.saveParameterValue(p,c,s).done(d.resolve).fail(d.reject);}.bind(this));return d.promise();};U.prototype.deleteParameter=function(p,s){var d=new q.Deferred();this._getSystemContextPromise(s).then(function(s){if(this._oData[s.id]){delete this._oData[s.id][p];}return this._oAdapter.deleteParameter(p,s).done(d.resolve).fail(d.reject);}.bind(this));return d.promise();};U.prototype.getStoredParameterNames=function(s){var d=new q.Deferred();this._getSystemContextPromise(s).then(function(s){this._oAdapter.getStoredParameterNames(s).done(function(r){r.sort();d.resolve(r);}).fail(d.reject.bind(d));}.bind(this));return d.promise();};U.hasNoAdapter=false;return U;},true);
