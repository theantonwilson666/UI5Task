// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/ActionSheet","sap/m/FrameType","sap/m/library","sap/m/VBox","sap/ui/core/Icon","sap/ui/core/XMLComposite","sap/ui/events/PseudoEvents","sap/ushell/library","sap/ushell/resources"],function(A,F,m,V,I,X,P,u,r){"use strict";var L=m.LoadState;var T=m.TileSizeBehavior;var D=u.DisplayFormat;var a=X.extend("sap.ushell.ui.launchpad.VizInstance",{metadata:{library:"sap.ushell",properties:{title:{type:"string",defaultValue:"",bindable:true},subtitle:{type:"string",defaultValue:"",bindable:true},height:{type:"int",defaultValue:2},width:{type:"int",defaultValue:2},info:{type:"string",defaultValue:"",bindable:true},icon:{type:"sap.ui.core.URI",defaultValue:"",bindable:true},numberUnit:{type:"string",defaultValue:"",bindable:true},state:{type:"sap.m.LoadState",defaultValue:L.Loaded,bindable:true},sizeBehavior:{type:"sap.m.TileSizeBehavior",defaultValue:T.Responsive,bindable:true},editable:{type:"boolean",defaultValue:false,bindable:true},active:{type:"boolean",defaultValue:false},targetURL:{type:"string"},indicatorDataSource:{type:"object",defaultValue:undefined},dataSource:{type:"object",defaultValue:undefined},keywords:{type:"string[]",defaultValue:[]},instantiationData:{type:"object",defaultValue:{}},contentProviderId:{type:"string",defaultValue:""},vizConfig:{type:"object"},supportedDisplayFormats:{type:"string[]",defaultValue:[D.Standard]},dataHelpId:{type:"string",defaultValue:""},displayFormat:{type:"string",defaultValue:D.Standard},tileSize:{type:"string"}},defaultAggregation:"tileActions",aggregations:{tileActions:{type:"sap.m.Button",forwarding:{getter:"_getTileActionSheet",aggregation:"buttons"}}},events:{press:{parameters:{scope:{type:"sap.m.GenericTileScope"},action:{type:"string"}}}}},fragment:"sap.ushell.services._VisualizationInstantiation.VizInstance"});a.prototype.init=function(){X.prototype.init.apply(this,arguments);this._oContent=this.getAggregation("_content");};a.prototype._formatPlaceholderFrameType=function(d,t){this._setSize();switch(d){case D.Flat:return F.OneByHalf;case D.FlatWide:return F.TwoByHalf;case D.StandardWide:return F.TwoByOne;default:if(t==="1x2"){return F.TwoByOne;}return F.OneByOne;}};a.prototype.exit=function(){if(this._oEditModeOverlayContainer){this._oEditModeOverlayContainer.destroy();}if(this._oActionModeButtonIconVBox){this._oActionModeButtonIconVBox.destroy();}if(this._oActionDivCenter){this._oActionDivCenter.destroy();}if(this._oActionSheet){this._oActionSheet.destroy();}};a.prototype.getLayout=function(){return{columns:this.getWidth(),rows:this.getHeight()};};a.prototype._setContent=function(c){var g=this.getLayoutData();if(g&&g.isA("sap.f.GridContainerItemLayoutData")){g.setRows(this.getHeight());g.setColumns(this.getWidth());this.getParent().invalidate();}if(this.getDataHelpId()){c.data("help-id",this.getDataHelpId(),true);}this._oContent=c;this.invalidate();};a.prototype._updateContent=function(){var c=this._oContent;if(this.getEditable()){c=this._getEditModeOverlay(c);}if(this._oContent.getItems){this.setAggregation("_content",c.getItems()[0]);}else{this.setAggregation("_content",c);}};a.prototype._getEditModeOverlay=function(c){var t=this.getTileActions(),M=sap.ui.getCore().getLibraryResourceBundle("sap.m");if(!this._oEditModeOverlayContainer){var R=new I({id:this.getId()+"-action-remove",alt:M.getText("GENERICTILE_ACTIONS_ARIA_TEXT"),decorative:false,noTabStop:true,src:"sap-icon://decline",tooltip:r.i18n.getText("removeButtonTitle")}).addStyleClass("sapUshellTileDeleteIconInnerClass sapMPointer");this._oRemoveIconVBox=new V({items:[R]}).addStyleClass("sapUshellTileDeleteIconOuterClass sapUshellTileDeleteClickArea sapMPointer");this._oEditModeOverlayContainer=new V().addStyleClass("sapUshellVizInstance");}this._oEditModeOverlayContainer.removeAllItems();this._oEditModeOverlayContainer.addItem(this._oRemoveIconVBox);this._oEditModeOverlayContainer.addItem(c);if(t.length>0){if(!this._oActionDivCenter){this._oActionDivCenter=new V().addStyleClass("sapUshellTileActionDivCenter");this._oActionDivCenter.attachBrowserEvent("click",this._onActionMenuIconPressed,this);}if(!this._oActionModeButtonIconVBox){this._oActionModeIcon=new I({id:this.getId()+"-action-more",decorative:false,alt:M.getText("LIST_ITEM_NAVIGATION"),noTabStop:true,press:[this._onActionMenuIconPressed,this],src:"sap-icon://overflow",tooltip:r.i18n.getText("configuration.category.tile_actions")}).addStyleClass("sapUshellTileActionIconDivBottomInner sapMPointer");this._oActionModeButtonIconVBox=new V({items:[this._oActionModeIcon]}).addStyleClass("sapUshellTileActionIconDivBottom sapMPointer");}this._oEditModeOverlayContainer.addItem(this._oActionDivCenter);this._oEditModeOverlayContainer.addItem(this._oActionModeButtonIconVBox);}return this._oEditModeOverlayContainer;};a.prototype._getTileActionSheet=function(){if(!this._oActionSheet){this._oActionSheet=new A();}return this._oActionSheet;};a.prototype._onActionMenuIconPressed=function(){if(this._oActionModeIcon){this._getTileActionSheet().openBy(this._oActionModeIcon);}};a.prototype.getFocusDomRef=function(){if(this.getEditable()){return this._oActionModeIcon&&this._oActionModeIcon.getFocusDomRef();}var p=this._oContent.findAggregatedObjects(true,function(c){return c.isA("sap.m.GenericTile")||c.isA("sap.f.Card");});if(p.length){return p[0].getFocusDomRef();}return this._oContent.getFocusDomRef();};a.prototype.onclick=function(e){if(this._preventDefault(e)){this.firePress({scope:"Display",action:"Press"});}else{var t=e.target.id;if(t.indexOf("action-remove")>-1){this.firePress({scope:"Actions",action:"Remove"});}else{this._onActionMenuIconPressed();}}};a.prototype.onBeforeRendering=function(){this._updateContent();var d=this.getDomRef();if(d){d.removeEventListener("keyup",this._fnKeyupHandler);d.removeEventListener("touchend",this._fnTouchendHandler);}};a.prototype.onAfterRendering=function(){var d=this.getDomRef();this._fnKeyupHandler=this.onkeyup.bind(this);this._fnTouchendHandler=this.onclick.bind(this);d.addEventListener("keyup",this._fnKeyupHandler,true);d.addEventListener("touchend",this._fnTouchendHandler,true);};a.prototype.onkeyup=function(e){if(this.getEditable()){if((P.events.sapdelete.fnCheck(e)||P.events.sapbackspace.fnCheck(e))){this.firePress({scope:"Actions",action:"Remove"});}if(P.events.sapspace.fnCheck(e)||P.events.sapenter.fnCheck(e)){this._preventDefault(e);}}};a.prototype._preventDefault=function(e){if(this.getEditable()){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();return false;}return true;};a.prototype.load=function(){return Promise.resolve();};a.prototype._setSize=function(){var s={};switch(this.getDisplayFormat()){case D.Flat:s.width=2;s.height=1;break;case D.FlatWide:s.width=4;s.height=1;break;case D.StandardWide:s.width=4;s.height=2;break;default:s=this._parseTileSize(this.getTileSize());break;}if(s){this.setWidth(s.width);this.setHeight(s.height);}};a.prototype._parseTileSize=function(t){if(!t){return null;}var s=t.split("x");var S={height:parseInt(s[0],10),width:parseInt(s[1],10)};if(!S.width||!S.height){return null;}S.width=S.width*2;S.height=S.height*2;return S;};a.prototype.getAvailableDisplayFormats=function(){var b,s=this.getSupportedDisplayFormats(),d=this.getDisplayFormat();b=s.filter(function(f){return f!==d;});var c=b.indexOf("compact");var t=this.getTitle();var e=this.getTargetURL();if(c>-1&&(!t||!e)){b.splice(c,1);}return b;};return a;});
