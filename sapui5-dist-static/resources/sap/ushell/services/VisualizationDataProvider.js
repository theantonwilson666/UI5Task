// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/resources","sap/base/util/ObjectPath"],function(r,O){"use strict";function V(){this.S_COMPONENT_NAME="sap.ushell.services.VisualizationDataProvider";this._init.apply(this,arguments);}V.prototype._init=function(l){this.oLaunchPageAdapter=l;this.oCatalogTilePromise=null;};V.prototype._getCatalogTileIndex=function(){if(this._oCatalogTileIndexPromise){return this._oCatalogTileIndexPromise;}var l=this.oLaunchPageAdapter;return l._getCatalogTileIndex();};V.prototype._getCatalogTiles=function(){if(this.oCatalogTilePromise){return this.oCatalogTilePromise;}var l=this.oLaunchPageAdapter;this.oCatalogTilePromise=new Promise(function(a,b){l.getCatalogs().then(function(c){var d=[];var C=[];var f=[];var o={};for(var i=0;i<c.length;i++){if(typeof c[i].ui2catalog==='undefined'||c[i].ui2catalog.getType()!=='REMOTE'){d.push(l.getCatalogTiles(c[i]).then(function(e){C.push(e);}));}}jQuery.when.apply(null,d).done(function(){f=[].concat.apply([],C);for(var y=0;y<f.length;y++){o[l.getCatalogTileId(f[y])]=f[y];}a(o);}).fail(b);}).fail(b);});return this.oCatalogTilePromise;};V.prototype.getVisualizationData=function(){var l=this.oLaunchPageAdapter,c;return Promise.all([this._getCatalogTiles(),this._getCatalogTileIndex()]).then(function(R){var C=R[0];var a=R[1];return Object.keys(C).reduce(function(v,i){c=C[i];var I=l.isTileIntentSupported(c);if(!I){return v;}v[i]={title:l.getCatalogTilePreviewTitle(c),subTitle:l.getCatalogTilePreviewSubtitle(c),icon:l.getCatalogTilePreviewIcon(c),info:l.getCatalogTilePreviewInfo(c),size:l.getCatalogTileSize(c),indicatorDataSource:l.getCatalogTilePreviewIndicatorDataSource(c),url:l.getCatalogTileTargetURL(c),numberUnit:l.getCatalogTileNumberUnit(c),isCustomTile:l.isCustomTile&&l.isCustomTile(c)};if(a[i]){v[i]._instantiationData={platform:"ABAP",chip:a[i],catalogTile:{baseChipId:c.getChip().getBaseChipId().replace(/\//g,"_"),contracts:{},configuration:{row:c.getConfigurationParameter("row"),col:c.getConfigurationParameter("col")}}};var t=c.getContract("types");if(t){O.set("catalogTile.contracts.types.availableTypes",t.getAvailableTypes(),v[i]._instantiationData);O.set("catalogTile.contracts.types.defaultType",t.getDefaultType(),v[i]._instantiationData);}}return v;},{});}).catch(function(e){var E={component:this.S_COMPONENT_NAME,description:r.i18n.getText("VisualizationDataProvider.CannotLoadData"),detail:e};return Promise.reject(E);}.bind(this));};V.hasNoAdapter=false;return V;});
