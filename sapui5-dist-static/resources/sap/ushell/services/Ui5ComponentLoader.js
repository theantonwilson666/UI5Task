// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils","sap/ushell/services/Ui5ComponentHandle","sap/ushell/services/_Ui5ComponentLoader/utils","sap/ushell/EventHub","sap/ui/thirdparty/jquery"],function(u,U,o,e,q){"use strict";function a(c,p,C){this._oConfig=(C&&C.config)||{};this.createComponent=function(A,P,w){var d=new q.Deferred(),t=this;this.createComponentData(A,P,w).then(function(D){t.instantiateComponent(D).then(d.resolve,d.reject);},function(){d.resolve(A);});return d.promise();};this.createComponentData=function(A,P,w){var t=this;return new Promise(function(r,R){var d={},b=A||{},l=o.shouldLoadCoreExt(b),f=o.shouldUseAmendedLoading(t._oConfig),L=o.shouldLoadDefaultDependencies(b,t._oConfig,f),n=u.getParameterValueBoolean("sap-ushell-nocb"),g=b.applicationDependencies||{};o.logAnyApplicationDependenciesMessages(g.name,g.messages);if(!b.ui5ComponentName){R();return;}delete b.loadCoreExt;delete b.loadDefaultDependencies;var h=o.createComponentData(b.componentData||{},b.url,b.applicationConfiguration,b.reservedParameters);if(b.getExtensions){h.getExtensions=b.getExtensions;delete b.getExtensions;}if(b.oPostMessageInterface){h.oPostMessageInterface=b.oPostMessageInterface;delete b.oPostMessageInterface;}var s=o.constructAppComponentId(P||{}),i=l&&f,j=o.prepareBundle(t._oConfig.coreResourcesComplement),k=o.createComponentProperties(i,L,n,w,b.applicationDependencies||{},b.ui5ComponentName,b.url,s,j);d.componentData=h;d.componentProperties=k;d.appPropertiesSafe=b;d.loadCoreExt=l;r(d);});};this.instantiateComponent=function(d){var b=d.componentProperties,f=d.componentData,A=d.appPropertiesSafe,l=d.loadCoreExt;U.onBeforeApplicationInstanceCreated.call(null,b);var D=new q.Deferred();o.createUi5Component(b,f).then(function(g){var h=new U(g);A.componentHandle=h;var i=l;if(i){A.coreResourcesFullyLoaded=i;e.emit("CoreResourcesComplementLoaded",{status:"success"});}D.resolve(A);},function(E){var s=JSON.stringify(b,null,4);o.logInstantiateComponentError(b.name,E+"",E.status,E.stack,s);D.reject(E);});return D.promise();};this.loadCoreResourcesComplement=function(){if(this.loadCoreResourcesComplementPromise){return this.loadCoreResourcesComplementPromise.promise();}var b=o.prepareBundle(this._oConfig.coreResourcesComplement),d=new q.Deferred();o.loadBundle(b).done(function(){e.emit("CoreResourcesComplementLoaded",{status:"success"});this.loadCoreResourcesComplementPromise=d;d.resolve();}.bind(this)).fail(function(){e.emit("CoreResourcesComplementLoaded",{status:"failed"});d.reject();});return d.promise();};e.once("loadCoreResourcesComplement").do(function(){this.loadCoreResourcesComplement();}.bind(this));}a.hasNoAdapter=true;return a;},true);
