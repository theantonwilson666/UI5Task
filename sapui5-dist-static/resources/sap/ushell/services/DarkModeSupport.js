// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/UriParameters","sap/ui/Device","sap/ushell/Config","sap/ushell/EventHub"],function(L,U,D,C,E){"use strict";var P="(prefers-color-scheme: dark)";function a(){this.channel=E.createChannel({"mode":undefined});this.darkMediaQueryList=window.matchMedia(P);this.doables=[];this.themeChangedCallback=null;this.darkMediaQueryListListener=null;}a.Mode={LIGHT:"light",DARK:"dark"};a.prototype.setup=function(){if(this.initialized){return;}this.initialized=true;this.themeChangedCallback=function(){this.channel.emit("/mode",this.getCurrentThemeMode());}.bind(this);sap.ui.getCore().attachThemeChanged(this.themeChangedCallback);this.themeChangedCallback();if(this.canAutomaticallyToggleDarkMode()){this.enableDarkModeBasedOnSystem();}};a.prototype.destroy=function(){this.channel.emit("/mode",null);this.doables.forEach(function(d){d.off();});this.doables=[];if(this.initialized){sap.ui.getCore().detachThemeChanged(this.themeChangedCallback);this.themeChangedCallback=null;this.disableDarkModeBasedOnSystem();this.initialized=false;}};a.prototype.attachModeChanged=function(c){var d=this.channel.on("/mode").do(function(m){c(m);});this.doables.push(d);};a.prototype.canAutomaticallyToggleDarkMode=function(){var i=this.darkMediaQueryList.media===P;return i&&!U.fromURL(window.location.href).has("sap-theme");};a.prototype.isThemeSupportDarkMode=function(t){t=t||this._getCurrentTheme();return!!this._findSupportedThemePair(t);};a.prototype._toggleDarkModeBasedOnSystemColorScheme=function(){var c=this._getCurrentTheme();if(this.darkMediaQueryList&&this.isThemeSupportDarkMode(c)){var s=this._findSupportedThemePair(c),i=this.darkMediaQueryList.matches;var t=i?s.dark:s.light;sap.ushell.Container.getUser().applyTheme(t);}};a.prototype._applyDefaultUserTheme=function(){var u=sap.ushell.Container.getUser();if(u.constants&&u.constants.themeFormat){u.applyTheme(u.getTheme(u.constants.themeFormat.ORIGINAL_THEME));}};a.prototype.toggleModeChange=function(){var c=this._getCurrentTheme(),s=this._findSupportedThemePair(c);if(s){var t=c===s.light?s.dark:s.light;sap.ushell.Container.getUser().applyTheme(t);}};a.prototype.enableDarkModeBasedOnSystem=function(){if(!this.initialized){L.warning("Automatic dark mode detection cannot be enabled, because the DarkModeSupport sevice was not setup.");return;}if(!this.canAutomaticallyToggleDarkMode()){L.warning("Automatic dark mode detection cannot be enabled, because your browser does not support dark mode detection");return;}if(this.darkMediaQueryListListener){L.warning("Automatic dark mode detection was already enabled");return;}if(D.support.matchmedialistener){this.darkMediaQueryListListener=this._toggleDarkModeBasedOnSystemColorScheme.bind(this);this.darkMediaQueryList.addListener(this.darkMediaQueryListListener);}this._toggleDarkModeBasedOnSystemColorScheme();};a.prototype.disableDarkModeBasedOnSystem=function(){if(this.darkMediaQueryListListener){this.darkMediaQueryList.removeListener(this.darkMediaQueryListListener);this.darkMediaQueryListListener=null;}this._applyDefaultUserTheme();};a.prototype.getCurrentThemeMode=function(){var c=this._getCurrentTheme(),s=this._findSupportedThemePair(c);if(s){return c===s.light?a.Mode.LIGHT:a.Mode.DARK;}return null;};a.prototype._getCurrentTheme=function(){return sap.ui.getCore().getConfiguration().getTheme();};a.prototype._findSupportedThemePair=function(c){var s=C.last("/core/darkMode/supportedThemes");return s.filter(function(S){return S.dark===c||S.light===c;})[0];};a.hasNoAdapter=true;return a;},true);
