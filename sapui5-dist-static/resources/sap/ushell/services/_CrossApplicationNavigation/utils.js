// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/ObjectPath"],function(O){"use strict";var U={};U.extractGetLinksParameterOptions=function(g){return U.parseGetLinksParameters(g).filter(function(p){return Object.keys(p.options).length>0;}).map(function(p){return{name:p.name,options:p.options};});};U.extractGetLinksParameterDefinition=function(g){return U.parseGetLinksParameters(g).reduce(function(r,p){r[p.name]=p.value;return r;},{});};U.parseGetLinksParameters=function(g){if(Object.prototype.toString.apply(g)!=="[object Object]"){return[];}var p=JSON.parse(JSON.stringify(g));return Object.keys(p).map(function(P){var v=p[P];var o={};if(Object.prototype.toString.apply(v)==="[object Object]"){v=v.value;delete p[P].value;o=p[P];}return{name:P,value:v,options:o};});};U.safeParseToObject=function(o){try{return JSON.parse(o);}catch(e){jQuery.sap.log.error("Cannot parse the given string to object",o,"sap.ushell.services.CrossApplicationNavigation");}return null;};U.createAppStateFromData=function(d){var a=sap.ushell.Container.getService("AppState");var A=a.createEmptyAppState(null);A.setData(d);A.save();return A.getKey();};U.extractParameter=function(i,p){var I,P=null,u;if(typeof i==="string"){if(i.indexOf(p+"=")===-1){return{intent:i,data:null};}u=sap.ushell.Container.getService("URLParsing");var o=u.parseShellHash(i);if(!o){return{intent:i,data:null};}P=o.params[p];delete o.params[p];I=u.constructShellHash(o);return{intent:I,data:P};}if(Object.prototype.toString.apply(i)==="[object Object]"){var s=O.get("target.shellHash",i);if(typeof s==="string"){var r=U.extractParameter(s,p);i.target.shellHash=r.intent;return{intent:i,data:r.data};}var a=i.params;if(a&&a[p]){P=typeof a[p]==="string"?[a[p]]:a[p];delete a[p];}return{intent:i,data:P};}jQuery.sap.log.error("Invalid input parameter","expected string or object","sap.ushell.services.CrossApplicationNavigation");return{intent:i};};U.addXAppStateFromParameter=function(i,s){var I,x,a,X,A;x=U.extractParameter(i,s);I=x.intent;X=x.data&&x.data[0];if(!X){return;}a=U.safeParseToObject(X);if(!a){return;}A=U.createAppStateFromData(a);U.injectParameter(I,"sap-xapp-state",A);};U.injectParameter=function(i,p,P){if(typeof i==="string"){var u=sap.ushell.Container.getService("URLParsing");var o=u.parseShellHash(i);o.params[p]=P;return u.constructShellHash(o);}if(Object.prototype.toString.apply(i)==="[object Object]"){var s=O.get("target.shellHash",i);if(typeof s==="string"){i.target.shellHash=U.injectParameter(s,p,P);return i;}if(!i.params){i.params={};}i.params[p]=P;}return i;};U._injectParameters=function(p){var P=p.inject,i=(p.injectEmptyString||{}),t=p.type,a=p.args;function s(v,I){return(v||(v===""&&I));}if(t.isPlainObject(a)){if(a.target&&a.target.shellHash){if(typeof a.target.shellHash==="string"){a.target.shellHash=U._injectParameters({inject:P,injectEmptyString:i,type:p.type,args:a.target.shellHash});}return a;}var n=Object.keys(P).reduce(function(I,b){var v=P[b],c=(i[b]===true);if(s(v,c)&&typeof I==="string"){var r=new RegExp("[&]"+b);var h=!r.test(I);if(h){var d=I?"&":"";I+=d+b+"="+v;}}else if(s(v,c)&&!I.hasOwnProperty(b)){I[b]=v;}return I;},a.params||{});if(n&&Object.keys(n).length>0){a.params=n;}return a;}var S=a;if(S){Object.keys(P).forEach(function(b){var v=P[b];var I=(i[b]===true);var r=new RegExp("[?&]"+b);var h=!r.test(S);if(s(v,I)&&h){var c=S.indexOf("?")>-1?"&":"?";S+=c+b+"="+v;}});}return S;};U._injectStickyParameters=function(p){var a=sap.ushell.Container.getService("AppLifeCycle");if(!a||Object.keys(a).length<=0){return p.args;}var c=a.getCurrentApplication();if(!c||Object.keys(c).length<=0){return p.args;}var A=p.appLifeCycle;var t=p.technicalParameters;var s=t.getParameters({sticky:true}).reduce(function(S,n){var N=n.name;var C=c.componentInstance;var b=c.applicationType;var d;if(b==="UI5"){d={};}else{d=A.getCurrentApplication().container;}var e=t.getParameterValueSync(N,C,d,b);var f=n.stickyName||N;S[f]=e;return S;},{});var o={type:p.type,inject:s,args:p.args};return U._injectParameters(o);};return U;});
