// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/URI","sap/ui/thirdparty/URITemplate","sap/ushell/utils/type","sap/ushell/utils/clone","sap/ushell/_URLTemplateProcessor/utils","sap/ushell/_URLTemplateProcessor/Resolvers","sap/ushell/_URLTemplateProcessor/DependencyGraph","sap/ushell/_URLTemplateProcessor/TemplateParameterParser","sap/ushell/_URLTemplateProcessor/DefinitionParameterSetBuilder","sap/base/Log"],function(U,u,t,c,o,r,d,T,D,L){"use strict";function l(s){L.debug(s,"sap.ushell.URLTemplateProcessor");}function f(v){if(typeof v==="undefined"){return"<undefined>";}if(typeof v==="string"){if(v===""){return"<empty string>";}return"'"+v+"'";}if(typeof v==="number"){return"(number) "+v;}if(typeof v==="boolean"){return"(bool) "+v;}var s;if(typeof v==="object"){s=JSON.stringify(v);if(s.length>255){s=s.substr(0,255)+"...";}}else{s="{other type}";}return s;}function e(p){var P=Object.keys(p).filter(function(s){return typeof p[s]==="object"&&(p[s].hasOwnProperty("renameTo"));});var O=[];P.forEach(function(s){var b=p[s];if(b.hasOwnProperty("renameTo")){O.push(function(g,h){var R=h;R=h.replace(new RegExp(s+"=","g"),b.renameTo+"=");return R;});}});return O;}function a(b,s,R,A,g){l("[TEMPLATE EXPANSION] "+b.urlTemplate);var h=D.buildDefinitionParameterSet(b.parameters,s,g)||{};var i=o.removeArrayParameterNotation(R[g]||{});var j=T.parseTemplateParameterSet(h,g);var k=T.parseTemplateParameterSetAsLiterals(i);var p=o.mergeObject(k,j);l("- parsed template parameters: "+JSON.stringify(p,null,3));var G=d.buildDependencyGraph(p);l("- created dependency graph: "+JSON.stringify(G,null,3));var m=d.getDependencyResolutionOrder(G);l("- resolving in order: "+m.join(" > "));var n=r.resolveAllParameters(p,m,s,R,A,g);Object.keys(n).forEach(function(w){var x=n[w];l(w+" --> "+f(x));});var P=e(h||{});var q=b.urlTemplate;var v=U.expand(q,n).toString();l("- created URL: "+v);P.forEach(function(O){v=O(q,v);});if(P.length>0){l("- created URL (post expansion): "+v);}return v;}return{expand:a};},false);
