// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Component","sap/ushell/appRuntime/ui5/plugins/baseRta/Renderer","sap/ushell/appRuntime/ui5/plugins/baseRta/AppLifeCycleUtils"],function(C,R,A){"use strict";var p;var F="sapUiRtaFioriHeaderInvisible";function g(){return{sComponentName:"sap.ushell.appRuntime.ui5.plugins.rtaShell",layer:"CUSTOMER",id:"RTA_AppRuntime_Plugin_ActionButton",text:"RTA_BUTTON_TEXT",icon:"sap-icon://wrench",visible:false};}function s(f,v){if(f){if(v){f.removeStyleClass(F);}else{f.addStyleClass(F);}}}function a(f){return new Promise(function(r,b){s(f,false);p.postMessageToApp("user.postapi.rtaPlugin","startUIAdaptation").done(r).fail(b);});}return C.extend("sap.ushell.appRuntime.ui5.plugins.rtaShell.Component",{metadata:{manifest:"json"},init:function(){this.mConfig=g();p=this.getComponentData().oPostMessageInterface;this._registerPostMessages();},_registerPostMessages:function(){p.registerPostMessageAPIs({"user.postapi.rtaPlugin":{inCalls:{activatePlugin:{executeServiceCallFn:function(){return p.createPostMessageResult(this._initPlugin());}.bind(this)},showAdaptUI:{executeServiceCallFn:function(){this._changeActionButtonVisibility(true);return p.createPostMessageResult();}.bind(this)},switchToolbarVisibility:{executeServiceCallFn:function(S){var v=S.oMessageData.body.visible;s(this._oFioriHeader,v);return p.createPostMessageResult();}.bind(this)}},outCalls:{startUIAdaptation:{}}}});},_initPlugin:function(){if(this.bIsInitialized){return new jQuery.Deferred().resolve();}this.bIsInitialized=true;this.mConfig.i18n=this.getModel("i18n").getResourceBundle();return new jQuery.Deferred(function(d){R.getRenderer(this).then(function(r){this.oRenderer=r;this._oFioriHeader=this.oRenderer&&this.oRenderer.getRootControl&&this.oRenderer.getRootControl().getOUnifiedShell().getHeader();}.bind(this)).then(function(){return R.createActionButton(this,a.bind(undefined,this._oFioriHeader),this.mConfig.visible);}.bind(this)).then(function(){var o=A.getAppLifeCycleService();o.attachAppLoaded(this._onAppLoaded,this);}.bind(this)).catch(function(e){this.bIsInitialized=false;return Promise.reject(e);}.bind(this)).then(d.resolve,d.reject);}.bind(this)).promise();},_changeActionButtonVisibility:function(v){var c=sap.ui.getCore().byId(this.mConfig.id);if(c){c.setVisible(v);}},_onAppLoaded:function(){this._changeActionButtonVisibility(false);},exit:function(){if(this._oFioriHeader){this._oFioriHeader.removeStyleClass(F);}var o=A.getAppLifeCycleService();o.detachAppLoaded(this._onAppLoaded,this);if(this._onRendererCreated){var c=A.getContainer();c.detachRendererCreatedEvent(this._onRendererCreated,this);}}});});
