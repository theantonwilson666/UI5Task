// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/components/applicationIntegration/elements/model","sap/ushell/components/applicationIntegration/Storage","sap/ushell/components/applicationIntegration/application/BlueBoxHandler","sap/ushell/ui5service/ShellUIService","sap/ushell/components/applicationIntegration/application/Application","sap/ushell/components/applicationIntegration/relatedServices/RelatedServices","sap/ushell/components/applicationIntegration/relatedShellElements/RelatedShellElements","sap/ushell/components/applicationIntegration/configuration/AppMeta","sap/ushell/services/AppConfiguration","sap/ushell/utils","sap/ui/Device","sap/ushell/Config","sap/ushell/ui5service/AppIsolationService","sap/ushell/ApplicationType","sap/ushell/components/applicationIntegration/DelegationBootstrap","sap/base/util/UriParameters","sap/ui/thirdparty/jquery","sap/base/Log","sap/base/util/ObjectPath"],function(E,S,B,a,A,R,b,c,d,u,D,C,f,g,h,U,q,L,O){"use strict";function i(){var v,j=["URL"],r,s,k,I={},o,l=false,m={},n={home:{embedded:"embedded-home",headerless:"headerless-home",merged:"blank-home",blank:"blank-home"},app:{minimal:"minimal",app:"app",standalone:"standalone",embedded:"embedded",headerless:"headerless",merged:"merged",home:"home",blank:"blank",lean:"lean"}},p,G=[],t={},w=false,K={FULL:"true",RESTRICTED:"restricted"};this.shellElements=function(){return b;};this.service=function(){return R;};this.isCurrentApp=function(e){return(m.appId===e);};this.isAppWithSimilarShellHashInCache=function(e,F){var x=S.get(e);if(x){if(x.shellHash===F){return true;}return false;}return false;};this.isAppInCache=function(e){return!!S.get(e);};this.normalizeAppId=function(e){var x="-component",y=e.endsWith(x);if(y){return e.substring(0,e.length-x.length);}return e;};this.onComponentCreated=function(e,x,y){var z=y.component,F=this.normalizeAppId(z.getId());if(this.isAppInCache(F)){S.get(F).app=z;this.active(F);}else{m.app=z;if(z.active){z.active();}}};this.onGetMe=function(e,x,y){y.AppLifeCycle=this;};this.store=function(e){var x=S.get(e);if(x){A.store(x.app);R.store(x.service);c.store(x.meta);}};this.destroy=function(e,F,x,y){var z=S.get(e),H;function J(){A.destroy(F);b.destroy(F);c.destroy(F);}if(y===undefined){y=false;}this.removeControl(e,y);if(z){H=B.getStateFul(F.getUrl());if(H&&B.isStatefulContainerSupported(H)&&y===false){var M=B.getHandler();M.destroy(H,e);}else{z.container.destroy();B.deleteStateFul(F.getUrl());}S.remove(e);if(x){x.resolve();}}else{var P=F&&F.sendBeforeAppCloseEvent&&F.sendBeforeAppCloseEvent();if(P===undefined){J();if(x){x.resolve();}}else{P.then(function(){J();if(x){x.resolve();}},function(N){J();if(x){x.resolve();}q.sap.log.error("FLP got a failed response from the iframe for the 'sap.ushell.services.CrossApplicationNavigation.beforeAppCloseEvent' message sent",N,"sap.ushell.components.applicationIntegration.AppLifeCycle.js");});}}};this.restore=function(e){var x=S.get(e);if(x){A.restore(x.app);R.restore(x.service);c.restore(x.meta);}};this.active=function(e){var x=S.get(e);if(x){A.active(x.app);}};this.handleExitStateful=function(F,e){var x,H=B.getHandler();if(S.get(F)){x=B.getStorageKey(e);if(x&&B.isKeepAliveSupported(e)){return H.store(e,x);}return Promise.resolve();}return H.destroy(e);};this.handleExitApplication=function(F,e,T,x,y){var z=this,H,P,J;if(F&&e){if(e.getUrl()&&B.isStatefulContainerSupported(B.getStateFul(e.getUrl()))){P=this.handleExitStateful(F,e);}else if(S.get(F)){this.store(F);sap.ui.getCore().getEventBus().publish("sap.ushell","appClosed",e);}else if((e.getIsStateful&&e.getIsStateful())||(e.getApplicationType&&this.applicationIsStatefulType(e.getApplicationType()))){if(y){P=e.postMessageRequest("sap.gui.triggerCloseSessionImmediately");}}else{H=j.indexOf(e.getApplicationType)>=0;if(this.isAppOfTypeCached(F,H)===false){J=new q.Deferred();this.destroy(F,e,J);P=J.promise();}}if(y===true){if(P===undefined){this.closeKeepAliveRestrictedApps();}else{P.then(function(){z.closeKeepAliveRestrictedApps();});}}if(F.indexOf("Shell-appfinder-component")>0){sap.ui.getCore().getEventBus().publish("sap.ushell","appFinderAfterNavigate");}}};this.closeKeepAliveRestrictedApps=function(){try{var x=this,y=[];S.forEach(function(z){if(z.value.keepAliveMode===K.RESTRICTED){y.push(z.value);}});y.forEach(function(z){x.destroy(z.appId,z.container,undefined,true);});}catch(e){L.error("Error: sap.ushell.services.appLifeCycle.closeOtherKeepAliveRestrictedApps:"+e);}};this.onAfterNavigate=function(F,e,T,x){var y=T.indexOf("Shell-appfinder-component")>0||T.indexOf("Shell-home-component")>0||T.indexOf("pages-component-container")>0;this.handleExitApplication(F,e,T,x,y);if(y===true){A.setActiveAppContainer(undefined);}if(T){if(S.get(T)){this.restore(T);}else{}}};this.storeApp=function(e,x,T,F,y){if(!this.isAppInCache(e)){S.set(e,{service:R.create(),shellHash:F,appId:e,stt:"loading",appRelatedElements:b.getAppRelatedElement(),container:x,meta:d.getMetadata(T),app:undefined,keepAliveMode:y&&(y.globalValue||y.paramValue)});I[F]=e;B.setStorageKey(x,e);return true;}return false;};this.restoreApp=function(e){if(this.isAppInCache(e)){m=S.get(e);if(B.getStorageKey(m.container)){B.setStorageKey(m.container,e);}}};this.isAppOfTypeCached=function(e,x,y){var z;if(!l&&e.indexOf(r)!==-1){return true;}if(!l&&e.indexOf("Shell-appfinder")!==-1){return true;}z=new U(window.location.href).get("sap-keep-alive");if(z===K.FULL||z===K.RESTRICTED){if(y){y.globalValue=z;}return true;}return false;};this.isCachedEnabledAsAppParameter=function(e,T,x){var y;y=e&&e.params&&e.params["sap-keep-alive"];if(y===K.FULL||y===K.RESTRICTED){if(x){x.paramValue=y;}return true;}if(T&&T.url){y=new U(T.url).get("sap-keep-alive");if(y===K.FULL||y===K.RESTRICTED){if(x){x.paramValue=y;}return true;}}return false;};i.prototype._getURLParsing=function(){if(!this._oURLParsing){this._oURLParsing=sap.ushell.Container.getService("URLParsing");}return this._oURLParsing;};this.calculateAppType=function(T){if(T.applicationType==="URL"&&T.additionalInformation&&T.additionalInformation.startsWith("SAPUI5.Component=")){return"SAPUI5";}return T.applicationType;};this.getStatefulCapabilities=function(T){if(T.appCapabilities&&T.appCapabilities&&T.appCapabilities.statefulContainer){return T.appCapabilities.statefulContainer;}return undefined;};this.isNotifyInnerAppRouteChangeEnabled=function(T){if(T.appCapabilities&&T.appCapabilities.notifyInnerAppRouteChange){return true;}return false;};this.isStatefulCapabilityEnabled=function(T){var e=this.getStatefulCapabilities(T);if(e&&(e.enabled===true||e===true)){return true;}return false;};this.isGUICapabilityEnabled=function(T){var e=this.getStatefulCapabilities(T);if(e&&e.protocol==="GUI"){return true;}return false;};this.isFLPCapabilityEnabled=function(T){return!this.isGUICapabilityEnabled(T)&&this.isStatefulCapabilityEnabled(T);};this.isGUIStatefulCapabilityEnabled=function(T){return this.isGUICapabilityEnabled(T)&&this.isStatefulCapabilityEnabled(T);};this.openApp=function(e,T,x,F){var y,z,H=j.indexOf(T.applicationType)>=0,J,M,N={globalValue:undefined,paramValue:undefined};var P="application"+e;y=B.getStateFul(T.url);if(y&&B.isStatefulContainerSupported(y)){if(this.isAppOfTypeCached(P,H,N)||this.isCachedEnabledAsAppParameter(x,T,N)){if(!this.isAppInCache(P)){this.storeApp(P,y,T,F,N);}this.restoreApp(P);}else{m={appId:P,stt:"loading",container:y,meta:d.getMetadata(T),app:undefined};}}else if(this.isAppOfTypeCached(P,H,N)||this.isCachedEnabledAsAppParameter(x,T,N)){if(!this.isAppInCache(P)){y=this.createApplicationContainer(e,T);this.storeApp(P,y,T,F,N);B.set(T.url,y);}this.restoreApp(P);}else if(this.applicationIsStatefulType(T.applicationType)||B.isCapByTarget(T,"isGUIStateful")){y=this.getStatefulContainer(T.applicationType);if(!y){y=this.createApplicationContainer(e,T);this.setStatefulContainer(T.applicationType,y);y.setIsStateful(true);}m={appId:P,stt:"loading",container:y,meta:d.getMetadata(T),app:undefined};}else{if(y){z=x.semanticObject+"-"+x.action;this.removeApplication(z);}else if(T.applicationType==="URL"||T.applicationType==="TR"){z=x.semanticObject+"-"+x.action;J=B.getById("application-"+z);if(J){M=J.getUrl();B.removeCapabilities(J);this.destroy("application-"+z,J);B.deleteStateFul(M);}}y=this.createApplicationContainer(e,T);B.set(T.url,y);if(B.isCapUT(y,"isFLP")){B.setCapabilities(y,[{service:"sap.ushell.services.appLifeCycle",action:"create"},{service:"sap.ushell.services.appLifeCycle",action:"destroy"}]);}m={appId:P,stt:"loading",container:y,meta:d.getMetadata(T),app:undefined};}};this.getAppMeta=function(){return c;};this.evict=function(e){var x,y=e.value,z=e.key;this.removeControl(z);if(y.container.getUrl&&y.container.getUrl()){x=B.getStateFul(y.container.getUrl());}if(x){var H=B.getHandler();H.destroy(x,z);}else{y.container.destroy();}};this.init=function(e,x,y,z,F,H,J){var M=this,N;if(D.system.phone){N=10;if(J&&J.limit&&J.limit.phone){N=J.limit.phone;}}else if(D.system.tablet){N=10;if(J&&J.limit&&J.limit.tablet){N=J.limit.tablet;}}else if(D.system.desktop){N=15;if(J&&J.limit&&J.limit.desktop){N=J.limit.desktop;}}else{N=10;}h.init(this.registerShellCommunicationHandler,this.postMessageToIframeApp);h.bootstrap();s=new a({scopeObject:F.ownerComponent,scopeType:"component"});o=new f({scopeObject:F.ownerComponent,scopeType:"component"});k=e;v=x;r=y;c.init(r);l=z;B.init({oShellUIService:s,oAppIsolationService:o},J,this);S.init(N,function(Q){this.evict(Q);}.bind(this));this.registerShellCommunicationHandler({"sap.ushell.services.appLifeCycle":{oRequestCalls:{"create":{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(Q){Q.then(function(T){L.info("sap.ushell.services.appLifeCycle.create:"+T);}).catch(function(T){L.error("Error: sap.ushell.services.appLifeCycle.create:"+T);});}},"destroy":{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(Q){Q.then(function(T){L.info("sap.ushell.services.appLifeCycle.destroy:"+T);}).catch(function(T){L.error("Error: sap.ushell.services.appLifeCycle.destroy:"+T);});}},"store":{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(Q){Q.then(function(T){L.info("sap.ushell.services.appLifeCycle.store:"+T);}).catch(function(T){L.error("Error: sap.ushell.services.appLifeCycle.store:"+T);});}},"restore":{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(Q){Q.then(function(T){L.info("sap.ushell.services.appLifeCycle.restore:"+T);}).catch(function(T){L.error("Error: sap.ushell.services.appLifeCycle.restore:"+T);});}}},oServiceCalls:{"subscribe":{executeServiceCallFn:function(Q){B.mapCapabilities(Q.oContainer,Q.oMessageData.body);return new q.Deferred().resolve({}).promise();}},"setup":{executeServiceCallFn:function(Q){var T=Q.oMessageData&&Q.oMessageData.body,V=[];if(T){if(T.isStateful===true){V.push({"action":"create","service":"sap.ushell.services.appLifeCycle"});V.push({"action":"destroy","service":"sap.ushell.services.appLifeCycle"});}if(T.session&&T.session.bLogoutSupport===true){V.push({"action":"logout","service":"sap.ushell.sessionHandler"});}if(V.length>0){B.mapCapabilities(Q.oContainer,V);}}return new q.Deferred().resolve().promise();}}}}});this.registerShellCommunicationHandler({"sap.ushell.eventDelegation":{oRequestCalls:{"registerEventHandler":{isActiveOnly:false,distributionType:["URL"]}},oServiceCalls:{"registerEventHandler":{executeServiceCallFn:function(Q){var T=P(Q);return new q.Deferred().resolve(T).promise();}}}}});function P(Q){var T=Q.oMessageData.body.eventSerObj;return M.registerEventHandler(T);}sap.ui.getCore().getEventBus().subscribe("sap.ushell","appComponentLoaded",this.onComponentCreated,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell","getAppLifeCycle",this.onGetMe,this);b.init(this.getElementsModel(),H);};this.addControl=function(e){v.addCenterViewPort(e);};this.removeControl=function(e,F){var x=B.getById(e),y=B.isStatefulContainerSupported(x);if(!y||F){v.removeCenterViewPort(e,true);}};this.removeApplication=function(e){var x=this.getControl(e);if(x){this.removeControl(x.getId());x.destroy();}};this.getControl=function(e){return v&&(v.getViewPortControl("centerViewPort","application-"+e)||v.getViewPortControl("centerViewPort","applicationShellPage-"+e));};this.getViewPortContainer=function(){return v;};this.navTo=function(e){v.navTo("centerViewPort",e,"show");};this.getCurrentApplication=function(){return m;};this.setApplicationFullWidth=function(e){var x=this.getCurrentApplication();if(x.container){x.container.toggleStyleClass("sapUShellApplicationContainerLimitedWidth",!e);}};this.createComponent=function(e,P){this.shellElements().setDangling(true);return A.createComponent(e,P);};this.getAppContainer=function(e,x,y,z,F){x.shellUIService=s.getInterface();x.appIsolationService=o.getInterface();x.targetNavigationMode=y?"explace":"inplace";this.openApp(e,x,z,F);if(G.length>0){m.container.registerShellCommunicationHandler(G);}if(t.UI5APP){m.container.setIframeHandlers(t.UI5APP);}return m.container;};this.getShellUIService=function(){return s;};this.getAppIsolationService=function(){return o;};this.initShellUIService=function(e){s._attachHierarchyChanged(c.onHierarchyChange.bind(this));s._attachTitleChanged(c.onTitleChange.bind(this));s._attachRelatedAppsChanged(c.onRelatedAppsChange.bind(this));s._attachBackNavigationChanged(e.fnOnBackNavigationChange.bind(this));};this.parseStatefulContainerConfiguration=function(e){var x={};if(new U(document.URL).get("sap-guitest")==="true"){e=undefined;}if(e){var y={"GUI":true};Object.keys(e).filter(function(z){return e[z]===true&&y[z];}).map(function(z){var F=z;if(F==="GUI"){F="TR";}return F;}).forEach(function(z){x[z]=null;});}p=x;};this.setStatefulApplicationContainer=function(e){if(new U(document.URL).get("sap-guitest")==="true"){return;}p=e;};this.getStatefulApplicationContainer=function(){return p;};this.applicationIsStatefulType=function(e){if(new U(document.URL).get("sap-guitest")==="true"){return false;}return p.hasOwnProperty(e);};this.getStatefulContainer=function(e){return p[e];};this.setStatefulContainer=function(e,x){if(new U(document.URL).get("sap-guitest")==="true"){return;}p[e]=x;};this.statefulContainerForTypeExists=function(e){return!!this.getStatefulContainer(e);};this.getAllApplicationContainers=function(){return Object.keys(p).map(function(e){return p[e];}).filter(function(e){return!!e;});};this.getElementsModel=function(){return E;};this.activeContainer=function(x){var y=this.getAllApplicationContainers();y.forEach(function(e){L.info("Deactivating container "+e.getId());e.setActive(false);});B.forEach(function(z){if(z&&z!==x){try{L.info("Deactivating container "+z.getId());z.setActive(false);}catch(e){}}});if(x){L.info("Activating container "+x.getId());x.setActive(true);}};this.showApplicationContainer=function(e){this.navTo(e.getId());e.toggleStyleClass("hidden",false);A.setActiveAppContainer(e);L.info("New application context opened successfully in an existing transaction UI session.");};this.reuseStateFulContainerAndRestore=function(e,T,H,F,x){var y=this,z=I[F];if(B.getStorageKey(e)){B.setStorageKey(e,z);}return H.restore(e,z,x).then(function(){y.showApplicationContainer(e);},function(J){L.error(J&&J.message||J);});};this.reuseStateFulContainer=function(e,x,T,H,F,y){var z=this;I[F]=T;if(B.getStorageKey(e)){B.setStorageKey(e,T);}this.initAppMetaParams();return H.create(e,x,T,y).then(function(){z.showApplicationContainer(e);},function(J){L.error(J&&J.message||J);});};this.initAppMetaParams=function(){if(!this.getAppMeta().getIsHierarchyChanged()){s.setHierarchy();}if(!this.getAppMeta().getIsTitleChanged()){s.setTitle();}if(!this.getAppMeta().getIsRelatedAppsChanged()){s.setRelatedApps();}if(!w){s.setBackNavigation();}};this.reuseApplicationContainer=function(e,x,y){var z=this;return e.setNewApplicationContext(x,y).then(function(){z.navTo(e.getId());e.toggleStyleClass("hidden",false);L.info("New application context opened successfully in an existing transaction UI session.");},function(F){L.error(F&&F.message||F);});};this.createApplicationContainer=function(e,x){return A.createApplicationContainer(e,x);};this.publishNavigationStateEvents=function(e,x,y){var z,F=e.getId?e.getId():"",H=this;var J=d.getMetadata(),M=J.icon,T=J.title;e.addEventDelegate({onAfterRendering:y});z=e.exit;e.exit=function(){if(z){z.apply(this,arguments);}H.getAppMeta()._applyContentDensityByPriority();setTimeout(function(){var N=q.extend(true,{},x);delete N.componentHandle;N.appId=F;N.usageIcon=M;N.usageTitle=T;sap.ui.getCore().getEventBus().publish("sap.ushell","appClosed",N);L.info("app was closed");},0);var P=H._publicEventDataFromResolutionResult(x);sap.ushell.renderers.fiori2.utils.publishExternalEvent("appClosed",P);};};this._publicEventDataFromResolutionResult=function(e){var P={};if(!e){return e;}["applicationType","ui5ComponentName","url","additionalInformation","text"].forEach(function(x){P[x]=e[x];});Object.freeze(P);return P;};this.getInMemoryInstance=function(e,F,x,y){var z="application-"+e,H=S.get(z);var N=(y==="Shell-home"&&(typeof x==="string"&&x.length>0));if(H){if(H.shellHash===F&&!N){return{isInstanceSupported:true,appId:H.appId,container:H.container};}return{isInstanceSupported:false,appId:H.appId,container:H.container};}return{isInstanceSupported:false,appId:undefined,container:undefined};};this.handleOpenStateful=function(e,x,T,y,z,F,H){var J=B.getHandler();if(S.get(T)&&e===false){this.reuseStateFulContainerAndRestore(y,T,J,F,z);}else{this.reuseStateFulContainer(y,z.url,T,J,F,z);if(x){if(!this.isAppInCache(T)){this.storeApp(T,y,z,F,H);}}}};this.leave=function(e,x){var y=B.isStatefulContainerSupported(e);if(y){return this.handleExitStateful(x,e);}return Promise.resolve();};this.open=function(e,x,y,T,W,F,M){var z=this,H,J=this.statefulContainerForTypeExists(T.applicationType),N,P=j.indexOf(T.applicationType)>=0,Q="application-"+e,V,X,Y,Z=false,$,_,a1,b1=new q.Deferred(),c1,d1={globalValue:undefined,paramValue:undefined};X=this.isAppOfTypeCached(Q,P,d1)||this.isCachedEnabledAsAppParameter(y,T,d1);Y=this.calculateAppType(T);$=g.getDefaultFullWidthSetting(Y);H=B.getStateFul(T.url);N=B.isStatefulContainerSupported(H);if(!N){if(m&&Q!==m.appId){H=undefined;}V=S.get("application"+x);if(V){H=V.container;if(!N&&X&&H!==undefined){_=true;}}}var e1,f1;e1=T.appCapabilities&&T.appCapabilities.fullWidth;if($===true){if(T.fullWidth===false||T.fullWidth==="false"||M.fullWidth===false||M.fullWidth==="false"||e1===false){f1=false;}}else if(T.fullWidth===true||T.fullWidth==="true"||M.fullWidth===true||M.fullWidth==="true"){f1=true;}if(f1===undefined){f1=$;}if(N){if(!H){H=W(e,M,y,T,x,f1,F);this.restoreApp(H.getId());this.navTo(H.getId());Z=true;}}else if(!J&&H&&!X){a1=new q.Deferred();this.destroy(H.getId(),H,a1);a1.then(function(){H=W(e,M,y,T,x,f1,F);});}else if(!H){H=W(e,M,y,T,x,f1,F);}if(a1===undefined){a1=new q.Deferred().resolve();}if(H&&H.getDeffedControlCreation){c1=H.getDeffedControlCreation();}else{c1=Promise.resolve();}a1.then(function(){c1.then(function(){if(!J&&!N){if(_===true){sap.ui.getCore().getEventBus().publish("launchpad","appOpening",T);}z.restoreApp(H.getId());z.navTo(H.getId());if(_===true){sap.ui.getCore().getEventBus().publish("sap.ushell","appOpened",T);}}v.switchState("Center");u.setPerformanceMark("FLP -- centerViewPort");z.activeContainer(H);if(N){z.handleOpenStateful(Z,X,"application"+x,H,T,F,d1);}else if(J){z.reuseApplicationContainer(H,T.applicationType,T.url);}b1.resolve();});});return b1.promise();};this.handleControl=function(e,x,y,T,W,F){var z=this,M=d.getMetadata(T),H=v.getCurrentCenterPage?v.getCurrentCenterPage():undefined,J=sap.ui.getCore().byId(H);var P=z.leave(J,H).then(function(){z.open(e,x,y,T,W,F,M);},function(N){L.error(N&&N.message||N);});return P;};this.switchViewState=function(e,x,y){var z=e,F;if(n[e]&&n[e][k]){z=n[e][k];}var H=C.last("/core/shell/model/currentState/stateName")==="home";if(!H&&(!m.appId||!S.get(m.appId))){E.destroyManageQueue();}F=S.get("application"+y);if(F){b.restore(F);}else{b.assignNew(e);}E.switchState(z,x,y);this.shellElements().setDangling(false);this.shellElements().processDangling();if(e==="searchResults"){this.getElementsModel().setProperty("/lastSearchScreen","");if(!window.hasher.getHash().indexOf("Action-search")===0){var J=sap.ui.getCore().getModel("searchModel");window.hasher.setHash("Action-search&/searchTerm="+J.getProperty("/uiFilter/searchTerms")+"&dataSource="+JSON.stringify(J.getProperty("/uiFilter/dataSource").getJson()));}}};this.registerShellCommunicationHandler=function(e){A.registerShellCommunicationHandler(e);};this.registerIframeCommunicationHandler=function(H,T){t[T]=H;};this.postMessageToIframeApp=function(e,x,M,W){var y,z=A.getActiveAppContainer(),F=false,H=[];if(B.hasIFrame(z)&&(B.isCapabilitySupported(z,e,x)||A.isAppTypeSupported(z,e,x))){H.push(A.postMessageToIframeApp(z,e,x,M,W));F=true;}if(!A.isActiveOnly(e,x)){B.forEach(function(N){if(F===true&&N===z){return;}if(B.hasIFrame(N)){if(B.isCapabilitySupported(N,e,x)||A.isAppTypeSupported(N,e,x)){H.push(A.postMessageToIframeApp(N,e,x,M,W));}}});}y=A.getResponseHandler(e,x);var J=Promise.all(H);if(y){y(J);}return J;};this.postMessageToIframeAppAccordingToPolicy=function(e,x,M,W,P){var y,z=A.getActiveAppContainer(),F=[];if(B.hasIFrame(z)&&A.isAppTypeSupportedByPolicy(z,P)){F.push(A.postMessageToIframeApp(z,e,x,M,W));}if(!P.isActiveOnly){B.forEach(function(J){if(B.hasIFrame(J)){if(B.isCapabilitySupported(J,e,x)||A.isAppTypeSupported(J,e,x)){F.push(A.postMessageToIframeApp(J,e,x,M,W));}}});}y=A.getResponseHandler(e,x);var H=Promise.all(F);if(y){y(H);}return H;};this.registerTunnels=function(T){h.registerTunnels(T,this.registerShellCommunicationHandler);};this.registerEvents=function(e){h.registerEvents(e,this.registerShellCommunicationHandler);};this.setBackNavigationChanged=function(e){w=e;};this.getBackNavigationChanged=function(){return w;};}return new i();},true);
