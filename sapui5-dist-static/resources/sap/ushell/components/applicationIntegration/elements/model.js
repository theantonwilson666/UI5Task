// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/EventHub","sap/ushell/Config","sap/ushell/utils","sap/ushell/components/HeaderManager","sap/ushell/components/StateHelper","sap/ui/performance/Measurement","sap/base/Log","sap/ui/thirdparty/jquery"],function(E,C,u,H,S,M,L,q){"use strict";var b;var c;function a(){return{"home":{"actions":["ContactSupportBtn","EndUserFeedbackBtn"]},"app":{"actions":["ContactSupportBtn","EndUserFeedbackBtn","aboutBtn"]},"minimal":{"actions":["ContactSupportBtn","EndUserFeedbackBtn","aboutBtn"]},"standalone":{"actions":["ContactSupportBtn","EndUserFeedbackBtn","aboutBtn"]},"embedded":{"actions":["ContactSupportBtn","EndUserFeedbackBtn","aboutBtn"]},"embedded-home":{"actions":["ContactSupportBtn","EndUserFeedbackBtn","aboutBtn"]},"lean":{"actions":["ContactSupportBtn","EndUserFeedbackBtn","aboutBtn"]}};}function d(){return{"blank":{"stateName":"blank","showCurtain":false,"showCatalog":false,"showPane":false,"showRightFloatingContainer":true,"showRecentActivity":true,"paneContent":[],"actions":[],"floatingActions":[],"subHeader":[],"toolAreaItems":[],"RightFloatingContainerItems":[],"toolAreaVisible":false,"floatingContainerContent":[],"search":""},"blank-home":{"stateName":"blank-home","showCurtain":false,"showCatalog":false,"showPane":false,"showRightFloatingContainer":true,"showRecentActivity":true,"paneContent":[],"actions":[],"floatingActions":[],"subHeader":[],"toolAreaItems":[],"RightFloatingContainerItems":[],"toolAreaVisible":false,"floatingContainerContent":[],"search":""},"home":{"stateName":"home","showCurtain":false,"showCatalog":false,"showPane":false,"showRightFloatingContainer":true,"showRecentActivity":true,"search":"","paneContent":[],"actions":["openCatalogBtn","userSettingsBtn"],"floatingActions":[],"subHeader":[],"toolAreaItems":[],"RightFloatingContainerItems":[],"toolAreaVisible":false,"floatingContainerContent":[]},"app":{"stateName":"app","showCurtain":false,"showCatalog":false,"showPane":false,"showRightFloatingContainer":true,"showRecentActivity":true,"paneContent":[],"search":"","actions":["openCatalogBtn","userSettingsBtn"],"floatingActions":[],"subHeader":[],"toolAreaItems":[],"RightFloatingContainerItems":[],"toolAreaVisible":false,"floatingContainerContent":[]},"minimal":{"stateName":"minimal","showCurtain":false,"showCatalog":false,"showPane":false,"showRightFloatingContainer":true,"showRecentActivity":true,"paneContent":[],"actions":["openCatalogBtn","userSettingsBtn"],"floatingActions":[],"subHeader":[],"toolAreaItems":[],"RightFloatingContainerItems":[],"toolAreaVisible":false,"floatingContainerContent":[],"search":""},"standalone":{"stateName":"standalone","showCurtain":false,"showCatalog":false,"showPane":false,"showRightFloatingContainer":true,"showRecentActivity":true,"paneContent":[],"actions":[],"floatingActions":[],"subHeader":[],"toolAreaItems":[],"RightFloatingContainerItems":[],"toolAreaVisible":false,"floatingContainerContent":[],"search":""},"embedded":{"stateName":"embedded","showCurtain":false,"showCatalog":false,"showPane":false,"showRightFloatingContainer":true,"showRecentActivity":true,"paneContent":[],"actions":[],"floatingActions":[],"subHeader":[],"toolAreaItems":[],"RightFloatingContainerItems":[],"toolAreaVisible":false,"floatingContainerContent":[],"search":""},"embedded-home":{"stateName":"embedded-home","showCurtain":false,"showCatalog":false,"showPane":false,"showRightFloatingContainer":true,"showRecentActivity":true,"paneContent":[],"actions":[],"floatingActions":[],"subHeader":[],"toolAreaItems":[],"RightFloatingContainerItems":[],"toolAreaVisible":false,"floatingContainerContent":[],"search":""},"headerless":{"stateName":"headerless","showCurtain":false,"showCatalog":false,"showPane":false,"showRightFloatingContainer":true,"showRecentActivity":true,"paneContent":[],"actions":[],"floatingActions":[],"subHeader":[],"toolAreaItems":[],"RightFloatingContainerItems":[],"toolAreaVisible":false,"floatingContainerContent":[],"search":""},"merged":{"stateName":"merged","showCurtain":false,"showCatalog":false,"showPane":false,"showRightFloatingContainer":true,"showRecentActivity":true,"paneContent":[],"actions":[],"floatingActions":[],"subHeader":[],"toolAreaItems":[],"RightFloatingContainerItems":[],"toolAreaVisible":false,"floatingContainerContent":[],"search":""},"headerless-home":{"stateName":"headerless-home","showCurtain":false,"showCatalog":false,"showPane":false,"showRightFloatingContainer":true,"showRecentActivity":true,"paneContent":[],"actions":[],"floatingActions":[],"subHeader":[],"toolAreaItems":[],"RightFloatingContainerItems":[],"toolAreaVisible":false,"floatingContainerContent":[],"search":""},"merged-home":{"stateName":"merged-home","showCurtain":false,"showCatalog":false,"showPane":false,"showRightFloatingContainer":true,"showRecentActivity":true,"paneContent":[],"actions":[],"floatingActions":[],"subHeader":[],"toolAreaItems":[],"RightFloatingContainerItems":[],"toolAreaVisible":false,"floatingContainerContent":[],"search":""},"lean":{"stateName":"lean","showCurtain":false,"showCatalog":false,"showPane":false,"showRightFloatingContainer":true,"showRecentActivity":false,"paneContent":[],"search":"","actions":[],"floatingActions":[],"subHeader":[],"toolAreaItems":[],"RightFloatingContainerItems":[],"toolAreaVisible":false,"floatingContainerContent":[]},"lean-home":{"stateName":"lean-home","showCurtain":false,"showCatalog":false,"showPane":false,"showRightFloatingContainer":true,"showRecentActivity":false,"paneContent":[],"search":"","actions":[],"floatingActions":[],"subHeader":[],"toolAreaItems":[],"RightFloatingContainerItems":[],"toolAreaVisible":false,"floatingContainerContent":[]}};}function r(O,k){return Object.keys(O).reduce(function(o,K){if(!k[K]){o[K]=O[K];}return o;},{});}function v(i,j){return j!==undefined;}function n(){return true;}function g(o,m){var p=m.split("/");var i=o;p.shift();p.forEach(function(P){if(!i){return;}i=i[P];});return i;}function e(m,V,o){var p=m.split("/");var i=o;p.shift();var P=p.pop();p.forEach(function(s){i=i[s];});i[P]=V;}function f(){var o;var s;var k;var A;var m;var I;var l;var p;var t;var w;this.createDefaultTriggers=function(i){var R=function(B,D,F){if(F.sProperty==="actions"){var G=g(F.oModel,F.path);if(G&&G.length===0&&F.aIds&&F.aIds.length>0){this._renderShellState();}}}.bind(this);var j=function(B){function D(O,N){var U=sap.ushell.Container.getService("URLParsing"),G=U.getHash(O),J=U.getHash(N),K=U.parseShellHash(G).appSpecificRoute,P=U.parseShellHash(J).appSpecificRoute;return K!==P;}var F=D(B.oldURL,B.newURL);if(F){this.addHeaderItem(["backBtn"],true);}}.bind(this);this.createTriggersOnBaseStates([{sName:"onAddFirstAction",fnRegister:function(){sap.ui.getCore().getEventBus().subscribe("launchpad","updateShell",R,this);},fnUnRegister:function(){sap.ui.getCore().getEventBus().unsubscribe("launchpad","updateShell",R,this);}}],["blank","blank-home"],i);var y=this;var z;this.createTriggersOnBaseStates([{sName:"onAddFirstAction",fnRegister:function(){window.addEventListener("hashchange",j);var N=0;z=E.on("AppRendered").do(function(){N++;if(N>=2){y.addHeaderItem(["backBtn"],true);}});},fnUnRegister:function(){window.removeEventListener("hashchange",j);if(z){z.off();}}}],["lean","lean-home"],i);};this.init=function(i,j){b=d();c=a();s=C.last("/core/shell/model");o={};m={};I=false;p=false;t=[];w=true;A=j;l=undefined;if(i){M.start("FLP:ElementsModel.init","moveShellHeaderEndItems","FLP");if(i.moveContactSupportActionToShellHeader){this._removeCustomDataActionBtnFromMeArea("ContactSupportBtn");}if(i.moveGiveFeedbackActionToShellHeader){this._removeCustomDataActionBtnFromMeArea("EndUserFeedbackBtn");}if(i.moveAppFinderActionToShellHeader){this._removeActionFromMeArea("openCatalogBtn");}if(i.moveUserSettingsActionToShellHeader){this._removeActionFromMeArea("userSettingsBtn");}M.end("FLP:ElementsModel.init");}var y=i&&i.appState?i.appState:"home";this.createDefaultTriggers(y);this.switchState(y);};this.destroy=function(){s=undefined;o=undefined;A=undefined;m=undefined;I=undefined;w=undefined;p=undefined;l=undefined;b=undefined;c=undefined;};this.getModel=function(){var R=sap.ushell.Container.getRenderer("fiori2");if(!R){return undefined;}return R._oShellView.getModel();};this._removeCustomDataActionBtnFromMeArea=function(i){for(var j in c){var y=c[j];var z=y.actions;var B=z.indexOf(i);if(B!==-1){c[j].actions.splice(B,1);}}};this._removeActionFromMeArea=function(B){var i;for(i in b){var j=b[i];if(i==="blank"||i==="blank-home"){continue;}var y=j.actions;var z=y.indexOf(B);if(z!==-1){b[i].actions.splice(z,1);}}};this.destroyManageQueue=function(){this._destroyManageQueue(["home","embedded-home","headerless-home","merged-home","blank-home","lean-home"]);};this.switchState=function(i){var j=u.clone(b[i]);var y=r(j,{aTriggers:true});C.emit("/core/shell/model/currentState",y);H.switchState(i);k=A.customShellState;l=undefined;this._renderShellState();return j;};this.setLeftPaneVisibility=function(V,i,j){this.updateStateProperty("showPane",V,i,j);};this.setHeaderHiding=function(){L.warning("Application Life Cycle model: headerHiding property is deprecated and has no effect");};this._createHeaderEventPayload=function(P,V,i,j,D,y){var z={propertyName:P,value:V,aStates:j,bCurrentState:i,action:y,bDoNotPropagate:D};return z;};this.setHeaderVisibility=function(V,i,j){var P=this._createHeaderEventPayload("headerVisible",V,i,j,false);H.updateStates(P);};this.showLogo=function(i,j){this.updateShowLogo(true,i,j,false);};this.updateShowLogo=function(V,i,j,D){var P=this._createHeaderEventPayload("showLogo",V,i,j,D);H.updateStates(P);};this.addHeaderItem=function(i,j,y){if(i.length){var P=this._createHeaderEventPayload("headItems",i,j,y,false);H.updateStates(P);}};this.removeHeaderItem=function(i,j,y){var P=this._createHeaderEventPayload("headItems",i,j,y,false,"remove");H.updateStates(P);};this.addHeaderEndItem=function(i,j,y,D){if(i.length){var P=this._createHeaderEventPayload("headEndItems",i,j,y,D);H.updateStates(P);}};this.removeHeaderEndItem=function(i,j,y){var P=this._createHeaderEventPayload("headEndItems",i,j,y,false,"remove");H.updateStates(P);};this.addSubHeader=function(i,j,y){if(i.length){this._addShellItem("subHeader",i,j,y);}};this.removeSubHeader=function(i,j,y){this._removeShellItem("subHeader",i,j,y);};this.addActionButton=function(i,j,y){this._addActionButton("actions",i,j,y);};this.removeActionButton=function(i,j,y){this._removeShellItem("actions",i,j,y);};this.addToolAreaItem=function(i,j,y,z){if(i.length){this._addToolAreaItem("toolAreaItems",i,j,y,z);}};this.removeToolAreaItem=function(i,j,y){this._removeShellItem("toolAreaItems",i,j,y);};this.addLeftPaneContent=function(i,j,y){if(i.length){this._addShellItem("paneContent",i,j,y);}};this.removeLeftPaneContent=function(i,j,y){this._removeShellItem("paneContent",i,j,y);};this.addRightFloatingContainerItem=function(i,j,y){if(i.length){this._addRightFloatingContainerItem("RightFloatingContainerItems",i,j,y);}};this.removeRightFloatingContainerItem=function(i,j,y){this._removeShellItem("RightFloatingContainerItems",i,j,y);};this.showSettingsButton=function(i,j){this.addActionButton(["userSettingsBtn"],i,j,false);};this.showSignOutButton=function(i,j){this.addActionButton(["logoutBtn"],i,j,false);};this.showRightFloatingContainer=function(i){this._showRightFloatingContainer(i);};this.addFloatingActionButton=function(i,j,y){if(i.length){this._addShellItem("floatingActions",i,j,y);}};this.removeFloatingActionButton=function(i,j,y){this._removeShellItem("floatingActions",i,j,y);};this.updateStateProperty=function(P,V,i,j,D){if(P.startsWith("application")){var y=this._createHeaderEventPayload(P,V,i,j,false);H.updateStates(y);return;}this._setShellItem(P,V,i,j,v,e,D);};this._handleTriggers=function(N){var T,i,j=[],y={};w=false;while(t.length>0){T=t.pop();if(N[T.sName]){j.push(T);y[T.sName]=T;}else{T.fnUnRegister(this);}}for(var z in N){if(N.hasOwnProperty(z)){if(!y[z]){i=N[z];i.fnRegister(this);j.push(i);}}}t=j;w=true;};this._registerTriggers=function(T){w=false;T.forEach(function(i){i.fnRegister(this);t.push(i);});w=true;};function x(T,i){var j=[];if(!i.aTriggers){i.aTriggers=[];}T.forEach(function(y){var F={sName:y.sName,fnRegister:y.fnRegister,fnUnRegister:y.fnUnRegister};i.aTriggers.push(F);j.push(F);});return j;}this.createTriggersOnState=function(T){var i=x(T,b);if(!I){this._registerTriggers(i);}};this.createTriggersOnBaseStates=function(T,B,i){var j=[];B.forEach(function(z){var D=b[z];j=x(T,D);});var y=B.indexOf(i)>=0;if(y&&!I){this._registerTriggers(j);}};this.createTriggers=function(T,i,B){var j=s.currentState;if(i===true){this.createTriggersOnState(T,j);return;}this.createTriggersOnBaseStates(T,B,j.stateName);};this.showShellItem=function(P,j,V){var y=S.getModelStates(j),z="/currentState"+P,B;for(var i=0;i<y.length;i++){B=b[y[i]].stateName;b[B][P.split("/")[1]]=V;}if(s.currentState.stateName===j){e(z,V,s);if(!I){this._renderShellState();}}};this.addCustomItems=function(i,j,y,z){if(this._isValidStateEntry(i)){this._isValidStateEntry(i).fnAdd(j,y,z);}else{throw new Error("Invalid state entry:"+i);}};this.removeCustomItems=function(i,j,y,z){if(this._isValidStateEntry(i)){this._isValidStateEntry(i).fnRemove(j,y,z);}else{throw new Error("Invalid state entry:"+i);}};this.applyExtendedShellState=function(i){l=i;this._renderShellState();};this.addEntryInShellStates=function(i,j,y,R,z){var B,D;if(!o[i]){o[i]={fnAdd:y,fnHide:R};var F=this._getStatesList();for(B=0;B<F.length;B++){D=F[B];b[D][i]=z[D];}this["remove"+j]=R;this["add"+j]=y;}else{throw new Error("State entry already exsists:"+i);}};this.addElementToManagedQueue=function(i){var j=C.last("/core/shell/model/currentState/stateName"),B,y=i.getId();if(!A){A={extendedShellStates:{},aTriggers:[],customShellState:this._createCustomShellState("custom")};}B=A.extendedShellStates;if(!B[j]){B[j]={managedObjects:[],customState:undefined};}B[j].managedObjects.push(y);var z=m[y];if(z){z.nRefCount++;}else{z={oItem:i,nRefCount:1};m[y]=z;}};this.updateNeededTriggersMap=function(i,T){var j;if(!T){return;}for(j=0;j<T.length;j++){i[T[j].sName]=T[j];}};this._renderShellState=function(){var B=C.last("/core/shell/model/currentState/stateName"),i,j,y=u.clone(b[B]),z=A,D,N={};if(I){return;}if(z&&z.customShellState){D=z.customShellState.currentState;}var F={"currentState":u.clone(y)};s=F;I=true;if(l&&z.extendedShellStates&&z.extendedShellStates[l]){i=z.extendedShellStates[l].customState;j=i.currentState;this._addCustomShellStates(j);}if(D){this._addCustomShellStates(D);}s=C.last("/core/shell/model");if(y&&y.aTriggers){this.updateNeededTriggersMap(N,y.aTriggers);}if(j&&j.aTriggers){this.updateNeededTriggersMap(N,j.aTriggers);}if(D&&D.aTriggers){this.updateNeededTriggersMap(N,D.aTriggers);}if(w){this._handleTriggers(N);}delete F.currentState.aTriggers;var G=r(F.currentState,{aTriggers:true});H.recalculateState(l);C.emit("/core/shell/model/currentState",G);I=false;};this._addCustomShellStates=function(T){this.addToolAreaItem(T.toolAreaItems,false,true);this.addSubHeader(T.subHeader,true);this.addRightFloatingContainerItem(T.RightFloatingContainerItems,true);this.addActionButton(T.actions,true,undefined,false);this.addLeftPaneContent(T.paneContent,true);this.addFloatingActionButton(T.floatingActions,true);this.showRightFloatingContainer(T.showRightFloatingContainer);};this._createCustomShellState=function(i){var j={"currentState":{"stateName":i,"headEndItems":[],"paneContent":[],"headItems":[],"actions":[],"floatingActions":[],"subHeader":[],"toolAreaItems":[],"RightFloatingContainerItems":[],"application":{},"showRightFloatingContainer":undefined,"headerHeading":undefined}};var y=c[i];if(y){q.extend(j.currentState,y);}return j;};this._showRightFloatingContainer=function(i){this._setShellItem("showRightFloatingContainer",i,true,[],v,e);};this._addActionButton=function(P,j,y,z){function U(B,D,F){var G=g(F,B);var J=G.indexOf("logoutBtn");if(J>-1){G.splice.apply(G,[J,0].concat(D));}else{G=G.concat(D);}var K=u.removeDuplicatedActions(G);function N(G){var Q=[],R=["recentActivitiesBtn","frequentActivitiesBtn","openCatalogBtn","userSettingsBtn","ActionModeBtn","ContactSupportBtn","EndUserFeedbackBtn"];for(var i=0;i<R.length;i++){var T=G.indexOf(R[i]);if(T>-1){Q.push(G.splice(T,1)[0]);}}Q=Q.concat(G);return Q;}var O=N(K);e(B,O,F);}this._setShellItem(P,j,y,z,n,U);};this.setFloatingContainerContent=function(P,i,j,y){function V(z,i,B){return i.length===1;}function U(z,i,B){e(z,i,B);}this._setShellItem(P,i,j,y,V,U);};this._addShellItem=function(P,i,j,y){function V(z,i,B){if(z.length>0){L.warning("You can only add one item. Replacing existing item: "+z[0]+" in state: "+B+", with the new item: "+i[0]+".");}return true;}function U(z,B,D){e(z,i.slice(0),D);}this._setShellItem(P,i,j,y,V,U);};this._addRightFloatingContainerItem=function(P,i,j,y){function U(z,B,D){var F=g(D,z);F=F.concat(B);e(z,F,D);}this._setShellItem(P,i,j,y,n,U);};this._addToolAreaItem=function(P,i,j,y,z){function U(F,i,G){var J=g(G,F),K,B;if(typeof i==="string"){i=[i];}for(B=0;B<i.length;B++){K=i[B];if(J.indexOf(K)<0){J.push(K);}}e(F,J,G);}if(j){var B,D=S.getPassStates(z);for(B=0;B<D.length;B++){this.showShellItem("/toolAreaVisible",D[B],true);}}this._setShellItem(P,i,y,z,n,U);};this._removeShellItem=function(P,i,j,y){function V(z,B){var D,i,F;for(F=0;F<B.length;F++){i=B[F];D=z.indexOf(i);if(D<0){L.warning("You cannot remove Item: "+i+", the Item does not exists.");return false;}}return true;}function U(z,B,D){var F=g(D,z),G,i,J;for(J=0;J<B.length;J++){i=B[J];G=F.indexOf(i);if(G>-1){F.splice(G,1);}}e(z,F,D);}this._setShellItem(P,i,j,y,V,U);};this._setShellItem=function(P,O,y,z,V,U,D){var B,F;var G=Array.isArray(O)?O.slice(0):O;if(y===true){B="/currentState/"+P;F=g(s,B);if(V(F,G,"currentState")===false){return;}if(!p&&!I){U(B,G,k);sap.ui.getCore().getEventBus().publish("launchpad","updateShell",{oModel:s,path:B,aIds:G,sProperty:P});this._renderShellState();}else{U(B,G,s);}}else{var J=D?z:S.getPassStates(z),i,K=s.currentState.stateName;for(i=0;i<J.length;i++){var N=J[i],j;F=g(b[N],"/"+P);if(V(F,G,N)===false){continue;}var Q=S.getModelStates(N,D);for(j=0;j<Q.length;j++){B="/"+Q[j]+"/"+P;U(B,G,b);if(K===Q[j]){if(!I){this._renderShellState();}}}}}};this._getStatesList=function(){return Object.keys(b);};this._destroyManageQueue=function(){var i,j,y,B,z,D;B=A.extendedShellStates;for(z in B){if(B.hasOwnProperty(z)){D=B[z].managedObjects;for(i=0;i<D.length;i++){j=D[i];y=m[j];y.nRefCount--;if(y.nRefCount===0){y.oItem.destroy();m[j]=null;}}delete B[z];}}};this._isValidStateEntry=function(N){return!!o[N];};this.getModelToUpdate=function(){return s;};this.setModelToUpdate=function(i,j){p=j;s=i;};this._getManagedElements=function(){return m;};this.extendStates=function(i){var j;for(j in i){if(i.hasOwnProperty(j)){u.updateProperties(b[j],i[j]);}}};this.getBaseStateMember=function(i,B){return b[i][B];};this.getCustomStateDeltaMember=function(i,j){return c[i][j];};this.getAllStatesInDelta=function(){return Object.keys(c);};}var h=new f();return h;},true);
