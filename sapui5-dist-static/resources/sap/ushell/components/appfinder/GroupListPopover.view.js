// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/Config","sap/ui/thirdparty/jquery","sap/base/Log","sap/m/ResponsivePopover","sap/ushell/resources","sap/m/ScrollContainer","sap/ui/Device","sap/m/StandardListItem","sap/m/List","sap/m/Input","sap/ui/core/library","sap/m/Button","sap/ui/core/IconPool","sap/m/Bar","sap/m/Label","sap/m/DisplayListItem","sap/m/library","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(C,q,L,R,r,S,D,a,b,I,c,B,d,e,f,g,m,F,h){"use strict";var i=m.ListMode;var j=m.ListType;sap.ui.jsview("sap.ushell.components.appfinder.GroupListPopover",{getControllerName:function(){return"sap.ushell.components.appfinder.GroupListPopover";},createContent:function(k){this.oLaunchPageService=sap.ushell.Container.getService("LaunchPage");this.oPopover=new R({id:"groupsPopover",placement:"Auto",title:r.i18n.getText("addTileToGroups_popoverTitle"),contentWidth:"20rem",beginButton:this._getCloseButton(),content:this._getListContainer(),afterClose:[k._afterCloseHandler,k]}).addStyleClass("sapContrastPlus");this.addDependent(this.oPopover);this.oPopover.setInitialFocus(this._getNewGroupListItem());},open:function(o){if(document.body.clientHeight-o.getDomRef().getBoundingClientRect().bottom>=310){this.oPopover.setPlacement("Bottom");}this.oPopover.openBy(o);if(this.getViewData().singleGroupSelection){this.getController()._setFooterVisibility(false);}this.deferred=q.Deferred();return this.deferred.promise();},_getListContainer:function(){if(!this._oListContainer){var G=this._getGroupList();this._oListContainer=new S({id:"popoverContainer",horizontal:false,vertical:true,content:[G],height:D.system.phone?"100%":"190px"});}return this._oListContainer;},_getNewGroupInput:function(){if(!this._oNewGroupNameInput){this._oNewGroupNameInput=new I("newGroupNameInput",{type:"Text",placeholder:r.i18n.getText("new_group_name")});}return this._oNewGroupNameInput;},_getNewGroupHeader:function(){if(!this._oNewGroupHeader){var o=this.getController();var k=new B({icon:d.getIconURI("nav-back"),press:[o._backButtonHandler,o],tooltip:r.i18n.getText("newGroupGoBackBtn_tooltip")});k.addStyleClass("sapUshellCatalogNewGroupBackButton");this._oNewGroupHeader=new e("oHeadBar",{contentLeft:[k],contentMiddle:[new f({text:r.i18n.getText("newGroup_popoverTitle")})]});}return this._oNewGroupHeader;},_getGroupList:function(){if(!this._oGroupList){var o=this.getController();var l=new g({label:"{oGroup/title}",selected:"{selected}",tooltip:"{oGroup/title}",type:j.Active});var u=[new F("oGroup/isGroupLocked",h.EQ,false)];var v=this.getViewData();if(v.enableHideGroups){u.push(new F("oGroup/isGroupVisible",h.EQ,true));}this._oGroupList=new b({mode:v.singleGroupSelection?i.SingleSelectMaster:i.MultiSelect,items:{path:"/userGroupList",template:l,filters:u,templateShareable:false},itemPress:[o.groupListItemClickHandler,o],selectionChange:[o.onGroupListSelectionChange,o]});var n=this._getNewGroupListItem();this._oGroupList.addEventDelegate({onBeforeRendering:function(){this._oGroupList.insertAggregation("items",n,0,true);}.bind(this),onAfterRendering:function(){this._oGroupList.removeAggregation("items",n,true);}.bind(this)});}return this._oGroupList;},_getNewGroupListItem:function(){if(!this._oNewGroupItem){this._oNewGroupItem=new a("newGroupItem",{title:r.i18n.getText("newGroup_listItemText"),type:j.Navigation});this._oNewGroupItem.data("newGroupItem",true);this._oNewGroupItem.getList=function(){return this._oGroupList;}.bind(this);this._oNewGroupItem.getModeControl=function(){return null;};this._oNewGroupItem.onsapspace=function(k){k.preventDefault();k.isMarked();};this._oNewGroupItem.addEventDelegate({onsaptabnext:function(E){E.preventDefault();E._bIsStopHandlers=true;this._getCloseButton().focus();}});}return this._oNewGroupItem;},_getCancelButton:function(){if(!this._oCancelButton){this._oCancelButton=new B("cancelButton",{press:this.getController()._closeButtonHandler.bind(this.getController()),text:r.i18n.getText("cancelBtn")});}return this._oCancelButton;},_getCloseButton:function(){if(!this._oCloseButton){var o=this.getController();this._oCloseButton=new B("closeButton",{press:[o._switchGroupsPopoverButtonPress,o],text:r.i18n.getText("closeBtn")});}return this._oCloseButton;}});});
