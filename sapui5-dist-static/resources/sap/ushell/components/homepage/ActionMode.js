// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/resources","sap/m/library","sap/m/Button","sap/ui/thirdparty/jquery","sap/ushell/utils/WindowUtils"],function(r,m,B,q,W){"use strict";var P=m.PlacementType;var A=function(){this.oEventBus=sap.ui.getCore().getEventBus();this.init=function(M){this.oModel=M;};};A.prototype._activate=function(){this.oModel.setProperty("/tileActionModeActive",true);this.aOrigHiddenGroupsIds=this.getHomepageManager().getCurrentHiddenGroupIds(this.oModel);var d=sap.ui.getCore().byId("dashboardGroups");d.addLinksToUnselectedGroups();var t=sap.ui.getCore().byId("ActionModeBtn");if(t){t.setTooltip(r.i18n.getText("exitEditMode"));t.setText(r.i18n.getText("exitEditMode"));if(t.setSelected){t.setSelected(true);}}this.oEventBus.publish("launchpad","actionModeActive");};A.prototype._deactivate=function(){this.oModel.setProperty("/tileActionModeActive",false);this.oEventBus.publish("launchpad","actionModeInactive",this.aOrigHiddenGroupsIds);var t=sap.ui.getCore().byId("TileActions");if(t!==undefined){t.destroy();}sap.ui.require(["sap/m/MessageToast"],function(M){M.show(r.i18n.getText("savedChanges"),{duration:4000});});var T=sap.ui.getCore().byId("ActionModeBtn");if(T){T.setTooltip(r.i18n.getText("activateEditMode"));T.setText(r.i18n.getText("activateEditMode"));if(T.setSelected){T.setSelected(false);}}};A.prototype.toggleActionMode=function(M,s,d){d=d||[];var v=d.filter(function(g){return g.getVisible();});var D={group:v[M.getProperty("/topGroupInViewPortIndex")],restoreLastFocusedTile:true};if(M.getProperty("/tileActionModeActive")){this._deactivate();var j=q(".sapUshellTileContainerHeader[tabindex=0]");if(j.length){var a=q(j[0]).closest(".sapUshellTileContainer");if(a.length){D.restoreLastFocusedTileContainerById=a[0].id;}}}else{this._activate();}this.oEventBus.publish("launchpad","scrollToGroup",D);};A.prototype.activateGroupEditMode=function(g){var j=q(g.getDomRef()).find(".sapUshellTileContainerContent");j.addClass("sapUshellTileContainerEditMode");};A.prototype.getHomepageManager=function(){if(!this.oHomepageManager){this.oHomepageManager=sap.ushell.components.getHomepageManager();}return this.oHomepageManager;};A.prototype._openActionsMenu=function(e,v){var t=this,T=v||e.getSource(),a=[],o=sap.ui.getCore().byId("TileActions"),b,c,d=[],n,f,g,h,H,j;if(T){h=T.getBindingContext().getObject().object;a=this.getHomepageManager().getTileActions(h);}t.oTileControl=T;q(".sapUshellTileActionLayerDivSelected").removeClass("sapUshellTileActionLayerDivSelected");j=q(e.getSource().getDomRef()).find(".sapUshellTileActionLayerDiv");j.addClass("sapUshellTileActionLayerDivSelected");var k=T.getModel();var G=T.getParent().getBindingContext().getPath();if(a.length&&k.getProperty(G+"/isGroupLocked")){["tileSettingsBtn","linkSettingsBtn","ConvertToTile","ConvertToLink","moveTileDialog_action"].forEach(function(s){var l=r.i18n.getText(s);for(var i=0;i<a.length;i++){if(a[i].text===l){a.splice(i,1);break;}}});}if(a.length===0){n=new B({text:r.i18n.getText("tileHasNoActions"),enabled:false});d.push(n);}else{for(c=0;c<a.length;c++){g=a[c];H=(function(g){return function(){t._handleActionPress(g,T);};}(g));f=new B({text:g.text,icon:g.icon,press:H});d.push(f);}}b=e.getSource().getActionSheetIcon?e.getSource().getActionSheetIcon():undefined;if(!b){var M=sap.ui.getCore().byId(e.getSource().getId()+"-action-more");if(M){b=M;}else{b=e.getSource();}}if(!o){sap.ui.require(["sap/m/ActionSheet"],function(i){o=new i("TileActions",{placement:P.Bottom,afterClose:function(){q(".sapUshellTileActionLayerDivSelected").removeClass("sapUshellTileActionLayerDivSelected");var E=sap.ui.getCore().getEventBus();E.publish("dashboard","actionSheetClose",t.oTileControl);}});t._openActionSheet(o,d,b);});}else{t._openActionSheet(o,d,b);}};A.prototype._openActionSheet=function(a,b,t){b=b||[];a.destroyButtons();b.forEach(function(o){a.addButton(o);});a.openBy(t);};A.prototype._handleActionPress=function(a,t){if(a.press){a.press.call(a,t);}else if(a.targetURL){if(a.targetURL.indexOf("#")===0){hasher.setHash(a.targetURL);}else{W.openURL(a.targetURL,"_blank");}}else{sap.ui.require(["sap/m/MessageToast"],function(M){M.show("No Action");});}};return new A();},true);
