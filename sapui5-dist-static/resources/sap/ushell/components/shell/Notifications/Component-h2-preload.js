//@ui5-bundle sap/ushell/components/shell/Notifications/Component-h2-preload.js
// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.predefine('sap/ushell/components/shell/Notifications/Component',["sap/base/Log","sap/m/library","sap/m/Popover","sap/ui/core/IconPool","sap/ui/core/InvisibleText","sap/ui/core/UIComponent","sap/ui/thirdparty/jquery","sap/ushell/EventHub","sap/ushell/resources","sap/ushell/utils","sap/ushell/ui/shell/ShellHeadItem"],function(L,m,P,I,a,U,q,E,r,u,S){"use strict";var b=m.PlacementType;var F=S.prototype.FloatingNumberType;function g(){return sap.ui.getCore().byId("NotificationsCountButton");}return U.extend("sap.ushell.components.shell.Notifications.Component",{metadata:{version:"1.88.1",library:"sap.ushell.components.shell.Notifications",dependencies:{libs:["sap.m"]}},createContent:function(){this._aTimeouts=[];this.oRenderer=sap.ushell.Container.getRenderer("fiori2");this.oShellModel=this.oRenderer.shellCtrl.getModel();sap.ushell.Container.getServiceAsync("Notifications").then(function(n){this.oNotificationsService=n;if(this.oNotificationsService.isEnabled()===true){sap.ui.getCore().getEventBus().subscribe("sap.ushell.services.Notifications","onNewNotifications",this._handleAlerts,this);this.oShellModel.setProperty("/enableNotifications",true);this.oNotificationsService.init();if(this.oRenderer.getShellConfig().enableNotificationsUI===true){this.oShellModel.setProperty("/enableNotificationsUI",true);this.oNotificationsService.registerDependencyNotificationsUpdateCallback(this._updateCount.bind(this),true);}this._createNotificationButton(this.oShellModel);this.oRenderer.oShellModel.addHeaderEndItem(["NotificationsCountButton"],false,["home","app","minimal"],true);E.on("showNotifications").do(this._toggleNotifications.bind(this));}}.bind(this));},_createNotificationButton:function(s){var i="NotificationsCountButton";var n=new S({id:i,tooltip:r.i18n.getText("notificationsBtn_title"),icon:I.getIconURI("bell"),text:r.i18n.getText("notificationsBtn_title"),ariaLabel:r.i18n.getText("notificationsBtn_title"),ariaHaspopup:"dialog",enabled:true,selected:false,visible:"{/enableNotifications}",floatingNumber:"{/notificationsCount}",floatingNumberType:F.Notifications,press:function(){E.emit("showNotifications",Date.now());}});n.setModel(s);n.setModel(r.i18nModel,"i18n");},_handleAlerts:function(c,e,n){(n||[]).forEach(this.handleNotification.bind(this));},handleNotification:function(n){var A=this.oRenderer.addRightFloatingContainerItem({press:function(){this.oPopover.close();if(window.hasher.getHash()!==n.NavigationTargetObject+"-"+n.NavigationTargetAction){u.toExternalWithParameters(n.NavigationTargetObject,n.NavigationTargetAction,n.NavigationTargetParams);}this.oNotificationsService.markRead(n.Id);},datetime:r.i18n.getText("notification_arrival_time_now"),title:n.SensitiveText?n.SensitiveText:n.Text,description:n.SubTitle,unread:n.IsRead,priority:"High",hideShowMoreButton:true},true,true);this.oRenderer.showRightFloatingContainer(true);var t=setTimeout(function(){this.oRenderer.removeRightFloatingContainerItem(A.getId(),true);}.bind(this),3500);this._aTimeouts.push(t);},_updateCount:function(){this.oNotificationsService.getUnseenNotificationsCount().done(function(n){this.oShellModel.setProperty("/notificationsCount",parseInt(n,10));}.bind(this)).fail(function(d){L.error("Notifications - call to notificationsService.getCount failed: ",d);});},_getPopover:function(){if(!this.oPopover){var n=sap.ui.view("notificationsView",{viewName:"sap.ushell.components.shell.Notifications.Notifications",type:"XML",viewData:{}});var N=n.byId("notificationIconTabBar");N.enhanceAccessibilityState=function(o,A){if(o.isA("sap.m.IconTabHeader")){A.role="";A.label=r.i18n.getText("Notifications.Popover.IconTabBar.Header.AriaLabel");}return A;};this.oPopover=new P("shellNotificationsPopover",{showHeader:false,placement:b.Bottom,showArrow:true,content:n,beforeClose:function(e){e.getSource().getContent()[0].invalidate();this._resetCount();}.bind(this)});this.oPopover._oAriaLabelledByText=new a(this.oPopover.getId()+"-labelledBy",{text:r.i18n.getText("NotificationToggleButton.NoNewNotifications")}).toStatic();this.oPopover.addDependent(this.oPopover._oAriaLabelledByText);this.oPopover.addAriaLabelledBy(this.oPopover._oAriaLabelledByText);this.oPopover.addStyleClass("sapUshellNotificationsPopup");this.oPopover.addStyleClass("sapContrastPlus");}return this.oPopover;},_toggleNotifications:function(s){var p=this._getPopover();var o=g();if(!o.$().width()){o=sap.ui.getCore().byId("endItemsOverflowBtn");}if(p.isOpen()){p.close();}else if(s!==false){this._resetCount();p.setContentWidth(q("body").width()>=600?"31.1rem":undefined);p.openBy(o);}},_resetCount:function(){this.oShellModel.setProperty("/notificationsCount",0);this.oNotificationsService.notificationsSeen();},exit:function(){sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.services.Notifications","onNewNotifications",this._handleAlerts,this);if(this.oNotificationsService&&this.oNotificationsService.isEnabled()===true){this.oNotificationsService.destroy();}this.oNotificationsService=null;var n=g();if(n){this.oRenderer.hideHeaderEndItem(n,false);n.destroy();}this.oRenderer=null;if(this.oPopover){this.oPopover.destroy();this.oPopover=null;}this._aTimeouts.forEach(window.clearTimeout);}});});
sap.ui.loader.config({depCacheUI5:{
"sap/ushell/components/shell/Notifications/Component.js":["sap/base/Log.js","sap/m/Popover.js","sap/m/library.js","sap/ui/core/IconPool.js","sap/ui/core/InvisibleText.js","sap/ui/core/UIComponent.js","sap/ui/thirdparty/jquery.js","sap/ushell/EventHub.js","sap/ushell/resources.js","sap/ushell/ui/shell/ShellHeadItem.js","sap/ushell/utils.js"],
"sap/ushell/components/shell/Notifications/Notifications.controller.js":["sap/base/Log.js","sap/m/CustomListItem.js","sap/m/MessageToast.js","sap/m/Text.js","sap/m/VBox.js","sap/m/library.js","sap/ui/Device.js","sap/ui/core/library.js","sap/ui/events/KeyCodes.js","sap/ui/model/json/JSONModel.js","sap/ui/thirdparty/jquery.js","sap/ushell/resources.js","sap/ushell/utils.js"],
"sap/ushell/components/shell/Notifications/Notifications.view.xml":["sap/m/IconTabBar.js","sap/m/IconTabFilter.js","sap/m/List.js","sap/ui/core/Fragment.js","sap/ui/core/mvc/XMLView.js","sap/ushell/components/shell/Notifications/Notifications.controller.js","sap/ushell/components/shell/Notifications/NotificationsGroupListItem.fragment.xml","sap/ushell/components/shell/Notifications/NotificationsListItem.fragment.xml"],
"sap/ushell/components/shell/Notifications/NotificationsGroupListItem.fragment.xml":["sap/m/Button.js","sap/m/List.js","sap/m/NotificationListGroup.js","sap/ui/core/Fragment.js","sap/ushell/components/shell/Notifications/NotificationsListItem.fragment.xml","sap/ushell/utils.js"],
"sap/ushell/components/shell/Notifications/NotificationsListItem.fragment.xml":["sap/m/Button.js","sap/m/NotificationListItem.js","sap/ui/core/Fragment.js"],
"sap/ushell/components/shell/Notifications/Settings.controller.js":["sap/ui/model/json/JSONModel.js","sap/ui/thirdparty/jquery.js"],
"sap/ushell/components/shell/Notifications/Settings.view.js":["sap/m/CheckBox.js","sap/m/Column.js","sap/m/ColumnListItem.js","sap/m/HBox.js","sap/m/Label.js","sap/m/Switch.js","sap/m/Table.js","sap/m/Text.js","sap/m/VBox.js","sap/m/library.js","sap/ui/core/Icon.js","sap/ui/core/library.js","sap/ui/model/Sorter.js","sap/ushell/resources.js"]
}});
//# sourceMappingURL=Component-h2-preload.js.map