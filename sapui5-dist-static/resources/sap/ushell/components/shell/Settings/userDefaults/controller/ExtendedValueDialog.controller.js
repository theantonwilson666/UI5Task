// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/Token","sap/ui/comp/library","sap/ui/model/json/JSONModel","sap/ui/core/Fragment"],function(T,c,J,F){"use strict";var V=c.valuehelpdialog.ValueHelpRangeOperation;var E=function(){};E.prototype.openDialog=function(r,o){F.load({id:"ExtendedValueDialogFragment",name:"sap.ushell.components.shell.Settings.userDefaults.view.ExtendedValueDialog",controller:this}).then(function(v){var p="/"+r.parameterName+"/valueObject/extendedValue/Ranges",e=r.modelBind.extendedModel,R=e.getProperty(p)||[],l,n;if(r.modelBind.isOdata){n=this._getMetadataNameSpace(r.editorMetadata.editorInfo.odataURL);var a=r.modelBind.model.getMetaModel().getODataEntityType(n+"."+r.editorMetadata.editorInfo.entityName);if(a){l=r.modelBind.model.getMetaModel().getODataProperty(a,r.editorMetadata.editorInfo.propertyName)["sap:label"];}}var m={label:r.editorMetadata.displayText||l||r.parameterName,key:r.modelBind.sPropertyName,parameterName:r.parameterName};v.setModel(new J(m));v.setIncludeRangeOperations(this.getListOfSupportedRangeOperations());v.setTokens(this.getTokensToValueHelpDialog(R,r.parameterName));v.setRangeKeyFields([{label:m.label,key:r.parameterName}]);v.attachOk(function(b){o(b);b.getSource().close();});v.open();}.bind(this));};E.prototype.closeValueHelp=function(C){C.getSource().close(C);};E.prototype.afterCloseValueHelp=function(C){C.getSource().destroy();};E.prototype._getMetadataNameSpace=function(s){var S=s.split("/"),n;n=S[S.length-1];return n;};E.prototype.getListOfSupportedRangeOperations=function(){var s=Object.keys(V);return s.filter(function(o){return o!=="StartsWith"&&o!=="EndsWith"&&o!=="Initial";});};E.prototype.getTokensToValueHelpDialog=function(r,p){var t=[],f;r.forEach(function(R){if(R){f={};f.exclude=R.Sign==="E";f.keyField=p;f.operation=R.Option!=="CP"?R.Option:"Contains";f.value1=R.Low;f.value2=R.High;t.push(new T({}).data("range",f));}});return t;};return new E();});
