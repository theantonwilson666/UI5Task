// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils","sap/ushell/EventHub"],function(S,E){"use strict";var a={};a.init=function(p,b){this.oPagesVisibility={};this.oPagesRuntimeNavContainer=p;this.oPagesNavContainer=b;this._oURLParsingService=sap.ushell.Container.getServiceAsync("URLParsing");this.oPagesRuntimeNavContainer.attachNavigate(this._onErrorPageNavigated,this);this.oPagesNavContainer.attachNavigate(this._onPageNavigated,this);this._onTabNavigatedBind=this._onTabNavigated.bind(this);document.addEventListener("visibilitychange",this._onTabNavigatedBind);this.oEventBus=sap.ui.getCore().getEventBus();this.oEventBus.subscribe("launchpad","setConnectionToServer",this._onEnableRequests,this);this.oEventBus.subscribe("sap.ushell","navigated",this._onShellNavigated,this);this.oEventHubListener=E.once("PagesRuntimeRendered").do(function(){this._setCurrentPageVisibility(true);}.bind(this));};a._onEnableRequests=function(c,e,d){if(!d||d.active===undefined){return;}this._setCurrentPageVisibility(d.active);};a._setCurrentPageVisibility=function(v,r,n){if(this.oPagesRuntimeNavContainer.getCurrentPage().isA("sap.m.MessagePage")&&!n){return;}var c=this.oPagesNavContainer.getCurrentPage();if(c){this._setPageVisibility(c,v,r);}};a._setPageVisibility=function(p,v,r){if(!p){return;}var P=p.getBindingContext().getPath();this.oPagesVisibility[P]=v;this._visitVisualizations(p,function(b){b.setActive(v,r);});};a._visitVisualizations=function(p,v){if(!v){return;}p.getContent()[0].getSections().forEach(function(s){s.getVisualizations().forEach(v);});};a._onShellNavigated=function(){return this._oURLParsingService.then(function(u){var h=window.hasher.getHash();var H=u.parseShellHash(h);if(h==="Shell-home"||(H.semanticObject==="Launchpad"&&H.action==="openFLPPage")){this._setCurrentPageVisibility(true,true);}else{this._setCurrentPageVisibility(false,false);}}.bind(this));};a._onTabNavigated=function(){return this._oURLParsingService.then(function(u){var h=window.hasher.getHash();var H=u.parseShellHash(h);if(h==="Shell-home"||(H.semanticObject==="Launchpad"&&H.action==="openFLPPage")){this._setCurrentPageVisibility(!document.hidden);}}.bind(this));};a._onPageNavigated=function(e){var p=e.getParameters();this._setPageVisibility(p.from,false,false);this._setPageVisibility(p.to,true,true);};a._onErrorPageNavigated=function(e){var t=e.getParameter("to");this._setCurrentPageVisibility(!t.isA("sap.m.MessagePage"),undefined,true);};a.getPageVisibility=function(p){return this.oPagesVisibility[p];};a.exit=function(){this.oEventBus.unsubscribe("sap.ushell","navigated",this._onPageNavigated,this);document.removeEventListener("visibilitychange",this._onTabNavigatedBind);this.oPagesNavContainer.detachNavigate(this._onPageNavigated,this);this.oPagesRuntimeNavContainer.detachNavigate(this._onErrorPageNavigated,this);this.oEventBus.unsubscribe("launchpad","setConnectionToServer",this._onEnableRequests,this);this.oEventHubListener.off();};return a;});
