//Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/library","sap/m/MessageBox","sap/m/MessageToast","sap/ushell/resources","sap/ushell/EventHub","sap/base/Log","sap/ushell/renderers/fiori2/AccessKeysHandler"],function(c,M,a,r,E,L,A){"use strict";var b={};b.start=function(C){this.oController=C;C.getView().getModel("viewSettings").setProperty("/actionModeActive",true);E.emit("enableMenuBarNavigation",false);var o=sap.ui.getCore().byId("ActionModeBtn");var s=r.i18n.getText("PageRuntime.EditMode.Exit");o.setTooltip(s);o.setText(s);A.attachEvent("editModeDone",this.save,this);};b.cancel=function(){this._cleanup();};b.save=function(){L.info("store actions in pages service");this._cleanup();};b._cleanup=function(){this.oController.getView().getModel("viewSettings").setProperty("/actionModeActive",false);E.emit("enableMenuBarNavigation",true);var o=sap.ui.getCore().byId("ActionModeBtn");var s=r.i18n.getText("PageRuntime.EditMode.Activate");o.setTooltip(s);o.setText(s);A.detachEvent("editModeDone",this.save,this);};b.addVisualization=function(e,s){var m=s.getBindingContext().getModel();var p=s.getBindingContext().getPath();var P=p.split("/");var i=parseInt(P[2],10);var d=m.getProperty("/pages/"+i+"/id");var S=m.getProperty(p+"/id");sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(C){var f="Shell-appfinder?&/catalog/"+JSON.stringify({pageID:encodeURIComponent(d),sectionID:encodeURIComponent(S)});C.toExternal({target:{shellHash:f}});});};b.addSection=function(e,s,p){var S=p.index;var P=s.getBindingContext().getPath();var d=P.split("/");var i=parseInt(d[2],10);return this.oController.getOwnerComponent().getPagesService().then(function(o){o.addSection(i,S);var D={onAfterRendering:function(){setTimeout(function(){s.getSections()[S].byId("title-edit").focus();},0);s.removeEventDelegate(D);}};s.addEventDelegate(D);});};b.deleteSection=function(e,s){return sap.ushell.Container.getServiceAsync("Message").then(function(m){var t=s.getTitle();var d=t?r.i18n.getText("PageRuntime.Message.Section.Delete",t):r.i18n.getText("PageRuntime.Message.Section.DeleteNoTitle");var f=r.i18n.getText("PageRuntime.Dialog.Title.Delete");function C(o){if(o===M.Action.DELETE){this.oController.getOwnerComponent().getPagesService().then(function(p){var P=s.getBindingContext().getPath(),g=s.getParent(),h=P.split("/"),i=parseInt(h[2],10),S=parseInt(h[4],10);p.deleteSection(i,S);a.show(r.i18n.getText("PageRuntime.MessageToast.SectionDeleted"));var j=g.getSections();if(j.length){var k=j[S!==0?S-1:S];k.focus();var l={onAfterRendering:function(){k.focus();k.removeEventDelegate(l);}};k.addEventDelegate(l);}else{var n={onAfterRendering:function(){g.focus();g.removeEventDelegate(n);}};g.addEventDelegate(n);}});}}m.confirm(d,C.bind(this),f,[M.Action.DELETE,M.Action.CANCEL]);}.bind(this));};b.resetSection=function(e,s){var p=s.getBindingContext().getPath();var P=p.split("/");var i=parseInt(P[2],10);var S=parseInt(P[4],10);return this.oController.getOwnerComponent().getPagesService().then(function(o){o.resetSection(i,S);a.show(r.i18n.getText("PageRuntime.MessageToast.SectionReset"));});};b.changeSectionTitle=function(e,s,p){var P=s.getBindingContext().getPath();var n=s.getProperty("title");var d=P.split("/");var i=parseInt(d[2],10);var S=parseInt(d[4],10);return this.oController.getOwnerComponent().getPagesService().then(function(o){o.renameSection(i,S,n);});};b.moveSection=function(e,s,p){var S=p.draggedControl.getBindingContext().getPath();var t=p.droppedControl.getBindingContext().getPath();var d=p.dropPosition;var T=t.split("/");var f=S.split("/");var P=parseInt(f[2],10);var i=parseInt(f[4],10);var g=parseInt(T[4],10);if(i===g-1&&d==="Before"||i===g+1&&d==="After"){return Promise.resolve();}if(d==="After"){g=g+1;}var C=this.oController.getOwnerComponent();return C.getPagesService().then(function(o){return o.moveSection(P,i,g);}).then(function(){s.announceMove();});};b.changeSectionVisibility=function(e,s,p){if(this.oController===undefined||p.visible===undefined){return Promise.resolve();}var P=s.getBindingContext().getPath();var v=p.visible;var d=P.split("/");var i=parseInt(d[2],10);var S=parseInt(d[4],10);return this.oController.getOwnerComponent().getPagesService().then(function(o){o.setSectionVisibility(i,S,v);});};return b;});
