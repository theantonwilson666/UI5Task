// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/TileContainer","sap/ui/Device","sap/ushell/components/factsheet/controls/PictureTile","sap/ushell/library","./PictureViewerRenderer"],function(T,D,P){"use strict";var a=T.extend("sap.ushell.components.factsheet.controls.PictureViewer",{metadata:{deprecated:true,library:"sap.ushell",properties:{tileScaling:{type:"float",group:"Misc",defaultValue:0.95},removable:{type:"boolean",group:"Misc",defaultValue:false}},defaultAggregation:"items",aggregations:{items:{type:"sap.ushell.components.factsheet.controls.PictureViewerItem",multiple:true,singularName:"item"}},events:{pictureDeleted:{}}}});a.prototype.init=function(){T.prototype.init.apply(this);this.setEditable(false);if(sap.ui.getCore().isMobile()){jQuery(window).bind("tap",this._reset.bind(this));var s=sap.ui.getCore().getStaticAreaRef();this.$blocker=jQuery("<div class='sapCaPVBly sapUiBLy'></div>").css("visibility","hidden");jQuery(s).append(this.$blocker);}if(!sap.ui.getCore().isMobile()){jQuery(window).bind("resize",this._resize.bind(this));}this.addStyleClass("sapCaPW");this.addStyleClass("sapCaPWRendering");};a.prototype._resize=function(){if(this._oDragSession){return;}setTimeout(function(){this._applyDimension();this._update(false);delete this._iInitialResizeTimeout;}.bind(this),this._iInitialResizeTimeout);this._iInitialResizeTimeout=0;};a.prototype.exit=function(){this.$blocker.remove();if(!sap.ui.getCore().isMobile()){jQuery(window).unbind("resize",this._resize.bind(this));}T.prototype.exit.apply(this);if(!D.system.desktop){jQuery(window).unbind("tap",this._reset.bind(this));}};a.prototype.setTileScaling=function(t){if(t<0||t>1){t=0.75;jQuery.sap.log.error("Tile Scaling should be a float value between 0 and 1 and not "+t+". Setting it to 0.75 by default.");}this.setProperty("tileScaling",t);};a.prototype.addItem=function(i){this.insertItem(i,this.getItems().length);};a.prototype.insertItem=function(i,I){var t=new P({tileContent:i});t.attachPictureDelete(this._deletePictureRequestHandler.bind(this));this.insertTile(t,I);this.insertAggregation("items",i,I);return this;};a.prototype.insertTile=function(t){t.attachPictureDelete(jQuery.proxy(this._deletePictureRequestHandler,this));T.prototype.insertTile.apply(this,arguments);};a.prototype.deleteTile=function(t){T.prototype.deleteTile.apply(this,arguments);t.destroy();};a.prototype.deletePicture=function(i){var p,b,n;n=this.getTiles().length;if(typeof i!=="number"||i<0||i>=n){p=this.getPageFirstTileIndex();}else{p=i;}if(p>-1){b=this.getTiles()[p];b.detachPictureDelete(jQuery.proxy(this._deletePictureRequestHandler,this));this.deleteTile(b);this.removeAggregation("items",p,true);}else{jQuery.sap.log.warning("Cannot find and delete a picture at index : "+i);}return this;};a.prototype.selectPicture=function(i){var n=this.getTiles().length;if(typeof i!=="number"){i=0;}else if(i<0){i=0;}else if(i>=n){i=n-1;}if(this._bRendered){this.addStyleClass("sapCaPWRendering");}this._selectedIndex=i;return this;};a.prototype.setSelectedIndex=function(i){this.selectPicture(i);};a.prototype.getCurrentPictureIndex=function(){return this.getPageFirstTileIndex();};a.prototype._deletePictureRequestHandler=function(e){var p=this.indexOfTile(e.getSource());this.deleteTile(e.getSource());this.firePictureDeleted({index:p});};a.prototype._reset=function(e){var i=this.getCurrentPictureIndex();var t=this.getTiles();if(i>-1&&t&&t.length>i){var o=t[i];if(o){var $=jQuery(e.target);var b=this.$();if(b.length>0&&$.length>0){var c=$.closest(this.$());if(c.length===0){o.switchVisibility(false);}}}}};a.prototype.setRemovable=function(v){this.setProperty("removable",v,true);this.toggleStyleClass("sapCaPWEditable",v);};a.prototype.setEditable=function(){T.prototype.setEditable.call(this,false);};a.prototype._getTileDimension=function(){if(!this._bRendered){return;}var $=jQuery.sap.byId(this.getId()+"-scrl");var t={width:$.width(),height:$.height()};return t;};a.prototype.onBeforeRendering=function(){this.addStyleClass("sapCaPWRendering");};a.prototype.onAfterRendering=function(){var t=this;this._bRendered=true;this._applyDimension();this.$().toggleClass("sapCaPWEditable",this.getRemovable()===true);this._sInitialResizeTimeoutId=setTimeout(function(){t.addStyleClass("sapCaPWRendering");t._applyPageStartIndex(t._selectedIndex);t._update(false);},this._iInitialResizeTimeout);if(D.system.desktop){var f=this.getTiles()[0],i=this._iInitialResizeTimeout;if(f){setTimeout(function(){this._findTile(f.$()).focus();}.bind(this),i);}}};a.prototype._update=function(){T.prototype._update.apply(this,arguments);this.removeStyleClass("sapCaPWRendering");if(sap.ui.getCore().isMobile()){var t=this;var b=this.$blocker;setTimeout(function(){b.fadeOut(200,function(){t.css("visibility","hidden").css("z-index",0);});},250);}};a.prototype._applyDimension=function(){var d=this._getContainerDimension(),i=this.getId(),$=this.$(),t,o=10,b=60,c=jQuery.sap.byId(i+"-cnt"),e,f,p=jQuery.sap.byId(i+"-pager").outerHeight();jQuery.sap.byId(i+"-scrl").css({width:d.outerwidth+"px",height:(d.outerheight-p)+"px"});c.css({height:(d.outerheight-p)+"px",visibility:"visible"});$.css("visibility","visible");t=$.position();e=c.position();f=c.outerHeight();if(jQuery.device.is.phone){o=2;}else if(D.system.desktop){o=0;}jQuery.sap.byId(i+"-blind").css({top:(e.top+o)+"px",left:(e.left+o)+"px",width:(c.outerWidth()-o)+"px",height:(f-o)+"px"});jQuery.sap.byId(i+"-rightedge").css({top:(t.top+o+b)+"px",right:o+"px",height:(f-o-b)+"px"});jQuery.sap.byId(i+"-leftedge").css({top:(t.top+o+b)+"px",left:(t.left+o)+"px",height:(f-o-b)+"px"});};a.prototype.showBlockerLayer=function(c){if(sap.ui.getCore().isMobile()){var b=20;jQuery(sap.ui.getCore().getStaticAreaRef()).children().each(function(i,v){var z=parseInt(jQuery(v).css("z-index"),10);if(!isNaN(z)){b=Math.max(b,z);}});jQuery.sap.log.debug("blocker layer z-index calculated : "+b+1);this.$blocker.css("z-index",b+1).css("visibility","visible").fadeIn(200,function(){if(c){c.call();}});}else if(c){c.call();}};return a;});
