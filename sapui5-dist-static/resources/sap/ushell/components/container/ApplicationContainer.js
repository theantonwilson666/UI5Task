// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/security/encodeXML","sap/base/util/deepEqual","sap/base/util/uid","sap/base/util/UriParameters","sap/m/MessagePopover","sap/m/Text","sap/ui/core/Component","sap/ui/core/ComponentContainer","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/Device","sap/ui/thirdparty/URI","sap/ushell/ApplicationType","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/library","sap/ushell/resources","sap/ushell/System","sap/ushell/User","sap/ushell/utils"],function(L,a,d,g,U,M,T,C,b,c,I,D,f,A,h,E,u,r,S,j,k){"use strict";var P="sap.ushell.components.container.",s=P+"ApplicationContainer",l="sap.ushell.Container.dirtyState.",m="autoplay;battery;camera;display-capture;geolocation;gyroscope;magnetometer;microphone;midi;clipboard-write;clipboard-read;fullscreen",n,o,H,R,q=false,K=false,t=[],v=0;var w=["sap-ach","sap-fiori-id","sap-hide-intent-link","sap-priority","sap-tag","sap-ui-app-id-hint","sap-ui-debug","sap-ui-fl-control-variant-id","sap-ui-fl-max-layer","sap-ui-tech-hint","sap-ui2-tcode","sap-ui2-wd-app-id","sap-ui2-wd-conf-id","sap-ushell-cdm-site-url","sap-ushell-defaultedParameterNames","sap-ushell-navmode","sap-ushell-next-navmode","sap-ushell-url","sap-app-origin-hint"];function x(e){var i=sap.ushell.Container.getService("CrossApplicationNavigation");i.isUrlSupported(e.url).done(function(){e.promise.resolve({allowed:true,id:e.id});}).fail(function(){e.promise.resolve({allowed:false,id:e.id});});}function y(e){var i={asyncURLHandler:r1.prototype._adaptIsUrlSupportedResultForMessagePopover};if(M&&M.setDefaultHandlers){M.setDefaultHandlers(i);}E.emit("StepDone",e.stepName);}E.once("initMessagePopover").do(y);n=new k.Map();function z(e){return n.get(e.getId());}function B(){return o;}function F(e){var p=new U(e).mParams,i=p["sap-xapp-state"],s1;delete p["sap-xapp-state"];s1={startupParameters:p};if(i){s1["sap-xapp-state"]=i;}return s1;}function G(e,i){if(!R){R=jQuery.sap.resources({url:jQuery.sap.getModulePath(P)+"/resources/resources.properties",language:sap.ui.getCore().getConfiguration().getLanguage()});}return R.getText(e,i);}function J(){return new I({size:"2rem",src:"sap-icon://error",tooltip:r1.prototype._getTranslatedText("an_error_has_occured")});}function N(e){var i=e.getAggregation("child"),p;if(i instanceof b){p=i.getComponentInstance().getMetadata().getName().replace(/\.Component$/,"");L.debug("unloading component "+p,null,s);}e.destroyAggregation("child");}function O(e,i,p){return new Promise(function(s1){var t1,u1,v1,w1,x1,y1={},z1,A1;function B1(D1){D1.setWidth(e.getWidth());D1.setHeight(e.getHeight());D1.addStyleClass("sapUShellApplicationContainer");e.setAggregation("child",D1,true);}t1=i.indexOf("?");if(t1>=0){w1=r1.prototype._getParameterMap(i);y1=w1.startupParameters;i=i.slice(0,t1);}if(i.slice(-1)!=="/"){i+="/";}if(/\.view\.(\w+)$/i.test(p)){v1=/^SAPUI5=(?:([^/]+)\/)?([^/]+)\.view\.(\w+)$/i.exec(p);if(!v1){L.error("Invalid SAPUI5 URL",p,s);s1(r1.prototype._createErrorControl());return;}x1=v1[1];z1=v1[2];A1=v1[3].toUpperCase();if(x1){z1=x1+"."+z1;}else{u1=z1.lastIndexOf(".");if(u1<1){L.error("Missing namespace",p,s);return r1.prototype._createErrorControl();}x1=z1.slice(0,u1);}}else{x1=p.replace(/^SAPUI5=/,"");}jQuery.sap.registerModulePath(x1,i+x1.replace(/\./g,"/"));r1.prototype._destroyChild(e);if(z1){if(e.getApplicationConfiguration()){y1.config=e.getApplicationConfiguration();}sap.ui.view({id:e.getId()+"-content",type:A1,viewData:y1||{},viewName:z1,async:true}).loaded().then(function(D1){e.fireEvent("applicationConfiguration");B1(D1);s1(D1);});}else{L.debug("loading component "+x1,null,s);var C1=w1?{startupParameters:w1.startupParameters}:{startupParameters:{}};if(w1&&w1["sap-xapp-state"]){C1["sap-xapp-state"]=w1["sap-xapp-state"];}if(e.getApplicationConfiguration()){C1.config=e.getApplicationConfiguration();}sap.ui.core.Component.create({id:e.getId()+"-component",componentData:C1,name:x1}).then(function(D1){e.fireEvent("applicationConfiguration",{"configuration":D1.getMetadata().getConfig()});var E1=new b({id:e.getId()+"-content",component:D1});B1(E1);s1(E1);});}});}function Q(e,i){setTimeout(function(){sap.ui.getCore().getEventBus().publish("sap.ushell",e,i);},0);}function V(e,i,p){var s1=this,t1,u1={oControl:undefined,oPromise:undefined},v1,w1,x1,y1={startupParameters:{}},z1,A1=e.getComponentHandle(),B1=sap.ushell.Container.getService("PluginManager"),C1,D1;function E1(F1){e.fireEvent("applicationConfiguration",{configuration:F1.getMetadata().getConfig()});w1=new b({id:e.getId()+"-content",component:F1});w1.setHeight(e.getHeight());w1.setWidth(e.getWidth());w1.addStyleClass("sapUShellApplicationContainer");e._disableRouterEventHandler=r1.prototype._disableRouter.bind(s1,F1);sap.ui.getCore().getEventBus().subscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",e._disableRouterEventHandler);e.setAggregation("child",w1,true);if(B1){C1=B1.getPluginLoadingPromise("RendererExtensions");D1=C1&&C1.state();if(D1==="pending"){C1.done(function(){r1.prototype._publishExternalEvent("appComponentLoaded",{component:F1});}).fail(function(){r1.prototype._publishExternalEvent("appComponentLoaded",{component:F1});});}if(D1==="resolved"||D1==="rejected"){r1.prototype._publishExternalEvent("appComponentLoaded",{component:F1});}}else{r1.prototype._publishExternalEvent("appComponentLoaded",{component:F1});}return w1;}v1=i.indexOf("?");if(v1>=0){x1=r1.prototype._getParameterMap(i);y1={startupParameters:x1.startupParameters};if(x1["sap-xapp-state"]){y1["sap-xapp-state"]=x1["sap-xapp-state"];}i=i.slice(0,v1);}if(e.getApplicationConfiguration()){y1.config=e.getApplicationConfiguration();}if(i.slice(-1)!=="/"){i+="/";}r1.prototype._destroyChild(e);z1={id:e.getId()+"-component",name:p,componentData:y1};L.debug("Creating component instance for "+p,JSON.stringify(z1),s);sap.ui.getCore().getEventBus().publish("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",{name:p});if(A1){var F1=A1.getInstance(z1);u1.oControl=E1(F1);}else{t1=new jQuery.Deferred();jQuery.sap.registerModulePath(p,i);L.error("No component handle available for '"+p+"'; fallback to component.load()",null,s);sap.ui.component({id:e.getId()+"-component",name:p,componentData:y1,async:true}).then(function(F1){t1.resolve(E1(F1));});u1.oPromise=t1.promise();}return u1;}function W(e){var i;if((e instanceof C)&&(typeof e.getRouter==="function")){i=e.getRouter();if(i&&(typeof i.stop==="function")){L.info("router stopped for instance "+e.getId());i.stop();}}}function X(e){var i=document.createElement("a"),p=new U(e).get("sap-client"),s1;i.href=e;s1=i.protocol+"//"+i.host;return new S({alias:p?s1+"?sap-client="+p:s1,baseUrl:s1,client:p||undefined,platform:"abap"});}function Y(e,i){var p=false,s1=e.getDomRef(),t1,u1;if(e.getIframeWithPost()===true&&s1&&s1.getAttribute&&s1.getAttribute("sap-iframe-app")=="true"){s1=jQuery("#"+s1.getAttribute("id")+"-iframe")[0];}if(s1){t1=f(e._getIFrameUrl(s1)||window.location&&window.location.href||"");u1=t1.protocol()+"://"+t1.host();p=(i.source===s1.contentWindow)||(i.origin===u1);}return p;}function Z(e,i,p){var s1=JSON.stringify({type:"request",service:i,request_id:g(),body:{}});L.debug("Sending post message request to origin ' "+p+"': "+s1,null,"sap.ushell.components.container.ApplicationContainer");e.postMessage(s1,p);}function $(){var i=this.getDomRef();if(!i||i.tagName!=="IFRAME"){if(this.getIframeWithPost()===true&&i&&i.getAttribute&&i.getAttribute("sap-iframe-app")=="true"){return jQuery("#"+i.getAttribute("id")+"-iframe")[0];}return null;}return i;}function _(i){var e;if(i===undefined){i=this._getIFrame();}if(this.getIframeWithPost()===true){e=jQuery("#"+i.getAttribute("id").replace("-iframe","-form"))[0].action;if(e===undefined&&(new f()).query(true).hasOwnProperty("sap-isolation-enabled")){e=i.src;}}else{e=i.src;}return e;}function a1(e,i){if(e&&!e.getActive()){L.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(s1)+"' on inactive container '"+e.getId()+"'","Only active containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}var p=e.getUi5ComponentName&&e.getUi5ComponentName(),s1=i.data;if(typeof p==="string"){L.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(s1)+"' on container of UI5 application '"+p+"'","Only non UI5 application containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}var t1={bApiRegistered:true};H(e,i,t1);r1.prototype._handlePostMessagesForPluginsPostLoading(e,i,t1);}function b1(e,p,s1){var t1,u1,v1;if(s1.bApiRegistered!==false){return;}if(q===false){q=true;t1=sap.ushell.Container.getService("PluginManager");if(t1){u1=t1.getPluginLoadingPromise("RendererExtensions");v1=u1&&u1.state();if(v1==="pending"){K=true;u1.done(function(){var w1;K=false;L.debug("Processing post messages queue after 'RendererExtensions' plugins loaded, queue size is: "+t.length,null,"sap.ushell.components.container.ApplicationContainer");for(var i=0;i<t.length;i++){w1=t[i];try{r1.prototype._handleMessageEvent.call(w1.that,w1.oContainer,w1.oMessage);}catch(ex){L.error(ex.message||ex,null,"sap.ushell.components.container.ApplicationContainer");}}t=[];});}}}if(K===true){t.push({index:v++,that:this,oContainer:e,oMessage:p});}}function c1(){q=false;K=false;t=[];v=0;}function d1(e,i){var p=e._getIFrame(),s1=e.getApplicationType();if(k.isApplicationTypeEmbeddedInIframe(e.getApplicationType(s1))&&p){var t1=new f(e._getIFrameUrl(p));var u1=t1.protocol()+"://"+t1.host();p.contentWindow.postMessage(JSON.stringify({action:"pro54_disableDirtyHandler"}),u1);i.preventDefault();}}function e1(e,i,p){e.write("<div").writeControlData(i).writeAccessibilityState(i).addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles().write(">");if(p){e.renderControl(p);}e.write("</div>");}function f1(e,i,p){if(k.isApplicationTypeEmbeddedInIframe(i)){var s1=e.getTargetNavigationMode();p=r1.prototype._adjustNwbcUrl(p,i,s1,e.getIsStateful());k.localStorageSetItem(e.globalDirtyStorageKey,sap.ushell.Container.DirtyState.INITIAL);}return p;}function g1(e,i,p,s1){var t1,u1=function(){var C1=k.getParameterValueBoolean("sap-accessibility");if(C1!==undefined){return C1;}return sap.ushell.Container.getUser().getAccessibilityMode();},v1=function(){var C1=new U(e)||{mParams:{}};if(C1.mParams["sap-theme"]===undefined){return sap.ushell.Container.getUser().getTheme(j.prototype.constants.themeFormat.NWBC);}return undefined;},w1=function(){var C1=false,D1=new U(e)||{mParams:{}};C1=sap.ui.getCore().getConfiguration().getStatistics()&&D1.mParams["sap-statistics"]===undefined;return C1;},x1=function(){var C1=window.hasher&&window.hasher.getHash(),z1="",D1;if(C1&&C1.length>0&&C1.indexOf("sap-iapp-state=")>0){D1=/(?:sap-iapp-state=)([^&/]+)/.exec(C1);if(D1&&D1.length===2){z1=D1[1];}}return z1;},y1=function(){var C1="";var D1=(!!jQuery("body.sapUiSizeCompact").length);var E1=(!!jQuery("body.sapUiSizeCozy").length);if(D1===true){C1="0";}else if(E1){C1="1";}return C1;};e+=e.indexOf("?")>=0?"&":"?";e+="sap-ie=edge";t1=v1();if(t1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-theme="+encodeURIComponent(t1);}if(p){e+=e.indexOf("?")>=0?"&":"?";e+="sap-target-navmode="+encodeURIComponent(p);}if(u1()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-accessibility=X";}if(w1()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-statistics=true";}if((i==="TR"||i==="GUI")&&new U(document.URL).get("sap-guitest")==="true"){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=2";}else if(s1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=1";}var z1=x1();if(z1&&z1.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-iapp-state="+z1;}var A1=y1();if(A1&&A1.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-touch="+A1;}var B1=0;if(h.last("/core/shell/sessionTimeoutIntervalInMinutes")>0){B1=h.last("/core/shell/sessionTimeoutIntervalInMinutes");}e+=e.indexOf("?")>=0?"&":"?";e+="sap-ushell-timeout="+B1;return k.appendSapShellParam(e,i);}function h1(e,i,p,s1){var t1=i.getAggregation("child"),u1,v1;if(!t1||i._bRecreateChild){v1=r1.prototype._createUi5Component(i,p,s1);if(v1.oControl!==undefined){i._bRecreateChild=false;r1.prototype._renderControlInDiv(e,i,v1.oControl);}else{i.oDeferredControlCreation=new jQuery.Deferred();r1.prototype._renderControlInDiv(e,i);v1.oPromise.then(function(w1){i._bRecreateChild=false;u1=sap.ui.getCore().createRenderManager();u1.renderControl(w1);u1.flush(jQuery("#"+i.getId())[0]);u1.destroy();i.oDeferredControlCreation.resolve();});}}else{r1.prototype._renderControlInDiv(e,i,t1);}}function i1(e,i,p){var s1=e.getProperty(i);if(d(s1,p)){return;}e.setProperty(i,p);e._bRecreateChild=true;}function j1(e,i,p,s1,t1){var u1,v1=true;localStorage.removeItem(i.globalDirtyStorageKey);i.oDeferredControlCreation=undefined;if(t1&&t1.indexOf("SAPUI5.Component=")===0&&p===A.URL.type){h1(e,i,s1,t1.replace(/^SAPUI5\.Component=/,""));return;}if(t1&&t1.indexOf("SAPUI5=")===0&&p===A.URL.type){r1.prototype._renderControlInDiv(e,i,undefined,"open");i.oDeferredControlCreation=new jQuery.Deferred();r1.prototype._createUi5View(i,s1,t1).then(function(w1){var B1,C1=jQuery("#"+i.getId());if(C1&&C1.length>0){B1=sap.ui.getCore().createRenderManager();B1.renderControl(w1);B1.flush(jQuery("#"+i.getId())[0]);B1.destroy();}else{e.renderControl(w1);}i.oDeferredControlCreation.resolve();});r1.prototype._renderControlInDiv(e,i,undefined,"close");return;}L.debug("Not resolved as \"SAPUI5.Component=\" or \"SAPUI5=\" , "+"will attempt to load into iframe "+t1);if(!i.getActive()){L.debug("Skipping rendering container iframe","Container '"+i.getId()+"' is inactive");return;}try{s1=i.getFrameSource(p,s1,t1);}catch(ex){L.error(ex.message||ex,null,s);i.fireEvent("applicationConfiguration");e.renderControl(r1.prototype._createErrorControl());return;}if(sap.ushell.Container){u1=r1.prototype._getLogoutHandler(i);if(!u1){if(k.isApplicationTypeEmbeddedInIframe(p)){u1=r1.prototype._logout.bind(null,i);n.put(i.getId(),u1);sap.ushell.Container.attachLogoutEvent(u1);sap.ushell.Container.addRemoteSystem(r1.prototype._createSystemForUrl(s1));}}else if(!k.isApplicationTypeEmbeddedInIframe(p)){sap.ushell.Container.detachLogoutEvent(u1);n.remove(i.getId());}}s1=r1.prototype._checkNwbcUrlAdjustment(i,p,s1);var x1=new U(document.URL);s1=i._adjustURLForIsolationOpeningWithoutURLTemplate(s1);if(p==="TR"){if(x1.get("sap-post-params")==="true"){i.setProperty("iframePostAllParams",true,true);}}if(new U(window.location.href).get("sap-post")==="false"){v1=false;}else if(window.QUnit!==undefined){v1=i.getIframeWithPost();}if(v1===true&&(p==="NWBC"||p==="TR"||p==="WDA")){i.setProperty("iframeWithPost",true,true);i.oDeferredRenderer=new jQuery.Deferred();s1=r1.prototype._filterURLParams(s1);var y1=[];var z1=r1.prototype._getParamKeys(s1,y1);r1.prototype._generateRootElementForIFrame(e,i,true);if(z1.length>0){var A1=sap.ushell.Container.getService("CrossApplicationNavigation");A1.getAppStateData(z1).then(function(w1){var B1;var C1=jQuery("#"+i.getId());if(C1.length>0){B1=sap.ui.getCore().createRenderManager();r1.prototype._buildHTMLElements(B1,i,w1,y1,s1,true,x1);B1.flush(C1[0]);B1.destroy();}else{r1.prototype._buildHTMLElements(e,i,w1,y1,s1,true,x1);}setTimeout(i.oDeferredRenderer.resolve,0);},function(w1){r1.prototype._buildHTMLElements(e,i,undefined,y1,s1,true,x1);setTimeout(i.oDeferredRenderer.resolve,0);});}else{r1.prototype._buildHTMLElements(e,i,undefined,y1,s1,false,x1);setTimeout(i.oDeferredRenderer.resolve,0);}r1.prototype._generateRootElementForIFrame(e,i,false);return;}i.fireEvent("applicationConfiguration");e.write("<iframe").writeControlData(i).writeAccessibilityState(i).writeAttributeEscaped("src",s1).writeAttributeEscaped("title",r.i18n.getText("AppilcationContainer.IframeTitle")).addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles();if(h.last("/core/shell/enableFeaturePolicyInIframes")===true){e.writeAttribute("allow",m);}e.write("></iframe>");}function k1(e){var i=new U(document.URL);if(i.get("sap-isolation-enabled")==="true"){var p=sap.ushell.Container.getService("URLParsing"),s1=p.getHash(document.URL),t1="",u1="&sap-plugins="+encodeURIComponent(sap.ushell.Container.getService("PluginManager")._getNamesOfPluginsWithAgents());if(e.indexOf("&/")>0){t1=e.substr(e.indexOf("&/"));}if(u1==="&sap-plugins="){u1="";}if(s1){var v1=p.parseShellHash("#"+s1),w1=p.paramsToString(v1.params);if(w1&&w1.length>=0){var x1=sap.ushell.Container.getService("AppState").createEmptyAppState(),y1=sap.ushell.Container.getService("AppState").createEmptyAppState(),z1="";if(w1.indexOf("sap-intent-param")>=0){z1=encodeURIComponent(w1);}else{x1.setData(w1);x1.save();z1=encodeURIComponent("sap-intent-param="+x1.getKey());}y1.setData("sap-startup-params="+z1);y1.save();e=e.split("#")[0]+"&sap-intent-param="+y1.getKey()+u1+"#"+window.hasher.getHash();}else{e=e.split("#")[0]+u1+"#"+window.hasher.getHash();}}else{e+="#"+window.hasher.getHash();}if(e.indexOf("&/")<0){e+=t1;}}if(i.has("sap-iframe-params")){var A1=i.get("sap-iframe-params")||"",B1=A1.split(",");B1.forEach(function(C1){if(C1&&C1.length>0){if(i.has(C1)){e=e.split("#")[0]+"&"+C1+"="+i.get(C1)+"#"+e.split("#")[1];}}});}return e;}function l1(e){var i=new f(e);i=i.removeSearch(w);return i.toString();}function m1(e,i){var p=[],s1;if(e.indexOf("sap-intent-param=")>0){s1=/(?:sap-intent-param=)([^&/]+)/.exec(e);if(s1&&s1.length===2){p.push([s1[1]]);i.push("sap-intent-param-data");}}if(e.indexOf("sap-xapp-state=")>0){s1=/(?:sap-xapp-state=)([^&/]+)/.exec(e);if(s1&&s1.length===2){p.push([s1[1]]);i.push("sap-xapp-state-data");}}if(e.indexOf("sap-iapp-state=")>0){s1=/(?:sap-iapp-state=)([^&/]+)/.exec(e);if(s1&&s1.length===2){p.push([s1[1]]);i.push("sap-iapp-state-data");}}return p;}function n1(e,i,p,s1,t1,u1,v1){var w1=i.getId()+"-form",x1="",y1="",z1=false;if(p===undefined){p=[];}p.push([sap.ushell.Container.getFLPUrl(true)]);s1.push("sap-flp-url");p.push([i.getSystemAlias()]);s1.push("system-alias");var A1="";var B1={};s1.forEach(function(F1,G1){if(p[G1][0]){B1[F1]=p[G1][0];}});var C1=t1;A1=JSON.stringify(B1);x1="<input name=\"sap-flp-params\" value=\""+a(A1)+"\">";if(i.getIframePostAllParams()===true){i.setProperty("iframePostAllParams",false,true);var D1=new U(t1);y1=o1(i,D1);if(y1!==""){t1=p1(t1,D1);}}i.fireEvent("applicationConfiguration");e.write("<form").writeAttributeEscaped("method","post").writeAttributeEscaped("id",w1).writeAttributeEscaped("name",w1).writeAttributeEscaped("target",i.getId()+"-iframe").writeAttributeEscaped("action",t1).addStyle("display","none").writeStyles().write(">").writeAttributeEscaped(x1+y1).write("</form>");var E1=i.sId;if(!u1&&i.hasStyleClass("hidden")){z1=true;i.toggleStyleClass("hidden",false);}i.sId+="-iframe";e.write("<iframe").writeAttributeEscaped("name",i.getId()).writeControlData(i).writeAccessibilityState(i).writeAttributeEscaped("sap-orig-src",C1).writeAttributeEscaped("title",r.i18n.getText("AppilcationContainer.IframeTitle")).addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles();if(h.last("/core/shell/enableFeaturePolicyInIframes")===true){e.writeAttribute("allow",m);}e.write("></iframe>");i.sId=E1;if(z1){i.toggleStyleClass("hidden",true);}}function o1(e,i){var s1="";var t1="",u1="";if(i.has("sap-iframe-hint")){s1=i.get("sap-iframe-hint");}var v1=i.mParams;if(e.getApplicationType()==="TR"||(s1==="GUI")){var p,w1;for(p in v1){if(p==="sap-iframe-hint"){continue;}w1=v1[p][0];t1="<input name=\""+p+"\" value=\""+a(w1)+"\">";u1+=t1;}}return u1;}function p1(e,i){var p=i.get("sap-iframe-hint");return e.split("?")[0]+(typeof p==="string"?"?sap-iframe-hint="+p:"");}function q1(e,i,p){if(p){e.write("<div").writeControlData(i).writeAttributeEscaped("sap-iframe-app","true").addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles().write(">");}else{e.write("</div>");}}var r1=c.extend(s,{metadata:{properties:{additionalInformation:{defaultValue:"",type:"string"},application:{type:"object"},applicationConfiguration:{type:"object"},applicationType:{defaultValue:"URL",type:P+"ApplicationType"},height:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},navigationMode:{defaultValue:"",type:"string"},targetNavigationMode:{defaultValue:"",type:"string"},text:{defaultValue:"",type:"string"},url:{defaultValue:"",type:"string"},visible:{defaultValue:true,type:"boolean"},active:{defaultValue:true,type:"boolean"},"sap-system":{type:"string"},applicationDependencies:{type:"object"},componentHandle:{type:"object"},ui5ComponentName:{type:"string"},width:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},shellUIService:{type:"object"},appIsolationService:{type:"object"},reservedParameters:{type:"object"},coreResourcesFullyLoaded:{type:"boolean"},isStateful:{defaultValue:false,type:"boolean"},iframeHandlers:{defaultValue:"",type:"string"},iframeWithPost:{defaultValue:false,type:"boolean"},beforeAppCloseEvent:{type:"object"},isPostCapability:{defaultValue:false,type:"boolean"},extendedInfo:{type:"object"},systemAlias:{defaultValue:"",type:"string"},iframePostAllParams:{defaultValue:false,type:"boolean"}},events:{applicationConfiguration:{}},aggregations:{child:{multiple:false,type:"sap.ui.core.Control",visibility:"hidden"}},library:"sap.ushell",designtime:"sap/ushell/designtime/ApplicationContainer.designtime"},exit:function(){var e,i=this;if(sap.ushell.Container){e=r1.prototype._getLogoutHandler(i);if(e){sap.ushell.Container.detachLogoutEvent(e);n.remove(i.getId());}}localStorage.removeItem(i.globalDirtyStorageKey);if(i._unloadEventListener){removeEventListener("unload",i._unloadEventListener);}if(i._disableRouterEventHandler){sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",i._disableRouterEventHandler);}if(i._storageEventListener){removeEventListener("storage",i._storageEventListener);}if(i._messageEventListener){removeEventListener("message",i._messageEventListener);}r1.prototype._destroyChild(i);if(c.exit){c.exit.apply(i);}},setHandleMessageEvent:function(i){H=i;},init:function(){var e=this;e.globalDirtyStorageKey=l+g();e._unloadEventListener=e.exit.bind(e);addEventListener("unload",e._unloadEventListener);e._storageEventListener=function(i){var p=e.getApplicationType();if(i.key===e.globalDirtyStorageKey&&i.newValue===sap.ushell.Container.DirtyState.PENDING&&k.isApplicationTypeEmbeddedInIframe(p)){var s1=e._getIFrame();if(s1){L.debug("getGlobalDirty() send pro54_getGlobalDirty ",null,"sap.ushell.components.container.ApplicationContainer");var t1=new f(e._getIFrameUrl(s1));var u1=t1.protocol()+"://"+t1.host();s1.contentWindow.postMessage(JSON.stringify({action:"pro54_getGlobalDirty"}),u1);}}};addEventListener("storage",e._storageEventListener);e._messageEventListener=r1.prototype._handleMessageEvent.bind(null,e);addEventListener("message",e._messageEventListener);},onAfterRendering:function(){var e=this;this.rerender=function(){};if(D.os.ios&&this.$().prop("tagName")==="IFRAME"){this.$().parent().css("overflow","auto");}if(this.oDeferredRenderer){this.oDeferredRenderer.done(function(){var i=document.getElementById(e.getId()+"-form");if(i){i.submit();}});}},renderer:function(e,i){var p=i.getApplication(),s1=i.launchpadData,t1;if(!i.getVisible()){r1.prototype._renderControlInDiv(e,i);return;}if(i.error){delete i.error;r1.prototype._renderControlInDiv(e,i,r1.prototype._createErrorControl());}else if(!p){r1.prototype._render(e,i,i.getApplicationType(),i.getUrl(),i.getAdditionalInformation());}else if(!p.isResolvable()){r1.prototype._render(e,i,p.getType(),p.getUrl(),"");}else if(s1){r1.prototype._render(e,i,s1.applicationType,s1.Absolute.url.replace(/\?$/,""),s1.applicationData);}else{L.debug("Resolving "+p.getUrl(),null,s);p.resolve(function(u1){L.debug("Resolved "+p.getUrl(),JSON.stringify(u1),s);i.launchpadData=u1;r1.prototype._destroyChild(i);},function(u1){var v1=p.getMenu().getDefaultErrorHandler();if(v1){v1(u1);}r1.prototype._destroyChild(i);i.error=u1;});t1=new T({text:r1.prototype._getTranslatedText("loading",[p.getText()])});r1.prototype._destroyChild(i);i.setAggregation("child",t1);r1.prototype._renderControlInDiv(e,i,t1);}}});r1.prototype.getFrameSource=function(e,i){if(!Object.prototype.hasOwnProperty.call(A.enum,e)){throw new Error("Illegal application type: "+e);}return i;};r1.prototype.setUrl=function(e){i1(this,"url",e);};r1.prototype.setAdditionalInformation=function(e){i1(this,"additionalInformation",e);};r1.prototype.setApplicationType=function(e){i1(this,"applicationType",e);};r1.prototype.createPostMessageRequest=function(e,i){var p=Date.now().toString();return{type:"request",request_id:p,service:e,body:i};};r1.prototype.setNewTRApplicationContext=function(e){var i=new jQuery.Deferred(),p=this._getIFrame(),s1,t1,u1=this;if(!p){return i.promise().reject({message:"Expected an existing TR application application frame but found none."});}function v1(){if(t1){t1["sap-flp-url"]=sap.ushell.Container.getFLPUrl(true);t1["system-alias"]=u1.getSystemAlias();s1["sap-flp-params"]=t1;}var z1=u1.createPostMessageRequest("sap.its.startService",s1);u1.postMessageToIframe(z1,p,true).then(function(){i.resolve();},function(A1){i.reject({eventData:A1,message:"Failed to change application context."});});}e=k.appendSapShellParam(e);s1={url:e};if(this.getIframeWithPost&&this.getIframeWithPost()===true){var w1=[];var x1=r1.prototype._getParamKeys(e,w1);if(x1.length>0){var y1=sap.ushell.Container.getService("CrossApplicationNavigation");y1.getAppStateData(x1).then(function(z1){t1={};w1.forEach(function(A1,B1){if(z1[B1][0]){t1[A1]=z1[B1][0];}});v1();},function(z1){v1();});}else{t1={};v1();}}else{v1();}return i.promise();};r1.prototype.postMessageToIframe=function(i,p,s1){var t1=this;var u1=i.request_id;return new Promise(function(v1,w1){function x1(B1){var C1;try{C1=JSON.parse(B1.data,t1);if(u1!==C1.request_id){return;}if(C1.status==="success"){v1(C1);}else{w1(C1);}window.removeEventListener("message",x1);}catch(e){v1();L.warning("Obtained bad response from framework in response to message "+i.request_id);L.debug("Underlying framework returned invalid response data: '"+B1.data+"'");}}var y1=JSON.stringify(i);L.debug("Sending postMessage "+y1+" to application container '"+t1.getId()+"'");var z1=new f(t1._getIFrameUrl(p));var A1=z1.protocol()+"://"+z1.host();if(s1){window.addEventListener("message",x1,false);p.contentWindow.postMessage(y1,A1);}else{p.contentWindow.postMessage(y1,A1);v1();}});};r1.prototype.postMessageToCurrentIframe=function(e,i){if(i===undefined){i=false;}var p=this._getIFrame();if(!p){if(i){return Promise.reject({message:"Expected opened iframe not found."});}return;}return this.postMessageToIframe(e,p,i);};r1.prototype.setNewApplicationContext=function(e,i){var p=this;var s1=this["setNew"+e+"ApplicationContext"];if(!s1){return Promise.reject({message:"Unsupported application type"});}var t1=this._getIFrame();if(!t1){return Promise.reject({message:"Expected an existing TR application application frame but found none."});}var u1=this.createPostMessageRequest("sap.gui.triggerCloseSessionImmediately",{});return this.postMessageToIframe(u1,t1,true).then(function(){return s1.call(p,i);},function(v1){return Promise.reject({eventData:v1,message:"Failed to change application context."});});};r1.prototype.onApplicationOpened=function(e){var i=this.getIsStateful();if(!i){return Promise.resolve();}var p=this.getApplicationType();if(p==="TR"&&e!=="TR"){var s1=this._getIFrame();if(!s1){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var t1=this.createPostMessageRequest("sap.gui.triggerCloseSession",{});return this.postMessageToIframe(t1,s1,false).catch(function(u1){return Promise.reject({eventData:u1,message:"Failed to change application context."});});}return Promise.resolve();};r1.prototype.postMessageRequest=function(e,i){var p=this._getIFrame();if(!p){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var s1=this.createPostMessageRequest(e,i||{});return this.postMessageToIframe(s1,p,false).catch(function(t1){return Promise.reject({eventData:t1,message:"Failed to post message."});});};r1.prototype.sendBeforeAppCloseEvent=function(){var e=this.getBeforeAppCloseEvent&&this.getBeforeAppCloseEvent(),i;if(e&&e.enabled&&e.enabled===true){i=this.createPostMessageRequest("sap.ushell.services.CrossApplicationNavigation.beforeAppCloseEvent",e.params);return this.postMessageToIframe(i,this._getIFrame(),true);}return undefined;};r1.prototype.getDeffedControlCreation=function(e){return this.oDeferredControlCreation?this.oDeferredControlCreation.promise():jQuery.Deferred().resolve().promise();};r1.prototype._getCommunicationHandlers=B;r1.prototype._adaptIsUrlSupportedResultForMessagePopover=x;r1.prototype._getLogoutHandler=z;r1.prototype._getParameterMap=F;r1.prototype._getTranslatedText=G;r1.prototype._createErrorControl=J;r1.prototype._destroyChild=N;r1.prototype._createUi5View=O;r1.prototype._publishExternalEvent=Q;r1.prototype._createUi5Component=V;r1.prototype._disableRouter=W;r1.prototype._createSystemForUrl=X;r1.prototype._isTrustedPostMessageSource=Y;r1.prototype._handleMessageEvent=a1;r1.prototype._logout=d1;r1.prototype._renderControlInDiv=e1;r1.prototype._checkNwbcUrlAdjustment=f1;r1.prototype._adjustNwbcUrl=g1;r1.prototype._render=j1;r1.prototype._getParamKeys=m1;r1.prototype._buildHTMLElements=n1;r1.prototype._buildHTMLForAllPostParams=o1;r1.prototype._generateRootElementForIFrame=q1;r1.prototype._backButtonPressedCallback=Z;r1.prototype._getIFrame=$;r1.prototype._getIFrameUrl=_;r1.prototype._filterURLParams=l1;r1.prototype._adjustURLForIsolationOpeningWithoutURLTemplate=k1;r1.prototype._resetPluginsLoadIndications=c1;r1.prototype._handlePostMessagesForPluginsPostLoading=b1;return r1;},true);
