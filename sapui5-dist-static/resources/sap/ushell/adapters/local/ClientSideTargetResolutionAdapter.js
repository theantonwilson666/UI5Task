// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/jquery","sap/base/Log"],function(q,L){"use strict";var C=function(s,p,c){this._oConfig=c&&c.config;this._aInbounds=[];if(!this._oConfig){this._oSystemAliases={};L.warning("No configuration supplied!","","sap.ushell.adapters.local.ClientSideTargetResolutionAdapter");}else{if(this._oConfig.inbounds){this._aInbounds=this._transformInboundsObjectToInboundsArray(this._oConfig.inbounds);}if(this._oConfig.applications){Array.prototype.push.apply(this._aInbounds,this._transformApplicationsToInbounds(this._oConfig.applications));}if(this._aInbounds.length===0){L.warning("Adapter got no inbounds via configuration!","","sap.ushell.adapters.local.ClientSideTargetResolutionAdapter");}this._oSystemAliases=this._oConfig.systemAliases||{};L.debug("Adapter got no system aliases via configuration","","sap.ushell.adapters.local.ClientSideTargetResolutionAdapter");}var o=sap.ushell.Container,P="";if(o){P=o.getLogonSystem().getProductName()||"";}this._oLocalSystemAlias={http:{host:"",port:0,pathPrefix:"/sap/bc/"},https:{host:"",port:0,pathPrefix:"/sap/bc/"},rfc:{systemId:"",host:"",service:0,loginGroup:"",sncNameR3:"",sncQoPR3:""},id:"",label:"local",client:"",language:"",properties:{productName:P}};};C.prototype.getInbounds=function(){var d=new q.Deferred(),t=this;setTimeout(function(){d.resolve(t._aInbounds);},0);return d.promise();};C.prototype.resolveSystemAlias=function(s){var d=new q.Deferred();setTimeout(function(){if(this._oSystemAliases.hasOwnProperty(s)){d.resolve(this._oSystemAliases[s]);}else if(s===""){d.resolve(this._oLocalSystemAlias);}else{d.reject("No system alias value available");}}.bind(this),0);return d.promise();};C.prototype._transformApplicationsToInbounds=function(a){var i,I=[],A,o,b;function c(s,u){if(s==="NWBC"&&u){if(u.indexOf("/~canvas;window=app/wda")>=0){return"WDA";}return"TR";}return s;}for(i in a){if(a.hasOwnProperty(i)&&i.indexOf("_")!==0){o={};if(i.indexOf("-")>-1){b=i.split("-",2);o.semanticObject=b[0];o.action=b[1];}else if(i===""){o.semanticObject="";o.action="";}else{L.warning("Excluded syntactically incorrect intent '"+i+"' from inbounds array","","sap.ushell.adapters.local.ClientSideTargetResolutionAdapter");continue;}A=a[i];o.title=A.description||"";o.signature={parameters:{}};o.signature.additionalParameters="allowed";o.resolutionResult={};o.resolutionResult.applicationType=c(A.applicationType,A.url);o.resolutionResult.additionalInformation=A.additionalInformation||"";if(o.resolutionResult.additionalInformation&&o.resolutionResult.additionalInformation.indexOf("SAPUI5.Component=")!==-1){o.resolutionResult.applicationType="SAPUI5";o.resolutionResult.ui5ComponentName=o.resolutionResult.additionalInformation.split("SAPUI5.Component=",2)[1];if(A.applicationDependencies){o.resolutionResult.applicationDependencies=A.applicationDependencies;}else{o.resolutionResult.applicationDependencies={self:{name:o.resolutionResult.ui5ComponentName},asyncHints:{libs:[{name:"sap.ui.core"},{name:"sap.ui.unified"}]}};}}o.resolutionResult.url=A.url;I.push(o);}}return I;};C.prototype._transformInboundsObjectToInboundsArray=function(i){var I,a=[],o;for(I in i){if(i.hasOwnProperty(I)){o=i[I];if(o.resolutionResult.additionalInformation&&o.resolutionResult.additionalInformation.indexOf("SAPUI5.Component=")!==-1){o.resolutionResult.ui5ComponentName=o.resolutionResult.additionalInformation.split("SAPUI5.Component=",2)[1];if(!o.resolutionResult.hasOwnProperty("applicationDependencies")){o.resolutionResult.applicationDependencies={self:{name:o.resolutionResult.ui5ComponentName},asyncHints:{libs:[{name:"sap.ui.core"},{name:"sap.ui.unified"}]}};}}a.push(i[I]);}}return a;};return C;},true);
