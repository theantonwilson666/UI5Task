// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/Version","sap/ui/thirdparty/jquery","sap/base/util/deepExtend"],function(V,q,d){"use strict";var C=function(s,p,a){this._oAdapterConfig=a&&a.config;var c=sap.ushell.Container,P="";if(c){P=c.getLogonSystem().getProductName()||"";}this._oLocalSystemAlias={http:{host:"",port:0,pathPrefix:"/sap/bc/"},https:{host:"",port:0,pathPrefix:"/sap/bc/"},rfc:{systemId:"",host:"",service:0,loginGroup:"",sncNameR3:"",sncQoPR3:""},id:"",label:"local",client:"",language:"",properties:{productName:P}};this.getInbounds=function(){var t=this;if(!this._getInboundsDeferred){this._getInboundsDeferred=new q.Deferred();sap.ushell.Container.getServiceAsync("CommonDataModel").then(function(S){return S.getSite();}).then(function(S){var u=(S._version&&V(S._version).getMajor()===3)?"sap/ushell/adapters/cdm/v3/utilsCdm":"sap/ushell/utils/utilsCdm";sap.ui.require([u],function(U){var i=U.formatSite(S)||[];t._getInboundsDeferred.resolve(i);});},function(e){t._getInboundsDeferred.reject(e);});}return this._getInboundsDeferred.promise();};this._createSIDMap=function(A){return Object.keys(A).sort().reduce(function(S,i){var o=A[i];var b="SID("+o.systemId+"."+o.client+")";if(!S.hasOwnProperty(b)&&o.hasOwnProperty("systemId")&&o.hasOwnProperty("client")){S[b]=i;}return S;},{});};this._getSystemAliases=function(){var t=this;if(!this.oSystemAliasesDeferred){this.oSystemAliasesDeferred=new q.Deferred();sap.ushell.Container.getServiceAsync("CommonDataModel").then(function(S){return S.getSite();}).then(function(S){var o=d({},S.systemAliases||{});Object.keys(o).forEach(function(i){o[i].id=i;});t.oSystemAliasesDeferred.resolve(o);},function(e){t.oSystemAliasesDeferred.reject(e);});}return this.oSystemAliasesDeferred.promise();};this.resolveSystemAlias=function(S){var D=new q.Deferred(),t=this;this._getSystemAliases().done(function(o){var m,b;if(o.hasOwnProperty(S)){b=o[S];if(S===""){b.properties=d({},t._oLocalSystemAlias.properties,b.properties||{});}D.resolve(b);return;}if(S===""){D.resolve(t._oLocalSystemAlias);return;}S=S.toUpperCase(S);if(!t._oSIDMap){t._oSIDMap=t._createSIDMap(o);}if(t._oSIDMap.hasOwnProperty(S)){var M=o[t._oSIDMap[S]];D.resolve(M);return;}m="Cannot resolve system alias "+S;q.sap.log.warning(m,"The system alias cannot be found in the site response","sap.ushell.adapters.cdm.ClientSideTargetResolutionAdapter");D.reject(m);}).fail(function(e){D.reject(e);});return D.promise();};this.getContentProviderDataOriginsLookup=function(){var t=this;if(!this.oContentProviderDataOriginsDeferred){this.oContentProviderDataOriginsDeferred=new q.Deferred();sap.ushell.Container.getServiceAsync("CommonDataModel").then(function(S){return S.getSite();}).then(function(S){var l=null;if(S.contentProviderDataOrigins){l=d({},S.contentProviderDataOrigins);}t.oContentProviderDataOriginsDeferred.resolve(l);},function(e){t.oContentProviderDataOriginsDeferred.reject(e);});}return this.oContentProviderDataOriginsDeferred.promise();};};return C;},true);
