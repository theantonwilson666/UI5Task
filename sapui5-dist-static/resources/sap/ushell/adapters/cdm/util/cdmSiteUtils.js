// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/adapters/cdm/util/AppForInbound","sap/base/Log","sap/ushell/adapters/cdm/v3/utilsCdm","sap/ushell/library"],function(A,L,u,a){"use strict";var D=a.DisplayFormat;var c={_VISUALIZATION_TYPES:{STATIC_TILE:"sap.ushell.StaticAppLauncher",DYNAMIC_TILE:"sap.ushell.DynamicAppLauncher"}};c.getVisualizations=function(v,b){var V={};Object.keys(v).forEach(function(d){var o=v[d];var s;if(o.isCustomTile){s=o._instantiationData.catalogTile.baseChipId;}else if(o.indicatorDataSource){s=this._VISUALIZATION_TYPES.DYNAMIC_TILE;}else{s=this._VISUALIZATION_TYPES.STATIC_TILE;}var e={vizType:s,vizConfig:{"sap.app":{title:o.title,subTitle:o.subTitle,info:o.info},"sap.ui":{icons:{icon:o.icon}},"sap.flp":{tileSize:o.size,indicatorDataSource:o.indicatorDataSource,numberUnit:o.numberUnit}}};if(o.isCustomTile){e.vizConfig["sap.flp"]._instantiationData=o._instantiationData;}e.vizConfig["sap.flp"].target=u.toTargetFromHash(o.url,b);V[d]=e;}.bind(this));return V;};c.getApplications=function(n){return Object.keys(n).reduce(function(o,b){var i=n[b],I=i.permanentKey||i.id;try{o[I]=A.get(b,i);}catch(e){L.error("Unable to dereference app '"+b+"' of CDM page.");o[b]={};}return o;},{});};c.getVizTypes=function(v){return Object.keys(v).filter(function(V){var o=v[V];return o.isCustomTile;}).reduce(function(V,s){var o=v[s];var C=o._instantiationData.catalogTile;var b=C.baseChipId;if(!V[b]){V[b]={"sap.app":{id:b,type:"platformVisualization"},"sap.flp":{vizOptions:{displayFormats:this._getDisplayFormats(C)}}};}var t=this._getTileSize(C);if(t){V[b]["sap.flp"].tileSize=t;}return V;}.bind(this),{});};c._getDisplayFormats=function(b){var d=[D.Standard];var s=D.Standard;if(b.contracts.types){d=b.contracts.types.availableTypes;s=b.contracts.types.defaultType;d=d.map(function(t){if(t==="flatwide"){return D.FlatWide;}return t;});if(s==="flatwide"){s=D.FlatWide;}}return{supported:d,default:s};};c._getTileSize=function(b){if(b.configuration&&b.configuration.row&&b.configuration.col){return b.configuration.row+"x"+b.configuration.col;}return null;};return c;});
