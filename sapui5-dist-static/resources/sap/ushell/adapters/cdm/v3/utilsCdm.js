// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils","sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/ui/thirdparty/jquery","sap/base/util/isEmptyObject","sap/base/util/ObjectPath","sap/base/util/merge","sap/base/util/deepEqual","sap/ushell/adapters/cdm/v3/_LaunchPage/readApplications","sap/base/Log"],function(u,r,q,i,O,m,d,a,L){"use strict";var b={};b.getMember=function(o,A){return u.getMember(o,A);};b.getNestedObjectProperty=function(o,A,D){return u.getNestedObjectProperty(o,A,D);};b.mapOne=function(k,s,A,v,V,S){var I=false;s=u.clone(s);A=u.clone(A);v=u.clone(v);V=u.clone(V);v=v||{};V=V||{};var o={};o.semanticObject=this.getMember(s,"semanticObject");o.action=this.getMember(s,"action");var c=r.getConfig(v);o.title=r.getTitle([undefined,c,s,A]);o.info=r.getInfo([undefined,c,s,A]);o.icon=r.getIcon([undefined,c,s,A]);o.subTitle=r.getSubTitle([undefined,c,s,A]);o.shortTitle=r.getShortTitle([undefined,c,s,A]);o.keywords=r.getKeywords([undefined,c,s,A]);o.numberUnit=r.getNumberUnit([undefined,c,undefined,undefined]);o.deviceTypes=this.getMember(A,"sap|ui.deviceTypes")||{};["desktop","tablet","phone"].forEach(function(M){if(Object.prototype.hasOwnProperty.call(this.getMember(s,"deviceTypes")||{},M)){o.deviceTypes[M]=s.deviceTypes[M];}if(!Object.prototype.hasOwnProperty.call(o.deviceTypes,M)){o.deviceTypes[M]=true;}o.deviceTypes[M]=!!o.deviceTypes[M];}.bind(this));o.signature=this.getMember(s,"signature")||{};o.signature.parameters=this.getMember(o,"signature.parameters")||{};o.signature.additionalParameters=this.getMember(s,"signature.additionalParameters")||"allowed";var e=this.getMember(A,"sap|platform|runtime");o.resolutionResult=q.extend(true,{},e);if(e){o.resolutionResult["sap.platform.runtime"]=q.extend(true,{},e);}if(this.getMember(A,"sap|ui.technology")==="GUI"){o.resolutionResult["sap.gui"]=this.getMember(A,"sap|gui");}if(this.getMember(A,"sap|ui.technology")==="WDA"){o.resolutionResult["sap.wda"]=this.getMember(A,"sap|wda");}if(this.getMember(A,"sap|ui.technology")==="URL"){if(A["sap.url"]){o.resolutionResult["sap.platform.runtime"]=o.resolutionResult["sap.platform.runtime"]||{};o.resolutionResult.url=A["sap.url"].uri;o.resolutionResult["sap.platform.runtime"].url=A["sap.url"].uri;}else if(e&&e.uri){o.resolutionResult["sap.platform.runtime"].url=e.uri;o.resolutionResult.url=e.uri;}}if(!o.resolutionResult["sap.ui"]){o.resolutionResult["sap.ui"]={};}o.resolutionResult["sap.ui"].technology=this.getMember(A,"sap|ui.technology");o.resolutionResult.applicationType=this._formatApplicationType(o.resolutionResult,A);o.resolutionResult.systemAlias=o.resolutionResult.systemAlias||this.getMember(s,"systemAlias");o.resolutionResult.systemAliasSemantics="apply";o.resolutionResult.text=o.title;o.resolutionResult.appId=this.getMember(A,"sap|app.id");var t,f;var g=this.getMember(v,"vizConfig.sap|flp.indicatorDataSource");var T={};if(!i(V)){var h=this.getMember(V,"sap|app.type");if(h==="card"){I=true;T=m({},V,v.vizConfig);}else{T.componentName=this.getMember(V,"sap|ui5.componentName");var C=this.getMember(V,"sap|platform|runtime.componentProperties");if(C){T.componentProperties=C;}if(this.getMember(V,"sap|platform|runtime.includeManifest")){T.componentProperties=T.componentProperties||{};T.componentProperties.manifest=m({},V,v.vizConfig);delete T.componentProperties.manifest["sap.platform.runtime"];}}}if(this.getMember(A,"sap|app.type")==="plugin"||this.getMember(A,"sap|flp.type")==="plugin"){return undefined;}var j=this.getNestedObjectProperty([c,A,V],"sap|flp.tileSize");var l=this.getNestedObjectProperty([c,A,V],"sap|app.description");if(this.getMember(A,"sap|ui.technology")==="GUI"&&this.getMember(A,"sap|gui.transaction")){t=this.getMember(A,"sap|gui.transaction");}if(this.getMember(A,"sap|ui.technology")==="WDA"&&this.getMember(A,"sap|wda.applicationId")){t=this.getMember(A,"sap|wda.applicationId");}var D=this.getNestedObjectProperty([c,A,V],"sap|app.dataSources");if(this.getMember(A,"sap|app.id")){f=this.getMember(A,"sap|app.id");}var n=a.getContentProviderId(A)||"";o.tileResolutionResult={appId:f,title:o.title,subTitle:o.subTitle,icon:o.icon,size:j,info:o.info,keywords:o.keywords,tileComponentLoadInfo:T,indicatorDataSource:g,dataSources:D,description:l,runtimeInformation:e,technicalInformation:t,deviceTypes:o.deviceTypes,isCard:I,contentProviderId:n,numberUnit:o.numberUnit};var p=this.getMember(A,"sap|integration.urlTemplateId");var w=this.getTemplatePayloadFromSite(p,S);if(w){o.templateContext={payload:w,site:S,siteAppSection:A};}return o;};b.getTemplatePayloadFromSite=function(t,s){if(!s||typeof t!=="string"){return null;}var T=t.replace(/[.]/g,"|");return this.getMember(s.urlTemplates,T+".payload");};b._formatApplicationType=function(R,A){var s=R.applicationType;if(s){return s;}var c=this.getMember(A,"sap|platform|runtime.componentProperties.self.name")||this.getMember(A,"sap|ui5.componentName");if(this.getMember(A,"sap|flp.appType")==="UI5"||this.getMember(A,"sap|ui.technology")==="UI5"){R.applicationType="SAPUI5";R.additionalInformation="SAPUI5.Component="+c;R.url=this.getMember(A,"sap|platform|runtime.componentProperties.url");R.applicationDependencies=this.getMember(A,"sap|platform|runtime.componentProperties");return"SAPUI5";}if(this.getMember(A,"sap|ui.technology")==="GUI"){R.applicationType="TR";R["sap.gui"]=this.getMember(A,"sap|gui");R.systemAlias=this.getMember(A,"sap|app.destination.name");return"TR";}if(this.getMember(A,"sap|ui.technology")==="WDA"){R.applicationType="WDA";R["sap.wda"]=this.getMember(A,"sap|wda");R.systemAlias=this.getMember(A,"sap|app.destination.name");return"WDA";}if(this.getMember(A,"sap|ui.technology")==="URL"){R.applicationType="URL";R.systemAlias=this.getMember(A,"sap|app.destination.name");}return"URL";};b.formatSite=function(s){var t=this;if(!s){return[];}var I=[];try{var S=Object.keys(s.applications||{}).sort();S.forEach(function(A){try{var o=s.applications[A];var c=this.getMember(o,"sap|app.crossNavigation.inbounds");if(c){var l=Object.keys(c).sort();l.forEach(function(f){var g=c[f];var R=t.mapOne(f,g,o,undefined,undefined,s);if(R){R.contentProviderId=a.getContentProviderId(o)||"";I.push(R);}});}}catch(E){L.error("Error in application "+A+": "+E,E.stack);}}.bind(this));}catch(e){L.error(e);L.error(e.stack);return[];}return I;};b.toHashFromInbound=function(I){var s,p,c;s={target:{semanticObject:I.semanticObject,action:I.action},params:{}};p=O.get("signature.parameters",I)||{};Object.keys(p).forEach(function(k){if(p[k].filter&&Object.prototype.hasOwnProperty.call(p[k].filter,"value")&&(p[k].filter.format===undefined||p[k].filter.format==="plain")){s.params[k]=[p[k].filter.value];}if(p[k].launcherValue&&Object.prototype.hasOwnProperty.call(p[k].launcherValue,"value")&&(p[k].launcherValue.format===undefined||p[k].launcherValue.format==="plain")){s.params[k]=[p[k].launcherValue.value];}});c=sap.ushell.Container.getService("URLParsing").constructShellHash(s);if(!c){return undefined;}return c;};b.toHashFromOutbound=function(o){var s,p,c;s={target:{semanticObject:o.semanticObject,action:o.action},params:{}};p=o.parameters||{};Object.keys(p).forEach(function(k){if(p.hasOwnProperty(k)&&typeof p[k].value==="object"){s.params[k]=[p[k].value.value];}});c=sap.ushell.Container.getService("URLParsing").constructShellHash(s);if(!c){return undefined;}return c;};b.toHashFromVizData=function(v,A,U){var V,t;if(!v.target){return undefined;}V=v.target;if(V.type==="URL"){return V.url;}var s=V.appId;var I=V.inboundId;if(s&&I){var o=a.getInboundTarget(A,s,I);t={};if(o){t.semanticObject=o.semanticObject;t.action=o.action;t.parameters=V.parameters||{};t.parameters["sap-ui-app-id-hint"]={value:{value:s,format:"plain"}};t.appSpecificRoute=V.appSpecificRoute||"";}}else if(V.semanticObject&&V.action){t=V;}return b.toHashFromTarget(t,U);};b.toHashFromTarget=function(t,U){try{var p={};var R=O.get("parameters",t)||{};Object.keys(R).forEach(function(k){p[k]=Array.isArray(R[k].value.value)?R[k].value.value:[R[k].value.value];});var h={target:{semanticObject:t.semanticObject,action:t.action},params:p,appSpecificRoute:t.appSpecificRoute};return"#"+U.constructShellHash(h);}catch(e){return undefined;}};b.toTargetFromHash=function(h,U){var t=U.parseShellHash(h);if(t!==undefined){var p=t.params||{};if(Object.keys(p).length>0){t.parameters=[];Object.keys(p).forEach(function(k){var v=Array.isArray(p[k])?p[k]:[p[k]];v.forEach(function(V){var P={name:k,value:V};t.parameters.push(P);});});}delete t.params;}else{t={type:"URL",url:h};}return t;};b.isSameTarget=function(t,T){var R;if(t.type!==T.type){return false;}if(t.type==="URL"){R=t.url===T.url;}else{R=t.semanticObject===T.semanticObject&&t.action===T.action&&t.appSpecificRoute===T.appSpecificRoute&&d(t.parameters,T.parameters);}return R;};return b;},true);
