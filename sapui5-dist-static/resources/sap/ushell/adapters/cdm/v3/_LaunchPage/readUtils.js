// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/ushell/adapters/cdm/v3/_LaunchPage/readApplications","sap/ushell/adapters/cdm/v3/_LaunchPage/readHome","sap/ushell/adapters/cdm/v3/utilsCdm","sap/ushell/Config","sap/base/util/deepClone","sap/base/util/isPlainObject","sap/base/util/ObjectPath","sap/base/util/deepExtend","sap/base/util/isEmptyObject"],function(r,a,b,u,C,d,i,O,c,e){"use strict";var f={};f.getVizData=function(s,v,U){if(v.isBookmark&&v.url){v=d(v);v.subTitle=v.subtitle;v.target=u.toTargetFromHash(v.url,U);}var g=this.getCdmParts(s,v);var V=g&&g[1]||{};var A=g&&g[3]||{};var o=r.get(s,b.getTileVizId(v))||{};var h={id:b.getTileId(v),vizId:b.getTileVizId(v)||"",vizType:v.vizType||r.getTypeId(o)||"",vizConfig:c({},V,v.vizConfig),title:r.getTitle(g)||"",subtitle:r.getSubTitle(g)||"",icon:r.getIcon(g)||"",keywords:r.getKeywords(g)||[],info:r.getInfo(g)||"",target:v.target||r.getTarget(o)||{},indicatorDataSource:v.indicatorDataSource||r.getIndicatorDataSource(o),isBookmark:v.isBookmark||false,contentProviderId:a.getContentProviderId(A)||"",displayFormatHint:v.displayFormatHint,numberUnit:r.getNumberUnit(g),_instantiationData:r.getInstantiationData(o)};h.target=this.harmonizeTarget(h.target);h.targetURL=u.toHashFromVizData(h,s.applications,U);if(h.indicatorDataSource&&h.indicatorDataSource.dataSource){h.dataSource=r.getDataSource(g,h.indicatorDataSource.dataSource);}if(v.isBookmark){this._addBookmarkInstantiationData(h,s);}if(!h._instantiationData||!Object.keys(h._instantiationData)){h._instantiationData={platform:"CDM",vizType:r.getType(s,h.vizType)};}return h;};f.getVizRef=function(v){var V={id:v.id,vizId:v.vizId,title:v.title,subTitle:v.subtitle,icon:v.icon,keywords:v.keywords,info:v.info,target:v.target,indicatorDataSource:v.indicatorDataSource,contentProviderId:v.contentProviderId,displayFormatHint:v.displayFormatHint,numberUnit:v.numberUnit};if(v.isBookmark){V.isBookmark=v.isBookmark;if(v.vizConfig!==undefined&&!e(v.vizConfig)){V.vizType=v.vizType;V.vizConfig=v.vizConfig;}}return V;};f.getCdmParts=function(s,t){var v=r.get(s,b.getTileVizId(t))||{};var V=r.getConfig(v);var A=r.getAppDescriptor(s,r.getAppId(v));var I=a.getInbound(A,r.getInboundId(v));return[t,V,I,A];};f.harmonizeTarget=function(t){var p=t.parameters;if(!p||i(p)){return t;}var P={};p.forEach(function(o){if(P[o.name]){if(!Array.isArray(P[o.name].value.value)){P[o.name].value.value=[P[o.name].value.value];}P[o.name].value.value.push(o.value);}else{P[o.name]={value:{value:o.value,format:"plain"}};}});t.parameters=P;return t;};f._addBookmarkInstantiationData=function(v,s){if(v.vizType){var V=r.getType(s,v.vizType);if(V!==undefined){v._instantiationData={platform:"CDM",vizType:V};}else{var o=O.get(["vizConfig","sap.flp","chipConfig"],v);v._instantiationData={platform:"ABAP",chip:d(o),simplifiedChipFormat:true};}}else if(v.indicatorDataSource&&v.indicatorDataSource.path){v.vizType="sap.ushell.DynamicAppLauncher";}else{v.vizType="sap.ushell.StaticAppLauncher";}};return f;},true);
