/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/delegate/ItemNavigation","./GridItemNavigation"],function(I,G){"use strict";function d(c){if(c.onfocusin){c.onfocusin();}}var a=G.extend("sap.f.delegate.GridContainerItemNavigation",{constructor:function(){G.apply(this,arguments);this.attachEvent(I.Events.FocusLeave,this._onFocusLeave,this);},metadata:{library:"sap.f",properties:{},events:{}}});a.prototype._onFocusLeave=function(e){var c=this.getFocusedDomRef();this.getItemDomRefs().forEach(function(i,b){if(c===i){var n=b++;this.setFocusedIndex(n);}}.bind(this));this._bFocusLeft=true;};a.prototype.forwardTab=function(f){var i=this._getRootDomRefId()+"-"+(f?"after":"before");document.getElementById(i).focus();};a.prototype._getRootDomRefId=function(f){return this.getRootDomRef().getAttribute("id");};a.prototype.onsaptabnext=function(e){var n=this.getItemDomRefs(),l=this.getFocusedIndex(),L=jQuery(n[l]),T=[];var A=L.find(":sapTabbable");A.map(function(i,b){if(b.className.indexOf("DummyArea")===-1){T.push(b);}});var t=jQuery(T),f=t.length===1?0:t.length-1;if(f===-1||(t.control(f)&&t.control(f).getId()===e.target.id)){this._lastFocusedElement=e.target;this.forwardTab(true);}};a.prototype.onsaptabprevious=function(e){if(!e.target.classList.contains("sapFGridContainerItemWrapper")){this._lastFocusedElement=e.target;return;}var t=e.target.id;if(t===(this._getRootDomRefId()+"-nodata")){this.forwardTab(false);}this._lastFocusedElement=null;this.forwardTab(false);};a.prototype.onmousedown=function(e){this._bIsMouseDown=true;I.prototype.onmousedown.call(this,e);};a.prototype.onmouseup=function(e){var $=jQuery(e.target).closest('.sapFGridContainerItemWrapperNoVisualFocus'),c;if($.length){c=$.children().eq(0).control()[0];if(c&&c.getFocusDomRef()===document.activeElement){this._lastFocusedElement=null;$.trigger("focus");d(c);}}this._bIsMouseDown=false;};a.prototype.ondragend=function(){this._bIsMouseDown=false;};a.prototype.ondrop=function(){this._bIsMouseDown=false;};a.prototype.onfocusin=function(e){G.prototype.onfocusin.call(this,e);var $=jQuery(e.target).closest('.sapFGridContainerItemWrapperNoVisualFocus'),c,n,l;if($.length){c=$.children().eq(0).control()[0];if(c){d(c);if(!this._bIsMouseDown&&c.getFocusDomRef()===e.target){this._lastFocusedElement=null;$.trigger("focus");return;}}}if(e.target.classList.contains("sapFGridContainerItemWrapper")){this._lastFocusedElement=null;}if(this._bFocusLeft&&!this._bIsMouseDown){n=this.getItemDomRefs();l=this.getFocusedIndex();if(this._lastFocusedElement){this._lastFocusedElement.focus();}else{n[l].focus();}}this._bFocusLeft=false;};a.prototype.focusItem=function(i,e){if(i===this.iFocusedIndex&&this.aItemDomRefs[this.iFocusedIndex]===document.activeElement){this.fireEvent(I.Events.FocusAgain,{index:i,event:e});return;}this.fireEvent(I.Events.BeforeFocus,{index:i,event:e});this.setFocusedIndex(i);this.bISetFocus=true;if(e&&jQuery(this.aItemDomRefs[this.iFocusedIndex]).data("sap.INRoot")){var o=jQuery(this.aItemDomRefs[this.iFocusedIndex]).data("sap.INRoot");o._sFocusEvent=e.type;}if(!this._bIsMouseDown&&this.aItemDomRefs.length){this.aItemDomRefs[this.iFocusedIndex].focus();}this.fireEvent(I.Events.AfterFocus,{index:i,event:e});};return a;});
