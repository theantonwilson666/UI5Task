/*!
 * SAPUI5

(c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(['sap/chart/coloring/ColoringUtils','sap/chart/coloring/criticality/measureValues/ThresholdsUtils','sap/chart/ChartLog','sap/chart/coloring/CriticalityType','sap/chart/data/MeasureSemantics',"sap/ui/thirdparty/jquery"],function(C,T,a,b,M,q){"use strict";var c={Static:{},Calculated:{},DynamicThresholds:{},ConstantThresholds:{},Unmentioned:{}};var S=['Maximize','Minimize','Target'];c.Static.validate=function(o,m,D,t,e){var h=o[m].Static;var j=function(p,r){if(n[r]===m){k=true;if(n.staticType){if(n.staticType!==h){var u='';Object.keys(M).forEach(function(p,v,w){var r=M[p];if(n[r]){if(v!==(w.length-1)){u+=n[r]+', ';}else{u+=n[r];}}});throw new a('error','Colorings.Criticality.Static','When '+u+' have semantic relationship, they must use the same Criticality type.');}}else{n.staticType=h;if(e[h]){throw new a('error','Colorings.Criticality.Static','Measures, '+e[h]+' and '+m+', which use Static Criticality must have different types.');}else{e[h]=m;}}return false;}};var k=false;for(var i=0;i<t.length;++i){var n=t[i];q.each(M,j);if(k){break;}}return{supportMultiMsr:true};};c.Static.parse=function(o,e,p){var m=o.msr?o.msr.getName():undefined;var h=o.settings[o.type];p.callbacks=c.Static.getCallbacks(h,m);var D=o.msr.getLabel()||o.msr.getName();var i=o.settings.Legend||{};p.legend[h]=(i[h]!=null)?i[h]:D;};c.Static.getCallbacks=function(e,m){var h={};h[e]=[function(o){return o.hasOwnProperty(m);}];return h;};c.Calculated.validate=function(o,m,D){var e=o[m].Calculated;var h=D.allDim.filter(function(j){return j===e;})[0];var i=D.allMsr.filter(function(m){return m===e;})[0];if(h){o[m].type="dimension";}else if(i){o[m].type="measure";if(D.aMsr.find(function(j){return j.getName()===i;})){throw new a('error','Colorings.Criticality.Calculated','Calculated property, '+e+', could not be available measure.');}}if(!o[m].type){throw new a('error','Colorings.Criticality.Calculated','Calculated property, '+e+', does not exist in data model.');}};c.Calculated.parse=function(o,e,p,m,L){var h=o.settings[o.type];var i=o.settings.type;if(i==="dimension"&&!C.find(h,e.aDims)){p.additionalDimensions.push(h);}else if(i==="measure"){if(!e.aMsrs.find(function(j){return j.getName()===h;})){p.additionalMeasures.push(h);}e.oStatus.legend=c.getLegend(o,L);}p.status=e.oStatus;};c.Calculated.getCallbacks=function(p,e,m){var h=function(o){return(o[p]===e||c.Calculated.getCriticalityType(o[p])===e)&&o.hasOwnProperty(m);};return[h];};c.Calculated.getContextHandler=function(e,m,L){var o=e[0];var h=o.settings[o.type];var i=o.settings.type;delete o.settings.type;delete o.parsed.status.callbacks;return function(j){var k=o.parsed.status;k.legend=k.legend||{};k.callbacks=k.callbacks||{};o.parsed.legend=k.legend;o.parsed.callbacks=k.callbacks;var n=j.getProperty(h);if(i==="measure"){n=c.Calculated.getCriticalityType(n);}if(b[n]){if(i==="dimension"){var p=this.getDimensionByName(h);var D=this.getDimensionByName(h).getDisplayText();e.legendTitle=e.legendTitle||p.getLabel();var r=p.getTextProperty();if(r&&D){var t=j.getProperty(r);o.parsed.legend[n]=t;}else if(n){o.parsed.legend[n]=L.getText("COLORING_TYPE_"+n.toUpperCase());}}var u=o.msr.getName();var v=c.Calculated.getCallbacks(h,n,u);o.parsed.callbacks[n]=v;}};};c.Calculated.getCriticalityType=function(v){var e;switch(v){case 0:e=b.Neutral;break;case 1:e=b.Negative;break;case 2:e=b.Critical;break;case 3:e=b.Positive;break;default:e=undefined;break;}return e;};c.DynamicThresholds.validate=function(o,m,D){var h=D.allMsr;var i=[],j=o[m].DynamicThresholds,k;if(S.indexOf(j.ImprovementDirection)>-1){k=j.ImprovementDirection;}else{throw new a('error','Colorings.Criticality.DynamicThresholds','ImprovementDirection should be one of \'Maximize\', \'Minimize\' and \'Target\'.');}var n=[j.ToleranceRangeLowValue,j.DeviationRangeLowValue,j.AcceptanceRangeLowValue];var p=[j.ToleranceRangeHighValue,j.DeviationRangeHighValue,j.AcceptanceRangeHighValue];switch(k){case"Maximize":i=n;break;case"Minimize":i=p;break;case"Target":i=n.concat(p);break;default:}if(C.isNumber.apply(null,i)){throw new a('error','Colorings.Criticality.DynamicThresholds','Invalid Thresholds settings.');}i=i.filter(function(e){return typeof e=="string";});C.notIn(i,h,'Colorings.Criticality.DynamicThresholds','Thresholds measure, ',', does not exist in data model.');};c.DynamicThresholds.parse=function(o,e,p,m,L){var h=o.settings[o.type];var i=o.msr?o.msr.getName():undefined;var D=h.ImprovementDirection.toLowerCase();var t={lo:h.ToleranceRangeLowValue,hi:h.ToleranceRangeHighValue};var j={lo:h.DeviationRangeLowValue,hi:h.DeviationRangeHighValue};var A={lo:h.AcceptanceRangeLowValue,hi:h.AcceptanceRangeHighValue};T.fillOmit(A,t,j);p.additionalMeasures=[A.lo,A.hi,t.lo,t.hi,j.lo,j.hi].filter(function(v){return typeof v==='string'&&e.aMsrs.filter(function(k){return k.getName()===v;}).length==0;});p.callbacks=T.improvement(D,i,A,t,j);p.legend=c.getLegend(o,L);};c.DynamicThresholds.getContextHandler=function(e,m,L){var o=e[0],h=o.settings[o.type],D=h.ImprovementDirection.toLowerCase();function _(i,k){var r;if(typeof k==="number"){r=k;}else{r=k?i.getProperty(k):null;if(typeof r==="string"){r=Number.parseFloat(r);}}return r;}return function(i){var t={};t.lo=_(i,h.ToleranceRangeLowValue);t.hi=_(i,h.ToleranceRangeHighValue);var j={};j.lo=_(i,h.DeviationRangeLowValue);j.hi=_(i,h.DeviationRangeHighValue);var A={};A.lo=_(i,h.AcceptanceRangeLowValue);A.hi=_(i,h.AcceptanceRangeHighValue);T.fillOmit(A,t,j);T.checkThreshold(D,A,t,j);};};c.ConstantThresholds.validate=function(o,m){var e=o[m].ConstantThresholds;if(S.indexOf(e.ImprovementDirection)===-1){throw new a('error','Colorings.Criticality.ConstantThresholds','ImprovementDirection should be one of \'Maximize\', \'Minimize\' and \'Target\'.');}return{supportHeatMap:true};};c.ConstantThresholds.parse=function(o,e,p,m,L){var h=o.settings[o.type];var i=o.msr?o.msr.getName():undefined;var j=o.msr?o.msr.getLabel()||o.msr.getName():undefined;var D=h.ImprovementDirection.toLowerCase();var t={lo:o.byAggregation.ToleranceRangeLowValue,hi:o.byAggregation.ToleranceRangeHighValue};var k={lo:o.byAggregation.DeviationRangeLowValue,hi:o.byAggregation.DeviationRangeHighValue};var A={lo:o.byAggregation.AcceptanceRangeLowValue,hi:o.byAggregation.AcceptanceRangeHighValue};T.fillOmit(A,t,k);T.checkThreshold(D,A,t,k,true);if(m){p.legend=T.MBCimprovement(D,A,t,k);}else{p.callbacks=T.improvement(D,i,A,t,k);p.legend=c.ConstantThresholds.getLegend(D,j,A,t,k,L);}};var g="\u2265";var l="<";var d="\u2264";var f=">";var s={"<":">",">":"<","\u2265":"\u2264","\u2264":"\u2265"};c.ConstantThresholds.getLegend=function(D,m,A,t,o,L){var h={};var i=o.hi;var j=o.lo;var k=t.hi;var n=t.lo;var p=A.hi;var r=A.lo;function u(x,y,z){var B=x.length;var E=x[0]===Number.POSITIVE_INFINITY;var F=x[0]===Number.NEGATIVE_INFINITY;var G=x[B-1]===Number.POSITIVE_INFINITY;var H=x[B-1]===Number.NEGATIVE_INFINITY;if(z&&x[0]===x[B-1]){return"";}if(y){if(B===5&&!(F&&G)){if(G||H){x=x.slice(0,3);}if(E||F){x=x.slice(2);}if(x.length<=1){return"";}}else if(B===3&&(E||F||G||H)){return"";}}x=x.map(function(e){if(e===Number.POSITIVE_INFINITY){return L.getText("POSITIVE_INFINITY");}else if(e===Number.NEGATIVE_INFINITY){return L.getText("NEGATIVE_INFINITY");}return e;});if(x.length===3&&C.isNumber(x[0])){var I=s[x[1]];x=[x[2],I,x[0]];}return x.join(" ");}var v=function(e){return e&&e.length>0;};var w=function(e){return e.filter(v).join(' , ');};switch(D){case'maximize':h={Positive:u([m,g,r]),Critical:u([j,d,m,l,n],true),Neutral:u([n,d,m,l,r],true),Negative:u([m,l,j])};break;case'minimize':h={Positive:u([m,d,p]),Critical:u([k,l,m,d,i],true),Neutral:u([p,l,m,d,k],true),Negative:u([m,f,i])};break;case'target':h={Positive:u([r,d,m,d,p],true),Critical:w([u([j,d,m,l,n],true,true),u([k,l,m,d,i],true,true)]),Neutral:w([u([n,d,m,l,r],true,true),u([p,l,m,d,k],true,true)]),Negative:w([u([m,l,j],true),u([m,f,i],true)])};break;default:}return h;};c.ConstantThresholds.getContextHandler=function(e,m){if(m){var o=e[0];var h=o.msr.getName();var L=o.parsed.legend;return function(i){var v=i.getProperty(h);L.min=Math.min(L.min,v);L.max=Math.max(L.max,v);};}else{return null;}};c.getLegend=function(o,L){var D={};q.each(b,function(k,v){D[v]=L.getText("COLORING_TYPE_"+v.toUpperCase());});return q.extend(true,{},D,o.settings.Legend);};return c;});
