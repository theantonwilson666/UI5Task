/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/strings/capitalize","sap/ui/core/Control","sap/gantt/library","sap/ui/base/ManagedObjectObserver","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","sap/ui/core/library","../control/AssociateContainer","../config/TimeHorizon","sap/ui/fl/write/api/ControlPersonalizationWriteAPI","sap/m/FlexBox","sap/m/Text","./GanttChartContainerRenderer"],function(c,C,l,M,S,a,b,A,T,d,F,e){"use strict";var G=l.simple.GanttChartWithTableDisplayType;var O=b.Orientation;var f=C.extend("sap.gantt.simple.GanttChartContainer",{metadata:{library:"sap.gantt",properties:{height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'100%'},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'100%'},layoutOrientation:{type:"sap.ui.core.Orientation",group:"Behavior",defaultValue:sap.ui.core.Orientation.Vertical},enableTimeScrollSync:{type:"boolean",defaultValue:true},enableCursorLine:{type:"boolean",defaultValue:true},enableNowLine:{type:"boolean",defaultValue:true},enableVerticalLine:{type:"boolean",defaultValue:true},enableAdhocLine:{type:"boolean",defaultValue:true},enableDeltaLine:{type:"boolean",defaultValue:true},enableNonWorkingTime:{type:"boolean",defaultValue:true},displayType:{type:"sap.gantt.simple.GanttChartWithTableDisplayType",defaultValue:G.Both},enableStatusBar:{type:"boolean",defaultValue:false},statusMessage:{type:"string",defaultValue:""},statusBarDatePattern:{type:"string",defaultValue:'EEEE, MMMM d, yyyy'},statusBarTimePattern:{type:"string",defaultValue:'hh:mm:ss a'},hideSettingsItem:{type:"string[]",defaultValue:[]}},defaultAggregation:"ganttCharts",aggregations:{toolbar:{type:"sap.gantt.simple.ContainerToolbar",multiple:false},ganttCharts:{type:"sap.gantt.simple.GanttChartWithTable",multiple:true},statusBar:{type:"sap.m.FlexBox",multiple:false},svgDefs:{type:"sap.gantt.def.SvgDefs",multiple:false},variantHandler:{type:"sap.gantt.simple.CustomVariantHandler",multiple:false}},events:{customSettingChange:{parameters:{name:{type:"string"},value:{type:"boolean"}}},variantApplied:{}},designtime:"sap/gantt/designtime/simple/GanttChartContainer.designtime"}});var g=["enableCursorLine","enableNowLine","enableVerticalLine","enableAdhocLine","enableDeltaLine","enableNonWorkingTime"];var h=["enableTimeScrollSync"].concat(g).concat(["enableStatusBar"]);var I={zoomLevel:0,displayType:G.Both,enableCursorLine:true,enableNowLine:true,enableVerticalLine:true,enableAdhocLine:true,enableDeltaLine:true,enableTimeScrollSync:true,enableNonWorkingTime:true,enableStatusBar:false};g.forEach(function(p){f.prototype["set"+c(p,0)]=function(v){this.setProperty(p,v);this.getGanttCharts().forEach(function(o){o.setProperty(p,v);});return this;};});f.prototype.setSharedPropertiesValueToGantts=function(){g.forEach(function(p){var P=this.getProperty(p);this.getGanttCharts().forEach(function(o){o.setProperty(p,P,true);});}.bind(this));};f.prototype.init=function(){this._bInitHorizonApplied=false;this._nInitialRenderedGantts=0;this._oSplitter=new S({id:this.getId()+"-ganttContainerSplitter",orientation:this.getLayoutOrientation()});this.oObserver=new M(this.observePropertiesChanges.bind(this));this.oObserver.observe(this,{properties:h});this.oStatusBar=new F(this.getId()+"-ganttStatusBar",{renderType:"Bare",alignItems:"Center",justifyContent:"SpaceBetween"}).addStyleClass("sapUiSettingBox");this.setAggregation("statusBar",this.oStatusBar,true);this.createItems().forEach(function(i){this.getStatusBar().addItem(i);}.bind(this));};f.prototype.exit=function(){this.oObserver.disconnect();this._oSplitter.destroy();};f.prototype.setDisplayType=function(D){this._setDisplayTypeForAll(D);this.setProperty("displayType",D,false);return this;};f.prototype.setToolbar=function(t){this.setAggregation("toolbar",t,true);t.attachZoomStopChange(this._onToolbarZoomStopChange,this);t.attachBirdEyeButtonPress(this._onToolbarBirdEyeButtonPress,this);t.attachEvent("_settingsChange",this._onToolbarSettingsChange.bind(this));t.attachEvent("_zoomControlTypeChange",this._onToolbarZoomControlTypeChange.bind(this));t.attachDisplayTypeChange(this._onToolbarDisplayTypeChanged.bind(this),this);t._oDisplayTypeSegmentedButton.setSelectedKey(this.getDisplayType());return this;};f.prototype.setVariantHandler=function(v){this.setAggregation("variantHandler",v,true);v.attachSetDataComplete(this.customVariantChange,this);};f.prototype.setLayoutOrientation=function(o){this.setProperty("layoutOrientation",o);this._oSplitter.setOrientation(o);return this;};f.prototype.addGanttChart=function(o){this.addAggregation("ganttCharts",o,true);this._insertGanttChart(o);};f.prototype.insertGanttChart=function(o,i){this.insertAggregation("ganttCharts",o,i);this._insertGanttChart(o,i);};f.prototype.removeGanttChart=function(v){this._removeGanttChartFromSplitter(v);var r=this.removeAggregation("ganttCharts",v);this._adjustSplitterLayoutData();return r;};f.prototype.removeAllGanttCharts=function(){var j=this.getGanttCharts();for(var i=0;i<j.length;i++){this._removeGanttChartFromSplitter(j[i]);}return this.removeAllAggregation("ganttCharts");};f.prototype._insertGanttChart=function(o,i){if(!o){return;}var s=this._getOtherGanttSelectionPanelSize(o);if(s){o.setProperty("selectionPanelSize",s,"true");}var j=new A({content:o,layoutData:o.getLayoutData()?o.getLayoutData().clone():new a()});if(i!==0&&!i){this._oSplitter.addContentArea(j);}else{this._oSplitter.insertContentArea(j,i);}this._sanitizeGanttChartEvents(o);this.setSharedPropertiesValueToGantts();o.setDisplayType(this.getDisplayType());};f.prototype._adjustSplitterLayoutData=function(){var i=this.getGanttCharts();var j=this._oSplitter.getContentAreas();if(i.length===1){j[0].getLayoutData().setSize("auto");}};f.prototype._getOtherGanttSelectionPanelSize=function(n){var o=this.getGanttCharts().filter(function(i){return i.getId()!==n.getId();});return o&&o.length>0?o[0].getSelectionPanelSize():null;};f.prototype._sanitizeGanttChartEvents=function(o){var E={"_initialRenderGanttChartsSync":this._onInitialRenderGanttChartsSync,"_timePeriodZoomOperation":this._onGanttChartTimePeriodZoomOperation,"_zoomInfoUpdated":this._onZoomInfoUpdated,"_selectionPanelResize":this._onSelectionPanelWidthChange,"_layoutDataChange":this._onGanttChartLayoutDataChange};Object.keys(E).forEach(function(s){o.detachEvent(s,E[s],this);}.bind(this));Object.keys(E).forEach(function(s){o.attachEvent(s,E[s],this);}.bind(this));};f.prototype._onGanttChartLayoutDataChange=function(E){var o=E.getSource(),n=o.getLayoutData();this._oSplitter.getContentAreas().forEach(function(i){if(i.getContent()===o.getId()){i.getLayoutData().setSize(n.getSize()).setMinSize(n.getMinSize());}});};f.prototype._removeGanttChartFromSplitter=function(v){var o=v;if((typeof v)==="number"){o=this.getGanttCharts()[v];}if(o){this._oSplitter.removeContentArea(o);}return o;};f.prototype._onInitialRenderGanttChartsSync=function(E){var p=E.getParameters();var k=this.getGanttCharts();if(p.reasonCode==="initialRender"&&!this.getEnableTimeScrollSync()){return;}if(!this.getEnableTimeScrollSync()){if(p.reasonCode==="visibleHorizonUpdated"){for(var i=0;i<k.length;i++){if(E.getSource().getId()===k[i].getId()){continue;}k[i].syncVisibleHorizon(p.visibleHorizon,p.visibleWidth,true);}}else{var s;if(p.reasonCode==="mouseWheelZoom"){s="syncMouseWheelZoom";}if(s){for(var m=0;m<k.length;m++){var o=k[m];var n=o;if(E.getSource().getId()===n.getId()){continue;}n[s](p);}}}}else{for(var j=0;j<k.length;j++){k[j].syncVisibleHorizon(p.visibleHorizon,p.visibleWidth);}}};f.prototype._onGanttChartTimePeriodZoomOperation=function(E){var t=this.getEnableTimeScrollSync();var j=this.getGanttCharts();for(var i=0;i<j.length;i++){if(E.getSource().getId()===j[i].getId()){continue;}var o=this._oSplitter.getOrientation();j[i].syncTimePeriodZoomOperation(E,t,o);}};f.prototype._onSelectionPanelWidthChange=function(E){var D=this.getDisplayType(),s=E.getParameter("displayType");if(D!==s){this.setDisplayType(s);return;}if(this.getLayoutOrientation()===O.Horizontal&&D!==G.Both){return;}var n=E.getParameter("newWidth");this.getGanttCharts().forEach(function(o){o.setProperty("selectionPanelSize",n+"px",false);o._draw();});};f.prototype._removeGanttChartFromSplitter=function(v){var o=v;if((typeof v)==="number"){o=this.getGanttCharts()[v];}if(o){this._oSplitter.removeContentArea(o._oAC);}};f.prototype.onBeforeRendering=function(){this.observePropertiesChanges();this.handleZoomControlTypeToAxistimeStrategy();};f.prototype.onAfterRendering=function(){if(this.getEnableStatusBar()){this.msgText.setText(this.getStatusMessage());}};f.prototype.handleZoomControlTypeToAxistimeStrategy=function(){if(this.getToolbar()){var i=this.getGanttCharts();var z=this.getToolbar().getZoomControlType();i.forEach(function(o){o.getAxisTimeStrategy()._updateZoomControlType(z);});}};f.prototype._onZoomInfoUpdated=function(E){if(this.getToolbar()){var z=E.getParameter("zoomLevel");if(!isNaN(z)){this.getToolbar().updateZoomLevel(z);}}};f.prototype._onToolbarDisplayTypeChanged=function(E){var i=[];i.push({"selectorElement":this,"changeSpecificData":{"changeType":"GanttContainerDisplayType","content":{"propertyName":"displayType","newValue":E.getParameter("displayType"),"oldValue":I.displayType}}});d.add({changes:i});};f.prototype._setDisplayTypeForAll=function(D){var t=this.getToolbar();if(t){t._oDisplayTypeSegmentedButton.setSelectedKey(D);}this.getGanttCharts().forEach(function(o){o.setDisplayType(D);});};f.prototype._onToolbarBirdEyeButtonPress=function(E){var i=this.getGanttCharts();var s;var o;i.forEach(function(j){var H=j._getZoomExtension().calculateBirdEyeRange();if(H.startTime&&H.endTime){if(!s||H.startTime.getTime()<s.getTime()){s=H.startTime;}if(!o||o.getTime()<H.endTime.getTime()){o=H.endTime;}}});if(s&&o){var B=new T({startTime:s,endTime:o});i.forEach(function(j){var k=j.getAxisTimeStrategy();if(k.getMouseWheelZoomType()===l.MouseWheelZoomType.Stepwise){k.bBirdEyeTriggered=true;}j.syncVisibleHorizon(B);});}};f.prototype._onToolbarZoomStopChange=function(E){var i=this.getGanttCharts();var j=[];i.forEach(function(o){j.push({"selectorElement":o.getAxisTimeStrategy(),"changeSpecificData":{"changeType":"GanttContainerZoomLevel","content":{"propertyName":"zoomLevel","newValue":E.getParameter("index"),"oldValue":I.zoomLevel}}});});d.add({changes:j});i.forEach(function(o){o.getAxisTimeStrategy().updateStopInfo({index:E.getParameter("index"),selectedItem:E.getParameter("selectedItem")});});};f.prototype._onToolbarZoomControlTypeChange=function(E){this._handleZoomControlType(E.getParameter("zoomControlType"));var o=this.getGanttCharts()[0];I={zoomLevel:o.getAggregation("axisTimeStrategy").getProperty("zoomLevel"),displayType:o.getProperty("displayType"),enableAdhocLine:o.getProperty("enableAdhocLine"),enableCursorLine:o.getProperty("enableCursorLine"),enableDeltaLine:o.getProperty("enableDeltaLine"),enableNowLine:o.getProperty("enableNowLine"),enableVerticalLine:o.getProperty("enableVerticalLine"),enableNonWorkingTime:o.getProperty("enableNonWorkingTime"),enableStatusBar:this.getEnableStatusBar()};};f.prototype._handleZoomControlType=function(z){var i=this.getGanttCharts();i.forEach(function(o){o.getAxisTimeStrategy()._updateZoomControlType(z);});};f.prototype._onToolbarSettingsChange=function(E){var p=E.getParameters();var i=[],j=[],s="";p.forEach(function(P){if(P.isStandard){var k=P.name.substr(4);if(h.indexOf(k)>=0){this["set"+c(k,0)](P.value);switch(h.indexOf(k)){case 0:s="GanttContainerEnableTimeScrollSync";break;case 1:s="GanttContainerEnableCursorLine";break;case 2:s="GanttContainerEnableNowLine";break;case 3:s="GanttContainerEnableVerticalLine";break;case 4:s="GanttContainerEnableAdhocLine";break;case 5:s="GanttContainerEnableDeltaLine";break;case 6:s="GanttContainerEnableNonWorkingTime";break;case 7:s="GanttContainerEnableStatusBar";break;}j.push({"selectorElement":this,"changeSpecificData":{"changeType":s,"content":{"propertyName":k,"newValue":P.value,"oldValue":I[k]}}});}}else{delete P.isStandard;i.push(P);}}.bind(this));if(i.length>0){this.fireCustomSettingChange(i);}d.add({changes:j});};f.prototype.customVariantChange=function(){var o=this.getVariantHandler().getData(),i=[];i.push({"selectorElement":this,"changeSpecificData":{"changeType":"GanttContainerCustom","content":o}});d.add({changes:i});};f.prototype.observePropertiesChanges=function(o){var s;var t=this.getToolbar();if(!o){s=h.reduce(function(m,p){m[p]=this.getProperty(p);return m;}.bind(this),{});if(t){var i=t._oSettingsBox.getItems();var j=this.getHideSettingsItem();i.forEach(function(k){var m=j.filter(function(n){return k.getName().endsWith(n);})[0];if(m){k.setVisible(false);}});}}else{s={};s[o.name]=o.current;}if(t){t.updateSettingsConfig(s);}};f.prototype.createItems=function(){this.msgText=new e(this.getId()+"-ganttStatusBarMsgText",{maxLines:1}).addStyleClass("sapUiSmallMarginEnd");this.dateTimeText=new e(this.getId()+"-ganttStatusBarDateTimeText",{textAlign:sap.ui.core.TextAlign.Right});return[this.msgText,this.dateTimeText];};f.prototype.updateAxisTimeSettings=function(){this.getGanttCharts().forEach(function(o){o.getAxisTimeStrategy().initialSettings.zoomLevel=o.getAxisTimeStrategy().getZoomLevel();});};return f;},true);
