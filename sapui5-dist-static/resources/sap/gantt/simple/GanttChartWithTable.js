/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/ui/thirdparty/jquery","sap/base/assert","sap/base/Log","sap/ui/core/Control","sap/ui/model/ChangeReason","sap/base/util/values","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","sap/ui/core/ResizeHandler","./InnerGanttChart","./GanttHeader","./GanttSyncedControl","../control/AssociateContainer","../axistime/ProportionZoomStrategy","./SelectionModel","./ExpandModel","./ShapeScheme","./GanttExtension","./GanttScrollExtension","./GanttZoomExtension","./GanttPointerExtension","./GanttDragDropExtension","./GanttPopoverExtension","./GanttConnectExtension","./GanttResizeExtension","./GanttLassoExtension","./GanttUtils","./RenderUtils","../misc/Format","../misc/Utility","../config/TimeHorizon","sap/ui/export/Spreadsheet","sap/m/OverflowToolbar",'sap/ui/core/Core','sap/base/util/uid','sap/m/Dialog','sap/m/Input','sap/m/Label','sap/m/VBox','sap/m/Button','sap/ui/model/json/JSONModel','sap/m/Menu','sap/m/MenuButton','sap/m/MenuItem',"sap/ui/fl/write/api/ControlPersonalizationWriteAPI","./GanttChartWithTableRenderer"],function(l,q,c,L,C,d,v,S,e,R,I,G,f,A,P,g,E,h,j,k,m,n,o,p,r,s,t,u,w,F,U,T,z,O,B,D,H,J,K,V,M,N,Q,W,X,Y){"use strict";var Z=l.simple.GanttChartWithTableDisplayType,$=l.simple.VisibleHorizonUpdateType,_=l.simple.exportTableCustomDataType;var a1=Object.freeze({"totalHorizonUpdated":$.TotalHorizonUpdated,"mouseWheelZoom":$.MouseWheelZoom,"syncVisibleHorizon":$.SyncVisibleHorizon,"initialRender":$.InitialRender,"horizontalScroll":$.HorizontalScroll,"zoomLevelChanged":$.ZoomLevelChanged,"timePeriodZooming":$.TimePeriodZooming});var b1=B.getLibraryResourceBundle("sap.gantt");var c1=10;var d1=60;function e1(a,b){return a+b;}function f1(a,b){return Math.abs(a-b)<c1;}var g1=C.extend("sap.gantt.simple.GanttChartWithTable",{metadata:{library:"sap.gantt",properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},shapeSelectionMode:{type:"sap.gantt.SelectionMode",defaultValue:l.SelectionMode.MultiWithKeyboard},shapeOverRelationship:{type:"boolean",defaultValue:true},shapeSelectionSettings:{type:"object",defaultValue:null},enableCursorLine:{type:"boolean",defaultValue:true},enableNowLine:{type:"boolean",defaultValue:true},nowLineInUTC:{type:"boolean",defaultValue:true},enableVerticalLine:{type:"boolean",defaultValue:true},enableAdhocLine:{type:"boolean",defaultValue:true},adhocLineLayer:{type:"string",defaultValue:l.AdhocLineLayer.Top},enableDeltaLine:{type:"boolean",defaultValue:true},enableNonWorkingTime:{type:"boolean",defaultValue:true},enableChartDeltaAreaHighlight:{type:"boolean",defaultValue:true},deltaLineLayer:{type:"string",defaultValue:l.DeltaLineLayer.Bottom},datePattern:{type:"string",defaultValue:l.config.DEFAULT_DATE_PATTERN},timePattern:{type:"string",defaultValue:l.config.DEFAULT_TIME_PATTERN},enableExpandedRowBorders:{type:"boolean",defaultValue:true},enableExpandedRowBackground:{type:"boolean",defaultValue:true},expandedRowHeight:{type:"int"},dragOrientation:{type:"sap.gantt.DragOrientation",defaultValue:l.DragOrientation.Free},ghostAlignment:{type:"string",defaultValue:l.dragdrop.GhostAlignment.None},showShapeTimeOnDrag:{type:"boolean",defaultValue:false},selectionPanelSize:{type:"sap.ui.core.CSSSize",defaultValue:"30%"},displayType:{type:"sap.gantt.simple.GanttChartWithTableDisplayType",defaultValue:Z.Both},disableShapeDoubleClickEvent:{type:"boolean",defaultValue:false},showExportTableToExcel:{type:"boolean",defaultValue:false},enableSelectAndDrag:{type:"boolean",defaultValue:true},deltaAreaHighlightColor:{type:"string",defaultValue:"@sapUiListSelectionBackgroundColor"},enableLassoInvert:{type:"boolean",defaultValue:false},showParentRowOnExpand:{type:"boolean",defaultValue:true}},aggregations:{table:{type:"sap.ui.table.Table",multiple:false},adhocLines:{type:"sap.gantt.AdhocLine",multiple:true,singularName:"adhocLine",bindable:"bindable",visibility:"public"},simpleAdhocLines:{type:"sap.gantt.simple.AdhocLine",multiple:true,singularName:"simpleAdhocLine",bindable:"bindable",visibility:"public"},deltaLines:{type:"sap.gantt.simple.DeltaLine",multiple:true,singularName:"deltaLine",bindable:"bindable",visibility:"public"},svgDefs:{type:"sap.gantt.def.SvgDefs",multiple:false,singularName:"svgDef"},shapeSchemes:{type:"sap.gantt.simple.ShapeScheme",multiple:true,singularName:"shapeScheme"},calendarDef:{type:"sap.gantt.def.cal.CalendarDefs",multiple:false,bindable:"bindable"},axisTimeStrategy:{type:"sap.gantt.axistime.AxisTimeStrategyBase",multiple:false,bindable:"bindable"},locale:{type:"sap.gantt.config.Locale",multiple:false},_splitter:{type:"sap.ui.layout.Splitter",multiple:false,visibility:"hidden"},_header:{type:"sap.gantt.simple.GanttHeader",multiple:false,defaultValue:null,visibility:"hidden"},_innerGantt:{type:"sap.gantt.simple.InnerGanttChart",multiple:false,visibility:"hidden"}},events:{shapeSelectionChange:{parameters:{shapeUids:{type:"string[]"}}},shapeResize:{parameters:{shapeUid:{type:"string"},shape:{type:"sap.gantt.simple.BaseShape"},rowObject:{type:"object"},oldTime:{type:"string[]"},newTime:{type:"string[]"}}},shapeMouseEnter:{parameters:{shape:{type:"sap.gantt.simple.BaseShape"},pageX:{type:"int"},pageY:{type:"int"}}},shapeMouseLeave:{parameters:{shape:{type:"sap.gantt.simple.BaseShape"},originEvent:{type:"object"}}},shapePress:{parameters:{popoverOffsetX:{type:"int"},rowSettings:{type:"sap.gantt.simple.GanttRowSettings"},shape:{type:"sap.gantt.simple.BaseShape"}},allowPreventDefault:true},shapeDoubleClick:{parameters:{popoverOffsetX:{type:"int"},rowSettings:{type:"sap.gantt.simple.GanttRowSettings"},shape:{type:"sap.gantt.simple.BaseShape"}}},shapeContextMenu:{parameters:{pageX:{type:"int"},pageY:{type:"int"},popoverOffsetX:{type:"int"},rowSettings:{type:"sap.gantt.simple.GanttRowSettings"},shape:{type:"sap.gantt.simple.BaseShape"}}},dragStart:{parameters:{sourceGanttChart:{type:"sap.gantt.simple.GanttChartWithTable"},draggedShapeDates:{type:"object"},lastDraggedShapeUid:{type:"string"},cursorDateTime:{type:"object"}}},shapeDrop:{parameters:{sourceGanttChart:{type:"sap.gantt.simple.GanttChartWithTable"},targetGanttChart:{type:"sap.gantt.simple.GanttChartWithTable"},draggedShapeDates:{type:"object"},lastDraggedShapeUid:{type:"string"},targetRow:{type:"sap.ui.table.Row"},cursorDateTime:{type:"object"},newDateTime:{type:"object"},targetShape:{type:"sap.gantt.simple.BaseShape"}}},shapeConnect:{parameters:{fromShapeUid:{type:"string"},toShapeUid:{type:"string"},type:{type:"sap.gantt.simple.RelationshipType"}}},visibleHorizonUpdate:{parameters:{type:{type:"sap.gantt.simple.VisibleHorizonUpdateType"},lastVisibleHorizon:{type:"sap.gantt.config.TimeHorizon"},currentVisibleHorizon:{type:"sap.gantt.config.TimeHorizon"}}}}}});g1.prototype.init=function(){this.iGanttRenderedWidth=-1;this._bExtensionsInitialized=false;this._oExpandModel=new E();this._aExpandedIndices=[];this._oSplitter=new S({id:this.getId()+"-ganttChartSplitter"});this.setAggregation("_splitter",this._oSplitter);this._oSyncedControl=new f();this.setAggregation("_innerGantt",new I());this.setAggregation("_header",new G());this._sPreviousDisplayType=this.getDisplayType();};g1.prototype.getInnerGantt=function(){return this.getAggregation("_innerGantt");};g1.prototype.onSplitterResize=function(a){var b=a.getParameter("oldSizes"),i=a.getParameter("newSizes"),x=b.length>0&&i.length>0&&b[0]!==i[0],y=this.getDisplayType(),h1=i[0];if(x){if(y===Z.Both){this._onResize(x);}var i1=function(j1){return this.getSelectionPanelSize().startsWith("0")||j1[0]!==0;}.bind(this);if(f1(b.reduce(e1),i.reduce(e1))&&b[0]!==i[0]&&i1(b)){this.setProperty("selectionPanelSize",h1+"px",true);this.fireEvent("_selectionPanelResize",{newWidth:h1,displayType:y});}this._draw();}};g1.prototype.setLayoutData=function(a){this.setAggregation("layoutData",a,true);this.fireEvent("_layoutDataChange");return this;};g1.prototype.setDisplayType=function(a){this._sPreviousDisplayType=this.getDisplayType();if(this._sPreviousDisplayType===Z.Both&&a!==Z.Both){this._iLastTableAreaSize=this.getAggregation("_splitter").getContentAreas()[0]&&this.getAggregation("_splitter").getContentAreas()[0].getLayoutData().getSize();}this.setProperty("displayType",a,false);if(a===Z.Table){this.setProperty("selectionPanelSize","auto",true);}else{delete this._bPreventInitialRender;}this._setupDisplayType();return this;};g1.prototype.setSelectionPanelSize=function(a){this.setProperty("selectionPanelSize",a,false);delete this._iLastTableAreaSize;this._setSplitterLayoutData(a,"auto");return this;};g1.prototype.applySettings=function(a,b){a=a||{};this._applyMissingSettings(a);C.prototype.applySettings.call(this,a,b);this._initSelectionModel(this.getProperty("shapeSelectionMode"));};g1.prototype._applyMissingSettings=function(a){if(!a.axisTimeStrategy){a.axisTimeStrategy=new P();}if(!a.locale){a.locale=l.config.DEFAULT_LOCALE_CET.clone();}if(!a.shapeSchemes){a.shapeSchemes=[new h({key:"default",primary:true})];}else{var b=a.shapeSchemes.some(function(i){return i.getPrimary();});if(!b){L.warning("you need set a ShapeSheme with primary:true");}}};g1.prototype.getPrimaryShapeScheme=function(){return this.getShapeSchemes().filter(function(a){return a.getPrimary();})[0];};g1.prototype.getSyncedControl=function(){return this._oSyncedControl;};g1.prototype.getTableRowHeights=function(){return this.getSyncedControl().getRowHeights();};g1.prototype.setTable=function(a){this.setAggregation("table",a);a._bVariableRowHeightEnabled=true;var b=this._oSplitter.removeContentArea(0);this._oSplitter.insertContentArea(new A({content:a,enableRootDiv:true,layoutData:a.getLayoutData()?a.getLayoutData().clone():new e({size:this.getSelectionPanelSize()})}),0);if(b==null){this._oSyncedControl.syncWith(a);this._oSplitter.addContentArea(this._oSyncedControl);}else if(b&&b.getContent()!==a.getId()){this._oSyncedControl.syncWith(a);}a.detachEvent("_rowsUpdated",this._onTableRowsUpdated,this);a.attachEvent("_rowsUpdated",this._onTableRowsUpdated,this);a.attachEvent("columnMove",this._onTableColumnMove,this);a.attachEvent("filter",this._onTableFilter,this);a.attachEvent("sort",this._onTableSorter,this);a.attachEvent("columnVisibility",this._onColumnVisible,this);};g1.prototype.setEnableVariableRowHeight=function(b){if(this.getTable()){this.getTable()._bVariableRowHeightEnabled=b;}else{L.warning("you need to set table aggregation first");}};g1.prototype.setLargeDataScrolling=function(b){if(this.getTable()){this.getTable()._setLargeDataScrolling(b);}else{L.warning("you need to set table aggregation first");}};g1.prototype.getRenderedTimeRange=function(){return this.getAxisTime().getTimeRangeSlice(0,this.iGanttRenderedWidth);};g1.prototype._initSelectionModel=function(a){if(this.oSelection){this.oSelection.detachSelectionChanged(this._onSelectionChanged,this);}this.oSelection=new g(a);this.oSelection.attachSelectionChanged(this._onSelectionChanged,this);return this;};g1.prototype.setShapeSelectionMode=function(a){this.setProperty("shapeSelectionMode",a);if(this.oSelection){this.oSelection.setSelectionMode(a);}return this;};g1.prototype.getSelectedShapeUid=function(){return this.oSelection.allUid();};g1.prototype.setSelectedShapeUid=function(a){return this.selectShapes(a,true);};g1.prototype.selectShapes=function(a,b){if(!this.oSelection){return this;}if((!a||a.length===0)&&b){this.oSelection.clear(true);return this;}if(b){this.oSelection.clear(false);}this._updateShapes(a,true);return this;};g1.prototype.deselectShapes=function(a){if(!this.oSelection||!a||a.length===0){return this;}this._updateShapes(a,false);return this;};g1.prototype._updateShapes=function(a,b){var x={};var y=u.getShapesWithUid(this.getId(),a);for(var i=0;i<a.length;i++){x[a[i]]={selected:b,ctrl:false};if(y[i]){x.draggable=y[i].getDraggable();x.time=y[i].getTime();x.endTime=y[i].getEndTime();}}this.oSelection.updateShapes(x);};g1.prototype._onSelectionChanged=function(a){var b=a.getParameter("shapeUid"),i=a.getParameter("deselectedUid"),x=a.getParameter("silent");this._updateShapeSelections(b,i);if(!x){this.fireShapeSelectionChange({shapeUids:b});}};g1.prototype.handleShapePress=function(a){var b=a.shape,i=b.getShapeUid(),x=a.ctrlOrMeta,y=this._getDragDropExtension();var h1=!b.getSelected();if(y.shapeSelectedOnMouseDown&&!y.initiallySelected&&!this.getEnableSelectAndDrag()){h1=y.shapeSelectedOnMouseDown;}this.oSelection.updateShape(i,{selected:h1,ctrl:x,draggable:b.getDraggable(),time:b.getTime(),endTime:b.getEndTime()});y.shapeSelectedOnMouseDown=false;};g1.prototype.handleShapeMouseEnter=function(a){if(!this.getEnableSelectAndDrag()){var b=a.shape,i=this._getResizeExtension();if(!b.getSelected()){i.addResizerOnMouseOver(b);}var x=this._getDragDropExtension();if(b.getDraggable()){x.updateCursorStyle("move");}}};g1.prototype.handleShapeMouseLeave=function(a){if(!this.getEnableSelectAndDrag()){var b=this._getDragDropExtension();b.updateCursorStyle("default");}};g1.prototype._updateShapeSelections=function(a,b){var i=this.getShapeSelectionMode();if(i===l.SelectionMode.None){return;}w.updateShapeSelections(this,a,b);};g1.prototype._updateVsbContainers=function(){if(this.getParent().isA("sap.gantt.simple.GanttChartContainer")&&this.getParent().getGanttCharts().length>1){var a=this.getParent().getGanttCharts();var b=false;var i,x;for(i=0;i<a.length;i++){x=a[i];if(!x.getTable()._getScrollExtension().getVerticalScrollbar().classList.contains("sapUiTableHidden")){b=true;break;}}if(b){for(i=0;i<a.length;i++){x=a[i];var y=x.getTable()._getScrollExtension().getVerticalScrollbar().classList;if(y.contains("sapUiTableHidden")){y.add("sapVerticalScrollBarContainer");}else{y.remove("sapVerticalScrollBarContainer");}}}else{for(i=0;i<a.length;i++){x=a[i];x.getTable()._getScrollExtension().getVerticalScrollbar().classList.remove("sapVerticalScrollBarContainer");}}}};g1.prototype.getSelection=function(){return this.oSelection;};g1.prototype.getExpandedBackgroundData=function(){if(this._oExpandModel.hasExpandedRows()){var a=this.getTable().getRows();var b=a.length;var x=this.getTable().getFirstVisibleRow();var y=[];for(var i=0;i<b;i++){if(a[i].getIndex()>=x){var h1=a[i].getAggregation("_settings");y.push(h1.getRowUid());}}return this._oExpandModel.collectExpandedBgData(y,this.getExpandedRowHeight(),this.getShowParentRowOnExpand());}};g1.prototype.setAxisTimeStrategy=function(a){a.attachEvent("_redrawRequest",this._onRedrawRequest,this);delete this._bPreventInitialRender;return this.setAggregation("axisTimeStrategy",a,false);};g1.prototype._onTableFilter=function(a){var b=[{"selectorElement":a.mParameters.column,"changeSpecificData":{"changeType":"TableColumnFilterValue","content":{propertyName:"filterValue",newValue:a.mParameters.value,oldValue:""}}}];Y.add({changes:b});};g1.prototype._onTableSorter=function(a){var b=[{"selectorElement":a.mParameters.column,"changeSpecificData":{"changeType":"TableColumnSortOrder","content":{propertyName:"sortOrder",newValue:a.mParameters.sortOrder,oldValue:"Ascending"}}}];Y.add({changes:b});};g1.prototype._onColumnVisible=function(a){var b=a.mParameters.newVisible;var i=[{"selectorElement":a.mParameters.column,"changeSpecificData":{"changeType":"TableColumnVisibility","content":{propertyName:"visible",newValue:b,oldValue:!b}}}];Y.add({changes:i});};g1.prototype._onTableColumnMove=function(a){var b=a.getSource().getAggregation('columns').map(function(x){return x.getId();});var i=a.getParameter('column').getIndex();var h1=a.getParameter('newPos');var i1=Array.from(new Set(b));var j1=u.arrayMove(i1,i,h1);var k1=[];j1.forEach(function(x,m1){var n1=a.getSource().getAggregation('columns').find(function(y){return y.getId()===x;});k1.push(n1.getId());});var l1=[];l1.push({"selectorElement":this.getTable(),"changeSpecificData":{"changeType":"GanttTableColumnOrder","content":{"aggregationName":"columns","newValue":k1,"oldValue":b}}});Y.add({changes:l1});};g1.prototype._onTableRowsUpdated=function(a){if(!this.getVisible()){return;}var b=a.getParameter("reason"),i=this.getInnerGantt();var x=v(d).slice();var y=x.concat(["Render","FirstVisibleRowChange","Resize"]);if(y.indexOf(b)!==-1){this.getSyncedControl().setAllowContentScroll(false);i.invalidate();}else if(b==="VerticalScroll"){}else{i.getRenderer().renderImmediately(this);}};g1.prototype.syncVisibleHorizon=function(a,i,b,x){var y=this.getAxisTimeStrategy();var h1=y.getTotalHorizon();var i1;var j1=this.getVisibleWidth();if(i!==undefined){if(j1===undefined){return;}if(b){var k1=y.getVisibleHorizon();var l1=F.abapTimestampToDate(k1.getStartTime());i1=U.calculateHorizonByWidth(a,i,j1,l1);}else{i1=U.calculateHorizonByWidth(a,i,j1);}}else{i1=a;}if(h1.getEndTime()<i1.getEndTime()){var m1=F.abapTimestampToDate(i1.getEndTime()).getTime()-F.abapTimestampToDate(i1.getStartTime()).getTime();var n1=F.abapTimestampToDate(h1.getEndTime());var o1=new Date();o1.setTime(n1.getTime()-m1);i1=new T({startTime:o1,endTime:n1});}this._updateVisibleHorizon(i1,x||"syncVisibleHorizon",j1);};g1.prototype._updateVisibleHorizon=function(a,b,i){var x=this.getAxisTimeStrategy();x.updateGanttVisibleWidth(i);if(a&&(a.getStartTime()||a.getEndTime())){x.setVisibleHorizonWithReason(a,b);}};g1.prototype.syncMouseWheelZoom=function(a){this._getZoomExtension().performMouseWheelZooming(a.originEvent,true);};g1.prototype.syncTimePeriodZoomOperation=function(a,b,i){this._getZoomExtension().syncTimePeriodZoomOperation(a,b,i);};g1.prototype._onRedrawRequest=function(a){var b=a.getParameter("valueBeforeChange");var i=a.getParameter("reasonCode");if(b&&i!=="totalHorizonUpdated"&&i!=="initialRender"&&i!=="syncVisibleHorizon"){this._syncContainerGanttCharts(i,a.getParameter("originEvent"));}this.fireVisibleHorizonUpdate({type:a1[i],lastVisibleHorizon:b,currentVisibleHorizon:this.getAxisTimeStrategy().getVisibleHorizon()});this.redraw(i);this._setupDisplayType();};g1.prototype.redraw=function(a){this._draw(a);};g1.prototype._draw=function(a){if(this.getDisplayType()===Z.Table){this.getParent().getToolbar().updateZoomLevel(this.getAxisTimeStrategy().getZoomLevel());}else{var i=this.getVisibleWidth();if(!i){return;}var b=this.getAxisTimeStrategy().syncContext(i);if(this.getAxisTimeStrategy().initialSettings!=null&&this.getAxisTimeStrategy().initialSettings.zoomLevel!=null&&this.getAxisTimeStrategy().initialSettings.zoomLevel!=0&&a=="initialRender"&&!this.getAxisTimeStrategy().isA("sap.gantt.axistime.FullScreenStrategy")&&!this.isPrint){var x=this.getAxisTimeStrategy();var y=x.initialSettings.zoomLevel;x.setProperty("zoomLevel",y,true);b.zoomLevel=y;var h1=x.calVisibleHorizonByRate(x._aZoomRate[y]);x.updateInitialVisibleHorizon(h1,y);}this.fireEvent("_zoomInfoUpdated",b);var i1=this._getScrollExtension();if(b.axisTimeChanged){i1.clearOffsetWidth();}i1.needRerenderGantt(function(){this.getInnerGantt().getRenderer().renderImmediately(this);}.bind(this),a);}};g1.prototype._syncContainerGanttCharts=function(a,b){var i=this.getParent();if(i&&i.isA("sap.gantt.simple.GanttChartContainer")&&i.getGanttCharts().length>1){this.fireEvent("_initialRenderGanttChartsSync",{reasonCode:a,visibleHorizon:this.getAxisTimeStrategy().getVisibleHorizon(),visibleWidth:this.getVisibleWidth(),originEvent:b});}};g1.prototype.onBeforeRendering=function(a){this._updateRowHeightInExpandModel(this.getTable());j.detachEvents(this);this._oSplitter.detachResize(this.onSplitterResize,this);if(this._sResizeHandlerId){R.deregister(this._sResizeHandlerId);}if(this.getDisplayType()!==Z.Table){this.getInnerGantt().invalidate();}var b=this.getTable();if(this.getShowExportTableToExcel()){if(this.oExportTableToExcelButton==null){this.oExportTableToExcelButton=new W(this.getId()+"-exportTableToExcelButton",{icon:"sap-icon://excel-attachment",tooltip:b1.getText("EXPORT_BUTTON_TEXT"),type:sap.m.ButtonType.Transparent,buttonMode:sap.m.MenuButtonMode.Split,useDefaultActionOnly:true,defaultAction:[function(){this._exportTableToExcel();},this],menu:[new Q({items:[new X({text:b1.getText("QUICK_EXPORT"),press:[function(){this._exportTableToExcel();},this]}),new X({text:b1.getText("EXPORT_WITH_SETTINGS"),press:[function(){this._createExportDialogBox();},this]})]})]});}u.addToolbarToTable(this,b,true);}else if(!this.getShowExportTableToExcel()&&(b.getExtension().length>0&&!(b.getExtension()[0].getContent().indexOf(this.oExportTableToExcelButton)===-1))){if(b.getExtension()[0].getContent().length==1){b.removeExtension(b.getExtension()[0]);}else if(b.getExtension()[0].getContent().length>1){b.getExtension()[0].removeContent(this.oExportTableToExcelButton);}}};g1.prototype.onAfterRendering=function(a){this._attachExtensions();j.attachEvents(this);this._oSplitter.attachResize(this.onSplitterResize,this);this._sResizeHandlerId=R.register(this,this._onResize.bind(this));if(this.mProperties.hasOwnProperty("height")||(this.getParent()&&this.getParent().mProperties.hasOwnProperty("height"))){this.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Auto);this.getTable().setMinAutoRowCount(1);}};g1.prototype._onResize=function(i){if(this.getDisplayType()!==Z.Both){return;}var a=this.getAggregation("_splitter");this._sPreviousDisplayType=this.getDisplayType();if(this._sPreviousDisplayType===Z.Both){this._iLastTableAreaSize=this.getAggregation("_splitter").getContentAreas()[0]&&this.getAggregation("_splitter").getContentAreas()[0].getLayoutData().getSize();}if(a.getContentAreas()[0]&&a.getContentAreas()[0].getLayoutData()){var b=a.getContentAreas()[0],x=b.getLayoutData(),y=this.getDomRef().offsetWidth,h1;if(y<d1*2){h1=y/2;h1=h1+"px";}else{var i1=b.getDomRef().offsetWidth;if(i1>d1){return;}if(this.getSelectionPanelSize()!=null&&i1==0&&i!=true){h1=this.getSelectionPanelSize();}else{h1=Math.max(Math.min(i1,y-d1),d1);h1=h1+"px";}}x.setSize(h1);}};g1.prototype._setupDisplayType=function(){var a=this.getDisplayType();if(a===Z.Table){var i=this.getSyncedControl().$().find(".sapGanttBackgroundVScrollContentArea").width();if(i!==null){this._setSplitterLayoutData("auto",i+"px");}}else if(a===Z.Chart){this._setSplitterLayoutData("0px","auto");}else if(a!==this._sPreviousDisplayType){this._setSplitterLayoutData(this._iLastTableAreaSize?this._iLastTableAreaSize:this.getSelectionPanelSize(),"auto");}};g1.prototype._setSplitterLayoutData=function(a,b){var i=this._oSplitter.getContentAreas();if(i.length>1){var x=i[0].getLayoutData(),y=i[1].getLayoutData(),h1=this.getDisplayType()===Z.Both;x.setSize(a).setResizable(h1);y.setSize(b).setResizable(h1);}};g1.prototype._updateRowHeightInExpandModel=function(a){var i=a.getRowHeight();if(i===0){i=a._getDefaultRowHeight();}this._oExpandModel.setBaseRowHeight(i);};g1.prototype.jumpToPosition=function(a){if(Object.prototype.toString.call(a)==="[object Date]"||typeof a==="string"){this._updateVisibleHorizon(new T({startTime:a}),"jumpToPosition",this.getVisibleWidth());}else if(Array.isArray(a)){this._updateVisibleHorizon(new T({startTime:a[0],endTime:a[1]}),"jumpToPosition",this.getVisibleWidth());}else if(a===undefined){this._updateVisibleHorizon(this.getAxisTimeStrategy().getTotalHorizon(),"jumpToPosition",this.getVisibleWidth());}};g1.prototype.exit=function(){if(this._sResizeHandlerId){R.deregister(this._sResizeHandlerId);}this._detachExtensions();delete this._bPreventInitialRender;};g1.prototype._attachExtensions=function(){if(this._bExtensionsInitialized){return;}j.enrich(this,k);j.enrich(this,m);j.enrich(this,n);j.enrich(this,o);j.enrich(this,p);j.enrich(this,r);j.enrich(this,s);j.enrich(this,t);this._bExtensionsInitialized=true;};g1.prototype._detachExtensions=function(){j.cleanup(this);};g1.prototype.getAxisTime=function(){var a=this.getAxisTimeStrategy().getAxisTime();if(!a){this.getAxisTimeStrategy().createAxisTime(this.getLocale());a=this.getAxisTimeStrategy().getAxisTime();}return a;};g1.prototype.getContentWidth=function(){var a=this.getAxisTime(),b=a.getViewRange();return(Math.abs(Math.ceil(b[1])-Math.ceil(b[0]))-1);};g1.prototype.getVisibleWidth=function(){return this._getScrollExtension?this._getScrollExtension().getVisibleWidth():undefined;};g1.prototype.expand=function(a,b){this.toggleShapeScheme(true,a,b);this._aExpandedIndices=this._aExpandedIndices.concat(b);this._aExpandedIndices=Array.from(new Set(this._aExpandedIndices));};g1.prototype.collapse=function(a,b){this.toggleShapeScheme(false,a,b);var i=[];i=i.concat(b);this._aExpandedIndices=this._aExpandedIndices.filter(function(x){return i.indexOf(x)==-1;});};g1.prototype.toggleShapeScheme=function(b,a,i){var x=[];if(typeof i==="number"){x=[i];}else if(Array.isArray(i)){x=i;}if(x.length===0||!a){return;}var y=this.getShapeSchemes().filter(function(j1){return j1.getKey()===a;});if(y==null||y.length===0||y.length>1){c(false,"shape scheme must not be null or not found in shapeSchemes");return;}var h1=this.getPrimaryShapeScheme();var i1=this._oExpandModel.isTableRowHeightNeedChange(b,this.getTable(),x,h1,y[0]);if(i1){this.getTable().invalidate();}};g1.prototype.isShapeVisible=function(a){if(a&&a.isVisible()){return true;}if(!a.getVisible()){return false;}var b=this.getRenderedTimeRange(),i=b[0],x=b[1];var y=a.getTime(),h1=a.getEndTime();var i1=function(j1){return(j1>=i&&j1<=x);};if(a.getSelected()||!y||!h1){return true;}else if(y&&h1){return i1(y)||i1(h1)||(y<=i&&h1>=x);}else if(y&&!h1){return i1(y);}else if(!y&&h1){return i1(h1);}};g1.prototype.doBirdEye=function(i){var a=this._getZoomExtension();a.doBirdEye(i);};g1.prototype._exportTableToExcel=function(a){var b,i,x,y,h1,i1;h1=this.getTable();if(h1){i1=h1.getBinding(h1._sAggregation);}if(i1.getModel().isA('sap.ui.model.json.JSONModel')){y=true;}b=this._createColumnConfig();var j1=i1.getModel();i={workbook:{columns:b},fileName:a&&a.fileName?a.fileName:"GanttTableExport.xlsx",worker:false};if(y){i.dataSource=this._createJSONDataSource(h1);}else{i.dataSource={type:"odata",dataUrl:i1.getDownloadUrl?i1.getDownloadUrl():null,serviceUrl:this._sServiceUrl,headers:j1.getHeaders?j1.getHeaders():null,count:i1.getLength?i1.getLength():null};}if(h1.getColumns()[0].data("exportTableColumnConfig")&&h1.getColumns()[0].data("exportTableColumnConfig").hierarchyNodeLevel){i.workbook.hierarchyLevel=h1.getColumns()[0].data("exportTableColumnConfig").hierarchyNodeLevel;}x=new z(i);x.build().finally(function(){x.destroy();});};g1.prototype._createExportDialogBox=function(){this._getExportSettingsViaDialog().then(function(a){this._exportTableToExcel(a);}.bind(this));};g1.prototype._getExportSettingsViaDialog=function(a){return new Promise(function(b,i){var x;var y=new N();var h1={fileName:"GanttTableExport",fileType:[{key:"xlsx"}],selectedFileType:"xlsx"};y.setData(h1);var i1=D();x=new H({id:i1,title:b1.getText("EXPORT_SETTINGS_TITLE"),content:[new V({renderType:"Bare",width:"100%",items:[new K({text:b1.getText("FILE_NAME"),labelFor:i1+"-fileName"}),new J({id:i1+"-fileName",value:"{/fileName}",liveChange:function(j1){var k1=j1.getSource();var l1=j1.getParameter("value");var m1=/[\\/:|?"*<>]/;var n1=B.byId(i1+"-export");var o1=m1.test(l1);if(o1){k1.setValueState(sap.ui.core.ValueState.Error);k1.setValueStateText(b1.getText("FILENAME_ERROR"));}else if(l1.length>100){k1.setValueState(sap.ui.core.ValueState.Warning);k1.setValueStateText(b1.getText("FILENAME_WARNING"));}else{k1.setValueState(sap.ui.core.ValueState.None);k1.setValueStateText(null);}n1.setEnabled(!o1);}}).addStyleClass("sapUiTinyMarginBottom")]}).addStyleClass("sapUiExportSettingsLabel")],endButton:new M({id:i1+"-cancel",text:b1.getText("CANCEL_BUTTON"),press:function(){x.close();}}),beginButton:new M({id:i1+"-export",text:b1.getText("QUICK_EXPORT"),type:sap.m.ButtonType.Emphasized,press:function(){if(x){x._bSuccess=true;x.close();b(y.getData());}}}),afterClose:function(){if(!x._bSuccess){L.warning("sap.gantt.simple.GanttChartWithTable ","Cancel Click on Export to Excel PopOver",this);i(null);}x.destroy();x=null;}});x.addStyleClass("sapUiContentPadding sapUiExportSettings");x.setModel(y);x.open();if(a){a(x);}});};g1.prototype._createColumnConfig=function(){var a,i,b,x,y,h1,i1,j1,k1,l1=[],m1,n1,o1;this._oTable=this.getTable();a=this._oTable.getColumns();b=a.length;for(i=0;i<b;i++){i1=null;m1=null;n1=null;o1=null;k1=null;x=a[i];if(x.getVisible()){y=x.data("exportTableColumnConfig");if(!i1&&y){i1=y["leadingProperty"];}if(Array.isArray(i1)){i1=i1[0];}if(i1){h1=this._getColumnLabel(x);j1=x.getWidth().toLowerCase()||y.width||"";j1=this._getColumnWidthNumber(j1);if(y.unitProperty){k1=y.isCurrency?sap.ui.export.EdmType.Currency:sap.ui.export.EdmType.Number;}else if(y.isDigitSequence){k1=sap.ui.export.EdmType.Number;}if(!k1){switch(y.dataType){case _.Numeric:k1=sap.ui.export.EdmType.Number;break;case _.DateTime:k1=sap.ui.export.EdmType.DateTime;o1=y.displayFormat;break;case _.StringDate:case _.Date:k1=sap.ui.export.EdmType.Date;o1=y.displayFormat;break;case _.Boolean:k1=sap.ui.export.EdmType.Boolean;m1="false";n1="true";break;case _.String:k1=sap.ui.export.EdmType.String;break;case _.Time:k1=sap.ui.export.EdmType.Time;break;default:k1=sap.ui.export.EdmType.String;break;}}l1.push({columnId:x.getId(),property:i1,type:k1,format:o1?o1:undefined,label:h1?h1:i1,width:j1,textAlign:x.getHAlign(),trueValue:(k1===sap.ui.export.EdmType.Boolean&&n1)?n1:undefined,falseValue:(k1===sap.ui.export.EdmType.Boolean&&m1)?m1:undefined,unitProperty:(k1===sap.ui.export.EdmType.Currency||(k1===sap.ui.export.EdmType.Number))?y.unitProperty:undefined,displayUnit:k1===sap.ui.export.EdmType.Currency,unit:y.unit?y.unit:undefined,precision:y.precision?y.precision:undefined,scale:y.scale?y.scale:undefined,wrap:y.wrap?y.wrap:false});}}}return l1;};g1.prototype._getColumnLabel=function(a){var b;if(!a){return null;}if(a.getLabel){b=a.getLabel();}if(a.getHeader){b=a.getHeader();}return(b&&b.getText)?b.getText():null;};g1.prototype._getColumnWidthNumber=function(a){if(a.indexOf("em")>0){return Math.round(parseFloat(a));}if(a.indexOf("px")>0){return Math.round(parseInt(a,10)/16);}return"";};g1.prototype._createJSONDataSource=function(a){var b,i,x,y=[];b=a.getBinding(a._sAggregation).mParameters.arrayNames[0];i=a.getBinding().sPath;x=a.getModel().getProperty(i);y=this._generateJSONRowData(x[b],b,y);return y;};g1.prototype._generateJSONRowData=function(a,b,x){if(!a){return[];}if(!x){x=[];}for(var i=0;i<a.length;i++){x.push(a[i]);if(a[i][b]){this._generateJSONRowData(a[i][b],b,x);}}return x;};g1.prototype.setRowsHeight=function(a){this.oRowsCustomHeight=a;this.getTable().invalidate();};return g1;},true);
