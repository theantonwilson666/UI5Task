sap.ui.define(["sap/ui/core/Core","sap/gantt/library","sap/ui/base/ManagedObjectObserver","sap/ui/core/Item","sap/ui/base/Object","sap/base/Log","sap/m/library","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/FlexBox","sap/m/OverflowToolbarButton","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/Select","sap/m/ViewSettingsDialog","sap/m/ViewSettingsCustomTab","sap/m/CheckBox","sap/m/Slider","sap/m/Popover","../control/AssociateContainer","sap/ui/fl/variants/VariantManagement","sap/ui/fl/apply/api/ControlVariantApplyAPI","./ContainerToolbarRenderer"],function(C,l,M,a,B,L,m,O,b,T,F,c,S,d,e,V,f,g,h,P,A,j,k){"use strict";var G=l.simple.GanttChartWithTableDisplayType,n=l.simple.ContainerToolbarPlaceholderType,p=m.OverflowToolbarPriority,q=m.FlexDirection,r=m.ButtonType,s=m.PlacementType;var t=O.extend("sap.gantt.simple.ContainerToolbar",{metadata:{library:"sap.gantt",properties:{showBirdEyeButton:{type:"boolean",defaultValue:false},showDisplayTypeButton:{type:"boolean",defaultValue:false},showLegendButton:{type:"boolean",defaultValue:false},showSettingButton:{type:"boolean",defaultValue:true},showTimeZoomControl:{type:"boolean",defaultValue:true},zoomControlType:{type:"sap.gantt.config.ZoomControlType",defaultValue:l.config.ZoomControlType.SliderWithButtons},stepCountOfSlider:{type:"int",defaultValue:10},infoOfSelectItems:{type:"object[]",defaultValue:[]},zoomLevel:{type:"int",defaultValue:0},alignCustomContentToRight:{type:"boolean",defaultValue:false},enableVariantManagement:{type:"boolean",defaultValue:false}},aggregations:{settingItems:{type:"sap.gantt.config.SettingItem",multiple:true},legendContainer:{type:"sap.ui.core.Control",multiple:false,visibility:"public"}},events:{zoomStopChange:{parameters:{index:{type:"int"},selectedItem:{type:"sap.ui.core.Item"}}},birdEyeButtonPress:{},displayTypeChange:{parameters:{displayType:{type:"sap.gantt.simple.GanttChartWithTableDisplayType"}}}}}});t.prototype.init=function(){O.prototype.init.apply(this,arguments);this.mSettingsConfig={};this._oRb=C.getLibraryResourceBundle("sap.gantt");this.oObserver=new M(this.observeChanges.bind(this));this.oObserver.observe(this,{properties:["enableVariantManagement","showBirdEyeButton","showLegendButton","showTimeZoomControl","showSettingButton","zoomControlType","infoOfSelectItems","showDisplayTypeButton","alignCustomContentToRight"],aggregations:["content"]});this.bShallUpdateContent=true;this.bZoomControlTypeChanged=false;this.bContentAlignChanged=false;this._bSuppressZoomStopChange=false;this.oToolbarSpacer=new T(this.getId()+"-toolbarSpacer");};t.prototype.observeChanges=function(o){if(!this.bShallUpdateContent){this.bShallUpdateContent=true;this.bZoomControlTypeChanged=o.name==="zoomControlType";this.bContentAlignChanged=o.name==="alignCustomContentToRight";}};t.prototype.exit=function(){this.oObserver.disconnect();this._destroyIfExists([this._oDisplayTypeSegmentedButton,this._oBirdEyeButton,this._oSelect,this._oTimeZoomFlexBox,this._oSettingsDialog,this._oSettingsButton,this._oLegendPop,this._oLegendButton,this._oVariantManagement]);O.prototype.exit.apply(this,arguments);};t.prototype.applySettings=function(i,u){i=i||{};if(!i.settingItems){i.settingItems=l.config.DEFAULT_TOOLBAR_SETTING_ITEMS.map(function(o){return o.clone();});}O.prototype.applySettings.apply(this,arguments);this._createControlsOnly();return this;};t.prototype.onBeforeRendering=function(){if(this.bShallUpdateContent===true){this.updateToolbarContents();this.bShallUpdateContent=false;this.bZoomControlTypeChanged=false;this.bContentAlignChanged=false;}};t.prototype.updateToolbarContents=function(){var i=this.getContent(),o={},u=0;var N=function(w){return this.getContent().indexOf(w)===-1;}.bind(this);var v=function(w,x,y){if(!w._getControl()){w._setControl(y);}w.setProperty("_show",x);};var I=function(w,x,y){var z=o[w],D=N(y);if(z){v(z,x,y);}else if(x){u++;}if(!D&&(z||!x)){this.removeContent(y);}else if(!z&&x&&D){if(w===n.VariantManagement){this.insertContent(y,0);var E=function(){var H=this.getParent();H.updateAxisTimeSettings();H.fireVariantApplied();};k.attachVariantApplied({selector:this.getParent(),vmControlId:this._oVariantManagement.getId(),callAfterInitialVariant:true,callback:E.bind(this)});}else if(w===n.Spacer){this.insertContent(y,this.getAlignCustomContentToRight()?0:this.getContent().length-u+1);}else{this.addContent(y);}}}.bind(this);i.forEach(function(w){var x;if(B.isA(w,"sap.gantt.simple.ContainerToolbarPlaceholder")){x=w.getType();if(o[x]){L.warning("There are more than one sap.gantt.simple.ContainerToolbarPlaceholder of the "+x+" type.");}o[x]=w;}});if(this.bContentAlignChanged){this.removeContent(this.oToolbarSpacer);}I(n.BirdEyeButton,this.getShowBirdEyeButton(),this._genBirdEyeButton());I(n.TimeZoomControl,this.getShowTimeZoomControl(),this._genTimeZoomFlexBox());I(n.LegendButton,this.getShowLegendButton(),this._genLegend());I(n.SettingButton,this.getShowSettingButton(),this._genSettings());I(n.DisplayTypeButton,this.getShowDisplayTypeButton(),this._genDisplayTypeButton());I(n.Spacer,true,this.oToolbarSpacer);I(n.VariantManagement,this.getEnableVariantManagement(),this._genVariantManagement());};t.prototype._createControlsOnly=function(){this._genBirdEyeButton();this._genTimeZoomGroupControls();this._genLegend();this._genSettings();this._genDisplayTypeButton();};t.prototype._destroyIfExists=function(i){i.forEach(function(o){if(o){o.destroy();}});};t.prototype._genVariantManagement=function(){if(this._oVariantManagement==null){this._oVariantManagement=new j({"id":this.getId()+"-variantManagement","for":[this.getParent()],"executeOnSelectionForStandardDefault":true}).addStyleClass("sapUiCompVarMngmt").addStyleClass("sapMBarChild").addStyleClass("sapUiCompSmartTableToolbarContent");}return this._oVariantManagement;};t.prototype._genDisplayTypeButton=function(){if(this._oDisplayTypeSegmentedButton){return this._oDisplayTypeSegmentedButton;}this._oDisplayTypeSegmentedButton=new S(this.getId()+"-displayTypeSegmentedButton",{selectedKey:G.Both,selectionChange:function(E){this.fireDisplayTypeChange({displayType:E.getParameter("item").getKey()});}.bind(this),items:[new d(this.getId()+"-"+G.Both+"SegmentedButtonItem",{tooltip:this._oRb.getText("TLTP_DISPLAY_TYPE_BUTTON_BOTH"),icon:"sap-icon://Chart-Tree-Map",key:G.Both}),new d(this.getId()+"-"+G.Chart+"SegmentedButtonItem",{tooltip:this._oRb.getText("TLTP_DISPLAY_TYPE_BUTTON_CHART"),icon:"sap-icon://along-stacked-chart",key:G.Chart}),new d(this.getId()+"-"+G.Table+"SegmentedButtonItem",{tooltip:this._oRb.getText("TLTP_DISPLAY_TYPE_BUTTON_TABLE"),icon:"sap-icon://table-view",key:G.Table})]});};t.prototype._genBirdEyeButton=function(){if(this._oBirdEyeButton==null){var i=function(R){var o=R.getText("TXT_BRIDEYE"),u=R.getText("TXT_BRIDEYE_RANGE_VISIBLE_ROWS"),v=R.getText("TLTP_BRIDEYE_ON_VISIBLE_ROWS");return o+" ("+u+"): "+v;};this._oBirdEyeButton=new c(this.getId()+"-birdEyeButton",{icon:"sap-icon://show",type:r.Transparent,text:this._oRb.getText("TXT_BIRDEYE_BUTTON"),tooltip:i(this._oRb),press:this.fireBirdEyeButtonPress.bind(this)});}return this._oBirdEyeButton;};t.prototype._getSelectItems=function(){var o=[],I=this.getInfoOfSelectItems();if(I.length>0){if(I[0]instanceof a){o=I;}else{for(var i=0;i<I.length;i++){o.push(new a({key:I[i].key,text:I[i].text}));}}}return o;};t.prototype._genTimeZoomGroupControls=function(){var Z=l.config.ZoomControlType;var z=this.getZoomControlType();var u=function(v){clearTimeout(this._iLiveChangeTimer);this._iLiveChangeTimer=-1;this.setZoomLevel(v,true);};this.fireEvent("_zoomControlTypeChange",{zoomControlType:z});if(z===Z.None){return[];}if(z===Z.Select){if(this._oSelect){return[this._oSelect];}var i=this._getSelectItems();this._oSelect=new e(this.getId()+"-zoomSelect",{items:i,selectedItem:i[this.getZoomLevel()],change:function(E){var v=E.getSource();var w=v.getSelectedItem();var x=v.indexOfItem(w);this._iLiveChangeTimer=setTimeout(u.bind(this),200,[x,w]);}.bind(this)});return[this._oSelect];}else{if(this._oZoomSlider){this._oZoomSlider.setMax(this.getStepCountOfSlider()-1);if(z===Z.SliderOnly){return[this._oZoomSlider];}else if(z===Z.ButtonsOnly){return[this._oZoomOutButton,this._oZoomInButton];}else{return[this._oZoomOutButton,this._oZoomSlider,this._oZoomInButton];}}this._oZoomSlider=new h(this.getId()+"-zoomSlider",{width:"200px",max:this.getStepCountOfSlider()-1,value:this.getZoomLevel(),min:0,step:1,liveChange:function(E){var v=parseInt(E.getParameter("value"),10);clearTimeout(this._iLiveChangeTimer);this._iLiveChangeTimer=setTimeout(u.bind(this),200,v);}.bind(this)});var o=function(v){return function(E){this._iLiveChangeTimer=setTimeout(function(){var w=parseInt(v?this._oZoomSlider.stepUp(1).getValue():this._oZoomSlider.stepDown(1).getValue(),10);u.call(this,w);}.bind(this),200);};};this._oZoomInButton=new c(this.getId()+"-zoomInButton",{icon:"sap-icon://zoom-in",type:r.Transparent,tooltip:this._oRb.getText("TLTP_SLIDER_ZOOM_IN"),ariaDescribedBy:[this._oZoomSlider],press:o(true).bind(this)});this._oZoomOutButton=new c(this.getId()+"-zoomOutButton",{icon:"sap-icon://zoom-out",type:r.Transparent,tooltip:this._oRb.getText("TLTP_SLIDER_ZOOM_OUT"),ariaDescribedBy:[this._oZoomSlider],press:o(false).bind(this)});return[this._oZoomOutButton,this._oZoomSlider,this._oZoomInButton];}};t.prototype._genTimeZoomFlexBox=function(){if(this._oTimeZoomFlexBox){if(this.bZoomControlTypeChanged){this._oTimeZoomFlexBox.removeAllItems();this._genTimeZoomGroupControls().forEach(function(i){this._oTimeZoomFlexBox.addItem(i);}.bind(this));}return this._oTimeZoomFlexBox;}this._oTimeZoomFlexBox=new F(this.getId()+"-timeZoomFlexBox",{items:this._genTimeZoomGroupControls(),layoutData:new b({priority:p.NeverOverflow})});return this._oTimeZoomFlexBox;};t.prototype._genSettingItems=function(){return this.getSettingItems().map(function(o){var i=new g(this.getId()+"-"+o.getKey()+"CheckBox",{name:o.getKey(),text:o.getDisplayText(),tooltip:o.getTooltip(),selected:o.getChecked()}).addStyleClass("sapUiSettingBoxItem");i.isStandard=o.get_isStandard();return i;}.bind(this));};t.prototype._genSettings=function(){if(this._oSettingsButton){if(this._oSettingsBox&&(this._oSettingsBox.getItems().length===this.getSettingItems().length)){var o=this._oSettingsBox.getItems(),u=this.getSettingItems();for(var i=0;i<o.length;i++){var v=o[i],w=u[i];v.setName(w.getKey());v.setText(w.getDisplayText());v.setTooltip(w.getTooltip());v.setSelected(w.getChecked());}}else{this._oSettingsBox.destroyItems();this._genSettingItems().forEach(function(w){this._oSettingsBox.addItem(w);}.bind(this));}return this._oSettingsButton;}this._oSettingsBox=new F(this.getId()+"-settingsFlexBox",{direction:q.Column,items:this._genSettingItems()}).addStyleClass("sapUiSettingBox");this._oSettingsDialog=new V(this.getId()+"-settingsDialog",{title:this._oRb.getText("SETTINGS_DIALOG_TITLE"),customTabs:[new f({content:this._oSettingsBox})],confirm:function(){this._fireSettingItemChangedEvent();if(this.getParent()&&this.getParent().isA("sap.gantt.simple.GanttChartContainer")){this.getParent()._oSplitter.resetContentAreasSizes();}}.bind(this),cancel:function(){this.updateSettingItems(this.mSettingsConfig);}.bind(this),reset:function(){this._genSettings();}.bind(this)});this._oSettingsButton=new c(this.getId()+"-settingsButton",{icon:"sap-icon://action-settings",type:r.Transparent,text:this._oRb.getText("TXT_SETTING_BUTTON"),tooltip:this._oRb.getText("TXT_SETTING_BUTTON"),layoutData:new b({priority:p.High}),press:function(E){this._oSettingsDialog.open();}.bind(this)});return this._oSettingsButton;};t.prototype._genLegend=function(){if(this._oLegendButton){return this._oLegendButton;}if(!this._oLegendPop){this._oLegendPop=new P(this.getId()+"-legendPopover",{placement:s.Bottom,showArrow:false,showHeader:false});}this._oLegendButton=new c(this.getId()+"-legendButton",{icon:"sap-icon://legend",type:r.Transparent,text:this._oRb.getText("TXT_LEGEND_BUTTON"),tooltip:this._oRb.getText("TLTP_SHOW_LEGEND"),layoutData:new b({priority:p.High,closeOverflowOnInteraction:false}),press:function(E){var o=this._oLegendPop;if(o.isOpen()){o.close();}else{o.openBy(this._oLegendButton);}}.bind(this)});return this._oLegendButton;};t.prototype.updateZoomLevel=function(z){this._bSuppressZoomStopChange=true;this.setZoomLevel(z);};t.prototype.setZoomLevel=function(z,i){if(!isNaN(z)){var o=this.getZoomLevel();if(this._oZoomSlider&&this._oZoomOutButton&&this._oZoomInButton){var u=this._oZoomSlider.getMax(),v=this._oZoomSlider.getMin();if(z===u){this._oZoomInButton.setEnabled(false);this._oZoomOutButton.setEnabled(true);}else if(z===v){this._oZoomInButton.setEnabled(true);this._oZoomOutButton.setEnabled(false);}else{this._oZoomInButton.setEnabled(true);this._oZoomOutButton.setEnabled(true);}}if(o!==z){this.setProperty("zoomLevel",z,i);if(this._oZoomSlider){this._oZoomSlider.setValue(z);if(!this._bSuppressZoomStopChange){this.fireZoomStopChange({index:z});}}if(this._oSelect){this._oSelect.setSelectedItem(this._oSelect.getItems()[z]);if(!this._bSuppressZoomStopChange){this.fireZoomStopChange({index:z,selectedItem:this._oSelect.getSelectedItem()});}}}}this._bSuppressZoomStopChange=false;return this;};t.prototype.setLegendContainer=function(o){this.setAggregation("legendContainer",o);if(!this._oLegendPop){this._oLegendPop=new P(this.getId()+"-legendPopover",{placement:s.Bottom,showArrow:false,showHeader:false});}if(o){this._oLegendPop.removeAllContent();this._oLegendPop.addContent(new A({content:o}));}};t.prototype._fireSettingItemChangedEvent=function(){var o=this._oSettingsBox.getItems();var u=[];for(var i=0;i<o.length;i++){var v=o[i].getName(),w=v.substr(4),x="",N=o[i].getSelected();if(o[i].isStandard){x=this.mSettingsConfig[w];}else{x=this.mSettingsConfig[v];}if(x!==N){u.push({name:v,value:N,isStandard:o[i].isStandard});if(!o[i].isStandard){this.mSettingsConfig[v]=N;}}}if(u.length>0){this.fireEvent("_settingsChange",u);}};t.prototype.updateSettingsConfig=function(i){var o=this.getSettingItems();Object.keys(i).forEach(function(u){this.mSettingsConfig[u]=i[u];var v=o.filter(function(I){return I.getKey().endsWith(u);})[0];if(v){v.setChecked(i[u]);}}.bind(this));this.updateSettingItems(i);this._updateMSettingsConfigWithCustom(o);};t.prototype.updateCustomSettingsConfig=function(){var o={};var i=this.getSettingItems();this._updateMSettingsConfigWithCustom(i,o);this.updateSettingItems(o);};t.prototype._updateMSettingsConfigWithCustom=function(i,o){i.forEach(function(I){var K=I.getKey();var u=I.getChecked();if(!I.get_isStandard()&&this.mSettingsConfig[K]!==u){if(o){o[K]=u;}this.mSettingsConfig[K]=I.getChecked();}}.bind(this));};t.prototype.updateSettingItems=function(i){var o=this._oSettingsBox.getItems();Object.keys(i).forEach(function(u){var v=o.filter(function(I){return I.getName().endsWith(u);})[0];if(v){v.setSelected(i[u]);}});};t.prototype.getAllToolbarItems=function(){return this.getContent();};t.prototype.setInfoOfSelectItems=function(i,o){this.setProperty("infoOfSelectItems",i,o);var u=this;if(this._oSelect){var v=this._getSelectItems();this._oSelect.removeAllItems();v.forEach(function(w){u._oSelect.addItem(w);});}};return t;},true);
