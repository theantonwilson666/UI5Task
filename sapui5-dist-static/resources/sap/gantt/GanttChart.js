/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/base/Log","sap/ui/performance/Measurement","sap/ui/events/KeyCodes","sap/ui/Device","sap/ui/core/Core","sap/ui/table/TreeTable","./GanttChartBase","./misc/Utility","./drawer/ShapeInRow","./drawer/ShapeCrossRow","./drawer/CursorLine","./drawer/NowLine","./drawer/VerticalLine","./drawer/AdhocLine","./drawer/CalendarPattern","./drawer/ExpandedBackground","./misc/AxisOrdinal","./misc/Format","./eventHandler/AutoScrollHandler","./eventHandler/MouseWheelHandler","./eventHandler/TimePeriodZoomHandler","./axistime/ProportionZoomStrategy","./config/TimeHorizon","./misc/ShapeSelectionModel","./misc/ShapeManager","./eventHandler/ShapeResizeHandler","./eventHandler/ShapeHoverHandler","./eventHandler/TimePopoverHandler","./eventHandler/BirdEyeHandler","sap/ui/thirdparty/d3"],function(q,L,M,K,D,C,T,G,U,S,a,b,N,V,A,c,E,e,F,f,g,h,P,m,n,o,p,r,s,B){"use strict";var t=G.extend("sap.gantt.GanttChart",{metadata:{designtime:"sap/gantt/designtime/GanttChart.designtime",aggregations:{_treeTable:{type:"sap.ui.table.TreeTable",multiple:false,visibility:"hidden"}}}});t.prototype.init=function(){G.prototype.init.apply(this,arguments);M.start("GanttChart init","GanttPerf:GanttChart init function");this._oTT=new T(this.getId()+"-table",{visibleRowCountMode:"Auto",minAutoRowCount:1,columnHeaderVisible:false});q.extend(this.mDefaultTableProperties,{selectionBehavior:sap.ui.table.SelectionBehavior.RowOnly});this.setTableProperties(q.extend({},this.mDefaultTableProperties));this._oTT.setUseFlatMode(true);this._bJSONTreeBinding=true;this._oRowStatusMap={};this._oTT._bVariableRowHeightEnabled=true;var d=this;this._oTT._collectRowHeights=function(H){var j=T.prototype._collectRowHeights.apply(this,arguments);if(H){return j;}d._aHeights=j;if(d._aHeights[0]!==undefined&&d._aHeights[0]!==0){d._iInferedBaseRowHeightOnTT=d._aHeights[0];}var k=d.getBaseRowHeight();var l=d._getTTFirstRenderingRowIndex();var u=d._aHeights.length;var v=k;var w=d._getDrawingData([l,l+u-1]);if(w&&w.length>0){v=w[0].rowSpan*k;}for(var i=0;i<u;i++){var x=this.getContextByIndex(l+i);if(x){var y;if(d._bJSONTreeBinding){y=x.getObject();}else if(d._aFilteredRowData){y=d._aFilteredRowData[i];}var z=y?y.uid:undefined;if(z&&d._oRowStatusMap[z]){d._aHeights[i]=d._oRowStatusMap[z].visibleRowSpan*k;}else{d._aHeights[i]=v;}}else{d._aHeights[i]=k;}}return d._aHeights;};var R=sap.ui.getCore().getLibraryResourceBundle("sap.gantt");this._oColumn=new sap.ui.table.Column({template:new sap.ui.core.HTML({content:"<div tabIndex = \" 0 \" style=\" opacity : 0 \">"+R.getText("XCEL_GANTT_CELL")+"</div>"})});this._oTT.addColumn(this._oColumn);this.setAggregation("_treeTable",this._oTT);this._oTT.attachEvent("_rowsUpdated",this._onTTRowUpdate.bind(this));this._oTT.attachRowSelectionChange(this._onRowSelectionChange,this);this._oTT.addEventDelegate({onAfterRendering:this._bindScrollLogicForTT},this);this._oTT.addEventDelegate({onAfterRendering:this._initialSvgDrawing},this);this._oShapeInRowDrawer=new S();this._oShapeCrossRowDrawer=new a();this._oCursorLineDrawer=new b();this._oCalendarPatternDrawer=new c();this._oExpandedBackgroundDrawer=new E();this._oAxisOrdinal=undefined;this._aFilteredRowData=undefined;this._oStatusSet=null;this._nLowerRange=0;this._nUpperRange=0;this._oShapeSelection=new n({selectionMode:this.getShapeSelectionMode(),ganttChart:this});this._oShapeManager=new o(this);this._bMouseDown=false;this._bDragging=false;this._bDragStart=false;this._oDraggingData=undefined;this._lastHoverRowIndex=undefined;this._oChartSchemesConfigMap={};this._oChartSchemesConfigMap[sap.gantt.config.DEFAULT_CHART_SCHEME_KEY]=sap.gantt.config.DEFAULT_CHART_SCHEME;this._oObjectTypesConfigMap={};this._oObjectTypesConfigMap[sap.gantt.config.DEFAULT_OBJECT_TYPE_KEY]=sap.gantt.config.DEFAULT_OBJECT_TYPE;this._fExtendFactor=0.382;this._setAxisTimeStrategy(new P());this._mTimeouts={};this._bSuppressSetVisibleHorizon=false;this._oAutoScrollHandler=new f();this._oMouseWheelHandler=new g(this);this._oTimePeriodZoomHandler=new h(this);this._oShapeResizeHandler=new p(this);this._oShapeHoverHandler=new r(this);this._oTimePopoverHandler=new s(this);this._oBirdEyeHandler=new B(this);M.end("GanttChart init");};t.prototype.setAxisTimeStrategy=function(d){this._setAxisTimeStrategy(d);this._oStatusSet=null;this._draw(true);return this;};t.prototype._setAxisTimeStrategy=function(d){this.setAggregation("axisTimeStrategy",d,true);this._createAxisTime(d);d.attachEvent("_redrawRequest",this._onRedrawRequest,this);};t.prototype._onRedrawRequest=function(d){var i=d.getParameter("forceUpdate");var v=d.getParameter("valueBeforeChange");var R=d.getParameter("reasonCode");var O=d.getParameter("originEvent");if(R!=="totalHorizonUpdated"&&v){this._oLastVisibleHorizon=v;if(R!=="syncVisibleHorizon"){var j=this.getAxisTimeStrategy();var k=j.getVisibleHorizon();var l=this.getVisibleWidth();this.fireEvent("_visibleHorizonUpdate",{reasonCode:R,visibleHorizon:k,visibleWidth:l,originEvent:O});}}this.redraw(i);};t.prototype.setTimeAxis=function(d){this.setProperty("timeAxis",d,true);if(d){var i=d.getZoomStrategy();this.setAxisTimeStrategy(new P({totalHorizon:d.getPlanHorizon().clone(),visibleHorizon:d.getInitHorizon().clone(),timeLineOption:i[d.getGranularity()],coarsestTimeLineOption:i[d.getCoarsestGranularity()],finestTimeLineOption:i[d.getFinestGranularity()],timeLineOptions:i}));}else{this.setAxisTimeStrategy(null);}};t.prototype.setLocale=function(l){this.setProperty("locale",l,true);var d=this.getAxisTime();if(d){d.setLocale(l);this._draw(true);}return this;};t.prototype.setChartSchemes=function(d){this.setProperty("chartSchemes",d,true);this._oChartSchemesConfigMap={};if(d){for(var i=0;i<d.length;i++){this._oChartSchemesConfigMap[d[i].getKey()]=d[i];}}this._draw(true);return this;};t.prototype.setObjectTypes=function(O){this.setProperty("objectTypes",O,true);this._oObjectTypesConfigMap={};if(O){for(var i=0;i<O.length;i++){this._oObjectTypesConfigMap[O[i].getKey()]=O[i];}}this._draw(true);return this;};t.prototype.setSelectionMode=function(d){this.setProperty("selectionMode",d,true);this.setShapeSelectionMode(d);switch(d){case sap.gantt.SelectionMode.Multiple:case sap.gantt.SelectionMode.MultiWithKeyboard:this.setTableProperties({selectionMode:sap.ui.table.SelectionMode.MultiToggle});break;case sap.gantt.SelectionMode.None:case sap.gantt.SelectionMode.Single:this.setTableProperties({selectionMode:d});break;}return this;};t.prototype.setShapeSelectionMode=function(d){this.setProperty("shapeSelectionMode",d,true);this._oShapeSelection.setSelectionMode(d);return this;};t.prototype.setTableProperties=function(d){if(d.hasOwnProperty("selectionBehavior")){if(d.selectionBehavior!==sap.ui.table.SelectionBehavior.RowOnly){delete d.selectionBehavior;L.warning("Change GanttChart's TreeTable selectionBehavior is not allowed!");}}G.prototype.setTableProperties.apply(this,arguments);return this;};t.prototype._createAxisTime=function(d){if(d){d.createAxisTime(this.getLocale());this._nLowerRange=Math.ceil(this.getAxisTime().getViewRange()[0]);this._nUpperRange=Math.ceil(this.getAxisTime().getViewRange()[1]);}};t.prototype.setShapes=function(d){this.setProperty("shapes",d,true);if(this.getAxisTimeStrategy().getAxisTime()&&d&&d.length>0){this._shapesInited=false;this._ensureShapesCreated(function(){this._draw(true);}.bind(this));}return this;};t.prototype.setTimeZoomRate=function(d){this.setProperty("timeZoomRate",d,true);var i=this.getAxisTimeStrategy();if(i.onSetTimeZoomRate){i.onSetTimeZoomRate(d);}return this;};t.prototype.redraw=function(d){if(!this._initHorizonApplied){return;}if(d){this.resetWidthInfo();}this._draw(d);};t.prototype.resetWidthInfo=function(){this.getAxisTime().setViewOffset(0);this._oStatusSet=null;this._nLowerRange=Math.ceil(this.getAxisTime().getViewRange()[0]);this._nUpperRange=Math.ceil(this.getAxisTime().getViewRange()[1]);};t.prototype.updateRelationships=function(R){var d=this.getBinding("relationships");if(d){var i=d.getContexts(0,0);if(i&&i.length>0){this._aRelationshipsContexts=i;}}this._prepareRelationshipDataFromModel();};t.prototype.addRelationship=function(R){L.error("The control manages the relationships aggregation. The method \"addRelationship\" cannot be used programmatically!");};t.prototype.insertRelationship=function(i,R){L.error("The control manages the relationships aggregation. The method \"insertRelationship\" cannot be used programmatically!");};t.prototype.removeRelationship=function(R){L.error("The control manages the relationships aggregation. The method \"removeRelationship\" cannot be used programmatically!");};t.prototype.getRelationships=function(){L.error("The control manages the relationships aggregation. The method \"getRelationships\" cannot be used programmatically!");};t.prototype.destroyRelationships=function(){L.error("The control manages the relationships aggregation. The method \"destroyRelationships\" cannot be used programmatically!");};t.prototype.indexOfRelationship=function(R){L.error("The control manages the relationships aggregation. The method \"indexOfRelationship\" cannot be used programmatically!");};t.prototype.removeAllRelationships=function(){L.error("The control manages the relationships aggregation. The method \"removeAllRelationships\" cannot be used programmatically!");};t.prototype._bindAggregation=function(d,i){if(d=="rows"&&i){var j=this.getModel(i.model);var k=this.getBindingContext(i.model);if(k&&j){i.path=j.resolve(i.path,k);}this._getConfiguredRowKeys(i);this._oTT.bindRows(i);this._bJSONTreeBinding=(j instanceof sap.ui.model.json.JSONModel);}else{return G.prototype._bindAggregation.apply(this,arguments);}};t.prototype.onBeforeRendering=function(){this._bTableReady=false;this._iSvgHeight=0;this._detachEvents();this._shapesInited=false;this._ensureShapesCreated();};t.prototype._detachEvents=function(){var $=q(this.getDomSelectorById("svg-ctn"));var d=q(this.getDomSelectorById("header"));$.unbind("MozMousePixelScroll.sapUiTableMouseWheel",this._onMouseWheel);$.unbind("wheel.sapUiTableMouseWheel",this._onMouseWheel);d.unbind("MozMousePixelScroll.sapUiTableMouseWheel",this._onMouseWheel);d.unbind("wheel.sapUiTableMouseWheel",this._onMouseWheel);$.unbind("contextmenu",this._onContextMenu);$.unbind("mouseleave",this._onSvgMouseLeave);$.unbind("mouseenter",this._onSvgMouseEnter);$.unbind("mousedown",this._onSvgMouseDown);$.unbind("mousemove",this._onSvgMouseMove);$.unbind("mouseup",this._onSvgMouseUp);$.unbind("dblclick",this._onSvgDoubleClick);var i="keydown."+this.getId();q(document.body).unbind(i);if(D.support.touch){$.unbind("touchstart",this._onSvgTouchstart);$.unbind("touchend",this._onSvgTouchend);$.unbind("touchmove",this._onSvgTouchmove);d.unbind("touchstart",this._onSvgTouchstart);d.unbind("touchend",this._onSvgTouchend);d.unbind("touchmove",this._onSvgTouchmove);}this._oTimePeriodZoomHandler.detachEvents();};t.prototype.onAfterRendering=function(){this._attachEvents();};t.prototype._attachEvents=function(){var $=q(this.getDomSelectorById("svg-ctn"));var d=q(this.getDomSelectorById("header"));if(D.browser.firefox){$.bind("MozMousePixelScroll.sapUiTableMouseWheel",this._onMouseWheel.bind(this));d.bind("MozMousePixelScroll.sapUiTableMouseWheel",this._onMouseWheel.bind(this));}else{$.bind("wheel.sapUiTableMouseWheel",this._onMouseWheel.bind(this));d.bind("wheel.sapUiTableMouseWheel",this._onMouseWheel.bind(this));}$.bind("contextmenu",this._onContextMenu);$.bind("mouseenter",this._onSvgMouseEnter.bind(this));$.bind("mouseleave",this._onSvgMouseLeave.bind(this));$.bind("mousedown",this._onSvgMouseDown.bind(this));$.bind("mousemove",this._onSvgMouseMove.bind(this));$.bind("mouseup",this._onSvgMouseUp.bind(this));$.bind("dblclick",this._onSvgDoubleClick.bind(this));var i="keydown."+this.getId();q(document.body).bind(i,this._onKeyDown.bind(this));if(D.support.touch){$.bind("touchstart",this._onSvgTouchstart.bind(this));$.bind("touchend",this._onSvgTouchend.bind(this));$.bind("touchmove",this._onSvgTouchmove.bind(this));d.bind("touchstart",this._onSvgTouchstart.bind(this));d.bind("touchend",this._onSvgTouchend.bind(this));d.bind("touchmove",this._onSvgTouchmove.bind(this));}this._oTimePeriodZoomHandler.attachEvents();this.attachEvent("_autoScrolling",this._onAutoScrolling,this);};t.prototype._onAutoScrolling=function(d){if(this._oTimePeriodZoomHandler.isActive()){this._oTimePeriodZoomHandler.handleAutoScrolling(d);}this._oShapeResizeHandler._handleShapeResizingWhenAutoScroll();};t.prototype._getMouseOrTouchPoint=function(d){if(d.targetTouches&&d.targetTouches.length>0){return d.targetTouches[d.targetTouches.length-1];}else if(d.changedTouches&&d.changedTouches.length>0){return d.changedTouches[d.changedTouches.length-1];}return{"pageX":d.pageX,"pageY":d.pageY};};t.prototype._onTouchScrollStart=function(d){if(D.system.combi||D.system.phone||D.system.tablet){this._aTouchStartPosition=null;this._bIsScrollVertical=null;var i=this._getMouseOrTouchPoint(d);this._aTouchStartPosition=[i.pageX,i.pageY];var v=this.getTTVsbDom();if(v){this._iTouchScrollTop=v.scrollTop;}var H=this.getTTHsbDom();if(H){this._iTouchScrollLeft=H.scrollLeft;}}};t.prototype._onTouchScroll=function(d){if((D.system.combi||D.system.phone||D.system.tablet)&&this._aTouchStartPosition){var i=this._getMouseOrTouchPoint(d);var j=(i.pageX-this._aTouchStartPosition[0]);var k=(i.pageY-this._aTouchStartPosition[1]);if(this._bIsScrollVertical==null){this._bIsScrollVertical=Math.abs(k)>Math.abs(j);}if(this._bIsScrollVertical){var v=sap.ui.table.SharedDomRef.VerticalScrollBar;var l=this._oTT.getDomRef(v);if(l){var u=this._iTouchScrollTop-k;if(u>0&&u<(this._oTT.getDomRef(v+"-content").clientHeight-l.clientHeight)-1){this._preventBubbleAndDefault(d);}l.scrollTop=u;}}else{var H=sap.ui.table.SharedDomRef.HorizontalScrollBar;var w=this._oTT.getDomRef(H);if(w){var x=this._iTouchScrollLeft-j;if(x>0&&x<(this._oTT.getDomRef(H+"-content").clientWidth-w.clientWidth)-1){this._preventBubbleAndDefault(d);}w.scrollLeft=x;}}this._bScrolling=true;}};t.prototype._onMouseWheel=function(d){this._oMouseWheelHandler.handleEvent(d);};t.prototype.syncMouseWheelZoom=function(d){this._oMouseWheelHandler.handleEvent(d.originEvent,true);};t.prototype.handleExpandChartChange=function(d,i,j){return this._ensureShapesCreated(function(){j=j?j:this._getSelectionHandler().getSelectedIndices();if(j.length>0){this._updateRowStatusMap(d,i,j);this._oTT.updateRows("change",{});}}.bind(this));};t.prototype.invertRowExpandStatus=function(d,j){d=d?d:this._getSelectionHandler().getSelectedIndices();if(d.length>0&&j){for(var i=0;i<d.length;i++){var I=d[i];var k=this._ifRowExpanded(I,j);if(k!==null){this._updateRowStatusMap(!k,j,[I]);}}this._oTT.updateRows("change",{});}};t.prototype._ifRowExpanded=function(i,d){var j=this._oTT;var k=j.getBinding();var l=k.getContextByIndex(i);var u=null;if(l){var v=l.getObject();var w=v.uid;var x=this._getRowSpanWithData(v,d),y=x.name;if(w&&this._oRowStatusMap[w]&&this._oRowStatusMap[w][y]){u=true;}else{u=false;}}return u;};t.prototype._updateRowStatusMap=function(d,j,k){var l=this._oTT;var u=l.getBinding();for(var i=0;i<k.length;i++){var I=k[i];var v=u.getContextByIndex(I);if(v){var w;if(this._bJSONTreeBinding){w=v.getObject();}else{w=this._aFilteredRowData[I].data;}var x=w.uid;if(x){var y=this._getRowSpanWithData(w,j),z=y.name;if(d){if(this._oRowStatusMap[x]){this._oRowStatusMap[x][z]=y;}else{this._oRowStatusMap[x]={};this._oRowStatusMap[x][z]=y;}}else if(!d&&this._oRowStatusMap[x]){delete this._oRowStatusMap[x][z];delete this._oRowStatusMap[x].visibleRowSpan;if(q.isEmptyObject(this._oRowStatusMap[x])){delete this._oRowStatusMap[x];continue;}}this._getDrawingData([I,I]);}}}};t.prototype.isRowExpanded=function(){var R=!q.isEmptyObject(this._oRowStatusMap);return R;};t.prototype._getRowSpanWithData=function(d,i){var R=1,j=null,k=null,l=this.getRowTypeName();for(var u=0;u<i.length;u++){var v=i[u];var w;if(this._oChartSchemesConfigMap[v]&&this._oChartSchemesConfigMap[v].getModeKey()){w=this._oChartSchemesConfigMap[v].getModeKey();}else{w=this.getMode();}if(this._oObjectTypesConfigMap[d[l]]&&this._oObjectTypesConfigMap[d[l]].getExpandedChartSchemeKeys().length>0){var x=this._oObjectTypesConfigMap[d[l]].getExpandedChartSchemeKeys();if(q.inArray(v,x)>-1){var y=this._collectDataNameForValidChartScheme(v,w);if(y){k=y.drawData;R+=y.rowSpan;j=v;}}}}return{rowSpan:R,name:j,data:k};};t.prototype._updateTableRowHeights=function(){if(this._aHeights){this._oTT._updateRowHeights(this._aHeights,false);}};t.prototype.notifySourceChange=function(){this._oTT.setFirstVisibleRow(0);this.resetRowStatusMap();};t.prototype.resetRowStatusMap=function(){this._oRowStatusMap={};};t.prototype._collectDataNameForValidChartScheme=function(d,i){if(this._oChartSchemesConfigMap[d]){var j=[];var k=this._oChartSchemesConfigMap[d].getShapeKeys();var R=this._oChartSchemesConfigMap[d].getRowSpan();var l=this._oChartSchemesConfigMap[d].getRowIndexName();var u=this._oShapeManager.mShapeConfig;q.each(k,function(v,w){if(u[w]){var x=u[w].getModeKeys();if((x&&x.length>0&&q.inArray(i,x)>-1)||x.length==0||i==sap.gantt.config.DEFAULT_MODE_KEY){j.push(u[w].getShapeDataName());}}});if(j.length>0&&R>=1){return{"drawData":j,"rowSpan":R,"rowIndexName":l};}}};t.prototype._composeParameterForClickPosition=function(d){var i=q(this.getDomSelectorById("svg"));var j=this._getMouseXPos(d);var k=this._getSvgCoodinateByDiv(i[0],j,d.pageY);var x=j-i.offset().left||d.offsetX;var y=d.pageY-i.offset().top||d.offsetY;if(!this._oAxisOrdinalOfVisibleRow){return null;}var l=this.getAxisTime().viewToTime(x);var u=this._oAxisOrdinalOfVisibleRow.viewToRowIndex(y,this._getVisibleRowCount())+this._oTT.getFirstVisibleRow();var R=U.getRowDatumByEventTarget(d.target);var v=R?R.objectInfoRef:null;var w=false;var z=this._oAxisOrdinal.viewToElementIndex(y);var H=this._aFilteredRowData[z];if(H&&H.index&&H.index!==0){w=true;}var I={"startTime":l,"svgPoint":k,"leadingRowNum":u,"leadingRowInfo":v,"rowIndex":z,"rowInfo":H,"isExpandedRow":w};return I;};t.prototype.getAllRowData=function(){var d=this._oTT.getBinding("rows");return this._getDrawingData([0,d.getLength()-1]);};t.prototype.getAllSelections=function(){var d=this.getSelectedRows();var i=this.getSelectedShapes();var j=this.getSelectedRelationships();return{"rows":d,"shapes":i,"relationships":j};};t.prototype.getSelectedRows=function(){var d=this._getSelectionHandler().getSelectedIndices();var j=this._getDrawingData(undefined,d);var k=[];for(var i=0;i<j.length;i++){if(j[i]&&!j[i].parentId){k.push(j[i]);}}return k;};t.prototype.getSelectedShapes=function(){var d=this._oShapeSelection.getSelectedShapeDatum();var R={};d.forEach(function(i){var j=this._oShapeSelection.getRowDatumByShapeUid(i.uid,this),k=U.getShapeDataNameByUid(i.uid);var l=R[k]||[];l.push({"shapeUid":i.uid,"shapeData":i,"objectInfoRef":j});R[k]=l;}.bind(this));return R;};t.prototype.getSelectedRelationships=function(){return this._oShapeSelection.getSelectedRelationships();};t.prototype.getRowByShapeUid=function(d){return this._oShapeSelection.getRowDatumByShapeUid(d,this);};t.prototype.selectShapes=function(i,d){var j=this._oShapeSelection.selectShapes(i,d);if(j){this._drawSelectedShapes();}return this;};t.prototype.selectByUid=function(u){var d=this._oShapeSelection.selectShapeByUid(u,this);if(d){this._drawSelectedShapes();}return this;};t.prototype.deselectShapes=function(i){var d=this._oShapeSelection.deselectShapes(i);if(d){this._drawSelectedShapes();}return this;};t.prototype.selectRowsAndShapes=function(R,d){if(!R||R.length===0){this.deselectShapes();this.deselectRows();return this;}var j=[];var k=U.getRowDatumById(R,this.getId());q.each(k,function(_,u){var v=u.shapeData;for(var i=0;i<v.length;i++){var w=v[i];if(this.isShapeSelectable(w)){j.push(w.__id__);}}}.bind(this));this._oShapeSelection.selectUnderlyingTableRows(R,this._oTT,d);var l=this._oShapeSelection.selectShapes(j,d);if(l){this._drawSelectedShapes();}return this;};t.prototype.selectRelationships=function(i,d){var R=U.getShapeDatumById(i,this.getId());var u=this._oShapeSelection.selectRelationships(R,d);if(u){this._drawSelectedShapes();}return this;};t.prototype.deselectRelationships=function(i){var u=this._oShapeSelection.deselectRelationships(i);if(u){this._drawSelectedShapes();}return this;};t.prototype.selectRows=function(i,d){this._oShapeSelection.selectUnderlyingTableRows(i,this._oTT,d);return this;};t.prototype.deselectRows=function(i){this._oShapeSelection.deselectUnderlyingTableRows(i,this._oTT);return this;};t.prototype.expandToLevel=function(l){this._oTT.expandToLevel(l);return this;};t.prototype.expand=function(R){this._oTT.expand(R);return this;};t.prototype.collapse=function(R){this._oTT.collapse(R);return this;};t.prototype.getVisibleRowCount=function(){return this._oTT.getVisibleRowCount();};t.prototype._onRowSelectionChange=function(d){this.fireRowSelectionChange({originEvent:d});};t.prototype._selectionChange=function(d,i,j,k){var R=U.getRowDatumByEventTarget(k.target);var l=R?R.objectInfoRef:null;var u=this._oShapeSelection.changeShapeSelection(d,l,i,this._bDragging,this._oShapeResizeHandler.getIsResizing());return u;};t.prototype._syncTTSelection=function(d){M.start("GanttChart syncTTSelection","GanttPerf:GanttChart syncTTSelection function");var i=d.shiftKey;var j=d.ctrlKey;var $=q(this.getDomSelectorById("svg"))[0];var k=this._getSvgCoodinateByDiv($,this._getMouseXPos(d),d.pageY-window.pageYOffset);var R=parseInt(this._oAxisOrdinalOfVisibleRow.viewToElementIndex(k.y),10);if(R<0){return false;}var v=this._oTT.getRows();var I=v[R].getIndex();var l=this._getSelectionHandler();var u=typeof l.getSelectionMode==="function"?l.getSelectionMode():l._getSelectionMode();if(I>=0&&u!==sap.ui.table.SelectionMode.None){if(u===sap.ui.table.SelectionMode.Single){if(!l.isIndexSelected(I)){l.setSelectedIndex(I);}else{l.clearSelection();}}else{j=true;if(i){var w=l.getSelectedIndex();if(w>=0){if(w<I){l.addSelectionInterval(w,I);}else{l.addSelectionInterval(I,w);}}else{l.setSelectedIndex(I);}}else if(!l.isIndexSelected(I)){if(j){l.addSelectionInterval(I,I);}else{l.setSelectedIndex(I);}}else if(j){l.removeSelectionInterval(I,I);}else if(l.getSelectedIndices().length>1){l.setSelectedIndex(I);}}}M.end("GanttChart syncTTSelection");};t.prototype._setEventStatus=function(d){switch(d){case"dragEnter":this._bDragStart=true;break;case"mouseDown":this._bMouseDown=true;this._bDragging=false;this._bDragStart=false;this._bScrolling=false;break;case"mouseUp":this._bMouseDown=false;this._bScrolling=false;break;case"shapeDragStart":this._bDragStart=true;break;case"shapeDragging":if(this._bDragStart){this._bDragging=true;}break;case"shapeDragEnd":this._bDragging=false;this._bDragStart=false;this._oDraggingData=undefined;break;case"dragLeave":this._bDragStart=false;break;default:break;}};t.prototype._handleShapeDragStart=function(d){var j=q(this.getDomSelectorById("svg"));var k=d3.select(d.target).datum();var l=d.target.getAttribute("class").split(" ")[0];var u=this._oShapeManager.isShapeDraggable(k,l);if(k&&u){var v=this._oShapeSelection.getRowDatumByShapeUid(k.uid,this);if(v){var x=this._getMouseXPos(d)-j.offset().left||d.offsetX;var y=d.pageY-j.offset().top||d.offsetY;var w,z,H,I;if(d.target.getAttribute("x")&&d.target.getAttribute("width")){w=parseInt(d.target.getAttribute("x"),10);z=parseInt(d.target.getAttribute("y"),10);H=parseInt(d.target.getAttribute("width"),10);I=parseInt(d.target.getAttribute("height"),10);}else if(k.startTime){var J=this.getAxisTime().timeToView(F.abapTimestampToDate(k.startTime));var O=this.getAxisTime().timeToView(F.abapTimestampToDate(k.endTime));if(C.getConfiguration().getRTL()){w=O;H=(J-O)>0?(J-O):1;}else{w=J;H=(O-J)>0?(O-J):1;}z=y;I=v.rowHeight/2;}else{w=x;H=1;z=y;I=v.rowHeight/2;}var Q={"x":x,"y":y,"shapeX":w,"shapeWidth":H,"shapeY":z,"shapeHeight":I};var R=[];R.push({"shapeData":k,"objectInfo":v});var W=this._oShapeSelection.getSelectedShapeDatum();for(var i=0;i<W.length;i++){if(W[i].uid!==k.uid&&this._oShapeManager.isShapeDraggable(W[i])){R.push({"shapeData":W[i],"objectInfo":this._oShapeSelection.getRowDatumByShapeUid(W[i].uid,this)});}}var X=this._getDraggingDomObjs(d);this._oDraggingData={"sourceShapeData":R,"dragStartPoint":Q,"sourceSvgId":this.getId(),"targetSvgId":this.getId(),"domObject":X.contentDoms,"groupDom":X.groupDom};this._setEventStatus("shapeDragStart");q(document.body).unbind("mousemove.ganttChartDragDrop");q(document).unbind("mouseup.ganttChartDragDrop");q(document.body).bind("mousemove.ganttChartDragDrop",this._handleShapeDragging.bind(this));q(document).bind("mouseup.ganttChartDragDrop",this._handleShapeDragEnd.bind(this));if(this.getEnableShapeTimeDisplay()){this._oTimePopoverHandler.handleTimePopover(d);}}}};t.prototype._getDraggingDomObjs=function(d){var i={};var j=d3.select(d.target)[0][0];var k;if(j.parentElement){k=j.parentElement;}else if(j.parentNode){k=j.parentNode;}if(k&&k.getAttribute("class")){var l=k.getAttribute("class");var u=l.split(" ")[0];if(sap.ui.getCore().byId(u)instanceof sap.gantt.shape.Group){i.groupDom=k;i.contentDoms=k.childNodes;}else if(sap.ui.getCore().byId(u)instanceof sap.gantt.shape.Text){i.groupDom=k.parentElement;i.contentDoms=k.parentElement.childNodes;}}else{i.groupDom=j;i.contentDoms=[j];}return i;};t.prototype._handleShapeDragging=function(d){if(!D.support.touch&&(d.button!==0||d.buttons===0||d.ctrlKey)){return false;}var R=C.getConfiguration().getRTL();var i=q(this.getDomSelectorById("svg"));var j=Math.abs((this._getMouseXPos(d)-i.offset().left||d.offsetX)-this._oDraggingData.dragStartPoint.x);var k=Math.abs((d.pageY-i.offset().top||d.offsetY)-this._oDraggingData.dragStartPoint.y);if(j>3||k>3){var l=d3.select("#dragDropShadow");var u=l[0];if(this._oDraggingData===undefined){if(!l.empty()){l.remove();}}else{var v=this._oDraggingData.dragStartPoint.shapeX;var w=this._oDraggingData.dragStartPoint.shapeY;var x=this._oDraggingData.dragStartPoint.x;var y=this._oDraggingData.dragStartPoint.y;var z=12;var H=10;if(l.empty()||u===null){this._handleDragWithoutSelection(d);var I=this._oDraggingData.sourceShapeData.length;u=d3.select("body").append("div").attr("id","dragDropShadow");u.classed("sapGanttDraggingShadow",true);var J=12;var O=12;var Q=this._oDraggingData.groupDom.getBoundingClientRect();if(Q){z=Q.width;H=Q.height;J=R?J:Math.ceil(Q.right);}if(D.browser.safari){z=this._oDraggingData.dragStartPoint.shapeWidth;H=this._oDraggingData.dragStartPoint.shapeHeight;}var W=H/2;var X='width="'+(z+5)+'" '+'height="'+(H+10)+'"';var Y=q(this._oDraggingData.groupDom).clone();this._resetShadowRelativePosition(Y);var Z='<svg '+X+'>'+this._getOuterHTML(Y)+"</svg>";q("#dragDropShadow").append(Z);var $=u.select("svg");$.select("g").attr("opacity",0.5);$.append("text").attr("x",z/2-O/2).attr("y",W+4).attr("fill","blue").attr("font-size",O).text(function(){return I;});}var _;var a1=this._getMouseXPos(d);if(this.getGhostAlignment()===sap.gantt.dragdrop.GhostAlignment.Start){_=R?(a1-this._oDraggingData.dragStartPoint.shapeWidth):a1;}else if(this.getGhostAlignment()===sap.gantt.dragdrop.GhostAlignment.None){_=v+a1-x;}else if(this.getGhostAlignment()===sap.gantt.dragdrop.GhostAlignment.End){_=R?a1:(a1-this._oDraggingData.dragStartPoint.shapeWidth);}var b1=d.pageY;var c1=d.pageY;c1=w+b1-y;var d1=_+"px";var e1=c1+"px";var f1=z+5+"px";var g1=H+5+"px";d3.select("#dragDropShadow").style({'left':d1,'top':e1,'width':f1,'height':g1});q(document.body).addClass("sapGanttDraggingCursor sapGanttDraggingOverflow");q("svg").addClass("sapGanttDraggingCursor");this._setEventStatus("shapeDragging");this._handleAutoScroll(d);}}};t.prototype._resetShadowRelativePosition=function(d,i,j){var k=this;if(d.attr("x")!==undefined){if(!i){d.attr("x",0);d.attr("y",2);}}var l=d.children();if(l&&l.length>0){if(!i){l=l.filter(function(w,x){var J=q(x);if(J.is('text')){return false;}if(J.attr("x")==undefined||J.attr("y")==undefined){return false;}return true;});var u,v;l.each(function(w,z){var J=q(z);var x=J.attr("x");var y=J.attr("y")-2;if(!u){u=x;}else{u=x<u?x:u;}if(!v){v=y;}else{v=y<v?y:v;}});if(!u||!v){return;}l.each(function(w,x){var J=q(x);J.attr("x",J.attr("x")-u);J.attr("y",J.attr("y")-v);k._resetShadowRelativePosition(J,u,v);});}else{l.each(function(w,x){var J=q(x);if(J.attr("x")!==undefined){J.attr("x",J.attr("x")-i);J.attr("y",J.attr("y")-j);}k._resetShadowRelativePosition(J,i,j);});}}};t.prototype._handleDragWithoutSelection=function(d){var i=this._oDraggingData.sourceShapeData[0];if(!this._oShapeSelection.isShapeSelected(i.shapeData.uid)){var R=false;if(!d.ctrlKey){this._oDraggingData.sourceShapeData.splice(1,this._oDraggingData.sourceShapeData.length-1);R=this._oShapeSelection.clearAllSelections();}this._oShapeSelection.selectByShapeData(i.shapeData);this._drawSelectedShapes();this.fireShapeSelectionChange({originEvent:d});if(R){this.fireRelationshipSelectionChange({originEvent:d});}}};t.prototype._handleAutoScroll=function(d){return this._oAutoScrollHandler.autoScroll(this,d);};t.prototype._handleShapeDragEnd=function(d){this._oAutoScrollHandler.stop();var i=d3.select("#dragDropShadow");if(!i.empty()){i.remove();}if(this._bDragging&&this._oDraggingData!==undefined){var j=this.getId();this._collectDraggingShapeData(this._oDraggingData,d);this.fireShapeDragEnd({originEvent:d,sourceSvgId:this._oDraggingData.sourceSvgId,targetSvgId:j,sourceShapeData:this._oDraggingData.sourceShapeData,targetData:this._oDraggingData.targetData});}q(document.body).unbind("mousemove.ganttChartDragDrop");q(document).unbind("mouseup.ganttChartDragDrop");q("svg").removeClass("sapGanttDraggingCursor");q(document.body).removeClass("sapGanttDraggingCursor sapGanttDraggingOverflow");this._setEventStatus("shapeDragEnd");};t.prototype._collectDraggingShapeData=function(d,i){var j=q(this.getDomSelectorById("svg"));var x=parseInt((this._getMouseXPos(i)-j.offset().left||i.offsetX),10);var k=d.dragStartPoint.x;var l=x-parseInt(k,10);var u;var v=F.abapTimestampToDate(d.sourceShapeData[0].shapeData.endTime)-F.abapTimestampToDate(d.sourceShapeData[0].shapeData.startTime);if(this.getGhostAlignment()===sap.gantt.dragdrop.GhostAlignment.Start){u=x;}else if(this.getGhostAlignment()===sap.gantt.dragdrop.GhostAlignment.None){u=parseInt(d.dragStartPoint.shapeX,10)+l;}else if(this.getGhostAlignment()===sap.gantt.dragdrop.GhostAlignment.End){u=x-parseInt(d.dragStartPoint.shapeWidth,10);}var w,y;if(C.getConfiguration().getRTL()===true){y=this.getAxisTime().viewToTime(u).getTime();w=new Date(y-v).getTime();}else{w=this.getAxisTime().viewToTime(u).getTime();y=new Date(w+v).getTime();}var z=this._composeParameterForClickPosition(i);var H=z?z.rowInfo:undefined;d.targetData={"cursorTimestamp":this.getAxisTime().viewToTime(x).getTime(),"shapeTimestamp":{startTime:w,endTime:y},"mouseTimestamp":{startTime:w,endTime:y},"mode":this.getMode(),"objectInfo":H};};t.prototype.setDraggingData=function(d){if(d!==undefined){this._oDraggingData=d;}if(this._oDraggingData!==undefined){this._oDraggingData.targetSvgId=this.getId();q(document.body).unbind("mousemove.ganttChartDragDrop");q(document).unbind("mouseup.ganttChartDragDrop");q(document.body).bind("mousemove.ganttChartDragDrop",this._handleShapeDragging.bind(this));q(document).bind("mouseup.ganttChartDragDrop",this._handleShapeDragEnd.bind(this));q(document.body).unbind("mousemove.shapeDragDrop");q(document).unbind("mouseup.shapeDragDrop");q(document.body).bind("mousemove.shapeDragDrop",this._oTimePopoverHandler._handleTimePopoverDragging.bind(this._oTimePopoverHandler));q(document).bind("mouseup.shapeDragDrop",this._oTimePopoverHandler._handleTimePopoverEnd.bind(this._oTimePopoverHandler));this._setEventStatus("dragEnter");}};t.prototype.setTimePopoverData=function(d){this._oTimePopoverHandler.setCurrentPopoverData(d);};t.prototype._onSvgMouseEnter=function(d){if(d.button===0&&d.buttons!==0&&d.target&&(d.target.id===this.getId()+"-svg-ctn"||d.target.id===this.getId()+"-svg"||this._mouseInSvgCtn(d))){this.fireChartDragEnter({originEvent:d});}};t.prototype._onSvgMouseLeave=function(d){if(d.target&&(d.target.id===this.getId()+"-svg-ctn"||d.target.id===this.getId()+"-svg"||!this._mouseInSvgCtn(d))){if(this._bDragStart&&this._oDraggingData!==undefined){this._handleDragLeave(d);}this._destroyCursorLine();this._handleHoverLeave();this._oShapeHoverHandler.handleShapeHover(null,d);}};t.prototype._mouseInSvgCtn=function(d){var $=q(this.getDomSelectorById("svg-ctn"));var i=$.width()-((C.getConfiguration().getRTL()||(q(this.getTTVsbDom()).css("display")=="none"))?0:q(this.getTTVsbDom()).width());var j=$.height();var k=$.offset();var l=this._getMouseXPos(d)-k.left;var u=(d.pageY||d.clientY)-k.top;if(u>=0&&u<j&&l>=0&&l<i){return true;}return false;};t.prototype._onSvgMouseDown=function(d){this._prepareSelection(d);this._prepareDragging(d);this._oShapeResizeHandler.handleShapeResize(d);};t.prototype._onSvgMouseMove=function(d){this._drawCursorLine(d);this._handleHover(d);};t.prototype._onContextMenu=function(d){d.preventDefault();};t.prototype._onSvgMouseUp=function(d){if(d.button==2){this._handleRightClick(d);}else if(d.button==0&&!this._bDragging&&this._bMouseDown&&!this._oShapeResizeHandler.getIsResizing()){this._handleSelectionChange(d);}};t.prototype._onSvgDoubleClick=function(d){if(!this._bDragging&&!this._oShapeResizeHandler.getIsResizing()&&!d.ctrlKey&&!d.shiftKey&&!(D.os.name===D.os.OS.MACINTOSH&&d.metaKey)){var i=this._composeParameterForClickPosition(d);this.fireChartDoubleClick({objectInfo:i?i.rowInfo:undefined,leadingRowInfo:i?i.leadingRowInfo:undefined,timestamp:i?i.startTime.getTime():undefined,svgId:this.getId()+"-svg",svgCoordinate:i?i.svgPoint:undefined,effectingMode:this.getMode(),originEvent:d});}};t.prototype._onSvgTouchstart=function(d){this._prepareSelection(d);this._onTouchScrollStart(d);};t.prototype._onSvgTouchmove=function(d){this._onTouchScroll(d);};t.prototype._onSvgTouchend=function(d){if(this._bScrolling){this._setEventStatus("mouseUp");}};t.prototype._onKeyDown=function(d){if(d.which===K.Z&&this._oTimePeriodZoomHandler.isTimePeriodZoomEnabled()){this._oTimePeriodZoomHandler.invertActiveStatus();}};t.prototype._preventBubbleAndDefault=function(d){d.preventDefault();d.stopPropagation();};t.prototype._prepareSelection=function(d){if(!D.support.touch&&d.button!==0){return false;}if(!this._bDragging&&!this._oShapeResizeHandler.getIsResizing()){this._setEventStatus("mouseDown");}};t.prototype._prepareDragging=function(d){if(d.button==0){if(this._oTimePeriodZoomHandler&&this._oTimePeriodZoomHandler.isActive()){this._oTimePeriodZoomHandler.handleDragStart(d);this._preventBubbleAndDefault(d);}else{var i=d3.select(d.target).data()[0];var j,k;if(d.target.getAttribute("class")){j=d.target.getAttribute("class").split(" ")[0];k=d3.select(d.target).classed("sapUiShapeResizingCursor");}if(!k&&j&&i&&this.isShapeSelectable(i,j)){if(this._bMouseDown){this._handleShapeDragStart(d);}this._preventBubbleAndDefault(d);}}}};t.prototype.syncTimePeriodZoomStatus=function(d){if(d){this._oTimePeriodZoomHandler.activate(true);}else{this._oTimePeriodZoomHandler.deactivate(true);}};t.prototype.syncTimePeriodZoomOperation=function(d,i,O){this._oTimePeriodZoomHandler.syncTimePeriodZoomOperation(d,i,O);};t.prototype._handleRightClick=function(d){var i=this._composeParameterForClickPosition(d);this.fireChartRightClick({objectInfo:i?i.rowInfo:undefined,leadingRowInfo:i?i.leadingRowInfo:undefined,timestamp:i?i.startTime.getTime():undefined,svgId:this.getId()+"-svg",svgCoordinate:i?i.svgPoint:undefined,effectingMode:this.getMode(),originEvent:d});};t.prototype._handleClick=function(d){var i=this._composeParameterForClickPosition(d);this.fireChartClick({objectInfo:i?i.rowInfo:undefined,leadingRowInfo:i?i.leadingRowInfo:undefined,timestamp:i?i.startTime.getTime():undefined,svgId:this.getId()+"-svg",svgCoordinate:i?i.svgPoint:undefined,effectingMode:this.getMode(),originEvent:d});};t.prototype._drawCursorLine=function(d){if(this.getEnableCursorLine()){var i=q(this.getDomSelectorById("svg"));var j=this._getSvgCoodinateByDiv(i[0],this._getMouseXPos(d),d.pageY||d.clientY);this._oCursorLineDrawer.drawSvg(d3.selectAll(".sapGanttChartSvg"),d3.selectAll(".sapGanttChartHeaderSvg"),this.getLocale(),j);}};t.prototype._destroyCursorLine=function(){if(this.getEnableCursorLine()){this._oCursorLineDrawer.destroySvg(d3.selectAll(".sapGanttChartSvg"),d3.selectAll(".sapGanttChartHeaderSvg"));}};t.prototype._handleHover=function(d){var i=this._composeParameterForClickPosition(d);var R=i?i.leadingRowNum-this._oTT.getFirstVisibleRow():-1;R=R<0?-1:R;var j=i?i.isExpandedRow:false;var k=d3.select(d.target).data()[0];if(k){var l=this._getMouseXPos(d)-q(this.getDomSelectorById("svg")).offset().left||d.offsetX;this._oShapeResizeHandler.checkShapeResizable(k,d.target,i.svgPoint?i.svgPoint.x:l);}this._oShapeHoverHandler.handleShapeHover(k,d);if(R>-1&&((k!==undefined&&k.uid!==this._lastHoverShapeUid)||(k===undefined&&this._lastHoverShapeUid!==undefined)||R!==this._lastHoverRowIndex)){this.fireChartMouseOver({objectInfo:i?i.rowInfo:undefined,leadingRowInfo:i?i.leadingRowInfo:undefined,timestamp:i?i.startTime.getTime():undefined,svgId:this.getId()+"-svg",svgCoordinate:i?i.svgPoint:undefined,effectingMode:this.getMode(),originEvent:d});if(k!==undefined){this._lastHoverShapeUid=k.uid;}else{this._lastHoverShapeUid=undefined;}}if(R>-1&&R!==this._lastHoverRowIndex){var u=this._oTT;var H=u.getRows()[R];if(H){u.$().find(".sapUiTableRowHvr").trigger("mouseout");if(!j){H.$().trigger("mouseover");}}}if(R!==this._lastHoverRowIndex){this._lastHoverRowIndex=R;}};t.prototype._handleDragLeave=function(d){this._oDraggingData.targetSvgId=undefined;this._setEventStatus("dragLeave");this.fireChartDragLeave({originEvent:d,draggingSource:this._oDraggingData,timePopoverData:this._oTimePopoverHandler.getCurrentPopoverData()});};t.prototype._handleHoverLeave=function(){var d=this._oTT;d.$().find(".sapUiTableRowHvr").trigger("mouseleave");this._lastHoverShapeUid=undefined;this._lastHoverRowIndex=-1;};t.prototype._handleSelectionChange=function(d){var i=d3.select(d.target).datum();var j;if(d.target.getAttribute("class")){j=d.target.getAttribute("class").split(" ")[0];}var k={};if(i!==undefined&&this.isShapeSelectable(i,j)){var l=d.ctrlKey||(D.os.name===sap.ui.Device.os.OS.MACINTOSH&&d.metaKey);k=this._selectionChange(i,l,d.shiftKey,d);}else{if(!(this.getParent()instanceof sap.gantt.GanttChartWithTable)||(this.getParent().getTableProperties().selectionBehavior!==sap.ui.table.SelectionBehavior.RowSelector)){var u=this._composeParameterForClickPosition(d);if(u&&!u.isExpandedRow){this._syncTTSelection(d);}else{return null;}}if(this.getShapeSelectionMode()!==sap.gantt.SelectionMode.MultiWithKeyboard){k.shapeSelectionChange=this._oShapeSelection.clearShapeSelection();k.relationshipSelectionChange=this._oShapeSelection.clearRelationshipSelection();}}if(k.shapeSelectionChange||k.relationshipSelectionChange){this._drawSelectedShapes();}this._setEventStatus("mouseUp");if(k.shapeSelectionChange){this.fireShapeSelectionChange({originEvent:d});}if(k.relationshipSelectionChange){this.fireRelationshipSelectionChange({originEvent:d});}this._handleClick(d);};t.prototype._bindScrollLogicForTT=function(){this._bindHorizontalScroll();this._bindVerticalScroll();};t.prototype._bindHorizontalScroll=function(){this._updateScrollLeft();var $=q(this.getTTHsbDom());$.unbind("scroll.sapUiTableHScroll");$.unbind("scroll.sapUiTableHScrollForGanttChart",this._onHSbScroll);$.bind("scroll.sapUiTableHScrollForGanttChart",q.proxy(this._onHSbScroll,this));};t.prototype._bindVerticalScroll=function(){var $=q(this.getTTVsbDom());$.unbind("scroll.sapUiTableVScrollForGanttChart",this._onVSbScroll);$.bind("scroll.sapUiTableVScrollForGanttChart",q.proxy(this._onVSbScroll,this));};t.prototype._getSvgHeight=function(){return this._oTT.$().find(".sapUiTableCCnt").height();};t.prototype._getRowHeights=function(){return this._aHeights;};t.prototype.setBaseRowHeight=function(d){this.setProperty("baseRowHeight",d,true);this._oTT.setRowHeight(d);return this;};t.prototype._setInferedBaseRowHeight=function(d){this._iInferedBaseRowHeight=d;};t.prototype.getBaseRowHeight=function(){return this._iInferedBaseRowHeight?this._iInferedBaseRowHeight:this._iInferedBaseRowHeightOnTT;};t.prototype._initialSvgDrawing=function(){if(this.getBaseRowHeight()&&this._iSvgHeight!=this._getSvgHeight()){this._iSvgHeight=this._getSvgHeight();this._bTableReady=true;this._onTTRowUpdate();}};t.prototype._onHSbScroll=function(d){if(this._initHorizonApplied){var i=this._getHSBScrollLeft();if(!this._bSuppressSetVisibleHorizon){var j=this._getScrollRateByScrollLeft(i);var k=this._getVisibleHorizonByScrollRate(j);this._updateVisibleHorizon(k,"horizontalScroll");}this._bSuppressSetVisibleHorizon=false;var l=this.getAxisTimeStrategy();var v=l.getVisibleHorizon();var u=this.getVisibleWidth();this.fireHorizontalScroll({scrollSteps:i,startTime:v.getStartTime(),endTime:v.getEndTime(),visibleWidth:u});this._drawHeader();}};t.prototype._getScrollRateByScrollLeft=function(i){var H=this._oTT.$(sap.ui.table.SharedDomRef.HorizontalScrollBar+"-content");var d=H.width();var j=this.getVisibleWidth();var k=0;if(d!==j){if(C.getConfiguration().getRTL()===true&&(D.browser.msie||D.browser.edge)){k=(d-i-j)/(d-j);}else if(C.getConfiguration().getRTL()===true&&D.browser.safari){k=(d+i-j)/(d-j);}else{k=i/(d-j);}k=k<0?0:k;k=k>1?1:k;}return k;};t.prototype._getScrollRateByHorizon=function(d){var i=0;var j=this._nUpperRange-this._nLowerRange;var k=this.getVisibleWidth();if(this._initHorizonApplied&&j!==k){var l;if(C.getConfiguration().getRTL()){l=this.getAxisTime().timeToView(F.abapTimestampToDate(d.getEndTime()),true);i=l/(j-k);}else{l=this.getAxisTime().timeToView(F.abapTimestampToDate(d.getStartTime()),true);i=l/(j-k);}i=i<0?0:i;i=i>1?1:i;}return i;};t.prototype._getHSBScrollLeftByScrollRate=function(d){var H=this._oTT.$(sap.ui.table.SharedDomRef.HorizontalScrollBar+"-content");var i=H.width();var j=this.getVisibleWidth();var k=d*(i-j);if(C.getConfiguration().getRTL()&&(D.browser.msie||D.browser.edge)){k=i-j-k;}else if(C.getConfiguration().getRTL()&&D.browser.safari){k=0-(i-j-k);}return k;};t.prototype._getContentScrollLeftByScrollRate=function(d){var i=this._nUpperRange-this._nLowerRange;var j=this.getVisibleWidth();var k=d*(i-j);return k;};t.prototype._getVisibleHorizonByScrollRate=function(d){var i=this._getContentScrollLeftByScrollRate(d);var j=this.getAxisTimeStrategy().getTotalHorizon();var v;var k={};var R=C.getConfiguration().getRTL();if(d===0){k.startTime=R?undefined:j.getStartTime();k.endTime=R?j.getEndTime():undefined;}else if(d===1){k.startTime=R?j.getStartTime():undefined;k.endTime=R?undefined:j.getEndTime();}else{var l=this.getAxisTime().viewToTime(i,true);k.startTime=R?undefined:l;k.endTime=R?l:undefined;}v=new m(k);return v;};t.prototype.syncVisibleHorizon=function(d,v,k){var i=this.getAxisTimeStrategy();var j=i.getTotalHorizon();var l;if(v!==undefined){var u=this.getVisibleWidth();if(k){var w=i.getVisibleHorizon();var x=F.abapTimestampToDate(w.getStartTime());l=U.calculateHorizonByWidth(d,v,u,x);}else{l=U.calculateHorizonByWidth(d,v,u);}}else{l=d;}if(j.getEndTime()<l.getEndTime()){var y=F.abapTimestampToDate(l.getEndTime()).getTime()-F.abapTimestampToDate(l.getStartTime()).getTime();var z=F.abapTimestampToDate(j.getEndTime());var H=new Date();H.setTime(z.getTime()-y);l=new m({startTime:H,endTime:z});}this._updateVisibleHorizon(l,"syncVisibleHorizon");};t.prototype._onVSbScroll=function(){if(!this._mTimeouts._drawSvg){this.$().find(".sapGanttChartSvg").css("transform","translateY("+(-this._oTT.$().find(".sapUiTableCCnt").scrollTop())+"px)");}this.fireVerticalScroll({scrollSteps:this._oTT.getFirstVisibleRow(),scrollPosition:q(this.getTTVsbDom()).scrollTop()});};t.prototype._hSbScrollLeft=function(d){var $=q(this.getDomSelectorById("svg-ctn"));var i=q(this.getDomSelectorById("header"));var j;if(C.getConfiguration().getRTL()===true){if(!D.browser.safari){j=this._oStatusSet.aViewBoundary[1]-i.width()-d;if(j<0){j=0;}}else{j=0-d;}}else{j=d;}if(C.getConfiguration().getRTL()===true&&D.browser.firefox){if(Math.abs($.scrollLeftRTL()-j)>1){$.scrollLeftRTL(j);}if(Math.abs(i.scrollLeftRTL()-j)>1){i.scrollLeftRTL(j);}}else{if(Math.abs($.scrollLeft()-j)>1){$.scrollLeft(j);}if(Math.abs(i.scrollLeft()-j)>1){i.scrollLeft(j);}}};t.prototype._doBirdEye=function(d){this._oBirdEyeHandler.doBirdEye(d);};t.prototype.getLargestHorizonByDataRange=function(d,R,i){var j=this._oShapeManager.getAllShapeInstances();var k=[];if(j&&j.length>0){if(d===sap.gantt.config.BirdEyeRange.AllRows){k=k.concat(this.getAllRowData());}else if(d===sap.gantt.config.BirdEyeRange.VisibleRows){k=k.concat(this._aFilteredRowData);}else if(!d&&R>=0&&this._aFilteredRowData.length>R){k=k.concat(this._aFilteredRowData[R]);}this._oShapeManager.collectDataForAllShapeInstances(k,this._oObjectTypesConfigMap,this._oChartSchemesConfigMap);}return this._oBirdEyeHandler.calculateLargestVisibleHorizon(j,i);};t.prototype.doBirdEyeOnRow=function(R){var i=this._getTTFirstRenderingRowIndex();R=R-i;this._oBirdEyeHandler.doBirdEye(null,R);};t.prototype.jumpToPosition=function(v){if(v instanceof Date){this._updateVisibleHorizon(new m({startTime:v}),"jumpToPosition");}else if(v instanceof Array){this._updateVisibleHorizon(new m({startTime:v[0],endTime:v[1]}),"jumpToPosition");}else if(v===undefined){this._updateVisibleHorizon(this.getAxisTimeStrategy().getTotalHorizon(),"jumpToPosition");}};t.prototype._updateVisibleHorizon=function(d,R){var i=this.getAxisTimeStrategy();var j=this.getVisibleWidth();i.updateGanttVisibleWidth(j);i.setVisibleHorizonWithReason(d,R);};t.prototype._onTTRowUpdate=function(){if(this._bTableReady){this._syncSvgHeightWithTT();this._syncSvgDataWithTT();this._draw(true);}};t.prototype._syncSvgHeightWithTT=function(){var $=this.$().find(".sapGanttChartSvgCtn");$.height(this._getSvgHeight());var d=this.$().find(".sapGanttChartSvg");d.height(q(this._oTT.$().find(".sapUiTableCtrlRowScroll:not(.sapUiTableCHT)")).height());};t.prototype._syncSvgDataWithTT=function(){var d=this._oTT.getBinding("rows");if(!d){return false;}var i=this._getTTFirstRenderingRowIndex();var v=this._getVisibleRowCount();this._aFilteredRowData=[];this._aNonVisibleShapeData=[];var _=[];var j=[];var k=[i,i+v-1];var I=this._aRelationshipsContexts&&this._aRelationshipsContexts.length>0;if(I){d.getContexts(0,0);if(i>0){_=this._getDrawingData([0,i-1]);}j=this._getDrawingData([i+v,d.getLength()-1]);d.getContexts(k[0],k[1]);}this._aFilteredRowData=this._getDrawingData(k);this._aNonVisibleShapeData=_.concat(j);var l=this.getBaseRowHeight();if(!l){l=0;}this._oAxisOrdinal=this._createAxisOrdinal(this._aFilteredRowData,l,0);this._cacheObjectPosition(this._aFilteredRowData,this._oAxisOrdinal);this._cacheObjectPosition(_,this._oAxisOrdinal,true);this._cacheObjectPosition(j,this._oAxisOrdinal,false);if(!this._aVisibleRange||this._aVisibleRange[0]!==k[0]||this._aVisibleRange[1]!==k[1]){this._aVisibleRange=k;return true;}return false;};t.prototype._cacheObjectPosition=function(d,l,u){if(d&&d.length>0){if(u===true){for(var i=0;i<d.length;i++){d[i].y=-100;d[i].rowHeight=l.getViewBandWidth();}}else if(u===false){for(var j=0;j<d.length;j++){d[j].y=l.getViewRange()[1]+100;d[j].rowHeight=l.getViewBandWidth();}}else{var v=[];var w=[];for(var k=0;k<d.length;k++){d[k].y=l.elementToView(d[k].uid);if(k>0){d[k-1].rowHeight=d[k].y-d[k-1].y;}if(d[k].visibleRowSpan){d[k].visibleRowHeight=d[k].visibleRowSpan*l.getViewBandWidth();v.push(d[k].uid);w.push(d[k].visibleRowSpan);}}d[d.length-1].rowHeight=l.getViewRange()[1]-d[d.length-1].y;this._oAxisOrdinalOfVisibleRow=new e(v,w,this.getBaseRowHeight(),0);}}};t.prototype._prepareRelationshipDataFromModel=function(){this._aRelationships=[];if(this._aRelationshipsContexts){for(var i=0;i<this._aRelationshipsContexts.length;i++){var R=this._aRelationshipsContexts[i].getObject();if(R!==undefined){this._aRelationships.push(R);}}}U.generateUidForRelationship(this._aRelationships,this.getRlsIdName());};t.prototype._createAxisOrdinal=function(d,i,j){var R=d.map(function(l){return l.uid;});var k=d.map(function(l){if(l.rowSpan){return l.rowSpan;}else{return 1;}});return new e(R,k,i,j);};t.prototype.getFilteredRowData=function(R){return this._aFilteredRowData;};t.prototype._getDrawingData=function(R,d){var u=function(h1,j1,l1,m1){if(!h1[j1]){h1.push({});}if(!h1[j1][l1]){h1[j1][l1]=[];}h1[j1][l1].push(m1);};var i,j,k,l,v,w;var x=this.getRowIdName();var y=this.getRowTypeName();var z=this._oTT.getBinding("rows");var H=this._oTT.getBindingInfo("rows");var I=[];var J=[],O;if(d){J=d;}else{for(i=R[0];i<=R[1];i++){J.push(i);}}O=J.length;if(z!==undefined){var Q=z.getModel();var W=this.getShapeDataNames();for(i=0;i<O;i++){var X=this._oTT.getContextByIndex(J[i]);if(!X){continue;}else{v=X.getObject();if(!v){continue;}}var Y=1;w=this._oObjectTypesConfigMap[v[y]]?this._oObjectTypesConfigMap[v[y]].getMainChartSchemeKey():sap.gantt.config.DEFAULT_CHART_SCHEME_KEY;if(v[y]){var Z=this._oChartSchemesConfigMap[w];if(Z){Y=Z.getRowSpan();}}var $={"bindingObj":z,"bindingInfo":H,"contextObj":X,"data":v,"id":v[x],"type":v[y],"rowSpan":Y,"chartScheme":w,"rowIndex":J[i],"index":0,"visibleRowSpan":Y};I.push($);if(!this._bJSONTreeBinding){if(W&&W.length>0){for(j=0;j<W.length;j++){var _;if(typeof W[j]==="string"){_=W[j];}else{_=W[j].name;}var a1=X.getProperty(_);var b1;if(a1){$.data[_]=[];for(k=0;k<a1.length;k++){var c1=a1[k];if(typeof c1==="string"){b1=Q.getData("/"+c1);}else{b1=c1;}$.data[_].push(b1);}}}}}U.generateRowUid([$],this._oObjectTypesConfigMap,W,undefined,x);var d1=v.uid;if(d1&&this._oRowStatusMap[d1]){for(w in this._oRowStatusMap[d1]){var e1;if(this._oChartSchemesConfigMap[w]&&this._oChartSchemesConfigMap[w].getModeKey()&&this._oChartSchemesConfigMap[w].getModeKey()!==sap.gantt.config.DEFAULT_MODE_KEY){e1=this._oChartSchemesConfigMap[w].getModeKey();}else{e1=this.getMode();}var f1=this._collectDataNameForValidChartScheme(w,e1);if(f1&&f1.drawData){var g1=0;var h1=[{}];for(j=0;j<f1.drawData.length;j++){if(!v[f1.drawData[j]]){continue;}for(k=0;k<v[f1.drawData[j]].length;k++){var i1=v[f1.drawData[j]][k][f1.rowIndexName];if(i1&&g1<i1){g1=i1;}}}if(g1>0){for(j=0;j<f1.drawData.length;j++){if(!v[f1.drawData[j]]){continue;}for(k=0;k<v[f1.drawData[j]].length;k++){var j1=v[f1.drawData[j]][k][f1.rowIndexName];if(j1){u(h1,j1,f1.drawData[j],v[f1.drawData[j]][k]);}else{for(l=1;l<=g1;l++){u(h1,l,f1.drawData[j],v[f1.drawData[j]][k]);}}}}for(j=1;j<=g1;j++){var k1={"bindingObj":z,"bindingInfo":H,"data":h1[j],"id":v[x],"type":v[y],"parentId":$.id,"rowSpan":f1.rowSpan,"chartScheme":w,"rowIndex":J[i],"index":j,"icon":this._oChartSchemesConfigMap[w].getIcon(),"closeIcon":"./image/closeChart.png","name":this._oChartSchemesConfigMap[w].getName()};U.generateRowUid([k1],this._oObjectTypesConfigMap,W,undefined,x);I.push(k1);$.visibleRowSpan+=f1.rowSpan;}}}}this._oRowStatusMap[d1].visibleRowSpan=$.visibleRowSpan;}}}return I;};t.prototype._prepareVerticalDrawingRange=function(){var d=this._oTT.getBinding("rows").getLength()-1;if(d<0){return[0,-1];}var i=this._getTTFirstRenderingRowIndex();var j=i+this._getVisibleRowCount()-1;var k=i;var l=j<d?j:d;return[k,l];};t.prototype._prepareHorizontalDrawingRange=function(){var d=this._nUpperRange-this._nLowerRange;var i=this.getVisibleWidth();if(!this._oStatusSet){this._updateScrollWidth();}var j=this._getContentScrollLeft();if(this._oStatusSet){if((i>=d||(this._oStatusSet.aViewBoundary[0]<=j-this._oStatusSet.nOffset&&this._oStatusSet.aViewBoundary[1]>=j+i-this._oStatusSet.nOffset))){if(!this._mTimeouts._drawSvg){this._updateScrollLeft();this._scrollSvg();}return false;}}var k=i*(1+this._fExtendFactor*2);var l=j-i*this._fExtendFactor;if(l<this._nLowerRange){k+=l;l=0;}if(l+k>this._nUpperRange){k=this._nUpperRange-l;}this.getAxisTime().setViewOffset(l);if(k<0){return false;}this._oStatusSet={nWidth:k,nOffset:l,nScrollLeft:j,aViewBoundary:[0,k],aTimeBoundary:[this.getAxisTime().viewToTime(0),this.getAxisTime().viewToTime(k)],bRTL:C.getConfiguration().getRTL()};return true;};t.prototype._draw=function(d){if(!this._bTableReady){return;}this._ensureShapesCreated(function(){var i=this._nUpperRange-this._nLowerRange;if(i<=2){return;}var j=this.getVisibleWidth();if(!j||j<=0||j>document.body.clientWidth){return;}var k=this.getAxisTimeStrategy().syncContext(j);this.fireEvent("_zoomInfoUpdated",k);if(k.axisTimeChanged){this.setProperty("timeZoomRate",this.getAxisTime().getZoomRate(),true);this.resetWidthInfo();}if(!this._prepareHorizontalDrawingRange()&&!d){return;}this._updateTableRowHeights();var l=this;this._mTimeouts._drawSvg=this._mTimeouts._drawSvg||window.setTimeout(function(){l._drawSvg();},0);}.bind(this));};t.prototype.getVisibleWidth=function(){var $=q(this.getDomSelectorById("svg-ctn"));if(!$){return null;}var d=this.getTTVsbDom()!=null?this.getTTVsbDom().getBoundingClientRect().width:0;var i=$.width()-(C.getConfiguration().getRTL()?0:d);if(!i||i<=0){return null;}return i;};t.prototype._updateScrollWidth=function(){var d=this._nUpperRange-this._nLowerRange;this._oColumn.setWidth((d-4)+"px");};t.prototype._updateScrollLeft=function(u){var $=q(this.getTTHsbDom());var d=this._calHSBScrollLeft();var i=this._getHSBScrollLeft($);if(Math.abs(i-d)>1){this._bSuppressSetVisibleHorizon=!u;if((C.getConfiguration().getRTL()===true&&D.browser.firefox)){$.scrollLeftRTL(d);}else{$.scrollLeft(d);}}else if(this._forceHsbScrollSync(i,d)){this._bSuppressSetVisibleHorizon=!u;this._onHSbScroll();}};t.prototype._forceHsbScrollSync=function(d,i){if(this._oLastVisibleHorizon){var v=this.getAxisTimeStrategy().getVisibleHorizon();if(v&&(this._oLastVisibleHorizon.getStartTime()!=v.getStartTime()||this._oLastVisibleHorizon.getEndTime()!=v.getEndTime())){this._oLastVisibleHorizon=v;return true;}}return false;};t.prototype._calHSBScrollLeft=function(){var d=this.getAxisTimeStrategy().getVisibleHorizon();var i=this._getScrollRateByHorizon(d);var j=this._getHSBScrollLeftByScrollRate(i);return j;};t.prototype._getHSBScrollLeft=function($){if(!$){$=q(this.getTTHsbDom());}return(C.getConfiguration().getRTL()===true&&D.browser.firefox)?$.scrollLeftRTL():$.scrollLeft();};t.prototype._scrollSvg=function(){var $=q(this.getDomSelectorById("svg"));var d=q(this.getDomSelectorById("header-svg"));if(Math.abs(this._oStatusSet.nWidth-$.width())>1){$.width(this._oStatusSet.nWidth+((C.getConfiguration().getRTL())?0:q(this.getTTVsbDom()).width()));}if(Math.abs(this._oStatusSet.nWidth-d.width())>1){d.width(this._oStatusSet.nWidth+((C.getConfiguration().getRTL())?0:q(this.getTTVsbDom()).width()));}var i=this.getVisibleWidth();var j=this._getContentScrollLeft();if(C.getConfiguration().getRTL()===true&&!(D.browser.msie||D.browser.edge)){this._hSbScrollLeft(this._oStatusSet.nOffset-j+this._oStatusSet.nWidth-i);}else{this._hSbScrollLeft(j-this._oStatusSet.nOffset);}};t.prototype._getContentScrollLeft=function(){var d=this.getAxisTimeStrategy().getVisibleHorizon();var i=this._getScrollRateByHorizon(d);var j=this._getContentScrollLeftByScrollRate(i);return j;};t.prototype._drawSvg=function(){M.start("GanttChart _drawSvg","GanttPerf:GanttChart _drawSvg function");if(!this._initHorizonApplied){this._prepareHorizontalDrawingRange();this._initHorizonApplied=true;this._updateScrollLeft(true);}else{this._updateScrollLeft();}q(this.getDomSelectorById("svg-ctn")).css("visibility","hidden");this._scrollSvg();q(this.getDomSelectorById("svg-ctn")).css("visibility","visible");this._sUiSizeMode=U.findSapUiSizeClass();this._drawCalendarPattern();this._drawHeader();this._drawNowLine();this._drawVerticalLine();this._drawExpandedBackground();this._drawShapes();this._drawSelectedShapes();this._drawAdhocLine();delete this._mTimeouts._drawSvg;this.$().find(".sapGanttChartSvg").css("transform","translateY("+(-this._oTT.$().find(".sapUiTableCCnt").scrollTop())+"px)");this.fireEvent("_shapesUpdated",{aSvg:q(this.getDomSelectorById("svg"))});M.end("GanttChart _drawSvg");};t.prototype._drawHeader=function(){var $=q(this.getDomRef()).find(".sapGanttChartHeader");var j=$.height();var H=d3.select(q(this.getDomRef()).find(".sapGanttChartHeaderSvg").get(0));H.attr("height",j);var k=j/5*2;var l=j/5*4;var u=j/5*4;var v=this.getAxisTimeStrategy();var w=window.screen.width;var x=this.getAxisTime().getTickTimeIntervalLabel(v.getTimeLineOption(),null,[0,this._oStatusSet.nWidth>=w?this._oStatusSet.nWidth:w]);H.selectAll("g").remove();var y=H.append("g");y.selectAll("label0").data(x[0]).enter().append("text").classed("sapGanttTimeHeaderSvgText0",true).text(function(d){return d.label;}).attr("x",this._getXwithOffset).attr("y",function(d){return k;}).attr("text-anchor","start");y.selectAll("label1").data(x[1]).enter().append("text").classed("sapGanttTimeHeaderSvgText1",true).text(function(d){return d.label;}).attr("x",this._getXwithOffset).attr("y",function(d){return u;});d3.selectAll(".sapGanttChartHeader .sapGanttTimeHeaderSvgText1").each(function(d,i){d3.select(this).append("title").text(function(d){if(d!=null){return d.largeLabel;}});});if((D.browser.msie||D.browser.edge)&&C.getConfiguration().getRTL()){d3.selectAll(".sapGanttChartHeader .sapGanttTimeHeaderSvgText0").each(function(d,i){d3.select(this).attr("transform",function(d){var Q="translate("+(-U.calculateStringLength(d.label)*parseInt(q(".sapGanttTimeHeaderSvgText0").css("font-size"),10)/2)+")";return Q;});});d3.selectAll(".sapGanttChartHeader .sapGanttTimeHeaderSvgText1").each(function(d,i){d3.select(this).attr("transform",function(d){var Q="translate("+(-U.calculateStringLength(d.label)*parseInt(q(".sapGanttTimeHeaderSvgText1").css("font-size"),10)/2)+")";return Q;});});}var z,i;var I="";for(i=0;i<x[1].length;i++){z=x[1][i];if(z){I+=" M"+" "+(z.value-1/2)+" "+l+" L"+" "+(z.value-1/2)+" "+j;}}var J=this.getAxisTime();if(J.largeIntervalLabel&&!J.largeIntervalPath){for(i=0;i<x[0].length;i++){if(x[0][i].value===J.firstTickPosition){x[0].splice(i,1);break;}}}var O="";for(i=0;i<x[0].length;i++){z=x[0][i];if(z){O+=" M"+" "+(z.value-1/2)+" 0"+" L"+" "+(z.value-1/2)+" "+j/2;}}y.append("path").classed("sapGanttTimeHeaderSvgPath",true).attr("d",I);y.append("path").classed("sapGanttTimeHeaderLargeIntervalSvgPath",true).attr("d",O);};t.prototype._getXwithOffset=function(d){var O=5;if(C.getConfiguration().getRTL()){return d.value-O;}else{return d.value+O;}};t.prototype._drawCalendarPattern=function(){var $=d3.select(this.getDomSelectorById("svg"));this._oCalendarPatternDrawer.drawSvg($,this.getId(),this.getCalendarDef(),this._oStatusSet,this.getBaseRowHeight());};t.prototype._drawNowLine=function(){this._oNowlineDrawer=new N(this.getAxisTime());var $=d3.select(this.getDomSelectorById("header-svg")),d=d3.select(this.getDomSelectorById("svg"));if(this.getEnableNowLine()){this._oNowlineDrawer.drawSvg(d,$,this.getNowLineInUTC());}else{this._oNowlineDrawer.destroySvg(d,$);}};t.prototype._drawVerticalLine=function(){this._oVerticalLineDrawer=new V(this.getAxisTime());var $=d3.select(this.getDomSelectorById("svg"));if(this.getEnableVerticalLine()){this._oVerticalLineDrawer.drawSvg($);}else{this._oVerticalLineDrawer.destroySvg($);}};t.prototype._drawAdhocLine=function(){this._oAdhocLineDrawer=new A(this.getAxisTime());var $=d3.select(this.getDomSelectorById("svg"));if(this.getEnableAdhocLine()){this._oAdhocLineDrawer.drawSvg($,this.getAdhocLines(),this._oStatusSet,this.getAdhocLineLayer());}else{this._oAdhocLineDrawer.destroySvg($);}};t.prototype._drawExpandedBackground=function(){var d=d3.select(this.getDomSelectorById("svg"));if(!this._oTT||!this._oTT.getRows()||this._oTT.getRows().length<=0){return;}if(this._aFilteredRowData){var i=this._composeChartSchemeBackgroundConfig();this._oExpandedBackgroundDrawer.drawSvg(d,this._aFilteredRowData,i);}};t.prototype._composeChartSchemeBackgroundConfig=function(){var d=this._oChartSchemesConfigMap;var i={};if(d){for(var j in d){if(d[j].getHaveBackground()){i[j]=d[j].getBackgroundClass();}}}return i;};t.prototype._drawShapes=function(){var d=d3.select(this.getDomSelectorById("svg"));var j=this._oShapeManager.getAllShapeInstances();var k=this._oShapeManager.mShapeInstance;if(this._aFilteredRowData&&j&&j.length>0){this._oShapeManager.collectDataForAllShapeInstances(this._aFilteredRowData,this._oObjectTypesConfigMap,this._oChartSchemesConfigMap);var l=this.getAxisTime();var u=this._oShapeCrossRowDrawer.generateRelationshipDataSet(d,k,this._aNonVisibleShapeData,this.getShapeDataNames(),this._aRelationships,l,this._oAxisOrdinal);for(var i=0;i<j.length;i++){var v=j[i];switch(v.getCategory(null,l,this._oAxisOrdinal)){case sap.gantt.shape.ShapeCategory.InRowShape:this._oShapeInRowDrawer.drawSvg(d,v,l,this._oAxisOrdinal,this._oStatusSet);break;case sap.gantt.shape.ShapeCategory.Relationship:v.dataSet=this._oShapeManager.isRelationshipDisplayable(v)?u:[];this._oShapeCrossRowDrawer.drawSvg(d,v,l,this._oAxisOrdinal);break;default:break;}}}};t.prototype.getShapeInstance=function(d){this._ensureShapesCreatedSync();return this._oShapeManager.mShapeInstance[d];};t.prototype._drawSelectedShapes=function(){var d=d3.select(this.getDomSelectorById("svg"));var i=this._oShapeManager.mShapeInstance;this._oShapeManager.collectDataForSelectedShapes(this._oShapeSelection,this._oObjectTypesConfigMap,this._oChartSchemesConfigMap);var j=this.getAxisTime();var k=this._oShapeCrossRowDrawer.generateRelationshipDataSet(d,i,this._aNonVisibleShapeData,this.getShapeDataNames(),this._oShapeSelection.getSelectedRelationships(),j,this._oAxisOrdinal);for(var l in i){var u=i[l].getAggregation("selectedShape");var v=u.getCategory(null,this._oAxisTime,this._oAxisOrdinal);switch(v){case sap.gantt.shape.ShapeCategory.InRowShape:this._oShapeInRowDrawer.drawSvg(d,u,j,this._oAxisOrdinal,this._oStatusSet);break;case sap.gantt.shape.ShapeCategory.Relationship:u.dataSet=k;this._oShapeCrossRowDrawer.drawSvg(d,u,j,this._oAxisOrdinal);break;default:break;}}};t.prototype._getSvgCoodinateByDiv=function(d,x,y){var i=d.createSVGPoint();i.x=x;i.y=y;i=i.matrixTransform(d.getScreenCTM().inverse());i.svgHeight=d.height.baseVal.value;i.svgId=this.getId()+"-svg";return i;};t.prototype.isShapeSelectable=function(d,i){return this._oShapeManager.isShapeSelectable(d,i);};t.prototype.getAxisOrdinal=function(){return this._oAxisOrdinal;};t.prototype._ensureAxisTimeCreated=function(){var d=this.getAxisTimeStrategy().getAxisTime();if(!d){this._createAxisTime(this.getAxisTimeStrategy());d=this.getAxisTimeStrategy().getAxisTime();}};t.prototype._ensureShapesCreatedSync=function(){this._ensureAxisTimeCreated();if(!this._shapesInited){var d=this.getProperty("shapes");if(d&&d.length>0){this._oShapeManager.instantiateShapesSync(d);}this._shapesInited=true;}};t.prototype._ensureShapesCreated=function(d){d=d||function(){};this._ensureAxisTimeCreated();if(!this._shapesInited){var i=this.getProperty("shapes");if(i&&i.length>0){try{this._oShapeManager.instantiateShapesSync(i);this._shapesInited=true;d();}catch(j){this._oShapeManager.instantiateShapes(i).then(function(){this._shapesInited=true;d();}.bind(this)).catch(function(){});}}else{this._shapesInited=true;d();}}else{d();}};t.prototype.getAxisTime=function(){this._ensureAxisTimeCreated();var d=this.getAxisTimeStrategy().getAxisTime();return d;};t.prototype.ondblclick=function(d){return null;};t.prototype.onclick=function(d){return null;};t.prototype.getSapUiSizeClass=function(){return this._sUiSizeMode;};t.prototype.setFirstVisibleRow=function(R){this.setTableProperties({firstVisableRow:R});return this;};t.prototype._getVisibleRowCount=function(){return this._oTT.getVisibleRowCount()+1;};t.prototype._setLargeDataScrolling=function(l){if(this._oTT._setLargeDataScrolling){this._oTT._setLargeDataScrolling(!!l);}};t.prototype.exit=function(){this._oShapeManager.destroy();this._detachEvents();this._cleanUpTimers();};t.prototype._cleanUpTimers=function(){for(var k in this._mTimeouts){if(this._mTimeouts[k]){clearTimeout(this._mTimeouts[k]);this._mTimeouts[k]=undefined;}}};t.prototype.getTTHsbDom=function(){return this._oTT.getDomRef(sap.ui.table.SharedDomRef.HorizontalScrollBar);};t.prototype.getTTVsbDom=function(){return this._oTT.getDomRef(sap.ui.table.SharedDomRef.VerticalScrollBar);};t.prototype._getTTFirstRenderingRowIndex=function(){if(this._oTT.getRows().length>0){return this._oTT.getRows()[0].getIndex();}return this._oTT.getFirstVisibleRow();};t.prototype._getMouseXPos=function(d){if(D.browser.edge){return d.clientX;}return d.pageX;};t.prototype._getOuterHTML=function(d){if(D.browser.msie){return q('<div>').append(d).html();}return d.prop("outerHTML");};return t;},true);
