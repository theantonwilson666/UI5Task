/*!
 * SAPUI5

(c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(['sap/viz/library','sap/ui/core/theming/Parameters','sap/viz/ui5/theming/Util','sap/viz/ui5/utils/CommonUtil','./ResponsiveLegend','./common/BaseControl','./common/feeds/AnalysisObject','./common/feeds/FeedItem','./common/feeds/FeedHelper','./common/helpers/RuntimeOptionsHelper','./common/helpers/DefaultPropertiesHelper','./common/utils/Constants','./common/utils/SelectionDetailUtil','sap/ui/Device',"sap/ui/thirdparty/jquery","./VizFrameRenderer"],function(l,P,U,C,R,B,A,F,a,b,D,c,S,d,q){"use strict";var f=sap.viz.vizservices.__internal__.BindingService;var g=sap.viz.vizservices.__internal__.PropertyService;for(var h=0;h<c.CORE_CHART_TYPES.length;h++){var j=c.CORE_CHART_TYPES[h];g.getPropertiesDef(j);}var V=B.extend("sap.viz.ui5.controls.VizFrame",{metadata:{library:"sap.viz",properties:{vizType:{type:"string",group:"Misc",defaultValue:"column"},vizProperties:{type:"object",group:"Misc",defaultValue:null},vizScales:{type:"object",group:"Misc",defaultValue:null},vizCustomizations:{type:"object",group:"Misc",defaultValue:null},legendVisible:{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{dataset:{type:"sap.viz.ui5.data.Dataset",multiple:false},feeds:{type:"sap.viz.ui5.controls.common.feeds.FeedItem",multiple:true,singularName:"feed"}},events:{renderComplete:{},selectData:{},deselectData:{}}}});V.prototype.init=function(){sap.viz.ui5.controls.common.BaseControl.prototype.init.apply(this,arguments);this._wrapApi('setModel',function(){this._invalidateDataset=true;}.bind(this));this._wrapApi('setDataset',function(){this._invalidateDataset=true;}.bind(this));this._wrapApi('destroyDataset',function(){this._invalidateDataset=true;}.bind(this));this._wrapApi('addFeed',function(){this._invalidateFeeds=true;}.bind(this));this._wrapApi('removeFeed',function(){this._invalidateFeeds=true;}.bind(this));this._wrapApi('destroyFeeds',function(){this._invalidateFeeds=true;}.bind(this));this._vizFrame=null;this._currentTheme=null;this._connectPopover=null;this._currentTemplate=null;this._errorType=null;this._bulletProperties={plotArea:{}};this._waterfallProperties={plotArea:{}};this._bReadyToRender=true;this._scalesOption=null;this._bSupressInvisibleRender=false;this._clearVariables();this._templateCache={};this._isInitThememChanged=false;this.data("sap-ui-fastnavgroup","true",true);};V.prototype.applySettings=function(){sap.ui.core.Control.prototype.applySettings.apply(this,arguments);};V.prototype.exit=function(){sap.viz.ui5.controls.common.BaseControl.prototype.exit.apply(this,arguments);this._clearVariables();if(this._vizFrame){this._vizFrame.destroy();}this._vizFrame=null;};V.prototype._getDataRange=function(s,e){return(this._vizFrame&&this._vizFrame._getDataRange(s,e))||{displayValues:{start:s,end:e}};};V.prototype._setTitleAria=function(e){if(this._vizFrame$.length){this._vizFrame$.attr("aria-hidden",true);q(this._app$).attr("aria-label",e);}};V.prototype._clearVariables=function(){this._clearRequestedProperties();this._bulletProperties={plotArea:{}};this._waterfallProperties={plotArea:{}};this._cachedDataset=null;this._connectPopover=null;this._templateCache=null;this._bSupressInvisibleRender=false;};V.prototype._clearRequestedProperties=function(){this.setProperty('vizProperties',null);this.setProperty('vizScales',null);this.setProperty('vizCustomizations',null);this._scalesOption=null;};V.prototype.getVizUid=function(){return this.getId();};V.prototype.setUiConfig=function(u){sap.viz.ui5.controls.common.BaseControl.prototype.setUiConfig.apply(this,arguments);return this;};V.prototype.setVizType=function(v){var o=this._getCalculatedType();if(v!==this.getVizType()){this._invalidateVizType=true;}this.setProperty('vizType',v,true);var e=this._getCalculatedType();if(o!==e&&!this._pendingRerendering&&(this._vizFrame||this._errorType)){var u=this._userFeeds||{feeds:this.getFeeds(),vizType:o};if(u.vizType===e){this.destroyFeeds();u.feeds.forEach(function(i){this.addFeed(i);},this);this._userFeeds=null;}else{this._switchFeeds(o,this._getCalculatedType(),u);}}else{this.invalidate();}return this;};V.prototype._switchFeeds=function(e,t,u){var i=F.toLightWeightFmt(this.getFeeds());var o=sap.viz.vizservices.BVRService.switchFeeds(e,i,t).feedItems;var r=a.getFeedDefsMap(t);o.forEach(function(v){if(v.id&&r[v.id]){v.type=r[v.id].type;}});var s=F.fromLightWeightFmt(o);u.feeds.forEach(function(v){this.removeFeed(v,true);},this);this.vizUpdate({feeds:s});this._userFeeds=u;};V.prototype.invalidate=function(o){if(o instanceof sap.viz.ui5.data.Dataset){this._invalidateDataset=true;}if(o instanceof F){this._userFeeds=null;}sap.viz.ui5.controls.common.BaseControl.prototype.invalidate.call(this,o);};V.prototype.getVizProperties=function(){if(this._vizFrame){return this._mergeProperties(this._mergeProperties({},this._vizFrame.properties()||{}),this.getProperty('vizProperties')||{});}else{return this.getProperty('vizProperties');}};V.prototype.getVizScales=function(){if(this._vizFrame){return C.extendScales(this._vizFrame.scales()||[],this.getProperty('vizScales')||[]);}else{return this.getProperty('vizScales');}};V.prototype.zoom=function(e){if(this._vizFrame){this._vizFrame.zoom({target:"plotArea",direction:e.direction});}};V.prototype.setVizProperties=function(v){var t=this._getCalculatedType();if(v&&(t==="info/bullet"||t==="info/vertical_bullet")){b.processBulletProperty(this._bulletProperties,v);}if(v&&(t==="info/timeseries_waterfall")){b.processWaterfallProperty(this._waterfallProperties,v);}var o=sap.viz.api.serialization.migrate({'type':this._getCalculatedType(),'properties':v});if(this._vizFrame&&!this._pendingRerendering){if(this._errorType!==c.ERROR_TYPE.NODATA){this._updateDescription();}try{this._vizFrame.update(o);}catch(e){this._handleErr(e);}}else{this.setProperty('vizProperties',this._mergeProperties(this.getProperty('vizProperties')||{},o.properties||{}));this.setVizScales(o.scales,this._scalesOption);}return this;};V.prototype.setVizScales=function(v,o){if(this._vizFrame&&!this._pendingRerendering){try{if(o){this._vizFrame.scales(v,{level:'user',replace:o.replace});}else{this._vizFrame.scales(v);}}catch(e){this._handleErr(e);}}else{if(o){this._scalesOption={level:'user',replace:o.replace};}if(o&&o.replace){this.setProperty('vizScales',v);}else{this.setProperty('vizScales',C.extendScales(this.getProperty('vizScales')||[],v||[]));}}return this;};V.prototype.getLegendVisible=function(){return this.getVizProperties().legendGroup.computedVisibility;};V.prototype.setLegendVisible=function(v){this.setVizProperties({'legend':{'visible':v},'sizeLegend':{'visible':v}});return this;};V.prototype.vizSelection=function(i,o){if(this._vizFrame){try{var r=this._vizFrame.selection.apply(this._vizFrame,arguments);if(r===this._vizFrame){r=this;}}catch(e){return null;}return r;}else{return null;}};V.prototype.vizUpdate=function(o){if(this._vizFrame||this._errorType){if(o.data||o.feeds){if(o.properties){this.setVizProperties(o.properties);}if(o.scales){this.setVizScales(o.scales);}if(o.customizations){this.setVizCustomizations(o.customizations);}if(o.data){this.setDataset(o.data);}if(o.feeds){this.destroyFeeds();o.feeds.forEach(function(i){this.addFeed(i);}.bind(this));}}else{try{this._vizFrame.update(o);}catch(e){this._handleErr(e);}}}};V.prototype.setVizCustomizations=function(o){if(V._isCustomizationAPISupportedVizType(this._getCalculatedType())){if(this._vizFrame&&!this._pendingRerendering){try{this._vizFrame.customizations(o);}catch(e){this._handleErr(e);}}else{this.setProperty('vizCustomizations',this._mergeProperties(this.getProperty('vizCustomizations')||{},o||{}));}}return this;};V.prototype.getVizCustomizations=function(){if(this._vizFrame){return this._mergeProperties(this._mergeProperties({},this._vizFrame.customizations()||{}),this.getProperty('vizCustomizations')||{});}else{return this.getProperty('vizCustomizations');}};V._isCustomizationAPISupportedVizType=function(v){return Array.prototype.indexOf.call(['info/column','info/dual_column','info/bar','info/dual_bar','info/stacked_bar','info/stacked_column','info/100_stacked_bar','info/100_stacked_column','info/100_dual_stacked_bar','info/100_dual_stacked_column','info/dual_stacked_bar','info/dual_stacked_column','info/line','info/horizontal_line','info/dual_line','info/dual_horizontal_line','info/bubble',"info/scatter",'info/combination','info/horizontal_combination','info/stacked_combination','info/horizontal_stacked_combination','info/dual_stacked_combination','info/dual_horizontal_stacked_combination','info/timeseries_combination','info/timeseries_stacked_combination','info/timeseries_bullet','info/dual_timeseries_combination','info/dual_combination','info/dual_horizontal_combination'],v)>-1;};V.prototype.getResponsiveLegend=function(){if(this._vizFrame){return sap.viz.ui5.controls.ResponsiveLegend.createInstance(this._vizFrame.responsiveLegend());}};V.prototype.exportToSVGString=function(o){var r="<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\"/>";if(this._vizFrame){r=this._vizFrame.exportToSVGString(o);}return r;};V.prototype._getScopeString=function(){var s=P.getActiveScopesFor(this);return JSON.stringify(s);};V.prototype._scopingChangedFun=function(e){var E=e.getParameter("element");var i=false;if(this===E){i=true;}else{var o=this;while(o){o=o.getParent();if(o===E){i=true;break;}}}if(i){var s=this._getScopeString();if(this._sCurrentScopeChain!==undefined&&this._sCurrentScopeChain!==s){this._themeChangedHandler(false,function(){this._themeLoadCompleted=true;this._renderVizFrame({forceThemeChange:true});}.bind(this));}}};V.prototype._createContainerDiv=function(){if(!this._vizFrame$){this._vizFrame$=q(document.createElement('div'));this._vizFrame$.addClass(c.CSS_PREFIX+'-viz-frame');this._vizFrame$.appendTo(this._app$);}if(!this._description$){this._description$=q(document.createElement('div'));this._description$.addClass(c.CSS_PREFIX+'-viz-description');this._description$.appendTo(this._app$);this._description$.attr('tabindex',0);this._descriptionTitle$=q(document.createElement('div'));this._descriptionTitle$.addClass(c.CSS_PREFIX+'-viz-description-title');this._descriptionTitle$.appendTo(this._description$);this._descriptionDetail$=q(document.createElement('div'));this._descriptionDetail$.addClass(c.CSS_PREFIX+'-viz-description-detail');this._descriptionDetail$.appendTo(this._description$);this._descriptionMessage$=q(document.createElement('div'));this._descriptionMessage$.addClass(c.CSS_PREFIX+'-viz-description-message');this._descriptionMessage$.appendTo(this._description$);}};V.prototype._createVizFrame=function(o){sap.ui.getCore().attachThemeScopingChanged(this._scopingChangedFun,this);o.container=this._vizFrame$.get(0);var v=this._vizFrame=new sap.viz.vizframe.VizFrame(o,{'controls':{'morpher':{'enabled':false}},'throwError':true});v.on('selectData',function(e){this.fireEvent("selectData",e);}.bind(this));v.on('deselectData',function(e){this.fireEvent("deselectData",e);}.bind(this));v.on('initialized',function(e){var i=this._vizFrame$;i.on("focusin",function(r){r.preventDefault();i.addClass('sapMFocus');});i.on("focusout",function(r){r.preventDefault();i.removeClass('sapMFocus');});this.fireEvent("renderComplete",e);}.bind(this));v.on('scroll',function(e){this.fireEvent("_scroll",e);}.bind(this));v.on('_selectionDetails',function(e){S.appendShapeStrings(e.data);this.fireEvent("_selectionDetails",e);}.bind(this));v.on('_zoomDetected',function(e){this.fireEvent("_zoomDetected",e);}.bind(this));return v;};V.prototype._migrate=function(t,e){e.forEach(function(o){var r=sap.viz.api.serialization.feedsIdToBindingId(t,o.getUid());if(r){o.setProperty('uid',r,true);}});if(t==="info/bullet"||t==="info/vertical_bullet"||t==="info/timeseries_bullet"){var i=false;e.forEach(function(o){i=i||o.getUid()==='actualValues';});if(!i){e.forEach(function(o){if(o.getUid()==='valueAxis'){o.setUid('actualValues');if(o.getValues().length>1){e.push(new F({'uid':'additionalValues','type':'Measure','values':[o.getValues()[1]]}));o.setValues([o.getValues()[0]]);}}});}}};function k(e){for(var i=e.length-1;i>=0;i--){var o=e[i];if(o.feed&&o.feed==="color"&&o.palette){return i;}}return-1;}V.prototype._checkProps=function(e,o,i){if(e==='fiori'){o.properties=b.decorateFiori(o,i,this.getVizProperties());}if(o.properties){o.properties=g.removeInvalid(o.type,o.properties);}if(o.type==="info/bullet"||o.type==="info/vertical_bullet"){o.properties=this._mergeProperties(o.properties||{},this._bulletProperties);b.decorateBullet(o,i);}if(o.type==="info/timeseries_bullet"){b.decorateTimeBullet(o);}if(o.type==="info/timeseries_waterfall"){b.decorateWaterfall(o,i);o.properties=this._mergeProperties(o.properties||{},this._waterfallProperties);}};function m(){function e(v){if(!v||typeof v!=='object'||({}).toString.call(v)!='[object Object]'){return false;}var i=Object.getPrototypeOf(v);if(i===null){return true;}var r=self.hasOwnProperty.call(i,'constructor')&&i.constructor;return typeof r=='function'&&r instanceof r&&Function.prototype.toString.call(r)===Function.prototype.toString.call(Object);}function _(i,r,s){for(var t in s){var u=s[t];var v=i?i[t]:i;if(u!==undefined){if(v===null||!e(u)){r[t]=u;}else{var w=r[t];if(!w||!e(w)){w=r[t]={};}_(v,w,u);}}}};function o(r,s,t){s=s||{};for(var i=2;i<arguments.length;i++){var u=arguments[i];_(r,s,u);}return s;};self.onmessage=function(i){var r={};var s=i.data.allChartNames;for(var h=0;h<s.length;++h){var j=s[h];if(i.data.applicationSet==='fiori'){r[j]=o(i.data.allPropDefs[j],i.data.defaultFioriProps,i.data.generalProps,i.data.specificProps[j.replace('info/','')]);if(/dual/.test(j)){o[j]=o(i.data.allPropDefs[j],r[j],i.data.dualFioriProps);}}else{r[j]=o(i.data.allPropDefs[j],i.data.generalProps,i.data.specificProps[j.replace('info/','')],i.data.defaultFormatString[j]);}r[j]=o(i.data.allPropDefs[j],i.data.cvomTemplate[j],r[j],i.data.allUi5Theme[j],i.data.extraProp);}self.postMessage(r);};}function n(e,i,o,r,s,t){return new Promise(function(u){var w=new window.Worker(window.URL.createObjectURL(new window.Blob(["("+m.toString()+")()"],{type:'text/javascript'})));w.postMessage({applicationSet:e,allPropDefs:i,allChartNames:c.CORE_CHART_TYPES,generalProps:D._general,specificProps:D._specified,defaultFioriProps:D.DEFAULT_FIORI_PROPS,dualFioriProps:D.FIORI_DUAL_PROPS,allUi5Theme:o,cvomTemplate:r,extraProp:s,defaultFormatString:t});w.onmessage=function(v){u(v.data);}});}function p(j,e,o){var i=g.mergeProperties;var r=sap.viz.ui5.theming.Util.readCSSParameters;var s=D.get(g,j,e);var t=D.getExtraProp(e);return i(j,s,r(j,o),t);}V.prototype._getTemplateProps=function(e,i,o){if(this._templateCache[o]){return Promise.resolve();}var j,h;return new Promise(function(r){if(typeof(window.Worker)!=='undefined'){var s=sap.viz.ui5.theming.Util.readCSSParameters;var t=D.getExtraProp(e);var u={};var v={};var w={};for(h=0;h<c.CORE_CHART_TYPES.length;h++){j=c.CORE_CHART_TYPES[h];if(e!=='fiori'){w[j]=D.applyDefaultFormatString({},j);}u[j]=g.getPropertiesDef(j);v[j]=s(j,this);}this._themeLoadCompleted=false;return n(e,u,v,i.properties,t,w).then(function(y){this._templateCache[o]=y;r();}.bind(this));}else{var x=g.mergeProperties;var y={};for(h=0;h<c.CORE_CHART_TYPES.length;h++){j=c.CORE_CHART_TYPES[h];y[j]=p(j,e,this);}if(i.properties){for(h=0;h<c.CORE_CHART_TYPES.length;h++){j=c.CORE_CHART_TYPES[h];y[j]=x(j,i.properties[j],y[j]);y[j]=g.removeInvalid(j,y[j]);}}this._templateCache[o]=y;r();}}.bind(this));};V.prototype._getOptions=function(t,e){var o={'type':t,'properties':{}};if(this._invalidateDataset){o.data=this._getVizDataset();this._invalidateDataset=false;}if(this._invalidateFeeds){o.bindings=this._getVizBindings(t,e);this._invalidateFeeds=false;}if(this.getProperty('vizProperties')){o.properties=this.getProperty('vizProperties');}if(this.getProperty('vizScales')){o.scales=this.getProperty('vizScales');}if(this._scalesOption){o.scalesOption=this._scalesOption;}if(this.getProperty('vizCustomizations')){o.customizations=this.getProperty('vizCustomizations');}if(this._aRuntimeScales){o.sharedRuntimeScales=this._aRuntimeScales;}o.template=this._currentTemplate;return o;};V.prototype._setCustomMessages=function(o){this._errorInfo=o;this._handleDescription(this._errorType);};V.prototype._realRenderVizFrame=function(r){if(!this._readyToRender()){return;}var e=(this.getUiConfig()||{}).applicationSet;var t=this._getCalculatedType();var i=this.getFeeds();var o=g.mergeProperties;var s={_invalidateDataset:this._invalidateDataset,_invalidateVizType:this._invalidateVizType,_invalidateFeeds:this._invalidateFeeds};this._migrate(t,i);var u=false,v=sap.ui.getCore().getConfiguration().getTheme();if((r&&r.forceThemeChange)||(this._currentTheme!==v)){u=true;}s.theme=v;if(!(this._invalidateFeeds||this._invalidateDataset||u||this._invalidateVizType||this._localeChanged)||!this._isDataReady()){return;}this._createContainerDiv();try{var w=this._getOptions(t,i);if(!w){return;}this._currentTheme=v;if(this._isExtension()){var x=p(t,e);w.properties=o(t,x,w.properties);}this._checkProps(e,w,i,t);if(this._invalidateVizType){this._invalidateVizType=false;}if(!this._vizFrame){if(w.data){this._createVizFrame(w);this._clearRequestedProperties();}}else{this._vizFrame.update(w);this._clearRequestedProperties();}if(this._connectPopover){this._connectPopover();}var y=this._getVizDataset();if(y&&y._FlatTableD&&(!y._FlatTableD._data.length)){throw c.ERROR_MESSAGE.NODATA;}else{this._errorType=null;this._updateDescription();}this._localeChanged=false;}catch(z){if(!this._vizFrame){this._invalidateDataset=s._invalidateDataset;this._invalidateVizType=s._invalidateVizType;this._invalidateFeeds=s._invalidateFeeds;this._currentTheme=s.theme;}this._handleErr(z);}};V.prototype._renderVizFrame=function(r){if(!this._readyToRender()||(this._isInitThememChanged&&!this._themeLoadCompleted)){return;}if(!this._isInitThememChanged){this._pendingRerendering=true;this._themeChangedHandler(false,function(){this._pendingRerendering=false;this._realRenderVizFrame(r);this._themeLoadCompleted=true;}.bind(this));}else{this._realRenderVizFrame(r);}};V.prototype._themeChangedHandler=function(e,i){this._isInitThememChanged=true;var o=(this.getUiConfig()||{}).applicationSet;var r=o||"";var s="";this._sCurrentScopeChain=this._getScopeString();if(this._sCurrentScopeChain){s=this._sCurrentScopeChain;}var t=sap.ui.getCore().getConfiguration().getTheme();var u=t+"_"+r+"_"+c.TEMPLATE_POSTFIX+s;if(this._currentTemplate===u&&!e){return;}this._currentTemplate=u;var v=sap.viz.api.env.Template.get();var w=sap.viz.extapi.env.Template;if(!w.isRegistered(u)||e){w.unregister(u);var x;if(v.indexOf(c.TEMPLATE_POSTFIX)>-1){x=w.getPackage('standard_fiori')||w.getPackage('default');}else{x=w.current();}this._getTemplateProps(o,x,u).then(function(){var y=this._templateCache[u];x.properties=x.properties||{};x.scales=x.scales||{};for(var j in y){if(y.hasOwnProperty(j)){x.properties[j]=y[j];var z=x.scales[j];if(z){var E=k(z);if(E>-1){z.splice(E,1);}}}}x.id=u;x.name=u;w.register(x);i();}.bind(this));}else{i();}};V.prototype.onThemeChanged=function(e){if(this._app$&&this.$()){this._themeChangedHandler(e.triggeredBy&&e.triggeredBy==='themedesigner',function(){this.invalidate();this._themeLoadCompleted=true;}.bind(this));}};V.prototype.onlocalizationChanged=function(){if(this._app$&&this.$()){sap.viz._applyLocale(function(){if(this._errorType){this._localeChanged=true;this.invalidate();}}.bind(this));}};V.prototype._isDataReady=function(){var e=this.getDataset();return(!e||!e.isReady())?false:true;};V.prototype._getVizDataset=function(){var e=this.getDataset();if(this._isExtension()){var i=this._getMetadata();if(i){if(i.dataType==='raw'){return e.getRawDataset();}else if(i.dataType==='sap.viz.api.data.CrosstableDataset'){a.updateAxis(e.getDimensions(),this._getCalculatedType(),this.getFeeds());return e.getVIZCrossDataset();}else{return e.getVIZFlatDataset();}}else{a.updateAxis(e.getDimensions(),this._getCalculatedType(),this.getFeeds());return e.getVIZCrossDataset();}}else{return e.getVIZFlatDataset();}};V.prototype._getVizBindings=function(t,e){if(e&&e.length){var i=F.toLightWeightFmt(e);i=sap.viz.vizservices.BVRService.suggestFeeds(t,i,[{'id':'MND','type':'MND'}]).feedItems;if(this._isExtension()){var o=this._getMetadata();if(o){if(o.dataType==='sap.viz.api.data.CrosstableDataset'){return f.generateBindings(t,i,'CrossTableDataset');}else{return f.generateBindings(t,i,'FlatTableDataset');}}else{return f.generateBindings(t,i,'CrossTableDataset');}}else{return f.generateBindings(t,i,'FlatTableDataset');}}else{return null;}};V.prototype._getMetadata=function(){var e;try{e=sap.viz.api.metadata.Viz.get(this._getCalculatedType());}catch(i){e=null;}return e;};V.prototype._onConnectPopover=function(e){if(arguments.length>0){this._connectPopover=e;}return this._connectPopover;};V.prototype._createChildren=function(){this._renderVizFrame();};V.prototype._updateChildren=function(){this._renderVizFrame();};V.prototype._suppressInvisibleRender=function(s){this._bSuppressInvisibleRender=!!s;};V.prototype._validateSize=function(e){if(!this._app$||!this.$()||(e&&e.size&&(e.size.height==0||e.size.width==0))||(this._bSuppressInvisibleRender&&(window.getComputedStyle(this.getDomRef(),null).visibility==="hidden"))||this.$().prop('offsetHeight')===0){return;}var i={'width':this.$().width(),'height':this.$().height()};if(this._vizFrame){var s=this._vizFrame.size();if(!s||s.width!==i.width||s.height!==i.height){this._vizFrame.size({'width':i.width,'height':i.height,'auto':true,'invisibleRender':true});}}};V.prototype._getCalculatedType=function(){if(this._isExtension()){return this.getVizType();}else{return this._getInfoType();}};V.prototype._isExtension=function(){return c.CORE_CHART_TYPES.indexOf(this._getInfoType())===-1;};V.prototype._getInfoType=function(){var v=this.getVizType();if(v.indexOf("info/")===-1){return'info/'+v;}else{return v;}};V.prototype._mergeProperties=function(t,e){return g.mergeProperties(this._getCalculatedType(),t,e);};V.prototype._wrapApi=function(e,i){this[e]=function(){var r=V.prototype[e].apply(this,arguments);i();return r;}.bind(this);};V.prototype._updateDescription=function(e){var i=this._description$;var t=this._descriptionTitle$;var o=this._descriptionDetail$;var r=this._descriptionMessage$;if(!this._description$.length){return;}if(!e){i.hide();}else{i.show();t.empty();o.empty();r.empty();var s="";if(e.title){t.show().text(e.title);s+=e.title+". ";}if(e.detail){o.show().text(e.detail);s+=e.detail+" ";}if(e.message){r.show().text(e.message);s+=e.message;}i.attr('aria-label',s);}};V.prototype._handleDescription=function(e,i){var o;if(!e){return;}if(this._errorInfo&&this._errorInfo[e]){o={message:this._errorInfo[e]};}else if(e===c.ERROR_TYPE.INVALIDDATA){o={title:sap.viz.extapi.env.Language.getResourceString("IDS_ERROR_INVALIDE_DATA"),detail:sap.viz.extapi.env.Language.getResourceString("IDS_ERROR_INVALIDE_DATA_DESCRIPTION")};}else if(e===c.ERROR_TYPE.MULTIPLEUNITS){o={title:sap.viz.extapi.env.Language.getResourceString("IDS_ERROR_INVALIDE_DATA"),detail:sap.viz.extapi.env.Language.getResourceString("IDS_ERROR_INVALIDE_DATA_MULTIPLEUNITS")};}else if(e===c.ERROR_TYPE.NODATA){o={title:sap.viz.extapi.env.Language.getResourceString("IDS_ERROR_ISNODATA")};}else{o={message:i};}this._updateDescription(o);};V.prototype._handleErr=function(e){var s=(this.getUiConfig()||{}).showErrorMessage!==false;var i=true;if(s){if(e===c.ERROR_MESSAGE.NODATA){this._errorType=c.ERROR_TYPE.NODATA;i=false;}else if(e===c.ERROR_MESSAGE.MULTIPLEUNITS){this._errorType=c.ERROR_TYPE.MULTIPLEUNITS;this._clearVizFrame();}else{this._errorType=e.toString().indexOf("[50060]")>=0?c.ERROR_TYPE.INVALIDDATA:c.ERROR_TYPE.OTHERS;if(this._vizFrame){this._vizFrame$.find(".v-info").remove();}else{this._clearVizFrame();}}this._handleDescription(this._errorType,e);}if(i){this.fireEvent('renderFail',{'id':'renderFail','error':e});}};V.prototype._clearVizFrame=function(){if(this._vizFrame){this._vizFrame.destroy();this._vizFrame=null;}this._vizFrame$.empty();sap.ui.getCore().detachThemeScopingChanged(this._scopingChangedFun,this);};V.prototype._runtimeScales=function(r,s){if(arguments.length===0){return this._vizFrame?this._vizFrame.runtimeScales():this._aRuntimeScales;}else if(r){this._aRuntimeScales=[].concat(r);if(!s){this.invalidate();}}};V.prototype._getZoomInfo=function(){var z,e,i,o,s=this._states();if(s){z=s.zoomInOut;if(z){e=z.enabled;i=z.currentZoomLevel;}else{e=false;i=null;}o={enabled:e,currentZoomLevel:i};}else{o={};}return o;};V.prototype._states=function(){var r;if(this._vizFrame){r=this._vizFrame.states.apply(this._vizFrame,arguments);}return r===this._vizFrame?this:r;};V.prototype._readyToRender=function(r){if(arguments.length===0){return this._bReadyToRender;}else{this._bReadyToRender=r;}};return V;});
