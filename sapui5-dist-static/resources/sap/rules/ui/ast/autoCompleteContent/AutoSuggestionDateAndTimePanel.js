sap.ui.define(["sap/ui/thirdparty/jquery","../../library","sap/ui/core/Control","sap/m/List","sap/m/Dialog","sap/m/Button","sap/m/DatePicker","sap/m/DateTimePicker","sap/m/TimePicker","sap/ui/model/json/JSONModel","sap/m/ListMode","sap/ui/core/CustomData","sap/ui/model/Sorter","sap/ui/core/LocaleData","sap/rules/ui/Constants","sap/rules/ui/AstExpressionBasic","sap/rules/ui/services/AstExpressionLanguage"],function(q,l,C,L,D,B,a,b,T,J,c,d,S,e,f,A,g){"use strict";var h=C.extend("sap.rules.ui.ast.autoCompleteContent.AutoSuggestionDateAndTimePanel",{metadata:{library:"sap.rules.ui",properties:{reference:{type:"object",defaultValue:null,},data:{type:"object",defaultValue:null},dialogOpenedCallbackReference:{type:"object",defaultValue:null,},vocabularyInfo:{type:"object",defaultValue:null}},aggregations:{PanelLayout:{type:"sap.m.Panel",multiple:false}},associations:{astExpressionLanguage:{type:"sap.rules.ui.services.AstExpressionLanguage",multiple:false,singularName:"astExpressionLanguage"}},events:{}},init:function(){this.needCreateLayout=true;this.oBundle=sap.ui.getCore().getLibraryResourceBundle("sap.rules.ui.i18n");this.vocabularyInfo=this.getVocabularyInfo();this.autoSuggestionData=this.getData();var o=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();var i=e.getInstance(o);this.oFormatDate=sap.ui.core.format.DateFormat.getInstance({pattern:i.getDatePattern('short'),calendarType:sap.ui.core.CalendarType.Gregorian},o);},onBeforeRendering:function(){this._reference=this.getReference();this._dialogOpenedCallbackReference=this.getDialogOpenedCallbackReference();if(this.needCreateLayout){var i=this._createLayout();this.setAggregation("PanelLayout",i,true);this.needCreateLayout=false;}},_createDateTimeDialog:function(){var t=this;var o=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();var i=e.getInstance(o);var j=i.getDatePattern('medium');var k=i.getTimePattern('medium');var v=j+" "+k;if(this.dateContext){this._dateBusinessDataType=this.dateContext;}if(this._dateBusinessDataType==="D"){this.control=new a({width:"auto",type:"Date",valueFormat:j});}if(this._dateBusinessDataType==="U"){var t=this;this.control=new b({width:"auto",valueFormat:v});}this._oSelectNewDateDialog=new D({title:this.oBundle.getText("calendarTitle"),content:[this.control],beginButton:new B({text:this.oBundle.getText("okBtn"),enabled:true,press:function(E){var m=this._updateText(this.control);E.oSource.mProperties.value="'"+m+"'";t._reference(E);t._setModal(false);t._oSelectNewDateDialog.close();}.bind(this)}),endButton:new B({text:this.oBundle.getText("clsBtn"),press:function(){t._setModal(false);t._oSelectNewDateDialog.close();}.bind(this)})});this._dialogOpenedCallbackReference(true);this._setModal(true);this._oSelectNewDateDialog.open();},_updateText:function(o){var s=o._getInputValue();var i=this._getValidValue(s);return i;},_getValidValue:function(v){var i,j;if(this.dateContext){this._dateBusinessDataType=this.dateContext;}if(this._dateBusinessDataType==="D"){i=new Date(v);j=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"});return j.format(i);}else if(this._dateBusinessDataType==="U"){i=new Date(v);j=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd'T'HH:mm:ss.sss'Z'"});return j.format(i);}return v;},_setModal:function(v){var p=sap.ui.getCore().byId("popover");if(p){p.setModal(v);}},_getDataBusinessDataType:function(){this._dateBusinessDataType="";this.businessDataTypeList=this.getData().businessDataTypeList;for(var i in this.businessDataTypeList){if(this.businessDataTypeList[i]==="D"){this._dateBusinessDataType="D";this.showDate=true;}if(this.businessDataTypeList[i]==="U"){this._dateBusinessDataType="U";this.showTimeStamp=true;}}if(this.showDate&&this.showTimeStamp){this.showDateAndTimeStamp=true;}},_createLayout:function(){var t=this;this._getDataBusinessDataType();if(this._dateBusinessDataType!=""&&!this.showDateAndTimeStamp){return this._createEitherDateOrTimeBasedOnType();}else{return this._createBothDateAndTime();}},_createEitherDateOrTimeBasedOnType:function(){var t=this;if(this._dateBusinessDataType==="D"){this.textContent=this.oBundle.getText("select_date");}else if(this._dateBusinessDataType==="U"){this.textContent=this.oBundle.getText("select_date_time");}this.content=new sap.m.Link({wrapping:true,text:this.textContent,press:function(E){t._createDateTimeDialog();}});var i=new sap.m.Panel({expandable:false,expanded:true,content:[this.content],width:"auto"});return i;},_createBothDateAndTime:function(){var t=this;this.dateContent=new sap.m.Link({wrapping:true,text:this.oBundle.getText("select_date"),press:function(E){t.dateContext="D";t._createDateTimeDialog();}});this.toolBarSpacer=new sap.m.ToolbarSpacer({width:"1em"});this.timeContent=new sap.m.Link({wrapping:true,text:this.oBundle.getText("select_date_time"),press:function(E){t.dateContext="U";t._createDateTimeDialog();}});var i=new sap.m.Panel({headerText:this.oBundle.getText("dateTimePanelTitle"),expandable:true,expanded:false,width:"auto"});i.addContent(this.dateContent);i.addContent(this.toolBarSpacer);i.addContent(this.timeContent);return i;}});return h;},true);
