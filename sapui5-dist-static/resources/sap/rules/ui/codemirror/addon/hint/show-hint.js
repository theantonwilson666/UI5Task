(function(){"use strict";var H="sapMLIB sapMLIBHoverable CodeMirror-hint";var A="sapMLIB sapMLIBHoverable sapMLIBSelected CodeMirror-hint-active";var S='Select value from list...';var a='any of the following conditions is true:';var b='all of the following conditions are true:';var c="<add line>";var N="\n\u2022  \n;";var d="\u2022  ";var E="\n"+d;var f="<'string'>";var g="<number>";var D="<'dd/mm/yyyy'>";var T="<'hh:mi:ss'>";var h="<'dd/mm/yyyy hh:mi:ss'>";var j="constant";var k="Date";var l="Time";var m="Timestamp";var o="Number";var V="valueList";var C='CustomDate';var p="CodeMirror-hint-valueHelp";var q="<'M/d/yy'>";var r="Select Date using Calendar";CodeMirror.handleEnter=function(e,i,n){var t=CodeMirror.initComplition(e,i,n);if(t){var y=t.getHints(e,t.options);if(!y){return;}var z=jQuery.map(y.list,function(B,F){if(B.text===c){return F;}});if(z.length>0){t.pick(y,z[0],"enter");}t.close();}};CodeMirror.handleColon=function(e,i,n){var t=CodeMirror.initComplition(e,i,n);if(t){var y=t.getHints(e,t.options);if(y){var z=y.list.indexOf(c);if(z>0){y.list[z]=N;t.pick(y,z);}}}};CodeMirror.closeAutoComplete=function(e,i,n){var t=e.state.completionActive;t&&t.close();};CodeMirror.showHint=function(e,i,n){var t=CodeMirror.initComplition(e,i,n);if(t){CodeMirror.signal(e,"startCompletion",e);if(t.options.async)i(e,function(y){t.showHints(y);},t.options);else return t.showHints(t.getHints(e,t.options));}};CodeMirror.initComplition=function(e,i,n){if(e.somethingSelected())return;if(i==null){if(n&&n.async)return;else i=CodeMirror.hint.auto;}if(e.state.completionActive)e.state.completionActive.close();if(e.state.completionActive&&e.state.completionActive.widget!==null)return;var t=e.state.completionActive=new s(e,i,n||{});return t;};function s(e,i,n){this.cm=e;this.getHints=i;this.options=this.buildOptions(n);this.widget=this.onClose=null;}s.prototype={setNewCursorPosition:function(e,i){var n=i.getCursor();if(e===a+N||e===N||e===b+N){n.line--;n.ch+=i.getOption("indentUnit")+2;i.setCursor(n);}if(e===d||e===E){n.ch+=i.getOption("indentUnit")+2;i.setCursor(n);}if(e==="''"){n.ch-=1;i.setCursor(n);}},handleSimpleTypesPick:function(e,i){switch(e){case f:e="''";break;case g:e="0";break;case D:e="'dd/mm/yyyy'";break;case T:e="'hh:mi:ss'";break;case h:e="'dd/mm/yyyy hh:mi:ss'";break;default:if((e.charAt(0)==="<")&&(e.charAt(e.length-1)===">")&&(i.tokenType===j)&&((i.info.type===k)||(i.info.type===l)||(i.info.type===m)||(i.info.type===o))){e=e.substring(1,e.length-1);}break;}return e;},close:function(){if(!this.active())return;this.cm.state.completionActive=null;if(this.widget)this.widget.close();if(this.onClose)this.onClose();CodeMirror.signal(this.cm,"endCompletion",this.cm);},active:function(){return this.cm.state.completionActive==this;},pick:function(e,i,n){var t=null;var y=e.list[i];var z=y.text;var B=y.completion;var F=z;var G=e.list[i].tokenType===V;var I=e.list[i].tokenType===C;if(!G&&!I){F=this.handleSimpleTypesPick(z,y);if(F!==z){B=B.replace(z,F);z=z.replace(z,F);}if(F===a||F===b){F=F+N;}if(z.trim()===c){if(n==="enter"){F=d;}else{F=E;}}if(y.hint){y.hint(this.cm,e,y);}else{var J=z.length-B.length;if(J>0){var K=this.cm.getCursor().ch-J;var L={line:this.cm.getCursor().line,ch:K};this.cm.replaceRange(F,L,this.cm.getCursor());}else{var M=F.replace(z,B);this.cm.replaceRange(M,this.cm.getCursor());}}this._setModal(false);CodeMirror.signal(e,"pick",F);}else if(G){this._setModal(true);CodeMirror.signal(this.cm,"onValueListSelect");}else if(I){this._setModal(true);CodeMirror.signal(this.cm,"onChangeDate");}this.setNewCursorPosition(F,this.cm);this.close();},_setModal:function(e){var i=sap.ui.getCore().byId("popover");if(i){i.setModal(e);}},showHints:function(e){if(!e||!e.list.length||!this.active())return this.close();if(this.options.completeSingle!=false&&e.list.length==1)this.pick(e,0);else this.showWidget(e);},showWidget:function(e){this.widget=new W(this,e);CodeMirror.signal(this.cm,"shown");var i=0,n=this,t;var y=this.options.closeCharacters||/[\s()\[\]{};:>,]/;var z=this.cm.getCursor(),B=this.cm.getLine(z.line).length;var F=window.requestAnimationFrame||function(O){return setTimeout(O,1000/60);};var G=window.cancelAnimationFrame||clearTimeout;function I(){if(t)return;t=true;n.close();n.cm.off("cursorActivity",M);if(e)CodeMirror.signal(this.cm,"close");}function J(){if(t)return;CodeMirror.signal(e,"update");if(n.options.async)n.getHints(n.cm,K,n.options);else K(n.getHints(n.cm,n.options));}function K(O){e=O;if(t)return;if(!e||!e.list.length)return I();n.widget=new W(n,e);}function L(){if(i){G(i);i=0;}}function M(){L();var O=n.cm.getCursor(),P=n.cm.getLine(O.line);if(O.line!=z.line||P.length-O.ch!=B-z.ch||O.ch<z.ch||n.cm.somethingSelected()||(O.ch&&y.test(P.charAt(O.ch-1)))){n.close();}else{i=F(J);if(n.widget)n.widget.close();}}this.cm.on("cursorActivity",M);this.onClose=I;},buildOptions:function(e){var i=this.cm.options.hintOptions;var n={};for(var t in x)n[t]=x[t];if(i)for(var t in i)if(i[t]!==undefined)n[t]=i[t];if(e)for(var t in e)if(e[t]!==undefined)n[t]=e[t];return n;}};function u(e){if(typeof e=="string")return e;else return e.text;}function v(e,i){var n={Up:function(){i.moveFocus(-1);},Down:function(){i.moveFocus(1);},PageUp:function(){i.moveFocus(-i.menuSize()+1,true);},PageDown:function(){i.moveFocus(i.menuSize()-1,true);},Home:function(){i.setFocus(0);},End:function(){i.setFocus(i.length-1);},Enter:i.pick,Esc:i.close};var t=e.customKeys?{}:n;function y(z,B){var F;if(typeof B!="string")F=function(G){return B(G,i);};else if(n.hasOwnProperty(B))F=n[B];else F=B;t[z]=F;}if(e.customKeys)for(var z in e.customKeys)if(e.customKeys.hasOwnProperty(z))y(z,e.customKeys[z]);if(e.extraKeys)for(var z in e.extraKeys)if(e.extraKeys.hasOwnProperty(z))y(z,e.extraKeys[z]);return t;}function w(e,i){while(i&&i!=e){if(i.nodeName.toUpperCase()==="LI"&&i.parentNode==e)return i;i=i.parentNode;}}function W(y,z){this.completion=y;this.data=z;var B=this,F=y.cm,G=y.options;var I=this.hints=document.createElement("ul");I.className="CodeMirror-hints";this.selectedHint=G.getDefaultSelection?G.getDefaultSelection(F,G,z):0;var J=z.list;var K=false;var L;var M="";var O;for(O=0;O<J.length;O++){if(J[O].tokenType===V){L=O;K=true;M=J[O].info.metadata.businessDataType;}else if(J[O]&&J[O].info&&J[O].info.type&&J[O].info.type===k){M="Date";}}if(K||M==='Date'){var P=[];if(K){P.push(J[L]);}if(M==='Date'){var Q={};Q.text=r;Q.tokenType='CustomDate';P.push(Q);}for(O=0;O<J.length;O++){if(J[O].tokenType===V){continue;}P.push(J[O]);}J=P;}z.list=J;for(var i=0;i<J.length;++i){var R=I.appendChild(document.createElement("li")),U=J[i];var X=H+(i!==this.selectedHint?"":" "+A);if(U.className!=null){X=U.className+" "+X;}if(J[i].tokenType===V||J[i].text===r){X=X+" "+p;}R.className=X;if(U.render){U.render(R,z,U);}else{R.appendChild(document.createTextNode(U.displayText||u(U)));}R.hintId=i;}var Y=F.cursorCoords(G.alignWithWord!==false?z.from:null);var Z=Y.left,$=Y.bottom,_=true;I.style.left=Z+"px";I.style.top=$+"px";var a1=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);var b1=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(G.container||document.body).appendChild(I);var c1=I.getBoundingClientRect();var d1=c1.right-a1,e1=c1.bottom-b1;if(d1>0){if(c1.right-c1.left>a1){I.style.width=(a1-5)+"px";d1-=(c1.right-c1.left)-a1;}I.style.left=(Z=Y.left-d1)+"px";}if(e1>0){var f1=c1.bottom-c1.top;if(c1.top-(Y.bottom-Y.top)-f1>0){e1=f1+(Y.bottom-Y.top);_=false;}else if(f1>b1){I.style.height=(b1-5)+"px";e1-=f1-b1;}I.style.top=($=Y.bottom-e1)+"px";}F.addKeyMap(this.keyMap=v(G,{moveFocus:function(n,e){B.changeActive(B.selectedHint+n,e);},setFocus:function(n){B.changeActive(n);},menuSize:function(){return B.screenAmount();},length:J.length,close:function(){y.close();},pick:function(){B.pick();}}));if(G.closeOnUnfocus!==false){var g1;F.on("blur",this.onBlur=function(){g1=setTimeout(function(){y.close();},100);});F.on("focus",this.onFocus=function(){clearTimeout(g1);});}var h1=F.getScrollInfo();F.on("scroll",this.onScroll=function(){var e=F.getScrollInfo(),n=F.getWrapperElement().getBoundingClientRect();var t=$+h1.top-e.top;var i1=t-(window.pageYOffset||(document.documentElement||document.body).scrollTop);if(!_)i1+=I.offsetHeight;if(i1<=n.top||i1>=n.bottom)return y.close();I.style.top=t+"px";I.style.left=(Z+h1.left-e.left)+"px";});CodeMirror.on(I,"click",function(e){var t=w(I,e.target||e.srcElement);if(t&&t.hintId!=null){B.changeActive(t.hintId);B.pick();}});CodeMirror.on(I,"mousedown",function(){F.options.shouldValidate=false;setTimeout(function(){F.focus();},20);});CodeMirror.signal(z,"select",J[0],I.firstChild);return true;}W.prototype={close:function(){if(this.completion.widget!=this)return;this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var e=this.completion.cm;if(this.completion.options.closeOnUnfocus!==false){e.off("blur",this.onBlur);e.off("focus",this.onFocus);}e.off("scroll",this.onScroll);},pick:function(){this.completion.pick(this.data,this.selectedHint);},changeActive:function(i,e){if(i>=this.data.list.length)i=e?this.data.list.length-1:0;else if(i<0)i=e?0:this.data.list.length-1;if(this.selectedHint==i)return;var n=this.hints.childNodes[this.selectedHint];n.className=n.className.replace(" "+A,"");n=this.hints.childNodes[this.selectedHint=i];n.className+=" "+A;if(n.offsetTop<this.hints.scrollTop)this.hints.scrollTop=n.offsetTop-3;else if(n.offsetTop+n.offsetHeight>this.hints.scrollTop+this.hints.clientHeight)this.hints.scrollTop=n.offsetTop+n.offsetHeight-this.hints.clientHeight+3;CodeMirror.signal(this.data,"select",this.data.list[this.selectedHint],n);},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1;}};CodeMirror.registerHelper("hint","auto",function(e,n){var t=e.getHelpers(e.getCursor(),"hint");if(t.length){for(var i=0;i<t.length;i++){var y=t[i](e,n);if(y&&y.list.length)return y;}}else{var z=e.getHelper(e.getCursor(),"hintWords");if(z)return CodeMirror.hint.fromList(e,{words:z});}});CodeMirror.registerHelper("hint","fromList",function(e,n){var t=e.getCursor(),y=e.getTokenAt(t);var z=[];for(var i=0;i<n.words.length;i++){var B=n.words[i];if(B.slice(0,y.string.length)==y.string)z.push(B);}if(z.length)return{list:z,from:CodeMirror.Pos(t.line,y.start),to:CodeMirror.Pos(t.line,y.end)};});var x={hint:CodeMirror.hint.auto,completeSingle:false,alignWithWord:true,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:true,completeOnSingleClick:false,container:null,customKeys:null,extraKeys:null};CodeMirror.commands.autocomplete=CodeMirror.showHint;CodeMirror.commands.enterAutocomplete=CodeMirror.handleEnter;CodeMirror.commands.colonAutocomplete=CodeMirror.handleColon;CodeMirror.commands.closeAutoComplete=CodeMirror.closeAutoComplete;})();
