jQuery.sap.declare("sap.rules.ui.parser.resources.common.lib.resourcesConvertor");jQuery.sap.require("sap.rules.ui.parser.resources.vocabulary.lib.validationUtils");jQuery.sap.require("sap.rules.ui.parser.resources.common.lib.oDataHandler");jQuery.sap.require("sap.rules.ui.parser.infrastructure.util.utilsBase");sap.rules.ui.parser.resources.common.lib.resourcesConvertor=sap.rules.ui.parser.resources.common.lib.resourcesConvertor||{};sap.rules.ui.parser.resources.common.lib.resourcesConvertor.lib=(function(){var d=sap.rules.ui.parser.resources.common.lib.oDataHandler.lib;var u=new sap.rules.ui.parser.infrastructure.util.utilsBase.lib.utilsBaseLib();var v=sap.rules.ui.parser.resources.vocabulary.lib.validationUtils.lib;var g=d.getOdataPropName;var a=d.getOdataPropertyValue;var b=d.getEnumPropertyValue;var c=false;function e(D,i,w,x){var y,z,A,B;var C=a(D,d.PROPERTY_NAME_ID);if(a(D,d.PROPERTY_NAME_TYPE)===d.TYPE_CONDITION){y={colID:C,type:"condition",expression:"",alias:""};A=g(D,d.PROPERTY_NAME_CONDITION);x=u.buildJsonPath(x,A);y.inputModelPath=x;y.expression=a(D[A],d.PROPERTY_NAME_EXPRESSION);if(y.expression==='true'){y.expression='';}B=a(D[A],d.PROPERTY_NAME_FIXED_OPERATOR);if(B!==undefined){y.fixedOperator={};y.fixedOperator.operator=B;i[C]=B+' ';}}else if(a(D,d.PROPERTY_NAME_TYPE)===d.TYPE_RESULT){y={colID:C,name:"",type:"output",businessDataType:""};z=g(D,d.PROPERTY_NAME_RESULT);y.businessDataType=a(D[z],d.PROPERTY_NAME_BUSINESS_DATA_TYPE);y.name=a(D[z],d.PROPERTY_NAME_DO_ATTRIBUTE_NAME);}w[C]=y.type;return y;}function f(D,i,w){var x,y,z,A,B,C,E=true;var F={rowID:0,row:[]};F.rowID=a(D,d.PROPERTY_NAME_ID);C=g(D,d.PROPERTY_NAME_CELLS);y=a(D,d.PROPERTY_NAME_CELLS);if(y){y.forEach(function(O,G){x=u.buildJsonPath(w,C,G);z={colID:0,content:""};z.colID=a(O,d.PROPERTY_NAME_COLUMN_ID);B=a(O,d.PROPERTY_NAME_CONTENT);A=i[z.colID];if(E&&B){E=false;}z.inputModelPath=x;z.content=(A==='output'&&!B)?null:B;if(!(A==='condition'&&!B)){F.row.push(z);}});}if(E){return null;}return F;}function h(D,w){var i;var x=null;var y=null;var z=null;for(i=0;i<D.length;i++){z=D[i];x=g(z,d.PROPERTY_NAME_USAGE);if(x&&z[x]===d.TYPE_DO){x=g(z,d.PROPERTY_NAME_ID);if(x&&z[x]===w){y=a(z,d.PROPERTY_NAME_NAME);break;}}}return y;}function j(D,i){var w={};w.source=a(D,d.PROPERTY_NAME_ATTRIBUTE_MAPPINGS_SOURCE);w.target=a(D,d.PROPERTY_NAME_ATTRIBUTE_MAPPINGS_TARGET);i.push(w);}function k(i,w,x,y,z,A){var B=null;var C=null;var D=null;var E={};E.name=a(i,d.PROPERTY_NAME_NAME);if(c){E.description=a(i,d.PROPERTY_NAME_DESCRIPTION);y.validateDescription(E,d.PROPERTY_NAME_ATTRIBUTE,x);}B=g(i,d.PROPERTY_NAME_MAPPING_INFO);if(B){E.dataMapping={};var F=g(i[B],d.PROPERTY_NAME_DATA_TYPE);if(F){E.dataType=a(i[B],d.PROPERTY_NAME_DATA_TYPE);E.dataMapping.column=a(i[B],'column');C=g(i[B],d.PROPERTY_NAME_SIZE);if(C){E.size=a(i[B],d.PROPERTY_NAME_SIZE);}}else{E.dataMapping.column=a(i[B],d.PROPERTY_NAME_NAME);E.dataType=a(i,d.PROPERTY_NAME_DATA_TYPE);C=g(i,d.PROPERTY_NAME_SIZE);if(C){E.size=i[C];}}}else{E.dataType=a(i,d.PROPERTY_NAME_DATA_TYPE);C=g(i,d.PROPERTY_NAME_SIZE);if(C){E.size=i[C];}}D=a(i,d.PROPERTY_NAME_BUSINESS_DATA_TYPE);B=g(i,d.PROPERTY_NAME_VALUE_HELP_ID);if(B&&i[B]){y.validateValueHelpBusinessDataType(i[B],D);E.valueList=i[B];}else{E.businessDataType=D;}if(z&&i.hasOwnProperty(d.CP_HAS_VALUE_SOURCE)&&i[d.CP_HAS_VALUE_SOURCE]===true){E.valueList=A+"_"+i[d.CP_DATOBJECT_ID]+"_"+i[d.PROPERTY_NAME_ID];y.validateValueHelpBusinessDataType(E.valueList,D);}E.sourceType=d.SOURCE_TYPE_DATA;w.push(E);}function l(D,i,w,x,y){var z=null;var A={};A.name=a(i,d.PROPERTY_NAME_NAME);if(c){A.description=a(i,d.PROPERTY_NAME_DESCRIPTION);y.validateDescription(A,d.PROPERTY_NAME_ASSOCIATION,x);}z=g(i,d.PROPERTY_NAME_TARGET_DATA_OBJECT_ID);A.target=h(D,i[z]);A.cardinality=b(i,d.PROPERTY_NAME_CARDINALITY);A.attributeMappings=[];z=g(i,d.PROPERTY_NAME_ATTRIBUTE_MAPPINGS);if(z&&i[z]&&Array.isArray(i[z])){i[z].forEach(function(B){j(B,A.attributeMappings);});}w.push(A);}function m(i,w){var x={};var y;x.name=a(i,d.PROPERTY_NAME_NAME);x.description=a(i,d.PROPERTY_NAME_DESCRIPTION);x.businessDataType=a(i,d.PROPERTY_NAME_BUSINESS_DATA_TYPE);var z=g(i,d.PROPERTY_NAME_MAPPING_INFO);if(z){x.dataMapping={};var A=g(i[z],d.PROPERTY_NAME_DATA_TYPE);if(A){x.dataType=a(i[z],d.PROPERTY_NAME_DATA_TYPE);y=g(i[z],d.PROPERTY_NAME_SIZE);if(y){x.size=a(i[z],d.PROPERTY_NAME_SIZE);}}}else{x.dataType=a(i,d.PROPERTY_NAME_DATA_TYPE);x.size=a(i,d.PROPERTY_NAME_SIZE);}x.id=i.Id;w.push(x);}function n(D,i){var w=null;i.name=a(D,d.PROPERTY_NAME_NAME);i.type=a(D,d.PROPERTY_NAME_TYPE);w=g(D,d.PROPERTY_NAME_SCHEMA);i.schema="";if(D[w]){i.schema=D[w];}w=g(D,d.PROPERTY_NAME_PARAMETERS);if(D[w]){i.parameters=D[w];}}function o(D,i,w){var x={};var y=a(D,d.PROPERTY_NAME_ID);var z=w.getValueHelpBusinessDataType(y);if(!z){return;}x.businessDataType=z;x.metadata={};x.metadata.serviceURL=a(D,d.PROPERTY_NAME_SERVICE_URL);x.metadata.propertyPath=a(D,d.PROPERTY_NAME_PROPERTY_PATH);x.metadata.type=a(D,d.PROPERTY_NAME_TYPE);i.valueLists[y]=x;}function p(D,i,w){var x={};var y=a(D,d.CP_VOCABULARY_ID);var z=a(D,d.CP_DATOBJECT_ID);var A=a(D,d.CP_ATTRIBUTE_ID);var B=y+"_"+z+"_"+A;var C=w.getValueHelpBusinessDataType(B);x.businessDataType=C;x.metadata={};x.metadata.vocabularyId=y;x.metadata.attributeId=A;x.metadata.dataObjectId=z;x.metadata[d.CP_HAS_VALUE_SOURCE]=true;var E=a(D,d.CP_VALUE_SOURCE_TYPE);if(E===d.CP_VALUE_SOURCE_TYPE_STATIC){x.metadata.serviceURL="/Enumerations";x.metadata.entitySet="Enumerations";}else{x.metadata.serviceURL="/ExternalValues";x.metadata.entitySet="ExternalValues";}i.valueLists[B]=x;}function q(D,i,w,x){var y={};var z=null;y.name=a(D,d.PROPERTY_NAME_NAME);y.id=a(D,d.PROPERTY_NAME_ID);y.isVocaRule=true;if(c){y.description=a(D,d.PROPERTY_NAME_DESCRIPTION);if(!x.isVocaRuleUnique(y)){x.deleteNonUniqueVocaRule(y,i.dataObjects);return;}x.validateDescription(y,d.PROPERTY_NAME_VOCABULARY_RULE,w);}y.resultDataObjectId=a(D,d.PROPERTY_NAME_RESULTDOID);z=u.findObjectById(y.resultDataObjectId,i.outputs);if(!z){z=u.findObjectById(y.resultDataObjectId,i.vocaRulesOutputs);}y.attributes=z.inputParams;i.dataObjects.push(y);}function r(D,i,w,x,y,z,A){var B=null;var C={};var E=null;B=g(i,d.PROPERTY_NAME_USAGE);if(B){C.name=a(i,d.PROPERTY_NAME_NAME);E=a(i,d.PROPERTY_NAME_TYPE);if(E){C.type=E;}if(i[B]===d.TYPE_DO){if(c){C.description=a(i,d.PROPERTY_NAME_DESCRIPTION);y.validateDescription(C,d.PROPERTY_NAME_DATA_OBJECT,x);}B=g(i,d.PROPERTY_NAME_ATTRIBUTES);if(B){C.attributes=[];var F=i[B];F.forEach(function(L){if(z){k(L,C.attributes,C.name,y,z,A);}else{k(L,C.attributes,C.name,y);}});}B=g(i,d.PROPERTY_NAME_ASSOCIATIONS);if(B){var G=i[B];C.associations=[];G.forEach(function(L){l(D,L,C.associations,C.name,y);});}B=g(i,d.PROPERTY_NAME_MAPPING_INFO);if(B){var H=i[B];C.mappingInfo={};n(H,C.mappingInfo);}w.dataObjects.push(C);}else if(i[B]===d.TYPE_RESULT||i[B]===d.TYPE_NONE){var I=i[B];C.id=a(i,d.PROPERTY_NAME_ID);var J=a(i,d.PROPERTY_NAME_DESCRIPTION);if(J){C.description=J;}B=g(i,d.PROPERTY_NAME_ATTRIBUTES);if(B){C.inputParams=[];var K=i[B];K.forEach(function(L){m(L,C.inputParams);});}if(I===d.TYPE_RESULT){w.outputs.push(C);}else{w.vocaRulesOutputs.push(C);}}}}var s=function(D,i){var w={"id":"","output":"","name":"","ruleBody":{"content":{"headers":[],"rows":[]},"type":"","hitPolicy":"","ruleFormat":""}};var x=g(D,d.PROPERTY_NAME_DECISION_TABLE);var y=u.buildJsonPath(i,x);var z={};var A={};w.id=a(D,d.PROPERTY_NAME_ID);w.name=a(D,d.PROPERTY_NAME_NAME);w.ruleBody.ruleFormat=b(D,d.PROPERTY_NAME_RULE_FORMAT);w.output=a(D,d.PROPERTY_NAME_RESULT_DO_NAME);w.ruleBody.type=b(D,d.PROPERTY_NAME_TYPE);w.ruleBody.relVersion=a(D,d.PROPERTY_NAME_REL_VERSION);w.ruleBody.hitPolicy=b(D[x],d.PROPERTY_NAME_HIT_POLICY);var B=a(D[x],d.PROPERTY_NAME_DT_COLUMNS);var C=g(D[x],d.PROPERTY_NAME_DT_COLUMNS);var E=a(D[x],d.PROPERTY_NAME_DDT_ROWS);var F=g(D[x],d.PROPERTY_NAME_DDT_ROWS);if(B){var G;B.forEach(function(I,J){i=u.buildJsonPath(y,C,J);G=e(I,z,A,i);w.ruleBody.content.headers.push(G);});}if(E){var H;E.forEach(function(I,J){i=u.buildJsonPath(y,F,J);H=f(I,A,i);if(H){w.ruleBody.content.rows.push(H);}});}return w;};var t=function(D,w){var i;var x=false;var y=new v.validationUtilsLib();var z=null;var A={"dataObjects":[],"outputs":[],"vocaRulesOutputs":[],"valueLists":{}};for(i=0;i<w.length;i++){if(w[i]==='byDescription'){c=true;break;}}z=g(D,d.CP_VALUE_SOURCE);if(z){x=true;}z=g(D,d.PROPERTY_NAME_DATA_OBJECTS);if(z){D[z].forEach(function(B){if(x){r(D[z],B,A,D.id,y,x,B.VocabularyId);}else{r(D[z],B,A,D.id,y);}});}z=g(D,d.PROPERTY_NAME_VALUE_HELPS);if(z&&Array.isArray(D[z])){D[z].forEach(function(B){o(B,A,y);});}if(x){z=g(D,d.CP_VALUE_SOURCE);if(z&&Array.isArray(D[z])){D[z].forEach(function(B){p(B,A,y);});}}z=g(D,d.PROPERTY_NAME_VOCABULARY_RULES);if(z){D[z].forEach(function(B){q(B,A,D.id,y);});}return A;};return{"convertRuleODataToInternalModel":s,"convertVocabularyODataToInternalModel":t};}());
