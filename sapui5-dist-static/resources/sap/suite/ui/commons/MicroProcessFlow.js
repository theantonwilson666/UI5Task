sap.ui.define(["sap/ui/thirdparty/jquery",'./library','sap/ui/core/Control','sap/ui/core/Icon','sap/ui/base/ManagedObject','sap/ui/core/delegate/ItemNavigation',"sap/ui/core/ResizeHandler"],function(q,l,C,I,M,a,R){"use strict";var b=l.MicroProcessFlowRenderType;var r=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var L=function(i){return i[i.length-1];};var c=C.extend("sap.suite.ui.commons.MicroProcessFlow",{metadata:{library:"sap.suite.ui.commons",interfaces:["sap.ui.core.IFormContent"],properties:{ariaLabel:{type:"string",defaultValue:null},renderType:{type:"sap.suite.ui.commons.MicroProcessFlowRenderType",defaultValue:sap.suite.ui.commons.MicroProcessFlowRenderType.Wrap},width:{type:"sap.ui.core.CSSSize",defaultValue:""}},aggregations:{content:{type:"sap.suite.ui.commons.MicroProcessFlowItem",multiple:true,singularName:"content"}}},renderer:function(o,m){var d=m.getContent(),w=m.getWidth(),e=d.length,s=m.getAriaLabel();if(!m._bThemeApplied){return;}o.write("<div ");o.writeAttributeEscaped("role","listbox");o.writeAttributeEscaped("aria-roledescription",r.getText("ACC_CTR_TYPE_MICRO_PROCESS_FLOW"));o.writeControlData(m);o.writeAttribute("aria-label",s);if(w){o.addStyle("width",w);}o.writeStyles();o.addClass("sapSuiteUiCommonsMicroProcessFlow");o.writeClasses(m);o.write(">");if(m._hasScrolling()){o.write("<div tabindex=\"0\" id=\""+m.getId()+"-leftscroller\" class=\"sapSuiteUiCommonsMicroProcessFlowScroller sapSuiteUiCommonsMicroProcessFlowLeftScroller\">");o.renderControl(m._getLeftScroller());o.write("<span id=\""+m.getId()+"-leftlabel\" class=\"sapSuiteUiCommonsMicroProcessFlowLeftLabel\"></span>");o.write("</div>");}o.write("<div id=\""+m.getId()+"-content\" class=\"sapSuiteUiCommonsMicroProcessFlowContent\">");o.write("<div id=\""+m.getId()+"-scrolling\" class=\"sapSuiteUiCommonsMicroProcessFlowScrolling sapSuiteUiCommonsMicroProcessFlowScrollingTransition\"");if(m.getRenderType()===b.Wrap){o.addStyle("flex-wrap","wrap");o.writeStyles();}o.write(">");d.forEach(function(f,i){f._setAccessibilityData(i+1,e);o.renderControl(f);});o.write("</div>");o.write("</div>");if(m._hasScrolling()){o.write("<div tabindex=\"0\" id=\""+m.getId()+"-rightscroller\" class=\"sapSuiteUiCommonsMicroProcessFlowScroller sapSuiteUiCommonsMicroProcessFlowRightScroller\">");o.write("<span id=\""+m.getId()+"-rightlabel\" class=\"sapSuiteUiCommonsMicroProcessFlowRightLabel\"></span>");o.renderControl(m._getRightScroller());o.write("</div>");}o.write("</div>");}});c.prototype.exit=function(){if(this._oLeftScroller){this._oLeftScroller.destroy();}if(this._oRightScroller){this._oRightScroller.destroy();}};c.prototype.init=function(){sap.ui.getCore().attachThemeChanged(function(){this._bThemeApplied=true;this.invalidate();},this);this._bThemeApplied=sap.ui.getCore().isThemeApplied();this._iScrollingIndex=0;this._iLastVisibleIndex=0;this._aEdges=[];this._aWidths=[];};c.prototype.onAfterRendering=function(){this._correctSeparatorWidth();this._setupKeyboard();if(this._hasScrolling()){this._setupScrolling();this._collectEdgesAndWidths();this._updateScrollingElements();if(this.getRenderType()===b.ScrollingWithResizer){this._oResizer=R.register(this,q.proxy(this._performResizeChanges,this));}}};c.prototype._performResizeChanges=function(){this._collectEdgesAndWidths();this._updateScrollingElements();};c.prototype._isLastItem=function(i){return i===this.getContent()[this.getContent().length-1];};c.prototype._getMaxHeight=function(i){return Math.max.apply(null,this.$().find(".sapSuiteUiCommonsMicroProcessFlowItemWrapper").map(function(){return q(this).height();}).get());};c.prototype._correctSeparatorWidth=function(){var m=this._getMaxHeight();if(m){this.getContent().forEach(function(i){var s=i.getStepWidth(),S;if(s.indexOf("%")!==-1){S=parseInt(s,10);if(!isNaN(S)){i.$("separator").width(m/S*100);}}},this);}};c.prototype._firePress=function(){if(this._oItemNavigation){var i=this._oItemNavigation.getFocusedIndex(),d=this.getContent()[i];if(d){d._firePress();}}};c.prototype._setupKeyboard=function(){var f=this.getDomRef(),d=this.getContent(),D=[];d.forEach(function(o,i){var $=o._getAccessibleItem();D.push($[0]);});if(!this._oItemNavigation){this._oItemNavigation=new a();this.addDelegate(this._oItemNavigation);}this._oItemNavigation.setRootDomRef(f);this._oItemNavigation.setItemDomRefs(D);this._oItemNavigation.setCycling(false);this._oItemNavigation.attachEvent(a.Events.AfterFocus,function(e){if(this._bKeyBoard===true){this._findEdgeItems(e.getParameter("index"));this._updateScrollingElements();}this._bKeyBoard=false;}.bind(this));};c.prototype._hasScrolling=function(){var s=this.getRenderType();return s===b.Scrolling||s===b.ScrollingWithResizer;};c.prototype._setupScrolling=function(){var $=this.$("leftscroller"),d=this.$("rightscroller");this._iScrollingIndex=0;this._iLastVisibleIndex=0;$.click(this._scroll.bind(this,-1));d.click(this._scroll.bind(this,1));this._iScrollingIndex<=0?$.hide():$.show();};c.prototype._updateScrollingElements=function(d){var e=this.getContent(),$=this.$("leftscroller"),f=this.$("rightscroller");$[this._iScrollingIndex<=0?"hide":"show"]();this._iLastVisibleIndex=this._findLastVisibleItemIndex(d);f[this._iLastVisibleIndex>=e.length-1?"hide":"show"]();this.$("leftlabel").text(this._iScrollingIndex);this.$("rightlabel").text(e.length-1-this._iLastVisibleIndex);};c.prototype._scroll=function(d,e){e.stopPropagation();var f=this.getContent(),$=this.$("rightscroller"),g=this.$("leftscroller"),h=sap.ui.getCore().getConfiguration().getRTL(),E,t,j;var k=function(){if(d>0){var w=this.$("content").width()-(g.is(":visible")?0:g.width()),p=L(this._aEdges)+L(this._aWidths);if(E+w>p){E-=(E+w-p+$.width());for(var i=0;i<this._aEdges;i++){if(this._aEdges[i]+this._aWidths[i]>E){this._iScrollingIndex=i;break;}}}}}.bind(this);var m=function(){if(!h&&o[0].scrollLeft!=0){this._clearScroll(o);}if(h){j=o.scrollRightRTL();if(j){this._clearScroll(o);}}}.bind(this);var n=this.$("scrolling"),o=n.parent();this._bKeyBoard=false;if(d<0&&this._iScrollingIndex<=0){return;}m();(d<0)?$.show():g.show();this._iScrollingIndex+=d;E=this._aEdges[this._iScrollingIndex];k();t="translateX("+((h?1:-1)*E)+"px)";this.$("scrolling").css("transform",t);if(!n.hasClass("sapSuiteUiCommonsMicroProcessFlowScrollingTransition")){setTimeout(function(){n.addClass("sapSuiteUiCommonsMicroProcessFlowScrollingTransition");},0);}this._updateScrollingElements(d);m();};c.prototype._clearScroll=function($){var i=sap.ui.getCore().getConfiguration().getRTL();if($&&$[0]){i?$.scrollLeftRTL($[0].scrollWidth-$[0].clientWidth):$[0].scrollLeft=0;}};c.prototype._findLastVisibleItemIndex=function(d){var s=this._aEdges[this._iScrollingIndex],w=this.$("content").width(),W=w+this.$("rightscroller").width(),e,n=0,f;for(var i=0;i<this._aEdges.length;i++){e=this._aEdges[i];if(e+this._aWidths[i]-10<s+w){n=i;}else{if(e+this._aWidths[i]<s+W){f=true;}else{f=false;break;}}}return f&&d!==-1?this.getContent().length-1:n;};c.prototype._collectEdgesAndWidths=function(){var s=0,h=0,w=this.$("content").width();this._aEdges=[];this._aWidths=[];this.getContent().forEach(function(o,i){var d=o.$().width();this._aEdges.push(s);this._aWidths.push(d);s+=d;},this);};c.prototype._getLeftScroller=function(){if(!this._oLeftScroller){this._oLeftScroller=new I(this.getId()+"leftscroller",{src:"sap-icon://nav-back"});this._oLeftScroller.addStyleClass("sapSuiteUiCommonsMicroProcessFlowArrow");}return this._oLeftScroller;};c.prototype._getRightScroller=function(){if(!this._oRightScroller){this._oRightScroller=new I(this.getId()+"rightscroller",{src:"sap-icon://navigation-right-arrow"});this._oRightScroller.addStyleClass("sapSuiteUiCommonsMicroProcessFlowArrow");}return this._oRightScroller;};c.prototype._findEdgeItems=function(d){var $=this.$("scrolling"),e=$.parent(),f=this.$("leftscroller"),g=this.$("rightscroller"),h=this.getContent(),j=Math.abs($.position().left),w,E,F=-1,k=-1;if(j<10||d===0){F=0;this._clearScroll(e);}if(d===h.length-1){k=h.length-1;}w=$.width();for(var i=0;i<this._aEdges.length;i++){E=this._aEdges[i];if(F===-1&&E>=j){F=i;}if(k===-1&&(E+this._aWidths[i]>j+w+5)){k=i-1;break;}}this._iScrollingIndex=F;this._iLastVisibleIndex=k!==-1?k:h.length-2;};c.prototype._processKeyPress=function(){if(this._hasScrolling()){var $=this.$("scrolling");this._bKeyBoard=true;$.removeClass("sapSuiteUiCommonsMicroProcessFlowScrollingTransition");$.css("transform","");}};c.prototype.onsapspace=function(){this._firePress();};c.prototype.onsapenter=function(){this._firePress();};c.prototype.onsapnext=function(e){this._processKeyPress();};c.prototype.onsapprevious=function(){this._processKeyPress();};c.prototype.onsaphome=function(e){this._processKeyPress();};c.prototype.onsapend=function(){this._processKeyPress();};c.prototype.getAccessibilityInfo=function(){var d="";this.getAggregation("content").forEach(function(v){d=d.concat(v._getAriaText());});return{type:r.getText("ACC_CTR_TYPE_MICRO_PROCESS_FLOW"),description:d};};c.prototype.getFormDoNotAdjustWidth=function(){return true;};return c;});
