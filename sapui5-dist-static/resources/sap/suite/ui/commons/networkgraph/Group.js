/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/suite/ui/commons/library","sap/ui/thirdparty/jquery","./ElementBase","sap/ui/core/IconPool","sap/m/CheckBox","sap/base/security/encodeXML"],function(l,q,E,I,C,e){"use strict";var a=l.networkgraph.ElementStatus,H=l.networkgraph.HeaderCheckboxState;var S={COLLAPSED_HEIGHT:32,COLLAPSED_WIDTH:160,ROUNDING:6,ICON_OFFSET:8,ICON_SIZE:15,HEADER_SIZE:32};var b="expand-all",c="collapse-all",M="horizontal-grip";var r=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var G=E.extend("sap.suite.ui.commons.networkgraph.Group",{metadata:{library:"sap.suite.ui.commons",properties:{headerCheckBoxState:{type:"sap.suite.ui.commons.networkgraph.HeaderCheckboxState",group:"Misc",defaultValue:H.Hidden},key:{type:"string",group:"Misc",defaultValue:null},collapsed:{type:"boolean",group:"Misc",defaultValue:false},icon:{type:"string",group:"Appearance",defaultValue:null},minWidth:{type:"float",defaultValue:undefined},parentGroupKey:{type:"string",group:"Misc",defaultValue:null}},events:{headerCheckBoxPress:{parameters:{checked:"boolean"}},collapseExpand:{},showDetail:{}},aggregations:{_checkBox:{type:"sap.m.CheckBox",multiple:false,visibility:"hidden"}}},renderer:{apiVersion:2,render:function(R,o){o._render({renderManager:R});}},onAfterRendering:function(){this._afterRenderingBase();}});G.prototype.aProcessRequiredProperties=["key","parentGroupKey"];G.BUTTONS={MENU:"menu",COLLAPSE:"collapse"};G.prototype.init=function(){this._iWidth=S.COLLAPSED_WIDTH;this._iHeight=S.COLLAPSED_HEIGHT;this._oActionButtons={};this._clearChildren();this._bIsHidden=false;};G.prototype._afterRendering=function(){this._setupEvents();if(!this._isVisible()){this.$().hide();}this._removeFromInvalidatedControls();};G.prototype._renderTopGroup=function(o){var h="",i=this._getElementId(o.idSufix),d=this._iTopGroupIndex===0;var s=this.getIcon(),t=this.getTitle();var x=this._iTopGroupIndex*50;if(this.getParent()._bIsRtl){d=!d;x=d?0:50;}if(d){h+="<div class=\"sapSuiteUiCommonsNetworkTopGroupDelimiter\"></div>";}h+=this._renderHtmlElement("div",{top:0,left:x+"%",width:"50%",height:"32px"},{id:i,"data-sap-ui":i,"class":"sapSuiteUiCommonsNetworkTopGroup "+(!d?"sapSuiteUiCommonsNetworkTopGroupRight":"")});h+="<div class=\"sapSuiteUiCommonsNetworkTopGroupHeader\">";if(s){h+=this._renderHtmlIcon(s);}if(t){h+="<div class=\"sapSuiteUiCommonsNetworkGroupHeaderTitle\">"+e(t)+" </div>";}h+="</div>";h+="</div>";return h;};G.prototype._render=function(o){var p=this.getParent(),h=!this.getCollapsed()||this._isCollapsedSwimLane()?this._iHeight:S.HEADER_SIZE,i;o=o||{};if(this._iNestedLevel===0&&p._isTwoColumnsLayout()){o.renderManager.unsafeHtml(this._renderTopGroup(o));return"";}if(this._isIgnored()||!this.getVisible()){return"";}if(this.getParent()._isLayered()){i=this._getElementId(o.idSufix);var s=this._convertToStyle({top:this.getY()+"px",left:this.getX()+"px",width:this._iWidth+"px",height:h+"px"},this._getStatusStyle({"border-color":E.ColorType.Border,"border-width":E.ColorType.BorderWidth,"border-style":E.ColorType.BorderStyle}),true);this._renderHtmlElement("div",{},{id:i,"data-sap-ui":i,"class":this._getGroupClass(),"style":s},o.renderManager);this._renderHeader(o);o.renderManager.close("div");}};G.prototype._renderHeader=function(o){var i=this.getIcon(),t=this.getTitle();var s="",B="",d="",f;if(this.getStatus()&&this.getStatus()!==a.Standard){d=this._getStatusStyle({"color":E.ColorType.Content},true);f=this._getStatusStyle({"color":E.ColorType.Content},false);if(this._bIsSwimLane){s=this._getStatusStyle({"background-color":E.ColorType.Background},false);}else{B=this._getStatusStyle({"background-color":E.ColorType.Background,"border-color":E.ColorType.Background},false);}}o.renderManager.openStart("div");this.applyStyles(o.renderManager,this.getStyleObject(B));o.renderManager.class("sapSuiteUiCommonsNetworkGroupHeader").openEnd();if(this._bIsSwimLane&&(s||this._hasDefaultStatus())){o.renderManager.openStart("div").class("sapSuiteUiCommonsNetworkGroupHeaderStatus").openEnd();this.applyStyles(o.renderManager,this.getStyleObject(s));o.renderManager.close("div");}o.renderManager.openStart("div").class("sapSuiteUiCommonsNetworkGroupHeaderInner").class("sapSuiteUiCommonsNetworkGroupHeaderInnerText").openEnd();if(this._showHeaderCheckBox()){this._renderClonedControl(o,this._getHeaderCheckbox());}if(i){o.renderManager.unsafeHtml(this._renderHtmlIcon(i,"sapSuiteUiCommonsNetworkGroupHeaderIcon",null,d));}if(t){o.renderManager.openStart("div").class("sapSuiteUiCommonsNetworkGroupHeaderTitle");this.applyStyles(o.renderManager,this.getStyleObject(f));o.renderManager.openEnd();o.renderManager.text(t);o.renderManager.close("div");}o.renderManager.close("div");o.renderManager.openStart("div").class("sapSuiteUiCommonsNetworkGroupHeaderInner").class("sapSuiteUiCommonsNetworkGroupHeaderInnerIcons").openEnd();o.renderManager.unsafeHtml(this._renderHtmlIcon(this.getCollapsed()?b:c,"sapSuiteUiCommonsNetworkGroupHeaderMenuIcon","collapse",d,r.getText("NETWORK_GRAPH_EXPAND_COLLAPSE")));o.renderManager.unsafeHtml(this._renderHtmlIcon(M,"sapSuiteUiCommonsNetworkGroupHeaderMenuIcon","menu",d,r.getText("NETWORK_GRAPH_GROUP_DETAILS")));o.renderManager.close("div");o.renderManager.close("div");};G.prototype._getGroupClass=function(){return"sapSuiteUiCommonsNetworkGroup "+this._getStatusClass()+(this.getCollapsed()?"sapSuiteUiCommonsNetworkGroupCollapsed":"sapSuiteUiCommonsNetworkGroupExpanded")+(this._bIsSwimLane?" sapSuiteUiCommonsNetworkGroupSwimLane":" sapSuiteUiCommonsNetworkGroupClassic")+(this._isVerticalSwimLane()?" sapSuiteUiCommonsNetworkGroupVerticalSwimLane":"")+(this._isTopBottom()?" sapSuiteUiCommonsNetworkGroupTopBottom ":"");};G.prototype.getChildNodes=function(){this._checkForProcessData();return this.aChildren;};G.prototype.getChildLines=function(){this._checkForProcessData();return this.aLines;};G.prototype.getParentNodes=function(){this._checkForProcessData();return this.aParents;};G.prototype.getParentLines=function(){this._checkForProcessData();return this.aParentLines;};G.prototype.getNodes=function(){this._checkForProcessData();return this.aNodes;};G.prototype.isHidden=function(){return this._bIsHidden;};G.prototype.setHidden=function(v){this.$()[v?"hide":"show"]();this._bIsHidden=v;};G.prototype.getHeaderCheckbox=function(){return this._getHeaderCheckbox();};G.prototype._getHeaderCheckbox=function(){var o=this.getAggregation("_checkBox"),t=this;if(!o){o=new C(this.getId()+"-checkbox",{select:function(d){var s=o.getSelected();t.fireHeaderCheckBoxPress({checked:s});}}).addStyleClass("sapSuiteUiCommonsNetworkGraphHeaderCheckboxInner");this.setAggregation("_checkBox",o,true);}return o;};G.prototype._isCollapsedSwimLane=function(){return this._bIsSwimLane&&this.getCollapsed();};G.prototype._clearChildren=function(){this.aNodes=[];this.aLines=[];this.aChildren=[];this.aParentLines=[];this.aParents=[];this.aChildGroups=[];};G.prototype._hasVisibleNodes=function(g){var v=this.aNodes.some(function(n){return!n._bIsHidden;});if(!v){for(var i=0;i<this.aChildGroups.length;i++){if(this.aChildGroups[i]._hasVisibleNodes()){return true;}}}return v;};G.prototype._hasNodes=function(){var n=this.aNodes.some(function(N){return N._useInLayout();});if(!n){n=this.aChildGroups.some(function(g){return g._hasNodes();});}return n;};G.prototype._hideShow=function(d){this.$()[d?"hide":"show"]();this._bIsHidden=d;var p=this._oParentGroup;while(p){var h=p._hasVisibleNodes();if((h&&!d)||(!h&&d)){p._hideShow(d);}else{break;}p=p._oParentGroup;}};G.prototype._setButtonFocus=function($,f){var F=f?"addClass":"removeClass";$[F]("sapSuiteUiCommonsNetworkElementFocus");};G.prototype._setMenuButtonFocus=function(f){this._setButtonFocus(q(this._oActionButtons.menu),f);};G.prototype._setCollapseButtonFocus=function(f){this._setButtonFocus(q(this._oActionButtons.collapse),f);};G.prototype._setupEvents=function(){var $=this.$("menu"),d=this.$("header"),f=this.$("collapse"),g=this.$().find(".sapSuiteUiCommonsNetworkGroupHeaderMenuIcon");this._oActionButtons.menu=$[0];this._oActionButtons.collapse=f[0];f.unbind("click");$.unbind("click");d.unbind("click");g.unbind("mouseover");g.unbind("mouseout");$.click(function(o){this._setMenuButtonFocus(true);var h=this.fireEvent("showDetail",{},true);if(h){this._openDetail();}if(this.getParent()){this.getParent().setFocus({item:this,button:G.BUTTONS.MENU});}}.bind(this));f.click(function(o){this._collapse();if(this.getParent()){this.getParent().setFocus({item:this,button:G.BUTTONS.COLLAPSE});}}.bind(this));d.click(function(o){if(this.getParent()){this.getParent().setFocus({item:this});}this.firePress();}.bind(this));var p=function(h,B,s){if(!this._bIsSwimLane){h.css("background-color",this._getColor(B));}h.css("color",this._getColor(s));}.bind(this);g.mouseover(function(o){p(q(o.currentTarget),E.ColorType.HoverBackground,E.ColorType.HoverContent);});g.mouseout(function(o){p(q(o.currentTarget),E.ColorType.Background,E.ColorType.Content);});};G.prototype._collapse=function(){this.getParent()._selectElementAfterScroll=this;this.fireEvent("collapseExpand",{},true);this.setCollapsed(!this.getCollapsed());};G.prototype._openDetail=function(){var $=this.$("menu");this.getParent()._tooltip.openDetail({item:this,opener:$[0]});};G.prototype._isEmpty=function(){return this.aNodes.length===0;};G.prototype._isIgnored=function(){if(!this._useInLayout()){return true;}return!this._hasNodes();};G.prototype._isVisible=function(){var d=this._bIsSwimLane||this.aNodes.some(function(n){return!n.isHidden();});if(!d){d=this.aChildGroups.some(function(g){return g._isVisible();});}return d;};G.prototype._useInLayout=function(){return!this._oCollapsedByParent;};G.prototype._resetSize=function(){if(this.getCollapsed()){this._iHeight=S.COLLAPSED_HEIGHT;this._iWidth=S.COLLAPSED_WIDTH;}};G.prototype._getAccessibilityLabel=function(){return r.getText("NETWORK_GRAPH_GROUP")+" "+this.getTitle();};G.prototype._isTopBottom=function(){var p=this.getParent();return p&&p._isTopBottom();};G.prototype._isVerticalSwimLane=function(){if(this._bIsSwimLane){var t=this._isTopBottom();return(t&&!this.getCollapsed())||(!t&&this.getCollapsed());}return false;};G.prototype._isCollapsed=function(){return this.getCollapsed()||!!this._oCollapsedByParent;};E.prototype._showHeaderCheckBox=function(){return this.getHeaderCheckBoxState()!==H.Hidden;};G.prototype._getBorderSize=function(){return 1;};G.prototype._setFocus=function(f){this._setMenuButtonFocus(f);};G.prototype._isOnScreen=function(L,R,t,B){var x=this.getX(),y=this.getY();return E._isRectOnScreen(x,x+this._iWidth,y,y+this._iHeight,L,R,t,B);};G.prototype.getHeaderCheckBoxState=function(){if(this.getProperty("headerCheckBoxState")===H.Hidden){return H.Hidden;}return this.getHeaderCheckbox().getSelected()?H.Checked:H.Unchecked;};G.prototype.setHeaderCheckBoxState=function(v){this._setHeaderCheckBoxState(v);return this;};G.prototype.setX=function(x){this.fX=x;return this;};G.prototype.getX=function(){return this.fX;};G.prototype.setY=function(y){this.fY=y;return this;};G.prototype.getY=function(){return this.fY;};G.prototype._setCollapsed=function(d,f){var t=this;var p=this.getParent(),i=[];var g=function(o){o.aChildGroups.forEach(function(h){g(h);});if(t!==o){if(!o._oCollapsedByParent||o._oCollapsedByParent===t){o._oCollapsedByParent=d?t:null;}}};var P=function(o){if(d){this.getNodes().forEach(function(n){if(n.getSelected()){n.setSelected(false);i.push(n);}});this.getChildLines().forEach(function(L){if(L.getSelected()&&L._isInCollapsedGroup()){L.setSelected(false);i.push(L);}});}}.bind(this);if(d!==this.getCollapsed()||f){this.setProperty("collapsed",d,true);if(d){this.getNodes().forEach(function(n){if(n.getSelected()){n.setSelected(false);i.push(n);}});this.getChildLines().forEach(function(L){if(L.getSelected()&&L._isInCollapsedGroup()){L.setSelected(false);i.push(L);}});}this.aChildGroups.forEach(function(o){P(o);});g(this);if(p&&i.length>0){p.fireSelectionChange({items:i});}if(p&&p._bIsLayedOut){p.invalidate();}}};G.prototype.setCollapsed=function(d){this._setCollapsed(d,false);return this;};G.prototype.setVisible=function(v){this.setProperty("visible",v);var p=this.getParent();if(p&&p._bIsLayedOut&&!this.getCollapsed()){this.aNodes.forEach(function(n){if(!v){n.$().hide();}else if(!n._bIsHidden){n.$().show();}});}return this;};return G;});
