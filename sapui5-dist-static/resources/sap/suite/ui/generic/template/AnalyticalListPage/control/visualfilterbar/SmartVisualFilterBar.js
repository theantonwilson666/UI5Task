sap.ui.define(["sap/m/HeaderContainer","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterDialogController","sap/ui/comp/odata/ODataModelUtil","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/VisualFilterProvider","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/comp/smartvariants/SmartVariantManagement","sap/ui/model/Filter","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/ui/comp/odata/MetadataAnalyser","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms","sap/m/VBox","sap/m/Button","sap/m/Title","sap/suite/ui/generic/template/AnalyticalListPage/controller/DropDownController","sap/suite/ui/generic/template/AnalyticalListPage/controller/DatePickerController","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroBar","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroLine","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroDonut","sap/ui/model/json/JSONModel","sap/ui/core/CustomData","sap/m/Text","sap/m/OverflowToolbarLayoutData","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/model/SimpleType","sap/ui/core/library","sap/m/library","sap/m/DatePicker","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/core/InvisibleText","sap/suite/ui/generic/template/js/StableIdHelper","sap/base/util/deepExtend"],function(H,V,O,a,P,S,F,b,T,M,c,d,f,B,g,D,h,k,l,m,J,C,n,o,p,q,r,s,t,u,v,I,w,x){"use strict";var L=new v("AnalyticalListPage.visualfilterbar.SmartVisualFilterBar").getLogger();var y="Donut";var z="Line";var A="Bar";var E=r.extend("sap.ui.model.DimensionFilterType",{formatValue:function(e){return e;},parseValue:function(e){return e;},validateValue:function(e){}});var G=H.extend("sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.SmartVisualFilterBar",{metadata:{designTime:true,properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},config:{type:"object",group:"Misc",defaultValue:null},persistencyKey:{type:"string",group:"Misc",defaultValue:null},lazyLoadVisualFilter:{type:"boolean",group:"Misc",defaultValue:true},displayCurrency:{type:"string",group:"Misc",defaultValue:null},smartFilterId:{type:"string",group:"Misc",defaultValue:null},allFiltersAsInParameters:{type:"boolean",group:"Misc",defaultValue:true}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},events:{filterChange:{},Initialized:{},onFilterItemAdded:{}}},renderer:{}});G.prototype.init=function(){if(H.prototype.init){H.prototype.init.apply(this,arguments);}var i=document.body.classList.contains("sapUiSizeCozy");this._cellItemHeightNorth=i?"3rem":"2rem";this._cellItemHeightSouth=i?"9.9rem":"7.5rem";q.system.phone?this._cellItemHeightSouth="9rem":"";this._cellHeight=i?"12rem":"11rem";this._cellWidth="20rem";this.labelHeight=2.0;this.compHeight=i?9.9:7.9;this.cellHeightPadding=1;this.cellHeight=(this.labelHeight+this.compHeight+this.cellHeightPadding)+"rem";this.cellWidth=320;this._dialogFilters={};this._compactFilters={};this._oVariantConfig={};this._smartFilterContext;this._oMetadataAnalyser;this.setModel(new J(),'_visualFilterConfigModel');if(i){if(q.system.phone){this.setOrientation("Vertical");this.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterBarCozyPhone");}else{this.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterBarCozy");}}else{this.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterBar");}};G.prototype.propagateProperties=function(){H.prototype.propagateProperties.apply(this,arguments);this._initMetadata();};G.prototype._initMetadata=function(){if(!this.bIsInitialised){O.handleModelInit(this,this._onMetadataInit);}};G.prototype._onMetadataInit=function(){if(this._smartFilterContext.isInitialised()){this._initiateVisualFilterLoad();}else{this._smartFilterContext.attachInitialized(this._initiateVisualFilterLoad,this);}};G.prototype._initiateVisualFilterLoad=function(){if(this.bIsInitialised){return;}this._annoProvider=this._createVisualFilterProvider();if(!this._annoProvider){return;}this._oMetadataAnalyser=this._annoProvider.getMetadataAnalyser();this.bIsInitialised=true;this._updateFilterBar();};G.prototype._createVisualFilterProvider=function(){var e=this.getModel();var i=this.getEntitySet();if(!e||!i){return null;}return new a(this);};G.prototype._getBasicGroupTitle=function(){return this.getModel("i18n").getResourceBundle().getText("VIS_FILTER_GRP_BASIC_TITLE");};G.prototype._getFieldGroupForProperty=function(e,i){return this._annoProvider?this._annoProvider._getFieldGroupForProperty(e,i):undefined;};G.prototype._getGroupList=function(){return this._annoProvider?this._annoProvider.getGroupList():[];};G.prototype._getGroupMap=function(){return this._annoProvider?this._annoProvider.getGroupMap():{};};G.prototype._getMeasureMap=function(){return this._annoProvider?this._annoProvider.getMeasureMap():{};};G.prototype._getDimensionMap=function(){return this._annoProvider?this._annoProvider.getDimensionMap():{};};G.prototype.setSmartFilterContext=function(e){this._smartFilterContext=e;};G.prototype._updateFilterBar=function(){var e=this._getAnnotationSettings();if(e&&e.filterList){var i=this._convertSettingsToConfig(e);}else{i={filterCompList:[]};this.getModel('_visualFilterConfigModel').setData(i);return;}var j=this._getVariantConfig();if(j&&j.config){i.filterCompList.forEach(function(K){if(j.config[K.component.properties.parentProperty]){x(K,j.config[K.component.properties.parentProperty]);}});this._oVariantConfig=i;}this.unbindAggregation('content',true);this.getModel('_visualFilterConfigModel').setData(i);this.bindAggregation('content',{path:"_visualFilterConfigModel>/filterCompList",factory:function(K,N){var Q=N.getProperty('component'),R=Q?Q.properties:undefined,U=this._resolveChartType(Q?Q.type:undefined);return this._createHeaderItems(N.sPath,U,R);}.bind(this),filters:new F("shownInFilterBar",p.EQ,true)});this.attachBrowserEvent("keyup",c.onKeyUpVisualFilter.bind(c));this.attachBrowserEvent("keydown",c.onKeyDownVisualFilter.bind(c,this._smartFilterContext));this.fireInitialized();};G.prototype._createHeaderItems=function(j,K,N){var Q=this._createFilterItemOfType(K,N,true);Q.data("isDialogFilterItem","false");var R=N.selectFilters&&N.selectFilters.SelectOptions,U=Q.getInParameters(),W=[],X=this;if(U&&U.length>0){U.forEach(function(e){W.push({path:'_filter>/'+e.localDataProperty});});}Q.addCustomData(new C({key:'sPath',value:j}));if(N.stringdate){Q.addCustomData(new C({key:'stringdate',value:N.stringdate}));}if(X.getEntitySet()===Q.getEntitySet()){var Y=X._smartFilterContext.determineMandatoryFilterItems();if(Y&&Y.length>0){Y.forEach(function(e){if(!e.data("isCustomField")){W.push({path:'_filter>/'+e.getName()});}});}}Q.bindProperty('dimensionFilter',{path:'_filter>/'+Q.getParentProperty(),type:new E()});Q.bindProperty('measureField',{path:'_visualFilterConfigModel>'+j+'/component/properties/measureField'});Q.bindProperty('sortOrder',{path:'_visualFilterConfigModel>'+j+'/component/properties/sortOrder'});Q.bindProperty('unitField',{path:'_visualFilterConfigModel>'+j+'/component/properties/measureField',formatter:function(){var e=X._getMeasureMap();var h1=e[this.getEntitySet()][this.getMeasureField()];return h1?h1.fieldInfo.unit:"";}});if(W&&W.length>0){Q.bindProperty('dimensionFilterExternal',{parts:W,formatter:function(){var U=this.getInParameters()||[];var d1=this.getParentProperty();var h1,i1;if(X.getEntitySet()===this.getEntitySet()){var Y=X._smartFilterContext.determineMandatoryFilterItems();Y.forEach(function(x1){var y1=x1.getName();var z1=U&&U.some(function(e){return e.localDataProperty===y1;});if(y1.indexOf("$Parameter")===-1&&!z1){U.push({localDataProperty:y1,valueListProperty:y1});}});}if(!(X.getEntitySet()===this.getEntitySet()&&X._smartFilterContext.getAnalyticBindingPath()!=="")&&(X._smartFilterContext.getAnalyticBindingPath()===""||X._smartFilterContext.getAnalyticBindingPath().indexOf("P_DisplayCurrency")!=-1)){var j1=this.getMeasureField();var k1=X.getModel();var l1=k1.getMetaModel();var m1=l1.getODataEntityType(X._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.getEntitySet()));var n1=l1.getODataEntitySet(this.getEntitySet());var o1=l1.getODataProperty(m1,j1);var p1=X.getProperty("displayCurrency");var q1=o1&&o1[d.ISOCurrency];if(p1&&q1){var r1=q1.Path;for(var s1=(U.length-1);s1>-1;s1--){var t1=U[s1].valueListProperty;var u1=U[s1].localDataProperty;if(t1===r1){var v1=X._smartFilterContext.getFilterData();if(!v1[u1]){i1=l1.getODataProperty(m1,r1);var w1=i1&&c.isPropertyNonFilterable(n1,i1.name);if(!w1){h1=new F({aFilters:[new F({path:r1,operator:"EQ",value1:p1,value2:undefined})],and:false});}}break;}}}}if(this._chart instanceof sap.suite.ui.microchart.InteractiveDonutChart){this._inParameterFilterList=new F({aFilters:[],bAnd:true});}return X._getFiltersForFilterItem(U,d1,h1,r1,R,this._inParameterFilterList);}});}else if(R&&R.length>0){var Z=new F({aFilters:[],bAnd:true});for(var i in R){var $=R[i];Z=this.fnAddSelectOptionsToFilters($,Z);}Q.setProperty('dimensionFilterExternal',Z);}if(Q.attachFilterChange){Q.attachFilterChange(this._onFilterChange,this);}if(Q.attachTitleChange){Q.attachTitleChange(this._onTitleChange,this);}var _=this._createTitleToolbar(N,Q),a1=new f({height:this._cellItemHeightNorth,items:[_]});var b1=new f({width:"100%",height:this._cellItemHeightSouth,items:[new n({width:this.cellWidth+"px",textAlign:s.TextAlign.Center,text:{path:'_visualFilterConfigModel>'+j+'/overlayMessage',formatter:function(e){return e&&this.getModel("i18n").getResourceBundle().getText(e);}}})],visible:{path:'_visualFilterConfigModel>'+j+'/showChartOverlay',formatter:function(e){return e;}}});b1.addStyleClass("sapUiOverlay");b1.addStyleClass("sapSmartTemplatesAnalyticalListPageVFOverflow");b1.addStyleClass("sapSmartTemplatesAnalyticalListPageVFOverflowCozy");var c1=new f({height:this._cellItemHeightSouth,items:[Q],visible:{path:"_visualFilterConfigModel>"+j+"/showChartOverlay",formatter:function(e){return!e;}}});var d1=Q.getParentProperty();if(N.isParameter){d1=c.getParameter(d1);}var e1="visualFilterBarInvisibleText"+d1;e1=this.getView().sId+"--"+e1;var f1=new I({id:e1});if(this.getAriaLabelledBy().indexOf(e1)===-1){this.addAriaLabelledBy(e1);}e1=this.getView().sId+"--"+w.getStableId({type:"VisualFilterBar",subType:"FilterItemContainer",sProperty:d1});var g1=new f({id:e1,fieldGroupIds:["headerBar"],height:this._cellHeight,width:(this.cellWidth+16)+"px",items:[a1,b1,c1,f1]});a1.addStyleClass("sapSmartTemplatesAnalyticalListPageVFTitle");b1.addStyleClass("sapSmartTemplatesAnalyticalListPageVFChart");c1.addStyleClass("sapSmartTemplatesAnalyticalListPageVFChart");this.fireOnFilterItemAdded(Q);return g1;};G.prototype.fnAddSelectOptionsToFilters=function(e,i){var j=new F({aFilters:[],bAnd:false});var K=this,N=e.PropertyName&&e.PropertyName.PropertyPath;e.Ranges.forEach(function(R){var Q=R.Low&&R.Low.String,U=R.Sign&&R.Sign.EnumMember&&R.Sign.EnumMember.split("/")[1],W=R.Option&&R.Option.EnumMember&&R.Option.EnumMember.split("/")[1],X=R.High&&R.High.String;var Y=K._getSelectOptionFilters(N,Q,X,W,U);j.aFilters.push(Y);});i.aFilters.push(j);return i;};G.prototype._getAnnotationSettings=function(){return this._annoProvider?this._annoProvider.getVisualFilterConfig():null;};G.prototype._convertSettingsToConfig=function(e,K){var N={filterCompList:[]};var Q=this._getGroupList();var R={};for(var i=0;i<Q.length;i++){var U=Q[i];for(var j=0;j<U.fieldList.length;j++){var W=U.fieldList[j];R[W.name]={name:U.name,label:U.label};}}var X=this._getGroupMap();var Y=X["_BASIC"];var Z=[];if(Y&&Y.fieldList){for(var i=0;i<Y.fieldList.length;i++){Z.push(Y.fieldList[i].name);}}var $=this._getMeasureMap(),_=e.filterList,a1={};for(var i=0;i<_.length;i++){var b1=_[i];var c1=b1.dimension.field;var d1=$[b1.collectionPath][b1.measure.field];var e1=false;if(d1.fieldInfo[d.ISOCurrency]){e1=true;}var f1={shownInFilterBar:b1.selected,component:{type:b1.type,properties:{sortOrder:b1.sortOrder,measureField:b1.measure.field,parentProperty:b1.parentProperty?b1.parentProperty:undefined}}};if(b1.stringdate){f1.component.properties.stringdate=b1.stringdate;}if(!K){var g1={shownInFilterDialog:b1.selected||Z.indexOf(c1)!=-1,group:R[b1.parentProperty],component:{properties:{selectFilters:b1.selectionVariant?b1.selectionVariant:undefined,scaleFactor:b1.scaleFactor,numberOfFractionalDigits:b1.numberOfFractionalDigits,filterRestriction:b1.filterRestriction,lazyLoadVisualFilter:this.getLazyLoadVisualFilter(),width:this.cellWidth+"px",height:this.compHeight+"rem",entitySet:b1.collectionPath?b1.collectionPath:this.getEntitySet(),dimensionField:c1,dimensionFieldDisplay:b1.dimension.fieldDisplay,dimensionFilter:b1.dimensionFilter,unitField:d1?d1.fieldInfo.unit:"",isCurrency:e1,isParameter:b1.isParameter,isDropDown:b1.isDropDown,isMandatory:b1.isMandatory,outParameter:b1.outParameter?b1.outParameter:undefined,inParameters:b1.inParameters?b1.inParameters:undefined,textArrangement:b1.displayBehaviour,chartQualifier:b1.chartQualifier?b1.chartQualifier:undefined,dimensionFieldIsDateTime:b1.dimensionFieldIsDateTime,dimensionFieldIsDateTimeOffset:b1.dimensionFieldIsDateTimeOffset}}};x(f1,g1);N.filterCompList.push(f1);}else{a1[b1.parentProperty]=f1;}}return K?a1:N;};G.prototype._setVariantModified=function(){if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true);}};G.prototype._checkMandatoryFilters=function(){var e=this._smartFilterContext.getFilterData();var j=this._smartFilterContext.determineMandatoryFilterItems();var K=false;for(var i=0;i<j.length;i++){if(e[j[i].getName()]===undefined){if(e._CUSTOM["sap.suite.ui.generic.template.customData"][j[i].getName()]===undefined){K=true;break;}}}if(K){this._smartFilterContext.showAdaptFilterDialog("group");}};G.prototype._onFilterChange=function(e){this._setVariantModified();this.fireFilterChange();this._checkMandatoryFilters();};G.prototype._getFiltersForFilterItem=function(e,j,K,N,Q,R){var U={},W=[],X=[],Y=new F({aFilters:[],bAnd:true});if(e&&e.length>0){var Z=function(f1){f1.sPath=a1;};for(var $=(e.length-1);$>-1;$--){var _=e[$].localDataProperty,a1=e[$].valueListProperty;if(Q){for(var i=0;i<Q.length;i++){var b1=Q[i];var c1=b1.PropertyName&&b1.PropertyName.PropertyPath;if(X.indexOf(c1)===-1){if(c1===j){Y=this.fnAddSelectOptionsToFilters(b1,Y);X.push(c1);}else{var d1=this._smartFilterContext.determineFilterItemByName(c1);if(d1&&(d1.getVisibleInFilterBar()||d1.getPartOfCurrentVariant())){var e1=this._smartFilterContext.getFilters([c1]);if((e1&&e1.length)||(W.indexOf(c1)!==-1)){continue;}else{Y=this.fnAddSelectOptionsToFilters(b1,Y);X.push(c1);}}else{Y=this.fnAddSelectOptionsToFilters(b1,Y);X.push(c1);}}}}}if(_!==j&&W.indexOf(_)===-1){var d1=this._smartFilterContext.determineFilterItemByName(_);if(d1&&(d1.getVisibleInFilterBar()||d1.getPartOfCurrentVariant())){U=this._smartFilterContext.getFilters([_]);if(U&&U.length>0){if(U[0].aFilters){U[0].aFilters.forEach(Z.bind(this));}else{Z(U[0]);}W.push(_);Y.aFilters.push(U[0]);if(R){R.aFilters.push(U[0]);}}}}}if(K){Y.aFilters.push(K);}}else{if(Q&&Q.length){for(var i=0;i<Q.length;i++){var b1=Q[i];Y=this.fnAddSelectOptionsToFilters(b1,Y);}}}return Y;};G.prototype._getSelectOptionFilters=function(e,i,j,K,N){if(N==="E"){if(K!==p.EQ){L.error("Exclude sign is supported only with EQ operator");return;}else{K=p.NE;N="I";}}if(K==="CP"){K=p.Contains;if(i.indexOf("*")!==-1){var Q=i.indexOf('*');var R=i.lastIndexOf('*');if(Q>-1){if((Q===0)&&(R!==(i.length-1))){K=p.EndsWith;i=i.substring(1,i.length);}else if((Q!==0)&&(R===(i.length-1))){K=p.StartsWith;i=i.substring(0,i.length-1);}else{i=i.substring(1,i.length-1);}}}}var U=new F({path:e,sign:N,operator:K,value1:i,value2:j});return U;};G.prototype._createTitleToolbar=function(e,i){var j=this.getModel("@i18n");var K=i.getTitle(j);var N=new g({text:K.titleMD,titleStyle:s.TitleLevel.H6});if(i.getProperty("isMandatory")){N.addStyleClass("sapSmartTemplatesAnalyticalListPageRequired");}var Q=new g({text:K.titleUnitCurr.length>1?"| "+K.titleUnitCurr:"",titleStyle:s.TitleLevel.H6,width:"4.15rem"});N.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterTitleText");Q.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterTitleText");var R=this._smartFilterContext.determineFilterItemByName(e.parentProperty).getControl();this._smartFilterContext.ensureLoadedValueHelp(e.parentProperty);if(R){var U=c.getPropertyNameDisplay(this.getModel(),i.getEntitySet(),i.getDimensionField(),j),W=this.getModel("i18n").getResourceBundle(),X=R.getShowValueHelp&&R.getShowValueHelp()&&!e.dimensionFieldIsDateTimeOffset,Y=R.getMetadata&&R.getMetadata().getName()==="sap.m.DateTimePicker",Z=R instanceof u,$=(Z&&!Y)?"sap-icon://appointment-2":"",_=(e.isDropDown)?"sap-icon://slim-arrow-down":"",a1=X?"sap-icon://value-help":$||_,b1,c1,d1;if(e.isParameter){c1=c.getParameter(i.getParentProperty());}else{c1=i.getParentProperty();}d1=this.getView().sId+"--"+w.getStableId({type:"VisualFilterBar",subType:"ValueHelpButton",sProperty:c1});var e1=new B({id:d1,text:{path:"_filter>/"+i.getParentProperty(),formatter:function(g1){var h1=i.getFilterRestriction();b1=0;if(g1){if(h1==='single'){b1=1;}else{if(typeof g1==="object"){if(g1.value){b1++;}if(g1.items&&g1.items.length){b1+=g1.items.length;}if(g1.ranges&&g1.ranges.length){b1+=g1.ranges.length;}}else{b1++;}}}return b1?"("+b1+")":"";}},icon:(X||e.isDropDown||Z)?a1:"",customData:[new C({key:'isF4Enabled',value:(X||e.isDropDown||Z)?true:false})],visible:{path:"_filter>/"+i.getParentProperty(),formatter:function(g1){if(X||e.isDropDown||(Z&&!Y)){return true;}else{if(!g1){return false;}if(typeof g1==="object"){if(g1 instanceof Date){return true;}return(g1.value||(g1.items&&g1.items.length)||(g1.ranges&&g1.ranges.length))?true:false;}return true;}}},enabled:{path:'_visualFilterConfigModel>'+i.data("sPath")+'/showChartOverlay',formatter:function(g1){return!g1;}},press:function(g1){if(X){if(R.getParent().getParent()===null){this._smartFilterContext.addAggregation('dependents',R.getParent());}R.fireValueHelpRequest.call(R);}else if(e.isDropDown){var h1=this._isDimensionFieldFilterable(this.getModel(),e.entitySet,e.dimensionField),i1=this.getModel("visualFilter")||this.getModel();D.createDropdown(g1.getSource(),i,i1,U,e,h1);}else if(Z&&!Y){h._createDatePicker(g1.getSource(),i);}else{V.launchAllFiltersPopup(e1,i,g1.getSource().getModel('i18n'));}}.bind(this),layoutData:new o({priority:t.OverflowToolbarPriority.NeverOverflow}),tooltip:{path:"_filter>/"+i.getParentProperty(),formatter:function(){return c.getTooltipForValueHelp(X,U,W,b1,Z);}},ariaHasPopup:s.aria.HasPopup.Dialog});}var f1=new b({design:t.ToolbarDesign.Transparent,width:this.cellWidth+"px",content:[N,Q,new T(),e1]});f1.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterTitleToolbar");return f1;};G.prototype._isDimensionFieldFilterable=function(e,i,j){var K=e.getMetaModel(),N=K.getODataEntitySet(i),Q=K.getODataEntityType(N.entityType),R=K.getODataProperty(Q,j);return(R["sap:filterable"]===undefined)?true:R["sap:filterable"];};G.prototype.getTitleByFilterItemConfig=function(e,i,j){var K=e.component.properties;var N=K.entitySet;var Q=this.getModel();var R=this.getModel("@i18n");if(!Q){return"";}var U=c.getPropertyNameDisplay(Q,N,K.measureField,R);var W=c.getPropertyNameDisplay(Q,N,K.dimensionField,R);if(!i){i="";}if(!j){j="";}var X=this.getModel("i18n").getResourceBundle();var Y=X.getText("VIS_FILTER_TITLE_MD",[U,W]);var Z=j+" "+i;Z=Z.trim();var $={titleMD:Y,titleUnitCurr:Z};return $;};G.prototype._updateVisualFilterAria=function(e,i,j){var K=e.getItems();var R=this.getModel("i18n").getResourceBundle();var N=R.getText("VIS_FILTER_ITEM_ARIA");var Q=K[0].getItems()[0].getContent()[0];var U=K[0].getItems()[0].getContent()[1];N+=" "+(U.getText().length>0?Q.getText()+U.getText():Q.getText());if(i.getProperty("isMandatory")){N+=" "+R.getText("VIS_FILTER_MANDATORY_PROPERTY_ARIA_LABEL");}if(j==="true"){N+=" "+K[1].getItems()[0].getText();N+=" "+R.getText("VIS_FILTER_BAR_NAVIGATE_ARIA");}else{N+=" "+R.getText("VIS_FILTER_BAR_NAVIGATE_ARIA")+" "+R.getText("VIS_FILTER_ACCESS_FIELDS_ARIA");}K[K.length-1].setText(N);};G.prototype._onTitleChange=function(e){var i=e.getSource().getParent().getParent();var j=i.getItems()[i.getItems().length-2].getItems()[0];if(j.data("sOverlay")!=="true"){var K=i.getItems()[0].getItems()[0].getContent()[0];var N=i.getItems()[0].getItems()[0].getContent()[1];var Q=this.getModel("i18n");var R=this.getModel("@i18n");if(!Q){return"";}var U=Q.getResourceBundle();if(e.getSource().getProperty("isMandatory")){K.addStyleClass("sapSmartTemplatesAnalyticalListPageRequired");}var W=e.getSource().getTitle(R);K.setText(W.titleMD);var X=W.titleUnitCurr==""?W.titleQuickInfo||W.titleMD:U.getText("VIS_FILTER_TITLE_MD_WITH_UNIT_CURR",[W.titleQuickInfo||W.titleMD,W.titleUnitCurr]);K.setTooltip(X);N.setText(W.titleUnitCurr.length>0?"| "+W.titleUnitCurr:"");N.setTooltip("");var Y=W.titleUnitCurr.split(" ");if(W.titleUnitCurr==""){N.setVisible(false);}else{N.setVisible(true);var Z=Y.length>1?"4.15rem":"2.4rem";N.setWidth(Z);}}this._updateVisualFilterAria(i,j,j.data("sOverlay"));};G.prototype._getSupportedFilterItemList=function(){if(!this._supportedFilterItemList){this._supportedFilterItemList=[{type:"Bar",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroBar",iconLink:"sap-icon://horizontal-bar-chart",textKey:"VISUAL_FILTER_CHART_TYPE_BAR"},{type:"Donut",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroDonut",iconLink:"sap-icon://donut-chart",textKey:"VISUAL_FILTER_CHART_TYPE_Donut"},{type:"Line",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroLine",iconLink:"sap-icon://line-charts",textKey:"VISUAL_FILTER_CHART_TYPE_Line"}];}return this._supportedFilterItemList;};G.prototype._getSupportedFilterItemMap=function(){if(!this._supportedFilterItemMap){this._supportedFilterItemMap={};var e=this._getSupportedFilterItemList();for(var i=0;i<e.length;i++){var j=e[i];this._supportedFilterItemMap[j.type]=j;}}return this._supportedFilterItemMap;};G.prototype._resolveChartType=function(e){var i=this._getSupportedFilterItemMap();var j=i[e];if(!j){var K;for(K in i){j=i[K];break;}L.error("Could not resolve the filter component type: \""+e+"\", falling back to "+K);e=K;}return e;};G.prototype._createFilterItemOfType=function(e,i,j){var K;var N=w.getStableId({type:(j?"VisualFilterBar":"VisualFilterDialog"),subType:"FilterItemMicroChart",sProperty:i.parentProperty});N=this.getView().sId+"--"+N;if(e===A){K=new k(N,i);}else if(e===z){K=new l(N,i);}else if(e===y){K=new m(N,i);}K.setSmartFilterId(this.getSmartFilterId());K.setModel(this.getModel('i18n'),'i18n');K.setModel(this.getModel("_templPriv"),"_templPriv");if(!this._smartFilterContext.isDialogOpen()){K.setModel(this.getModel('_filter'),'_filter');K.setModel(this.getModel('_visualFilterConfigModel'),"_visualFilterConfigModel");}K.setModel(this.getModel());var Q=this.getModel("visualFilter");if(Q){K.setModel(Q,"visualFilter");}return K;};G.prototype.getConfig=function(e){var j=this.getModel('_visualFilterConfigModel').getData(),K={};if(!j){return{filterCompList:[]};}var N=0;var Q=sap.ui.getCore().byFieldGroupId("headerBar");for(var i=0;i<j.filterCompList.length;i++){var R=j.filterCompList[i];if(e){K[R.component.properties.parentProperty]={shownInFilterBar:R.shownInFilterBar,shownInFilterDialog:R.shownInFilterDialog,component:{type:R.component.type,properties:{measureField:R.component.properties.measureField,sortOrder:R.component.properties.sortOrder,parentProperty:R.component.properties.parentProperty}}};}else{if(!R.shownInFilterBar){continue;}var U=Q[N];if(!U){L.error("The configured selected filter bar items do not correspond to the actual filter bar items.  Could be an error during initialization, e.g. a chart class not found");return{filterCompList:[]};}N++;if(U._chart){var W=U;R.component.properties=W.getP13NConfig();}}}return e?K:j;};G.prototype.setSmartVariant=function(e){this.setAssociation("smartVariant",e);if(e){var i=new P({type:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.SmartVisualFilterBar",keyName:"persistencyKey"});i.setControl(this);}this._oVariantManagement=this._getVariantManagementControl(e);if(this._oVariantManagement){this._oVariantManagement.addPersonalizableControl(i);this._oVariantManagement.initialise(this._variantInitialised,this);this._oVariantManagement.attachSave(this._onVariantSave,this);}else if(e){if(typeof e==="string"){L.error("Variant with id="+e+" cannot be found");}else if(e instanceof sap.ui.core.Control){L.error("Variant with id="+e.getId()+" cannot be found");}}else{L.error("Missing SmartVariant");}};G.prototype._getVariantManagementControl=function(e){var i=null;if(e){i=typeof e=="string"?sap.ui.getCore().byId(e):e;if(i&&!(i instanceof S)){L.error("Control with the id="+e.getId?e.getId():e+" not of expected type");return null;}}return i;};G.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD";}};G.prototype._onVariantSave=function(){if(this._oCurrentVariant=="STANDARD"){this._oCurrentVariant={config:this.getConfig(true)};}};G.prototype.applyVariant=function(e,i){this._oCurrentVariant=e;if(this._oCurrentVariant=="STANDARD"){this._oCurrentVariant=null;}if(this._oCurrentVariant&&this._oCurrentVariant.config&&this._oCurrentVariant.config.filterCompList){this._oCurrentVariant.config=null;}if(this._oCurrentVariant&&this._oCurrentVariant.config==null){var j=this._getAnnotationSettings();if(j&&j.filterList){this._oCurrentVariant.config=this._convertSettingsToConfig(j,true);}}this._updateFilterBar();if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(false);}};G.prototype._getVariantConfig=function(){return this._oCurrentVariant;};G.prototype.fetchVariant=function(){if(!this._oCurrentVariant||this._oCurrentVariant=="STANDARD"){var e=this._getAnnotationSettings();if(e&&e.filterList){this._oCurrentVariant={config:this._convertSettingsToConfig(e,true)};return this._oCurrentVariant;}else{return{config:null};}}return{config:this.getConfig(true)};};G.prototype._getStandardVariantConfig=function(){var e=this._getAnnotationSettings();var i=this._convertSettingsToConfig(e);return i;};G.prototype.updateVisualFilterBindings=function(e,U){if(U){for(var i in this.filterChartList){var j=this.filterChartList[i];if(j._chart){j._updateBinding();j._bAllowBindingUpdateOnPropertyChange=e===true;}}}else{var K=sap.ui.getCore().byFieldGroupId("headerBar");for(var i=0;i<K.length;i++){if(K[i]._chart){K[i]._updateBinding();K[i]._bAllowBindingUpdateOnPropertyChange=e===true;}}}};G.prototype.getView=function(){if(!this._oView){var e=this.getParent();while(e){if(e instanceof sap.ui.core.mvc.View){this._oView=e;break;}e=e.getParent();}}return this._oView;};G.prototype.addVisualFiltersToBasicArea=function(e){var j=x({},this.getModel('_visualFilterConfigModel').getData()),K=(e&&e.constructor===Array&&e.length)?e.length:0,N=0;if(!j){L.error("Could not add filter to basic area. No config found!");return false;}else if(!K){L.error("Improper parameter passed. Pass an array of properties.");return false;}else{for(var i=0;i<j.filterCompList.length;i++){var Q=j.filterCompList[i];if(e.indexOf(c.readProperty(Q.component.properties.parentProperty))!==-1&&!Q.shownInFilterBar){Q.shownInFilterBar=true;Q.shownInFilterDialog=true;N++;}}if(N){this.getModel('_visualFilterConfigModel').setData(j);return true;}else{L.info("Filters already present in visual filter basic area");return false;}}};return G;},true);
