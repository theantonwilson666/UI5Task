sap.ui.define(["sap/m/SegmentedButtonItem","sap/m/Button","sap/m/Text","sap/m/Dialog","sap/m/SegmentedButton","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterDialogController","sap/ui/core/mvc/Controller","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/ui/Device","sap/suite/ui/generic/template/AnalyticalListPage/util/CommonUtil"],function(S,B,T,D,a,V,C,F,b,c){"use strict";var d="visual",e="compact",f="group",g="sap.suite.ui.generic.template.customData",h="sap.suite.ui.generic.template.genericData",j="sap.suite.ui.generic.template.extensionData";var k=C.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.FilterBarController",{init:function(s){this.compactFilterData={};var m=this;m.oState=s;var i;if(b.system.phone){i=true;}else{i=m.oState.oController.getOwnerComponent().getShowGoButtonOnFilterBar()?true:false;}s.oSmartFilterbar.setShowGoOnFB(i);s.oSmartFilterbar.setLiveMode(!i);if(s.oSmartTable){s.oSmartTable.setEnableAutoBinding(!i);}if(!i){m.oState.oSmartFilterbar._oFiltersButton.setVisible(false);}s.oHeader=s.oPage.getHeader();s.oTitle=s.oPage.getTitle();if(s.alr_visualFilterBar){s.alr_visualFilterBar.setSmartFilterContext(this.oState.oSmartFilterbar);s.alr_visualFilterBar.attachFilterChange(this._onVisualFilterChange.bind(this));}s.oSmartFilterbar.attachAfterVariantLoad(this._afterVariantLoad.bind(this));},_updateFilterLink:function(){var o=this._getFilterDataCount(),t=this.oState.oController.getOwnerComponent().getModel("_templPriv");t.setProperty('/alp/filtersLink',o);},_getFilterDataCount:function(){var i=this.oState.oSmartFilterbar.retrieveFiltersWithValues(),l=i.length,o=this.oState.oSmartFilterbar.getBasicSearchControl();if(o&&o.getValue&&o.getValue()){l++;}return l;},_afterVariantLoad:function(E){if(this.oState.alr_visualFilterBar&&E.mParameters.context!=="CANCEL"){var i=this.oState.oSmartFilterbar.isDialogOpen();if(i){this.oState.alr_visualFilterBar.updateVisualFilterBindings.apply(this.oState.visualFilterDialogContainer,[true,true]);}else{this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);}}if(this.oState.oSmartFilterbar.isLiveMode()&&E.mParameters.context!="INIT"){this.oState.oSmartFilterbar.search();}},_afterSFBVariantLoad:function(){var o=this.oState.oSmartFilterbar.getFilterData();if(o._CUSTOM!==undefined){this.oState.oIappStateHandler.fnRestoreFilterState(o._CUSTOM);}else{var i=this.oState.oIappStateHandler.getFilterState();c.nullify(i[g]);c.nullify(i[h]);c.nullify(i[j]);this.oState.oIappStateHandler.fnRestoreFilterState(i);}this.oState.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL();},_onVisualFilterChange:function(E){if(E.getParameter('propertyName')&&E.getParameter('bVisible')!==undefined){var o=this.oState.oSmartFilterbar.determineFilterItemByName(E.getParameter('propertyName'));if(E.getParameter('bVisible')){if(!o.getPartOfCurrentVariant()){o.setPartOfCurrentVariant(true);o.setVisibleInFilterBar(true);}}else{o.setPartOfCurrentVariant(false);o.setVisibleInFilterBar(false);}}var i=this.oState.oSmartFilterbar.isDialogOpen();if(i&&this.oState.visualFilterDialogContainer){var l=this.oState.visualFilterDialogContainer.oVerticalBox.getModel("_dialogFilter");var m=l.getData();if(this.oState.oSmartFilterbar.getFilterData()._CUSTOM!==undefined){m._CUSTOM=this.oState.oSmartFilterbar.getFilterData()._CUSTOM;}this.oState.oSmartFilterbar.setFilterData(m,true);}else{var n=this.oState.oController.getOwnerComponent().getModel("_filter");var p=n.getData();if(this.oState.oSmartFilterbar.getFilterData()._CUSTOM!==undefined){p._CUSTOM=this.oState.oSmartFilterbar.getFilterData()._CUSTOM;}this.oState.oSmartFilterbar.setFilterData(p,true);}if(this.oState.oSmartFilterbar.isLiveMode()){if(!i){this.oState.oSmartFilterbar.search();}else{this.oState.visualFilterDialogContainer.bSearchPendingAfterDialogFilterChange=true;}}},onGoFilter:function(){this.oState.oSmartFilterbar.search();},setDefaultFilter:function(m){var t=this.oState.oController.getOwnerComponent().getModel("_templPriv");t.setProperty('/alp/filterMode',m);this.handleFilterSwitch(m);},handleFilterSwitch:function(m,A){var o=this.oState.oController.getOwnerComponent();var t=o.getModel("_templPriv");if(t.getProperty('/alp/filterMode')===e&&!this.oState.bIsassociateValueListsCalled){this.oState.bIsassociateValueListsCalled=true;this.oState.oSmartFilterbar.associateValueLists();}if(t.getProperty('/alp/filterMode')===d){if(o.getLazyLoadVisualFilter()&&!this.oState.oSmartFilterbar.isDialogOpen()){this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);}}},fnCheckMandatory:function(){this.oState.oSmartFilterbar.checkSearchAllowed(this.oState);var t=this.oState.oController.getOwnerComponent().getModel("_templPriv");if(this.oState.alr_visualFilterBar&&this.oState.alr_visualFilterBar.bIsInitialised&&t.getProperty('/alp/searchable')===false&&t.getProperty('/alp/filterMode')===d){this.oState.oSmartFilterbar.showAdaptFilterDialog(f);}},showDialog:function(){var t=this.oState.oController.getOwnerComponent().getModel("_templPriv");if(t.getProperty('/alp/filterMode')===d){if(this.oState.alr_visualFilterBar&&this.oState.alr_visualFilterBar.bIsInitialised&&t.getProperty("/alp/searchable")===false){this.oState.oSmartFilterbar.showAdaptFilterDialog(f);}else{this.oState.oSmartFilterbar.showAdaptFilterDialog(d);}}else{this.oState.oSmartFilterbar.showAdaptFilterDialog(f);}},clearFilters:function(){var o=this.oState.oSmartFilterbar.getFilterData();for(var p in o){if(o.hasOwnProperty(p)){delete o[p];}}this.oState.oSmartFilterbar.setFilterData(o,true);if(this.oState.chartController){this.oState.chartController._updateTable();}},changeVisibility:function(E){var o=E.getParameters().filterItem.filterItem,v=E.getParameters().added?true:false,l=this.oState.visualFilterDialogContainer;var m=l.oVerticalBox.getModel('_visualFilterDialogModel').getData().filterCompList;for(var i=0;i<m.length;i++){if(o&&o.getName()===m[i].component.properties.parentProperty){l.oConfig.filterCompList[i].shownInFilterDialog=v;l.oConfig.filterCompList[i].shownInFilterBar=v;l._updateVisualFilterConfigModel(i,'/shownInFilterDialog',v);l.selectCheckBox(i,v);break;}}l._reloadForm();}});return k;});
