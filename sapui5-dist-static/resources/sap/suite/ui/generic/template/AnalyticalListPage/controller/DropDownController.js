sap.ui.define(['sap/ui/core/mvc/Controller','sap/ui/model/Filter','sap/ui/model/json/JSONModel',"sap/m/Button","sap/m/StandardListItem","sap/m/List","sap/m/ToolbarSpacer","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/m/ResponsivePopover","sap/m/Label","sap/m/ToggleButton","sap/m/SearchField","sap/m/Toolbar","sap/ui/core/Icon","sap/ui/model/Sorter","sap/ui/model/FilterOperator","sap/m/library","sap/base/util/extend","sap/base/util/deepExtend"],function(C,F,J,B,S,L,T,a,R,b,c,d,e,I,f,g,h,k,l){"use strict";var s=false,t={},o={},u="",D=C.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController",{});sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createDropdown=function(i,m,M,n,p,q){u=(p.filterRestriction=='multiple')?l({items:[],ranges:[],value:null},m.getDimensionFilter()):m.getDimensionFilter();var r=i.getModel('i18n'),v=sap.ui.getCore().byId(m.getSmartFilterId()),w={"descriptionAndId":p.dimensionFieldDisplay,"descriptionOnly":p.dimensionFieldDisplay,"idAndDescription":p.dimensionField,"idOnly":p.dimensionField},w=(Object.keys(w).indexOf(p.textArrangement)!==-1)?w[p.textArrangement]:p.dimensionFieldDisplay,x=new c({icon:"sap-icon://menu",type:"Transparent",iconFirst:true,enabled:(u&&u.hasOwnProperty("items"))?Boolean(u.items.length):Boolean(u),tooltip:r.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED")}),y=sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createStandardListItem(M,m,r,n,p,x,v,w),z=sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createPopoverWithList(M,m,r,p,n,y,w,x,q,v),O=new B({text:r.getResourceBundle().getText("OK"),press:function(E){m.setDimensionFilter(u);m.fireFilterChange();z.close();},type:"Emphasized"}),A=new B({text:r.getResourceBundle().getText("CANCEL"),press:function(){z.close();}});s=false;z.addContent(y);y.attachSelectionChange(function(E){var G=y.getModel().getData(E.mParameters.listItem.getBindingContext().sPath);G=G[p.dimensionField];var H=E.getParameters().listItem.mProperties.selected;if(p.filterRestriction==='multiple'){if(u.items&&u.items.length){for(var j=0;j<u.items.length;j++){if(u.items[j].key===G){u.items.splice(j,1);}else if(H){u.items.push({key:G});break;}}}else if(u.items){u.items.push({key:G});}else{u.items=[];}if(u.items.length){t.setVisible(true);o.setText(r.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[n,u.items.length]));}t.setVisible(Boolean(u.items.length));x.setEnabled(this.bUpdateToolbarButton||Boolean(u.items.length));}else if(p.filterRestriction==='single'){u=G;if(u){t.setVisible(true);o.setText(r.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[n,+Boolean(u)]));}x.setEnabled(Boolean(u));}}.bind(this));z.addStyleClass("sapSmartTemplatesAnalyticalListPageSelectedLinkDialog");z.setBeginButton(O);z.setEndButton(A);z.openBy(i);};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createPopoverWithList=function(m,i,j,p,n,q,r,v,w,x){if(this._oPopoverDialog&&this._oPopoverDialog.isOpen){this._oPopoverDialog.close();}if(q){var A=function(E){if(E.getParameter("clearButtonPressed")){return;}var y=this.fnApplyFilterFromSearchField(r,E.getSource().getValue());var z=q.getBinding("items");s=false;v.setPressed(false);v.setTooltip(j.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED"));z.filter(y);}.bind(this);this.oSearchField=new d({liveChange:A,search:A,enabled:w,initialFocus:true});this._oPopoverDialog=new R('',{placement:h.PlacementType.Bottom,verticalScrolling:true,title:n,subHeader:[new e({content:[this.oSearchField,v]})],content:[q]});if(x.isDialogOpen()){this._oPopoverDialog.setModel(i.getModel("_dialogFilter"),"_dialogFilter");}else{this._oPopoverDialog.setModel(i.getModel("_filter"),"_filter");}}this._oPopoverDialog.setInitialFocus(this.oSearchField);this._oPopoverDialog.setContentWidth("320px");return this._oPopoverDialog;};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createStandardListItem=function(m,i,j,n,p,q,r,v){var w="/"+p.entitySet,x=sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.standardListItemTemplateCreation(i,p,r);o=new b({text:j.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[n,typeof(i.getDimensionFilter())==="object"&&i.getDimensionFilter()!==null?i.getDimensionFilter().items.length:+Boolean(i.getDimensionFilter())])});t=new e({content:[o,new T(),new I({src:"sap-icon://sys-cancel",tooltip:j.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_CLEAR_SELECTION"),decorative:false,press:function(K){t.setVisible(false);H.getParent().getDomRef().focus();s=false;q.setTooltip(j.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED"));q.setEnabled(false);q.setPressed(false);H.removeSelections(true);(u&&u.hasOwnProperty("items"))?u.items=[]:u="";o.setText(j.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[n,(u&&u.hasOwnProperty("items"))?u.items.length:+Boolean(u)]));H.getBinding("items").filter(this.fnApplyFilterFromSearchField(v,this.oSearchField.getValue()));}.bind(this)}).addStyleClass("sapSmartTemplatesAnalyticalListPageDropdownDialogCancelButton")],"visible":(u&&u.hasOwnProperty("items"))?Boolean(u.items.length):Boolean(u)});if(i.getSmartFilterId()){var y=sap.ui.getCore().byId(i.getSmartFilterId());if(y&&y.getEntitySet()===p.entitySet){w=i.considerAnalyticBinding(w,y);}}var z=a.getVisualFilterSelectFields(p.measureField,p.dimensionField,p.dimensionFieldDisplay),A=a.IsNavigationProperty(i.getModel(),p.entitySet,p.dimensionFieldDisplay)?p.dimensionFieldDisplay.split("/")[0]:null,U={select:z.join(",")};if(A){k(U,{"expand":A});}var E,G;E=i.getDimensionFilterExternal();if(E&&E.aFilters&&E.aFilters.length>0){G=[E];}var H=new L({mode:p.filterRestriction==="single"?h.ListMode.SingleSelectMaster:h.ListMode.MultiSelect,growing:true,growingThreshold:15,showNoData:false,infoToolbar:t,items:{path:w,template:x,filters:G,sorter:sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.getSortObject(p),parameters:U}});if(r.isDialogOpen()){x.setModel(i.getModel("_dialogFilter"),"_dialogFilter");}else{x.setModel(i.getModel("_filter"),"_filter");}H.setModel(m);q.attachPress(function(K){if(p.filterRestriction=="multiple"&&u.items.length||u&&u.hasOwnProperty('items')&&!u.items.length&&s){sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.updateFilterWithListBindings(H,q,j,p.filterRestriction,p.dimensionField);}else if(p.filterRestriction=="single"&&u!=null||u==null&&s){sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.updateFilterWithListBindings(H,q,j,p.filterRestriction,p.dimensionField);}});return H;};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.selectedVisibilityUpdateFormatter=function(u,j){for(var i=0;i<u.items.length;i++){if(u.items[i].key===j){return true;}}return false;};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.standardListItemTemplateCreation=function(j,p,m){var n=p.textArrangement,q=[];q.push({path:p.measureField});var r=m.isDialogOpen()?["_dialogFilter>/"+j.getParentProperty(),p.dimensionField]:["_filter>/"+j.getParentProperty(),p.dimensionField];p.unitField?q.push({path:p.unitField}):"";var v=new S({title:{parts:[p.dimensionFieldDisplay,p.dimensionField],formatter:function(i,w){return a.getTextArrangement(i,w,n);}},description:{parts:q,formatter:function(i,w){return sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroChart.prototype._getFormattedNumberWithUoM(i,w);}},selected:{parts:r,formatter:function(w,x){if(s){return true;}else{if(typeof(u)==="object"&&u!==null){for(var i=0;i<u.items.length;i++){if(u.items[i].key===x){return true;}}}else{return(u!==null&&u===x)?true:false;}}}}});return v;};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.getSortObject=function(p){if(p.sortOrder&&p.sortOrder.length){return new f((p.sortOrder[0].Field)?p.sortOrder[0].Field.String:"",p.sortOrder[0].Descending.Boolean);}};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.updateFilterWithListBindings=function(j,m,n,p,q){var r=[];s=!s;this.bUpdateToolbarButton=s;if(s){m.setTooltip(n.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_ALL"));m.setEnabled(true);if(p==='multiple'){for(var i=0;i<u.items.length;i++){var v=new F(q,g.EQ,(p==="multiple")?u.items[i].key:u);r.push(v);}}else if(p==='single'){var v=new F(q,g.EQ,u);r.push(v);}j.getBinding("items").filter(r);}else{m.setTooltip(n.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED"));m.setEnabled((u&&u.hasOwnProperty("items"))?Boolean(u.items.length):Boolean(u));j.getBinding("items").filter(r);}};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.fnApplyFilterFromSearchField=function(i,q){var j=[];if(q&&q.length>0){var m=new F(i,g.Contains,q);j.push(m);}return j;};return D;});
