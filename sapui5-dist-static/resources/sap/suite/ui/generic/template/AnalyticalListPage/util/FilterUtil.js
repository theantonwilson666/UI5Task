sap.ui.define(["sap/ui/comp/odata/MetadataAnalyser","sap/ui/base/Object","sap/ui/model/Context","sap/suite/ui/generic/template/AnalyticalListPage/util/OperationCode","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms","sap/ui/core/format/DateFormat","sap/ui/model/odata/AnnotationHelper","sap/ui/events/KeyCodes",'sap/ui/comp/odata/FiscalFormat'],function(M,B,C,O,V,D,c,K,F){"use strict";var d=B.extend("sap.suite.ui.generic.template.AnalyticalListPage.util.FilterUtil");d.createTitle=function(s,a){var t;if(!s){return a;}if(a instanceof Date){return s;}if(s.indexOf(':')!==-1){s=s.substring(0,s.indexOf(':'));}if(s.indexOf(a)===-1){t=s+" ("+a+")";}else{t=s;}return t;};d._updateVisualFilterAria=function(i){var f=i.getItems()[2].getItems()[0];var p=f.getParentProperty();var r=f.getModel("i18n").getResourceBundle();var t=r.getText("VIS_FILTER_ITEM_ARIA");if(f.getIsMandatory()){t+=" "+r.getText("VIS_FILTER_MANDATORY_PROPERTY_ARIA",p);}t+=" "+r.getText("VIS_FILTER_DIALOG_NAVIGATE_ARIA")+" "+r.getText("VIS_FILTER_ACCESS_FIELDS_ARIA");i.getItems()[3].setText(t);};d.getAllMandatoryFilters=function(m,e){var o=new M(m);var a=o.getEntityTypeNameFromEntitySetName(e);var b=o.getFieldsByEntityTypeName(a);var f=[];for(var k in b){var g=b[k];if(g.requiredFilterField){f.push(g.name);}}return f;};d.getAllMandatoryFiltersMapping=function(v,I){var f=[],m=[],b=false;for(var i=0;i<v.length;i++){b=true;for(var j=0;j<I.length;j++){if(v[i]===I[j].valueListProperty){f.push(I[j]);b=false;break;}}if(b){m.push(v[i]);}}var a={aMappedFilterList:f,aMappingMissingFilterList:m};return a;};d.checkFilterHasValueFromSelectionVariant=function(s,f){return s.some(function(a){if(a.PropertyName.PropertyPath===f){return true;}});};d.checkFilterHasValueFromSmartFilterBar=function(s,f){return s.some(function(p){if(p.getName()===f){return true;}});};d.checkFilterHasValueFromSelectionVariantOrSmartFilterBar=function(f,s,S,o){var h=S&&d.checkFilterHasValueFromSelectionVariant(S,f);if(!h){h=d.checkFilterHasValueFromSmartFilterBar(o.getFiltersWithValues(),s);}return h;};d.readProperty=function(o,n){var i=0,p=typeof n==='string'?n.split("."):[];while(i<p.length){if(!o){return undefined;}o=o[p[i++]];}return o;};d.executeFunction=function(o,f,a){var i=0,p,P=typeof f==='string'?f.split("."):[];while(i<P.length){if(!o){return undefined;}p=o;o=o[P[i++]];}return typeof o==='function'?o.apply(p,a):undefined;};d.createTitleFromCode=function(f){var v=d.readProperty(f,"value1"),s=d.readProperty(f,"value2"),o=d.readProperty(f,"operation"),r;if(!v||!o||!O[o]){return undefined;}if(s&&o!=="EQ"){r=v+O[o].code+s;}else if(O[o].position==="last"){r=v+O[o].code;}else if(O[o].position==="mid"){r=O[o].code+v+O[o].code;}else{r=O[o].code+v;}if(f.exclude){r="!("+r+")";}return r;};d.formatFiltersLink=function(o){var i=this.getModel("i18n"),r=i.getResourceBundle();return o?r.getText("VISUAL_FILTER_FILTERS_WITH_COUNT",[o]):r.getText("VISUAL_FILTER_FILTERS");};d.getBooleanValue=function(v,b){if(v&&v.Bool){if(v.Bool.toLowerCase()==="true"){return true;}else if(v.Bool.toLowerCase()==="false"){return false;}}return b;};d.getPrimitiveValue=function(v){var a;if(v){if(v.String){a=v.String;}else if(v.Bool){a=d.getBooleanValue(v);}else if(v.EnumMember){a=v.EnumMember.split("/")[1];}else{a=d.getNumberValue(v);}}return a;};d.getNumberValue=function(v){if(v){var s=Object.keys(v)[0];return(v&&s&&["String","Int","Decimal","Double","Single"].indexOf(s)!==-1)?Number(v[s]):undefined;}};d.getPathOrPrimitiveValue=function(i){if(i){return(i.Path)?"{path:'"+i.Path+"'}":d.getPrimitiveValue(i);}else{return"";}};d.isFilterDiff=function(f,a){if(Array.isArray(f)!=Array.isArray(a)){return true;}if(Array.isArray(f)){return this.isFilterListDiff(f,a);}else{return this.isFilterObjDiff(f,a);}};d.isFilterObjDiff=function(f,b){if(!f||!b){return true;}for(var a in f){if(a=="aFilters"){if(this.isFilterListDiff(f.aFilters,b.aFilters)){return true;}}else if(f[a]!=b[a]){return true;}}return false;};d.convertLocalDatetoUTCDate=function(o){var u=new Date(o.valueOf()+o.getTimezoneOffset()*60*1000);return new Date(u.setHours(0,0,0));};d.getDateInMedium=function(o){return(o instanceof Date)?D.getDateInstance({style:"medium"}).format(o):undefined;};d.getDateTimeInMedium=function(o){return(o instanceof Date)?D.getDateTimeInstance({style:"medium"}).format(o):undefined;};d.isDefaultVariantSelected=function(s){var v=s.oSmartFilterbar.getSmartVariant();return(v&&v.getCurrentVariantId()===v.getDefaultVariantKey());};d.isFilterListDiff=function(l,L){if(!l||!L){return true;}if(l.length!=L.length){return true;}for(var i=0;i<l.length;i++){var f=l[i];var a=L[i];if(this.isFilterObjDiff(f,a)){return true;}}return false;};d.getTextArrangement=function(s,i,t){var l,a=s?s:i,b=(s&&i)?s+" ("+i+")":a;if(i!=="__IS_OTHER__"&&i!=="Other"){switch(t){case sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionAndId:l=b;break;case sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionOnly:l=s?s:"";break;case sap.ui.comp.smartfilterbar.DisplayBehaviour.idAndDescription:l=(s&&i)?i+" ("+s+")":a;break;case sap.ui.comp.smartfilterbar.DisplayBehaviour.idOnly:l=i?i:"";break;default:l=b;break;}}else{l=s;}return l;};d.getTooltipForValueHelp=function(i,s,r,a,I){var t="";if(I){if(!a){t=r.getText("DP_WITHOUT_SELECTIONS",s);}else{t=r.getText("DP_SINGLE_SELECTED",[s,a]);}return t;}if(!a){t=i?r.getText("VALUE_HELP",s):r.getText("DROPDOWN_WITHOUT_SELECTIONS",s);}else{if(!i){t=r.getText("DROPDOWN_WITH_SELECTIONS",[s,a]);}else{t=(a===1)?r.getText("VH_SINGLE_SELECTED",[s,a]):r.getText("VH_MULTI_SELECTED",[s,a]);}}return t;};d.getPropertyNameDisplay=function(m,e,p,a,s){var r=a?a.getResourceBundle():undefined,o=m.getMetaModel(),E=o.getODataEntityType(o.getODataEntitySet(e).entityType),b=o.getODataProperty(E,p);var l=(b["com.sap.vocabularies.Common.v1.Label"]&&b["com.sap.vocabularies.Common.v1.Label"].String)?b["com.sap.vocabularies.Common.v1.Label"].String:b["sap:label"];var q=(b["com.sap.vocabularies.Common.v1.QuickInfo"]&&b["com.sap.vocabularies.Common.v1.QuickInfo"].String)?b["com.sap.vocabularies.Common.v1.QuickInfo"].String:b["sap:quickinfo"];if(s&&q){return q;}if(l){if(l.match(/{@i18n>.+}/gi)&&r){l=r.getText(l.substring(l.indexOf(">")+1,l.length-1));}return l;}else{return p;}};d.IsNavigationProperty=function(m,e,n){var o=m.getMetaModel(),E=o.getODataEntityType(o.getODataEntitySet(e).entityType);var a=E['navigationProperty'];var s=false;if(n.indexOf("/")!==-1){for(var i=0;i<a.length;i++){if(a[i].name===n.split("/")[0]){s=true;break;}}}return s;};d.getKeysForNavigationEntitySet=function(m,e,n){if(n){var E=m.getODataEntitySet(e),o=m.getODataEntityType(E.entityType),a=m.getODataAssociationEnd(o,n),N=m.getODataEntityType(a.type),b=this.readProperty(N,"key.propertyRef");if(b&&b.length>1){return b||null;}else{return null;}}else{return null;}};d.isPropertyNonFilterable=function(e,p){if(!e||!p){return false;}var f=e[V.FilterRestrictions];var n=f&&f.NonFilterableProperties;if(n){for(var i=0;i<n.length;i++){if(n[i].PropertyPath===p){return true;}}}return false;};d.getVisualFilterSelectFields=function(m,a,b,u,s,n){var S=[m,a];if(a!=b){if(S.indexOf(b)===-1){S.push(b);}}if(u){if(S.indexOf(u)===-1){S.push(u);}}if(s&&Array.isArray(s)){s.forEach(function(k){if(S.indexOf(k)===-1){S.push(k);}});}if(n){n.forEach(function(k){if(S.indexOf(k.name)===-1){S.push(k.name);}});}return S;};d.getFilterDialogMode=function(m){return m.getProperty("/alp/filterDialogMode");};d.getFilterMode=function(m){return m.getProperty("/alp/filterMode");};d.isVisualFilterLazyLoaded=function(f){if(!f.getLazyLoadVisualFilter()){return false;}var b=this.getFilterDialogMode(f.getModel("_templPriv"));if(b==="compact"){return true;}else if(b==="visual"){return false;}var a=this.getFilterMode(f.getModel("_templPriv"));if(a==="compact"){return true;}return false;};d.formatStringDate=function(o,s){if(!s){var f=D.getDateInstance({pattern:"yyyyMMdd"});if(o!==""){var a=o&&f.parse(o);return d.getDateInMedium(a);}}return o;};d.formatStringDateYearMonth=function(o){if(o!==""){var f=D.getDateTimeInstance({format:"YYYYMMM"});var a=o;var b="-";var p=4;var e=[a.slice(0,p),b,a.slice(p)].join('');var g=new Date(e);return f.format(g);}return o;};d.formatStringDateYearQuarter=function(o){if(o!==""){var f=D.getDateTimeInstance({format:"YYYYQ"}),y=parseInt(o.substr(0,4),10),q=o.substr(4),m=(parseInt(q,10)*3)-2,a=m-1,b=new Date(y,a);return f.format(b);}return o;};d.formatStringDateYearWeek=function(o){if(o!==""){var f=D.getDateTimeInstance({format:"YYYYWW"}),y=parseInt(o.substr(0,4),10),w=o.substr(4),s=(1+(parseInt(w,10)-1)*7),a=new Date(y,0,s);return f.format(a);}return o;};d.formatStringFiscalYearPeriod=function(o){if(o!==""){var f=F.getDateInstance({format:"YYYYPPP"});return f.format(o);}return o;};d.getResolvedDimensionValue=function(k){return((k===null||k==="")?null:k.toString());};d.isPropertyHidden=function(e){var i=false;if(e){var h=e["com.sap.vocabularies.UI.v1.Hidden"];i=h?h.Bool==="true":false;}return i;};d.isInteger=function(p){return p.toUpperCase().indexOf("EDM.INT")!=-1?true:false;};d.onKeyUpVisualFilter=function(e){if(e.keyCode===K.F4){var f=sap.ui.getCore().byId(e.target.id),b,r;if(f){var o=f.getMetadata().getElementName();switch(o){case"sap.m.Button":if(this.isF4Enabled){b=f;}break;case"sap.m.HeaderContainerItemContainer":var v=f.getItem();if(v){r=v.getId().replace("FilterItemContainer","ValueHelpButton");b=this.getF4ButtonId(r);}break;case"sap.m.CustomListItem":r=f.getId().replace("FilterItemContainer","ValueHelpButton");b=this.getF4ButtonId(r);break;default:break;}}else{if(e.target.id.length>0){r=e.target.id.replace("FilterItemMicroChart","ValueHelpButton");}else{r=e.target.parentElement.id.replace("FilterItemMicroChart","ValueHelpButton");}r=r.slice(0,r.indexOf("-innerChart"));b=this.getF4ButtonId(r);}if(b&&this.isF4Enabled(b)){b.firePress();}}};d.onKeyDownVisualFilter=function(s,e){if(e.keyCode===K.ENTER){if(e.ctrlKey||e.metaKey){s.search();e.stopPropagation();}}};d.getF4ButtonId=function(i){var b=sap.ui.getCore().byId(i);return b;};d.isF4Enabled=function(b){if(b.data("isF4Enabled")){if(b.getVisible()&&b.getEnabled()){return true;}}return false;};d.isAlreadyInParameter=function(i,p){return i&&i.some(function(e){return e.localDataProperty===p;});};d.checkManditoryFieldsFilled=function(s){if(s){var a=s.determineMandatoryFilterItems(),f=s.getFiltersWithValues(),I=true,b=0;if(a.length){if(!f.length||(f.length<a.length)){I=false;}else{for(var i=0;i<a.length;i++){for(var j=0;j<f.length;j++){if(f[j].getName()===a[i].getName()){b++;}}}I=(b===a.length);}}if(I){var S=s.verifySearchAllowed.apply(s,arguments);if(S.hasOwnProperty("error")||S.hasOwnProperty("mandatory")){I=false;}}}return I;};d.getParameter=function(p){var P="$Parameter.";if(p.indexOf(P)>-1){p=p.substring(P.length);}return p;};return d;},true);
