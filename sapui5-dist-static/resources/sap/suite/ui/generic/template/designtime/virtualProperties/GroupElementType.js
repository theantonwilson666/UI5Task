sap.ui.define(["sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2","sap/suite/ui/generic/template/designtime/utils/DesigntimeUtils","sap/base/util/extend","sap/base/util/deepExtend","sap/base/util/isEmptyObject"],function(U,A,D,e,d,i){"use strict";var G={},a="com.sap.vocabularies.UI.v1.DataFieldForAnnotation",b="com.sap.vocabularies.UI.v1.DataField",c="com.sap.vocabularies.UI.v1.DataFieldWithUrl",I="com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation",f="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath",F="com.sap.vocabularies.UI.v1.FieldGroup",C="com.sap.vocabularies.Communication.v1.Contact",g="com.sap.vocabularies.Communication.v1.Address",h="Datafield",j="Contact",k="Address",l="DataFieldWithIntentBasedNavigation",m="DatafieldWithUrl",n="DataFieldWithNavigationPath";G.getGroupElementRecord=function(E){var t=U.getTemplatingInfo(E);if(t&&t.annotationContext){return t.annotationContext;}};G.createNewRecord=function(r,o){var p,q={Criticality:{},CriticalityRepresentation:{},IconUrl:{}},R={};R[b]=e({},q,{Label:{},Value:{}});R[c]=e({},q,{Label:{},Value:{Path:""},Url:{Path:""}});R[a]=e({},q,{Label:{String:""},Target:{AnnotationPath:""}});R[I]=e({},q,{Label:{},SemanticObject:{String:"Semantic_Object"},Action:{},Value:{}});R[f]=e({},q,{Label:{},Value:{Path:""},Target:{NavigationPropertyPath:""}});var N={"com.sap.vocabularies.UI.v1.Importance":{"EnumMember":"com.sap.vocabularies.UI.v1.ImportanceType/High"},"RecordType":r,"EdmType":"Edm.String"};d(N,R[r]);for(p in N){if(p!=="RecordType"&&p!=="Target"&&o&&o[p]){e(N[p],o[p]);}if(i(N[p])){delete N[p];}}return N;};G.getGroupElementTypeValues=function(){var v={Datafield:{displayName:"Data Field"},DatafieldWithUrl:{displayName:"Data Field with URL"},Contact:{displayName:"Contact"},Address:{displayName:"Address"},DataFieldWithIntentBasedNavigation:{displayName:"Intent Based Navigation"},DataFieldWithNavigationPath:{displayName:"DataField with Navigation Path"}};return v;};G.getGroupElementType=function(E){var r=G.getGroupElementRecord(E);var s;if(r){switch(r.RecordType){case a:var o=r.Target.AnnotationPath;if(o){if(r.Target.AnnotationPath.indexOf(C)>-1){s=j;}else if(r.Target.AnnotationPath.indexOf(g)>-1){s=k;}}break;case I:s=l;break;case b:s=h;break;case c:s=m;break;case f:s=n;break;default:break;}}return s;};G.setGroupElementType=function(o,N,p){p.noRefreshOnChange=true;p.delayRefresh=false;var O=G.getGroupElementType(o);if(O===N){return;}var r="";var M={};var E={};var q=[];var s=[];var t="";var u=[];var v=-1;var w={};var x=[];var T={};var y="";var z=o.getModel();M=z&&z.getMetaModel();T=U.getTemplatingInfo(o);E=M.getODataEntityType(T.target);t=T.annotation;q=E[t];s=JSON.parse(JSON.stringify(q));u=(t.indexOf(F)>=0)?q.Data:q;v=U.getIndexFromInstanceMetadataPath(o);if(v===-1){throw"invalid index for old group element";}p.refreshPropertiesPane=true;switch(N){case h:r=b;break;case m:r=c;break;case l:r=I;break;case j:y=G.fixQualifierForNewGroupElement(o,u,C,undefined);var B=D.createNewContact();w=A.createCustomAnnotationTermChange(T.target,B,{},y);x.push(w);r=a;break;case k:y=G.fixQualifierForNewGroupElement(o,u,g,undefined);var H=D.createNewAddress();w=A.createCustomAnnotationTermChange(T.target,H,{},y);x.push(w);r=a;break;case n:r=f;break;default:break;}if(!r){return;}var J=G.getGroupElementRecord(o);var K=G.createNewRecord(r,J);switch(N){case j:if(!K.Label.String){K.Label.String="New Contact";}K.Target.AnnotationPath="@"+y;break;case k:if(!K.Label.String){K.Label.String="New Address";}K.Target.AnnotationPath="@"+y;break;case l:K.SemanticObject.String=K.SemanticObject.String+"_"+parseInt(v,10);break;default:break;}var L={"annotation":t,"annotationContext":K,"path":T.path,"target":E.namespace+"."+E.name,"value":K.Value&&K.Value.Path||K.Target&&K.Target.AnnotationPath};o.data("sap-ui-custom-settings")["sap.ui.dt"].annotation=L;u.splice(v,1,K);w=A.createCustomAnnotationTermChange(T.target,q,s,t);x.push(w);return x;};G.fixQualifierForNewGroupElement=function(o,p,t,B){var q=U.getIndexFromInstanceMetadataPath(o);var s=D.fixQualifierForAnnotationPath(p,t,B,q);return s;};return G;});
