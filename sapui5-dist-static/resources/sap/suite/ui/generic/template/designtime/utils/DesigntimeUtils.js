sap.ui.define(["sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2","sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/js/AnnotationHelper","sap/base/util/deepExtend","sap/base/util/isEmptyObject"],function(A,C,a,d,b){"use strict";var D={},c="com.sap.vocabularies.UI.v1.DataPoint",e="com.sap.vocabularies.UI.v1.Chart",f="com.sap.vocabularies.UI.v1.DataFieldForAnnotation";D.ignoreAllProperties=function(m){var o=m.getMetadata().getAllProperties(),p={};for(var k in o){p[k]={ignore:true};}return p;};D.getButtonProperties=function(B){var p=D.ignoreAllProperties(B);var P={visible:{ignore:false}};return d({},p,P);};D.getTableProperties=function(t){var p=D.ignoreAllProperties(t);var P={mode:{ignore:false},sticky:{ignore:false}};return d({},p,P);};D.modifyDataPointForChart=function(t,E,n,g){var o={},O,N,s,q;var h=n.DataPointAnnotationPath&&n.DataPointAnnotationPath.AnnotationPath;if(h){q=h.split("#").reverse()[0];}else{if(n.Measure&&n.Measure.PropertyPath&&n.Measure.PropertyPath!==""){q=n.Measure.PropertyPath;}else{if(!n.DataPoint||b(n.DataPoint)){return;}var i=0;for(var k in E){if(k.indexOf(c)===0){var q=k.split("#")[1];if(q.indexOf("Chart")>-1){var j=parseInt(q.split("Chart")[1],10);if(isNaN(j)){j=0;}i=Math.max(j,i);}}}i++;q="Chart"+i;}}s=c+"#"+q;O=E[s];if(O){N=d({},O,n.DataPoint);}else{N=d(D.createNewDataPointForChart(),n.DataPoint);}if(!N.Value&&n.Measure&&n.Measure.PropertyPath&&n.Measure.PropertyPath!==""){N.Value={Path:n.Measure.PropertyPath};}n.DataPoint=N;o=A.createCustomAnnotationTermChange(t,N,O,s);g.push(o);return q;};D.createNewContact=function(){return{"RecordType":"com.sap.vocabularies.Communication.v1.ContactType"};};D.createNewAddress=function(){return{"RecordType":"com.sap.vocabularies.Communication.v1.AddressType"};};D.createNewChart=function(){var n={"ChartType":{"EnumMember":"com.sap.vocabularies.UI.v1.ChartType/Area"},"Measures":[{"PropertyPath":""}],"MeasureAttributes":[{"Measure":{"PropertyPath":""},"Role":{"EnumMember":"com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis1"},"RecordType":"com.sap.vocabularies.UI.v1.ChartMeasureAttributeType"}],"RecordType":"com.sap.vocabularies.UI.v1.ChartDefinitionType"};return n;};D.createNewDataPointForChart=function(){return{"CriticalityCalculation":{"ImprovementDirection":{"EnumMember":"com.sap.vocabularies.UI.v1.ImprovementDirectionType/Target"},"RecordType":"com.sap.vocabularies.UI.v1.CriticalityCalculationType"},"RecordType":"com.sap.vocabularies.UI.v1.DataPointType"};};D._setP13nData=function(o,n){var p=o.data("p13nData");if(n.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){p.columnKey=n.Value&&n.Value.Path;}else{p.columnKey=a.createP13NColumnKey(n);}if(!p.columnKey){p.columnKey="";}if(n.Value&&n.Value.Path){p.leadingProperty=n.Value.Path;}else{p.leadingProperty="";}o.data("p13nData",p);};D.getChartFromColumn=function(o){var r=C.getLineItemRecordForColumn(o),g;if(r&&r.RecordType===f&&r.Target&&r.Target.AnnotationPath.indexOf("Chart")>=0){var q;if(r.Target.AnnotationPath.indexOf("#")!==-1){q=r.Target.AnnotationPath.split("#").reverse()[0];}var s=q?e+"#"+q:e,h=C.getEntityTypeFromAnnotationPath(o,r.Target.AnnotationPath);if(h){g={chartID:s,entityType:h};}}return g;};D.getChartFromFacet=function(E){var t=C.getTemplatingInfo(E);var T=t&&t.value;if(T){var o=C.getEntityTypeFromAnnotationPath(E,T);var q=T.search("#");var Q=T.substring(q+1);var s=Q?e+"#"+Q:e;var g={chartID:s,entityType:o};return g;}};D.getChartFromParent=function(E){var o;if(E&&E.getMetadata){if(E.getMetadata().getElementName()==="sap.m.Column"){o=D.getChartFromColumn(E);}else{o=D.getChartFromFacet(E);}}return o;};D.addSettingsHandler=function(t,p,g,s){return new Promise(function(r,h){var m=sap.ui.fl.Utils.getAppComponentForControl(t).getModel().getMetaModel();var E=m.getODataEntityContainer();var F=E.functionImport;var o={};var M=new sap.ui.model.json.JSONModel(F);var j=sap.ui.xmlfragment("sap.suite.ui.generic.template.changeHandler.customSelectDialog.SelectDialog",this);j.attachConfirm(function(q){var u=q.getParameter("selectedContexts");var v=[],w;for(var i=0;i<u.length;i++){w=E.namespace+"."+E.name+"/"+u[i].getObject().name;v[i]={selectorControl:t,changeSpecificData:{changeType:s,content:{newFunctionImport:w}}};}r(v);});j.attachSearch(function(q){var v=q.getParameter("value");var S=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,v);var u=new sap.ui.model.Filter({filters:[S,o],and:true});var B=q.getSource().getBinding("items");B.filter(u);});j.setModel(M);var B=j.getBinding("items");var k=[];for(var i in g){var l=C.getCustomDataObject(g[i]);if(l&&l.Action){var n=l.Action.substring(l.Action.lastIndexOf("/")+1);k.push(new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.NE,n));}}o=new sap.ui.model.Filter({filters:k,and:true});B.filter(o);j.addStyleClass(p.styleClass);j.open();});};D.getFacetIndexFromID=function(s,F){var I;for(var i=0;i<F.length;i++){I=F[i].ID&&F[i].ID.String;if(I===s){return i;}I=F[i].Target&&F[i].Target.AnnotationPath;I=I&&I.replace(/@/g,"").replace(/\//g,"::").replace(/#/g,"::");if(I===s){return i;}}};D.fixQualifierForAnnotationPath=function(g,t,B,i){var F=B,s,m=-1,I,q,p,o,h;if(g&&i>-1){for(var j=0;j<g.length;j++){if(j===i){continue;}q=-1;h=g[j].Target&&g[j].Target.AnnotationPath;if(h&&h.indexOf(t)!==-1){p=h.split("/");o=p[p.length-1].substr(1);if(!B&&o.indexOf("#")===-1){q=0;}else if(!B&&o.indexOf("#")>-1){q=o.split("#")[1];}else if(o.indexOf(B)>-1){q=o.split(B)[1];}I=parseInt(q,10);if(isNaN(I)){I=0;}m=Math.max(I,m);}}}if(m!==-1){m++;F=B?B+m.toString():m.toString();}s=F?t+"#"+F:t;return s;};D.getItemsForSmartFilterCustomPopUp=function(o){var I={};var p=o.getParent().sId;o.getContent().map(function(E){var s=E.getContent()[1].sId.split('-');I[s[s.length-1]]=E.getContent()[1].sId.replace(p+'-','');});var g=C.getPropertiesForCustomPopUp(o,'filter');var i=0;var h=g.map(function(j){return{label:j["sap:label"]?(j["sap:label"]+" ("+j["name"]+")"):j["name"],tooltip:j["sap:quickinfo"]||j["sap:label"],id:I[j.name]?I[j.name]:"customId"+i++,changeSpecificData:{changeOnRelevantContainer:true,changeType:"addFilterItem",content:j}};});return h;};return D;});
