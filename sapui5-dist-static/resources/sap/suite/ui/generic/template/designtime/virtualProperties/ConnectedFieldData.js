sap.ui.define(["sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2","sap/suite/ui/generic/template/designtime/virtualProperties/ColumnType","sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/designtime/virtualProperties/ChartMeasures","sap/suite/ui/generic/template/designtime/utils/DesigntimeUtils","sap/base/util/deepExtend","sap/base/util/extend","sap/base/util/isEmptyObject"],function(A,C,a,b,D,d,e,c){"use strict";var f={},I="DataField",g="DataFieldForAction",h="DataFieldForIntentBasedNavigation",j="DataFieldWithNavigationPath",k="DataFieldForAnnotationContact",l="DataFieldForAnnotationChartWithDimensions",m="DataFieldForAnnotationRating",n="DataFieldForAnnotationProgress",U="com.sap.vocabularies.UI.v1.DataField",o="com.sap.vocabularies.UI.v1.DataPoint",p="com.sap.vocabularies.UI.v1.Chart",q="com.sap.vocabularies.Communication.v1.Contact",r="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath",s="com.sap.vocabularies.UI.v1.DataFieldForAnnotation",t="com.sap.vocabularies.UI.v1.DataFieldForAction",u="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation",v="com.sap.vocabularies.UI.v1.ChartType/Area",w="com.sap.vocabularies.UI.v1.ChartType/Donut",x="com.sap.vocabularies.UI.v1.ChartType/Bullet";f.getFieldGroupOfConnectedField=function(i){var R=a.getLineItemRecordForColumn(i),F;if(R&&R.RecordType===s&&R.Target&&R.Target.AnnotationPath.indexOf("FieldGroup")>=0){var y=R.Target.AnnotationPath,z=a.getEntityTypeFromAnnotationPath(i,y);if(z){y=y.substring(1);F={target:z.namespace+"."+z.name,fieldGroup:y,data:z[y]};}}return F;};f.fixQualifierForNewItem=function(i,T,y,B){var E=a.getODataEntityType(i),F,M,Q,z,G=-1;for(var K in E){if(K.indexOf("FieldGroup")!==-1){var H=E[K],J=H.Data;z=J.length+1;F=D.fixQualifierForAnnotationPath(J,T,B,z);Q=isNaN(parseInt(F.split("#")[1].substring(2),10))?0:parseInt(F.split("#")[1].substring(2),10);if(Q>G){G=Q;M=F;}}}return M;};f.createNewDataPointForItem=function(i,Q,T,y){var V="com.sap.vocabularies.UI.v1.VisualizationType/"+Q,L=f.getFieldGroupOfConnectedField(i).data.Data;var N={TargetValue:{String:T},Visualization:{EnumMember:V},RecordType:o+"Type",Title:{String:Q}};if(L[y]&&L[y].Value&&L[y].Value.Path&&(L[y].RecordType===U||L[y].RecordType===u)){N.Value={Path:L[y].Value.Path};}return N;};f.getItemType=function(E,i){var F=f.getFieldGroupOfConnectedField(E),y=F.data,z=[],B;if(y){z=JSON.parse(JSON.stringify(y.Data));}var G=z[i].RecordType;switch(G){case U:B=I;break;case t:B=g;break;case u:B=h;break;case r:B=j;break;case q:B=k;break;case s:var H=z[i].Target&&z[i].Target.AnnotationPath;if(H){if(H.indexOf(o)>=0){var J=a.getEntityTypeFromAnnotationPath(E,H);var Q=H.search("#");var K=H.substring(Q);var L=K?o+K:o;var M=J[L];if(M){if(M.Visualization.EnumMember==="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){B=m;}if(M.Visualization.EnumMember==="com.sap.vocabularies.UI.v1.VisualizationType/Progress"){B=n;}}}else if(H.indexOf(q)>=0){B=k;}else if(H.indexOf(p)>=0){B=l;}}break;default:break;}return B;};f.setData=function(y,N,z){var B,E,F=[],G=f.getFieldGroupOfConnectedField(y),H=G.data;if(!H||c(H)||!G||!N){return F;}var J=d({},H),T=G.target;B=z.metadataPath.replace('vData/children/','');E=parseInt(B,10);if(z.propertyContent.propertyValue===undefined&&z.propertyContent.propertyName==="vData"){var K={RecordType:U};J.Data.push(K);}else if(z.propertyContent.propertyValue==="-1"){J.Data.splice(E,1);}else{var L;if(z.propertyContent.propertyName==="vItemType"){var R,M=z.propertyContent.propertyValue,O={};var P=z.metadataPath.match(/\d+/g).map(Number);var Q=f.getItemType(y,P);if(M===Q){return;}T=a.getEntityType(a.getComponent(y));switch(M){case I:R=U;break;case g:R=t;break;case h:R=u;break;case j:R=r;break;case l:L=f.fixQualifierForNewItem(y,p,z,"FE");var S=L.split("#")[1];var V=S?"#Chart"+S:"#Chart";var W=D.createNewChart();O=A.createCustomAnnotationTermChange(T,W,{},L);F.push(O);var X=D.createNewDataPointForChart();O=A.createCustomAnnotationTermChange(T,X,{},o+V);F.push(O);R=s;break;case m:L=f.fixQualifierForNewItem(y,o,z,"FE");X=C.createNewDataPointForColumn(y,"Rating","4");O=A.createCustomAnnotationTermChange(T,X,{},L);F.push(O);R=s;break;case n:L=f.fixQualifierForNewItem(y,o,z,"FE");X=f.createNewDataPointForItem(y,"Progress","100",P);O=A.createCustomAnnotationTermChange(T,X,{},L);F.push(O);R=s;break;case k:L=f.fixQualifierForNewItem(y,q,z,"FE");var Y=D.createNewContact();O=A.createCustomAnnotationTermChange(T,Y,{},L);F.push(O);R=s;break;default:break;}if(!R){return;}var Z=H.Data[P];var $=C.createNewColumn(R,Z);switch(M){case n:$.Target={AnnotationPath:"@"+L};$.Criticality={Path:""};break;case m:case l:$.Target={AnnotationPath:"@"+L};break;case k:$.Target={AnnotationPath:"@"+L};if(!$.Label){$.Label={"String":"New Contact"};}break;default:break;}J.Data.splice(P,1,$);z.noRefreshOnChange=true;z.refreshPropertiesPane=true;O=A.createCustomAnnotationTermChange(T,J,H,G.fieldGroup);F.push(O);return F;}if(z.propertyContent.propertyName==="vChartType"){z.noRefreshOnChange=true;z.refreshPropertiesPane=true;var _=[],a1={},b1,c1=z.newValue,d1=G.data;if(d1){_=JSON.parse(JSON.stringify(d1.Data));}var e1=_[E].Target&&_[E].Target.AnnotationPath;var W;var f1=a.getEntityTypeFromAnnotationPath(y,e1);T=f1.namespace?f1.namespace+"."+f1.name:f1.name;if(e1.search("/")>=0){var g1=e1.search("/");var h1=e1.substring(g1);b1=h1.substr(2);W=f1[b1];}else{W=f1[e1.substr(1)];}a1.Description=W.Description;a1.Measures=W.Measures;a1.MeasureAttributes=W.MeasureAttributes;switch(c1){case"Area":a1.ChartType={EnumMember:"com.sap.vocabularies.UI.v1.ChartType/Area"};a1.Dimensions=W&&W.Dimensions;break;case"Bullet":a1.ChartType={EnumMember:"com.sap.vocabularies.UI.v1.ChartType/Bullet"};break;case"Donut":a1.ChartType={EnumMember:"com.sap.vocabularies.UI.v1.ChartType/Donut"};break;default:return F;}O=A.createCustomAnnotationTermChange(T,a1,W,b1);F.push(O);return F;}if(z.propertyContent.rootProperty&&z.propertyContent.rootProperty==="vData"){var i1=this._getMetadataPathParts(z),E=i1[0],j1=i1[1],k1={},l1=N.slice();for(var i=0;i<i1.length;i++){var m1=i1[i];l1=l1[m1];k1=l1;}if(j1==="DataPointRating"||j1==="DataPointProgress"){var e1=H.Data[E].Target&&H.Data[E].Target.AnnotationPath;var n1=a.getEntityTypeFromAnnotationPath(y,e1);var g1=e1.search("#");var h1=e1.substring(g1);var o1=h1?o+h1:o;var p1=n1[o1];var O=A.createCustomAnnotationTermChange(T,k1,p1,o1);F.push(O);return F;}else{if(z.propertyContent.propertyName==="Target"){var q1=z.propertyContent,r1="(New)";if(q1.propertyType!=="AnnotationPath"||(q1.valueTargetElement!==null&&q1.valueTargetElement.indexOf(r1)===-1)||!q1.refersTo){J=d({},H);J.Data[E]=k1;z.refreshPropertiesPane=true;}else{var s1=sap.ui.getCore().byId(z.stableId);var e1=q1.propertyValue.replace(r1," "),t1=a.getEntityTypeFromAnnotationPath(s1,e1);if(!t1){q1.propertyValue=q1.propertyValue.replace(r1,"");return;}var u1=t1.namespace+'.'+t1.name,M=z.metadataPath;if(M.search("DataFieldForAnnotationRating")>=1||M.search("DataFieldForAnnotationProgress")>=1){L=f.fixQualifierForNewItem(y,o,z,"FE");}else if(M.search("DataFieldForAnnotationChart")>=1){L=f.fixQualifierForNewItem(y,p,z,"FE");}else{L=f.fixQualifierForNewItem(y,q,z,"FE");}var v1,w1,x1=G.data.Data[E],y1=x1&&x1.Target.AnnotationPath;if(y1.search("/")>0){v1=y1.substr(y1.search("/")+2);}else{v1=y1.substr(1);}w1=d({},t1[v1]);var O=A.createCustomAnnotationTermChange(u1,w1,{},L);q1.valueTargetElement=L;q1.propertyValue=q1.propertyValue.replace(r1,"@"+L);z.refreshPropertiesPane=true;if(O){F.push(O);z.delayRefresh=false;}J=d({},H);J.Data[E]=k1;k1.Target.AnnotationPath=q1.propertyValue;}}else{J=d({},H);J.Data[E]=k1;}}}}var O=A.createCustomAnnotationTermChange(T,J,H,G.fieldGroup);F.push(O);return F;};f._getMetadataPathParts=function(y){var P=[];var z=y.metadataPath.split("/");if(z){for(var i=0;i<z.length;i++){var B=z[i];if(B==="vData"||B==="children"||B===y.propertyContent.propertyName){continue;}else{P.push(B);}}}return P;};f.getData=function(E){var y=[],z=[],V={},F=f.getFieldGroupOfConnectedField(E);if(!F){return z;}var B=F.data;if(B){y=JSON.parse(JSON.stringify(B.Data));}for(var i=0;i<y.length;i++){var R=y[i].RecordType;switch(R){case U:V={vItemType:{EnumMember:I},DataField:y[i]};break;case t:V={vItemType:{EnumMember:g},DataFieldForAction:y[i]};break;case u:V={vItemType:{EnumMember:h},DataFieldForIntentBasedNavigation:y[i]};break;case r:V={vItemType:{EnumMember:j},DataFieldWithNavigationPath:y[i]};break;case s:V={};var G=y[i].Target&&y[i].Target.AnnotationPath;if(G){if(G.indexOf(o)>=0){var H=a.getEntityTypeFromAnnotationPath(E,G);var Q=G.search("#");var J=G.substring(Q);var K=J?o+J:o;var L=e({},H[K]);if(L){if(L.Visualization.EnumMember==="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){V.vItemType={EnumMember:m};V.DataFieldForAnnotationRating=y[i];V.DataPointRating=L;}if(L.Visualization.EnumMember==="com.sap.vocabularies.UI.v1.VisualizationType/Progress"){V.vItemType={EnumMember:n};V.DataFieldForAnnotationProgress=y[i];V.DataPointProgress=L;}}}else if(G.indexOf(q)>=0){var M=a.getEntityTypeFromAnnotationPath(E,G);var N=M[G.substr(1)];V.vItemType={EnumMember:k};V.DataFieldForAnnotationContact=y[i];V.Contact=N;}else if(G.indexOf(p)>=0){var O=b.getMeasures(E,i);var P;var S;var M=a.getEntityTypeFromAnnotationPath(E,G);if(G.search("/")>=0){var Q=G.search("/");var J=G.substring(Q);S=M[J.substr(2)];}else{S=M[G.substr(1)];}if(S.ChartType.EnumMember===v){P="Area";}else if(S.ChartType.EnumMember===w){P="Donut";}else if(S.ChartType.EnumMember===x){P="Bullet";}V.vItemType={EnumMember:l};V.vChartType={EnumMember:P};if(S.Dimensions){V.DataFieldForAnnotationChartWithDimensions=y[i];V.ChartWithDimensions=S;V.vDimensions={value:S.Dimensions};}else{V.DataFieldForAnnotationChartNoDimensions=y[i];V.ChartNoDimensions=S;}V.vMeasures={value:O};}}break;default:break;}z.push(V);}return z;};f.getPossibleValues=function(E){var V={vItemType:{displayName:"Field Type",virtual:true,type:"EnumType",whiteList:{properties:["vItemType"]},possibleValues:{DataField:{displayName:"Data Field"},DataFieldForAction:{displayName:"DataField For Action"},DataFieldForIntentBasedNavigation:{displayName:"Data Field For Intent Based Navigation"},DataFieldWithNavigationPath:{displayName:"Data Field With Navigation Path"},DataFieldForAnnotationContact:{displayName:"Contact"},DataFieldForAnnotationRating:{displayName:"Rating Indicator"},DataFieldForAnnotationProgress:{displayName:"Progress Indicator"},DataFieldForAnnotationChartWithDimensions:{displayName:"Chart"}}},vChartType:{displayName:"Chart Type",virtual:true,type:"EnumType",whiteList:{properties:["vChartType"]},possibleValues:{Area:{displayName:"Smart Area Micro Chart"},Bullet:{displayName:"Smart Bullet Micro Chart"},Donut:{displayName:"Smart Radial Micro Chart"}}},DataField:{displayName:"Data Field",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataField",type:"ComplexType",whiteList:{properties:["vItemType","Value","Label","Criticality","CriticalityRepresentation"],mandatory:["vItemType","Value"],expressionTypes:{Value:["Path"],Criticality:["Path"]}}},DataFieldForAction:{displayName:"Data Field For Action",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldForAction",type:"ComplexType",whiteList:{properties:["vItemType","Action","Label","Criticality","InvocationGrouping"],mandatory:["vItemType","Action"],expressionTypes:{Criticality:["Path"]}}},DataFieldForIntentBasedNavigation:{displayName:"Data Field For Intent Based Navigation",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldForIntentBasedNavigation",type:"ComplexType",whiteList:{properties:["vItemType","SemanticObject","Action","RequiresContext","Label"],mandatory:["vItemType","SemanticObject","RequiresContext"]}},DataFieldWithNavigationPath:{displayName:"Data Field With Navigation Path",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldWithNavigationPath",type:"ComplexType",whiteList:{properties:["vItemType","Target","Value","Label"],mandatory:["vItemType","Target","Value"]}},DataFieldForAnnotationContact:{displayName:"Data Field For Annotation",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldForAnnotation",type:"ComplexType",whiteList:{properties:["vItemType","Target","Label"],mandatory:["Target"]},refersTo:[{annotation:"Contact",referredBy:"Target"}]},Contact:{namespace:"com.sap.vocabularies.Communication.v1",annotation:"Contact",type:"ComplexType",whiteList:{properties:["fn","n","tel","email","photo","title","org","role"],expressionTypes:{fn:["Path"],photo:["Path"],title:["Path"],org:["Path"],role:["Path"]}},appliesTo:["vItemType"]},DataFieldForAnnotationRating:{displayName:"Data Field For Annotation",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldForAnnotation",type:"ComplexType",whiteList:{properties:["vItemType","Target","Label"],mandatory:["Target"]},refersTo:{annotation:"DataPoint",namespace:"com.sap.vocabularies.UI.v1"}},DataPointRating:{displayName:"Data Point",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataPoint",type:"ComplexType",whiteList:{properties:["Value","TargetValue"],mandatory:["Value"],expressionTypes:{Value:["Path"],TargetValue:["Path","String","Int","Decimal"]}}},DataFieldForAnnotationProgress:{displayName:"Data Field For Annotation",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldForAnnotation",type:"ComplexType",whiteList:{properties:["vItemType","Target","Label","Criticality","DataPointProgress"],mandatory:["Target"]},refersTo:{annotation:"DataPoint",namespace:"com.sap.vocabularies.UI.v1"}},DataPointProgress:{displayName:"Data Point",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataPoint",target:["EntityType"],type:"ComplexType",whiteList:{properties:["Value","TargetValue"],mandatory:["Value"],expressionTypes:{Value:["Path"],TargetValue:["Path","String","Int","Decimal"]}}},DataFieldForAnnotationChartWithDimensions:{displayName:"Data Field For Annotation",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldForAnnotation",type:"ComplexType",whiteList:{properties:["vItemType","Target","Label","ChartWithDimensions"],mandatory:["Target"]},refersTo:{annotation:"DataPoint",namespace:"com.sap.vocabularies.UI.v1"}},ChartWithDimensions:{displayName:"Chart",namespace:"com.sap.vocabularies.UI.v1",annotation:"Chart",type:"ComplexType",whiteList:{properties:["Description","vDimensions","vMeasures"],mandatory:["vMeasures"]}},DataFieldForAnnotationChartNoDimensions:{displayName:"Data Field For Annotation",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataFieldForAnnotation",type:"ComplexType",whiteList:{properties:["vItemType","Target","Label","ChartNoDimensions"],mandatory:["Target"]},refersTo:{annotation:"DataPoint",namespace:"com.sap.vocabularies.UI.v1"}},ChartNoDimensions:{displayName:"Chart",namespace:"com.sap.vocabularies.UI.v1",annotation:"Chart",target:["EntityType"],type:"ComplexType",whiteList:{properties:["Description","vMeasures"],mandatory:["vMeasures"]}},vDimensions:{displayName:"Dimensions",virtual:true,type:"Collection",nullable:false,visible:false,multiple:true,possibleValues:{},whiteList:{properties:["Dimensions"]}},vMeasures:{displayName:"Measures and Attributes",virtual:true,type:"Collection",nullable:false,visible:false,multiple:true,possibleValues:{Measure:{displayName:"Measure",type:"Edm.PropertyPath",namespace:"com.sap.vocabularies.UI.v1",annotation:"Chart",nullable:false},Role:{displayName:"Role",type:"EnumType",namespace:"com.sap.vocabularies.UI.v1",annotation:"Chart",possibleValues:{Axis1:{displayName:"Axis 1"},Axis2:{displayName:"Axis 2"},Axis3:{displayName:"Axis 3"}}},DataPointAnnotationPath:{displayName:"Data Point Reference",type:"Edm.AnnotationPath",namespace:"com.sap.vocabularies.UI.v1",annotation:"Chart",nullable:false},DataPoint:{displayName:"Data Point Properties",type:"ComplexType",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataPoint",whiteList:{properties:["Value","TargetValue","ForecastValue","MinimumValue","MaximumValue","Criticality","CriticalityCalculation"],mandatory:["Value"],expressionTypes:{Value:["Path"],TargetValue:["Path","String","Int","Decimal"],ForecastValue:["Path","String","Int","Decimal"],Criticality:["Path"]},CriticalityCalculation:{properties:["ImprovementDirection","DeviationRangeLowValue","DeviationRangeHighValue","ToleranceRangeLowValue","ToleranceRangeHighValue"]}}},DataPointDonut:{displayName:"Data Point Properties",type:"ComplexType",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataPoint",whiteList:{properties:["Value","TargetValue","Criticality","CriticalityCalculation"],mandatory:["Value"],expressionTypes:{Value:["Path"],TargetValue:["Path","String","Int","Decimal"],Criticality:["Path"]},CriticalityCalculation:{properties:["ImprovementDirection","DeviationRangeLowValue","DeviationRangeHighValue","ToleranceRangeLowValue","ToleranceRangeHighValue"]}}},DataPointArea:{displayName:"Data Point Properties",type:"ComplexType",namespace:"com.sap.vocabularies.UI.v1",annotation:"DataPoint",whiteList:{properties:["Value","TargetValue","CriticalityCalculation"],mandatory:["Value","TargetValue"],expressionTypes:{Value:["Path"],TargetValue:["Path","String","Int","Decimal"]},CriticalityCalculation:{properties:["ImprovementDirection","DeviationRangeLowValue","DeviationRangeHighValue","ToleranceRangeLowValue","ToleranceRangeHighValue"]}}}},whiteList:{properties:["DataPoint","DataPointAnnnotationPath","Measure","Role"],mandatory:["Measure"]}}};return V;};return f;});
