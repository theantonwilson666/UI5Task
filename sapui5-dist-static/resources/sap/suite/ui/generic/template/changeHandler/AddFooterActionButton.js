/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2","sap/base/util/deepExtend"],function(U,A,d){"use strict";var a={};var I="com.sap.vocabularies.UI.v1.Identification";var D="com.sap.vocabularies.UI.v1.DataFieldForAction";a.applyChange=function(c,C,p){var o=c.getDefinition();if(!o.transferred){var P=c.getContent().customChanges[0].parentElementId;var b=c.getContent().customChanges[0].oParentSelector;var e=p.modifier.bySelector(b);var n=c.getContent().newFunctionImport;var N="action::"+n.replace("/","::");var s=P.substring(0,P.lastIndexOf("--"));N=s+N;var f=new sap.m.Button(N,{text:'New Action'});f.addCustomData(new sap.ui.core.CustomData({"key":"Action","value":n}));if(P.indexOf("--template::ObjectPage::FooterToolbar")>-1){e.insertContent(f,c.getContent().customChanges[0].targetIndex);}else{e.getFooter().insertContent(f,c.getContent().customChanges[0].targetIndex);}}};a.revertChange=function(c,C,p){};a.completeChangeContent=function(c,s,p){var S=p.modifier.bySelector(s.selector.id,p.appComponent);var P=S.getParent();var o=p.modifier.getSelector(P.getId(),p.appComponent);var C=U.getComponent(S);var e=U.getODataEntityType(C);var E=e.entityType;var b=e[I];var f=b.slice();var B;if(S.getId().indexOf("::Determining")>-1){B=S.getParent().getContent();}else{B=S.getContent();}var g=-1;B.some(function(k,i){if(k.getId&&k.getId()===s.selector.id){g=i;return true;}});var h=-1;h=U.getIndexFromInstanceMetadataPath(B[g]);h++;var n={Label:{String:"My new Action"},Action:{String:s.content.newFunctionImport},RecordType:D,Determining:{Bool:"true"}};b.splice(h,0,n);var m=A.createCustomAnnotationTermChange(E,b,f,I);m.targetIndex=g+1;m.parentElementId=P.getId();m.oParentSelector=o;var j=A.createCustomChanges(m);d(c.getContent(),j);};return a;},true);
