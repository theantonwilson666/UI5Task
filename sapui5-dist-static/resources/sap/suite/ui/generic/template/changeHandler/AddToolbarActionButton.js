/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2","sap/base/util/deepExtend"],function(U,A,d){"use strict";var a={};var L="com.sap.vocabularies.UI.v1.LineItem";var D="com.sap.vocabularies.UI.v1.DataFieldForAction";var I="com.sap.vocabularies.UI.v1.Importance";var b="com.sap.vocabularies.UI.v1.ImportanceType/High";a.applyChange=function(c,C,p){var o=c.getDefinition();if(!o.transferred){var P=c.getContent().customChanges[0].parentElementId;var e=c.getContent().customChanges[0].oParentSelector;var f=p.modifier.bySelector(e);var n=c.getContent().newFunctionImport;var N="action::"+n.replace("/","::");var s=P.substring(0,P.lastIndexOf("--"));N=s+N;var g=new sap.m.Button(N,{text:'New Action'});g.addCustomData(new sap.ui.core.CustomData({"key":"Action","value":n}));if(P.indexOf("--template::ListReport::TableToolbar")>-1){f.insertContent(g,c.getContent().customChanges[0].targetIndex);}else{f.getHeaderToolbar().insertContent(g,c.getContent().customChanges[0].targetIndex);}}};a.revertChange=function(c,C,p){};a.completeChangeContent=function(c,s,p){var m=U.getMetaModel(s,p);var S=p.modifier.bySelector(s.selector.id,p.appComponent);var P=S.getParent();var o=p.modifier.getSelector(P.getId(),p.appComponent);var C=U.getComponent(S);var e=U.getODataEntitySet(C).entityType;var E=m.getODataEntityType(e);var l=E[L];var f=l.slice();var B=[];if(S.getParent().getId().indexOf("--template::ListReport::TableToolbar")>-1){B=S.getParent().getContent();}else{B=S.getContent();}var g=-1;B.some(function(q,i){if(q.getId&&q.getId()===s.selector.id){g=i;return true;}});var h=-1;for(var i=g+1;i<B.length;i++){h=U.getLineItemRecordIndexForButton(B[i],l);if(h>=0){break;}}if(h===-1){h=l.length;}var n={Label:{String:"My new Action"},Action:{String:s.content.newFunctionImport},RecordType:D};n[I]={EnumMember:b};l.splice(h,0,n);var j=A.createCustomAnnotationTermChange(e,l,f,L);j.targetIndex=g+1;j.parentElementId=P.getId();j.oParentSelector=o;var k=A.createCustomChanges(j);d(c.getContent(),k);};return a;},true);
