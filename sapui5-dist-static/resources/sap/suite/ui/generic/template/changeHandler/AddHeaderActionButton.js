/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2","sap/base/util/deepExtend"],function(U,A,d){"use strict";var a={};var I="com.sap.vocabularies.UI.v1.Identification";var D="com.sap.vocabularies.UI.v1.DataFieldForAction";var b="com.sap.vocabularies.UI.v1.Importance";var c="com.sap.vocabularies.UI.v1.ImportanceType/High";a.applyChange=function(C,o,p){var e=C.getDefinition();if(!e.transferred){var P=C.getContent().customChanges[0].parentElementId;var f=C.getContent().customChanges[0].oParentSelector;var g=p.modifier.bySelector(f);var n=C.getContent().newFunctionImport;var N="action::"+n.replace("/","::");var s=P.substring(0,P.lastIndexOf("--"));N=s+N;var h=new sap.m.Button(N,{text:'New Action'});h.addCustomData(new sap.ui.core.CustomData({"key":"Action","value":n}));if(P.indexOf("objectPageHeader")>-1||P.indexOf("--template::ObjectPage::ObjectPageHeader")>-1){g.insertAction(h,C.getContent().customChanges[0].targetIndex);}else{g=g.getHeaderTitle();g.insertAction(h,C.getContent().customChanges[0].targetIndex);}}};a.revertChange=function(C,o,p){};a.completeChangeContent=function(C,s,p){var S=p.modifier.bySelector(s.selector.id,p.appComponent);var P=S.getParent();var o=p.modifier.getSelector(P.getId(),p.appComponent);var e=U.getComponent(S);var E=U.getODataEntityType(e);var f=E.entityType;var g=E[I];var h=g.slice();var B=[];if(S.getParent().getId().indexOf("--objectPageHeader")>-1||S.getParent().getId().indexOf("--template::ObjectPage::ObjectPageHeader")>-1){B=S.getParent().getActions();}else{B=S.getActions();}var j=-1,k=-1,l=-1,r=-1;B.some(function(u,i){if(u.getId&&u.getId()===s.selector.id){j=i;}if(u.getId&&u.getId().indexOf("--edit")>0){k=i;}if(u.getId&&u.getId().indexOf("--delete")>0){l=i;}if(u.getId&&u.getId().indexOf("--relatedApps")>0){r=i;if(j>0){return true;}}});var m=-1;m=U.getIndexFromInstanceMetadataPath(B[j]);m++;var n={Label:{String:"My new Action"},Action:{String:s.content.newFunctionImport},RecordType:D};if(j<(k||l||r)){n[b]={EnumMember:c};}g.splice(m,0,n);var q=A.createCustomAnnotationTermChange(f,g,h,I);q.targetIndex=j+1;q.parentElementId=P.getId();q.oParentSelector=o;var t=A.createCustomChanges(q);d(C.getContent(),t);};return a;},true);
