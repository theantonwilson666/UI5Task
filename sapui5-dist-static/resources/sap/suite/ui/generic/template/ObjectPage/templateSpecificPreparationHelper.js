sap.ui.define(["sap/base/util/extend","sap/base/util/deepExtend","sap/ui/model/odata/AnnotationHelper","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/js/staticChecksHelper","sap/suite/ui/generic/template/js/preparationHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger"],function(e,d,A,S,s,p,F){"use strict";var l=new F("ObjectPage.Component").getLogger();function g(c,m,o,D,L){function G(i,C){var R=e({},C);switch(i){case"com.sap.vocabularies.UI.v1.ReferenceFacet":if(!R["com.sap.vocabularies.UI.v1.PartOfPreview"]||R["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool!=="false"){R["com.sap.vocabularies.UI.v1.PartOfPreview"]={Bool:"true"};}break;default:break;}return R;}function f(R){if(!R.getObject().Target){return undefined;}var i=A.resolvePath(m.getContext(R.sPath+"/Target"));return i&&m.getContext(i).getObject();}function E(i){i.subSections=i.subSections||[];if(i.subSections.find(function(C){return i.additionalData.facetId===C.additionalData.facetId;})){return;}var C=e({},i);delete C.subSections;C.blocks=[];i.subSections.push(C);}var M=0;function a(C,H,J,K){var R=[];var O=["sections","subSections","blocks"];J=J||0;var Q=m.getObject(C);if(!Array.isArray(Q)){return[];}Q.forEach(function(T,i){var U={additionalData:{facetId:S.getStableId({type:"ObjectPage",subType:"Facet",sRecordType:T.RecordType,bIsHeaderFacet:H,sAnnotationPath:T.Target&&T.Target.AnnotationPath,sAnnotationId:T.ID&&T.ID.String})},temporaryData:{},annotations:{Facet:{annotation:d({},T)}},metaModelPath:C+"/"+i};U.facetIdAsObject={id:U.additionalData.facetId};U.fallbackIdByEnumerationForRuntime=U.additionalData.facetId||"missingStableId#"+M++;if(T.RecordType==="com.sap.vocabularies.UI.v1.CollectionFacet"){var V=a(C+"/"+i+"/Facets",H,J+1,U);if(J===0&&!U.subSections&&V.length===0){E(U);}else{var W=O[J+1]||"unsupportedNestingLevel";U[W]=U[W]||[];U[W]=U[W].concat(V);}}else if(T.RecordType==="com.sap.vocabularies.UI.v1.ReferenceFacet"){U.fallbackIdByAnnotationPathForManifest=S.getStableId({type:"ObjectPage",subType:"Facet",sRecordType:T.RecordType,bIsHeaderFacet:H,sAnnotationPath:T.Target&&T.Target.AnnotationPath});U.annotations.Facet.annotation=G("com.sap.vocabularies.UI.v1.ReferenceFacet",T);var X=e({},U);X.targetAnnotation=f(m.getContext(C+"/"+i));var Y;switch(J){case 0:if(T.Target&&!T.Target.AnnotationPath){return;}Y=e({},U);Y.blocks=[X];U.subSections=[Y];break;case 1:E(K);Y=K.subSections.find(function(Y){return Y.additionalData.facetId===K.additionalData.facetId;});Y.blocks.push(X);return;case 2:U.targetAnnotation=X.targetAnnotation;K.temporaryData.potentiallySeparateForms=true;break;default:l.warning("UnSupported Nesting of Collectionfacets");break;}}R.push(U);});return R;}var t={};function b(i,C){if(!t[i.entityType]){t[i.entityType]=p.getTargetEntityForQuickView(m,i);}}b(m.getODataEntitySet(L));function h(i){i.multiSelect=i.multiSelect||i.allTableMultiSelect;var T=A.gotoEntitySet(m.getContext(i.metaModelPath+"/Target"));var C=T&&m.getObject(T).name||L;var H=c.getControllerExtensions();var J=H&&H.Sections&&H.Sections[i.additionalData.facetId]&&H.Sections[i.additionalData.facetId].Actions;var R=p.getNormalizedTableSettings(m,i,D,C,J,i.targetAnnotation);R.variantManagement=!!(i.tableSettings&&i.tableSettings.variantManagement);if(R.onlyForDelete){R.mode=c.isDraftEnabled()?"{= ${ui>/editable} ? '"+R.mode+"' : 'None'}":"{= ${ui>/editable} ? 'None' : '"+R.mode+"'}";}var K=m.getODataEntitySet(C);if(R&&R.createWithParameterDialog&&R.createWithParameterDialog.fields){s.checkErrorforCreateWithDialog(m.getODataEntityType(K.entityType),R);R.createWithParameterDialog.id=S.getStableId({type:'ObjectPageAction',subType:'CreateWithDialog',sFacet:i.additionalData.facetId});}b(K);return R;}function j(i){return{variantManagement:!!(i.chartSettings&&i.chartSettings.variantManagement),chartTitle:i.targetAnnotation&&i.targetAnnotation.Title};}function n(i){var C=o.sections&&e({},o.sections[i.additionalData.facetId],o.sections[i.fallbackIdByAnnotationPathForManifest]);e(i,C,i);if(i.targetAnnotation){var H=d({},o,i);var J=i.annotations.Facet.annotation.Target.AnnotationPath.split("@").pop().split("#")[0];switch(J){case"com.sap.vocabularies.UI.v1.LineItem":i.tableSettings=h(H);i.additionalData.type="SmartTable";break;case"com.sap.vocabularies.UI.v1.Chart":i.chartSettings=j(H);i.additionalData.type="SmartChart";break;case"com.sap.vocabularies.UI.v1.FieldGroup":i.additionalData.type="SmartForm";break;case"com.sap.vocabularies.UI.v1.Identification":i.additionalData.type="SmartForm";break;default:break;}}}function k(i){if(i.blocks.length===1&&i.blocks[0].targetAnnotation){var C=i.blocks[0];var H=C.annotations.Facet.annotation.Target.AnnotationPath.split("@").pop().split("#")[0];var J=i.annotations.Facet.annotation.Label&&i.annotations.Facet.annotation.Label.String;switch(H){case"com.sap.vocabularies.UI.v1.LineItem":return J!==(C.tableSettings.headerInfo&&C.tableSettings.headerInfo.TypeNamePlural&&C.tableSettings.headerInfo.TypeNamePlural.String);case"com.sap.vocabularies.UI.v1.Chart":return J!==(C.chartSettings.chartTitle&&C.chartSettings.chartTitle.String);default:return true;}}return true;}function q(i,C){var H={BeforeFacet:{withKey:{section:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSectionWithKey"},subSection:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSubSectionWithKey"}},withoutKey:{section:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSection"},subSection:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSubSection"}}},AfterFacet:{withKey:{section:{type:"ObjectPageSection",subType:"AfterFacetExtensionSectionWithKey"},subSection:{type:"ObjectPageSection",subType:"AfterFacetExtensionSubSectionWithKey"}},withoutKey:{section:{type:"ObjectPageSection",subType:"AfterFacetExtensionSection"},subSection:{type:"ObjectPageSection",subType:"AfterFacetExtensionSubSection"}}}};var J=H[i][C.sKey?"withKey":"withoutKey"];var K=e({},J.section);K.sEntitySet=C.sEntitySet;K.sFacet=C.sFacetId;K.sFacetExtensionKey=C.oExtensionDefinition.key||C.sKey;var O=S.getStableId(K);K.type=J.subSection.type;K.subType=J.subSection.subType;var Q=S.getStableId(K);return{id:O,additionalData:{facetId:C.sFacetId},extensionPointName:C.sExtensionPointName,extensionPointNamePrefix:C.sExtensionPointNamePrefix,subSections:[{id:Q,additionalData:{facetId:C.sFacetId},temporaryData:{},extensionPointName:C.sExtensionPointName,extensionPointNamePrefix:C.sExtensionPointNamePrefix,blocks:[]}]};}function r(){var V=c.getViewExtensions()||{};return Object.keys(V).map(function(i){var K=i.split("|");return{sExtensionPointNamePrefix:K[0],sEntitySet:K[1],sFacetId:K[2],sKey:K[3],oExtensionDefinition:V[i],sExtensionPointName:i};}).filter(function(i){return i.sEntitySet===L;});}function u(i){var V=r();var R=[];i.forEach(function(C){var H=V.filter(function(K){return K.sFacetId===C.additionalData.facetId&&K.sExtensionPointNamePrefix==="BeforeFacet";});var J=V.filter(function(K){return K.sFacetId===C.additionalData.facetId&&K.sExtensionPointNamePrefix==="AfterFacet";});R=R.concat(H.map(q.bind(null,"BeforeFacet")));R.push(C);R=R.concat(J.map(q.bind(null,"AfterFacet")));});return R;}function v(i){var V=r();var C=V.find(function(H){return H.sFacetId===i.additionalData.facetId&&H.sExtensionPointNamePrefix==="SmartFormExtension";});if(C){i.extensionPointName=C.sExtensionPointName;i.extensionPointNamePrefix="SmartFormExtension";i.additionalData.type="SmartForm";}}function N(i){n(i);v(i);}function I(i){if(i.annotations.Facet.annotation.RecordType!=="com.sap.vocabularies.UI.v1.ReferenceFacet"){return false;}if(!i.targetAnnotation||!i.targetAnnotation.Data){return true;}return i.targetAnnotation.Data.find(function(C){return(C.RecordType!=="com.sap.vocabularies.UI.v1.DataFieldForAction"&&C.RecordType!=="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation");});}function P(i){return i.additionalData.type==="SmartForm";}function w(i){n(i);i.blocks.forEach(N);i.actions=[];i.blocks.forEach(function(J){var K=A.resolvePath(m.getContext(J.metaModelPath+"/Target"));if(!J.targetAnnotation||!J.targetAnnotation.Data){return;}J.targetAnnotation.Data.forEach(function(O,Q){if(!O||!O.Action||(O.RecordType!=="com.sap.vocabularies.UI.v1.DataFieldForAction"&&O.RecordType!=="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")){return;}var R=S.getStableId({type:"ObjectPage",subType:"DataField",sRecordType:O.RecordType,sSemanticObject:O.SemanticObject&&(O.SemanticObject.String||O.SemanticObject.Path),sAction:O.Action&&(O.Action.String||O.Action.Path)});var T="._templateEventHandlers.";if(O.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"){var U=[];U.push("'"+O.Action.String+"'");U.push("${$source>/text}");var V=(O.InvocationGrouping&&O.InvocationGrouping.EnumMember)||"";U.push("'"+V+"'");T+="onCallAction("+U+")";}else{T+="onDataFieldForIntentBasedNavigation";}i.actions.push({id:S.getStableId({type:"ObjectPageAction",subType:"AnnotatedAction",sFacet:J.additionalData.facetId,sDataField:R}),press:T,metaModelPath:K+"/Data/"+Q});});});i.blocks=i.blocks.filter(I);if(i.temporaryData.potentiallySeparateForms&&!i.blocks.every(P)){i.blocks=i.blocks.map(function(J){if(P(J)){return{additionalData:{type:J.additionalData.type,facetId:J.additionalData.facetId},metaModelPath:J.metaModelPath,controlProperties:{id:S.getStableId({type:"ObjectPageSection",subType:"SmartForm",sFacet:J.additionalData.facetId,sIsPartOfPreview:J.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool})},aggregations:{groups:[J]}};}else{return J;}});i.moreBlocks=i.blocks.filter(function(J){if(J.additionalData.type==="SmartForm"){return J.aggregations.groups[0].annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="false";}else{return J.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="false";}});i.blocks=i.blocks.filter(function(J){if(J.additionalData.type==="SmartForm"){return J.aggregations.groups[0].annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="true";}else{return J.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="true";}});}else{var C={additionalData:{type:"SmartForm",facetId:i.additionalData.facetId},controlProperties:{id:S.getStableId({type:"ObjectPageSection",subType:"SmartForm",sFacet:i.additionalData.facetId,sIsPartOfPreview:"true"})},aggregations:{groups:i.blocks.filter(function(J){return P(J)&&J.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="true";})}};var H={additionalData:{type:"SmartForm",facetId:i.additionalData.facetId},controlProperties:{id:S.getStableId({type:"ObjectPageSection",subType:"SmartForm",sFacet:i.additionalData.facetId,sIsPartOfPreview:"false"})},aggregations:{groups:i.blocks.filter(function(J){return P(J)&&J.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="false";})}};i.moreBlocks=i.blocks.filter(function(J){return!P(J)&&J.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="false";});i.blocks=i.blocks.filter(function(J){return!P(J)&&J.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="true";});if(C.aggregations.groups.length>0){i.blocks.unshift(C);}if(H.aggregations.groups.length>0){i.moreBlocks.unshift(H);}}i.bShowTitle=k(i);}function x(){return true;}function y(i){n(i);i.subSections.forEach(w);i.subSections=i.subSections.filter(x);}function z(){return true;}function B(){var i=m.getMetaContext("/"+L).getPath();var C=a(i+"/com.sap.vocabularies.UI.v1.Facets",false);var H=u(C);H.forEach(y);return H.filter(z);}return{sections:B(),breadCrumb:c.getBreadCrumbInfo(),isSelflinkRequired:true,isIndicatorRequired:true,isSemanticallyConnected:false,targetEntities:t};}return{getTemplateSpecificParameters:g};});
