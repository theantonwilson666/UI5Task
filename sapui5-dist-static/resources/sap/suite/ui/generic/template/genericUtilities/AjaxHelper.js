sap.ui.define(["sap/ui/util/XMLHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/genericUtilities/FeError"],function(X,t,F){"use strict";var c="genericUtilities.AjaxHelper";var R={ERROR:"error",PARSING_ERROR:"parsing error",DATA_TYPE_NOT_SUPPORTED:"data type not supported",SUCCESS:"success"};var a={};var b="GET";var d=["text","json","xml","plain"];a.ajax=function(s){if(!s||typeof s!=="object"){throw new F(c,"send a valid setting object to call ajax");}var j=(s&&s.async)===undefined?true:s.async;var k=s.type||b;var u=s.url;if(!u||typeof u!=="string"){throw new F(c,"Provide a proper url to make AJAX call");}var l=i(s.data);var m=k===b;if(l&&m){u=u+"?"+l;}t.testable(h,"handelResponse");t.testable(i,"encodeData");t.testable(p,"parseJson");t.testable(g,"parseXML");var r=new XMLHttpRequest();if(j){var P=new Promise(function(q,v){r.addEventListener("load",T);r.addEventListener("error",w);r.addEventListener("abort",x);r.open(k,u,j);r.setRequestHeader('Content-Type','application/x-www-form-urlencoded');m?r.send():r.send(l);function T(y){var z=h(y,s);if(z.success){return q(z);}return v(z);}function w(y){v(e(y));}function x(y){v(f(y));}});return P;}else{var n;r.addEventListener("load",function T(q){n=h(q,s);});r.addEventListener("error",function T(q){n=e(q);});r.addEventListener("abort",function T(q){n=f(q);});r.open(k,u,j);r.setRequestHeader('Content-Type','application/x-www-form-urlencoded');try{m?r.send():r.send(l);}catch(o){n={};n.statusCode=r.status;n.request=r;n.success=false;n.textStatus=R.ERROR;n.error=o;}return n;}};a.getJSON=function(u){return new Promise(function(r,j){a.ajax({url:u,async:true,dataType:"json"}).then(function(k){r(k.data);}).catch(function(k){j(k.error);});});};a.sjax=function(s){if(s.async){throw new F(c,"AjaxHelper.sjax should not be called with async flag set");}s.async=false;return this.ajax(s);};a.syncGetJSON=function(u){return a.sjax({url:u,dataType:"json"});};function h(j,s){var k=j.target.status;var r={};var l=s.dataType;var m=(k>=200&&k<300)||k===304;if(m){if(l){switch(l){case"json":r=p(j.target.responseText);break;case"xml":r=g(j.target.responseText);break;case"text":r.data=j.target.responseText;break;default:r.success=false;r.textStatus=R.ERROR;r.error=R.DATA_TYPE_NOT_SUPPORTED;}}else{var n=j.target.getResponseHeader("content-type");if(n){var o=n.split("/")[1].split(";")[0];if(d.indexOf(o)+1){l=o;r.request=j.target;switch(l){case"json":r=p(j.target.responseText);break;case"xml":r=g(j.target.responseText);break;default:r.data=j.target.responseText;break;}}else{r.success=false;r.textStatus=R.ERROR;r.error=R.DATA_TYPE_NOT_SUPPORTED;}}}}else{r.success=false;r.textStatus=R.ERROR;r.error=j.target.statusText||R.ERROR;}r.request=j.target;r.statusCode=j.target.status;r.success=r.success!==false;if(r.success){r.textStatus=R.SUCCESS;}return r;}function e(j){var r={};r.statusCode=j.target.status;r.request=j.target;r.success=false;r.textStatus=R.ERROR;r.error=j.target.statusText||R.ERROR;return r;}function f(j){var r={};r.statusCode=j.target.status;r.request=j.target;r.success=false;r.textStatus="aborted";return r;}function p(j){var r={};try{r.data=j===""?undefined:JSON.parse(j);}catch(k){r.success=false;r.textStatus=R.PARSING_ERROR;r.error=k;}return r;}function g(x){var r={};var o=X.parse(x);if(o.parseError.errorCode!==0){r.success=false;r.textStatus=R.PARSING_ERROR;r.error=o.parseError.reason;return r;}r.data=o;return r;}function i(j){var l;if(j){l=typeof j=='string'?j:Object.keys(j).map(function(k){return encodeURIComponent(k)+'='+encodeURIComponent(j[k]);}).join('&');}return l;}return a;});
