sap.ui.define(["sap/ui/base/Object","sap/base/util/extend"],function(B,e){"use strict";function g(c,t,v,s){var i=t.oComponentUtils.isDraftEnabled();var C=t.oComponentUtils.getCRUDActionHandler();var b=t.oServices.oApplication.getBusyHelper();var V=c.getView();var u=V.getModel("ui");var o;var a;var I=false;var d=false;var f;var h;if(i&&t.oComponentUtils.getViewLevel()!==1){h=Function.prototype;}function F(){h();f=null;h=null;}function j(){d=false;if(I){o.close();}else{F();}}function O(m,p){if(!a){a=t.oCommonUtils.getDialogFragmentAsync("sap.suite.ui.generic.template.fragments.DiscardEditPopover",{onDiscardConfirm:function(){if(!I||d){return;}f();m.setEnabled(true);},beforeClose:function(){I=false;F();},afterClose:function(){m.setEnabled(true);}},"discard",function(q,r){r.setProperty("/placement",sap.m.PlacementType.Top);});}a.then(function(q){I=true;o=q;var r=o.getModel("discard");r.setProperty("/isCreate",p);m.setEnabled(false);o.openBy(m);});}function k(){if(i){var m=V.getBindingContext();return t.oServices.oApplication.getNavigateAfterDraftCancelPromise(m).then(function(N){return function(){t.oServices.oViewDependencyHelper.setRootPageToDirty();t.oServices.oViewDependencyHelper.unbindChildren(c.getOwnerComponent());t.oServices.oApplication.invalidatePaginatorInfo();N();};});}return Promise.resolve(function(){if(u.getProperty("/createMode")){var T=c.getOwnerComponent().getModel("_templPrivGlobal");var p=T.getProperty("/generic/FCL");return(p&&p.highestViewLevel===1)?t.oServices.oNavigationController.navigateToRoot():t.oServices.oNavigationController.navigateBack();}});}function n(){return new Promise(function(r){if(i){var m=V.getBindingContext();var p=m.getPath();C.hasValidationMessageOnDetailsViews().then(function(H){var q=t.oServices.oApplication.getIsDraftModified(p)||H;r(q);});}else{r(t.oComponentUtils.isComponentDirty());}});}function l(){if(i){var m=V.getBindingContext();var E=m.getObject();var p=E.hasOwnProperty("HasActiveEntity")&&!m.getProperty("IsActiveEntity")&&!m.getProperty("HasActiveEntity");return p;}return u.getProperty("/createMode");}function D(m){if(h){return Promise.reject();}if(!(t.oComponentUtils.isComponentActive()&&u.getProperty("/editable"))){return Promise.reject();}var r=new Promise(function(R,p){h=p;var E=k();var P=function(){if(m&&b.isBusy()){F();return;}var q=function(){d=true;var w=E.then(function(A){var S=function(){h=R;A();j();};var x;if(i){x=t.oServices.oCRUDManager.discardDraft(V.getBindingContext()).then(S);x.catch(j);}else{S();}t.oComponentUtils.cancelEdit(x);return x;});b.setBusy(w);};n().then(function(N){if(m&&N){f=q;O(m,l());}else{q();}});};t.oServices.oApplication.performAfterSideEffectExecution(P);});r.catch(Function.prototype);return r;}return{discardEdit:D};}return B.extend("sap.suite.ui.generic.template.detailTemplates.DiscardEditHandler",{constructor:function(c,t,v,s){e(this,g(c,t,v,s));}});});
