sap.ui.define(["sap/ui/base/Object","sap/ui/Device","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/ActionSheet","sap/m/Dialog","sap/m/Popover","sap/suite/ui/generic/template/lib/deletionHelper","sap/suite/ui/generic/template/lib/navigation/routingHelper","sap/suite/ui/generic/template/lib/ContextBookkeeping","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/lib/StatePreserver","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/genericUtilities/oDataModelHelper","sap/ui/core/syncStyleClass","sap/base/util/extend","sap/ui/core/Fragment","sap/ui/generic/app/navigation/service/NavigationHandler"],function(B,D,J,M,A,a,P,d,r,C,b,S,t,F,o,s,e,c,N){"use strict";var G={storeInnerAppStateWithImmediateReturn:function(){return{promise:{fail:Function.prototype}};},parseNavigation:function(){return{done:function(H){setTimeout(H.bind(null,{},{},sap.ui.generic.app.navigation.service.NavType.initial),0);},fail:Function.prototype};}};var l=new F("lib.Application").getLogger();var f=(t.testableStatic(function(T,i){var k="sapUiSizeCozy",m="sapUiSizeCompact";if(i&&(i.classList.contains(k)||i.classList.contains(m))){return"";}else{return T?k:m;}},"Application_determineContentDensityClass")(D.support.touch,document.body));function g(){return f;}function h(i,p){s(f,p,i);p.addDependent(i);}var h=t.testableStatic(h,"Application_attachControlToParent");function j(T){var k=new C(T);var E;var n=Object.create(null);function m(i){var w1=T.oNavigationControllerProxy.getActiveComponents();return w1.indexOf(i.getId())>=0;}var I=false;function p(i){T.fnAddSideEffectPromise(i);}function q(i,w1){if(I){return;}var x1=T.aRunningSideEffectExecutions.filter(function(y1){return!!y1;});if(x1.length){I=true;Promise.all(x1).then(function(){I=false;q(i,w1);});}else if(w1&&T.oBusyHelper.isBusy()){if(typeof w1==="function"){w1();}}else{i();}}function u(i){var w1;if(i instanceof a){w1="open";}else if(i instanceof P||i instanceof A){w1="openBy";}if(w1){var x1=i[w1];i[w1]=function(){var y1=arguments;q(function(){if(!T.oBusyHelper.isBusy()){T.oBusyHelper.getUnbusy().then(function(){x1.apply(i,y1);});}});};}}var v={};function w(i,w1,x1,y1,z1){i=i||T.oNavigationHost;var A1=i.getId();var B1=v[A1]||(v[A1]={});var C1=B1[w1];if(!C1){C1=sap.ui.xmlfragment(A1,w1,x1);h(C1,i);var D1;if(y1){D1=new J();C1.setModel(D1,y1);}(z1||Function.prototype)(C1,D1);B1[w1]=C1;u(C1);}return C1;}function x(i,w1,x1,y1,z1,A1){return new Promise(function(B1){i=i||T.oNavigationHost;var C1=i.getId();var D1=v[C1]||(v[C1]={});var E1=D1[w1];if(!E1||A1){if(E1){E1.destroy();}c.load({id:C1,name:w1,controller:x1,type:"XML"}).then(function(F1){E1=F1;h(F1,i);var G1;if(y1){G1=new J();F1.setModel(G1,y1);}(z1||Function.prototype)(F1,G1);D1[w1]=F1;u(F1);B1(E1);});return;}B1(E1);});}function y(){return new Promise(function(i){T.oNavigationObserver.getProcessFinished(true).then(function(){T.oBusyHelper.getUnbusy().then(i);});});}function O(){T.oDataLossHandler.performIfNoDataLoss(function(){T.oNavigationControllerProxy.navigateBack();},Function.prototype);}function z(i,w1,x1){var y1=b.createNonDraft(null,"/"+i,T.oAppComponent.getModel(),w1,t1());if(x1){x1.aCreateContexts=x1.aCreateContexts||[];x1.aCreateContexts.push({entitySet:i,context:y1,predefinedValues:w1});}return y1;}function H(i){T.oNavigationControllerProxy.navigateForNonDraftCreate(i.entitySet,i.predefinedValues,i.context);}function K(w1){var x1=T.oNavigationControllerProxy.getActiveComponents();for(var i=0;i<x1.length;i++){var y1=T.componentRegistry[x1[i]];y1.utils.onBeforeDraftTransfer(w1);}}function L(i,w1){K(w1);k.activationStarted(i,w1);}function Q(i,w1,x1){K(w1);k.cancellationStarted(i,w1,x1);}function R(i,w1){K(w1);k.editingStarted(i,w1);}function U(i){return k.checkmPath2ContextData(i);}function V(i){T.aStateChangers.push(i);}function W(i,w1){w1.then(function(){k.adaptAfterObjectDeleted(i);},Function.prototype);}function X(){return T.oNavigationControllerProxy.getLinksToUpperLayers();}function Y(){var w1=T.oNavigationControllerProxy.getActiveComponents();var x1=0;var y1;for(var i=0;i<w1.length;i++){var z1=T.componentRegistry[w1[i]];if(z1.viewLevel>0&&(x1===0||z1.viewLevel<x1)){x1=z1.viewLevel;y1=z1.oComponent;}}var A1=y1?Promise.resolve(y1):T.oNavigationControllerProxy.getRootComponentPromise();return A1.then(function(B1){return B1.getModel("i18n").getResourceBundle();});}function Z(){return T.oNavigationControllerProxy.getAppTitle();}function $(i){return T.oNavigationControllerProxy.getCurrentKeys(i);}function _(i,w1){var x1=i;for(;x1.level>w1;){x1=T.mRoutingTree[x1.parentRoute];}return x1;}var a1;function b1(w1,x1){var i=x1||0;if(i>0){return null;}var y1=w1.getId();var z1=T.componentRegistry[y1];var A1=T.mRoutingTree[z1.route];var B1=A1.communicationObject;for(;i<0&&B1;){A1=T.mRoutingTree[A1.parentRoute];if(A1.communicationObject!==B1){i++;B1=A1.communicationObject;}}if(i<0||B1){return B1;}a1=a1||{};return a1;}function c1(i){for(var w1 in T.mEntityTree){if(T.mEntityTree[w1].navigationProperty&&(T.mEntityTree[w1].level===i+1)){return T.mEntityTree[w1].navigationProperty;}}}function d1(){var i=T.oNavigationControllerProxy.getCurrentIdentity();for(var w1=i.treeNode;w1.level>0;w1=T.mRoutingTree[w1.parentRoute]){if(w1.level===1&&w1.isDraft){var x1=w1.getPath(3,i.keys);k.markDraftAsModified(x1);return;}}}function e1(){if(E!==undefined){return E;}var i,w1,x1,y1,z1,A1,B1=true;var C1=T.oAppComponent.getModel();var D1=C1.getMetaModel();var E1=C1.mContexts;for(x1 in E1){B1=false;z1=E1[x1].sPath;y1=z1&&z1.substring(1,z1.indexOf('('));A1=y1&&D1.getODataEntitySet(y1);if(A1){i=C1.getProperty(z1);w1=i&&C1.getETag(undefined,undefined,i)||null;if(w1){E=true;return E;}}}if(B1){return true;}E=false;return E;}function f1(w1){var i,x1,y1;var z1=T.oNavigationControllerProxy.getAllComponents();for(i=0;i<z1.length;i++){x1=z1[i];if(!w1||!w1[x1]){y1=T.componentRegistry[x1];y1.utils.refreshBinding(true);}}}function g1(i){if(T.oFlexibleColumnLayoutHandler){T.oFlexibleColumnLayoutHandler.setStoredTargetLayoutToFullscreen(i);}}function h1(){T.oPaginatorInfo={};}function i1(i){return new S(T,i);}function j1(w1,x1){var y1=n[w1];if(!y1){y1=Object.create(null);n[w1]=y1;var z1=T.oAppComponent.getModel();var A1=z1.getMetaModel();var B1=A1.getODataEntitySet(w1);var C1=B1&&A1.getODataEntityType(B1.entityType);var D1=(C1&&C1.navigationProperty)||[];for(var i=0;i<D1.length;i++){var E1=D1[i];y1[E1.name]=E1;}}return y1[x1];}function k1(i,w1){var x1=T.oNavigationControllerProxy.getSwitchToSiblingPromise(i,2,w1);T.oBusyHelper.setBusy(x1.then(function(y1){y1();}));}function l1(i){var w1=T.oNavigationControllerProxy.getSpecialDraftCancelPromise(i);if(w1){return w1;}var x1=k.getDraftSiblingPromise(i);var y1=T.oNavigationControllerProxy.getCurrentIdentity();var z1=T.componentRegistry[y1.treeNode.componentId];var A1=z1&&z1.utils.getTargetKeyFromLevel(2);return Promise.all([x1,A1]).then(function(B1){var C1=B1[0];var D1=C1&&C1.getObject();var E1=D1&&D1.IsActiveEntity;if(!E1){return Promise.resolve(d.getNavigateAfterDeletionOfCreateDraft(T));}return T.oNavigationControllerProxy.getSwitchToSiblingPromise(C1,1,B1[1]).then(function(F1){return function(){var G1=C1.getModel();G1.invalidateEntry(C1);return F1();};});});}function m1(i,w1){var x1=[];for(var y1=i;y1.level>=w1;y1=T.mRoutingTree[y1.parentRoute]){x1.push(y1);if(y1.level===0){break;}}return x1.reverse();}function n1(w1,x1,y1,z1){if(y1.length===0){y1.push("");}if(w1.level<y1.length){y1.splice(w1.level+1,y1.length-w1.level-1);return Promise.resolve(w1);}var A1=m1(w1,y1.length);var B1=A1.map(function(i){if(i.noKey||i.level===0){return Promise.resolve(true);}if(!i.isDraft){return Promise.resolve(x1[i.level]);}var C1=i.getPath(3,x1);var D1=k.getSiblingPromise(C1,z1);return D1.then(function(E1){var F1=E1&&o.analyseContext(E1);return F1&&F1.key;},Function.prototype);});return Promise.all(B1).then(function(C1){var D1=T.mRoutingTree[A1[0].parentRoute];C1.every(function(E1,i){if(E1){y1.push(E1===true?"":E1);D1=A1[i];}return E1;});return D1;});}function o1(i){return T.oNavigationControllerProxy.navigateAfterActivation(i);}function p1(i,w1,x1,y1){T.oNavigationControllerProxy.navigateToSubContext(i,w1,x1,y1);}function q1(i,w1){T.oNavigationControllerProxy.navigateByExchangingQueryParam(i,w1);}function r1(){return!T.bCreateRequestsCanonical;}function s1(){return T.oNavigationControllerProxy.getParsedShellHashFromFLP();}function t1(){return!T.bCreateRequestsCanonical;}var u1;function v1(){u1=u1||new N(T.oAppComponent);return T.ghostapp?G:u1;}T.oApplicationProxy={getDraftSiblingPromise:k.getDraftSiblingPromise,getSiblingPromise:k.getSiblingPromise,fillSiblingKeyPromise:n1,getAlternativeIdentityPromise:k.getAlternativeIdentityPromise,getPathOfLastShownDraftRoot:k.getPathOfLastShownDraftRoot,areTwoKnownPathesIdentical:k.areTwoKnownPathesIdentical,getIdentityKeyForContext:k.getIdentityKeyForContext,getAncestralNode:_,getResourceBundleForEditPromise:Y,getContentDensityClass:g,getDialogFragment:w.bind(null,null),getDialogFragmentAsync:x.bind(null,null),destroyView:function(i){delete v[i];},markCurrentDraftAsModified:d1,prepareDeletion:W,performAfterSideEffectExecution:q,onBackButtonPressed:O,mustRequireRequestsCanonical:t1};return{createNonDraft:z,navigateToNonDraftCreateContext:H,getContentDensityClass:g,attachControlToParent:h,getDialogFragmentForView:w,getDialogFragmentForViewAsync:x,getBusyHelper:function(){return T.oBusyHelper;},addSideEffectPromise:p,performAfterSideEffectExecution:q,isComponentActive:m,showMessageToast:function(){var i=arguments;var w1=function(){l.info("Show message toast");M.show.apply(M,i);};Promise.all([y(true),T.oBusyHelper.getUnbusy()]).then(w1);},registerStateChanger:V,getDraftSiblingPromise:k.getDraftSiblingPromise,registerContext:k.registerContext,activationStarted:L,cancellationStarted:Q,editingStarted:R,checkContextData:U,getLinksToUpperLayers:X,getAppTitle:Z,getCurrentKeys:$,getCommunicationObject:b1,getForwardNavigationProperty:c1,markCurrentDraftAsModified:d1,checkEtags:e1,refreshAllComponents:f1,getIsDraftModified:k.getIsDraftModified,prepareDeletion:d.prepareDeletion.bind(null,T),setStoredTargetLayoutToFullscreen:g1,invalidatePaginatorInfo:h1,getStatePreserver:i1,getNavigationProperty:j1,switchToDraft:k1,getNavigateAfterDraftCancelPromise:l1,navigateAfterActivation:o1,navigateToSubContext:p1,navigateByExchangingQueryParam:q1,onBackButtonPressed:O,needsToSuppressTechnicalStateMessages:r1,mustRequireRequestsCanonical:t1,getNavigationHandler:v1,getParsedShellHashFromFLP:s1};}return B.extend("sap.suite.ui.generic.template.lib.Application",{constructor:function(T){e(this,j(T));}});});
