sap.ui.define(["sap/ui/base/Object","sap/ui/model/base/ManagedObjectModel","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/lib/CRUDActionHandler","sap/base/util/extend","sap/base/util/isEmptyObject","sap/suite/ui/generic/template/genericUtilities/FeError"],function(B,M,c,F,C,e,a,b){"use strict";var s="lib.ComponentUtils";var l=new F(s).getLogger();var d={isPreliminary:function(){return false;}};function g(o,f){var t=f.oTemplateContract.mRoutingTree[f.route];var h;var H;var j;var k;var m;var I=false;var L;var n=[];var N=false;var E=[];function p(){return o.getModel("_templPriv");}function q(i){f.oTemplateContract.oNavigationControllerProxy.preloadComponent(i);}function r(){var i=o.getAppComponent();return i.getModel("_templPrivGlobal");}function u(){return t.level;}function v(){var i=f.oTemplateContract.oApplicationProxy.getAncestralNode(t,1);if(i){var R1={};var S1=i.getPath(2,s1());R1.bindingContext=o.getModel().createBindingContext(S1)||o.getModel().getContext(S1);R1.entitySet=i.entitySet;R1.view=i.componentId&&f.oTemplateContract.componentRegistry[i.componentId].oController.getView();R1.componentId=i.componentId;return R1;}return null;}function w(){var i=f.oTemplateContract.oApplicationProxy.getAncestralNode(t,1);if(!i.componentId){q(i.sRouteName);}return i.componentCreated.then(function(o){var R1=f.oTemplateContract.componentRegistry[o.getId()];return R1.viewRegistered.then(function(){return{getText:R1.oControllerUtils.oCommonUtils.getText,getRootExpand:R1.oControllerUtils.oComponentUtils.getRootExpand};});});}function x(){return f.preprocessorsData;}function y(R1){var S1=f.oTemplateContract.oNavigationControllerProxy.getCurrentIdentity();var T1=S1.keys;var U1=[];for(var i=0;i<R1;i++){U1[i]="";}var V1=f.oTemplateContract.oApplicationProxy.fillSiblingKeyPromise(S1.treeNode,T1,U1,"Changes");return V1.then(function(W1){return{keys:U1,treeNode:W1};});}function z(){var i=x();if(i&&i.rootContextExpand){return i.rootContextExpand.join(',');}}function A(){return f.oParameterModel;}function D(i,R1,S1){if(typeof S1!=="function"){throw new b(s,"Event handler must be a function");}E.push({template:i,event:R1,handler:S1});}function G(R1,S1,T1){for(var i=E.length;i--;){if(E[i].handler===T1&&E[i].event===S1&&E[i].template===R1){E.splice(i,1);}}}function J(R1,S1,T1){for(var i=0;i<E.length;i++){if(E[i].event===S1&&E[i].template===R1){E[i].handler(T1);}}}function K(i){return i.getMetadata().getName();}function O(){return f.oApplication.isComponentActive(o);}function P(){return f.oNavigationObserver.getProcessFinished(true);}function Q(i,R1){var S1=P();S1.then(function(){if(O()){if(R1){c1(true);}J(K(f.oController),"PageDataLoaded",{context:i});if(i&&y1()){var T1=i.getObject();if(!T1.IsActiveEntity){f.oApplication.getDraftSiblingPromise(i);}}}});}function R(){h.then(function(i){if(i){Q(i);}});}function S(){f.oHeaderLoadingObserver.startProcess();if(!m){var i=new Promise(function(R1){m=R1;});f.oApplication.getBusyHelper().setBusy(i);}}function T(){if(!H){h=new Promise(function(i){H=i;});}}if(t.getPath(3)){T();}else{h=Promise.resolve();}function U(i){l.info("Request header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");I=true;T();if(!o.getComponentContainer().getElementBinding().isSuspended()){S();}}function V(){if(m){m();m=null;}f.oHeaderLoadingObserver.stopProcess();}function W(i){var R1=i.getSource().getBoundContext();if(R1){return R1;}if(o.getComponentContainer().getElementBinding().isSuspended()){R1=null;}else{R1=d;}a1();return R1;}function X(){f.oTemplateContract.oNavigationControllerProxy.navigationContextNotFound();}function Y(){I=false;if(!k){return;}if(k===d){X();a1();}else if(!o.getComponentContainer().getElementBinding().isSuspended()){var i=o.getBindingContext();var R1=o1(i);var S1=R1.bIsDraft||N;var T1;if(S1){N=false;T1=R1.bIsCreate?4:2;}else{T1=1;}var U1=p();U1.setProperty("/objectPage/displayMode",T1);var V1=o.getModel("ui");V1.setProperty("/enabled",true);V1.setProperty("/createMode",R1.bIsCreate);V1.setProperty("/editable",S1);(f.methods.updateBindingContext||Function.prototype)(i);if(H){H(k);}}else{return;}H=null;k=null;}function Z(i){l.info("Received header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");j();V();if(I){k=W(i);}Y();}function $(i){j();var R1=W(i);if(R1&&R1.isPreliminary()){return;}k=R1;Y();f.oHeaderLoadingObserver.stopProcess();}function _(i){f.oHeaderLoadingObserver.startProcess();var R1=new Promise(function(S1){j=S1;});T();if(f.methods.beforeRebind){f.methods.beforeRebind(R1);}k=null;t.bindElement(o.getComponentContainer(),i,false,{dataRequested:U,dataReceived:Z,change:$});L=i;if(f.methods.afterRebind){f.methods.afterRebind();}}function a1(){T();var i=o.getComponentContainer();i.unbindElement();i.setBindingContext();L=null;k=null;I=false;V();}function b1(){var R1=s1();var S1=(R1.length===n.length);for(var i=0;i<R1.length&&S1;i++){S1=R1[i]===n[i];}n=R1;return!S1;}function c1(i){f.reuseComponentsReady.then(function(R1){for(var S1 in R1){R1[S1].pathUnchangedCallBack(i);}});}function d1(i,R1){var S1=Object.create(null);for(var T1 in i){var U1=i[T1];S1[T1]=R1(U1,T1);}return S1;}function e1(){var i=p();for(var R1 in t.embeddedComponents){var S1=!!t.embeddedComponents[R1].definition.hiddenByDefault;i.setProperty("/generic/embeddedComponents/"+R1+"/hidden",S1);}}function f1(i,R1){var S1=b1();if(S1&&!R1){e1();}if(!i){if(f.routingSpec&&f.routingSpec.noOData){Q(null,S1);}return;}var T1=o.getComponentContainer();if(!T1){return;}var U1=o.getModel("ui");var V1=!!f.nonDraftCreateContext;if(V1){var W1=T1.getBindingContext();if(W1===f.nonDraftCreateContext){return;}U1.setProperty("/enabled",true);U1.setProperty("/editable",true);U1.setProperty("/createMode",true);a1();if(H){H(f.nonDraftCreateContext);H=null;}else{h=Promise.resolve(f.nonDraftCreateContext);}R();if(f.methods.beforeRebind){f.methods.beforeRebind(h);}T1.setBindingContext(f.nonDraftCreateContext);Promise.all([f.oViewRenderedPromise,f.viewRegistered]).then(c1.bind(null,true));if(f.methods.afterRebind){f.methods.afterRebind();}}else{var X1=T1.getElementBinding();if(X1){if(L===i){if(X1.isSuspended()){X1.resume();Y();}if(I){S();}f.oApplication.getBusyHelper().getUnbusy().then(c1.bind(null,S1));if(!R1){R();}if(!R1&&!y1()){U1.setProperty("/editable",false);}U1.setProperty("/enabled",true);return;}else if(!R1){a1();}}U1.setProperty("/enabled",false);U1.setProperty("/editable",false);U1.setProperty("/createMode",false);_(i);R();}}function g1(i,R1){var S1={};if(i){S1.discardPromise=i;}var T1=o.getModel();if(T1.hasPendingChanges()){var U1=f.oController.getView();U1.setBindingContext(null);T1.resetChanges();U1.setBindingContext();}var V1=o.getModel("ui");if(R1||V1.getProperty("/editable")){delete f.nonDraftCreateContext;V1.setProperty("/editable",false);if(i){i.catch(function(){V1.setProperty("/editable",true);});}else{var W1=p();W1.setProperty("/objectPage/displayMode",1);}J(K(f.oController),"AfterCancel",S1);}}function h1(i,R1){return y1()?null:f.oTemplateContract.oNavigationControllerProxy.navigateForNonDraftCreate(i,R1);}function i1(i,R1){N=R1;f.oTemplateContract.oNavigationControllerProxy.adaptUrlAfterNonDraftCreateSaved(i);}function j1(){var i=o.getComponentContainer().getElementBinding();if(i){o.getModel().invalidateEntry(i.getBoundContext());if(i.isSuspended()){a1();}else{i.refresh(true);}}}function k1(i){i=i||o.getIsRefreshRequired();if(i||!a(f.mRefreshInfos)){(f.methods.refreshBinding||Function.prototype)(i,f.mRefreshInfos);o.setIsRefreshRequired(false);f.mRefreshInfos=Object.create(null);}c1(i);}function l1(){var i=o.getModel();var R1={canonicalRequest:!f.oTemplateContract.bCreateRequestsCanonical,batchGroupId:"facets",updateAggregatedMessages:true};i.read(L,R1);}function m1(i){if(y1()){var R1=o.getComponentContainer();var S1=R1.getElementBinding();if(S1&&!S1.isSuspended()){S1.suspend();i.catch(function(){S1.resume();});}}}function n1(){var i=o.getComponentContainer();if(f.nonDraftCreateContext){i.setBindingContext();delete f.nonDraftCreateContext;return;}var R1=i.getElementBinding();if(R1&&!R1.isSuspended()){if(f.oTemplateContract.oValidationMessageBinding.getLength()){a1();}else{R1.suspend();}V();}}function o1(i){var R1=u();return f.oApplication.registerContext(i,R1,o.getEntitySet(),s1());}function p1(i){if(i.level<2){return[i.entitySet];}var R1=f.oTemplateContract.mRoutingTree[i.parentRoute];var S1=p1(R1);if(i!==t){S1.push(i.navigationProperty?S1[R1.level-1]+"/"+i.navigationProperty:i.entitySet);}return S1;}function q1(){return t.level<2?[]:p1(t);}function r1(i,R1,S1){var T1;for(T1=t;T1.level>S1;){T1=f.oTemplateContract.mRoutingTree[T1.parentRoute];}var U1=new M(i);U1.bindProperty("/"+R1).attachChange(function(V1){var W1=V1.getSource().getValue();f.oTemplateContract.oNavigationControllerProxy.setTextForTreeNode(T1,W1);});T1.contextTargets=T1.contextTargets||[];T1.contextTargets.push(i);}function s1(){return f.oApplication.getCurrentKeys(u());}function t1(i){return f.oApplication.getCommunicationObject(o,i);}function u1(i,R1,S1,T1){f.oTemplateContract.oNavigationControllerProxy.navigateToChild(t,i,S1,R1,T1);}function v1(i,R1,S1){f.oTemplateContract.oNavigationControllerProxy.navigateFromNodeAccordingToContext(t,i,R1,S1);}function w1(){return t.headerTitle;}function x1(i){f.oTemplateContract.oNavigationControllerProxy.setTextForTreeNode(t,i);}function y1(){return t.isDraft;}function z1(){return!(f.routingSpec&&f.routingSpec.noOData);}function A1(){return!f.oTemplateContract.bCreateRequestsCanonical;}function B1(){return h;}function C1(){return f.oTemplateContract.oPaginatorInfo[u()-1];}function D1(i,R1){var S1=u();if(!R1){S1--;}f.oTemplateContract.oPaginatorInfo[S1]=i;}function E1(i,R1){f.reuseComponentsReady.then(function(S1){var T1=R1.getComponentInstance();for(var U1 in S1){if(T1===S1[U1].component){var V1=p();V1.setProperty("/generic/embeddedComponents/"+U1+"/isInVisibleArea",i);return;}}});}function F1(){f.oStatePreserverPromise.then(function(i){i.stateChanged();});}f.oStatePreserverPromise=f.reuseComponentsReady.then(function(i){var R1=f.methods.getStatePreserverSettings&&f.methods.getStatePreserverSettings();if(!R1){return{getUrlParameterInfo:function(){return Promise.resolve({});},applyAppState:Function.prototype,stateChanged:Function.prototype};}var S1="sap-iapp-state"+(t.level===0?"":"-"+t.entitySet);var T1=e({appStateName:encodeURI(S1),getCurrentState:function(){var V1=f.methods.getCurrentState?f.methods.getCurrentState():Object.create(null);var W1=function(X1,Y1){if(X1.component.stGetCurrentState){var Z1=X1.component.stGetCurrentState();for(var $1 in Z1){V1["$embeddedComponent$"+Y1.length+"$"+Y1+"$"+$1]=Z1[$1];}}};d1(i,W1);return V1;},applyState:function(V1,W1){var X1=Object.create(null);var Y1=Object.create(null);for(var Z1 in V1){if(Z1.indexOf("$embeddedComponent$")===0){var $1=Z1.substring(19);var _1=$1.indexOf("$");var a2=Number($1.substring(0,_1));var b2=$1.substring(_1+1,_1+a2+1);var c2=Y1[b2];if(!c2){c2=Object.create(null);Y1[b2]=c2;}var d2=$1.substring(_1+a2+2);c2[d2]=V1[Z1];}else{X1[Z1]=V1[Z1];}}(f.methods.applyState||Function.prototype)(X1,W1);var e2=function(f2,g2){if(f2.component.stApplyState){f2.component.stApplyState(Y1[g2]||Object.create(null),W1);}};Promise.all([f.oViewRenderedPromise,h]).then(d1.bind(null,i,e2));},oComponent:o},R1);var U1=f.oApplication.getStatePreserver(T1);f.oApplication.registerStateChanger(U1.getAsStateChanger());return U1;});f.oTemplateContract.oStatePreserversAvailablePromise=Promise.all([f.oTemplateContract.oStatePreserversAvailablePromise,f.oStatePreserverPromise]);function G1(){var i=f.oTemplateContract.oFlexibleColumnLayoutHandler;return i?i.getFclProxy(t):{handleDataReceived:t.level?null:Function.prototype,isListAndFirstEntryLoadedOnStartup:t.level?null:Function.prototype,isNextObjectLoadedAfterDelete:Function.prototype};}function H1(){return t.page.component.settings||{};}function I1(){var i=o.getAppComponent().getManifestEntry("sap.ui5");var R1=i.extends&&i.extends.extensions&&i.extends.extensions["sap.ui.controllerExtensions"];R1=R1&&R1[o.getTemplateName()];R1=R1&&R1["sap.ui.generic.app"];return R1&&R1[o.getEntitySet()];}function J1(){var i=o.getAppComponent().getManifestEntry("sap.ui5");var R1=i.extends&&i.extends.extensions&&i.extends.extensions["sap.ui.viewExtensions"];return R1&&R1[o.getTemplateName()];}function K1(i){f.aUnsavedDataCheckFunctions=f.aUnsavedDataCheckFunctions||[];f.aUnsavedDataCheckFunctions.push(i);}function L1(R1,S1){if(f.methods.getTableForChildContext){var T1=p();var U1=T1.getProperty("/generic/currentActiveChildContext");var V1=U1&&f.methods.getTableForChildContext(U1);if(V1){var W1=V1.getTable();if(c.isMTable(W1)){var X1=W1.getItems();for(var i=0;i<X1.length;i++){var Y1=X1[i];if(Y1.getBindingContextPath()===U1){W1.scrollToIndex(i);break;}}}}}}var M1;function N1(){M1=M1||new C(f.oTemplateContract,f.oController,f.oControllerUtils.oCommonUtils);return M1;}function O1(i){if(f.methods.executeAfterInvokeActionFromExtensionAPI){f.methods.executeAfterInvokeActionFromExtensionAPI(i,f.oControllerUtils.oCommonUtils);}}function P1(i){if(f.methods.executeBeforeInvokeActionFromExtensionAPI){f.methods.executeBeforeInvokeActionFromExtensionAPI(i,f.oControllerUtils.oCommonUtils);}}function Q1(){var i=f.oController.getView();var R1=i.getModel();if(R1.hasPendingChanges(true)){return true;}if(f.aUnsavedDataCheckFunctions){return f.aUnsavedDataCheckFunctions.some(function(S1){return S1();});}return false;}return{getBusyHelper:function(){return f.oApplication.getBusyHelper();},attach:function(i,R1,S1){D(K(i),R1,S1);},detach:function(i,R1,S1){G(K(i),R1,S1);},fire:function(i,R1,S1){J(K(i),R1,S1);},getPreprocessorsData:x,getRootExpand:z,getParameterModelForTemplating:A,bindComponent:f1,cancelEdit:g1,getNonDraftCreatePromise:h1,adaptUrlAfterNonDraftCreateSaved:i1,refreshBinding:k1,refreshBindingUnconditional:j1,suspendBinding:n1,messagesRefresh:l1,getTemplatePrivateModel:p,getTemplatePrivateGlobalModel:r,registerContext:o1,getViewLevel:u,getMainComponentDetails:v,getMainComponentUtils:w,getBreadCrumbInfo:q1,registerAncestorTitleUpdater:r1,getCurrentKeys:s1,getCommunicationObject:t1,navigateRoute:u1,navigateAccordingToContext:v1,getTitle:w1,setText:x1,onBeforeDraftTransfer:m1,isDraftEnabled:y1,isODataBased:z1,getNoStateMessagesForTables:A1,isComponentActive:O,navigateToDataLoadedFailedPage:X,getHeaderDataAvailablePromise:B1,getPaginatorInfo:C1,setPaginatorInfo:D1,onVisibilityChangeOfReuseComponent:E1,getNavigationFinishedPromise:P,stateChanged:F1,unbind:a1,getFclProxy:G1,getSettings:H1,getControllerExtensions:I1,getViewExtensions:J1,registerUnsavedDataCheckFunction:K1,layoutChanged:L1,getCRUDActionHandler:N1,executeAfterInvokeActionFromExtensionAPI:O1,executeBeforeInvokeActionFromExtensionAPI:P1,preloadComponent:q,isComponentDirty:Q1,getTargetKeyFromLevel:y};}return B.extend("sap.suite.ui.generic.template.lib.ComponentUtils",{constructor:function(o,f){e(this,g(o,f));}});});
