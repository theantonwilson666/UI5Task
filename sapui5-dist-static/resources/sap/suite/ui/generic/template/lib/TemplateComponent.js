sap.ui.define(["sap/ui/core/CustomizingConfiguration","sap/ui/core/library","sap/ui/core/Component","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/Device","sap/suite/ui/generic/template/lib/reuseComponentHelper","sap/ui/core/CustomData","sap/suite/ui/generic/template/lib/StableIdDefinition","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/js/AnnotationHelper","sap/base/util/extend","sap/base/util/deepExtend","sap/suite/ui/generic/template/genericUtilities/CacheHelper","sap/suite/ui/generic/template/genericUtilities/FeError","sap/suite/ui/generic/template/js/placeholderHelper"],function(C,c,a,U,J,R,D,r,b,S,d,F,A,e,f,g,h,p){"use strict";var s="lib.TemplateComponent";var l=new F(s).getLogger();var V=c.mvc.ViewType;function j(O){var i=O&&typeof O==="string"?O:(O&&a.getOwnerIdFor(O));var B=i&&a.get(i);if(B instanceof T){B=B.getAppComponent();}return B;}var G=C.getViewExtension;C.getViewExtension=function(i,B,O){var H=j(O),I=H&&H.getId(),K=G.call(C,i,B,I);return K;};var k=C.getControllerExtension;C.getControllerExtension=function(i,O){var B=j(O),H=B&&B.getId(),I=k.call(C,i,H);return I;};function E(B){var I=new R({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"});var H=[];var M=B.getAppComponent().getModel("i18n|"+B.getMetadata().getComponentName()+"|"+B.getEntitySet());if(M){H.push(M);}var K=B.getModel("i18n");if(K){H.push(K);}var L=B.getModel("@i18n");if(L){H.push(L);}var N=true;for(var O="i18n";N;){O=O+"||Parent";N=B.getModel(O);if(N){H.push(N);}}for(var i=H.length-1;i>=0;i--){I.enhance(H[i].getResourceBundle());}B.setModel(I,"i18n");}function m(i,M){var B=i.getAppComponent().getManifestEntry("sap.ui5");var H=B.extends&&B.extends.extensions&&B.extends.extensions["sap.ui.controllerExtensions"];var I=i.getTemplateName();var K=H&&H[I]&&H[I]["sap.ui.generic.app"];var L=i.getEntitySet();var N=K&&K[L]&&K[L].Actions;var O={};var Q=n(i);if(N){if(Q){o(O,N,Q);}else{q(O,N);}}else{var W=K&&K[L]&&K[L]["Sections"];for(var X in W){N=W[X]["Actions"];if(N){q(O,N);}}}i.getModel("_templPriv").setProperty("/generic/listCommons/breakoutActionsEnabled",O);}function n(i){var B;var H=i.getAppComponent().getConfig();var I=H&&H.pages[0]&&H.pages[0].component&&H.pages[0].component.settings;if(I&&I.quickVariantSelectionX){B=I.quickVariantSelectionX.variants;}return B;}function o(B,H,I){var K;for(var L in H){K=true;if(H[L].requiresSelection){K=false;}for(var i in I){var M=H[L].id;var N=I[i];var O=A.getSuffixFromIconTabFilterKey(N);if(O){M=M.concat(O);}B[M]={enabled:K};}}}function q(B,i){var H;for(var I in i){H=true;if(i[I].requiresSelection){H=false;}B[i[I].id]={enabled:H};}}function t(i){if(i.getAppComponent().getMetadata().getComponentName()===""||i.getTemplateName()===""||i.getEntitySet()===""){}return i.getAppComponent().getMetadata().getComponentName()+"::"+i.getTemplateName()+"::"+i.getEntitySet();}function u(i,B){if(i.level===0){return[];}var H=B[i.parentRoute];var I=u(H,B);I.push(H);return I;}function v(i,B,M,H){var I=B.oComponent;var K=B.oAppComponent;var L=B.oTemplateContract.mRoutingTree[B.route];var N=I.getEntitySet();var O=B.utils.isDraftEnabled();var Q=K.getTransactionController().getDraftController();var W=Q.getDraftContext();var X=K.getModel();var Y=function(N){return W.isDraftEnabled(N);};var Z=e({},L.page.component.settings);delete Z.appComponent;delete Z.entitySet;delete Z.navigationProperty;Z.subPages=L.page.pages;Z.routeConfig=B.routeConfig;return new J({entitySet:N,entityType:i,treeNode:L,treeNodeAncestors:u(L,B.oTemplateContract.mRoutingTree),routingSpec:B.routingSpec,"sap-ui-debug":window["sap-ui-debug"],isDraftEnabled:O,checkIsDraftEnabled:Y,settings:Z,manifest:K.getInternalManifest(),metaModel:M,templateSpecific:H&&H(M,Z,D,N,W,X),appComponentName:K.getMetadata().getComponentName(),stableId:{definition:S,aParameter:[],getStableId:d.getStableId},variables:[]});}function w(i,B){var H=i.oComponent,I=i.createViewController,K=i.methods&&i.methods.getTemplateSpecificParameters,M=i.oAppComponent.getModel(),L,N,O,Q,W,X=i.routingSpec&&i.routingSpec.noOData;if(X){L=new J({entitySet:{},entityType:{}});Q=L.createBindingContext("/entitySet");W=L.createBindingContext("/entityType");}else{L=M&&M.getMetaModel();N=M&&H.getEntitySet();var Y=N&&L.getODataEntitySet(N);O=Y&&Y.entityType;if(!O){return{loaded:function(){return Promise.reject(new h(s,"Unknown entityset "+N));}};}Q=L.createBindingContext(L.getODataEntitySet(N,true));W=L.createBindingContext(L.getODataEntityType(O,true));}E(H);m(H,M);var Z=t(H);var $=sap.ui.getCore().byId(Z);if($){l.warning("View with ID: "+Z+" already exists - old view is getting destroyed now!");try{$.destroy();}catch(_){l.warning("Error destroying view: "+_);}$=null;}var a1=new J(D);a1.setDefaultBindingMode("OneWay");i.oParameterModel=v(O,i,L,K);H.runAsOwner(function(){var b1=i.preprocessorsData;var c1={async:true,preprocessors:{xml:{bindingContexts:{entitySet:Q,entityType:W},models:{device:a1,appSettings:i.oTemplateContract.appSettings,entitySet:L,entityType:L,parameter:i.oParameterModel},preprocessorsData:b1}},id:Z,type:V.XML,viewName:H.getTemplateName(),height:"100%",cache:{keys:B,additionalData:[b1]}};if(H.getDesigntimePath||H.getFlexibilityPath){var d1={key:"sap-ui-custom-settings",value:{}};if(H.getDesigntimePath){d1.value["sap.ui.dt"]={"designtime":H.getDesigntimePath()};}if(H.getFlexibilityPath){d1.value["sap.ui.fl"]={"flexibility":H.getFlexibilityPath()};}c1.customData=[new b(d1)];}c1.controller=I();$=sap.ui.view(c1);});return $;}function x(i,B,H){var I=i.oController.extensionAPI;var K=e({},I);if(I.getNavigationController){var N=e({},I.getNavigationController());var L=N.navigateInternal;N.navigateInternal=function(M,O){var Q=O&&O.routeName;if(Q){i.utils.navigateRoute(Q,M,B,O&&O.replaceInHistory);}else{L(M,O);}};K.getNavigationController=function(){return N;};}K.getCommunicationObject=function(M){return M===1?H.communicationObject:i.utils.getCommunicationObject(M);};(i.methods.enhanceExtensionAPI4Reuse||Function.prototype)(K,H);return K;}function P(i,B,H,I,K){I.extensionAPI=x(i,H,I);r.transferEmbeddedComponentProxy(i,B,H,I,K);var L=i.oController.byId(I.containerId);var M=L&&L.getSettings();var N=K.getMetadata().getAllProperties();for(var O in M){if((O==="uiMode"||O==="semanticObject"||O.startsWith("st"))&&!N[O]){delete M[O];}}K.applySettings(M);L.setComponent(K);}function y(i,B,H){return H.componentUsage?i.createComponent({usage:H.componentUsage,id:B}):i.runAsOwner(function(){return a.create({name:H.componentName,id:B});});}function z(i){var B=i.oTemplateContract.mRoutingTree[i.route];i.reuseComponentsReady=new Promise(function(H,I){var K=Object.create(null);var L=H.bind(null,K);var M=function(N,O){l.error("Failed to load reuse component for key "+N,O instanceof Error?O.message:"","sap.suite.ui.generic.template.lib.TemplateComponent");};i.viewRegistered.then(function(){var N=[];for(var O in B.embeddedComponents){var Q=B.embeddedComponents[O];var W=Q.sectionId&&i.oController.byId(Q.sectionId);if(W&&W.isStashed()){delete B.embeddedComponents[O];}else{var X=i.oController.createId(Q.containerId+"Content");var Y=y(i.oAppComponent,X,Q);N.push(Y);Y.catch(M.bind(null,O));Y.then(P.bind(null,i,K,O,Q));}}Promise.all(N).then(L,function(Z){var $=i.oAppComponent.getNavigationController();$.navigateToMessagePage({text:i.oTemplateContract.getText("ST_ERROR"),description:Z instanceof Error?Z.message:""});I();});});});B.willBeDisplayed.then(i.oTemplateContract.oBusyHelper.setBusy.bind(null,i.reuseComponentsReady));}var T=U.extend("sap.suite.ui.generic.template.lib.TemplateComponent",{metadata:{properties:{templateName:{type:"string",defaultValue:null},entitySet:{type:"string",defaultValue:null},navigationProperty:{type:"string",defaultValue:null},appComponent:{type:"object",defaultValue:null},isRefreshRequired:{type:"boolean",defaultValue:false},isLeaf:{type:"boolean"}},library:"sap.suite.ui.generic.template"},init:function(){(U.prototype.init||Function.prototype).apply(this);var i=new J({editable:false,enabled:false});this.setModel(i,"ui");var B=this.getComponentData();var H=B.registryEntry;var I=H.oTemplateContract.mRoutingTree[H.route];var K=Object.create(null);for(var L in I.embeddedComponents){K[L]={hidden:!!I.embeddedComponents[L].definition.hiddenByDefault};}var M=new J({generic:{isActive:false,listCommons:{},viewLevel:H.viewLevel,controlProperties:{},supportedIntents:{},embeddedComponents:K}});M.setDefaultBindingMode("TwoWay");this.setModel(M,"_templPriv");z(H);},getManifestEntry:function(K){var i=U.prototype.getManifestEntry.apply(this,arguments);if(/^\/sap\.ui5\/componentUsages(\/.+)?$/.test(K)){i=f({},i,U.prototype.getManifestEntry.apply(this.getAppComponent(),arguments));}return i;},getComponentContainer:function(){return this.oContainer;},onBeforeRendering:function(i){if(i){var B=i.oComponent.getComponentContainer();var H=i.oAppComponent;var M=!i.createViewStarted&&B&&B.getModel();if(M){var I=g.getCacheKeyPartsAsyc(M);i.createViewStarted=true;w(i,I).loaded().then(function(K){if(i.utils.isDraftEnabled()){var L=i.utils.getRootExpand();if(L){var N=i.oComponent.getEntitySet();g.writeToLocalStorageAsync(H.getId(),N,I,L);}}i.oComponent.setAggregation("rootControl",K);i.fnViewRegisteredResolve();B.invalidate();var O=i.oTemplateContract.mRoutingTree[i.route];var Q=i.oTemplateContract.oTemplatePrivateGlobalModel;var W=['FE-VIEW-CREATED','FE-VIEW-CREATED-FIRSTTIMEONLY'];p.resetPlaceHoldersForRoute(Q,O.sRouteName,W);},function(K){i.fnViewRegisteredResolve(K||{});});}}},getRouter:function(){if(this.getAppComponent()){return this.getAppComponent().getRouter();}return U.prototype.getRouter.apply(this,arguments);}});return T;});
