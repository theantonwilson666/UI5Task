sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","./AnnotationHelper","sap/base/util/each"],function(M,a,A,e){"use strict";var B=M.extend("sap.suite.ui.generic.template.js.QuickTemplates.QuickActionBaseController",{onInit:function(){if(!this._bIsInitialized){this._bIsInitialized=true;this.oComponent=this.getOwnerComponent()||this.getView().getViewData().component;var v=this.getView();v.setModel(this.oComponent.getModel());this.sEntitySet=this.oComponent.getEntitySet();this.oDraftController=this.oComponent.getTransactionController().getDraftController();this.bDraftEnabled=this.oDraftController.getDraftContext().isDraftEnabled(this.sEntitySet);var m=this.getView().getModel().getMetaModel();this.oEntitySetMeta=m.getODataEntitySet(this.sEntitySet);this.oEntityTypeMeta=m.getODataEntityType(this.oEntitySetMeta.entityType);this.oSmartFieldEventDelegate={onAfterRendering:function(E){this._onSmartFieldAfterRendering(E);}.bind(this)};}},_onMetaModelLoaded:function(){},_onSmartFieldAfterRendering:function(E){},onBeforeRendering:function(){if(!this._bMetaDataInit){this._bMetaDataInit=true;this.getView().getModel().getMetaModel().loaded().then(this._onMetaModelLoaded.bind(this),this.onError.bind(this));}this.setBusy(false);},setBusy:function(b){if(this.getView().getModel("ui")){this.getView().getModel("ui").setProperty("/busy",b);this.getView().getModel("ui").updateBindings();}},bindView:function(c){var i=this._getFormatterInterface(c);var b=A.formatExpandBindingPathForHeaderObject(i,this.oEntityTypeMeta.namespace+"."+this.oEntityTypeMeta.name);this.oContext=c;this.getView().bindElement({path:c.getPath(),parameters:{expand:b}});},onError:function(E){this.setBusy(false);if(E.message){this._showErrorMessage(E);}else if(E.response){this._showErrorMessage(E.response);}else{this._showErrorMessage({message:this.formatI18NMessage("QuickAction_Generic_Error")});}},onSmartFieldsCreated:function(E){var c=E.getParameters()[0];if(c&&typeof c.addEventDelegate==='function'){c.removeEventDelegate(this.oSmartFieldEventDelegate);c.addEventDelegate(this.oSmartFieldEventDelegate);}},formatI18NMessage:function(){if(arguments&&arguments[0]){var i=arguments[0];var r=this.getView().getModel("i18n").getResourceBundle();if(arguments.length>1){var b=Array.prototype.slice.call(arguments);return r.getText(i,b.splice(1,arguments.length-1));}return r.getText(i);}return arguments;},_getFormatterInterface:function(c){var b=c?c:this.getView().getBindingContext();return A.createFormatterInterface(b);},_setBindingContext:function(c){this.getView().setBindingContext(c);this.setBusy(false);},_showErrorMessage:function(E){var b=E.response||E;var d=b.message;if(b.statusText){d=b.statusText;}if(b&&b.responseText){try{var o=JSON.parse(b.responseText);var s=this._getErrorDetail(o);d=(s&&s.length>0)?s:d;}catch(c){}}a.show(d,{icon:a.Icon.ERROR,title:this.formatI18NMessage("QuickAction_Error_Popover"),actions:[a.Action.OK]});},_displaySeverity:function(b){var c;switch(b){case"error":c="Error_Severity_Error";break;case"abort":c="Error_Severity_Abort";break;case"warning":c="Error_Severity_Warning";break;case"info":c="Error_Severity_Info";break;case"termination":c="Error_Severity_Termination";break;case"success":c="Error_Severity_Success";break;}return c;},_getErrorDetail:function(E){var d="";if(E&&E.error&&E.error.message){if(E.error.innererror&&E.error.innererror.errordetails&&E.error.innererror.errordetails.length>0){e(E.error.innererror.errordetails,function(i,b){d+=b.message+'\n';});}else if(E.error.message.value){d=E.error.message.value;}}return d;}});return B;},true);
