sap.ui.define(["sap/base/util/deepExtend","sap/suite/ui/generic/template/genericUtilities/FeError","sap/suite/ui/generic/template/genericUtilities/FeLogger"],function(d,F,a){"use strict";var c="js.preparationHelper";var l=new a(c).getLogger();function g(m,o,D,E,h,L){var s=d({},o);s.tableType=s.tableType||(s.gridTable?"GridTable":undefined);s.tableType=s.tableType||(s.treeTable?"TreeTable":undefined);s.tableSettings=s.tableSettings||{};s.tableSettings.type=s.tableSettings.type||s.tableType;s.tableSettings.multiSelect=(s.tableSettings.multiSelect===undefined?s.multiSelect:s.tableSettings.multiSelect);s.tableSettings.selectAll=(s.tableSettings.selectAll===undefined?false:s.tableSettings.selectAll);s.tableSettings.inlineDelete=!!s.tableSettings.inlineDelete;s.tableSettings.multiSelect=!!s.tableSettings.multiSelect;s.tableSettings.selectionLimit=s.tableSettings.selectionLimit||200;var i=m.getODataEntitySet(E);var j=m.getODataEntityType(i.entityType);if(D.system.phone){s.tableSettings.type="ResponsiveTable";}else if(E){s.tableSettings.type=s.tableSettings.type||(j["sap:semantics"]==="aggregate"?"AnalyticalTable":"ResponsiveTable");if(s.tableSettings.type==="AnalyticalTable"&&!(j["sap:semantics"]==="aggregate")){s.tableSettings.type="GridTable";}}if(j["com.sap.vocabularies.UI.v1.HeaderInfo"]){s.tableSettings.headerInfo=j["com.sap.vocabularies.UI.v1.HeaderInfo"];}if(s.tableSettings.multiSelect&&s.tableSettings.inlineDelete){throw new F(c,"Both inlineDelete and multiSelect options for table are not possible");}if(s.tableSettings.type!=="ResponsiveTable"&&s.tableSettings.inlineDelete){throw new F(c,"InlineDelete property is not supported for "+s.tableSettings.type+" type table");}s.tableSettings.mode=(s.tableSettings.multiSelect?"MultiSelect":"SingleSelectLeft");s.tableSettings.onlyForDelete=true;if(Array.isArray(L)&&L.find(function(r){return!(r.Inline&&r.Inline.Bool)&&(r.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||(r.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&r.RequiresContext&&r.RequiresContext.Bool));})){s.tableSettings.onlyForDelete=false;}for(var A in h){if(h[A].requiresSelection!==false){s.tableSettings.onlyForDelete=false;break;}}if(s.tableSettings.onlyForDelete&&i["Org.OData.Capabilities.V1.DeleteRestrictions"]&&i["Org.OData.Capabilities.V1.DeleteRestrictions"].Deletable&&i["Org.OData.Capabilities.V1.DeleteRestrictions"].Deletable.Bool==="false"){s.tableSettings.mode="None";s.tableSettings.onlyForDelete=false;}if(s.tableSettings.type!=="ResponsiveTable"){if(s.tableSettings.mode==="SingleSelectLeft"){s.tableSettings.mode="Single";}else if(s.tableSettings.mode==="MultiSelect"){s.tableSettings.mode="MultiToggle";}}if(s.tableSettings.inlineDelete){s.tableSettings.mode="Delete";s.tableSettings.onlyForDelete=true;}delete s.gridTable;delete s.treeTable;delete s.tableType;delete s.multiSelect;return s.tableSettings;}function b(m,E,A,q){var p=[A];if(q){p.push(q);}var s=p.join("#");return m.getODataEntityType(E)[s];}function e(m,E,q){function h(P){if(P[0]!=="/"){P=m.getODataEntityType(E,true)+"/"+P;}return m.getObject(P.replace(/@/g,""));}function i(s){return s.PresentationVariant&&s.PresentationVariant.Path?h(s.PresentationVariant.Path):s.PresentationVariant;}function j(p){var v=p.Visualizations&&p.Visualizations.find(function(v){return v.AnnotationPath.includes("com.sap.vocabularies.UI.v1.LineItem");});return v&&h(v.AnnotationPath);}var s=b(m,E,"com.sap.vocabularies.UI.v1.SelectionPresentationVariant",q);var p=s?i(s):b(m,E,"com.sap.vocabularies.UI.v1.PresentationVariant",q);return p&&j(p)||b(m,E,"com.sap.vocabularies.UI.v1.LineItem");}function f(m,E){var t={mTargetEntities:{},mProperty:{}};function h(){return{mTargetEntities:t.mTargetEntities,sForceLinkRendering:JSON.stringify(t.mProperty)};}var o=m.getODataEntityType(E.entityType);var p=[];var P={};if(!o||!o.navigationProperty){return h();}var n=o.property||[];n.forEach(function(i){if(i["com.sap.vocabularies.Common.v1.SemanticObject"]){p.push(i.name);P[i.name]={name:i.name,targetEntitiesWithSemanticObject:[],targetEntitiesWithDependent:[]};}});if(p.length==0){return h();}var q=function(N,S){return S.namespace===N;};var r=function(N,A){return A.name===N;};o.navigationProperty.forEach(function(N){if(N.name==="SiblingEntity"){return;}var Q=N.relationship;var S=Q.lastIndexOf(".");var i=Q.slice(0,S);var j=Q.slice(S+1);var k=m.getObject("/dataServices/schema").find(q.bind(null,i));var A=k.association.find(r.bind(null,j));var R=A&&A.referentialConstraint;if(R&&R.dependent&&R.dependent.propertyRef){var v=m.getODataAssociationEnd(o,N.name);var T=m.getODataEntityType(v.type);if(T["com.sap.vocabularies.UI.v1.QuickViewFacets"]){for(var w in R.dependent.propertyRef){var x=R.dependent.propertyRef[w];if(P.hasOwnProperty(x.name)){if(R.dependent.propertyRef.length==1){P[x.name].targetEntitiesWithDependent.unshift({entityType:T.namespace+"."+T.name,navName:N.name});}else{P[x.name].targetEntitiesWithDependent.push({entityType:T.namespace+"."+T.name,navName:N.name});}}}}}});var s=m.getODataEntityContainer();s.entitySet.forEach(function(E){if(o.name!==E.entityType){var T=m.getODataEntityType(E.entityType);if(T["com.sap.vocabularies.UI.v1.QuickViewFacets"]){var i=T.property||[];for(var j=0;j<i.length;j++){if(i[j]["com.sap.vocabularies.Common.v1.SemanticObject"]){for(var k=0;k<p.length;k++){if(i[j].name==p[k]){P[p[k]].targetEntitiesWithSemanticObject.push({entityType:T.namespace+'.'+T.name});break;}}}}}}});function u(i){return P[i].targetEntitiesWithDependent[0];}p.forEach(function(k){var T;if(P[k].targetEntitiesWithSemanticObject.length>0){if(P[k].targetEntitiesWithSemanticObject.length>1){l.warning("Quick View property "+k+"found in multiple Target Entities.");}for(var i=0;i<P[k].targetEntitiesWithSemanticObject.length;i++){for(var j=0;j<P[k].targetEntitiesWithDependent.length;j++){if(P[k].targetEntitiesWithSemanticObject[i].entityType==P[k].targetEntitiesWithDependent[j].entityType){T=P[k].targetEntitiesWithDependent[j];break;}}if(T){break;}}if(!T){T=u(k);}}else{T=u(k);}if(T){t.mTargetEntities[k]=T;t.mProperty[k]=true;}});return h();}return{getNormalizedTableSettings:g,getAnnotation:b,getLineItemFromVariant:e,getTargetEntityForQuickView:f};});
