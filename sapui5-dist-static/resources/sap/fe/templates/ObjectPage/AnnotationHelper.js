/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2020 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/base/Log","sap/ui/model/odata/v4/AnnotationHelper","sap/ui/base/ManagedObject","sap/base/util/JSTokenizer","sap/base/util/merge","sap/base/strings/formatMessage","sap/fe/core/CommonUtils","sap/fe/macros/field/FieldHelper","sap/fe/macros/CommonHelper"],function(L,O,M,J,m,f,C,F,a){"use strict";var A={buildExpressionForProgressIndicatorPercentValue:function(i,d,u){var p="0";var e;var o=i.getModel(1);var b=o.createBindingContext("/");if(d.Value&&d.Value.$Path){var v=O.value(d.Value,{context:b});var V="$"+v;var t;if(d.TargetValue){t=O.value(d.TargetValue,{context:b});if(d.TargetValue.$Path){t="$"+t;}}var E="(({0} > 100) ? 100 : (({0} < 0) ? 0 : ({0} * 1)))";var s="(({1} > 0) ? (({0} > {1}) ? 100 : (({0} < 0) ? 0 : ({0} / {1} * 100))) : 0)";if(u){u="'"+u+"'";e="'{'= ({2} === ''%'') ? "+E+" : "+s+" '}'";p=f(e,[V,t,u]);}else{e="'{'= "+s+" '}'";p=f(e,[V,t]);}}return p;},buildExpressionForProgressIndicatorDisplayValue:function(i,d,u){var o=i.getModel(1);var b=o.createBindingContext("/");var p=[];p.push(O.value(d.Value,{context:b}));p.push(O.value(d.TargetValue,{context:b}));p.push(u);var D=A.formatDisplayValue(p);return D;},formatDisplayValue:function(p){var d="",v=p[0],t=p[1],u=p[2];if(v){return sap.ui.getCore().getLibraryResourceBundle("sap.fe.templates",true).then(function(r){if(u){if(u==="%"){d=r.getText("T_ANNOTATION_HELPER_PROGRESS_INDICATOR_DISPLAY_VALUE_UOM_IS_PERCENT",[v]);}else{if(t){d=r.getText("T_ANNOTATION_HELPER_PROGRESS_INDICATOR_DISPLAY_VALUE_UOM_IS_NOT_PERCENT",[v,t,u]);}else{d=r.getText("T_ANNOTATION_HELPER_PROGRESS_INDICATOR_DISPLAY_VALUE_UOM_IS_NOT_PERCENT_NO_TARGET_VALUE",[v,u]);}}}else if(t){d=r.getText("T_COMMON_PROGRESS_INDICATOR_DISPLAY_VALUE_NO_UOM",[v,t]);}else{d=v;}return d;});}else{L.warning("Value property is mandatory, the default (empty string) will be returned");}},buildExpressionForCriticality:function(d){var s=sap.ui.core.ValueState.None;var e;var c=d.Criticality;if(c){e="'{'= ({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Negative'') || ({0} === ''1'') || ({0} === 1) ? ''"+sap.ui.core.ValueState.Error+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Critical'') || ({0} === ''2'') || ({0} === 2) ? ''"+sap.ui.core.ValueState.Warning+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Positive'') || ({0} === ''3'') || ({0} === 3) ? ''"+sap.ui.core.ValueState.Success+"'' : "+"''"+sap.ui.core.ValueState.None+"'' '}'";if(c.$Path){var b="${"+c.$Path+"}";s=f(e,b);}else if(c.$EnumMember){var g="'"+c.$EnumMember+"'";s=f(e,g);}else{L.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}}else{L.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}return s;},buildRatingIndicatorSubtitleExpression:function(c,s){if(s){return sap.fe.templates.ObjectPage.AnnotationHelper.formatRatingIndicatorSubTitle(O.value(s,{context:c}));}},getHeaderRatingIndicatorText:function(c,d){if(d&&d.SampleSize){return A.buildRatingIndicatorSubtitleExpression(c,d.SampleSize);}else if(d&&d.Description){var s=O.value(d.Description,{context:c});return"${path:"+s+"}";}},formatRatingIndicatorSubTitle:function(s){if(s){return sap.ui.getCore().getLibraryResourceBundle("sap.fe.templates",true).then(function(r){var S=s>1?r.getText("T_ANNOTATION_HELPER_RATING_INDICATOR_SUBTITLE_LABEL_PLURAL"):r.getText("T_ANNOTATION_HELPER_RATING_INDICATOR_SUBTITLE_LABEL");return r.getText("T_ANNOTATION_HELPER_RATING_INDICATOR_SUBTITLE",[s,S]);});}},getElementBinding:function(p){var n=O.getNavigationPath(p);if(n){return"{path:'"+n+"'}";}else{return"{path: ''}";}},getButtonVisiblityForDeleteHidden:function(d,D){if(d){return d==="false"?"{= (${ui>/editMode} === 'Editable')}":"{= (${ui>/editMode} === 'Editable') &&  !$"+d+"}";}else if(D){return D==="false"?"{= (${ui>/editMode} === 'Editable')}":"{= (${ui>/editMode} === 'Editable') &&  !$"+D+"}";}else{return"{= (${ui>/editMode} === 'Editable')}";}},getDeleteButtonVisibility:function(d,v,D,p,s){var P=p==="true"||(p!=="false"&&typeof p==="string");if((d==="false"&&!P)||D==="true"||s==="true"){return false;}if(v>1){return A.getButtonVisiblityForDeleteHidden(D,s);}else if(D){return D==="false"?"{= !(${ui>/editMode} === 'Editable')}":"{= !(${ui>/editMode} === 'Editable') && !$"+D+"}";}else if(s){return s==="false"?"{= !(${ui>/editMode} === 'Editable')}":"{= !(${ui>/editMode} === 'Editable') && !$"+s+"}";}else{return"{= !(${ui>/editMode} === 'Editable')}";}},getDeleteCommandExecutionEnabled:function(d,c){var D=c.find(function(o){return o.type==="Secondary";});return this.getDeleteButtonEnabled(d,D.parentEntityDeleteEnabled);},getDeleteCommandExecutionVisible:function(d,v,D,c,s){var o=c.find(function(b){return b.type==="Secondary";});return this.getDeleteButtonVisibility(d,v,D,o.parentEntityDeleteEnabled,s);},fnGetDeleteButtonEnabled:function(d){if(d==="false"){return false;}else if(d&&d!=="true"){return"{= $"+d+"}";}else{return true;}},getDeleteButtonEnabled:function(d,p){var D=A.fnGetDeleteButtonEnabled(d);return p?p:D;},getEditAction:function(e){var p=e.getPath(),o=e.getObject(p+"@");var d=o.hasOwnProperty("@com.sap.vocabularies.Common.v1.DraftRoot");var s=o.hasOwnProperty("@com.sap.vocabularies.Session.v1.StickySessionSupported");var b;if(d){b=e.getObject(p+"@com.sap.vocabularies.Common.v1.DraftRoot/EditAction");}else if(s){b=e.getObject(p+"@com.sap.vocabularies.Session.v1.StickySessionSupported/EditAction");}return!b?b:p+"/"+b;},isReadOnlyFromStaticAnnotations:function(o,b){var c,i,r;if(o["@Org.OData.Core.V1.Computed"]){c=o["@Org.OData.Core.V1.Computed"].Bool?o["@Org.OData.Core.V1.Computed"].Bool=="true":true;}if(o["@Org.OData.Core.V1.Immutable"]){i=o["@Org.OData.Core.V1.Immutable"].Bool?o["@Org.OData.Core.V1.Immutable"].Bool=="true":true;}r=c||i;if(b){r=r||b=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly";}if(r){return false;}else{return true;}},isReadOnlyFromDynamicAnnotations:function(o){var i;if(o){if(M.bindingParser(o)){i="$"+o+" === '1'";}}if(i){return"{= "+i+"? false : true }";}else{return true;}},getBindingWithoutMeasure:function(b){var B=J.parseJS(b,0).result,o={showMeasure:false};B=m(B,{formatOptions:o});return JSON.stringify(B);},getExpressionForMicroChartTitlePress:function(c,o,s){if(c){if((c["targetOutbound"]&&c["targetOutbound"]["outbound"])||(c["targetOutbound"]&&c["targetOutbound"]["outbound"]&&c["targetSections"])){return(".handlers.onDataPointTitlePressed($controller, ${$source>/},'"+JSON.stringify(o)+"','"+c["targetOutbound"]["outbound"]+"','"+s+"' )");}else if(c["targetSections"]){return".handlers.navigateToSubSection($controller, '"+JSON.stringify(c["targetSections"])+"')";}else{return undefined;}}},getMicroChartTitleAsLink:function(c){if(c&&(c["targetOutbound"]||(c["targetOutbound"]&&c["targetSections"]))){return"External";}else if(c&&c["targetSections"]){return"InPage";}else{return"None";}},getGroupIdFromConfig:function(c,s,d){var o=c[s],b=["Heroes","Decoration","Workers","LongRunners"],g=d;if(o&&o.requestGroupId&&b.some(function(e){return e===o.requestGroupId;})){g="$auto."+o.requestGroupId;}return g;},getBindingWithGroupIdFromConfig:function(c,k){var g=A.getGroupIdFromConfig(c,k),b;if(g){b="{ path : '', parameters : { $$groupId : '"+g+"' } }";}return b;},doesFieldGroupContainOnlyOneMultiLineDataField:function(b){return b&&b.length===1&&!!b[0].isValueMultilineText;},getVisibleExpressionForBreadcrumbs:function(v){return v.showBreadCrumbs&&v.fclEnabled!==undefined?"{fclhelper>/breadCrumbIsVisible}":v.showBreadCrumbs;},getEnabledExpressionForHeaderActions:function(o,e,s){if(o===null){var E=(e["@com.sap.vocabularies.Common.v1.DraftRoot"]&&e["@com.sap.vocabularies.Common.v1.DraftRoot"].EditAction)||(e["@com.sap.vocabularies.Common.v1.StickySessionSupported"]&&e["@com.sap.vocabularies.Common.v1.StickySessionSupported"].EditAction);if(E){return"{= ${#"+E+"} ? true : false }";}}if(o&&o.$Path){return s;}else{return true;}},getButtonVisiblityForHeaderActions:function(e,h,u){var r="{= !(${ui>/editMode} === 'Editable')";if(h==="true"||u==="true"){return false;}else if(h==="false"||u==="false"){r=r+"";}else if(h){r=r+" && !$"+h;}else if(u){r=r+" && !$"+u;}else if(e&&!e["@com.sap.vocabularies.UI.v1.UpdateHidden"]){r=r+"";}return r+"}";},getButtonEnabledForAnnotationAction:function(b,o,d,s){if(b&&b.$IsBound!==true){return"true";}if(o&&o["@Org.OData.Core.V1.OperationAvailable"]===null&&d){return"{= !${#"+d.Action+"} ? false : true } }";}if(o&&o["@Org.OData.Core.V1.OperationAvailable"]&&o["@Org.OData.Core.V1.OperationAvailable"].$Path){return"{= $"+s+"}";}return true;},getMenuButtonEnabled:function(c,b,e,E){var d=[];var o;var s=E&&E.$Type;for(var i=0;i<b.length;i++){var g=b[i];if(g.enabled){return true;}else if(g.type==="ForAction"){var D="";var h;var I=c.getInterface(1);var j=I.getModel();var k=j.getObject(g.annotationPath);var l=j.getObject(I.getPath()+k.Action),n=j.getObject(I.getPath()+k.Action+"@"),p=j.createBindingContext(I.getPath()+k.Action),q=j.createBindingContext(I.getPath()+k.Action+"@Org.OData.Core.V1.OperationAvailable"),r=j.getObject(p.getPath()+"@Org.OData.Core.V1.OperationAvailable");if(r){var t=r.$Path?r.$Path:r;var u={$Path:t.replace("_it/","")};}h=r?O.format(u,{arguments:[],context:q}):undefined;if(Array.isArray(l)){if(s){o=l.find(function(v){return v.$IsBound&&v.$Parameter[0].$Type===s;});}else{o=l[0];}}else{o=l;}D=A.getButtonEnabledForAnnotationAction(o,n,k,h);if(D===true||D==="true"){return true;}else{if(D.split("{=").length>0){D=D.split("{=")[1].slice(0,-1);}d.push("("+D+")");}}}return d.length>0?"{= "+d.join(" || ")+"}":false;},getVisiblityOfHeaderFacet:function(o,b){return(A.isReadOnlyFromStaticAnnotations(o,b)&&A.isReadOnlyFromDynamicAnnotations(b));},getPressExpressionForDelete:function(e){var d="${$view>/getBindingContext}",t="${$view>/#fe::ObjectPage/getHeaderTitle/getExpandedHeading/getItems/0/getText}",D="${$view>/#fe::ObjectPage/getHeaderTitle/getExpandedHeading/getItems/1/getText}";var p={title:t,entitySetName:a.addSingleQuotes(e),description:D};return a.generateFunction(".editFlow.deleteDocument",d,a.objectToString(p));},getPressExpressionForEdit:function(d,e,h){var E=a.addSingleQuotes(d&&d.Action),D=d&&d.InvocationGrouping&&d.InvocationGrouping["$EnumMember"],i=D==="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated";var p={contexts:"${$view>/getBindingContext}",entitySetName:a.addSingleQuotes(e),invocationGrouping:a.addSingleQuotes(i),model:"${$source>/}.getModel()",label:a.addSingleQuotes(d&&d.Label),isNavigable:h&&h.isNavigable};return a.generateFunction(".editFlow.invokeAction",E,a.objectToString(p));},getPressExpressionForFooterAnnotationAction:function(d,e,h){var s=a.addSingleQuotes(d&&d.Action),D=d&&d.InvocationGrouping&&d.InvocationGrouping["$EnumMember"],i=D==="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated";var p={contexts:"${$view>/#fe::ObjectPage/}.getBindingContext()",entitySetName:a.addSingleQuotes(e),invocationGrouping:a.addSingleQuotes(i),model:"${$source>/}.getModel()",label:a.addSingleQuotes(d&&d.Label),isNavigable:h&&h.isNavigable};return a.generateFunction(".handlers.onCallActionFromFooter","${$view>/}",s,a.objectToString(p));},getStashableHBoxVisiblity:function(h,H){return h===false?true:H&&"{= !%"+H+"}";},getStashableHBoxBinding:function(c,h){if(h&&h.Facet&&h.Facet.targetAnnotationType==="DataPoint"){return A.getBindingWithGroupIdFromConfig(c,h.Facet.targetAnnotationValue);}},getChartTitleDescribedBy:function(v,h,c){var s=h&&h.Target&&h.Target["$AnnotationPath"],b=v&&v.controlConfiguration&&v.controlConfiguration[s]&&v.controlConfiguration[s]["navigation"]&&v.controlConfiguration[s]["navigation"]["targetSections"];return b?c:undefined;},buildFieldBindingExpression:function(c,p,P,o,d,D,s){return F.buildFieldBindingExpression(c,p,P,d,{"displayMode":F.displayMode(P,o)},D,s).then(function(b){if(!P["@com.sap.vocabularies.Common.v1.Text"]){return A.getBindingWithoutMeasure(b);}return b;});},getPressExpressionForLink:function(c,o){if(c){if(c["targetOutbound"]&&c["targetOutbound"]["outbound"]){return(".handlers.onDataPointTitlePressed($controller, ${$source>}, "+JSON.stringify(o)+","+JSON.stringify(c["targetOutbound"]["outbound"])+")");}else if(c["targetSections"]){return".handlers.navigateToSubSection($controller, '"+JSON.stringify(c["targetSections"])+"')";}else{return undefined;}}},buildExpressionForTextValue:function(p,h){var o=h.context.getModel(),P=h.context.getPath(),t=o.createBindingContext(P+"@com.sap.vocabularies.Common.v1.Text"),T=t.getProperty(),s=T?O.value(T,{context:t}):undefined;p=O.getNavigationPath(p);if(s){var b={$Path:s.substr(1,s.length-2)};var c=O.format({$Path:b.$Path},{arguments:[],context:t});if(typeof c==="string"){s=c.substr(0,c.length-1)+", parameters: {'$$noPatch': true}}";}else{return c.then(function(r){return r.substr(0,r.length-1)+", parameters: {'$$noPatch': true}}";});}}return s;},getValueFormatted:function(p,h){if(typeof p==="object"){var o=h.context.getModel(),P=h.context.getPath(),c=o.createBindingContext(P);return O.format({$Path:p.$Path},{arguments:[],context:c});}else{return undefined;}}};A.buildExpressionForProgressIndicatorPercentValue.requiresIContext=true;A.buildExpressionForProgressIndicatorDisplayValue.requiresIContext=true;A.buildRatingIndicatorSubtitleExpression.requiresIContext=true;A.getHeaderRatingIndicatorText.requiresIContext=true;A.buildExpressionForTextValue.requiresIContext=true;A.getValueFormatted.requiresIContext=true;A.buildFieldBindingExpression.requiresIContext=true;A.getMenuButtonEnabled.requiresIContext=true;return A;},true);
