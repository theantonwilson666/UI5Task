sap.ui.define(["sap/base/util/ObjectPath","sap/base/util/extend","sap/base/Log","sap/ui/core/XMLTemplateProcessor","sap/ui/core/util/XMLPreprocessor","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ui/core/routing/HashChanger","sap/fe/core/CommonUtils"],function(O,e,L,X,a,F,J,H,C){"use strict";var S={},l;S.onShareActionButtonPressImpl=function(c,o,p,s){sap.ui.require(["sap/m/library"],function(b){var g=o.getView().getModel("sap.fe.i18n").getResourceBundle();var f={shareEmailPressed:function(){var E;if(p!==null){E=p.title;var d=p.subtitle;if(d){E=E+" - "+d;}b.URLHelper.triggerEmail(null,E,document.URL);}else{g.then(function(B){E=B.getText("T_SHARE_UTIL_HELPER_SAPFE_EMAIL_SUBJECT",[document.title]);b.URLHelper.triggerEmail(null,E,document.URL);}).catch(function(h){L.error("Error while getting the resource bundle",h);});}},onSaveTilePress:function(){setTimeout(function(){sap.ui.getCore().byId("bookmarkDialog").attachAfterClose(function(){l.focus();});},0);},getServiceUrl:function(){if(s){return S.getCountUrl(o);}else{return"";}},getModelData:function(){var d;if(p!==null){d={title:p.title,subtitle:p.subtitle};}else{var A=C.getAppComponent(o.getView());var m=A.getMetadata();var u=m.getManifestEntry("sap.ui");var i=(u&&u.icons&&u.icons.icon)||"";var h=m.getManifestEntry("sap.app");var t=(h&&h.title)||"";d={icon:i,title:t,serviceUrl:f.getServiceUrl()};}d.customUrl=S.getCustomUrl();return d;}};S.openSharePopup(c,o,f);});};S.setStaticShareData=function(s){var r=sap.ui.getCore().getLibraryResourceBundle("sap.m");s.setProperty("/emailButtonText",r.getText("SEMANTIC_CONTROL_SEND_EMAIL"));};S.openSharePopup=function(b,c,f){var s;l=b;f.onCancelPressed=function(){s.close();};f.setShareSheet=function(g){c.shareSheet=g;};var t=new J({id:c.getView().getId()}),p={bindingContexts:{"this":t.createBindingContext("/")},models:{"this":t,"this.i18n":c.getView().getModel("sap.fe.i18n")}};var m=f.getModelData();if(c.shareSheet){s=c.shareSheet;var o=s.getModel("share");S.setStaticShareData(o);var n=e(o.getData(),m);o.setData(n);s.openBy(b);}else{var v=c.getView(),B=v.getBindingContext();var d="sap.fe.templates.controls.Share.ShareSheet",P=X.loadTemplate(d,"fragment");Promise.resolve(a.process(P,{name:d},p)).then(function(g){return F.load({definition:g,controller:f});}).then(function(A){s=A;s.setModel(new J(m),"share");var o=s.getModel("share");S.setStaticShareData(o);var n=e(o.getData(),m);o.setData(n);v.addDependent(s);s.setBindingContext(B);s.openBy(b);f.setShareSheet(s);}).catch(function(E){L.error("Error while opening the share fragment",E);});}};S.getCustomUrl=function(){var h=H.getInstance().getHash();return h?H.getInstance().hrefForAppSpecificHash("")+h:window.location.href;};S.getCountUrl=function(c){var t=c.getView().getContent()[0].data().singleTableId;if(!t){t=c.getView().byId("fe::TabMultipleMode").getSelectedKey();}var T=c.getView().byId(t);if(!T){return"";}var b=T.getRowBinding()||T.getBinding("items");var d=(b&&b.getDownloadUrl())||"";var s=d.split("?");var f=s[0]+"/$count?";var g=[];if(s.length>1){var u=s[1];u.split("&").forEach(function(h){var U=h.split("=");switch(U[0]){case"$apply":case"$search":case"$filter":g.push(h);}});}return f+g.join("&");};return S;});
