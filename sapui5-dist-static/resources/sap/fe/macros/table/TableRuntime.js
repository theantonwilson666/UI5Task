/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/model/json/JSONModel","sap/fe/macros/CommonHelper","sap/fe/core/CommonUtils","sap/fe/core/library","sap/base/Log","sap/ui/mdc/enum/ConditionValidated","sap/fe/macros/field/FieldRuntime","sap/ui/core/ValueState","sap/fe/macros/table/TableHelper"],function(J,C,a,F,L,b,c,V,T){"use strict";var d=F.CreationMode;var e={displayTableSettings:function(E){var p=E.getSource().getParent(),s=sap.ui.getCore().byId(p.getId()+"-settings");C.fireButtonPress(s);},executeConditionalActionShortcut:function(B,s){var p=s.getParent();if(B!==d.CreationRow){var o=p.getActions().find(function(E){return E.getId().endsWith(B);});C.fireButtonPress(o);}else{var f=p.getAggregation("creationRow");if(f&&f.getApplyEnabled()&&f.getVisible()){f.fireApply();}}},setContexts:function(t,D,o,s,n,A){var f=A?A.split(","):[];var g=JSON.parse(s);var N=n&&n!=="undefined"&&JSON.parse(n);var S=t.getSelectedContexts();var h=false;var j=[];var u=[];var l=[];var k={};var I={};var m={};var M;var p=t.getBindingContext("internal");m.aUnsavedContexts=[];m.aLockedContexts=[];p.setProperty("",{selectedContexts:S,numberOfSelectedContexts:S.length,dynamicActions:k,ibn:I,deleteEnabled:true,deletableContexts:[],unSavedContexts:[],lockedContexts:[]});for(var i=0;i<S.length;i++){var q=S[i];var r=q.getObject();for(var v in r){if(v.indexOf("#")===0){var w=v;w=w.substring(1,w.length);M=p.getObject();M.dynamicActions[w]={enabled:true};p.setProperty("",M);}}M=p.getObject();if(D!="undefined"){if(q&&q.getProperty(D)){if(o!=="undefined"&&r.IsActiveEntity===true&&r.HasDraftEntity===true){m=x(r,q);}else{j.push(q);m.isDeletable=true;}}M["deleteEnabled"]=m.isDeletable;}else if(o!=="undefined"&&r.IsActiveEntity===true&&r.HasDraftEntity===true){m=x(r,q);}else{j.push(q);}}function x(r,q){if(r.DraftAdministrativeData.InProcessByUser){l.push(q);}else{u.push(q);h=true;}return{aLockedContexts:l,aUnsavedContexts:u,isDeletable:h};}a.setActionEnablement(p,g,S);if(!t.data("enableAnalytics")){T.setIBNEnablement(p,N,S);}if(S.length>1){this.disableAction(f,k);}M["deletableContexts"]=j;M["unSavedContexts"]=m.aUnsavedContexts;M["lockedContexts"]=m.aLockedContexts;M["controlId"]=t.getId();p.setProperty("",M);},disableAction:function(A,D){A.forEach(function(s){D[s]={bEnabled:false};});},onFieldChangeInCreationRow:function(o,E,n){var s=E.getSource();if(s.isA("sap.fe.macros.FieldAPI")){s=s.getContent();}if(s.isA("sap.fe.core.controls.FieldWrapper")&&s.getEditMode()==="Editable"){s=s.getContentEdit()[0];}var f=s.getId();var i=s.isA("sap.ui.mdc.Field");var I=s.getBindingContext("internal");var m=I.getProperty("creationRowFieldValidity"),N=Object.assign({},m),g=E.getParameter("isValid"),h;if(i){if(g===undefined){if(s.getMaxConditions()===1){g=s.getConditions()[0]&&s.getConditions()[0].validated===b.Validated;}if(s.getValue()===""&&!s.getProperty("required")){g=true;}}h=s.getValue();N[f]={fieldValue:h,validity:!!g};I.setProperty("creationRowFieldValidity",N);}else{var v=s.getBinding("value")||E.getBinding("selected");N[f]={fieldValue:v.getValue(),validity:v.getDataState()?v.getDataState().getMessages().length===0:true};I.setProperty("creationRowFieldValidity",N);}},getVBoxVisibility:function(){var i=this.getItems();var l=false;for(var f=i.length-1;f>=0;f--){if(!l){if(arguments[f]!==true){l=true;if(C._isRatingIndicator(i[f])){C._updateStyleClassForRatingIndicator(i[f],true);}else{i[f].removeStyleClass("sapUiTinyMarginBottom");}}}else{if(C._isRatingIndicator(i[f])){C._updateStyleClassForRatingIndicator(i[f],false);}else{i[f].addStyleClass("sapUiTinyMarginBottom");}}}return true;}};return e;},true);
