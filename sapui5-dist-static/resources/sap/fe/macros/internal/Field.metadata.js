/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["../MacroMetadata","sap/fe/core/converters/MetaModelConverter","sap/fe/core/templating/UIFormatters","sap/fe/core/helpers/BindingExpression","sap/fe/core/templating/DataModelPathHelper","sap/fe/macros/field/FieldTemplating","sap/fe/core/TemplateModel"],function(M,a,U,B,D,F,T){"use strict";var b=M.extend("sap.fe.macros.internal.Field",{name:"Field",namespace:"sap.fe.macros.internal",fragment:"sap.fe.macros.internal.Field",metadata:{stereotype:"xmlmacro",designtime:"sap/fe/macros/internal/Field.designtime",properties:{idPrefix:{type:"string"},_apiId:{type:"string"},vhIdPrefix:{type:"string",defaultValue:"FieldValueHelp"},_vhFlexId:{type:"string",computed:true},entitySet:{type:"sap.ui.model.Context",required:true,$kind:["EntitySet","NavigationProperty"]},entityType:{type:"sap.ui.model.Context",required:false,computed:true,$kind:["EntityType"]},navigateAfterAction:{type:"boolean",defaultValue:true},dataField:{type:"sap.ui.model.Context",required:true,$kind:"Property",$Type:["com.sap.vocabularies.UI.v1.DataField","com.sap.vocabularies.UI.v1.DataFieldWithUrl","com.sap.vocabularies.UI.v1.DataFieldForAnnotation","com.sap.vocabularies.UI.v1.DataFieldForAction","com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation","com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath","com.sap.vocabularies.UI.v1.DataPointType"]},editMode:{type:"sap.ui.mdc.enum.EditMode"},wrap:{type:"boolean"},"class":{type:"string"},ariaLabelledBy:{type:"string"},formatOptions:{type:"object",properties:{valueFormat:{type:"string"},textAlignMode:{type:"string",defaultValue:"Table",allowedValues:["Table","Form"]},displayMode:{type:"string",allowedValues:["Value","Description","ValueDescription","DescriptionValue"]},textLinesDisplay:{type:"number",configurable:true},textLinesEdit:{type:"number",configurable:true},showEmptyIndicator:{type:"boolean",defaultValue:false},semanticKeyStyle:{type:"string",defaultValue:"",allowedValues:["ObjectIdentifier","Label",""]},showIconUrl:{type:"boolean",defaultValue:false},ignoreNavigationAvailable:{type:"boolean",defaultValue:false},isAnalytics:{type:"boolean",defaultValue:false}}}},events:{onChange:{type:"function"}}},create:function(p,c,s){var o=this.getOverrides(c,p.dataField.getPath());var d=a.convertMetaModelContext(p.dataField);var e=a.getInvolvedDataModelObjects(p.dataField,p.entitySet);var P=d;var E="";if(d&&d.term==="com.sap.vocabularies.UI.v1.DataPoint"){d.$Type=d.$Type||"com.sap.vocabularies.UI.v1.DataPointType";}if(d&&d.$Type){switch(d.$Type){case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataPointType":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":if(typeof d.Value==="object"){P=d.Value.$target;E=d.Value.path;}break;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(d.Target.$target){switch(d.Target.$target.$Type){case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataPointType":if(typeof d.Target.$target.Value==="object"){P=d.Target.$target.Value.$target;E=d.Target.$target.Value.path;}break;default:if(typeof d.Target==="object"){P=d.Target.$target;E=d.Target.path;}break;}}break;}}if(E&&E.length>0){e=D.enhanceDataModelPath(e,E);}p.dataSourcePath=D.getTargetObjectPath(e);var m=s.models.metaModel||s.models.entitySet;p.entityType=m.createBindingContext("/"+e.targetEntityType.fullyQualifiedName);if(p.editMode!==undefined&&p.editMode!==null){p.editModeAsObject=p.editMode;}else{p.editModeAsObject=U.getEditMode(P,e,true);p.editMode=B.compileBinding(p.editModeAsObject);}if(!p.formatOptions.displayMode){p.formatOptions.displayMode=U.getDisplayMode(P,e,p.editModeAsObject);}p.formatOptions.textLinesDisplay=p.formatOptions.textLinesDisplay||o.textLinesDisplay||(o.formatOptions&&o.formatOptions.textLinesDisplay);p.formatOptions.textLinesEdit=o.textLinesEdit||(o.formatOptions&&o.formatOptions.textLinesEdit)||p.formatOptions.textLinesEdit||4;if(p._flexId){p._apiId=p._flexId;p._flexId+="-content";p._vhFlexId=p._flexId+"_"+p.vhIdPrefix;}p.displayStyle=F.getDisplayStyle(P,d,e,p.formatOptions);p.editStyle=F.getEditStyle(P,d);var f=["Avatar","AmountWithCurrency","ObjectIdentifier"];if(p.displayStyle&&f.indexOf(p.fieldStyle)===-1&&e.targetObject){p.text=F.getTextBinding(e,p.formatOptions);}else{p.text="";}p.valueBindingExpression=F.getValueBinding(e,p.formatOptions);p.valueAsStringBindingExpression=F.getValueBinding(e,p.formatOptions,true,true,undefined,true);if(e.targetObject){p.unitBindingExpression=F.getUnitBinding(e,p.formatOptions);p.textBindingExpression=F.getAssociatedTextBinding(e,p.formatOptions);}var g=p.dataField.getObject();p.formatOptions.navigationAvailable=true;if(g&&g.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&g.NavigationAvailable!==undefined&&p.formatOptions.ignoreNavigationAvailable!=="true"){if(g.NavigationAvailable.$Path){p.formatOptions.navigationAvailable="{"+g.NavigationAvailable.$Path+"}";}else{p.formatOptions.navigationAvailable=g.NavigationAvailable;}}if(p.dataField.getObject("@sapui.name")&&p.dataField.getObject("@sapui.name").indexOf("com.sap.vocabularies.UI.v1.DataPoint")>-1){var h=p.dataField.getObject();h.$Type=h.$Type||"com.sap.vocabularies.UI.v1.DataPointType";p.dataField=new T(h,p.dataField.getModel()).createBindingContext("/");}return p;}});return b;});
