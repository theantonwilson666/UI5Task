/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/fe/macros/ResourceModel","sap/fe/macros/CommonHelper","sap/fe/core/CommonUtils","sap/ui/mdc/odata/v4/TypeUtil","sap/ui/model/odata/v4/AnnotationHelper","sap/ui/base/ManagedObject","sap/base/Log","sap/base/strings/formatMessage","sap/ui/model/json/JSONModel","sap/ui/mdc/condition/FilterOperatorUtil","sap/fe/core/helpers/StableIdHelper","sap/fe/macros/library","sap/fe/macros/internal/valuehelp/ValueListHelper","sap/fe/core/templating/UIFormatters"],function(R,C,a,T,A,M,L,f,J,F,S,b,V,U){"use strict";var I="@Org.OData.Measures.V1.ISOCurrency",c="@Org.OData.Measures.V1.Unit";function _(i){var m=i.getModel(),o=i.getSetting("sap.fe.macros.internal.Field"),s=o.sideEffects;if(s){return Promise.resolve(s);}s={};return m.requestObject("/$").then(function(e){var g=function(k){return e[k]["$kind"]==="EntityType";},h=function(E,k,l){var q=(k.indexOf("#")>-1&&k.substr(k.indexOf("#")))||"",n=l.SourceProperties||[],p=l.SourceEntities||[],P=[];n.forEach(function(r){var t=r["$PropertyPath"],N=t.indexOf("/")>0?"/"+E+"/"+t.substr(0,t.lastIndexOf("/")+1)+"@sapui.name":false,u=!N?Promise.resolve(E):m.requestObject(N);t=N?t.substr(t.lastIndexOf("/")+1):t;P.push(u.then(function(O){s[O]=s[O]||[[],{}];s[O][1][t]=s[O][1][t]||[];s[O][1][t].push(E+q+((n.length===1&&"$$ImmediateRequest")||""));}));});p.forEach(function(r){var N=r["$NavigationPropertyPath"],t;if(N===""){t=Promise.resolve(E);}else{t=m.requestObject("/"+E+"/"+N+"/@sapui.name");}P.push(t.then(function(O){s[O]=s[O]||[[],{}];s[O][0].push(E+q+"$$ImmediateRequest");}));});return Promise.all(P);},j=function(E){return m.requestObject("/"+E+"@").then(function(k){var l=Object.keys(k).filter(function(n){return n.indexOf("@com.sap.vocabularies.Common.v1.SideEffects")>-1;}).map(function(n){return h(E,n,k[n]);});return Promise.all(l);});};return Promise.all(Object.keys(e).filter(g).map(j)).then(function(){o.sideEffects=s;return s;});});}var d={displayMode:function(p,o){var t=p["@com.sap.vocabularies.Common.v1.Text"],e=t&&((p&&p["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"])||(o&&o["@com.sap.vocabularies.UI.v1.TextArrangement"]));if(e){if(e.$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"){return"Description";}else if(e.$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextLast"){return"ValueDescription";}return"DescriptionValue";}return t?"DescriptionValue":"Value";},isRequiredInFilter:function(p,D){var e,P,i=false,o,m=D.context.getModel(),s=D.context.getPath();e=C.getEntitySetForPropertyPath(m,s);if(typeof p==="string"){P=p;}else{P=m.getObject(s+"@sapui.name");}o=m.getObject(e+"@Org.OData.Capabilities.V1.FilterRestrictions");if(o&&o.RequiredProperties){i=o.RequiredProperties.some(function(g){return g.$PropertyPath===P;});}return i;},maxConditions:function(p,D){var e,P,o,m=-1,g=D.context.getModel(),s=D.context.getPath();e=C.getEntitySetForPropertyPath(g,s);if(typeof p==="string"){P=p;}else{P=g.getObject(s+"@sapui.name");}o=g.getObject(e+"@Org.OData.Capabilities.V1.FilterRestrictions");var h=g.getObject(e+"/"+P);if(!h){h=g.getObject(s);}if(h.$Type==="Edm.Boolean"){m=1;}else if(o&&o.FilterExpressionRestrictions&&o.FilterExpressionRestrictions.some(function(i){return(i.Property.$PropertyPath===P&&(i.AllowedExpressions==="SingleValue"||i.AllowedExpressions==="SingleRange"));})){m=1;}return m;},getDecimalFormat:function(r,p,v){var P=r.search("'precision':")+"'precision':".length;var i=r.substr(P,r.search(",'scale':")-P);var D=v[v.length-1];return("{path:'"+p.$Path+"',type:'sap.ui.model.odata.type.Decimal',constraints:{'precision':"+i+",'scale':"+D+"}}");},getValueFormatted:function(i,p,o){if(!p.$Path){return p;}var e=i.getInterface(0);var m=e.getModel();var P=e.getPath();var g=m.createBindingContext(P);if(o&&o.valueFormat){var v=o.valueFormat;if(v.substr(0,7)==="Decimal"){var h=A.format({$Path:p.$Path},{arguments:[],context:g});if(typeof h==="string"){return d.getDecimalFormat(h,p,v);}else{return h.then(function(r){return d.getDecimalFormat(r,p,v);});}}var r=A.format({$Path:p.$Path},{arguments:[null,{style:v}],context:g});return r;}else{return A.format({$Path:p.$Path},{arguments:[],context:g});}},buildExpressionForCriticalityIcon:function(s){if(s){var e="{= (${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Negative') || (${"+s+"} === '1') || (${"+s+"} === 1) ? 'sap-icon://message-error' : "+"(${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Critical') || (${"+s+"} === '2') || (${"+s+"} === 2) ? 'sap-icon://message-warning' : "+"(${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Positive') || (${"+s+"} === '3') || (${"+s+"} === 3) ? 'sap-icon://message-success' : "+"(${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Information') || (${"+s+"} === '5') || (${"+s+"} === 5) ? 'sap-icon://message-information' : "+"'' }";return e;}return undefined;},buildExpressionForCriticalityColor:function(D){var s=sap.ui.core.ValueState.None;var e;var o=D.Criticality;if(o){e="'{'= ({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Negative'') || ({0} === ''1'') || ({0} === 1) ? ''"+sap.ui.core.ValueState.Error+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Critical'') || ({0} === ''2'') || ({0} === 2) ? ''"+sap.ui.core.ValueState.Warning+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Positive'') || ({0} === ''3'') || ({0} === 3) ? ''"+sap.ui.core.ValueState.Success+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Information'') || ({0} === ''5'') || ({0} === 5) ? ''"+sap.ui.core.IndicationColor.Indication05+"'' : "+"''"+sap.ui.core.ValueState.None+"'' '}'";if(o.$Path){var g="${"+o.$Path+"}";s=f(e,g);}else if(o.$EnumMember){var h="'"+o.$EnumMember+"'";s=f(e,h);}else{L.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}}else{L.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}return s;},buildExpressionForTextValue:function(p,D){var m=D.context.getModel(),P=D.context.getPath(),t=m.createBindingContext(P+"@com.sap.vocabularies.Common.v1.Text"),o=t.getProperty(),s=o?A.value(o,{context:t}):undefined,e="",p=A.getNavigationPath(p);if(p.indexOf("/")>-1&&s){e=p.replace(/[^\/]*$/,s.substr(1,s.length-2));}else{e=s;}if(e){e="{ path : '"+e.replace(/^\{+/g,"").replace(/\}+$/g,"")+"', parameters: {'$$noPatch': true}}";}return e;},formatDataPointField:function(i,p,v,D,P){if(P==="Edm.Decimal"&&D.ValueFormat){if(D.ValueFormat.NumberOfFractionalDigits){v="Decimal:"+D.ValueFormat.NumberOfFractionalDigits;}}return d.getValueFormatted(i,p,v);},hasSemanticObjectTargets:function(s,e,p,P){var g=p.$target.fullyQualifiedName;var E=P.targetEntitySet?P.targetEntitySet.name:P.startEntitySet.name;var h=g.replace(P.targetEntityType.fullyQualifiedName,"/"+E);if(h&&s&&s.length>0){var i=h.replace(/\//g,"_");var B="pageInternal>semanticsTargets/"+s+"/"+i+(!e?"/HasTargetsNotFiltered":"/HasTargets");return"{parts:[{path:'"+B+"'}], formatter:'FieldRuntime.hasTargets'}";}else{return false;}},buildFieldBindingExpression:function(i,p,P,D,o,e,s){var v;if(o&&o.valueFormat){v=o.valueFormat;}if(s==="Edm.Decimal"&&e.ValueFormat){if(e.ValueFormat.NumberOfFractionalDigits){v="Decimal:"+e.ValueFormat.NumberOfFractionalDigits;}}return Promise.resolve(d.getValueFormatted(i,p,{valueFormat:v})).then(function(g){var h=o.displayMode;var E;switch(h){case"Description":E=D;break;case"ValueDescription":E="{ parts:["+g+", "+D+"], formatter:'FieldRuntime.formatWithBrackets'}";break;case"DescriptionValue":E="{ parts:["+D+", "+g+"], formatter:'FieldRuntime.formatWithBrackets'}";break;default:var j=P["@Org.OData.Measures.V1.Unit"];if(j==="%"){E="{ parts:["+g+"], formatter:'FieldRuntime.formatWithPercentage'}";}else{E=g;}}return E;});},_buildExpressionForTextProperty:function(p,i){var m=i.context.getModel(),P=i.context.getPath(),e=P.split("/"),t=m.createBindingContext(P+"@com.sap.vocabularies.Common.v1.Text"),o=t.getProperty(),s=o?A.value(o,{context:t}):undefined,E="";if(s){E=s;s=s.substr(1,s.length-2);if(e.length>2){e.shift();e.shift();e.pop();E="{"+(e.length>0?e.join("/")+"/":"")+s+"}";}}if(E){E="{ path : '"+E.substr(1,E.length-2)+"', parameters: {'$$noPatch': true}}";}return E;},isNotAlwaysHidden:function(D,o){var e=o.context,i=false;if(D.Value&&D.Value.$Path){i=e.getObject("Value/$Path@com.sap.vocabularies.UI.v1.Hidden");}if(!i||i.$Path){i=e.getObject("@com.sap.vocabularies.UI.v1.Hidden");if(!i||i.$Path){i=false;}}return!i;},isSemanticKey:function(s,v){return((v&&s&&!s.every(function(k){return k["$PropertyPath"]!==v["$Path"]&&k["$PropertyPath"]!==v;}))||false);},isLineItem:function(p,i){if(i.context.getPath().indexOf("@com.sap.vocabularies.UI.v1.LineItem")>-1){return true;}return false;},getRequiredForDataField:function(o,e){var E;if(e==="Display"||e==="ReadOnly"||e==="Disabled"){return false;}if(o&&e){if(e.startsWith("{")){e="{ui>/editMode}";}if(e.indexOf("{")>-1){E="%"+e+" === 'Editable'";}if(o.indexOf("{")>-1){var s="%"+o+" === 7";return e==="Editable"?"{="+s+"}":"{= "+s+" && "+E+"}";}else{return e==="Editable"?o=="com.sap.vocabularies.Common.v1.FieldControlType/Mandatory":o=="com.sap.vocabularies.Common.v1.FieldControlType/Mandatory"&&"{= "+E+"}";}}return false;},isRequired:function(o,e){if(e==="Display"||e==="ReadOnly"||e==="Disabled"){return false;}if(o){if(M.bindingParser(o)){var E="{= %"+o+" === 7}";return E;}else{return o=="com.sap.vocabularies.Common.v1.FieldControlType/Mandatory";}}return false;},_getDraftAdministrativeDataType:function(m,e){return m.requestObject("/"+e+"/DraftAdministrativeData/");},getBindingForDraftAdminBlockInline:function(i,e){return d._getDraftAdministrativeDataType(i.getModel(),e).then(function(D){var B=[];if(D.InProcessByUserDescription){B.push("${DraftAdministrativeData/InProcessByUserDescription}");}B.push("${DraftAdministrativeData/InProcessByUser}");if(D.LastChangedByUserDescription){B.push("${DraftAdministrativeData/LastChangedByUserDescription}");}B.push("${DraftAdministrativeData/LastChangedByUser}");return"{= %{HasDraftEntity} ? ("+B.join(" || ")+") : '' }";});},propertyName:function(p,i){var P;if(typeof p==="string"){if(i.context.getPath().indexOf("$Path")>-1||i.context.getPath().indexOf("$PropertyPath")>-1){P=p;}}else if(p.$Path||p.$PropertyPath){var s=p.$Path?"/$Path":"/$PropertyPath";var e=i.context.getPath();P=i.context.getObject(e+s+"/$@sapui.name");}else{P=i.context.getObject("@sapui.name");}return P;},getConditionsBinding:function(e,p,E){var P=e.getInterface(0),m=P.getModel(),s=P.getPath(),g="",h,j,i;if(E&&E["$kind"]==="EntityType"){h=e.getInterface(1).getPath();var k=s.replace(h,"");j=k.split("/");}else{j=s.substring(1).split("/");h="/"+j.shift()+"/";}for(i=0;i<j.length;++i){p=m.getProperty(h+j.slice(0,i+1).join("/"));if(p.$kind==="NavigationProperty"&&p.$isCollection){g+=j[i]+"*/";}else if(typeof p!=="string"){g+=j[i]+"/";}}return"{$filters>/conditions/"+g.substring(0,g.length-1)+"}";},_context:function(p,i){return i;},constraints:function(p,i){var v=A.format(p,i),m=v&&v.match(/constraints:.*?({.*?})/),s=m&&m[1];if(v.indexOf("sap.ui.model.odata.type.DateTimeOffset")>-1){if(s){s=s.substr(0,m[1].indexOf("}"))+", V4: true}";}else{s="{V4: true}";}}return s||undefined;},formatOptions:function(p,i){var v=A.format(p,i),m=v&&v.match(/formatOptions:.*?({.*?})/);return(m&&m[1])||undefined;},getFieldGroupIds:function(o,p,e){if(!p){return undefined;}var i=o.getInterface(0);return _(i).then(function(s){var m=i.getModel(),P=p,E=o.getPath(1).substr(1),n=P.indexOf("/")>0?"/"+E+"/"+P.substr(0,P.lastIndexOf("/")+1)+"@sapui.name":false,g=!n?Promise.resolve(E):m.requestObject(n),h,j;P=n?P.substr(P.lastIndexOf("/")+1):P;return g.then(function(O){h=(s[O]&&s[O][0].concat(s[O][1][P]||[]))||[];if(h.length){j=h.reduce(function(r,k){return(r&&r+","+k)||k;});}return j;});});},fieldControl:function(p,i){var m=i&&i.context.getModel();var P=i&&i.context.getPath();var o=m&&m.createBindingContext(P+"@com.sap.vocabularies.Common.v1.FieldControl");var e=o&&o.getProperty();if(e){if(e.hasOwnProperty("$EnumMember")){return e.$EnumMember;}else if(e.hasOwnProperty("$Path")){return A.value(e,{context:o});}}else{return undefined;}},getNavigationEntity:function(p,o){var e=(o&&o.context)||p,n=A.getNavigationPath(e.getPath())+"/",P=e.getObject().$Path,N="",s=P.split("/").pop();if(P.indexOf("/")>-1){N=P.substring(0,P.lastIndexOf("/"))+"/";n+=N;}var E=e.getObject(n),k=Object.keys(E),l=k.length,i=0;for(;i<l;i++){if(E[k[i]].$kind==="NavigationProperty"&&E[k[i]].$ReferentialConstraint&&E[k[i]].$ReferentialConstraint.hasOwnProperty(s)){return o?A.getNavigationBinding(N+k[i]):n+k[i];}}},getNavigationPath:function(i,e,p){var o=i.getModel(1).createBindingContext(i.getPath(1));var P=o.getObject("@sapui.name");var s=i.getPath(1);var g=s.split("/");var h=g.indexOf(e);g.splice(h,1);h=g.indexOf(P);g.splice(h,1);var j=g.filter(function(l){return l!=="";});var k=j.join("/");return"{"+k+"}";},valueHelpProperty:function(p,i){var s=p.getPath(),o=p.getObject()||{},P=o.$Path?s+"/$Path":s,e=P+"@",g=p.getObject(e),h;if(g){h=(g.hasOwnProperty(I)&&I)||(g.hasOwnProperty(c)&&c);if(h&&!i){P=P+h+"/$Path";}}return P;},valueHelpPropertyForFilterField:function(p){return d.valueHelpProperty(p,true);},getIDForFieldValueHelp:function(s,i,o,p){if(s){return s;}var P=p;if(o!==p){P=o+"::"+p;}return S.generate([i,P]);},isValueHelp:function(p){if(p){return(p["@com.sap.vocabularies.Common.v1.ValueListReferences"]||p["@com.sap.vocabularies.Common.v1.ValueListMapping"]||p["@com.sap.vocabularies.Common.v1.ValueList"]);}},getFieldHelpPropertyForFilterField:function(p,v,P,s,h){if(p==="Edm.Boolean"&&!h){return undefined;}return d.getIDForFieldValueHelp(null,v||"FilterFieldValueHelp",P,s);},getSemanticKeyTitle:function(p,P,D,t,s,o){var n=R.getText("M_FIELD_HELPER_NEW_OBJECT");var u=R.getText("M_FIELD_HELPER_UNNAMED_OBJECT");var N,e;var g;var h=function(v){N="($"+v+" === '' || $"+v+" === undefined || $"+v+" === null ? '"+n+"': $"+v+")";e="($"+v+" === '' || $"+v+" === undefined || $"+v+" === null ? '"+u+"': $"+v+")";return("(!%{IsActiveEntity} ? !%{HasActiveEntity} ? "+N+" : "+e+" : "+e+")");};var i=function(v,k){var E;if(o){E=h(v);return k?"{= "+E+"}":E;}else{return k?v:"$"+v;}};if(p){if(t&&s!=="ObjectIdentifier"){var j=t.$EnumMember;if(j==="com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst"){g=i(p,false);return("{= "+g+" +' (' + "+"($"+P+(D?" || ${"+D+"}":"")+") +')' }");}else if(j==="com.sap.vocabularies.UI.v1.TextArrangementType/TextLast"){g=i(p,false);return("{= ($"+P+(D?" || ${"+D+"}":"")+")"+" + ' (' + "+g+" +')' }");}else{return i(p,true);}}else{return i(p,true);}}else{return i(P,true);}},getObjectIdentifierText:function(t,o,p,D){if(t){if(o&&(o.$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"||o.$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextSeparate")){return undefined;}else{return p||"{"+D+"}";}}return undefined;},buildExpressionForProgressIndicatorPercentValue:function(v,t,u){var p="0";var e;v=v.charAt(0)==="{"?"$"+v:v;t=t&&t.charAt(0)==="{"?"$"+t:t;var E="(({0} > 100) ? 100 : (({0} < 0) ? 0 : ({0} * 1)))";var s="(({1} > 0) ? (({0} > {1}) ? 100 : (({0} < 0) ? 0 : ({0} / {1} * 100))) : 0)";if(u){u="'"+u+"'";e="'{'= ({2} === ''%'') ? "+E+" : "+s+" '}'";p=f(e,[v,t,u]);}else{e="'{'= "+s+" '}'";p=f(e,[v,t]);}return p;},buildExpressionForProgressIndicatorDisplayValue:function(v,t,u){var D="";if(v){if(u){if(u==="%"){D=v+" %";}else if(t){D=R.getText("T_COMMON_PROGRESS_INDICATOR_DISPLAY_VALUE_NO_UOM",[v,t])+" "+u;}else{D=v+" "+u;}}else if(t){D=R.getText("T_COMMON_PROGRESS_INDICATOR_DISPLAY_VALUE_NO_UOM",[v,t]);}else{D=v;}}else{L.warning("Value property is mandatory, the default (empty string) will be returned");}return D;},getFieldEditModeInValueHelp:function(v,p){var P=(v&&v.Parameters)||[],e="Editable",o;if(P.length){for(var i in P){o=P[i];if(o.ValueListProperty===p){if(o.$Type.indexOf("Out")>48){return"Editable";}else if(o.$Type.indexOf("In")>48){e="ReadOnly";}}}}return e;},joinArray:function(s){return s.join(",");},getSemanticObjectsList:function(p){var e=p;var s=[];for(var k in e.getObject()){if(k.indexOf("com.sap.vocabularies.Common.v1.SemanticObject")>-1&&k.indexOf("com.sap.vocabularies.Common.v1.SemanticObjectMapping")===-1&&k.indexOf("com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions")===-1){var g=e.getObject()[k];if(s.indexOf(g)===-1){s.push(g);}}}var o=new J(s);o.$$valueAsPromise=true;return o.createBindingContext("/");},getSemanticObjectsQualifiers:function(p){var e=p;var q=[];var g=function(j){return q.find(function(o){return o.qualifier===j;});};for(var k in e.getObject()){if(k.indexOf("com.sap.vocabularies.Common.v1.SemanticObject#")>-1||k.indexOf("com.sap.vocabularies.Common.v1.SemanticObjectMapping#")>-1||k.indexOf("com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions#")>-1){var h=e.getObject()[k],i=k.split("#")[0],j=k.split("#")[1],l=g(j);if(!l){l={qualifier:j};l[i]=h;q.push(l);}else{l[i]=h;}}}q=q.filter(function(o){return!!o["@com.sap.vocabularies.Common.v1.SemanticObject"];});var Q=new J(q);Q.$$valueAsPromise=true;return Q.createBindingContext("/");},getSemanticObjectsWithAnnotations:function(p){var e=p;var s=[];var g=function(q){return s.find(function(j){return j.qualifier===q;});};for(var k in e.getObject()){if(k.indexOf("com.sap.vocabularies.Common.v1.SemanticObject")>-1||k.indexOf("com.sap.vocabularies.Common.v1.SemanticObjectMapping")>-1||k.indexOf("com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions")>-1){if(k.indexOf("#")>-1){var h=e.getObject()[k],i=k.split("#")[0],q=k.split("#")[1],l=g(q);if(!l){l={qualifier:q};l[i]=h;s.push(l);}else{l[i]=h;}}else{var h=e.getObject()[k],i,q;if(k.indexOf("com.sap.vocabularies.Common.v1.SemanticObjectMapping")>-1){i="@com.sap.vocabularies.Common.v1.SemanticObjectMapping";}else if(k.indexOf("com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions")>-1){i="@com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions";}else if(k.indexOf("com.sap.vocabularies.Common.v1.SemanticObject")>-1){i="@com.sap.vocabularies.Common.v1.SemanticObject";}var l=g("main");if(!l){l={qualifier:"main"};l[i]=h;s.push(l);}else{l[i]=h;}}}}s=s.filter(function(Q){return!!Q["@com.sap.vocabularies.Common.v1.SemanticObject"];});var o=new J(s);o.$$valueAsPromise=true;return o.createBindingContext("/");},computeLinkParameters:function(e,g,s,h,i,j,m,n){return Promise.resolve().then(function(v){var k=[],l=[],o=[],p=[];if(h){h.forEach(function(r){if(r["@com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"]){var t={semanticObject:r["@com.sap.vocabularies.Common.v1.SemanticObject"],actions:r["@com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"]};l.push(t);}if(r["@com.sap.vocabularies.Common.v1.SemanticObjectMapping"]){var w=[];r["@com.sap.vocabularies.Common.v1.SemanticObjectMapping"].forEach(function(y){w.push({key:y.LocalProperty.$PropertyPath,value:y.SemanticObjectProperty});});var x={semanticObject:r["@com.sap.vocabularies.Common.v1.SemanticObject"],items:w};k.push(x);}});if(s){var u=sap.ushell&&sap.ushell.Container;var q=u&&u.getService("CrossApplicationNavigation");s.forEach(function(r){if(typeof r==="string"){p.push(q.getPrimaryIntent(r,{}));}});}return Promise.all(p).then(function(o){return JSON.stringify({name:e,payload:{semanticObjects:s,entityType:g,semanticObjectUnavailableActions:l,semanticObjectMappings:k,semanticPrimaryActions:o,mainSemanticObject:m,dataField:i,contact:j,navigationPath:n}});});}else{return JSON.stringify({name:e,payload:{semanticObjects:s,entityType:g,semanticObjectUnavailableActions:l,semanticObjectMappings:k,semanticPrimaryActions:o,mainSemanticObject:m,dataField:i,contact:j,navigationPath:n}});}});},checkPrimaryActions:function(s){var p=s.semanticPrimaryActions[s.semanticObjects.indexOf(s.mainSemanticObject)];var u=sap.ushell&&sap.ushell.Container;var x=u&&u.getService("CrossApplicationNavigation");var e=x.hrefForExternal();if(s.mainSemanticObject&&p!==null&&p.intent!==e){for(var i=0;i<s.semanticObjectUnavailableActions.length;i++){if(s.mainSemanticObject.indexOf(s.semanticObjectUnavailableActions[i].semanticObject)===0){for(var j=0;j<s.semanticObjectUnavailableActions[i].actions.length;j++){if(p.intent.split("-")[1].indexOf(s.semanticObjectUnavailableActions[i].actions[j])===0){return false;}}}}return true;}else{return false;}},getPrimaryAction:function(s){return s.semanticPrimaryActions[s.semanticObjects.indexOf(s.mainSemanticObject)].intent?s.semanticPrimaryActions[s.semanticObjects.indexOf(s.mainSemanticObject)].intent:s.primaryIntentAction;},operators:function(i,p,u,s){if(!p){return undefined;}var o=i.getInterface(0).getModel(1).createBindingContext(i.getInterface(0).getPath(1));var P=d.propertyName(p,{context:o});var m=o.getModel(),e=o.getPath(),E=C.getEntitySetForPropertyPath(m,e),t=p.$Type;return a.getOperatorsForProperty(P,E,o,t,u,s);},getPropertyContextForQuickViewForm:function(D){var t=D.getObject("$Type");if(t==="com.sap.vocabularies.UI.v1.DataField"||t==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){var i=D.getInterface(),m=i.getModel(),p=i.getPath();p=p+(p.endsWith("/")?"Value":"/Value");return m.createBindingContext(p);}else{return D;}},getPropertyPathForQuickViewForm:function(p){if(p&&p.getObject("$Path")){var i=p.getInterface(),m=i.getModel(),P=i.getPath();P=P+(P.endsWith("/")?"$Path":"/$Path");return m.createBindingContext(P);}return p;},isDataFieldActionButtonVisible:function(t,D,i,o){return D["@com.sap.vocabularies.UI.v1.Hidden"]!==true&&(i!==true||o!==false);},getPressEventForDataFieldActionButton:function(t,D){var i="Isolated";if(D.InvocationGrouping&&D.InvocationGrouping.$EnumMember==="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"){i="ChangeSet";}var e=t.navigateAfterAction;e=e==="false"?false:true;var p={contexts:"${$source>/}.getBindingContext()",invocationGrouping:C.addSingleQuotes(i),model:"${$source>/}.getModel()",label:C.addSingleQuotes(D.Label),isNavigable:e};return C.generateFunction(".editFlow.invokeAction",C.addSingleQuotes(D.Action),C.objectToString(p));},isNumericDataType:function(D){var e=D;if(e!==undefined){var n=["Edm.Int16","Edm.Int32","Edm.Int64","Edm.Byte","Edm.SByte","Edm.Single","Edm.Decimal","Edm.Double"];return n.indexOf(e)===-1?false:true;}else{return false;}},isDateOrTimeDataType:function(p){if(p!==undefined){var D=["Edm.DateTimeOffset","Edm.DateTime","Edm.Date","Edm.TimeOfDay","Edm.Time"];return D.indexOf(p)>-1;}else{return false;}},isDateTimeDataType:function(p){if(p!==undefined){var D=["Edm.DateTimeOffset","Edm.DateTime"];return D.indexOf(p)>-1;}else{return false;}},isDateDataType:function(p){return p==="Edm.Date";},isTimeDataType:function(p){if(p!==undefined){var D=["Edm.TimeOfDay","Edm.Time"];return D.indexOf(p)>-1;}else{return false;}},getUnderlyingPropertyDataType:function(o,m,e,t){var s="@com.sap.vocabularies.Common.v1.Text",g="@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement";if(!!o&&!!o[g]&&o[g].$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"&&!!o[s]&&!!o[s].$Path){return m.getObject(e+"/"+o[s].$Path+"/$Type");}return t;},getColumnAlignment:function(D,t){var e=t.collection.sPath,m=t.collection.oModel;if((D["$Type"]==="com.sap.vocabularies.UI.v1.DataFieldForAction"||D["$Type"]==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")&&D.Inline&&D.IconUrl){return"Center";}return d.getDataFieldAlignment(D,m,e);},getPropertyAlignment:function(t,o,e){var D="Begin";var s=o?o.textAlignMode:"";switch(s){case"Form":if(this.isNumericDataType(t)){D="Begin";if(e){D=U.getAlignmentExpression(e,"Begin","End");}}break;default:if(this.isNumericDataType(t)||this.isDateOrTimeDataType(t)){D="End";}break;}return D;},getDataFieldAlignment:function(D,m,e,o,g){var s,h="Begin",t,j;if(D["$Type"]==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){s=D.Target.$AnnotationPath;if(D.Target["$AnnotationPath"]&&D.Target["$AnnotationPath"].indexOf("com.sap.vocabularies.UI.v1.FieldGroup")>=0){var k=m.getObject(e+"/"+s);for(var i=0;i<k.Data.length;i++){t=m.getObject(e+"/"+s+"/Data/"+i.toString()+"/Value/$Path/$Type");j=m.getObject(e+"/"+s+"/Data/"+i.toString()+"/Value/$Path@");t=this.getUnderlyingPropertyDataType(j,m,e,t);h=this.getPropertyAlignment(t,o,g);if(h==="Begin"){break;}}return h;}else if(D.Target["$AnnotationPath"]&&D.Target["$AnnotationPath"].indexOf("com.sap.vocabularies.UI.v1.DataPoint")>=0&&m.getObject(e+"/"+s+"/Visualization/$EnumMember")==="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){return h;}else{t=m.getObject(e+"/"+s+"/$Type");if(t==="com.sap.vocabularies.UI.v1.DataPointType"){t=m.getObject(e+"/"+s+"/Value/$Path/$Type");j=m.getObject(e+"/"+s+"/Value/$Path@");t=this.getUnderlyingPropertyDataType(j,m,e,t);}h=this.getPropertyAlignment(t,o,g);}}else{s=D.Value.$Path;t=m.getObject(e+"/"+s+"/$Type");j=m.getObject(e+"/"+s+"@");t=this.getUnderlyingPropertyDataType(j,m,e,t);if(!(m.getObject(e+"/")["$Key"].indexOf(s)===0)){h=this.getPropertyAlignment(t,o,g);}}return h;},getTypeAlignment:function(o,D,e,E,g,p){var i=o.getInterface(0);var m=i.getModel();if(E==="/undefined"&&p&&p.$target){E="/"+p.$target.fullyQualifiedName.split("/")[0];}return d.getDataFieldAlignment(D,m,E,e,g);},getImportance:function(D,s,e){if(!D["@com.sap.vocabularies.UI.v1.Importance"]){if(s&&s.length>0){var m=s.map(function(k){return k.$PropertyPath;});switch(D.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(D.Target&&D.Target.$AnnotationPath&&D.Target.$AnnotationPath.indexOf("@com.sap.vocabularies.UI.v1.FieldGroup")>-1){return e.some(function(o){return(o.Value&&o.Value.$Path&&o.$Type!=="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&m.includes(o.Value.$Path));})?"High":"None";}break;default:if(D.Value&&D.Value.$Path){return m.includes(D.Value.$Path)?"High":"None";}}}return"None";}else{switch(D["@com.sap.vocabularies.UI.v1.Importance"].$EnumMember){case"com.sap.vocabularies.UI.v1.ImportanceType/High":return"High";case"com.sap.vocabularies.UI.v1.ImportanceType/Medium":return"Medium";case"com.sap.vocabularies.UI.v1.ImportanceType/Low":return"Low";default:return"None";}}},isDataFieldActionButtonEnabled:function(D,i,o,s){if(i!==true){return"true";}return(o===null?"{= !${#"+D.Action+"} ? false : true }":o.$Path)?s:"true";},getLabelTextForDataField:function(e,p,P,s,u,g){var r;var D=e["@com.sap.vocabularies.Common.v1.DraftRoot"];r=d.getSemanticKeyTitle(p["@com.sap.vocabularies.Common.v1.Text"]&&P,s,u,p["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"],g,D);return r;},getMultipleLinesForDataField:function(t,p,P){if(t.wrap==="false"){return false;}if(p!=="Edm.String"){return P;}if(t.editMode==="Display"){return true;}if(t.editMode.indexOf("{")>-1){return"{= ${ui>/editMode} === 'Display' ? true : "+P+"}";}return P;},getIconForDataPoint:function(D){var e=D.CriticalityRepresentation&&D.CriticalityRepresentation["$EnumMember"]==="com.sap.vocabularies.UI.v1.CriticalityRepresentationType/WithoutIcon",s=D.Criticality&&D.Criticality["$Path"],i="";if(!e){i=d.buildExpressionForCriticalityIcon(s);}return i;},checkFieldHelp:function(o){return(o["@com.sap.vocabularies.Common.v1.ValueListReferences"]||o["@com.sap.vocabularies.Common.v1.ValueListMapping"]||o["@com.sap.vocabularies.Common.v1.ValueList"]);},getAPDialogDisplayFormat:function(p,i){var o,m=i.context.getModel(),s=i.context.getPath(),P=p.$Name||i.context.getProperty(s+"@sapui.name"),e=m.getObject(s+"@"),v=e["@com.sap.vocabularies.Common.v1.ValueList"]||e["@com.sap.vocabularies.Common.v1.ValueListMapping"]||e["@com.sap.vocabularies.Common.v1.ValueListReferences"],g=function(j){var k=j.Parameters.find(function(l){return l.LocalDataProperty&&l.LocalDataProperty.$PropertyPath===P;});return k&&k.ValueListProperty;},h;if(e["@com.sap.vocabularies.Common.v1.TextArrangement"]||e["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"]){return a.computeDisplayMode(e,undefined);}else if(v){if(v.CollectionPath){h=g(v);if(!h){return"Value";}o=m.getObject("/"+v.CollectionPath+"/"+h+"@");return o&&o["@com.sap.vocabularies.Common.v1.Text"]?a.computeDisplayMode(o,undefined):"Value";}else{return m.requestValueListInfo(s,true).then(function(j){h=g(j[""]);if(!h){return"Value";}o=j[""].$model.getMetaModel().getObject("/"+j[""]["CollectionPath"]+"/"+h+"@");return o&&o["@com.sap.vocabularies.Common.v1.Text"]?a.computeDisplayMode(o,undefined):"Value";});}}else{return"Value";}},getActionParameterDialogFieldHelp:function(o,s,p){return this.checkFieldHelp(o)?S.generate([s,p]):undefined;},getFieldValueHelpDelegate:function(i,e,s,p){return C.objectToString({name:C.addSingleQuotes("sap/fe/macros/FieldValueHelpDelegate"),payload:{propertyPath:C.addSingleQuotes(V.getPropertyPath({UnboundAction:!i,EntitySet:e,Action:s,Property:p}))}});},_getEntitySetFromMultiLevel:function(o,p,s,e,D){var n=p.split("/").filter(Boolean);n=n.filter(function(P){return P!=="$NavigationPropertyBinding";});if(n.length>0){for(var i=e;i<n.length-D;i++){s="/"+o.getObject(s+"/$NavigationPropertyBinding/"+n[i]);}}return s;},getPropertyCollection:function(p,o){var e=(o&&o.context)||p;var P=e.getPath(),m=P.split("/").filter(Boolean),s=m[0],g=e.getObject("$Path"),h="/"+s;if(P.indexOf("/@com.sap.vocabularies.")>-1){var i=P.indexOf("/@com.sap.vocabularies.");var j=P.substring(0,i);h=d._getEntitySetFromMultiLevel(e,j,h,1,0);}if(g&&g.indexOf("/")>-1){h=d._getEntitySetFromMultiLevel(e,g,h,0,1);}return h;},isSingleRangeDateField:function(p,i){if(p.$Type==="Edm.Date"){var P=d.propertyName(p,i);var o=i.context,m=o.getModel(),s=o.getPath(),e=C.getEntitySetForPropertyPath(m,s);var g=o.getObject(e+"@Org.OData.Capabilities.V1.FilterRestrictions");if(g&&g.FilterExpressionRestrictions&&g.FilterExpressionRestrictions.some(function(h){return h.Property.$PropertyPath===P;})){var r=g.FilterExpressionRestrictions.filter(function(h){return h.Property.$PropertyPath===P;});if(r.some(function(h){return h.AllowedExpressions==="SingleRange";})){return true;}}}return false;},getUnitOrCurrency:function(p){var P=p.getObject();var s=p.sPath;if(P["@Org.OData.Measures.V1.ISOCurrency"]){s=s+"Org.OData.Measures.V1.ISOCurrency";}else{s=s+"Org.OData.Measures.V1.Unit";}return s;},hasStaticUnitOrCurrency:function(p){return p["@Org.OData.Measures.V1.ISOCurrency"]?!p["@Org.OData.Measures.V1.ISOCurrency"].$Path:!p["@Org.OData.Measures.V1.Unit"].$Path;},getStaticUnitOrCurrency:function(p){return p["@Org.OData.Measures.V1.ISOCurrency"]||p["@Org.OData.Measures.V1.Unit"];},formatValueWithoutUnit:function(i,p){var m=i.getModel();var P=i.getPath();var o=m.createBindingContext(P);return Promise.resolve().then(function(){return A.format({$Path:p.$Path},{arguments:[],context:o});}).then(function(r){var e=/(.*,type:'sap\.ui\.model\.odata\.type\.(Unit|Currency)')}/;var g=r&&r.match(e);if(g&&g[1]){r=g[1]+",formatOptions:{showMeasure:false}}";}return r;});},getEmptyIndicatorTrigger:function(e,B,s){if(s){return e?s:"inactive";}return e?B:"inactive";},getBindingInfoForTextArrangement:function(t,D,o){if(D&&D.$EnumMember&&D.$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"&&o){return"{"+o.Value.$Path+"}";}}};d.getConditionsBinding.requiresIContext=true;d.buildExpressionForTextValue.requiresIContext=true;d.getRequiredForDataField.requiresIContext=true;d.getBindingForDraftAdminBlockInline.requiresIContext=true;d.getFieldGroupIds.requiresIContext=true;d.fieldControl.requiresIContext=true;d.getValueFormatted.requiresIContext=true;d.buildFieldBindingExpression.requiresIContext=true;d.formatDataPointField.requiresIContext=true;d.getNavigationPath.requiresIContext=true;d.getTypeAlignment.requiresIContext=true;d.getPropertyCollection.requiresIContext=true;d.getAPDialogDisplayFormat.requiresIContext=true;d.operators.requiresIContext=true;d.formatValueWithoutUnit.requiresIContext=true;return d;},true);
