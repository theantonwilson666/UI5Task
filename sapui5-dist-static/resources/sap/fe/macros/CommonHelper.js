/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/fe/macros/ResourceModel","sap/ui/model/odata/v4/AnnotationHelper","sap/base/Log","sap/fe/core/CommonUtils","sap/fe/navigation/SelectionVariant","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/ModelHelper","sap/ui/model/Context","sap/ui/Device","sap/base/strings/formatMessage","sap/fe/core/library"],function(R,O,L,C,S,a,M,b,D,f,c){"use strict";var H={getPathToKey:function(o){return o.getObject();},isVisible:function(t,i){var m=i.context.getModel(),p=i.context.getPath(),A=m.getObject(p+"@"),h=A["@com.sap.vocabularies.UI.v1.Hidden"];return typeof h==="object"?"{= !${"+h.$Path+"} }":!h;},fireButtonPress:function(B){return C.fireButtonPress(B);},isDialog:function(A,i){var m=i.context.getModel(),p=i.context.getPath(),d=m.getObject(p+"/@$ui5.overload@com.sap.vocabularies.Common.v1.IsActionCritical");if(d){return"Dialog";}else if(A){var o=Array.isArray(A)?A[0]:A;if(o.$Parameter&&o.$Parameter.length>1){return"Dialog";}else{return"None";}}},getParameterEditMode:function(t,i){var m=i.context.getModel(),p=i.context.getPath(),A=m.getObject(p+"@"),d=A["@com.sap.vocabularies.Common.v1.FieldControl"],e=A["@Org.OData.Core.V1.Immutable"],g=A["@Org.OData.Core.V1.Computed"];if(d&&d.$Path){if(d.$Path==="ReadOnly"){return sap.ui.mdc.enum.EditMode.ReadOnly;}else{return("{= %{"+d.$Path+"} ? "+"'"+sap.ui.mdc.enum.EditMode.ReadOnly+"'"+" : "+"'"+sap.ui.mdc.enum.EditMode.Editable+"'"+" }");}}if(d&&d.$EnumMember){if(d.$EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){return sap.ui.mdc.enum.EditMode.ReadOnly;}}if(e||g){return sap.ui.mdc.enum.EditMode.ReadOnly;}return sap.ui.mdc.enum.EditMode.Editable;},getMetaPath:function(t,i){return(i&&i.context&&i.context.getPath())||undefined;},isDesktop:function(){return D.system.desktop===true;},getTargetCollection:function(o,n){var p=o.getPath(),P,e,d;if(o.getMetadata().getName()==="sap.ui.model.Context"&&o.getObject("$kind")==="EntitySet"){return p;}if(o.getModel){p=(o.getModel().getMetaPath&&o.getModel().getMetaPath(p))||o.getModel().getMetaModel().getMetaPath(p);}P=p.split("/").filter(function(s){return s&&s!="$Type";});e="/"+P[0];if(P.length===1){return e;}d=n===undefined?P.slice(1).join("/$NavigationPropertyBinding/"):n;return e+"/$NavigationPropertyBinding/"+d;},isPropertyFilterable:function(p,i,d){var m=i.context.getModel(),P=i.context.getPath(),e=H.getEntitySetForPropertyPath(m,P),s=P.replace(e+"/","");if(d&&(d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")){return false;}return C.isPropertyFilterable(m,e,s);},formatDraftLockText:function(I,d,e){if(!I){return R.getText("M_COMMON_DRAFT_OBJECT");}else if(d){if(e){return R.getText("M_COMMON_DRAFT_LOCKED_OBJECT");}else{return R.getText("draft.UNSAVED_CHANGES");}}else{return"";}},getEntitySetForPropertyPath:function(m,p){var l;var e=p.slice(0,p.indexOf("/",1));if(m.getObject(e+"/$kind")==="EntityContainer"){l=e.length+1;e=p.slice(l,p.indexOf("/",l));}return e;},_resolveValueHelpField:function(o){var v=o.getModel();var V=v.getObject("/");return V.$model.getMetaModel().createBindingContext("/"+V.CollectionPath+"/"+o.getObject());},getBoolAnnotationValue:function(A){var v=A||false;v=v===true||(v&&v["Bool"]!=="false");return v;},gotoTargetEntitySet:function(o){var p=H.getTargetCollection.call(H,o);return p+"/$";},gotoActionParameter:function(o){var p=o.getPath(),P=o.getObject(p+"/$Name");var s;if(p.indexOf("@$ui5.overload")>-1){s=p.split("@$ui5.overload")[0];}else{var A=p.split("/0/")[0].split(".");s="/"+A[A.length-1]+"/";}return s+P;},getLabel:function(m,p){p=p||"";return(m.getProperty(p+"@@sap.ui.model.odata.v4.AnnotationHelper.label")||m.getProperty(p+"@com.sap.vocabularies.Common.v1.Label")||m.getProperty(p+"/@com.sap.vocabularies.Common.v1.Label")||m.getProperty(p+"@sapui.name"));},getEntitySetName:function(m,e){var E=m.getObject("/");for(var k in E){if(typeof E[k]==="object"&&E[k].$Type===e){return k;}}},getActionPath:function(A,r,s,d){var e=A.getPath().split("/@")[0];s=!s?A.getObject(A.getPath()):s;if(s&&s.indexOf("(")>-1){s=s.split("(")[0];e=e.substr(1);}else{e=A.getObject(e).$Type;e=this.getEntitySetName(A.getModel(),e);}if(d){return A.getObject("/"+e+"/"+s+"@Org.OData.Core.V1.OperationAvailable");}if(r){return"/"+e+"/"+s;}else{return{sEntityName:e,sProperty:A.getObject("/"+e+"/"+s+"@Org.OData.Core.V1.OperationAvailable/$Path"),sBindingParameter:A.getObject("/"+e+"/"+s+"/@$ui5.overload/0/$Parameter/0/$Name")};}},getEditMode:function(A,d,F,e,s,u,E,p){if(e==="Display"||e==="ReadOnly"||e==="Disabled"){return e;}var g,i,h,j,k,l,m,n,o,I,q,r=E&&E.$Key.indexOf(p)>-1;if(d==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||(A&&A["@com.sap.vocabularies.Common.v1.SemanticObject"]&&!(A["@com.sap.vocabularies.Common.v1.ValueListReferences"]||A["@com.sap.vocabularies.Common.v1.ValueListMapping"]||A["@com.sap.vocabularies.Common.v1.ValueList"]||A["@com.sap.vocabularies.Common.v1.ValueListWithFixedValues"]))){return"Display";}if(A&&A["@Org.OData.Core.V1.Computed"]){g=A["@Org.OData.Core.V1.Computed"].Bool?A["@Org.OData.Core.V1.Computed"].Bool=="true":true;}if(A&&A["@Org.OData.Core.V1.Immutable"]){i=A["@Org.OData.Core.V1.Immutable"].Bool?A["@Org.OData.Core.V1.Immutable"].Bool=="true":true;}if(r&&!g&&i){return"{= %{@$ui5.context.isTransient} === true ? 'Editable' : 'Display'}";}k=g||i||r;if(s&&s.indexOf("{")===0){s="$"+s;}o=typeof g==="undefined"?typeof i==="undefined":!g;if(F){if(F.indexOf("{")===0){I="$"+F+" === '1'";q="$"+F+" === '0'";}else{k=k||F=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly";}}var t;var v;var w;var x;if(I){x=e==="Editable"?"'ReadOnly'":"$"+e+" === 'Editable' ? 'ReadOnly'  : 'Display'";if(o){v=e==="Editable"?s+" ? 'Editable' : 'ReadOnly'":"$"+e+" === 'Editable' ? "+s+"? 'Editable' : 'ReadOnly'  : 'Display'";w=e==="Editable"?"'Disabled'":"$"+e+" === 'Editable' ? 'Disabled' : 'Display'";}else{v=e==="Editable"?"'ReadOnly'":"$"+e+" === 'Editable' ? 'ReadOnly' : 'Display'";w=e==="Editable"?"'Disabled'":"$"+e+" === 'Editable' ? 'Disabled' : 'Display'";}}else{v="'Display'";w="'Display'";x="'Display'";}l=e&&e.indexOf("{")===0?"$"+e:"'"+e+"'";if(k){if(!o){if(e&&e.indexOf("{")===0){return"{= "+v+"}";}v=v.split("'")&&v.split("'")[1];return v;}else{if(I){if(s&&s.indexOf("$")===0){return("{= "+s+" ? ("+q+"? "+"'Disabled'"+" : "+I+"? "+"'ReadOnly'"+" : "+l+") : "+v+"}");}else if(s=="true"){return("{= "+q+"? "+"'Disabled'"+" : "+I+"? "+"'ReadOnly'"+" : "+"${ui>/editMode} === 'Editable'"+"}");}else{return"{= "+v+"}";}}else if(F=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){l="'ReadOnly'";}if(s&&s.indexOf("$")===0){return"{= "+s+" ?"+"${ui>/editMode} === 'Editable'"+" : "+v+"}";}else if(s=="true"){return"{= "+l+"}";}else{return"{= "+v+"}";}}}if(I){if(u&&u.indexOf("{")===0){l="$"+u+" === '1' ? 'EditableReadOnly' : "+l;}else if(u==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){l="EditableReadOnly";}h=q+" ? "+w+" :"+I+" ? "+x+" :"+l;t="{= "+h+"}";}else if(u&&(u.indexOf("{")===0||u==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly")){m=u.indexOf("{")===0?"$"+u+" === '1'":undefined;n=e==="Editable"?"'EditableReadOnly'":"$"+e+" === 'Editable' ? 'EditableReadOnly' : 'Display'";if(m){h=m+" ? "+n+" :"+l;}else{h=n;}t="{= "+h+"}";}else{h=l;t=e;}var y;if(s&&s.indexOf("$")===0){y="{= "+s+" ? "+v+" : "+h+"}";}else if(s=="true"){y="{= "+v+"}";}else{y="{= "+h+"}";}j=o?t:y;return j;},getNavigationContext:function(o){return O.getNavigationPath(o.getPath());},getNavigationPath:function(p,k){var s=p.startsWith("/");var P=p.split("/").filter(function(d){return!!d;});if(s){P.shift();}if(!k){P.pop();}return P.join("/");},getHiddenPathExpression:function(d,o){var e=o.context,p=e.getPath(),E=O.getNavigationPath(p),h=[],s,P;if(e.getObject(p+"@com.sap.vocabularies.UI.v1.Hidden")){h.push(e.getObject(p+"@com.sap.vocabularies.UI.v1.Hidden"));}if(p.lastIndexOf("/")===p.length-1){P="Value/$Path@com.sap.vocabularies.UI.v1.Hidden";}else{P="/Value/$Path@com.sap.vocabularies.UI.v1.Hidden";}if(e.getObject(p+P)){h.push(e.getObject(p+P));}if(h.length){var g=[];for(var i=0;i<h.length;i++){s=h[i];if(s.$Path){if(s.$Path.indexOf("/")>0){var n=s.$Path.split("/")[0];if(e.getObject(E+"/"+n)&&!e.getObject(E+"/"+n).$isCollection){g.push("%{"+s.$Path+"}");}else{g.push(false);}}else{g.push("%{"+s.$Path+"}");}}else{g.push(s);}}if(g.length===1){return"{= "+g[0]+" === true ? false : true }";}else{return"{= ("+g[0]+" === true || "+g[1]+" === true ) ? false : true }";}}return true;},getActionContext:function(A){return H.getActionPath(A,true);},getPathToBoundActionOverload:function(A){var p=H.getActionPath(A,true);return p+"/@$ui5.overload/0";},addSingleQuotes:function(v){return"'"+v+"'";},generateFunction:function(F){var p="";for(var i=1;i<arguments.length;i++){p+=arguments[i];if(i<arguments.length-1){p+=", ";}}var s=F+"()";if(p){s=F+"("+p+")";}return s;},getHeaderDataPointLinkVisibility:function(p,l,F){var v;if(F){v=l?"{= ${internal>isHeaderDPLinkVisible/"+p+"} === true && "+F+"}":"{= ${internal>isHeaderDPLinkVisible/"+p+"} !== true && "+F+"}";}else{v=l?"{= ${internal>isHeaderDPLinkVisible/"+p+"} === true}":"{= ${internal>isHeaderDPLinkVisible/"+p+"} !== true}";}return v;},objectToString:function(p){var n=Object.keys(p).length,P="";for(var k in p){var v=p[k];if(v&&typeof v==="object"){v=this.objectToString(v);}P+=k+": "+v;if(n>1){--n;P+=", ";}}var o="{ "+P+"}";return o;},removeEscapeCharacters:function(e){return e?e.replace(/\\?\\([{}])/g,"$1"):undefined;},getStashed:function(v,F,o){if(o&&o.Facet&&o.Facet.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet"&&F&&F.Facet&&F.Facet.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"){return false;}var d=v.controlConfiguration,s=F.Facet.id?F.Facet.id.substring(F.Facet.id.lastIndexOf("::")+2):a.generate([F]),e=d&&d["@com.sap.vocabularies.UI.v1.HeaderFacets"]&&d["@com.sap.vocabularies.UI.v1.HeaderFacets"]["facets"]&&d["@com.sap.vocabularies.UI.v1.HeaderFacets"]["facets"][s]&&d["@com.sap.vocabularies.UI.v1.HeaderFacets"]["facets"][s]["stashed"];return e===true;},stringifyObject:function(s){if(!s){return undefined;}else{var o=JSON.parse(s);if(typeof o==="object"&&!Array.isArray(o)){var u={ui5object:true};Object.assign(u,o);return JSON.stringify(u);}else{var t=Array.isArray(o)?"Array":typeof o;L.error("Unexpected object type in stringifyObject ("+t+") - only works with object");throw new Error("stringifyObject only works with objects!");}}},stringifyCustomData:function(d){var o={ui5object:true};o["customData"]=d instanceof b?d.getObject():d;return JSON.stringify(o);},parseCustomData:function(d){var d=typeof d==="string"?JSON.parse(d):d;if("customData"in d){return d["customData"];}return d;},_getDraftAdministrativeDataType:function(m,e){return m.requestObject("/"+e+"/DraftAdministrativeData/");},getPopoverText:function(i,e){return H._getDraftAdministrativeDataType(i.getModel(),e).then(function(d){var B="{parts: [{path: 'HasDraftEntity', targetType: 'any'}, "+"{path: 'DraftAdministrativeData/InProcessByUser'}, "+"{path: 'DraftAdministrativeData/LastChangedByUser'} ";if(d.InProcessByUserDescription){B+=" ,{path: 'DraftAdministrativeData/InProcessByUserDescription'}";}if(d.LastChangedByUserDescription){B+=", {path: 'DraftAdministrativeData/LastChangedByUserDescription'}";}B+="], formatter: 'sap.fe.macros.field.FieldRuntime.formatDraftOwnerTextInPopover'}";return B;});},getContextPath:function(v,i){return i&&i.context&&i.context.getPath();},getSortConditions:function(p,P){if(p&&this._isPresentationVariantAnnotation(P)&&p.SortOrder){var s={sorters:[]};p.SortOrder.forEach(function(o){var d={};d.name=o.Property.$PropertyPath;d.descending=!!o.Descending;s.sorters.push(d);});return JSON.stringify(s);}return undefined;},_isPresentationVariantAnnotation:function(A){return(A.indexOf("@com.sap.vocabularies.UI.v1.PresentationVariant")>-1||A.indexOf("@com.sap.vocabularies.UI.v1.SelectionPresentationVariant")>-1);},createPresentationPathContext:function(p){var P=p.sPath.split("@")||[];var m=p.getModel();if(P.length&&P[P.length-1].indexOf("com.sap.vocabularies.UI.v1.SelectionPresentationVariant")>-1){var s=p.sPath.split("/PresentationVariant")[0];return m.createBindingContext(s+"@sapui.name");}return m.createBindingContext(p.sPath+"@sapui.name");},getPressHandlerForDataFieldForIBN:function(d,s,n){var N={navigationContexts:s?s:"${$source>/}.getBindingContext()"};if(d.RequiresContext&&!d.Inline&&n){N.applicableContexts="${internal>ibn/"+d.SemanticObject+"-"+d.Action+"/aApplicable/}";N.notApplicableContexts="${internal>ibn/"+d.SemanticObject+"-"+d.Action+"/aNotApplicable/}";N.label="'"+d.Label+"'";}if(d.Mapping){N.semanticObjectMapping=this.addSingleQuotes(JSON.stringify(d.Mapping));}return this.generateFunction(n?"._intentBasedNavigation.navigateWithConfirmationDialog":"._intentBasedNavigation.navigate",this.addSingleQuotes(d.SemanticObject),this.addSingleQuotes(d.Action),this.objectToString(N));},getEntitySet:function(o){var p=o.getPath();return M.getEntitySetPath(p);},_isRatingIndicator:function(o){if(o.isA("sap.fe.core.controls.FieldWrapper")){var v=Array.isArray(o.getContentDisplay())?o.getContentDisplay()[0]:o.getContentDisplay();if(v&&v.isA("sap.m.RatingIndicator")){return true;}}return false;},_updateStyleClassForRatingIndicator:function(F,l){var v=Array.isArray(F.getContentDisplay())?F.getContentDisplay()[0]:F.getContentDisplay();var d=Array.isArray(F.getContentEdit())?F.getContentEdit()[0]:F.getContentEdit();if(l){v.addStyleClass("sapUiNoMarginBottom");v.addStyleClass("sapUiNoMarginTop");d.removeStyleClass("sapUiTinyMarginBottom");}else{v.addStyleClass("sapUiNoMarginBottom");v.removeStyleClass("sapUiNoMarginTop");d.addStyleClass("sapUiTinyMarginBottom");}},handleEnablementOfMenuActions:function(e){var p="";if(Array.isArray(e)){p="{= ("+e[0]+")";for(var i=1;i<e.length;i++){p=p+" || ("+e[i]+")";}p=p+" }";return p;}return e;},handleVisibilityOfMenuActions:function(v){var p="";if(Array.isArray(v)){p="{= ("+v[0]+")";for(var i=1;i<v.length;i++){p=p+" || ("+v[i]+")";}p=p+" }";return p;}return v;}};H.isPropertyFilterable.requiresIContext=true;H.getPopoverText.requiresIContext=true;return H;},true);
