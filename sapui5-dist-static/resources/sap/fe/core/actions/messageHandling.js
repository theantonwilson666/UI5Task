/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2020 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/m/MessageToast","sap/m/MessageItem","sap/m/MessageView","sap/m/Button","sap/m/Dialog","sap/ui/core/library","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/message/Message","sap/ui/core/IconPool"],function(M,a,b,B,D,C,F,c,d,I){"use strict";var e=C.MessageType;var t=this;function f(){var p;function i(P){return P.property?"( ${"+P.property+'} ? ("<p>'+P.property.substr(Math.max(P.property.lastIndexOf("/"),P.property.lastIndexOf("."))+1)+' : " + '+"${"+P.property+'} + "</p>") : "" )':"";}function q(P){var H="";if(P.groupName&&P.property&&P.groupName!==p){H+="( ${"+P.property+'} ? "<br><h3>'+P.groupName+'</h3>" : "" ) + ';p=P.groupName;}return H;}function u(){var T="technicalDetails";return[{"groupName":"","property":T+"/status"},{"groupName":"","property":T+"/statusText"},{"groupName":"Application","property":T+"/error/@SAP__common.Application/ComponentId"},{"groupName":"Application","property":T+"/error/@SAP__common.Application/ServiceId"},{"groupName":"Application","property":T+"/error/@SAP__common.Application/ServiceRepository"},{"groupName":"Application","property":T+"/error/@SAP__common.Application/ServiceVersion"},{"groupName":"ErrorResolution","property":T+"/error/@SAP__common.ErrorResolution/Analysis"},{"groupName":"ErrorResolution","property":T+"/error/@SAP__common.ErrorResolution/Note"},{"groupName":"ErrorResolution","property":T+"/error/@SAP__common.ErrorResolution/DetailedNote"},{"groupName":"ErrorResolution","property":T+"/error/@SAP__common.ExceptionCategory"},{"groupName":"ErrorResolution","property":T+"/error/@SAP__common.TimeStamp"},{"groupName":"ErrorResolution","property":T+"/error/@SAP__common.TransactionId"},{"groupName":"Messages","property":T+"/error/code"},{"groupName":"Messages","property":T+"/error/message"}];}var H="Object.keys("+"${technicalDetails}"+').length > 0 ? "<h2>Technical Details</h2>" : "" ';u().forEach(function(P){H=H+q(P)+""+i(P)+" + ";});return H;}function g(){var H="(${"+'description} ? ("<h2>Description</h2>" + ${'+'description}) : "")';return H;}function G(p){var q=e.None,L=p.length,u={Error:0,Warning:0,Success:0,Information:0};for(var i=0;i<L;i++){++u[p[i].getType()];}if(u[e.Error]>0){q=e.Error;}else if(u[e.Warning]>0){q=e.Warning;}else if(u[e.Success]>0){q=e.Success;}else if(u[e.Information]>0){q=e.Information;}return q;}function m(p,R){var q=p.getMessageModel().getObject("/");var u=false;var E="";q.forEach(function(v,i){var T=v.getTechnicalDetails();if(T&&T.httpStatus===412){E=E||R.getText("C_APP_COMPONENT_SAPFE_ETAG_TECHNICAL_ISSUES");p.removeMessages(q[i]);v.setMessage(E);p.addMessages(v);u=true;}});return u;}function h(){t.oDialog.close();t.oBackButton.setVisible(false);r();}function s(p,q){var u=l(),v=sap.ui.getCore().getMessageManager(),H,w;if(u.length===0&&!p){return Promise.resolve(true);}else if(u.length===1&&u[0].getType()===e.Success&&!p){return new Promise(function(i,x){M.show(u[0].message);v.removeMessages(u);i();});}else{t.aResolveFunctions=t.aResolveFunctions||[];return new Promise(function(x,y){t.aResolveFunctions.push(x);sap.ui.getCore().getLibraryResourceBundle("sap.fe.core",true).then(function(R){t.oMessageTemplate=t.oMessageTemplate||new a({counter:"{counter}",title:"{message}",subtitle:"{additionalText}",longtextUrl:"{descriptionUrl}",type:"{type}",description:"{= ${"+"description} || ${technicalDetails} ? "+'"<html><body>" + '+g()+" + "+f()+'"</body></html>"'+' : "" }',markupDescription:true});t.oMessageView=t.oMessageView||new b({showDetailsPageHeader:false,itemSelect:function(){t.oBackButton.setVisible(true);},items:{path:"/",filters:[new F("target",c.EQ,""),new F("code",c.NE,undefined)],template:t.oMessageTemplate}});t.oBackButton=t.oBackButton||new B({icon:I.getIconURI("nav-back"),visible:false,press:function(){t.oMessageView.navigateBack();this.setVisible(false);}});if(p&&p.length){p.forEach(function(i){v.addMessages(new d({message:i.text,type:i.type,target:"",persistent:true,code:""}));});}t.oMessageView.setModel(v.getMessageModel());t.oDialog=t.oDialog||new D({resizable:true,content:t.oMessageView,endButton:new B({press:h,text:R.getText("C_COMMON_SAPFE_CLOSE")}),customHeader:new sap.m.Bar({contentMiddle:[new sap.m.Text({text:R.getText("C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE")})],contentLeft:[t.oBackButton]}),contentWidth:"37.5em",contentHeight:"21.5em",verticalScrolling:false,afterClose:function(E){for(var i=0;i<t.aResolveFunctions.length;i++){t.aResolveFunctions[i].call();}t.aResolveFunctions=[];}});var z=m(v,R);if(z){sap.ui.require(["sap/m/ButtonType"],function(i){t.oDialog.setBeginButton(new B({press:function(){h();if(q.hasPendingChanges()){q.getBinding().resetChanges();}q.refresh();},text:R.getText("C_COMMON_SAPFE_REFRESH"),type:i.Emphasized}));});}else{t.oDialog.destroyBeginButton();}H=G(t.oMessageView.getItems());w=j(H);t.oDialog.setState(H);t.oDialog.getCustomHeader().getContentMiddle()[0].setText(w);t.oMessageView.navigateBack();t.oDialog.open();}).catch(y);});}}function j(H){var R=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core");switch(H){case"Error":return R.getText("C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_TITLE_ERROR");case"Information":return R.getText("C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE_INFO");case"Success":return R.getText("C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE_SUCCESS");case"Warning":return R.getText("C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE_WARNING");default:return R.getText("C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE");}}function r(){n(false);}function k(){n(true);}function l(p,T){var q=sap.ui.getCore().getMessageManager(),u=q.getMessageModel(),v=u.getObject("/"),w=[];for(var i=0;i<v.length;i++){if((!T||v[i].persistent)&&((p&&v[i].target!=="")||v[i].target==="")&&v[i].code){w.push(v[i]);}}return w;}function n(i){var p=l(i,true);if(p.length>0){sap.ui.getCore().getMessageManager().removeMessages(p);}}var o={getMessages:l,showUnboundMessages:s,removeUnboundTransitionMessages:r,removeBoundTransitionMessages:k,modifyETagMessagesOnly:m};return o;});
