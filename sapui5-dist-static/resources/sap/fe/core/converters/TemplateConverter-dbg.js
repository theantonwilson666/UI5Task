sap.ui.define(["./templates/ListReportConverter", "./templates/ObjectPageConverter", "./MetaModelConverter", "./templates/BaseConverter", "sap/fe/core/converters/ConverterContext", "sap/fe/core/converters/helpers/IssueManager", "sap/base/util/merge"], function (ListReportConverter, ObjectPageConverter, MetaModelConverter, BaseConverter, ConverterContext, IssueManager, merge) {
  "use strict";

  var _exports = {};
  var IssueCategoryType = IssueManager.IssueCategoryType;
  var IssueSeverity = IssueManager.IssueSeverity;
  var IssueCategory = IssueManager.IssueCategory;
  var createConverterContext = ConverterContext.createConverterContext;
  var TemplateType = BaseConverter.TemplateType;
  var getInvolvedDataModelObjects = MetaModelConverter.getInvolvedDataModelObjects;
  var convertTypes = MetaModelConverter.convertTypes;

  function handleErrorForCollectionFacets(oFacets, oDiagnostics, sEntitySetName, level) {
    oFacets.forEach(function (oFacet) {
      var Message = "For entity set " + sEntitySetName;

      if ((oFacet === null || oFacet === void 0 ? void 0 : oFacet.$Type) === "com.sap.vocabularies.UI.v1.CollectionFacet" && !(oFacet === null || oFacet === void 0 ? void 0 : oFacet.ID)) {
        var _IssueCategoryType$Fa;

        Message = Message + ", " + "level " + level + ", the collection facet does not have an ID.";
        oDiagnostics.addIssue(IssueCategory.Facets, IssueSeverity.High, Message, IssueCategoryType, IssueCategoryType === null || IssueCategoryType === void 0 ? void 0 : (_IssueCategoryType$Fa = IssueCategoryType.Facets) === null || _IssueCategoryType$Fa === void 0 ? void 0 : _IssueCategoryType$Fa.MissingID);
      }

      if ((oFacet === null || oFacet === void 0 ? void 0 : oFacet.$Type) === "com.sap.vocabularies.UI.v1.CollectionFacet" && level >= 3) {
        var _IssueCategoryType$Fa2;

        Message = Message + ", collection facet " + oFacet.Label + " is not supported at " + "level " + level;
        oDiagnostics.addIssue(IssueCategory.Facets, IssueSeverity.Medium, Message, IssueCategoryType, IssueCategoryType === null || IssueCategoryType === void 0 ? void 0 : (_IssueCategoryType$Fa2 = IssueCategoryType.Facets) === null || _IssueCategoryType$Fa2 === void 0 ? void 0 : _IssueCategoryType$Fa2.UnSupportedLevel);
      }

      if (oFacet === null || oFacet === void 0 ? void 0 : oFacet.Facets) {
        handleErrorForCollectionFacets(oFacet === null || oFacet === void 0 ? void 0 : oFacet.Facets, oDiagnostics, sEntitySetName, ++level);
        level = level - 1;
      }
    });
  }
  /**
   * Based on a template type, convert the metamodel and manifest definition into a json structure for the page.
   * @param {TemplateType} sTemplateType the template type
   * @param {ODataMetaModel} oMetaModel the odata model metaModel
   * @param {BaseManifestSettings} oManifestSettings current manifest settings
   * @param {IShellServicesProxy} oShellServices the shellservice instance
   * @param {IDiagnostics} oDiagnostics the diagnostics wrapper
   * @param {string} sFullContextPath the context path to reach this page
   * @param oCapabilities
   * @returns {PageDefinition} the target page definition
   */


  function convertPage(sTemplateType, oMetaModel, oManifestSettings, oShellServices, oDiagnostics, sFullContextPath, oCapabilities) {
    var _oConverterOutput$ent;

    var oConverterOutput = convertTypes(oMetaModel, oCapabilities);
    oConverterOutput.diagnostics.forEach(function (annotationErrorDetail) {
      var checkIfIssueExists = oDiagnostics.checkIfIssueExists(IssueCategory.Annotation, IssueSeverity.High, annotationErrorDetail.message);

      if (!checkIfIssueExists) {
        oDiagnostics.addIssue(IssueCategory.Annotation, IssueSeverity.High, annotationErrorDetail.message);
      }
    });
    oConverterOutput === null || oConverterOutput === void 0 ? void 0 : (_oConverterOutput$ent = oConverterOutput.entityTypes) === null || _oConverterOutput$ent === void 0 ? void 0 : _oConverterOutput$ent.forEach(function (oEntitySet) {
      var _oEntitySet$annotatio, _oEntitySet$annotatio2;

      if (oEntitySet === null || oEntitySet === void 0 ? void 0 : (_oEntitySet$annotatio = oEntitySet.annotations) === null || _oEntitySet$annotatio === void 0 ? void 0 : (_oEntitySet$annotatio2 = _oEntitySet$annotatio.UI) === null || _oEntitySet$annotatio2 === void 0 ? void 0 : _oEntitySet$annotatio2.Facets) {
        var _oEntitySet$annotatio3, _oEntitySet$annotatio4;

        handleErrorForCollectionFacets(oEntitySet === null || oEntitySet === void 0 ? void 0 : (_oEntitySet$annotatio3 = oEntitySet.annotations) === null || _oEntitySet$annotatio3 === void 0 ? void 0 : (_oEntitySet$annotatio4 = _oEntitySet$annotatio3.UI) === null || _oEntitySet$annotatio4 === void 0 ? void 0 : _oEntitySet$annotatio4.Facets, oDiagnostics, oEntitySet === null || oEntitySet === void 0 ? void 0 : oEntitySet.name, 1);
      }
    });
    var sTargetEntitySetName = oManifestSettings.entitySet;
    var oFullContext = getInvolvedDataModelObjects(oMetaModel.createBindingContext(sFullContextPath === "/" ? sFullContextPath + sTargetEntitySetName : sFullContextPath));

    if (oFullContext) {
      var oConvertedPage = {};

      switch (sTemplateType) {
        case TemplateType.ListReport:
        case TemplateType.AnalyticalListPage:
          oConvertedPage = ListReportConverter.convertPage(createConverterContext(oConverterOutput, oManifestSettings, sTemplateType, oShellServices, oDiagnostics, merge, oFullContext));
          break;

        case TemplateType.ObjectPage:
          oConvertedPage = ObjectPageConverter.convertPage(createConverterContext(oConverterOutput, oManifestSettings, sTemplateType, oShellServices, oDiagnostics, merge, oFullContext));
          break;
      }

      return oConvertedPage;
    }

    return undefined;
  }

  _exports.convertPage = convertPage;
  return _exports;
}, false);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRlbXBsYXRlQ29udmVydGVyLnRzIl0sIm5hbWVzIjpbImhhbmRsZUVycm9yRm9yQ29sbGVjdGlvbkZhY2V0cyIsIm9GYWNldHMiLCJvRGlhZ25vc3RpY3MiLCJzRW50aXR5U2V0TmFtZSIsImxldmVsIiwiZm9yRWFjaCIsIm9GYWNldCIsIk1lc3NhZ2UiLCIkVHlwZSIsIklEIiwiYWRkSXNzdWUiLCJJc3N1ZUNhdGVnb3J5IiwiRmFjZXRzIiwiSXNzdWVTZXZlcml0eSIsIkhpZ2giLCJJc3N1ZUNhdGVnb3J5VHlwZSIsIk1pc3NpbmdJRCIsIkxhYmVsIiwiTWVkaXVtIiwiVW5TdXBwb3J0ZWRMZXZlbCIsImNvbnZlcnRQYWdlIiwic1RlbXBsYXRlVHlwZSIsIm9NZXRhTW9kZWwiLCJvTWFuaWZlc3RTZXR0aW5ncyIsIm9TaGVsbFNlcnZpY2VzIiwic0Z1bGxDb250ZXh0UGF0aCIsIm9DYXBhYmlsaXRpZXMiLCJvQ29udmVydGVyT3V0cHV0IiwiY29udmVydFR5cGVzIiwiZGlhZ25vc3RpY3MiLCJhbm5vdGF0aW9uRXJyb3JEZXRhaWwiLCJjaGVja0lmSXNzdWVFeGlzdHMiLCJBbm5vdGF0aW9uIiwibWVzc2FnZSIsImVudGl0eVR5cGVzIiwib0VudGl0eVNldCIsImFubm90YXRpb25zIiwiVUkiLCJuYW1lIiwic1RhcmdldEVudGl0eVNldE5hbWUiLCJlbnRpdHlTZXQiLCJvRnVsbENvbnRleHQiLCJnZXRJbnZvbHZlZERhdGFNb2RlbE9iamVjdHMiLCJjcmVhdGVCaW5kaW5nQ29udGV4dCIsIm9Db252ZXJ0ZWRQYWdlIiwiVGVtcGxhdGVUeXBlIiwiTGlzdFJlcG9ydCIsIkFuYWx5dGljYWxMaXN0UGFnZSIsIkxpc3RSZXBvcnRDb252ZXJ0ZXIiLCJjcmVhdGVDb252ZXJ0ZXJDb250ZXh0IiwibWVyZ2UiLCJPYmplY3RQYWdlIiwiT2JqZWN0UGFnZUNvbnZlcnRlciIsInVuZGVmaW5lZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBc0NBLFdBQVNBLDhCQUFULENBQXdDQyxPQUF4QyxFQUErREMsWUFBL0QsRUFBMkZDLGNBQTNGLEVBQW1IQyxLQUFuSCxFQUFrSTtBQUNqSUgsSUFBQUEsT0FBTyxDQUFDSSxPQUFSLENBQWdCLFVBQUNDLE1BQUQsRUFBaUI7QUFDaEMsVUFBSUMsT0FBTyxHQUFHLG9CQUFvQkosY0FBbEM7O0FBQ0EsVUFBSSxDQUFBRyxNQUFNLFNBQU4sSUFBQUEsTUFBTSxXQUFOLFlBQUFBLE1BQU0sQ0FBRUUsS0FBUixzREFBdUQsRUFBQ0YsTUFBRCxhQUFDQSxNQUFELHVCQUFDQSxNQUFNLENBQUVHLEVBQVQsQ0FBM0QsRUFBd0U7QUFBQTs7QUFDdkVGLFFBQUFBLE9BQU8sR0FBR0EsT0FBTyxHQUFHLElBQVYsR0FBaUIsUUFBakIsR0FBNEJILEtBQTVCLEdBQW9DLDZDQUE5QztBQUNBRixRQUFBQSxZQUFZLENBQUNRLFFBQWIsQ0FDQ0MsYUFBYSxDQUFDQyxNQURmLEVBRUNDLGFBQWEsQ0FBQ0MsSUFGZixFQUdDUCxPQUhELEVBSUNRLGlCQUpELEVBS0NBLGlCQUxELGFBS0NBLGlCQUxELGdEQUtDQSxpQkFBaUIsQ0FBRUgsTUFMcEIsMERBS0Msc0JBQTJCSSxTQUw1QjtBQU9BOztBQUNELFVBQUksQ0FBQVYsTUFBTSxTQUFOLElBQUFBLE1BQU0sV0FBTixZQUFBQSxNQUFNLENBQUVFLEtBQVIsc0RBQXVESixLQUFLLElBQUksQ0FBcEUsRUFBdUU7QUFBQTs7QUFDdEVHLFFBQUFBLE9BQU8sR0FBR0EsT0FBTyxHQUFHLHFCQUFWLEdBQWtDRCxNQUFNLENBQUNXLEtBQXpDLEdBQWlELHVCQUFqRCxHQUEyRSxRQUEzRSxHQUFzRmIsS0FBaEc7QUFDQUYsUUFBQUEsWUFBWSxDQUFDUSxRQUFiLENBQ0NDLGFBQWEsQ0FBQ0MsTUFEZixFQUVDQyxhQUFhLENBQUNLLE1BRmYsRUFHQ1gsT0FIRCxFQUlDUSxpQkFKRCxFQUtDQSxpQkFMRCxhQUtDQSxpQkFMRCxpREFLQ0EsaUJBQWlCLENBQUVILE1BTHBCLDJEQUtDLHVCQUEyQk8sZ0JBTDVCO0FBT0E7O0FBQ0QsVUFBSWIsTUFBSixhQUFJQSxNQUFKLHVCQUFJQSxNQUFNLENBQUVNLE1BQVosRUFBb0I7QUFDbkJaLFFBQUFBLDhCQUE4QixDQUFDTSxNQUFELGFBQUNBLE1BQUQsdUJBQUNBLE1BQU0sQ0FBRU0sTUFBVCxFQUFpQlYsWUFBakIsRUFBK0JDLGNBQS9CLEVBQStDLEVBQUVDLEtBQWpELENBQTlCO0FBQ0FBLFFBQUFBLEtBQUssR0FBR0EsS0FBSyxHQUFHLENBQWhCO0FBQ0E7QUFDRCxLQTFCRDtBQTJCQTtBQUVEOzs7Ozs7Ozs7Ozs7O0FBV08sV0FBU2dCLFdBQVQsQ0FDTkMsYUFETSxFQUVOQyxVQUZNLEVBR05DLGlCQUhNLEVBSU5DLGNBSk0sRUFLTnRCLFlBTE0sRUFNTnVCLGdCQU5NLEVBT05DLGFBUE0sRUFRTDtBQUFBOztBQUNELFFBQU1DLGdCQUFnQixHQUFHQyxZQUFZLENBQUNOLFVBQUQsRUFBYUksYUFBYixDQUFyQztBQUNBQyxJQUFBQSxnQkFBZ0IsQ0FBQ0UsV0FBakIsQ0FBNkJ4QixPQUE3QixDQUFxQyxVQUFBeUIscUJBQXFCLEVBQUk7QUFDN0QsVUFBTUMsa0JBQWtCLEdBQUc3QixZQUFZLENBQUM2QixrQkFBYixDQUMxQnBCLGFBQWEsQ0FBQ3FCLFVBRFksRUFFMUJuQixhQUFhLENBQUNDLElBRlksRUFHMUJnQixxQkFBcUIsQ0FBQ0csT0FISSxDQUEzQjs7QUFLQSxVQUFJLENBQUNGLGtCQUFMLEVBQXlCO0FBQ3hCN0IsUUFBQUEsWUFBWSxDQUFDUSxRQUFiLENBQXNCQyxhQUFhLENBQUNxQixVQUFwQyxFQUFnRG5CLGFBQWEsQ0FBQ0MsSUFBOUQsRUFBb0VnQixxQkFBcUIsQ0FBQ0csT0FBMUY7QUFDQTtBQUNELEtBVEQ7QUFVQU4sSUFBQUEsZ0JBQWdCLFNBQWhCLElBQUFBLGdCQUFnQixXQUFoQixxQ0FBQUEsZ0JBQWdCLENBQUVPLFdBQWxCLGdGQUErQjdCLE9BQS9CLENBQXVDLFVBQUM4QixVQUFELEVBQXFCO0FBQUE7O0FBQzNELFVBQUlBLFVBQUosYUFBSUEsVUFBSixnREFBSUEsVUFBVSxDQUFFQyxXQUFoQixvRkFBSSxzQkFBeUJDLEVBQTdCLDJEQUFJLHVCQUE2QnpCLE1BQWpDLEVBQXlDO0FBQUE7O0FBQ3hDWixRQUFBQSw4QkFBOEIsQ0FBQ21DLFVBQUQsYUFBQ0EsVUFBRCxpREFBQ0EsVUFBVSxDQUFFQyxXQUFiLHFGQUFDLHVCQUF5QkMsRUFBMUIsMkRBQUMsdUJBQTZCekIsTUFBOUIsRUFBc0NWLFlBQXRDLEVBQW9EaUMsVUFBcEQsYUFBb0RBLFVBQXBELHVCQUFvREEsVUFBVSxDQUFFRyxJQUFoRSxFQUFzRSxDQUF0RSxDQUE5QjtBQUNBO0FBQ0QsS0FKRDtBQUtBLFFBQU1DLG9CQUFvQixHQUFHaEIsaUJBQWlCLENBQUNpQixTQUEvQztBQUNBLFFBQU1DLFlBQVksR0FBR0MsMkJBQTJCLENBQy9DcEIsVUFBVSxDQUFDcUIsb0JBQVgsQ0FBZ0NsQixnQkFBZ0IsS0FBSyxHQUFyQixHQUEyQkEsZ0JBQWdCLEdBQUdjLG9CQUE5QyxHQUFxRWQsZ0JBQXJHLENBRCtDLENBQWhEOztBQUlBLFFBQUlnQixZQUFKLEVBQWtCO0FBQ2pCLFVBQUlHLGNBQWMsR0FBRyxFQUFyQjs7QUFDQSxjQUFRdkIsYUFBUjtBQUNDLGFBQUt3QixZQUFZLENBQUNDLFVBQWxCO0FBQ0EsYUFBS0QsWUFBWSxDQUFDRSxrQkFBbEI7QUFDQ0gsVUFBQUEsY0FBYyxHQUFHSSxtQkFBbUIsQ0FBQzVCLFdBQXBCLENBQ2hCNkIsc0JBQXNCLENBQ3JCdEIsZ0JBRHFCLEVBRXJCSixpQkFGcUIsRUFHckJGLGFBSHFCLEVBSXJCRyxjQUpxQixFQUtyQnRCLFlBTHFCLEVBTXJCZ0QsS0FOcUIsRUFPckJULFlBUHFCLENBRE4sQ0FBakI7QUFXQTs7QUFDRCxhQUFLSSxZQUFZLENBQUNNLFVBQWxCO0FBQ0NQLFVBQUFBLGNBQWMsR0FBR1EsbUJBQW1CLENBQUNoQyxXQUFwQixDQUNoQjZCLHNCQUFzQixDQUNyQnRCLGdCQURxQixFQUVyQkosaUJBRnFCLEVBR3JCRixhQUhxQixFQUlyQkcsY0FKcUIsRUFLckJ0QixZQUxxQixFQU1yQmdELEtBTnFCLEVBT3JCVCxZQVBxQixDQUROLENBQWpCO0FBV0E7QUEzQkY7O0FBNkJBLGFBQU9HLGNBQVA7QUFDQTs7QUFDRCxXQUFPUyxTQUFQO0FBQ0EiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJhc2VNYW5pZmVzdFNldHRpbmdzIH0gZnJvbSBcIi4vTWFuaWZlc3RTZXR0aW5nc1wiO1xuaW1wb3J0ICogYXMgTGlzdFJlcG9ydENvbnZlcnRlciBmcm9tIFwiLi90ZW1wbGF0ZXMvTGlzdFJlcG9ydENvbnZlcnRlclwiO1xuaW1wb3J0ICogYXMgT2JqZWN0UGFnZUNvbnZlcnRlciBmcm9tIFwiLi90ZW1wbGF0ZXMvT2JqZWN0UGFnZUNvbnZlcnRlclwiO1xuaW1wb3J0IHsgY29udmVydFR5cGVzLCBnZXRJbnZvbHZlZERhdGFNb2RlbE9iamVjdHMsIEVudmlyb25tZW50Q2FwYWJpbGl0aWVzIH0gZnJvbSBcIi4vTWV0YU1vZGVsQ29udmVydGVyXCI7XG5pbXBvcnQgeyBPRGF0YU1ldGFNb2RlbCB9IGZyb20gXCJzYXAvdWkvbW9kZWwvb2RhdGEvdjRcIjtcbmltcG9ydCB7IElTaGVsbFNlcnZpY2VzUHJveHksIFRlbXBsYXRlVHlwZSB9IGZyb20gXCIuL3RlbXBsYXRlcy9CYXNlQ29udmVydGVyXCI7XG5pbXBvcnQgeyBjcmVhdGVDb252ZXJ0ZXJDb250ZXh0IH0gZnJvbSBcInNhcC9mZS9jb3JlL2NvbnZlcnRlcnMvQ29udmVydGVyQ29udGV4dFwiO1xuaW1wb3J0IHsgSXNzdWVDYXRlZ29yeSwgSXNzdWVTZXZlcml0eSwgSXNzdWVDYXRlZ29yeVR5cGUgfSBmcm9tIFwic2FwL2ZlL2NvcmUvY29udmVydGVycy9oZWxwZXJzL0lzc3VlTWFuYWdlclwiO1xuXG5pbXBvcnQgeyBtZXJnZSB9IGZyb20gXCJzYXAvYmFzZS91dGlsXCI7XG5pbXBvcnQgeyBGYWNldFR5cGVzLCBVSUFubm90YXRpb25UeXBlcyB9IGZyb20gXCJAc2FwLXV4L3ZvY2FidWxhcmllcy10eXBlc1wiO1xuXG4vKipcbiAqIEB0eXBlZGVmIFBhZ2VEZWZpbml0aW9uXG4gKi9cbmV4cG9ydCB0eXBlIFBhZ2VEZWZpbml0aW9uID0ge1xuXHR0ZW1wbGF0ZTogc3RyaW5nO1xufTtcblxuLyoqIEB0eXBlZGVmIElEaWFnbm9zdGljcyAqKi9cbmV4cG9ydCBpbnRlcmZhY2UgSURpYWdub3N0aWNzIHtcblx0YWRkSXNzdWUoXG5cdFx0aXNzdWVDYXRlZ29yeTogSXNzdWVDYXRlZ29yeSB8IHN0cmluZyxcblx0XHRpc3N1ZVNldmVyaXR5OiBJc3N1ZVNldmVyaXR5LFxuXHRcdGRldGFpbHM6IHN0cmluZyxcblx0XHRpc3N1ZUNhdGVnb3J5VHlwZT86IGFueSxcblx0XHRpc3N1ZVN1YkNhdGVnb3J5Pzogc3RyaW5nXG5cdCk6IHZvaWQ7XG5cdGdldElzc3VlcygpOiBhbnlbXTtcblx0Y2hlY2tJZklzc3VlRXhpc3RzKFxuXHRcdGlzc3VlQ2F0ZWdvcnk6IElzc3VlQ2F0ZWdvcnksXG5cdFx0aXNzdWVTZXZlcml0eTogSXNzdWVTZXZlcml0eSxcblx0XHRkZXRhaWxzOiBzdHJpbmcsXG5cdFx0aXNzdWVDYXRlZ29yeVR5cGU/OiBhbnksXG5cdFx0aXNzdWVTdWJDYXRlZ29yeT86IHN0cmluZ1xuXHQpOiBib29sZWFuO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVFcnJvckZvckNvbGxlY3Rpb25GYWNldHMob0ZhY2V0czogRmFjZXRUeXBlc1tdLCBvRGlhZ25vc3RpY3M6IElEaWFnbm9zdGljcywgc0VudGl0eVNldE5hbWU6IHN0cmluZywgbGV2ZWw6IG51bWJlcikge1xuXHRvRmFjZXRzLmZvckVhY2goKG9GYWNldDogYW55KSA9PiB7XG5cdFx0bGV0IE1lc3NhZ2UgPSBcIkZvciBlbnRpdHkgc2V0IFwiICsgc0VudGl0eVNldE5hbWU7XG5cdFx0aWYgKG9GYWNldD8uJFR5cGUgPT09IFVJQW5ub3RhdGlvblR5cGVzLkNvbGxlY3Rpb25GYWNldCAmJiAhb0ZhY2V0Py5JRCkge1xuXHRcdFx0TWVzc2FnZSA9IE1lc3NhZ2UgKyBcIiwgXCIgKyBcImxldmVsIFwiICsgbGV2ZWwgKyBcIiwgdGhlIGNvbGxlY3Rpb24gZmFjZXQgZG9lcyBub3QgaGF2ZSBhbiBJRC5cIjtcblx0XHRcdG9EaWFnbm9zdGljcy5hZGRJc3N1ZShcblx0XHRcdFx0SXNzdWVDYXRlZ29yeS5GYWNldHMsXG5cdFx0XHRcdElzc3VlU2V2ZXJpdHkuSGlnaCxcblx0XHRcdFx0TWVzc2FnZSxcblx0XHRcdFx0SXNzdWVDYXRlZ29yeVR5cGUsXG5cdFx0XHRcdElzc3VlQ2F0ZWdvcnlUeXBlPy5GYWNldHM/Lk1pc3NpbmdJRFxuXHRcdFx0KTtcblx0XHR9XG5cdFx0aWYgKG9GYWNldD8uJFR5cGUgPT09IFVJQW5ub3RhdGlvblR5cGVzLkNvbGxlY3Rpb25GYWNldCAmJiBsZXZlbCA+PSAzKSB7XG5cdFx0XHRNZXNzYWdlID0gTWVzc2FnZSArIFwiLCBjb2xsZWN0aW9uIGZhY2V0IFwiICsgb0ZhY2V0LkxhYmVsICsgXCIgaXMgbm90IHN1cHBvcnRlZCBhdCBcIiArIFwibGV2ZWwgXCIgKyBsZXZlbDtcblx0XHRcdG9EaWFnbm9zdGljcy5hZGRJc3N1ZShcblx0XHRcdFx0SXNzdWVDYXRlZ29yeS5GYWNldHMsXG5cdFx0XHRcdElzc3VlU2V2ZXJpdHkuTWVkaXVtLFxuXHRcdFx0XHRNZXNzYWdlLFxuXHRcdFx0XHRJc3N1ZUNhdGVnb3J5VHlwZSxcblx0XHRcdFx0SXNzdWVDYXRlZ29yeVR5cGU/LkZhY2V0cz8uVW5TdXBwb3J0ZWRMZXZlbFxuXHRcdFx0KTtcblx0XHR9XG5cdFx0aWYgKG9GYWNldD8uRmFjZXRzKSB7XG5cdFx0XHRoYW5kbGVFcnJvckZvckNvbGxlY3Rpb25GYWNldHMob0ZhY2V0Py5GYWNldHMsIG9EaWFnbm9zdGljcywgc0VudGl0eVNldE5hbWUsICsrbGV2ZWwpO1xuXHRcdFx0bGV2ZWwgPSBsZXZlbCAtIDE7XG5cdFx0fVxuXHR9KTtcbn1cblxuLyoqXG4gKiBCYXNlZCBvbiBhIHRlbXBsYXRlIHR5cGUsIGNvbnZlcnQgdGhlIG1ldGFtb2RlbCBhbmQgbWFuaWZlc3QgZGVmaW5pdGlvbiBpbnRvIGEganNvbiBzdHJ1Y3R1cmUgZm9yIHRoZSBwYWdlLlxuICogQHBhcmFtIHtUZW1wbGF0ZVR5cGV9IHNUZW1wbGF0ZVR5cGUgdGhlIHRlbXBsYXRlIHR5cGVcbiAqIEBwYXJhbSB7T0RhdGFNZXRhTW9kZWx9IG9NZXRhTW9kZWwgdGhlIG9kYXRhIG1vZGVsIG1ldGFNb2RlbFxuICogQHBhcmFtIHtCYXNlTWFuaWZlc3RTZXR0aW5nc30gb01hbmlmZXN0U2V0dGluZ3MgY3VycmVudCBtYW5pZmVzdCBzZXR0aW5nc1xuICogQHBhcmFtIHtJU2hlbGxTZXJ2aWNlc1Byb3h5fSBvU2hlbGxTZXJ2aWNlcyB0aGUgc2hlbGxzZXJ2aWNlIGluc3RhbmNlXG4gKiBAcGFyYW0ge0lEaWFnbm9zdGljc30gb0RpYWdub3N0aWNzIHRoZSBkaWFnbm9zdGljcyB3cmFwcGVyXG4gKiBAcGFyYW0ge3N0cmluZ30gc0Z1bGxDb250ZXh0UGF0aCB0aGUgY29udGV4dCBwYXRoIHRvIHJlYWNoIHRoaXMgcGFnZVxuICogQHBhcmFtIG9DYXBhYmlsaXRpZXNcbiAqIEByZXR1cm5zIHtQYWdlRGVmaW5pdGlvbn0gdGhlIHRhcmdldCBwYWdlIGRlZmluaXRpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbnZlcnRQYWdlKFxuXHRzVGVtcGxhdGVUeXBlOiBUZW1wbGF0ZVR5cGUsXG5cdG9NZXRhTW9kZWw6IE9EYXRhTWV0YU1vZGVsLFxuXHRvTWFuaWZlc3RTZXR0aW5nczogQmFzZU1hbmlmZXN0U2V0dGluZ3MsXG5cdG9TaGVsbFNlcnZpY2VzOiBJU2hlbGxTZXJ2aWNlc1Byb3h5LFxuXHRvRGlhZ25vc3RpY3M6IElEaWFnbm9zdGljcyxcblx0c0Z1bGxDb250ZXh0UGF0aDogc3RyaW5nLFxuXHRvQ2FwYWJpbGl0aWVzPzogRW52aXJvbm1lbnRDYXBhYmlsaXRpZXNcbikge1xuXHRjb25zdCBvQ29udmVydGVyT3V0cHV0ID0gY29udmVydFR5cGVzKG9NZXRhTW9kZWwsIG9DYXBhYmlsaXRpZXMpO1xuXHRvQ29udmVydGVyT3V0cHV0LmRpYWdub3N0aWNzLmZvckVhY2goYW5ub3RhdGlvbkVycm9yRGV0YWlsID0+IHtcblx0XHRjb25zdCBjaGVja0lmSXNzdWVFeGlzdHMgPSBvRGlhZ25vc3RpY3MuY2hlY2tJZklzc3VlRXhpc3RzKFxuXHRcdFx0SXNzdWVDYXRlZ29yeS5Bbm5vdGF0aW9uLFxuXHRcdFx0SXNzdWVTZXZlcml0eS5IaWdoLFxuXHRcdFx0YW5ub3RhdGlvbkVycm9yRGV0YWlsLm1lc3NhZ2Vcblx0XHQpO1xuXHRcdGlmICghY2hlY2tJZklzc3VlRXhpc3RzKSB7XG5cdFx0XHRvRGlhZ25vc3RpY3MuYWRkSXNzdWUoSXNzdWVDYXRlZ29yeS5Bbm5vdGF0aW9uLCBJc3N1ZVNldmVyaXR5LkhpZ2gsIGFubm90YXRpb25FcnJvckRldGFpbC5tZXNzYWdlKTtcblx0XHR9XG5cdH0pO1xuXHRvQ29udmVydGVyT3V0cHV0Py5lbnRpdHlUeXBlcz8uZm9yRWFjaCgob0VudGl0eVNldDogYW55KSA9PiB7XG5cdFx0aWYgKG9FbnRpdHlTZXQ/LmFubm90YXRpb25zPy5VST8uRmFjZXRzKSB7XG5cdFx0XHRoYW5kbGVFcnJvckZvckNvbGxlY3Rpb25GYWNldHMob0VudGl0eVNldD8uYW5ub3RhdGlvbnM/LlVJPy5GYWNldHMsIG9EaWFnbm9zdGljcywgb0VudGl0eVNldD8ubmFtZSwgMSk7XG5cdFx0fVxuXHR9KTtcblx0Y29uc3Qgc1RhcmdldEVudGl0eVNldE5hbWUgPSBvTWFuaWZlc3RTZXR0aW5ncy5lbnRpdHlTZXQ7XG5cdGNvbnN0IG9GdWxsQ29udGV4dCA9IGdldEludm9sdmVkRGF0YU1vZGVsT2JqZWN0cyhcblx0XHRvTWV0YU1vZGVsLmNyZWF0ZUJpbmRpbmdDb250ZXh0KHNGdWxsQ29udGV4dFBhdGggPT09IFwiL1wiID8gc0Z1bGxDb250ZXh0UGF0aCArIHNUYXJnZXRFbnRpdHlTZXROYW1lIDogc0Z1bGxDb250ZXh0UGF0aClcblx0KTtcblxuXHRpZiAob0Z1bGxDb250ZXh0KSB7XG5cdFx0bGV0IG9Db252ZXJ0ZWRQYWdlID0ge307XG5cdFx0c3dpdGNoIChzVGVtcGxhdGVUeXBlKSB7XG5cdFx0XHRjYXNlIFRlbXBsYXRlVHlwZS5MaXN0UmVwb3J0OlxuXHRcdFx0Y2FzZSBUZW1wbGF0ZVR5cGUuQW5hbHl0aWNhbExpc3RQYWdlOlxuXHRcdFx0XHRvQ29udmVydGVkUGFnZSA9IExpc3RSZXBvcnRDb252ZXJ0ZXIuY29udmVydFBhZ2UoXG5cdFx0XHRcdFx0Y3JlYXRlQ29udmVydGVyQ29udGV4dChcblx0XHRcdFx0XHRcdG9Db252ZXJ0ZXJPdXRwdXQsXG5cdFx0XHRcdFx0XHRvTWFuaWZlc3RTZXR0aW5ncyxcblx0XHRcdFx0XHRcdHNUZW1wbGF0ZVR5cGUsXG5cdFx0XHRcdFx0XHRvU2hlbGxTZXJ2aWNlcyxcblx0XHRcdFx0XHRcdG9EaWFnbm9zdGljcyxcblx0XHRcdFx0XHRcdG1lcmdlLFxuXHRcdFx0XHRcdFx0b0Z1bGxDb250ZXh0XG5cdFx0XHRcdFx0KVxuXHRcdFx0XHQpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgVGVtcGxhdGVUeXBlLk9iamVjdFBhZ2U6XG5cdFx0XHRcdG9Db252ZXJ0ZWRQYWdlID0gT2JqZWN0UGFnZUNvbnZlcnRlci5jb252ZXJ0UGFnZShcblx0XHRcdFx0XHRjcmVhdGVDb252ZXJ0ZXJDb250ZXh0KFxuXHRcdFx0XHRcdFx0b0NvbnZlcnRlck91dHB1dCxcblx0XHRcdFx0XHRcdG9NYW5pZmVzdFNldHRpbmdzLFxuXHRcdFx0XHRcdFx0c1RlbXBsYXRlVHlwZSxcblx0XHRcdFx0XHRcdG9TaGVsbFNlcnZpY2VzLFxuXHRcdFx0XHRcdFx0b0RpYWdub3N0aWNzLFxuXHRcdFx0XHRcdFx0bWVyZ2UsXG5cdFx0XHRcdFx0XHRvRnVsbENvbnRleHRcblx0XHRcdFx0XHQpXG5cdFx0XHRcdCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0XHRyZXR1cm4gb0NvbnZlcnRlZFBhZ2U7XG5cdH1cblx0cmV0dXJuIHVuZGVmaW5lZDtcbn1cbiJdfQ==