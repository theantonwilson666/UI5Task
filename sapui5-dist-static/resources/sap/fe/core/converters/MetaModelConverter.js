sap.ui.define(["sap/fe/core/converters/common/AnnotationConverter"],function(A){"use strict";var _={};function c(o,a,v){if(a in o){Object.defineProperty(o,a,{value:v,enumerable:true,configurable:true,writable:true});}else{o[a]=v;}return o;}function d(a,i){return j(a)||h(a,i)||f(a,i)||e();}function e(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function f(o,a){if(!o)return;if(typeof o==="string")return g(o,a);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(o,a);}function g(a,b){if(b==null||b>a.length)b=a.length;for(var i=0,n=new Array(b);i<b;i++){n[i]=a[i];}return n;}function h(a,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(a)))return;var b=[];var n=true;var o=false;var s=undefined;try{for(var t=a[Symbol.iterator](),u;!(n=(u=t.next()).done);n=true){b.push(u.value);if(i&&b.length===i)break;}}catch(v){o=true;s=v;}finally{try{if(!n&&t["return"]!=null)t["return"]();}finally{if(o)throw s;}}return b;}function j(a){if(Array.isArray(a))return a;}var V={"Org.OData.Capabilities.V1":"Capabilities","Org.OData.Core.V1":"Core","Org.OData.Measures.V1":"Measures","com.sap.vocabularies.Common.v1":"Common","com.sap.vocabularies.UI.v1":"UI","com.sap.vocabularies.Session.v1":"Session","com.sap.vocabularies.Analytics.v1":"Analytics","com.sap.vocabularies.PersonalData.v1":"PersonalData","com.sap.vocabularies.Communication.v1":"Communication"};var D={Chart:true,MicroChart:true,UShell:true,IntentBasedNavigation:true};_.DefaultEnvironmentCapabilities=D;var M={parsePropertyValue:function(a,b,i,n,C){var o=this;var v;var s=i+"/"+b;if(a===null){v={type:"Null",Null:null};}else if(typeof a==="string"){v={type:"String",String:a};}else if(typeof a==="boolean"){v={type:"Bool",Bool:a};}else if(typeof a==="number"){v={type:"Int",Int:a};}else if(Array.isArray(a)){v={type:"Collection",Collection:a.map(function(t,u){return o.parseAnnotationObject(t,s+"/"+u,n,C);})};if(a.length>0){if(a[0].hasOwnProperty("$PropertyPath")){v.Collection.type="PropertyPath";}else if(a[0].hasOwnProperty("$Path")){v.Collection.type="Path";}else if(a[0].hasOwnProperty("$NavigationPropertyPath")){v.Collection.type="NavigationPropertyPath";}else if(a[0].hasOwnProperty("$AnnotationPath")){v.Collection.type="AnnotationPath";}else if(a[0].hasOwnProperty("$Type")){v.Collection.type="Record";}else if(a[0].hasOwnProperty("$If")){v.Collection.type="If";}else if(a[0].hasOwnProperty("$Apply")){v.Collection.type="Apply";}else if(typeof a[0]==="object"){v.Collection.type="Record";}else{v.Collection.type="String";}}}else if(a.$Path!==undefined){v={type:"Path",Path:a.$Path};}else if(a.$Decimal!==undefined){v={type:"Decimal",Decimal:parseFloat(a.$Decimal)};}else if(a.$PropertyPath!==undefined){v={type:"PropertyPath",PropertyPath:a.$PropertyPath};}else if(a.$NavigationPropertyPath!==undefined){v={type:"NavigationPropertyPath",NavigationPropertyPath:a.$NavigationPropertyPath};}else if(a.$If!==undefined){v={type:"If",If:a.$If};}else if(a.$Apply!==undefined){v={type:"Apply",Apply:a.$Apply,Function:a.$Function};}else if(a.$AnnotationPath!==undefined){v={type:"AnnotationPath",AnnotationPath:a.$AnnotationPath};}else if(a.$EnumMember!==undefined){v={type:"EnumMember",EnumMember:this.mapNameToAlias(a.$EnumMember.split("/")[0])+"/"+a.$EnumMember.split("/")[1]};}else if(a.$Type){v={type:"Record",Record:this.parseAnnotationObject(a,i,n,C)};}else{v={type:"Record",Record:this.parseAnnotationObject(a,i,n,C)};}return{name:b,value:v};},mapNameToAlias:function(a){var b=a.split("@"),i=d(b,2),n=i[0],o=i[1];if(!o){o=n;n="";}else{n+="@";}var s=o.lastIndexOf(".");return n+V[o.substr(0,s)]+"."+o.substr(s+1);},parseAnnotationObject:function(a,b,i,C){var n=this;var o={};if(a===null){o={type:"Null",Null:null};}else if(typeof a==="string"){o={type:"String",String:a};}else if(typeof a==="boolean"){o={type:"Bool",Bool:a};}else if(typeof a==="number"){o={type:"Int",Int:a};}else if(a.$AnnotationPath!==undefined){o={type:"AnnotationPath",AnnotationPath:a.$AnnotationPath};}else if(a.$Path!==undefined){o={type:"Path",Path:a.$Path};}else if(a.$Decimal!==undefined){o={type:"Decimal",Decimal:parseFloat(a.$Decimal)};}else if(a.$PropertyPath!==undefined){o={type:"PropertyPath",PropertyPath:a.$PropertyPath};}else if(a.$If!==undefined){o={type:"If",If:a.$If};}else if(a.$Apply!==undefined){o={type:"Apply",Apply:a.$Apply,Function:a.$Function};}else if(a.$NavigationPropertyPath!==undefined){o={type:"NavigationPropertyPath",NavigationPropertyPath:a.$NavigationPropertyPath};}else if(a.$EnumMember!==undefined){o={type:"EnumMember",EnumMember:this.mapNameToAlias(a.$EnumMember.split("/")[0])+"/"+a.$EnumMember.split("/")[1]};}else if(Array.isArray(a)){var s=o;s.collection=a.map(function(v,w){return n.parseAnnotationObject(v,b+"/"+w,i,C);});if(a.length>0){if(a[0].hasOwnProperty("$PropertyPath")){s.collection.type="PropertyPath";}else if(a[0].hasOwnProperty("$Path")){s.collection.type="Path";}else if(a[0].hasOwnProperty("$NavigationPropertyPath")){s.collection.type="NavigationPropertyPath";}else if(a[0].hasOwnProperty("$AnnotationPath")){s.collection.type="AnnotationPath";}else if(a[0].hasOwnProperty("$Type")){s.collection.type="Record";}else if(a[0].hasOwnProperty("$If")){s.collection.type="If";}else if(a[0].hasOwnProperty("$Apply")){s.collection.type="Apply";}else if(typeof a[0]==="object"){s.collection.type="Record";}else{s.collection.type="String";}}}else{if(a.$Type){var t=a.$Type;o.type=t;}var u=[];Object.keys(a).forEach(function(v){if(v!=="$Type"&&v!=="$If"&&v!=="$Apply"&&v!=="$Eq"&&!v.startsWith("@")){u.push(n.parsePropertyValue(a[v],v,b,i,C));}else if(v.startsWith("@")){n.createAnnotationLists(c({},v,a[v]),b,i,C);}});o.propertyValues=u;}return o;},getOrCreateAnnotationList:function(t,a){var b=a.find(function(i){return i.target===t;});if(!b){b={target:t,annotations:[]};a.push(b);}return b;},createAnnotationLists:function(a,b,i,C){var n=this;var o=this.getOrCreateAnnotationList(b,i);if(!C.MicroChart){delete a["@com.sap.vocabularies.UI.v1.Chart"];}function s(v){return v.filter(function(R){if(R.Target&&R.Target.$AnnotationPath){return R.Target.$AnnotationPath.indexOf("@com.sap.vocabularies.UI.v1.Chart")===-1;}else{return true;}});}function t(v){return v.filter(function(R){return R.$Type!=="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation";});}function u(v){return v.filter(function(R){return R.$AnnotationPath!=="@com.sap.vocabularies.UI.v1.Chart";});}Object.keys(a).forEach(function(v){var w=a[v];switch(v){case"@com.sap.vocabularies.UI.v1.HeaderFacets":if(!C.MicroChart){w=s(w);}break;case"@com.sap.vocabularies.UI.v1.Identification":if(!C.IntentBasedNavigation){w=t(w);}break;case"@com.sap.vocabularies.UI.v1.LineItem":if(!C.IntentBasedNavigation){w=t(w);}if(!C.MicroChart){w=s(w);}break;case"@com.sap.vocabularies.UI.v1.FieldGroup":if(!C.IntentBasedNavigation){w.Data=t(w.Data);}if(!C.MicroChart){w.Data=s(w.Data);}break;case"@com.sap.vocabularies.UI.v1.PresentationVariant":if(!C.Chart&&w.Visualizations){w.Visualizations=u(w.Visualizations);}break;default:break;}a[v]=w;var x=o;var y=v.split("@");if(y.length>2){x=n.getOrCreateAnnotationList(b+"@"+y[1],i);v=y[2];}else{v=y[1];}var z=v.split("#");var B=z[1];v=z[0];var E={term:"".concat(v),qualifier:B};var F=b+"@"+E.term;if(B){F+="#"+B;}var G=false;if(w===null){E.value={type:"Bool",Bool:w};}else if(typeof w==="string"){E.value={type:"String",String:w};}else if(typeof w==="boolean"){E.value={type:"Bool",Bool:w};}else if(typeof w==="number"){E.value={type:"Int",Int:w};}else if(w.$If!==undefined){E.value={type:"If",If:w.$If};}else if(w.$Apply!==undefined){E.value={type:"Apply",Apply:w.$Apply,Function:w.$Function};}else if(w.$Path!==undefined){E.value={type:"Path",Path:w.$Path};}else if(w.$AnnotationPath!==undefined){E.value={type:"AnnotationPath",AnnotationPath:w.$AnnotationPath};}else if(w.$Decimal!==undefined){E.value={type:"Decimal",Decimal:parseFloat(w.$Decimal)};}else if(w.$EnumMember!==undefined){E.value={type:"EnumMember",EnumMember:n.mapNameToAlias(w.$EnumMember.split("/")[0])+"/"+w.$EnumMember.split("/")[1]};}else if(Array.isArray(w)){G=true;E.collection=w.map(function(K,L){return n.parseAnnotationObject(K,F+"/"+L,i,C);});if(w.length>0){if(w[0].hasOwnProperty("$PropertyPath")){E.collection.type="PropertyPath";}else if(w[0].hasOwnProperty("$Path")){E.collection.type="Path";}else if(w[0].hasOwnProperty("$NavigationPropertyPath")){E.collection.type="NavigationPropertyPath";}else if(w[0].hasOwnProperty("$AnnotationPath")){E.collection.type="AnnotationPath";}else if(w[0].hasOwnProperty("$Type")){E.collection.type="Record";}else if(w[0].hasOwnProperty("$If")){E.collection.type="If";}else if(w[0].hasOwnProperty("$Apply")){E.collection.type="Apply";}else if(typeof w[0]==="object"){E.collection.type="Record";}else{E.collection.type="String";}}}else{var H={propertyValues:[]};if(w.$Type){var I=w.$Type;H.type="".concat(I);}var J=[];Object.keys(w).forEach(function(K){if(K!=="$Type"&&!K.startsWith("@")){J.push(n.parsePropertyValue(w[K],K,F,i,C));}else if(K.startsWith("@")){n.createAnnotationLists(c({},K,w[K]),F,i,C);}});H.propertyValues=J;E.record=H;}E.isCollection=G;x.annotations.push(E);});},parseProperty:function(o,a,b,i,C){var n=o.getObject("/".concat(a.fullyQualifiedName,"/").concat(b,"@"));var s=o.getObject("/".concat(a.fullyQualifiedName,"/").concat(b));var t={_type:"Property",name:b,fullyQualifiedName:"".concat(a.fullyQualifiedName,"/").concat(b),type:s.$Type,maxLength:s.$MaxLength,precision:s.$Precision,scale:s.$Scale,nullable:s.$Nullable};this.createAnnotationLists(n,t.fullyQualifiedName,i,C);return t;},parseNavigationProperty:function(o,a,n,b,C){var i=o.getObject("/".concat(a.fullyQualifiedName,"/").concat(n,"@"));var s=o.getObject("/".concat(a.fullyQualifiedName,"/").concat(n));var t=[];if(s.$ReferentialConstraint){t=Object.keys(s.$ReferentialConstraint).map(function(v){return{sourceTypeName:a.name,sourceProperty:v,targetTypeName:s.$Type,targetProperty:s.$ReferentialConstraint[v]};});}var u={_type:"NavigationProperty",name:n,fullyQualifiedName:"".concat(a.fullyQualifiedName,"/").concat(n),partner:s.$Partner,isCollection:s.$isCollection?s.$isCollection:false,containsTarget:s.$ContainsTarget,targetTypeName:s.$Type,referentialConstraint:t};this.createAnnotationLists(i,u.fullyQualifiedName,b,C);return u;},parseEntitySet:function(o,a,b,i,C){var n=o.getObject("/".concat(a));var s=o.getObject("/".concat(a,"@"));var t={_type:"EntitySet",name:a,navigationPropertyBinding:{},entityTypeName:n.$Type,fullyQualifiedName:"".concat(i,"/").concat(a)};this.createAnnotationLists(s,t.fullyQualifiedName,b,C);return t;},parseEntityType:function(o,a,b,n,C){var i=this;var s=o.getObject("/".concat(a,"@"));var t=o.getObject("/".concat(a));var u=v(t);function v(t){if(!t.$Key&&t.$BaseType){return v(o.getObject("/".concat(t.$BaseType)));}return t.$Key||[];}var w={_type:"EntityType",name:a.replace(n+".",""),fullyQualifiedName:a,keys:[],entityProperties:[],navigationProperties:[]};this.createAnnotationLists(s,w.fullyQualifiedName,b,C);var x=Object.keys(t).filter(function(z){if(z!="$Key"&&z!="$kind"){return t[z].$kind==="Property";}}).map(function(z){return i.parseProperty(o,w,z,b,C);});var y=Object.keys(t).filter(function(z){if(z!="$Key"&&z!="$kind"){return t[z].$kind==="NavigationProperty";}}).map(function(z){return i.parseNavigationProperty(o,w,z,b,C);});w.keys=u.map(function(z){return x.find(function(B){return B.name===z;});}).filter(function(z){return z!==undefined;});w.entityProperties=x;w.navigationProperties=y;return w;},parseComplexType:function(o,a,b,n,C){var i=this;var s=o.getObject("/".concat(a,"@"));var t=o.getObject("/".concat(a));var u={_type:"ComplexType",name:a.replace(n+".",""),fullyQualifiedName:a,properties:[],navigationProperties:[]};this.createAnnotationLists(s,u.fullyQualifiedName,b,C);var v=Object.keys(t).filter(function(x){if(x!="$Key"&&x!="$kind"){return t[x].$kind==="Property";}}).map(function(x){return i.parseProperty(o,u,x,b,C);});u.properties=v;var w=Object.keys(t).filter(function(x){if(x!="$Key"&&x!="$kind"){return t[x].$kind==="NavigationProperty";}}).map(function(x){return i.parseNavigationProperty(o,u,x,b,C);});u.navigationProperties=w;return u;},parseAction:function(a,b,n,i){var o="";var s="".concat(a);var t=a.substr(n.length+1);if(b.$IsBound){var u=b.$Parameter[0];o=u.$Type;if(u.$isCollection===true){s="".concat(a,"(Collection(").concat(o,"))");}else{s="".concat(a,"(").concat(o,")");}}else{s="".concat(i,"/").concat(t);}var v=b.$Parameter||[];return{_type:"Action",name:t,fullyQualifiedName:s,isBound:b.$IsBound,sourceType:o,returnType:b.$ReturnType?b.$ReturnType.$Type:"",parameters:v.map(function(w){return{_type:"ActionParameter",isEntitySet:w.$Type===b.$EntitySetPath,fullyQualifiedName:"".concat(s,"/").concat(w.$Name),type:w.$Type};})};},parseEntityTypes:function(o,i){var n=this;var C;if(!i){C=D;}else{C=i;}var s=o.getObject("/$");var E=o.getObject("/");var t=[];var u=[];var v=[];var w=[];var x=s.$EntityContainer;var y="";var z=Object.keys(s).filter(function(a){return s[a].$kind==="Schema";});if(z&&z.length>0){y=z[0].substr(0,z[0].length-1);}else if(u&&u.length){y=u[0].fullyQualifiedName.replace(u[0].name,"");y=y.substr(0,y.length-1);}Object.keys(s).filter(function(a){return a!=="$kind"&&s[a].$kind==="EntityType";}).forEach(function(a){var b=n.parseEntityType(o,a,t,y,C);b.entityProperties.forEach(function(L){if(!s.$Annotations[L.fullyQualifiedName]){s.$Annotations[L.fullyQualifiedName]={};}if(!s.$Annotations[L.fullyQualifiedName]["@com.sap.vocabularies.UI.v1.DataFieldDefault"]){s.$Annotations[L.fullyQualifiedName]["@com.sap.vocabularies.UI.v1.DataFieldDefault"]={$Type:"com.sap.vocabularies.UI.v1.DataField",Value:{$Path:L.name}};n.createAnnotationLists({"@com.sap.vocabularies.UI.v1.DataFieldDefault":s.$Annotations[L.fullyQualifiedName]["@com.sap.vocabularies.UI.v1.DataFieldDefault"]},L.fullyQualifiedName,t,C);}});u.push(b);});Object.keys(E).filter(function(a){return a!=="$kind"&&E[a].$kind==="EntitySet";}).forEach(function(a){var b=n.parseEntitySet(o,a,t,x,C);v.push(b);});Object.keys(s).filter(function(a){return a!=="$kind"&&s[a].$kind==="ComplexType";}).forEach(function(a){var b=n.parseComplexType(o,a,t,y,C);w.push(b);});var B=Object.keys(s).find(function(x){return x!=="$kind"&&s[x].$kind==="EntityContainer";});var F={};if(B){F={name:B.replace(y+".",""),fullyQualifiedName:B};}v.forEach(function(a){var b=s[x][a.name].$NavigationPropertyBinding;if(b){Object.keys(b).forEach(function(L){var N=v.find(function(O){return O.name===b[L];});if(N){a.navigationPropertyBinding[L]=N;}});}});var G=Object.keys(s).filter(function(a){return Array.isArray(s[a])&&s[a].length>0&&s[a][0].$kind==="Action";}).reduce(function(a,b){var G=s[b];G.forEach(function(L){a.push(n.parseAction(b,L,y,x));});return a;},[]);var H=s.$Annotations;var I=Object.keys(H).filter(function(a){return a.indexOf("(")!==-1;});I.forEach(function(a){n.createAnnotationLists(s.$Annotations[a],a,t,C);});var J=H[x];if(J){this.createAnnotationLists(J,x,t,C);}t=t.sort(function(a,b){return a.target.length>=b.target.length?1:-1;});var K=[];return{identification:"metamodelResult",version:"4.0",schema:{entityContainer:F,entitySets:v,entityTypes:u,complexTypes:w,associations:[],actions:G,namespace:y,annotations:{"metamodelResult":t}},references:K};}};var m={};function k(o,C){var s=o.id;if(!m.hasOwnProperty(s)){var a=M.parseEntityTypes(o,C);m[s]=A.convertTypes(a);}return m[s];}_.convertTypes=k;function l(o){delete m[o.id];}_.deleteModelCacheData=l;function p(o){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var C=k(o.getModel());var P=o.getPath();var a=P.split("/");var t=C.entitySets.find(function(z){return z.name===a[1];});var b=a.slice(2).join("/");var n=[t];var s=function(){var v=b.split("/");var z=t.entityType.navigationProperties.find(function(B){return B.name===v[1];});if(z){n.push(z);}t=t.navigationPropertyBinding[v[1]];n.push(t);b=v.slice(2).join("/");};while(b&&b.length>0&&b.startsWith("$NavigationPropertyBinding")){s();}if(b.startsWith("$Type")){b=a.slice(3).join("/");}if(t&&b.length){var T=t.entityType.resolvePath(b,i);if(T){if(i){T.visitedObjects=n.concat(T.visitedObjects);}}else if(t.entityType&&t.entityType.actions){var u=t.entityType&&t.entityType.actions;var v=b.split("/");if(u[v[0]]){var w=u[v[0]];if(v[1]&&w.parameters){var x=v[1];var y=w.parameters.find(function(z){return z.fullyQualifiedName.endsWith("/"+x);});return y;}else if(b.length===1){return w;}}}return T;}else{if(i){return{target:t,visitedObjects:n};}return t;}}_.convertMetaModelContext=p;function q(o,E){var a=p(o,true);var t;if(E&&E.getPath()!=="/"){t=q(E);}return r(a,t);}_.getInvolvedDataModelObjects=q;function r(a,t){var b=a.visitedObjects.filter(function(B){return B&&B.hasOwnProperty("_type")&&B._type!=="EntityType";});if(a.target&&a.target.hasOwnProperty("_type")&&a.target._type!=="EntityType"){b.push(a.target);}var n=[];var o=b[0];var s=o;var u=o.entityType;var i=1;var v;var w=[];while(i<b.length){v=b[i++];if(v._type==="NavigationProperty"){w.push(v.name);n.push(v);u=v.targetType;if(s&&s.navigationPropertyBinding.hasOwnProperty(w.join("/"))){s=s.navigationPropertyBinding[v.name];w=[];}else{s=undefined;}}if(v._type==="EntitySet"){s=v;u=s.entityType;}}if(t&&t.startingEntitySet!==o){var x=b.indexOf(t.startingEntitySet);if(x!==-1){var y=b.slice(0,x);t.startingEntitySet=o;t.navigationProperties=y.filter(function(B){return B._type==="NavigationProperty";}).concat(t.navigationProperties);}}var z={startingEntitySet:o,targetEntitySet:s,targetEntityType:u,targetObject:a.target,navigationProperties:n,contextLocation:t};if(!z.contextLocation){z.contextLocation=z;}return z;}_.getInvolvedDataModelObjectFromPath=r;return _;},false);
