sap.ui.define(["sap/ui/base/Object","sap/fe/core/AnnotationHelper","sap/fe/core/actions/draft","sap/fe/core/actions/sticky","sap/fe/core/actions/operations","sap/ui/model/json/JSONModel","sap/fe/core/actions/messageHandling","sap/m/Popover","sap/m/VBox","sap/m/CheckBox","sap/m/Text","sap/m/Button","sap/m/MessageToast","sap/m/Dialog","sap/ui/model/BindingMode","sap/base/Log","sap/ui/core/message/Message","sap/fe/core/CommonUtils","sap/fe/core/BusyLocker","sap/fe/core/helpers/SideEffectsUtil","sap/ui/core/util/XMLPreprocessor","sap/ui/core/XMLTemplateProcessor","sap/ui/core/Fragment","sap/m/MessageBox","sap/fe/core/helpers/ModelHelper","sap/fe/core/library","sap/ui/core/ValueState"],function(B,A,d,s,o,J,m,P,V,C,T,a,M,D,b,L,c,e,f,S,X,g,F,h,j,k,l){"use strict";var n=k.CreationMode,p=k.ProgrammingModel;function q(i){if(i&&i.getMetadata&&i.getMetadata().getName()==="sap.ui.base.Event"){i={};}return i||{};}return B.extend("sap.fe.core.TransactionHelper",{constructor:function(i,r){this._oAppComponent=i;this.oLockObject=r;},getProgrammingModel:function(i){if(!this.sProgrammingModel&&i){if(j.isDraftSupported(i)){this.sProgrammingModel=p.Draft;}else if(j.isStickySessionSupported(i.getModel().getMetaModel())){this.sProgrammingModel=p.Sticky;}else{return p.NonDraft;}}return this.sProgrammingModel;},createDocument:function(i,r,R){var N,t=this,u,v=i.getModel(),w=v.getMetaModel(),x=w.getMetaPath(i.getHeaderContext().getPath()),y=!i.isRelative()&&(w.getObject(x+"@com.sap.vocabularies.Session.v1.StickySessionSupported/NewAction")||w.getObject(x+"@com.sap.vocabularies.Common.v1.DraftRoot/NewAction")),z,E={"$$patchWithoutSideEffects":true},G=w.getObject(x+"/@com.sap.vocabularies.Common.v1.Messages/$Path"),H,I="/busy";if(G){E["$select"]=G;}r=q(r);if(!i){return Promise.reject("Binding required for new document creation");}H=this.getProgrammingModel(i);if(H!==p.Draft&&H!==p.Sticky){return Promise.reject("Create document only allowed for draft or sticky session supported services");}if(r.busyMode==="Local"){I="/busyLocal/"+i.sId;}f.lock(this.oLockObject,I);u=!r.refreshList;var K=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core");if(y){z=this.callAction(y,{contexts:i.getHeaderContext(),showActionParameterDialog:true,label:K.getText("C_TRANSACTION_HELPER_SAPFE_ACTION_CREATE"),bindingParameters:E,parentControl:r.parentControl,bIsCreateAction:true});}else{var O=r.creationMode!==n.CreationRow&&r.creationMode!==n.Inline;var Q=O?e.getNonComputedVisibleFields(w,x):[];if(Q.length>0){var U=v.bindList(i.getPath(),i.getContext(),[],[],{$$updateGroupId:"submitLater",$$groupId:"submitLater"});U.refreshInternal=function(){};N=U.create(r.data,u);r.keepTransientContextOnFailed=true;z=this._launchDialogWithKeyFields(i,U,N,Q,v,r);z.catch(function(){L.trace("transient creation context deleted");});}else{N=i.create(r.data,u,r.createAtEnd);z=t.onAfterCreateCompletion(i,N,r,K);}}return z.then(function(W){if(!i.isRelative()){t._bCreateMode=true;}N=N||(W&&W.response);if(W&&W.bConsiderDocumentModified){t.handleDocumentModifications();}return m.showUnboundMessages().then(function(){return N;});}).catch(function(W){return m.showUnboundMessages().then(function(){if(W&&W.bDeleteTransientContext&&N.isTransient()){N.delete("$direct");}return Promise.reject(W);});}).finally(function(){f.unlock(t.oLockObject,I);});},findActiveDraftRootContexts:function(i,r){if(!r){return Promise.resolve();}var t=i.reduce(function(R,u){var v=u.getModel().getMetaModel();var w=v.getMetaPath(u.getPath());if(v.getObject(w+"@com.sap.vocabularies.Common.v1.DraftRoot")){var I=u.getObject().IsActiveEntity,H=u.getObject().HasActiveEntity,x;if(!I&&H){x=u.getModel().bindContext(u.getPath()+"/SiblingEntity").getBoundContext();R.push(x);}}return R;},[]);return Promise.all(t.map(function(u){return u.requestCanonicalPath().then(function(){return u;});}));},afterDeleteProcess:function(i,r,t,R){var I=i.internalModelContext;if(I&&I.getProperty("deleteEnabled")!=undefined){if(r.isCheckBoxVisible===true&&r.isCheckBoxSelected===false){I.setProperty("deleteEnabled",true);var u=Object.assign(I.getObject(),{});u.selectedContexts=u.selectedContexts.filter(function(v){return u.deletableContexts.indexOf(v)===-1;});u.deletableContexts=[];u.selectedContexts=[];u.numberOfSelectedContexts=u.selectedContexts.length;I.setProperty("",u);}else{I.setProperty("deleteEnabled",false);I.setProperty("selectedContexts",[]);I.setProperty("numberOfSelectedContexts",0);}}if(t.length===1){M.show(e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_DELETE_TOAST_SINGULAR",R,null,i.entitySetName));}else{M.show(e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_DELETE_TOAST_PLURAL",R,null,i.entitySetName));}},deleteDocument:function(v,r,R){var t,u,w=[],x=false,y=false,z=false,E,G=false,H=this,I=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core"),K,N={title:I.getText("C_COMMON_OBJECT_PAGE_DELETE")};f.lock(this.oLockObject);if(!Array.isArray(v)){v=[v];}Promise.resolve(this.getProgrammingModel(v[0])).then(function(O){if(r){if(!r.numberOfSelectedContexts){if(O===p.Draft){for(var i=0;i<v.length;i++){var Q=v[i].getObject();if(Q.IsActiveEntity===true&&Q.HasDraftEntity===true&&Q.DraftAdministrativeData&&Q.DraftAdministrativeData.InProcessByUser){h.show(I.getText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_SINGLE_OBJECT_LOCKED"),{title:I.getText("C_COMMON_OBJECT_PAGE_DELETE"),onClose:t});return;}}}r=q(r);if(r.title){if(r.description){K=[r.title,r.description];N.text=e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_OBJECTINFO",R,K,r.entitySetName);}else{N.text=e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_OBJECTTITLE_SINGULAR",R,null,r.entitySetName);}}else{N.text=e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_OBJECTTITLE_SINGULAR",R);}w=v;}else{N={title:I.getText("C_COMMON_OBJECT_PAGE_DELETE")};if(r.numberOfSelectedContexts===1&&r.numberOfSelectedContexts===v.length){w=v;N.text=e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_OBJECTTITLE_SINGULAR",R,null,r.entitySetName);}else if(r.numberOfSelectedContexts===1&&r.unSavedContexts.length===1){w=r.unSavedContexts;var U=w[0].getObject()["DraftAdministrativeData"]?w[0].getObject()["DraftAdministrativeData"]["LastChangedByUserDescription"]:"";K=[U];N.text=e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_UNSAVED_CHANGES",R,K);}else if(r.numberOfSelectedContexts===r.unSavedContexts.length){w=r.unSavedContexts;N.text=e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_UNSAVED_CHANGES_MULTIPLE_OBJECTS",R);}else if(r.numberOfSelectedContexts===v.concat(r.unSavedContexts.concat(r.lockedContexts)).length){w=v.concat(r.unSavedContexts);N.text=w.length===1?e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_OBJECTTITLE_SINGULAR",R,null,r.entitySetName):e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_OBJECTTITLE_PLURAL",R,null,r.entitySetName);}else{w=v.concat(r.unSavedContexts);z=true;N.text=w.length===1?e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_OBJECTTITLE_SINGULAR_NON_DELETABLE",R,null,r.entitySetName):e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_OBJECTTITLE_PLURAL_NON_DELETABLE",R,null,r.entitySetName);N.nonDeletableText=e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_OBJECTINFO_AND_FEW_OBJECTS_NON_DELETABLE",R,[r.numberOfSelectedContexts-v.concat(r.unSavedContexts).length,r.numberOfSelectedContexts]);}if(r.lockedContexts.length==1){y=true;N.nonDeletableText=e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_OBJECTINFO_AND_ONE_OBJECT_LOCKED",R,[r.numberOfSelectedContexts]);}if(r.lockedContexts.length>1){y=true;N.nonDeletableText=e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_OBJECTINFO_AND_FEW_OBJECTS_LOCKED",R,[r.lockedContexts.length,r.numberOfSelectedContexts]);}if(r.unSavedContexts.length>0&&r.unSavedContexts.length!==r.numberOfSelectedContexts){if((z||y)&&w.length===r.unSavedContexts.length){x=false;w=r.unSavedContexts;if(r.unSavedContexts.length===1){N.text=e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_UNSAVED_AND_FEW_OBJECTS_LOCKED_SINGULAR",R);}else{N.text=e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_UNSAVED_AND_FEW_OBJECTS_LOCKED_PLURAL",R);}}else{if(r.unSavedContexts.length===1){N.checkBoxText=e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_OBJECTINFO_AND_FEW_OBJECTS_UNSAVED_SINGULAR",R);}else{N.checkBoxText=e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_OBJECTINFO_AND_FEW_OBJECTS_UNSAVED_PLURAL",R);}x=true;}}if(z&&y){if(r.unSavedContexts.length>1){N.nonDeletableText=e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_OBJECTINFO_AND_FEW_OBJECTS_LOCKED_AND_NON_DELETABLE",R,[r.numberOfSelectedContexts-v.concat(r.unSavedContexts).length-r.lockedContexts.length,r.lockedContexts.length,r.numberOfSelectedContexts]);}if(r.unSavedContexts.length==1){N.nonDeletableText=e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_PAGE_CONFIRM_DELETE_WITH_OBJECTINFO_AND_ONE_OBJECT_LOCKED_AND_NON_DELETABLE",R,[r.numberOfSelectedContexts-v.concat(r.unSavedContexts).length-r.lockedContexts.length,r.numberOfSelectedContexts]);}}}}var W,Y,Z=new V({items:[(W=new T({text:N.nonDeletableText,visible:y||z})),(Y=new T({text:N.text})),new C({text:N.checkBoxText,selected:true,select:function(a1){var b1=a1.getSource().getSelected();if(b1){w=v.concat(r.unSavedContexts);E=true;}else{w=v;E=false;}},visible:x})]});var $=I.getText("C_COMMON_OBJECT_PAGE_DELETE");var _=new D({title:$,state:"Warning",content:[Z],ariaLabelledBy:W.getVisible()?[W,Y]:Y,beginButton:new a({text:I.getText("C_COMMON_OBJECT_PAGE_DELETE"),type:"Emphasized",press:function(){G=true;f.lock(H.oLockObject);var a1=w;_.close();return H.findActiveDraftRootContexts(a1,r.bFindActiveContexts).then(function(b1){return Promise.all(a1.map(function(c1){return d.deleteDraft(c1);})).catch(function(c1){return m.showUnboundMessages().then(function(){throw c1;});}).then(function(){var c1={"isCheckBoxVisible":x,"isCheckBoxSelected":E};if(b1&&b1.length){return Promise.all(b1.map(function(d1){return d1.delete();})).then(function(){H.afterDeleteProcess(r,c1,a1,R);return m.showUnboundMessages().then(u);});}else{H.afterDeleteProcess(r,c1,a1,R);return m.showUnboundMessages().then(u);}});}).catch(function(){t();}).finally(function(){f.unlock(H.oLockObject);});}}),endButton:new a({text:e.getTranslatedText("C_COMMON_OBJECT_PAGE_CANCEL",R),press:function(){_.close();}}),afterClose:function(){_.destroy();if(!G){t();}}});_.addStyleClass("sapUiContentPadding");_.open();}).finally(function(){f.unlock(H.oLockObject);}).catch(function(){L.warning("Couldn't get Programming model");t();});return new Promise(function(i,O){t=O;u=i;});},editDocument:function(i,r,v){var t=this,u=this.getProgrammingModel(i),E;if(!i){return Promise.reject(new Error("Binding context to active document is required"));}this._bIsModified=false;f.lock(t.oLockObject);m.removeBoundTransitionMessages();if(u===p.Draft){E=d.createDraftFromActiveDocument(i,{bPreserveChanges:true,bPrepareOnEdit:r,oView:v});}else if(u===p.Sticky){E=s.editDocumentInStickySession(i);}else{f.unlock(t.oLockObject);return Promise.reject(new Error("Edit is only allowed for draft or sticky session supported services"));}return E.then(function(N){t._bCreateMode=false;return m.showUnboundMessages().then(function(){return N;});}).catch(function(w){return m.showUnboundMessages().then(function(){return Promise.reject(w);});}).finally(function(){f.unlock(t.oLockObject);});},cancelDocument:function(i,r,R){var t=this,u;if(!i){return Promise.reject("No context exists. Pass a meaningful context");}f.lock(t.oLockObject);r=q(r);var v=i,w=r.cancelButton,x=v.getModel(),y;return Promise.resolve(this.getProgrammingModel(i)).then(function(z){u=z;if(z===p.Draft){var E=x.bindContext(v.getPath()+"/DraftAdministrativeData").getBoundContext();if(!t._bIsModified){return E.requestObject().then(function(G){t._bIsModified=!(G.CreationDateTime===G.LastChangeDateTime);});}}}).then(function(){return t._showDiscardPopover(w,t._bIsModified,R);}).then(function(){switch(u){case p.Draft:return v.requestObject("HasActiveEntity").then(function(H){var z;if(!H){if(v&&v.hasPendingChanges()){v.getBinding().resetChanges();}z=d.deleteDraft(v);return z;}else{var E=x.bindContext(v.getPath()+"/SiblingEntity").getBoundContext();return E.requestCanonicalPath().then(function(G){y=G;if(v&&v.hasPendingChanges()){v.getBinding().resetChanges();}z=d.deleteDraft(v);return z;}).then(function(){if(E.getPath()!==y){E=x.bindContext(y).getBoundContext();}return E;});}});case p.Sticky:return s.discardDocument(i).then(function(i){if(i){if(i.hasPendingChanges()){i.getBinding().resetChanges();}if(!t._bCreateMode){i.refresh();return i;}}return false;});default:return Promise.reject("Cancel document only allowed for draft or sticky session supported services");}}).then(function(z){t._bIsModified=false;m.removeBoundTransitionMessages();return m.showUnboundMessages().then(function(){return z;});}).catch(function(z){return m.showUnboundMessages().then(function(){return Promise.reject(z);});}).finally(function(){f.unlock(t.oLockObject);});},saveDocument:function(i,r,E,t){var u=this,v=this.getProgrammingModel(i),w;if(!i){return Promise.reject(new Error("Binding context to draft document is required"));}m.removeBoundTransitionMessages();f.lock(u.oLockObject);if(v===p.Draft){w=d.activateDocument(i);}else if(v===p.Sticky){w=s.activateDocument(i);}else{f.unlock(u.oLockObject);return Promise.reject(new Error("Save is only allowed for draft or sticky session supported services"));}return w.then(function(x){var N=u.sProgrammingModel===p.Sticky?u._bCreateMode:!i.getObject().HasActiveEntity;M.show(N?e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_CREATED",r):e.getTranslatedText("C_TRANSACTION_HELPER_OBJECT_SAVED",r));u._bIsModified=false;return m.showUnboundMessages().then(function(){return x;});}).catch(function(x){if(t&&t.length>0){t.forEach(function(y){if(!e.hasTransientContext(y)&&E){S.requestSideEffects(y.getPath(),i);}});}return m.showUnboundMessages().then(function(){return Promise.reject(x);});}).finally(function(){f.unlock(u.oLockObject);});},callAction:function(r,t){t=q(t);var u=this,v,w,x,N,y=t.bindingParameters;if(!r){return Promise.reject("Provide name of action to be executed");}N=r.split("/")[1];r=N||r;v=N?undefined:t.contexts;if(v&&((Array.isArray(v)&&v.length)||!Array.isArray(v))){v=Array.isArray(v)?v[0]:v;w=v.getModel();}if(t.model){w=t.model;}if(!w){return Promise.reject("Pass a context for a bound action or pass the model for an unbound action");}var z=S.getSideEffectsForAction(r,v)||{},E=u._getAppComponent();if(v&&w){x=new Promise(function(G,H){var I;var K={onClose:function(){I.close();G();},onContinue:function(){I.close();G(t.applicableContext);}};var O=function(){var Z,$=t.notApplicableContext.length,_=[];for(var i=0;i<t.notApplicableContext.length;i++){Z=t.notApplicableContext[i].getObject();_.push(Z);}var a1=new J(_);var b1=new J({total:$,label:t.label});I.setModel(a1,"notApplicable");I.setModel(b1,"totals");I.open();};if(t.notApplicableContext&&t.notApplicableContext.length>=1){var Q="sap.fe.core.controls.ActionPartial";var R=g.loadTemplate(Q,"fragment");var U=w.getMetaModel();var W=t.contexts[0].getCanonicalPath();var Y=W.substr(0,W.indexOf("("))+"/";Promise.resolve(X.process(R,{name:Q},{bindingContexts:{entityType:U.createBindingContext(Y)},models:{entityType:U,metaModel:U}})).then(function(i){return F.load({definition:i,controller:K});}).then(function(i){I=i;t.parentControl.addDependent(i);O();}).catch(H);}else{G(t.contexts);}}).then(function(i){if(i){return o.callBoundAction(r,i,w,{invocationGrouping:t.invocationGrouping,label:t.label,showActionParameterDialog:true,mBindingParameters:y,entitySetName:t.entitySetName,additionalSideEffect:z,onSubmitted:function(){f.lock(u.oLockObject);},onResponse:function(){f.unlock(u.oLockObject);},parentControl:t.parentControl,ownerComponent:E,internalModelContext:t.internalModelContext,operationAvailableMap:t.operationAvailableMap,bIsCreateAction:t.bIsCreateAction,bGetBoundContext:t.bGetBoundContext});}else{return null;}});}else{x=o.callActionImport(r,w,{label:t.label,showActionParameterDialog:true,bindingParameters:y,entitySetName:t.entitySetName,onSubmitted:function(){f.lock(u.oLockObject);},onResponse:function(){f.unlock(u.oLockObject);},parentControl:t.parentControl,internalModelContext:t.internalModelContext,operationAvailableMap:t.operationAvailableMap,ownerComponent:E});}return x.then(function(R){return m.showUnboundMessages().then(function(){return R;});}).catch(function(i){return m.showUnboundMessages().then(function(){return Promise.reject(i);});});},handleValidationError:function(){var i=sap.ui.getCore().getMessageManager(),r=i.getMessageModel().getData().filter(function(t){if(t.validation){return t;}});i.removeMessages(r);},_showDiscardPopover:function(i,I,r){var t=this;t._bContinueDiscard=false;return new Promise(function(u,v){if(!i){v("Cancel button not found");}if(I){var O=function(){i.setEnabled(true);if(t._bContinueDiscard){u();}else{v("Discard operation was rejected. Document has not been discarded");}t._oPopover.detachAfterClose(O);};if(!t._oPopover){var w=new T({text:e.getTranslatedText("C_TRANSACTION_HELPER_DRAFT_DISCARD_MESSAGE",r)}),x=new a({text:e.getTranslatedText("C_TRANSACTION_HELPER_DRAFT_DISCARD_BUTTON",r),width:"100%",press:function(){t.handleValidationError();t._bContinueDiscard=true;t._oPopover.close();},ariaLabelledBy:w});t._oPopover=new P({showHeader:false,placement:"Top",content:[new V({items:[w,x]})],beforeOpen:function(){i.setEnabled(false);t._oPopover.setInitialFocus(x);}});t._oPopover.addStyleClass("sapUiContentPadding");}t._oPopover.attachAfterClose(O);t._oPopover.openBy(i);}else{t.handleValidationError();u();}});},handleDocumentModifications:function(){this._bIsModified=true;},_getAppComponent:function(){return this._oAppComponent;},_launchDialogWithKeyFields:function(r,t,u,v,w,x){var y=this,z,E=x.parentControl,G=false;return new Promise(function(H,I){var K="sap/fe/core/controls/NonComputedVisibleKeyFieldsDialog";var N=g.loadTemplate(K,"fragment"),R=E.getController().oResourceBundle,O=w.getMetaModel(),Q=[],U=y._getAppComponent(),W=O.createBindingContext(r.getPath()),Y=O.getMetaPath(r.getPath());for(var i in v){Q.push(O.createBindingContext(Y+"/"+v[i]));}var Z=new J(Q);Z=Z.createBindingContext("/");return Promise.resolve(X.process(N,{name:K},{bindingContexts:{entitySet:W,fields:Z},models:{entitySet:W.getModel(),fields:Z.getModel(),metaModel:O}})).then(function(N){var $=[],_={},a1,b1=function(){return Promise.all($.map(function(d1){return d1.getFields()[0];}).filter(function(d1){return d1.getRequired();}).map(function(d1){var e1=d1.getId();if(e1 in _){return Promise.resolve(_[e1]).then(function(f1){return f1;}).catch(function(){return undefined;});}return d1.getValueState()===l.Error?undefined:d1.getValue();})).then(function(d1){return d1.every(function(e1){return e1!==undefined&&e1!==null&&e1!=="";});}).catch(function(){return false;}).then(function(d1){a1.setEnabled(d1);});},c1={handleChange:function(d1){m.removeBoundTransitionMessages();var e1=d1.getSource();var f1=d1.getParameter("id");var g1=d1.getParameter("promise");if(g1){_[f1]=g1.then(function(){return e1.getValue();});}b1();},handleLiveChange:function(d1){var e1=d1.getParameter("id");var f1=d1.getParameter("value");_[e1]=f1;b1();}};return F.load({definition:N,controller:c1}).then(function(d1){z=new D({title:e.getTranslatedText("C_TRANSACTION_HELPER_SAPFE_ACTION_CREATE",R),content:[d1],beginButton:{text:e.getTranslatedText("C_TRANSACTION_HELPER_SAPFE_ACTION_CREATE",R),type:"Emphasized",press:function(e1){var a1=e1.getSource();a1.setEnabled(false);f.lock(z);return Promise.all(Object.keys(_).map(function(f1){return _[f1];})).then(function(){var f1=y.onAfterCreateCompletion(t,u,x,R);w.submitBatch("submitLater");return f1;}).then(function(f1){z.setBindingContext(null);z.close();H(f1);}).finally(function(){f.unlock(z);a1.setEnabled(true);return m.showUnboundMessages();});}},endButton:{text:e.getTranslatedText("C_COMMON_ACTION_PARAMETER_DIALOG_CANCEL",R),press:function(){z.close();}},beforeOpen:function(){var O=z.getModel().getMetaModel(),e1=r.getPath(),f1=O.getObject(e1+"@com.sap.vocabularies.Common.v1.DefaultValuesFunction");if(f1){o.callFunctionImport(f1,z.getModel()).then(function(g1){for(var i=0;i<v.length;i++){if(g1&&Object.keys(g1.getObject()).indexOf(v[i])>0){u.setProperty(v[i],g1.getProperty(v[i]));}}}).catch(function(g1){L.error("Error while calling function Import "+f1,g1);});}},afterClose:function(){z.getBindingContext("internal").setProperty("bIsCreateDialogOpen",false);z.destroy();if(!G){I({bDeleteTransientContext:true});}}});$=d1.getAggregation("form").getAggregation("formContainers")[0].getAggregation("formElements");if(E&&E.addDependent){E.addDependent(z);}a1=z.getBeginButton();z.setBindingContext(u);return e.setUserDefaults(U,Q,u).then(function(){b1();z.getBindingContext("internal").setProperty("bIsCreateDialogOpen",true);z.open();}).catch(function(e1){return m.showUnboundMessages().then(function(){return Promise.reject(e1);});});});});});},onAfterCreateCompletion:function(r,N,t,R){var u,v,w=new Promise(function(i,y){u=i;v=y;});var x=function(E){var y=E.getParameter("context"),z=sap.ui.getCore().getMessageManager(),G,H,I,K,O=E.getParameter("success");if(y===N){r.detachCreateCompleted(x,this);if(!O){var Q={bDeleteTransientContext:true};if(t.keepTransientContextOnFailed){G=N.getPath();H=z.getMessageModel().getData();K=false;for(var i=0;i<H.length;i++){if(H[0].target===G){K=true;break;}}if(!K){I=new c({message:e.getTranslatedText("C_TRANSACTION_HELPER_TRANSIENT_CONTEXT_MESSAGE",R),description:e.getTranslatedText("C_TRANSACTION_HELPER_TRANSIENT_CONTEXT_DESCRIPTION",R),target:G,persistent:false,type:"Error"});z.addMessages(I);N.created().then(function(){z.removeMessages(I);},function(){z.removeMessages(I);}).catch(function(Q){L.error("Cannot find a created new document context",Q);});}}else{y.created().then(undefined,function(){L.trace("transient creation context deleted");}).catch(function(Q){L.trace("transient creation context deletion error",Q);});Q.navigateBackFromTransientState=true;}v(Q);}else{u();}}};r.attachCreateCompleted(x,this);return w;}});});
