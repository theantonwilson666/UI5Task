//@ui5-bundle sap/fe/plugins/library-preload.js
sap.ui.predefine('sap/fe/plugins/preload/Component',["sap/ui/core/Component","sap/fe/plugins/preload/FilePreload","sap/base/util/UriParameters"],function(C,F,U){"use strict";return C.extend("sap.fe.plugins.preload.Component",{metadata:{manifest:{"sap.ui5":{dependencies:{libs:{}},services:{ShellUIService:{factoryName:"sap.ushell.ui5service.ShellUIService"}},routing:{routes:[],targets:[]}}},library:"sap.fe"},init:function(){if(U.fromURL(window.location.href).get("sap-ui-xx-fePreload")!=="false"){var p=this.getComponentData().config;var s=p.chunkStartUpDelay?p.chunkStartUpDelay:1000;setTimeout(function(){F.start(p.chunkSize,p.chunkInterval);},s);}},exit:function(){}});});
sap.ui.predefine('sap/fe/plugins/preload/FilePreload',["sap/base/util/LoaderExtensions","sap/base/Log"],function(L,a){"use strict";var C=5;var b=1000;var F={_isModuleLoaded:function(p){var s=p.split("/"),c=window,i=0;while(i<s.length&&c){c=c[s[i]];i++;}return c!==undefined;},_loadLibraries:function(l){return this._waitUntilHomeIsDisplayed().then(function(){return sap.ui.getCore().loadLibraries(l);});},_loadModulesByChunks:function(m){var i;for(i=m.length-1;i>=0;i--){var M=m[i];if(this._isModuleLoaded(M)){m.splice(i,1);}}var t=m.length,c=Math.ceil(t/this.iChunkSize);if(c===0){return Promise.resolve();}else{var d=[],e=this;for(i=0;i<c;i++){d.push(m.slice(i*this.iChunkSize,i*this.iChunkSize+this.iChunkSize));}return new Promise(function(r,f){e._processChunk(d,0,r);});}},_processChunk:function(c,i,r){var t=this;if(i>=c.length){r();}else{var d=c[i];t._waitUntilHomeIsDisplayed().then(function(){sap.ui.require(d,function(e){a.debug("sap.fe.plugins.preload: Chunk ["+i+"] loaded ("+JSON.stringify(d)+")");setTimeout(function(){t._processChunk(c,i+1,r);},t.iChunkInterval);},function(){a.error("sap.fe.plugins.preload: failed to load library chunk: "+JSON.stringify(d));setTimeout(function(){t._processChunk(c,i+1,r);},t.iChunkInterval);});}).catch(function(){a.error("sap.fe.plugins.preload: unknown error - Aborting");r();});}},_waitUntilHomeIsDisplayed:function(){var r;function o(){var A=sap.ushell.Container.getService("AppLifeCycle"),i=A.getCurrentApplication().homePage;if(i){A.detachAppLoaded(o);a.info("sap.fe.plugins.preload: preload resumed");r();}}if(sap.ushell.Container.getService("AppLifeCycle").getCurrentApplication().homePage===false){a.info("sap.fe.plugins.preload: preload paused");return new Promise(function(c,d){sap.ushell.Container.getService("AppLifeCycle").attachAppLoaded(o);r=c;});}else{return Promise.resolve();}},start:function(c,i){this.iChunkSize=c?c:C;this.iChunkInterval=i?i:b;a.info("sap.fe.plugins.preload: preload starting");var p=L.loadResource("/sap/fe/plugins/preload/data/components.json"),l=L.loadResource("/sap/fe/plugins/preload/data/libraries.json"),t=this;return this._loadLibraries(l).then(function(){return t._loadModulesByChunks(p);}).then(function(){a.info("sap.fe.plugins.preload: preload finished");}).catch(function(e){a.error("sap.fe.plugins.preload: Error while preloading data");});}};return F;});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2020 SAP SE. All rights reserved
    
 */
sap.ui.predefine('sap/fe/plugins/library',["sap/ui/core/Core"],function(){"use strict";sap.ui.getCore().initLibrary({name:"sap.fe.plugins",dependencies:["sap.ui.core","sap.fe.templates"],types:[],interfaces:[],controls:[],elements:[],version:"1.88.0",noLibraryCSS:true});return sap.fe.plugins;});
sap.ui.require.preload({
	"sap/fe/plugins/manifest.json":'{"_version":"1.21.0","sap.app":{"id":"sap.fe.plugins","type":"library","embeds":[],"applicationVersion":{"version":"1.88.0"},"title":"UI5 library: sap.fe.plugins","description":"UI5 library: sap.fe.plugins","resources":"resources.json","offline":true},"sap.ui":{"technology":"UI5","supportedThemes":[]},"sap.ui5":{"dependencies":{"minUI5Version":"1.88","libs":{"sap.ui.core":{"minVersion":"1.88.0"}}},"library":{"i18n":false,"css":false,"content":{"controls":[],"elements":[],"types":[],"interfaces":[]}}}}',
	"sap/fe/plugins/preload/getDependencies.js":'var fs=require("fs");var XMLTemplateKeyWords=["template","FragmentDefinition"];\nfunction pReaddir(d){"use strict";return new Promise(function(r,a){fs.readdir(d,{withFileTypes:true},function(e,i){r(i);});});}\nfunction pWriteFile(f,d,o){"use strict";return new Promise(function(r,a){fs.writeFile(f,d,o,function(e){if(e){a(e);}else{r();}});});}\nfunction pReadFile(f,o){"use strict";return new Promise(function(r,a){fs.readFile(f,o,function(e,d){if(e){a(e);}else{r(d);}});});}\nfunction getFiles(d){"use strict";return pReaddir(d,{withFileTypes:true}).then(function(i){if(i){var p=[];i.forEach(function(a){if(a.isDirectory()){p=p.concat(getFiles(d+"/"+a.name));}else{p.push(Promise.resolve(d+"/"+a.name));}});return Promise.all(p);}else{return[];}}).then(function(i){var a=[];i.forEach(function(b){a=a.concat(b);});return a;});}\nfunction getLibrariesInDir(d,l){"use strict";var L=d+"/.library";return pReadFile(L,"utf8").then(function(c){c.split("\\n").forEach(function(s){var r=s.match("<libraryName>(.*)</libraryName>");if(r!==null){l[r[1]]="";}});});}\nfunction addJsFile(f,c){"use strict";var F=f.replace(/\\\\/g,"/");if((F.endsWith(".js")||F.endsWith(".ts"))&&F.indexOf("library.js")===-1){var C=F.substring(F.indexOf("src/")+4).replace(/\\.[jt]s$/,"");c[C]="";if(F.endsWith(".js")){return pReadFile(F,"utf8").then(function(j){process.stdout.write("Processing JS/TS file :"+f+"\\n");var m=j.match(/sap.ui.define\\(\\s*\\[([^\\]]*)\\]/);if(m){var M=m[1].split(",");M.forEach(function(n){if(n){var a=n.match(/"([^"]*)"/);if(a&&a[1].indexOf(".")<0){process.stdout.write("\\tComponent :"+a[1]+"\\n");c[a[1]]="";}}});}});}}return null;}\nfunction addFragmentFile(f,F){"use strict";var s=f.replace(/\\\\/g,"/");if(s.endsWith("fragment.xml")){var a=s.substring(s.indexOf("src/")+4).replace(".fragment.xml","");F.push(a);}}\nfunction getComponentsFromXMLView(f,c){"use strict";if(f.endsWith(".xml")){return pReadFile(f,"utf8").then(function(x){var X=x.split("\\n");process.stdout.write("Processing XML file :"+f+"\\n");X.forEach(function(l){var m=l.match(/xmlns:{0,1}([a-zA-Z]*)="([a-zA-Z.]*)"/);if(m){var L=m[2];var s=m[1]?m[1]+":":"";X.forEach(function(a){var C=a.match("<"+s+"([A-Z][a-zA-Z.]*)($| |>)");if(C&&XMLTemplateKeyWords.indexOf(C[1])===-1){var b=L.replace(/\\./g,"/")+"/"+C[1]+"";process.stdout.write("\\tComponent :"+b+"\\n");if(b.indexOf("sap/fe/macros/")===0){b+=".metadata";c[b]=L;}else if(b.indexOf("sap/fe")===0){}else{c[b]=L;}}});}});});}else{return Promise.resolve();}}\nfunction main(){"use strict";if(process.argv.length<3){process.stdout.write("missing parameters. Please use --help\\n");return;}else if(process.argv[2]==="--help"){process.stdout.write("Usage: getDependencies <dir1> <dir2> ... , where <dirN> is a path to a directory to look for XML views and FE components (javascript files)\\n");return;}var d=[],o="./",c={"sap/m/routing/router":"","sap/f/routing/router":"","sap/ui/model/odata/v4/ODataModel":""},l={"sap.fe.templates":""},p=[],f=[];for(var I=2;I<process.argv.length;I++){if(process.argv[I]!=="--out-dir"){d.push(process.argv[I]);}else if(I<process.argv.length-1){I++;o=process.argv[I];}}if(!o.endsWith("/")){o+="/";}d.forEach(function(D){p.push(getLibrariesInDir(D,l));p.push(getFiles(D).then(function(F){var a=[];F.forEach(function(b){a.push(getComponentsFromXMLView(b,c));var j=addJsFile(b,c);if(j){a.push(j);}addFragmentFile(b,f);});return Promise.all(a);}));});Promise.all(p).then(function(){pWriteFile(o+"libraries.json",JSON.stringify(Object.keys(l)),"utf-8");pWriteFile(o+"components.json",JSON.stringify(Object.keys(c)),"utf-8");pWriteFile(o+"fragments.json",JSON.stringify(f),"utf-8");}).catch(function(e){process.stderr.write("Error ("+e.code+"): "+e.message+"\\n");});}\nmain();\n'
},"sap/fe/plugins/library-preload"
);
//# sourceMappingURL=library-preload.js.map