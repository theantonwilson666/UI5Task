sap.ui.define(["sap/ui/base/Object","sap/ui/test/Opa5","./Utils","./BaseArrangements","./BaseActions","./BaseAssertions","./Shell","sap/ui/test/opaQunit","sap/base/Log","sap/base/util/ObjectPath"],function(B,O,U,a,b,c,S,o,L,d){"use strict";var _=Promise.resolve();var e;var J=B.extend("sap.fe.test.JourneyRunner",{constructor:function(s){B.apply(this);this._mInstanceSettings=U.mergeObjects({pages:{onTheShell:new S()}},s);},run:function(s,j){var i=1;if(!U.isOfType(s,Object)){i=0;s=U.mergeObjects(this._mInstanceSettings);}else{s=U.mergeObjects(this._mInstanceSettings,s);}var f=U.getParametersArray(i,arguments),A=s.async,p;if(A){p=Promise.resolve();}else{p=_;}p=p.then(this._preRunActions.bind(this,s)).then(this._runActions.bind(this,f)).then(this._postRunActions.bind(this,s)).catch(function(E){L.error("JourneyRunner.run failed",E);});if(!A){_=p;}return p;},getBaseActions:function(s){return new b();},getBaseAssertions:function(s){return new c();},getBaseArrangements:function(s){return new a(s);},_preRunActions:function(s){L.setLevel(1,"sap.ui.test.matchers.Properties");L.setLevel(1,"sap.ui.test.matchers.Ancestor");O.extendConfig(this._getOpaConfig(s));O.createPageObjects(s.pages);},_runActions:function(j){var t=this,p=Promise.resolve(),r,f=new Promise(function(g){r=g;});L.info("JourneyRunner started");QUnit.done(function(){L.info("JourneyRunner ended");r();});j.forEach(function(v){if(U.isOfType(v,String)){p=p.then(function(){return new Promise(function(g,h){sap.ui.require([v],function(i){g(i);});});});}else{p=p.then(function(){return v;});}p=p.then(t._runJourney);});return p.then(function(){return f;});},_runJourney:function(j){if(U.isOfType(j,Function)){j.call();}},_postRunActions:function(s){this._removePages(s.pages);O.resetConfig();},_removePages:function(p){var t=this;p&&Object.keys(p).forEach(function(P){var m=p[P],C=t._createClassName(m.namespace||"sap.ui.test.opa.pageObject",P);d.set(C,undefined);});},_createClassName:function(n,N){return n+"."+N;},_getOpaConfig:function(s){var C=Object.assign({viewNamespace:"sap.fe.templates",autoWait:true,timeout:90,logLevel:"ERROR",disableHistoryOverride:true,asyncPolling:true},s.opaConfig);if(!C.actions){C.actions=this.getBaseActions(s);}if(!C.assertions){C.assertions=this.getBaseAssertions(s);}if(!C.arrangements){C.arrangements=this.getBaseArrangements(s);}return C;}});J.getDefaultRunner=function(){if(!e){e=new J();}return e;};J.setDefaultRunner=function(D){if(e){e.destroy();}e=D;};J.run=function(){var r=J.getDefaultRunner();r.run.apply(r,arguments);};return J;});
