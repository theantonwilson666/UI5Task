sap.ui.define(["sap/fe/macros/internal/Field.metadata","sap/fe/macros/PhantomUtil","sap/ui/model/odata/v4/lib/_MetadataRequestor","sap/ui/model/odata/v4/ODataMetaModel","sap/ui/core/util/XMLPreprocessor","sap/base/Log","xpath","fs","@sap/cds-compiler","prettier","sap/ui/base/BindingParser","sap/ui/model/json/JSONModel","sap/ui/core/InvisibleText","sap/fe/core/converters/ConverterContext","sap/base/util/merge","path"],function(F,P,_,O,X,L,x,f,c,p,B,J,I,C,m,a){"use strict";var b={};var d=C.createConverterContext;var g=p.format;var t=c.to;var h=c.compileSources;var i=c.compactModel;P.register(F);L.setLevel(1,"sap.ui.core.util.XMLPreprocessor");jest.setTimeout(40000);var n={"macros":"sap.fe.macros","control":"sap.fe.core.controls","core":"sap.ui.core","m":"sap.m","mdc":"sap.ui.mdc","mdcField":"sap.ui.mdc.field","u":"sap.ui.unified","macroMicroChart":"sap.fe.macros.microchart","microChart":"sap.suite.ui.microchart"};var s=x.useNamespaces(n);var r=function(e){P.register(e);};b.registerMacro=r;var j=function(e,E){return s(e,E);};expect.extend({toHaveControl:function(e,E){var G=j("/root".concat(E),e);return{message:function(){var H=l(e);return"did not find controls matching ".concat(E," in generated xml:\n ").concat(H);},pass:G&&G.length>=1};},toNotHaveControl:function(e,E){var G=j("/root".concat(E),e);return{message:function(){var H=l(e);return"There is a control matching ".concat(E," in generated xml:\n ").concat(H);},pass:G&&G.length===0};}});b.runXPathQuery=j;var k=function(e,E,G){var H="string(/root".concat(e,"/@").concat(E,")");return j(H,G);};b.getControlAttribute=k;var l=function(e){var E=new window.XMLSerializer();var G=E.serializeToString(e).replace(/(?:[\t ]*(?:\r?\n|\r))+/g,"\n").replace(/\\"/g,'"');return g(G,{parser:"html"});};b.serializeXML=l;var o=function(e){var E=f.readFileSync(e,"utf-8");var G=h({"string.cds":E},{});var H=i(G);var K=t.edmx(H,{service:"sap.fe.test.JestService"});var M=a.resolve(e,"..","gen");var N=a.resolve(M,a.basename(e).replace(".cds",".xml"));if(!f.existsSync(M)){f.mkdirSync(M);}f.writeFileSync(N,K);return N;};b.compileCDS=o;var q=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"compact";return{getContentDensity:function(){return e;}};};b.getFakeShellService=q;var u=function(){var e=[];return{addIssue:function(E,G,H){e.push({issueCategory:E,issueSeverity:G,details:H});},getIssues:function(){return e;},checkIfIssueExists:function(E,G,H){return e.find(function(K){K.issueCategory===E&&K.issueSeverity===G&&K.details===H;});}};};b.getFakeDiagnostics=u;var v=function(e,E,G){var H=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"compact";var K=e.entitySets.find(function(N){return N.name===E.entitySet;});var M=y(K,K);return d(e,E,G,q(H),u(),m,M);};b.getConverterContext=v;var w=function(M){try{var R=_.create({},"4.0",{});var E=new O(R,M,undefined,null);return Promise.resolve(E.fetchEntityContainer()).then(function(){return E;});}catch(e){return Promise.reject(e);}};b.getMetaModel=w;var y=function(e,E){var G={startingEntitySet:e,navigationProperties:[],targetObject:E,targetEntitySet:e,targetEntityType:e.entityType};G.contextLocation=G;return G;};b.getDataModelObjectPathForProperty=y;var z=function(e){var E=B.complexParser(e);for(var G=arguments.length,H=new Array(G>1?G-1:0),K=1;K<G;K++){H[K-1]=arguments[K];}return E.formatter.apply(undefined,H);};b.evaluateBinding=z;var A=function(e,E){var G=B.complexParser(e);var H=new J(E);var K=new I();K.bindProperty("text",G);K.setModel(H);K.setBindingContext(H.createBindingContext("/"));return K.getText();};b.evaluateBindingWithModel=A;var D=function(E,M,G,H){try{var K="<root>".concat(E,"</root>");var N=new window.DOMParser();var Q=N.parseFromString(K,"text/xml");return Promise.resolve(w(M)).then(function(R){var S={models:Object.assign({metaModel:R},H),bindingContexts:{}};Object.keys(G).forEach(function(T){expect(typeof R.getObject(G[T])).toBeDefined();var U=H[T]||R;S.bindingContexts[T]=U.createBindingContext(G[T]);S.models[T]=U;});if(S.models["this"]){S.bindingContexts["this"]=S.models["this"].createBindingContext("/");}return X.process(Q.firstElementChild,{name:"Test Fragment"},S);});}catch(e){return Promise.reject(e);}};b.getTemplatingResult=D;return b;},false);
