/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2020 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/model/odata/v4/ODataMetaModel","sap/ui/core/util/XMLPreprocessor","sap/ui/core/XMLTemplateProcessor","sap/fe/macros/macroLibrary","sap/fe/core/TemplateModel"],function(O,X,a,m,T){"use strict";function t(Q,s,M,f,u){var S="./test/",r={read:function(){return Promise.resolve(M);},mHeaders:{}},o=new O(r,S+"$metadata",undefined,null);m.deregister();if(u){m.register();}function b(d,D,B,e){var p={models:Object.assign({},e),bindingContexts:{}};Object.keys(B).forEach(function(k){var g=e[k]||o;if(!(g instanceof sap.ui.model.Model)&&!(g instanceof sap.ui.model.odata.v4.ODataMetaModel)){g=new T(g,o);}d.ok(typeof g.getObject(B[k])!=="undefined",k+": "+B[k]+" exists");p.bindingContexts[k]=g.createBindingContext(B[k]);p.models[k]=g;});if(p.models["this"]){p.bindingContexts["this"]=p.models["this"].createBindingContext("/");}return Promise.resolve(X.process(D,{},p));}Q.module("Smoke Tests for "+s);Q.test("Check if metadata is available",function(d){return Promise.all([o.requestObject("/").then(function(e){d.ok(e,"Entity Container found");}),o.requestObject("/$").then(function(e){d.ok(e,"Metadata Document found");})]);});function c(F){F.fileType=F.fileType||"fragment";Q.module("Tests for "+s+" against "+F.fileType+" "+F.sFragmentName+(F.sDescription?" ("+F.sDescription+")":""));F.tests.forEach(function(d,i){Q.test(d.description||"Test "+F.fileType+" scope: "+i,function(e){return o.requestObject("/$").then(function(){return a.loadTemplatePromise(F.sFragmentName,F.fileType);}).then(function(D){return b(e,D,d.mBindingContexts,Object.assign({},F.mModels,d.mModels));}).then(function(D){var E=[].filter.call(D.ownerDocument.querySelectorAll("*"),h),g,n=0;function h(k){return k.getAttribute("unittest:id")!==null;}function j(k,l,g){function q(A){if(l[A]===undefined){e.ok(!k.hasAttribute(A),'unittest:id="'+g+"\": attribute '"+A+"' is expected not to be rendered");}else{var R=k.getAttribute(A);e.strictEqual(R,l[A],'unittest:id="'+g+"\": attribute '"+A+"' properly created as "+R);}}if(l){n++;Object.keys(l).forEach(q);}}E.forEach(p);function p(k){g=k.getAttribute("unittest:id");j(k,d.oExpectedResultsPerTest[g],g);}e.equal(n,Object.keys(d.oExpectedResultsPerTest).length,"All tests have been executed for this test case");}).catch(function(E){var g=d.sExpectedException;if(E&&g){e.strictEqual(E.message||E,g,"expected exception occurred: "+g);}else{throw E;}});});});}f.forEach(c);}return{testFragments:t};});
