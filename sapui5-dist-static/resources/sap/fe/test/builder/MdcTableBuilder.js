sap.ui.define(["sap/ui/test/Opa5","sap/ui/test/OpaBuilder","./FEBuilder","./MacroFieldBuilder","./OverflowToolbarBuilder","./DialogBuilder","sap/fe/test/Utils","sap/ui/test/matchers/Interactable","sap/ui/core/SortOrder","sap/ui/test/actions/EnterText"],function(O,a,F,M,b,D,U,I,S,E){"use strict";var R={Custom:"Custom",Navigation:"Navigation",Delete:"Delete"};function _(p){return p.getType().isA("sap.ui.mdc.table.GridTableType");}function c(p){return _(p)?"rows":"items";}function d(C,p){var q=Number(C);return Number.isNaN(q)?p.getColumns().findIndex(function(r){return r.getHeader()===C||r.getDataProperty()===C;}):q;}function e(t){var p=t;while(p&&!p.isA("sap.ui.mdc.Table")){p=p._feMdcTableWrapper||p.getParent();}return p;}function f(C,r){var p=e(r);return p?d(C,p):-1;}function g(r,C){var p;if(!r){return null;}if(r.isA("sap.ui.mdc.table.CreationRow")){p=r._oInnerCreationRow._getCell(C);}else if(r.isA("sap.ui.table.CreationRow")){p=r._getCell(C);}else{p=r.getCells()[C];}if(p.isA("sap.fe.macros.MacroAPI")){p=p.getContent();}return p;}function h(C,B){if(C.isA("sap.fe.macros.MacroAPI")){C=C.getContent();}var s={controlType:"sap.m.Button"},p;if(B){s.text=B;}p=F.Matchers.states(s);return p(C)?[C]:a.Matchers.children(p)(C);}function i(C,r){var p=Number(C);if(Number.isNaN(p)){return r.getCells().reduce(function(P,q){return P.concat(h(q,C));},[]);}return h(g(r,p));}function j(r){var p=r.getRowAction();return p.getItems().reduce(function(q,A,s){if(!q&&A.getType()===R.Navigation){q=p.getAggregation("_icons")[s];}return q;},null);}function k(r){var p=[new I(),F.Matchers.bound()];if(U.isOfType(r,Object)){r=T.Row.Matchers.cellValues(r);}if(r){p=p.concat(r);}return p;}function l(p){return p&&p._oTable;}function m(t,B,A,s){s=s||"sap.m.Button";return t.doOpenOverflow().success(function(p){return a.create().hasType(s).hasId(RegExp(U.formatMessage("-{0}$",B))).has(a.Matchers.ancestor(p)).doConditional(!!A,A).execute();});}function n(C,G){return{getHeader:function(){return G?(C.getLabel()&&C.getLabel().getText())||C.getName():C.getHeader()&&C.getHeader().getText();},getDataProperty:function(){return"$data property not available$";}};}function o(p){var G=p.isA("sap.ui.table.Table"),w={_oTable:p,isA:function(N){return N==="sap.ui.mdc.Table";},getType:function(){return{isA:function(N){return N===(G?"sap.ui.mdc.table.GridTableType":"sap.ui.mdc.table.ResponsiveTableType");}};},getColumns:function(){return p.getColumns().map(function(C){return n(C,G);});},getRowBinding:function(){return p.getBinding(c(w));}};p._feMdcTableWrapper=w;return w;}var T=function(){return F.apply(this,arguments).hasType("sap.ui.mdc.Table");};T.create=function(p){return new T(p);};T.createWrapper=function(p,t,v){var B=new T(p).hasType(t);if(v){B.has(v);}return B.has(function(q){return o(q);});};T.prototype=Object.create(F.prototype);T.prototype.constructor=T;T.prototype.getStatesMatcher=function(s){return T.Matchers.states(s);};T.prototype.hasColumns=function(C,p){if(!C||Object.keys(C).length===0){return this;}return this.has(T.Matchers.columnsMatcher(C,p));};T.prototype.hasRows=function(r,p){r=k(r);return p?this.has(T.Matchers.rows(r)):this.has(T.Matchers.rowsMatcher(r));};T.prototype.doOnRows=function(r,v){if(arguments.length===1){v=r;r=undefined;}if(!v){return this;}return this.hasRows(r,true).do(a.Actions.executor(v));};T.prototype.doClickOnCell=function(r,C){return this.doOnRows(r,T.Row.Actions.onCell(C,a.Actions.press()));};T.prototype.doScroll=function(s){return this.do(function(t){switch(s){case"up":t.scrollToIndex(0);break;case"down":default:t.scrollToIndex(-1);break;}});};T.prototype.doPressKeyboardShortcut=function(s,r,C){if(r&&C){return this.doOnRows(r,T.Row.Actions.onCell(C,F.Actions.keyboardShortcut(s,"input")));}return this.do(F.Actions.keyboardShortcut(s,true));};T.prototype.doEditValues=function(r,C){if(arguments.length===1){C=r;r=undefined;}return this.hasColumns(C,true).doOnRows(r,T.Row.Actions.editCells(C));};T.prototype.doEditCreationRowValues=function(C){return this.hasColumns(C,true).has(a.Matchers.aggregation("creationRow")).do(T.Row.Actions.editCells(C));};T.prototype.doSelect=function(r){return this.doOnRows(r,function(p){if(p.getMetadata().getName()==="sap.ui.table.Row"){var t=p.getParent(),q=t.indexOfRow(p);return a.Actions.press("rowsel"+q).executeOn(t);}return a.Actions.press().executeOn(p.getMultiSelectControl()||p.getSingleSelectControl());});};T.prototype.doSelectAll=function(){return this.do(function(t){var p=_(t);if(p){return a.Actions.press("selall").executeOn(t.getAggregation("_content"));}return a.Actions.press("sa").executeOn(t.getAggregation("_content"));});};T.prototype.doNavigate=function(r){return this.doOnRows(r,function(p){if(p.getMetadata().getName()==="sap.ui.table.Row"){return a.Actions.press().executeOn(j(p));}return a.Actions.press("imgNav").executeOn(p);});};T.prototype.doPressColumnHeader=function(C){return this.has(T.Matchers.columnControl(C)).has(F.Matchers.singleElement()).doPress();};T.prototype.doColumnHeaderAction=function(C,A,s){var p=a.create().isDialogElement().hasType(s?"sap.m.ToggleButton":"sap.m.Button").hasProperties({icon:A}).doPress();if(s){p.success(a.create().isDialogElement().hasType("sap.m.StandardListItem").hasProperties({title:s}).doPress());}return this.doPressColumnHeader(C).success(p);};T.prototype.doSortByColumn=function(C,s){return this.doColumnHeaderAction(C,"sap-icon://sort",s);};T.prototype.doGroupByColumn=function(C,s){return this.doColumnHeaderAction(C,"sap-icon://group-2",s);};T.prototype.doAggregateByColumn=function(C,s){return this.doColumnHeaderAction(C,"sap-icon://sum",s);};T.prototype.doExpand=function(r){return this.doOnRows(r,function(p){if(p.getMetadata().getName()==="sap.ui.table.Row"){p.expand();}});};T.prototype.doCollapse=function(r){return this.doOnRows(r,function(p){if(p.getMetadata().getName()==="sap.ui.table.Row"){p.collapse();}});};T.prototype.hasOverlay=function(H){return this.has(T.Matchers.overlay(H));};T.prototype.hasNumberOfRows=function(N){return this.has(function(t){var r=t.getRowBinding(),H=T.Matchers.overlay(true)(t);return((r&&!H&&(N===undefined?r.getLength()!==0:r.getLength()===N))||((!r||H)&&N===0));});};T.prototype.hasQuickFilterItems=function(N){return this.has(function(t){var q=t.getQuickFilter();if(q){var p=q.getSelector().getItems();if(U.isOfType(p,Array)){return p.length===N;}return false;}return false;});};T.prototype.doSelectQuickFilter=function(p){return this.has(function(t){return t.getQuickFilter().getSelector();}).doConditional(F.Matchers.state("controlType","sap.m.Select"),a.Actions.press()).success(function(q){return F.create(this).hasId([].concat(q)[0].getId()).doOnAggregation("items",p,a.Actions.press()).execute();}.bind(this));};T.prototype.doOpenOverflow=function(){return b.openOverflow(this,"toolbar");};T.prototype.doCloseOverflow=function(){return b.closeOverflow(this,"toolbar");};T.prototype.doExecuteAction=function(A){var s=new T(this.getOpaInstance(),this.build()).doOnAggregation("actions",A,a.Actions.press());return this.doOpenOverflow().success(s);};T.prototype.hasShowHideDetails=function(){return m(this,"showHideDetails",false);};T.prototype.doShowHideDetails=function(s){return this.doOpenOverflow().success(function(p){if(_(p)){return;}var r=O.getWindow().sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc"),q;if(s!==undefined){q=s?r.getText("table.SHOWDETAILS_TEXT"):r.getText("table.HIDEDETAILS_TEXT");}return a.create().hasType("sap.m.Button").hasId(/-showHideDetails$/).has(a.Matchers.ancestor(p)).doConditional(function(B){return!q||B.getText()===q;},a.Actions.press()).execute();});};T.prototype.hasColumnAdaptation=function(){return m(this,"settings",false);};T.prototype.doOpenColumnAdaptation=function(){return m(this,"settings",a.Actions.press());};T.prototype.hasColumnSorting=function(){return m(this,"sort",false);};T.prototype.doOpenColumnSorting=function(){return m(this,"sort",a.Actions.press());};T.prototype.hasColumnFiltering=function(){return m(this,"filter",false);};T.prototype.doOpenColumnFiltering=function(){return m(this,"filter",a.Actions.press());};T.prototype.hasColumnExport=function(){return m(this,"export",false,"sap.m.MenuButton");};T.prototype.doExecuteInlineAction=function(r,C){return this.doOnRows(r,T.Row.Actions.pressInlineAction(C));};T.prototype.doPasteData=function(p){return this.do(function(q){q.firePaste({data:p});});};T.createAdaptationDialogBuilder=function(p){return D.create(p).has(a.Matchers.resourceBundle("title","sap.ui.mdc","table.SETTINGS_COLUMN"));};T.createSortingDialogBuilder=function(p){return D.create(p).has(a.Matchers.resourceBundle("title","sap.ui.mdc","table.SETTINGS_SORT"));};T.createFilteringDialogBuilder=function(p){return D.create(p).has(a.Matchers.resourceBundle("title","sap.ui.mdc","filter.PERSONALIZATION_DIALOG_TITLE"));};T.Cell={Matchers:{state:function(N,v){switch(N){case"editor":case"editors":return function(C){return M.Matchers.states(v)(C);};default:return F.Matchers.state(N,v);}},states:function(s){return F.Matchers.states(s,T.Cell.Matchers.state);}}};T.Column={Matchers:{state:function(N,v){switch(N){case"sortOrder":return T.Column.Matchers.sortOrder(v);case"template":case"creationTemplate":return function(C){return M.Matchers.states(v)(C.getAggregation(N));};default:return F.Matchers.state(N,v);}},states:function(s){return F.Matchers.states(s,T.Column.Matchers.state);},sortOrder:function(s){return function(p){var q=p.getParent(),r=_(q),P={};if(r){P.sorted=s===S.None?false:true;if(s!==S.None){P.sortOrder=s;}}else{P.sortIndicator=s;}return F.controlsExist(F.create().hasId(p.getId()+"-innerColumn").hasProperties(P));};}}};T.Row={Matchers:{cell:function(C){return function(r){var p=f(C,r);return g(r,p);};},cellValue:function(C,v){return function(r){var p=T.Row.Matchers.cell(C)(r);while(p.isA("sap.fe.macros.MacroAPI")){p=p.getContent();}return M.Matchers.value(v)(p);};},cellValues:function(C){if(!C){return a.Matchers.TRUE;}return F.Matchers.match(Object.keys(C).map(function(s){return T.Row.Matchers.cellValue(s,C[s]);}));},cellProperty:function(C,p){return function(r){var q=T.Row.Matchers.cell(C)(r);while(q.isA("sap.fe.macros.MacroAPI")){q=q.getContent();}return T.Cell.Matchers.states(p)(q);};},cellProperties:function(C){if(!C){return a.Matchers.TRUE;}return F.Matchers.match(Object.keys(C).map(function(s){return T.Row.Matchers.cellProperty(s,C[s]);}));},selected:function(s){return function(r){var t=r.getParent(),p=t.getParent(),q=_(p),u=q?t.getSelectedIndices.includes(t.indexOfRow(r)):r.getSelected();return s?u:!u;};},navigated:function(N){return function(r){var p;if(r.getMetadata().getName()==="sap.ui.table.Row"){p=r.getAggregation("_settings").getNavigated();}else{p=r.getNavigated();}return N?p:!p;};},focused:function(){return function(r){var p=[r];if(r.getMetadata().getName()==="sap.ui.table.Row"){p.push(j(r));}return p.some(a.Matchers.focused(true));};},highlighted:function(H){return function(r){var s;if(r.getMetadata().getName()==="sap.ui.table.Row"){s=r.getAggregation("_settings").getHighlight();}else{s=r.getHighlight();}return H===s;};},states:function(s){if(!U.isOfType(s,Object)){return a.Matchers.TRUE;}return F.Matchers.match(Object.keys(s).map(function(p){switch(p){case"selected":return T.Row.Matchers.selected(s.selected);case"focused":return T.Row.Matchers.focused();case"navigated":return T.Row.Matchers.navigated(s.navigated);case"highlight":return T.Row.Matchers.highlighted(s.highlight);default:return F.Matchers.state(p,s[p]);}}));},visualGroup:function(L,t){return function(r){if(r.getMetadata().getName()==="sap.ui.table.Row"){return r.getLevel()===L&&r.getTitle()===t;}else{return false;}};}},Actions:{onCell:function(C,v){return function(r){var p=f(C,r),q=g(r,p);if(q.isA("sap.fe.core.controls.FieldWrapper")){q=q.getEditMode()==="Display"?q.getContentDisplay():q.getContentEdit()[0];}if(q.isA("sap.fe.core.controls.ConditionalWrapper")){q=q.getCondition()?q.getContentTrue():q.getContentFalse();}if(v.executeOn){v.executeOn(q);}else{v(q);}};},editCell:function(C,v){return T.Row.Actions.onCell(C,new E({text:v,clearTextFirst:true,keepFocus:false,idSuffix:null,pressEnterKey:true}));},editCells:function(C){return Object.keys(C).map(function(s){return T.Row.Actions.editCell(s,C[s]);});},onCellInlineAction:function(C,v){return function(r){var B=i(C,r);return a.Actions.executor(v)(B);};},pressInlineAction:function(C){return T.Row.Actions.onCellInlineAction(C,a.Actions.press());}}};T.Matchers={isGridTable:function(){return _;},rows:function(r){return function(p){if(T.Matchers.overlay(true)(p)){return[];}return a.Matchers.aggregation(c(p),r)(p._oTable);};},rowsMatcher:function(r){var p=T.Matchers.rows(r);return function(q){return p(q).length>0;};},columnControl:function(C){return function(p){var q=d(C,p),r=l(p);return r.getColumns()[q];};},column:function(C,s){return function(p){var q=d(C,p),r=U.getAggregation(p,"columns");if(q===-1){if(s&&s.visible===false){return true;}}else{var t=r[q];if(!s||F.Matchers.match(T.Column.Matchers.states(s))(t)){return t;}}return false;};},columns:function(C,p){return function(q){return Object.keys(C).reduce(function(r,v){var s=T.Matchers.column(v,p?undefined:C[v])(q);if(s){r.push(s===true?null:s);}return r;},[]);};},columnsMatcher:function(C,p){var q=T.Matchers.columns(C,p);return function(r){return q(r).length===Object.keys(C).length;};},overlay:function(H){if(H===undefined){H=true;}return function(p){p=p._feMdcTableWrapper||p;return p&&p._oTable.getShowOverlay()===H;};},state:function(N,v){switch(N){case"overlay":return T.Matchers.overlay(v);default:return F.Matchers.state(N,v);}},states:function(s){return F.Matchers.states(s,T.Matchers.state);}};T.Actions={};return T;});
