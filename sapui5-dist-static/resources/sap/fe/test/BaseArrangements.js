sap.ui.define(["sap/ui/test/Opa5","sap/ui/test/OpaBuilder","sap/ui/thirdparty/jquery","sap/base/util/UriParameters","./Utils","./Stubs"],function(O,a,q,U,b,S){"use strict";var B=O.extend("sap.fe.test.BaseArrangements",{constructor:function(s){O.apply(this);var u=new U(window.location.href),d={"sap-ui-log-level":"ERROR","sap-ui-xx-viewCache":true};if(u.get("useBackendUrl")){d.useBackendUrl=u.get("useBackendUrl");}this._mSettings=b.mergeObjects({launchParameters:d},s);},iStartMyApp:function(A,u){var l=this._mSettings.launchUrl,u=b.mergeObjects(this._mSettings.launchParameters,u),s=Object.keys(u).reduce(function(C,k){return C+"&"+k+"="+u[k];},""),c=l+(s?"?"+s.substring(1):"")+(A?"#"+A:"");this.iStartMyAppInAFrame(c);return a.create(this).success(function(){var w=O.getWindow();S.stubAll(w);}).description(b.formatMessage("Started URL '{0}' in iFrame",c)).execute();},resetTestData:function(){function _(n){return new Promise(function(r,c){var R=indexedDB.deleteDatabase(n);R.onsuccess=r;R.onerror=c;});}localStorage.clear();sessionStorage.clear();if(indexedDB){if(typeof indexedDB.databases==="function"){return indexedDB.databases().then(function(d){return Promise.all(d.map(function(D){return _(D.name);}));});}else{return _("ui5-cachemanager-db");}}else{return Promise.resolve();}},iResetTestData:function(){var t=this,s=false;return a.create(this).success(function(){t.resetTestData().finally(function(){s=true;}).catch(function(e){throw e;});return a.create(this).check(function(){return s;}).execute();}).description(b.formatMessage("Resetting test data")).execute();},iTearDownMyApp:function(){return a.create(this).do(function(){var w=O.getWindow();S.restoreAll(w);}).do(this.iTeardownMyAppFrame.bind(this)).description("Tearing down my app").execute();},iRestartMyApp:function(){var t=this;return a.create(this).success(function(){var c=O.getWindow().location.hash.substring(1);return t.iTearDownMyApp().and.iStartMyApp(c);}).description("Restarting the app").execute();}});return B;});
