/*
 * ! SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/Device','sap/ui/model/json/JSONModel','sap/ui/core/library','sap/m/library','sap/m/VBox','sap/m/SearchField','sap/m/ToggleButton','sap/m/RadioButton','sap/m/Column','sap/m/Text','sap/m/Bar','sap/m/Table','sap/m/Page','sap/m/OverflowToolbar','sap/m/OverflowToolbarLayoutData','sap/m/Toolbar','sap/m/ToolbarSpacer','sap/m/Button','sap/m/CheckBox','sap/m/Dialog','sap/m/Input','sap/m/Title','sap/m/Label','sap/m/ResponsivePopover','sap/m/SelectList','sap/m/ObjectIdentifier','sap/ui/comp/library','./EditableVariantItem','./VariantItem','sap/ui/core/InvisibleText','sap/ui/core/Control','sap/ui/core/Icon','sap/ui/core/Item','sap/ui/layout/HorizontalLayout','sap/ui/layout/Grid','sap/ui/events/KeyCodes'],function(D,J,c,l,V,S,T,R,C,a,B,b,P,O,d,f,g,h,j,k,I,m,L,n,o,p,q,E,r,s,t,u,v,H,G,K){"use strict";var w=c.VerticalAlign;var x=c.ValueState;var y=l.ButtonType;var z=l.PlacementType;var A=l.PopinDisplay;var F=l.ScreenSize;var M=c.TextAlign;var N=c.TitleLevel;var Q=l.OverflowToolbarPriority;var U=l.FlexAlignItems;var W=t.extend("sap.ui.comp.variants.VariantManagement",{metadata:{interfaces:["sap.m.IOverflowToolbarContent"],library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/variants/VariantManagement.designtime",properties:{initialSelectionKey:{type:"string",group:"Misc",defaultValue:null},enabled:{type:"boolean",group:"Misc",defaultValue:true},defaultVariantKey:{type:"string",group:"Misc",defaultValue:null},selectionKey:{type:"string",group:"Misc",defaultValue:null},showCreateTile:{type:"boolean",group:"Misc",defaultValue:false},showExecuteOnSelection:{type:"boolean",group:"Misc",defaultValue:false},showShare:{type:"boolean",group:"Misc",defaultValue:false},showSetAsDefault:{type:"boolean",group:"Misc",defaultValue:true},lifecycleSupport:{type:"boolean",group:"Misc",defaultValue:false},standardItemText:{type:"string",group:"Misc",defaultValue:null},useFavorites:{type:"boolean",group:"Misc",defaultValue:false},inErrorState:{type:"boolean",group:"Misc",defaultValue:false},variantCreationByUserAllowed:{type:"boolean",group:"Misc",defaultValue:true},standardItemAuthor:{type:"string",group:"Misc",defaultValue:"SAP"}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.core.Item",multiple:true,singularName:"item",deprecated:true},variantItems:{type:"sap.ui.comp.variants.VariantItem",multiple:true,singularName:"variantItem"}},events:{save:{parameters:{name:{type:"string"},overwrite:{type:"boolean"},key:{type:"string"},exe:{type:"boolean"},def:{type:"boolean"},global:{type:"boolean"},lifecyclePackage:{type:"string"},lifecycleTransportId:{type:"string"}}},manage:{parameters:{renamed:{type:"string[]"},deleted:{type:"string[]"},exe:{type:"object[]"},def:{type:"boolean"}}},select:{parameters:{key:{type:"string"}}}}},renderer:function(e,i){e.write("<div ");e.writeControlData(i);e.addClass("sapUiCompVarMngmt");e.writeClasses();var X=i.oResourceBundle.getText("VARIANT_MANAGEMENT_TRIGGER_TT");e.write(" title='"+X+"'");e.write(">");e.renderControl(i.oVariantLayout);e.write("</div>");}});W.STANDARD_NAME=q.STANDARD_VARIANT_NAME;W.MAX_NAME_LEN=100;W.FAV_COLUMN=0;W.NAME_COLUMN=1;W.SHARE_COLUMN=2;W.DEF_COLUMN=3;W.EXEC_COLUMN=4;W.RESTRICT_COLUMN=5;W.AUTHOR_COLUMN=6;W.prototype.init=function(){var e=this;this.STANDARDVARIANTKEY="*standard*";this.setStandardVariantKey(this.STANDARDVARIANTKEY);this.aRemovedVariants=[];this.aRenamedVariants=[];this.aRemovedVariantTransports=[];this.aExeVariants=[];this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this.lastSelectedVariantKey=this._sStandardVariantKey;this.bVariantItemMode=false;this.oSelectedItem=null;this.sNewDefaultKey="";this.bManagementTableInitialized=false;this.sTransport=null;this.sPackage=null;this.aEvents=[];this.bEventRunning=false;this.oVariantSelectionPage=null;this.bManualVariantKey=false;this.bFireSelect=false;this.bExecuteOnSelectForStandardViaXML=false;this.bExecuteOnSelectForStandardByUser=null;this.bSupportExecuteOnSelectOnSandardVariant=false;this._bInnerControlsCreated=false;this._bIndustrialSolutionMode=false;this._bVendorLayer=false;this.oModel=new J({enabled:false,selectedVariant:"",creationAllowed:true,saveVariantVisible:true});this.setModel(this.oModel,"save_enablement");this.oVariantInvisbletext=new s({text:{parts:[{path:'save_enablement>/selectedVariant'},{path:'save_enablement>/enabled'}],formatter:function(i,X){if(X){i=e.oResourceBundle.getText("VARIANT_MANAGEMENT_SEL_VARIANT_MOD",[i]);}else{i=e.oResourceBundle.getText("VARIANT_MANAGEMENT_SEL_VARIANT",[i]);}return i;}}});this.oVariantText=new m(this.getId()+"-text",{text:"{save_enablement>/selectedVariant}"});this._setStandardText();this.oVariantText.addStyleClass("sapUICompVarMngmtClickable");this.oVariantText.addStyleClass("sapUICompVarMngmtTitle");this.oVariantText.addStyleClass("sapMTitleStyleH4");if(D.system.phone){this.oVariantText.addStyleClass("sapUICompVarMngmtTextPhoneMaxWidth");}else{this.oVariantText.addStyleClass("sapUICompVarMngmtTextMaxWidth");}this.oVariantModifiedText=new m(this.getId()+"-modified",{visible:"{save_enablement>/enabled}"});this.oVariantModifiedText.setText("*");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtClickable");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtModified");this.oVariantModifiedText.addStyleClass("sapMTitleStyleH4");this.oVariantPopoverTrigger=new T(this.getId()+"-trigger",{icon:"sap-icon://slim-arrow-down",type:y.Transparent,tooltip:this.oResourceBundle.getText("VARIANT_MANAGEMENT_TRIGGER_TT"),press:function(i){this._oCtrlRef=i.getParameter("pressed")?this.oVariantPopoverTrigger:false;}.bind(this)});this.oVariantPopoverTrigger.addAriaLabelledBy(this.oVariantInvisbletext);this.oVariantPopoverTrigger.addStyleClass("sapUICompVarMngmtTriggerBtn");this.oVariantPopoverTrigger.addStyleClass("sapMTitleStyleH4");this.oVariantLayout=new H({content:[this.oVariantText,this.oVariantModifiedText,this.oVariantPopoverTrigger]});this.oVariantLayout.addStyleClass("sapUICompVarMngmtLayout");this.oVariantInvisbletext.setModel(this.oModel,"save_enablement");this.oVariantInvisbletext.toStatic();this.addDependent(this.oVariantLayout);};W.prototype.getOverflowToolbarConfig=function(){var e={canOverflow:false,invalidationEvents:["save","manage","select"]};return e;};W.prototype._columnVisibilityManagementTable=function(e,i){if(!this.bManagementTableInitialized){return;}if(this.oManagementTable){var X=this.oManagementTable.getColumns();if(X&&X.length>=e){X[e].setVisible(i);}}};W.prototype.setVariantCreationByUserAllowed=function(e){this.setProperty("variantCreationByUserAllowed",e);this.oModel.setProperty("/creationAllowed",e);return this;};W.prototype.setUseFavorites=function(e){this.setProperty("useFavorites",e);this._columnVisibilityManagementTable(W.FAV_COLUMN,e);return this;};W.prototype.setShowShare=function(e){this.setProperty("showShare",e);this._columnVisibilityManagementTable(W.SHARE_COLUMN,e);return this;};W.prototype.setShowSetAsDefault=function(e){this.setProperty("showSetAsDefault",e);this._columnVisibilityManagementTable(W.DEF_COLUMN,e);return this;};W.prototype.setShowExecuteOnSelection=function(e){this.setProperty("showExecuteOnSelection",e);this._columnVisibilityManagementTable(W.EXEC_COLUMN,e);return this;};W.prototype.setStandardItemText=function(e){this.setProperty("standardItemText",e);var i=this._getSelectedItem();if(!i||(i.getKey()===this.getStandardVariantKey())){this.oModel.setProperty("/selectedVariant",e);}return this;};W.prototype._triggerSave=function(){var e=this._createEvent("variantSaveAs",this._handleVariantSaveAs);this._addEvent(e);};W.prototype._checkNameValidity=function(e,i){var X=false;if(i&&this._getVariantNamesAndKeys){var Y=this._getVariantNamesAndKeys();var Z=i.getItems();Z.forEach(function($){var _=$.getCells()[W.NAME_COLUMN];var a1=$.getKey();if(_.getValue&&Y.hasOwnProperty(_.getValue())&&(Y[_.getValue()]!==a1)){_.setValueState(x.Error);_.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_DUPLICATE"));X=true;}}.bind(this));}return X;};W.prototype._checkVariantNameConstraints=function(i,e){var X;if(!i){return;}X=i.getValue().trim();if(!this._checkIsDuplicate(i,X,this.oManagementTable)){if(X===""){i.setValueState(x.Error);i.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"));}else if(X.indexOf('{')>-1){i.setValueState(x.Error);i.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_NOT_ALLOWED_CHAR",["{"]));}else if(X.length>W.MAX_NAME_LEN){i.setValueState(x.Error);i.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_MAX_LEN",[W.MAX_NAME_LEN]));}else{i.setValueState(x.None);i.setValueStateText(null);}}if(i.getValueState()!==x.Error){this._checkIsDuplicate(i,X,e);}if(e&&this._getVariantNamesAndKeys){this._checkNameValidity(X,e);}};W.prototype._anyItemInErrorState=function(){var e,X,i;if(this.oManagementTable){e=this.oManagementTable.getItems();if(e){for(i=0;i<e.length;i++){X=e[i].getCells()[W.NAME_COLUMN];if(X&&X.getValueState&&(X.getValueState()===x.Error)){this._checkVariantNameConstraints(X,this.oManagementTable);if(X.getValueState()===x.Error){return true;}}}for(i=0;i<e.length;i++){X=e[i].getCells()[W.NAME_COLUMN];if(X&&X.isA("sap.m.Input")){this._checkVariantNameConstraints(X,this.oManagementTable);if(X.getValueState()===x.Error){return true;}}}}}return false;};W.prototype._anyInErrorState=function(e,X){var Y,Z,i;if(e){Y=e.getItems();if(Y){for(i=0;i<Y.length;i++){Z=Y[i].getCells()[W.NAME_COLUMN];if(X&&(X===Z)){continue;}if(Z&&Z.getValueState&&(Z.getValueState()===x.Error)){if(this._checkIsDuplicate(Z,Z.getValue(),e)){return true;}}}}}return false;};W.prototype._checkIsDuplicate=function(i,e,X){var Y=this._isDuplicate(i,e,X);if(Y){i.setValueState(x.Error);i.setValueStateText(this.oResourceBundle.getText(e?"VARIANT_MANAGEMENT_ERROR_DUPLICATE":"VARIANT_MANAGEMENT_ERROR_EMPTY"));}else{i.setValueState(x.None);i.setValueStateText(null);}return Y;};W.prototype._isDuplicate=function(i,e,X){if(X){return this._isDuplicateManaged(i,e,X);}else{return this._isDuplicateSaveAs(e);}};W.prototype._isDuplicateManaged=function(e,X,Y){var Z,$,i;if(Y){Z=Y.getItems();if(Z&&(Z.length>0)){for(i=0;i<Z.length;i++){$=Z[i].getCells()[W.NAME_COLUMN];if($===e){continue;}if($){if($.getValue&&(X===$.getValue().trim())){return true;}else if($.getText&&(X===$.getText().trim())){return true;}else if($.getTitle&&(X===$.getTitle().trim())){return true;}}}}else{if(this._isIndustrySolutionModeAndVendorLayer()&&this.bManualVariantKey){return false;}}}return false;};W.prototype._isDuplicateSaveAs=function(e){var i=e.trim();if(!i){return true;}var X=this._determineStandardVariantName();if(X===i){if(this._isIndustrySolutionModeAndVendorLayer()&&this.bManualVariantKey){return false;}return true;}var Y=this._getItems();for(var Z=0;Z<Y.length;Z++){X=Y[Z].getText().trim();if(X===i){return true;}}return false;};W.prototype._createSaveDialog=function(){var e=this;if(!this.oSaveDialog){this.oSaveDialog=new k(this.getId()+"-savedialog",{title:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVEDIALOG"),beginButton:this.oSaveSave,endButton:new h(this.getId()+"-variantcancel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_CANCEL"),press:function(){if(e._fGetDataForKeyUser){e._handleSaveAsCancelPressedForKeyUser();}else{e._bSaveCanceled=true;e.oSaveDialog.close();}}}),content:[this.oLabelName,this.oInputName,this.oLabelKey,this.oInputKey,this.oSaveDialogOptionsGrid],stretch:D.system.phone});this.oSaveDialog.setParent(this);this.oSaveDialog.addStyleClass("sapUiContentPadding");this.oSaveDialog.addStyleClass("sapUiCompVarMngmtSaveDialog");}};W.prototype._createManagementDialog=function(){var e=this;if(!this.oManagementDialog){this.oManagementDialog=new k(this.getId()+"-managementdialog",{contentWidth:"64%",draggable:true,resizable:true,title:this.oResourceBundle.getText("VARIANT_MANAGEMENT_MANAGEDIALOG"),beginButton:this.oManagementSave,endButton:new h(this.getId()+"-managementcancel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_CANCEL"),press:function(){if(e._fGetDataForKeyUser){e._handleManageCancelPressedForKeyUser();}else{e.aRemovedVariants=[];e.oManagementDialog.close();}}}),content:[this.oManagementTable],stretch:D.system.phone,afterClose:function(){if(e.bFireSelect==true){e.bFireSelect=false;e._fireSelectAsync();}}});this.oManagementDialog.setParent(this);var i=new B();this.oManageDialogSearchField=new S();this.oManageDialogSearchField.attachLiveChange(function(X){this._triggerSearchInManageDialog(X);}.bind(this));i.addContentMiddle(this.oManageDialogSearchField);this.oManagementDialog.setSubHeader(i);}};W.prototype._handleArrowUpDown=function(i,X){var Y=null;var Z=this;i.attachBrowserEvent("keydown",function(e){if(e.which===38){if(Z.oVariantSelectionPage.getShowSubHeader()){Y=document.activeElement.id;}}});i.attachBrowserEvent("keyup",function(e){if(e.which===38){if(Y&&(Y===document.activeElement.id)){var $=i.getItems();if($&&$.length>0){var _=sap.ui.getCore().byId(Y);if(_===$[0]){X.focus();}}}Y=null;}});X.attachBrowserEvent("keyup",function(e){if(e.which===40){var $=i.getItems();if($&&$.length>0){$[0].focus();}}});};W.prototype._triggerSearch=function(e){if(!e){return;}var i=e.getParameters();if(!i){return;}this._restoreCompleteList();var X=i.newValue?i.newValue:"";this._triggerSearchByValue(X.toLowerCase());};W.prototype._triggerSearchByValue=function(e){var i,X,Y;this.oSelectedVariantItemKey=null;Y=this.oVariantList.getItemByKey(this.getStandardVariantKey());if(Y&&(Y.getText().toLowerCase().indexOf(e)<0)){if(this.getSelectionKey()===X){this.oSelectedVariantItemKey=X;}this.oVariantList.removeItem(Y);Y.destroy();}var Z=this._getItems();for(var $=0;$<Z.length;$++){i=Z[$].getText();if(i.toLowerCase().indexOf(e)<0){X=Z[$].getKey();Y=this.oVariantList.getItemByKey(X);if(Y){if(this.getSelectionKey()===X){this.oSelectedVariantItemKey=X;}this.oVariantList.removeItem(Y);Y.destroy();}}}};W.prototype._triggerSearchInManageDialog=function(e){var i,X,Y="",Z,$;if(!e){return;}var _=e.getParameters();if(!_){return;}i=_.newValue?_.newValue.toLowerCase():"";if(this.oManagementTable){var a1=this.oManagementTable.getItems();a1.forEach(function(b1){X=true;Y="";$=b1.getCells();if($&&$[W.NAME_COLUMN]){Z=$[W.NAME_COLUMN];if(Z.getTitle){Y=Z.getTitle();}else if(Z.getValue){Y=Z.getValue();}if(Y.toLowerCase().indexOf(i)>=0){X=false;}}if(X&&$&&$[W.AUTHOR_COLUMN]){Z=$[W.AUTHOR_COLUMN];if(Z.getText){Y=Z.getText();if(Y.toLowerCase().indexOf(i)>=0){X=false;}}}b1.setVisible(!X);});}};W.prototype._considerItem=function(i,e){if(this.getUseFavorites()&&!i){if(this._isIndustrySolutionModeAndVendorLayer()){return true;}if(e.getFavorite&&e.getFavorite()){return true;}return false;}return true;};W.prototype._restoreCompleteList=function(i){var e,X,Y,Z;this.oVariantList.destroyItems();Z=this.oVariantList.getItemByKey(this.getStandardVariantKey());if(!Z){Z=this._createStandardVariantListItem();if(Z){if(this._considerItem(i,Z)){this.oVariantList.insertItem(Z,0);}else{Z.destroy();}}}if(Z){if(this.oSelectedVariantItemKey){if(this.oSelectedVariantItemKey===Z.getKey()){this.oVariantList.setSelectedItem(Z);this.oSelectedVariantItemKey=null;}}else{if(this.getSelectionKey()==Z.getKey()||this.getSelectionKey()===null){this.oVariantList.setSelectedItem(Z);}}}Y=this._getItems();Y.sort(this._compareItems);for(e=0;e<Y.length;e++){X=Y[e];if(!this._considerItem(i,X)){continue;}if(X.getKey()===this.getStandardVariantKey()){continue;}Z=this.oVariantList.getItemByKey(X.getKey());if(!Z){Z=this._createVariantListItem(X,e);this.oVariantList.addItem(Z);}if(this.oSelectedVariantItemKey){if(this.oSelectedVariantItemKey===Z.getKey()){this.oVariantList.setSelectedItem(Z);this.oSelectedVariantItemKey=null;}}else{if(this.getSelectionKey()==Z.getKey()){this.oVariantList.setSelectedItem(Z);}}}};W.prototype._determineStandardVariantName=function(){var e=this.oResourceBundle.getText("VARIANT_MANAGEMENT_STANDARD");if(this.bVariantItemMode===false){e=this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT");}if(this.getStandardVariantKey()===this.STANDARDVARIANTKEY){if(this.getStandardItemText()!==null&&this.getStandardItemText()!=""){e=this.getStandardItemText();}}return e;};W.prototype._createStandardVariantListItem=function(){var i,e=null;var X=this._determineStandardVariantName();if((this.bVariantItemMode===true)||(this.bVariantItemMode===false&&(this.getSelectionKey()===this.getStandardVariantKey()||this.getSelectionKey()===null))){e=new r(this.oVariantPopoverTrigger.getId()+"-item-standard",{key:this.getStandardVariantKey(),readOnly:true,executeOnSelection:this.getExecuteOnSelectForStandardVariant()});e.setText(X);if(this._isIndustrySolutionModeAndVendorLayer()&&this.bVariantItemMode){e.setGlobal(true);e.setReadOnly(false);}if(this.getStandardVariantKey()!==this.STANDARDVARIANTKEY){i=this.getItemByKey(this.getStandardVariantKey());if(i){this._setVariantListItemProperties(i,e);if(i.getFavorite&&!i.getFavorite()&&(this.getSelectionKey()===this.getStandardVariantKey())){e.setFavorite(true);}}}else{e.setAuthor(this.getStandardItemAuthor());e.setReadOnly(true);e.setFavorite(this.getStandardFavorite());}}return e;};W.prototype._createVariantListItem=function(i,e){var X=new r(this.oVariantPopoverTrigger.getId()+"-item-"+e,{key:i.getKey(),text:i.getText()});this._setVariantListItemProperties(i,X);return X;};W.prototype._setVariantListItemProperties=function(i,e){if(i.getReadOnly){e.setReadOnly(i.getReadOnly());}if(i.getExecuteOnSelection){e.setExecuteOnSelection(i.getExecuteOnSelection());}if(i.getGlobal){e.setGlobal(i.getGlobal());}if(i.getLifecyclePackage){e.setLifecyclePackage(i.getLifecyclePackage());}if(i.getLifecycleTransportId){e.setLifecycleTransportId(i.getLifecycleTransportId());}if(i.getNamespace){e.setNamespace(i.getNamespace());}if(i.getAccessOptions){e.setAccessOptions(i.getAccessOptions());}if(i.getLabelReadOnly){e.setLabelReadOnly(i.getLabelReadOnly());}if(i.getAuthor){e.setAuthor(i.getAuthor());}if(i.getFavorite){e.setFavorite(i.getFavorite());}if(i.getContexts){e.setContexts(i.getContexts());}};W.prototype.exit=function(){if(this.oVariantInvisbletext){this.oVariantInvisbletext.destroy(true);this.oVariantInvisbletext=undefined;}if(this.oSearchField){this.oSearchField.destroy();this.oSearchField=undefined;}if(this.oManageDialogSearchField){this.oManageDialogSearchField.destroy();this.oManageDialogSearchField=undefined;}if(this.oVariantManage){this.oVariantManage.destroy();this.oVariantManage=undefined;}if(this.oVariantSave){this.oVariantSave.destroy();this.oVariantSave=undefined;}if(this.oVariantList){this.oVariantList.destroy();this.oVariantList=undefined;}if(this.oInputName){this.oInputName.destroy();this.oInputName=undefined;}if(this.oLabelName){this.oLabelName.destroy();this.oLabelName=undefined;}if(this.oDefault){this.oDefault.destroy();this.oDefault=undefined;}if(this.oSaveSave){this.oSaveSave.destroy();this.oSaveSave=undefined;}if(this.oSaveDialog){this.oSaveDialog.destroy();this.oSaveDialog=undefined;}if(this.oManagementTable){this.oManagementTable.destroy();this.oManagementTable=undefined;}if(this.oManagementSave){this.oManagementSave.destroy();this.oManagementSave=undefined;}if(this.oManagementDialog){this.oManagementDialog.destroy();this.oManagementDialog=undefined;}if(this.oVariantText){this.oVariantText.destroy();this.oVariantText=undefined;}if(this.oVariantPopoverTrigger){this.oVariantPopoverTrigger.destroy();this.oVariantPopoverTrigger=undefined;}if(this.oVariantLayout){this.oVariantLayout.destroy();this.oVariantLayout=undefined;}if(this.oVariantPopOver){this.oVariantPopOver.destroy();this.oVariantPopOver=undefined;}if(this.oVariantSaveAs){this.oVariantSaveAs.destroy();this.oVariantSaveAs=undefined;}if(this.oShare){this.oShare.destroy();this.oShare=undefined;}if(this.oExecuteOnSelect){this.oExecuteOnSelect.destroy();this.oExecuteOnSelect=undefined;}if(this.oCreateTile){this.oCreateTile.destroy();this.oCreateTile=undefined;}if(this.oSaveDialogOptionsGrid){this.oSaveDialogOptionsGrid.destroy();this.oSaveDialogOptionsGrid=undefined;}if(this.oVariantSelectionPage){this.oVariantSelectionPage.destroy();this.oVariantSelectionPage=undefined;}if(this.oErrorVariantPopOver){this.oErrorVariantPopOver.destroy();this.oErrorVariantPopOver=undefined;}if(this.oInputKey){this.oInputKey.destroy();this.oInputKey=undefined;}if(this.oLabelKey){this.oLabelKey.destroy();this.oLabelKey=undefined;}if(this.oModel){this.oModel.destroy();this.oModel=undefined;}};W.prototype.addItem=function(i){i=this.validateAggregation("items",i,true);this.bVariantItemMode=false;this.addAggregation("items",i,false);var _=this.getInitialSelectionKey();this._setSelection(i,_);this._setStandardText();return this;};W.prototype.insertItem=function(i,e){var _=e;i=this.validateAggregation("items",i,true);this.bVariantItemMode=false;this.insertAggregation("items",i,_);var X=this.getInitialSelectionKey();this._setSelection(i,X);this._setStandardText();return this;};W.prototype.removeItem=function(i){i=this.removeAggregation("items",i);return i;};W.prototype.removeAllItems=function(){var e=this.removeAllAggregation("items");this._setSelectedItem(null);return e;};W.prototype.destroyItems=function(){this.destroyAggregation("items");this._setSelectedItem(null);return this;};W.prototype._getItems=function(){if(this.bVariantItemMode){return this.getVariantItems();}else{return this.getItems();}};W.prototype._removeItem=function(i){if(this.bVariantItemMode){return this.removeVariantItem(i);}else{return this.removeItem(i);}};W.prototype.getItemByKey=function(e){var i=this._getItems();for(var X=0;X<i.length;X++){if(e==i[X].getKey()){return i[X];}}return null;};W.prototype.addVariantItem=function(e){e=this.validateAggregation("variantItems",e,true);this.bVariantItemMode=true;this.addAggregation("variantItems",e,false);var _=this.getInitialSelectionKey();this._setSelection(e,_);this._setStandardText();e.attachChange(this._variantItemChange.bind(this,null));return this;};W.prototype.insertVariantItem=function(e,i){var _=i;e=this.validateAggregation("variantItems",e,true);this.bVariantItemMode=true;this.insertAggregation("variantItems",e,_);var X=this.getInitialSelectionKey();this._setSelection(e,X);this._setStandardText();e.attachChange(this._variantItemChange.bind(this,null));return this;};W.prototype._variantItemChange=function(e,i){var X;if(i&&i.oSource&&(i.oSource.isA("sap.ui.comp.variants.VariantItem"))){X=i.getParameter("propertyName");if(X==="text"){if(i.oSource===this._getSelectedItem()){this.oModel.setProperty("/selectedVariant",this._getSelectedItem().getText());}}}};W.prototype._setSelectedItem=function(i){this.oSelectedItem=i;if(i!=null&&i.getKey()!=this.getStandardVariantKey()){this._setVariantText(i.getText());}else{this._setStandardText();}};W.prototype._getSelectedItem=function(){return this.oSelectedItem;};W.prototype.setInitialSelectionKey=function(e){this.setProperty("initialSelectionKey",e,true);this._setSelectionByKey(e);return this;};W.prototype.setEnabled=function(e){this.setProperty("enabled",e,false);if(!e){this.oVariantText.removeStyleClass("sapUICompVarMngmtClickable");this.oVariantModifiedText.removeStyleClass("sapUICompVarMngmtClickable");this.oVariantText.addStyleClass("sapUICompVarMngmtDisabled");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtDisabled");}else{this.oVariantText.removeStyleClass("sapUICompVarMngmtDisabled");this.oVariantModifiedText.removeStyleClass("sapUICompVarMngmtDisabled");this.oVariantText.addStyleClass("sapUICompVarMngmtClickable");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtClickable");}return this;};W.prototype.getFocusDomRef=function(){if(this.oVariantPopoverTrigger&&this.getEnabled()){return this.oVariantPopoverTrigger.getFocusDomRef();}};W.prototype._setSelection=function(i,e){if(i.getKey()===e){this._setSelectedItem(i);this.fireSelect({key:e});}};W.prototype.addStyleClass=function(e){if(t.prototype.addStyleClass){t.prototype.addStyleClass.apply(this,arguments);}if(this.oVariantPopOver){this.oVariantPopOver.addStyleClass(e);}if(this.oSaveDialog){this.oSaveDialog.addStyleClass(e);}if(this.oManagementDialog){this.oManagementDialog.addStyleClass(e);}};W.prototype.removeStyleClass=function(e){if(t.prototype.addStyleClass){t.prototype.removeStyleClass.apply(this,arguments);}if(this.oVariantPopOver){this.oVariantPopOver.removeStyleClass(e);}if(this.oSaveDialog){this.oSaveDialog.removeStyleClass(e);}if(this.oManagementDialog){this.oManagementDialog.removeStyleClass(e);}};W.prototype.clearVariantSelection=function(){this.setInitialSelectionKey(this.getStandardVariantKey());this._setSelectedItem(null);};W.prototype._setDialogCompactStyle=function(e,i){if(this._checkDialogCompactStyle(e)){i.addStyleClass("sapUiSizeCompact");}else{i.removeStyleClass("sapUiSizeCompact");}};W.prototype._checkDialogCompactStyle=function(e){if(e.$().closest(".sapUiSizeCompact").length>0){return true;}else{return false;}};W.prototype.getSelectionKey=function(){var e=null;var i=this._getSelectedItem();if(i!==null){e=i.getKey();}else if(this.bVariantItemMode){e=this.getStandardVariantKey();}else{e=null;}return e;};W.prototype._setSelectionByKey=function(e){var i=this._getItems();var X=false;if(i.length>0){for(var Y=0;Y<i.length;Y++){if(i[Y].getKey()===e){this._setSelectedItem(i[Y]);X=true;break;}}}if(!X){this._setSelectedItem(null);}};W.prototype.replaceKey=function(e,i){var X=this._getItems();if(X.length>0){for(var Y=0;Y<X.length;Y++){if(X[Y].getKey()===e){X[Y].setKey(i);if(this.getDefaultVariantKey()==e){this.setDefaultVariantKey(i);}if(this._getSelectedItem()===X[Y]){this._setSelectedItem(null);}break;}}}};W.prototype.verifyVariantKey=function(e){return this.getItemByKey(e)?true:false;};W.prototype.createVariantEntry=function(e){var i="SV"+new Date().getTime();var X=new r({key:i,text:e.name,global:e.global});this.addAggregation("variantItems",X,false);return i;};W.prototype._assignUser=function(e,i){var X=this._getItems();if(X.length>0){for(var Y=0;Y<X.length;Y++){if(X[Y].getKey()===e){if(X[Y].setAuthor&&X[Y].getAuthor&&!X[Y].getAuthor()){X[Y].setAuthor(i);}break;}}}};W.prototype.currentVariantSetModified=function(e){if(this.oModel){this.oModel.setProperty("/enabled",e);}};W.prototype.currentVariantGetModified=function(){return this.oModel.getProperty("/enabled");};W.prototype._delayedControlCreation=function(){var e=this;if(this._bInnerControlsCreated){return;}this._bInnerControlsCreated=true;this.oVariantManage=new h(this.getId()+"-manage",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_MANAGE"),enabled:true,press:function(){e._openVariantManagementDialog();},layoutData:new d({priority:Q.High})});this.oVariantSave=new h(this.getId()+"-mainsave",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVE"),press:function(){var i=e._createEvent("variantSavePressed",e._variantSavePressed);e._addEvent(i);},visible:{parts:[{path:'save_enablement>/creationAllowed'},{path:'save_enablement>/saveVariantVisible'}],formatter:function(i,X){return i&&X;}},type:y.Emphasized,layoutData:new d({priority:Q.Low})});this.oVariantSave.setModel(this.oModel);this.oVariantSaveAs=new h(this.getId()+"-saveas",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVEAS"),press:function(){e._openSaveAsDialog();},visible:"{save_enablement>/creationAllowed}",layoutData:new d({priority:Q.Low})});this.oVariantList=new o(this.getId()+"-list",{itemPress:function(i){var X=null;if(i&&i.getParameters()){var Y=i.getParameters().item;if(Y){X=Y.getKey();}}if(X){e.lastSelectedVariantKey=X;e._setSelectionByKey(X);e.oVariantPopOver.close();e.oModel.setProperty("/enabled",false);e.bFireSelect=true;}}});this.oVariantList.setNoDataText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_NODATA"));this.oSearchField=new S();this.oSearchField.attachLiveChange(function(i){e._triggerSearch(i);});this._handleArrowUpDown(this.oVariantList,this.oSearchField);this.oVariantSelectionPage=new P(this.getId()+"selpage",{subHeader:new f({content:[this.oSearchField]}),content:[this.oVariantList],footer:new O({content:[new g(this.getId()+"-spacer"),this.oVariantSave,this.oVariantSaveAs,this.oVariantManage]}),showSubHeader:false,showNavButton:false,showHeader:false});this.oVariantPopOver=new n(this.getId()+"-popover",{title:this.oResourceBundle.getText("VARIANT_MANAGEMENT_VARIANTS"),titleAlignment:"Auto",contentWidth:"400px",placement:z.VerticalPreferredBottom,content:[this.oVariantSelectionPage],afterOpen:function(){e.bPopoverOpen=true;e.oVariantPopoverTrigger.setPressed(true);e._markSharedVariants();},afterClose:function(){e.oVariantPopoverTrigger.setPressed(false);if(e.bPopoverOpen){if(e.bFireSelect==true){e.bFireSelect=false;e._fireSelectAsync();}setTimeout(function(){e.bPopoverOpen=false;},200);}},contentHeight:"300px"});this.oVariantPopOver.setParent(this);this.oVariantPopOver.addStyleClass("sapUICompVarMngmtPopover");this.oInputName=new I(this.getId()+"-name",{liveChange:function(i){e._checkVariantNameConstraints(this);}});this.oLabelName=new L(this.getId()+"-namelabel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_NAME")});this.oLabelName.setLabelFor(this.oInputName);this.oLabelName.addStyleClass("sapUiCompVarMngmtSaveDialogLabel");this.oDefault=new j(this.getId()+"-default",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SETASDEFAULT"),enabled:true,visible:true,width:"100%"});this.oExecuteOnSelect=new j(this.getId()+"-execute",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_EXECUTEONSELECT"),enabled:true,visible:false,width:"100%"});this.oCreateTile=new j(this.getId()+"-tile",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_CREATETILE"),enabled:true,visible:false,width:"100%"});this.oShare=new j(this.getId()+"-share",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SHARE"),enabled:true,visible:false,select:function(i){var X=e._createEvent("inputfieldChange",e._handleShareSelected);X.args.push(i);e._addEvent(X);},width:"100%"});this.oInputKey=new I(this.getId()+"-key",{liveChange:function(i){e._checkVariantNameConstraints(this);}});this.oLabelKey=new L(this.getId()+"-keylabel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_KEY"),required:true});this.oLabelKey.setLabelFor(this.oInputKey);this.oSaveSave=new h(this.getId()+"-variantsave",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVE"),type:y.Emphasized,press:function(){e._checkVariantNameConstraints(e.oInputName);if(e.oInputName.getValueState()==="Error"){return;}e._bSaveCanceled=false;if(e._fGetDataForKeyUser){e._handleSaveAsPressedForKeyUser();}else{e._triggerSave();}},enabled:true});this.oSaveDialogOptionsGrid=new G({defaultSpan:"L12 M12 S12"});this.oManagementTable=new b(this.getId()+"-managementTable",{contextualWidth:"Auto"});this.oManagementSave=new h(this.getId()+"-managementsave",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVE"),enabled:true,type:y.Emphasized,press:function(){this._saveFromManagementDialog();}.bind(this)});};W.prototype._saveFromManagementDialog=function(){if(this._anyItemInErrorState()){return;}if(!this._fGetDataForKeyUser){var e=this._createEvent("managementSave",this._handleManageSavePressed);this._addEvent(e);}else{this._handleManageSavePressedForKeyUser();}};W.prototype._openInErrorState=function(){var i=this,X;if(!this.oErrorVariantPopOver){X=new V({fitContainer:true,alignItems:U.Center,items:[new u({size:"4rem",color:"lightgray",src:"sap-icon://message-error"}),new m({titleStyle:N.H2,text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_TEXT1")}),new a({textAlign:M.Center,text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_TEXT2")})]});X.addStyleClass("sapUICompVarMngmtErrorPopover");this.oErrorVariantPopOver=new n(this.getId()+"-errorpopover",{title:this.oResourceBundle.getText("VARIANT_MANAGEMENT_VARIANTS"),contentWidth:"400px",placement:z.VerticalPreferredBottom,content:[new P(this.getId()+"-errorselpage",{showSubHeader:false,showNavButton:false,showHeader:false,content:[X]})],afterOpen:function(){i.bPopoverOpen=true;},afterClose:function(){if(i.bPopoverOpen){i.bPopoverOpen=false;}},contentHeight:"300px"});this.oErrorVariantPopOver.attachBrowserEvent("keyup",function(e){if(e.which===32){this.oErrorVariantPopOver.close();}}.bind(this));}if(this.bPopoverOpen){return;}this.oErrorVariantPopOver.openBy(this.oVariantLayout);};W.prototype.showSaveButton=function(e){if(e){this.oVariantSaveAs.setType(y.Default);}else{this.oVariantSaveAs.setType(y.Emphasized);}this.oModel.setProperty("/saveVariantVisible",e);};W.prototype._openVariantSelection=function(){var i=null,e;if(this.getInErrorState()){this._openInErrorState();return;}this._delayedControlCreation();if(this.bPopoverOpen){return;}if(this.bVariantItemMode===false&&this.getSelectionKey()!==null){this.showSaveButton(true);}else{this.showSaveButton(false);}i=this._getItems();if(i.length<9){this.oVariantSelectionPage.setShowSubHeader(false);}else{this.oVariantSelectionPage.setShowSubHeader(true);this.oSearchField.setValue("");}this._restoreCompleteList();if(this.currentVariantGetModified()){e=this.oVariantList.getItemByKey(this.getSelectionKey());if(e){if(!e.getReadOnly()||(this._isIndustrySolutionModeAndVendorLayer()&&(this.getStandardVariantKey()===e.getKey()))){this.showSaveButton(true);}}}if(this._isIndustrySolutionModeAndVendorLayer()&&this.bManualVariantKey&&(this.getStandardVariantKey()===this.STANDARDVARIANTKEY)){this.showSaveButton(false);}this._setDialogCompactStyle(this,this.oVariantPopOver);e=this.oVariantList.getSelectedItem();if(e){this.oVariantPopOver.setInitialFocus(e.getId());}var X=this._oCtrlRef?this._oCtrlRef:this.oVariantLayout;this._oCtrlRef=null;this.oVariantPopOver.openBy(X);};W.prototype.handleOpenCloseVariantPopover=function(){if(this.oVariantPopOver&&this.oVariantPopOver.isOpen()){this.oVariantPopOver.close();}else if(!this.bPopoverOpen){this._openVariantSelection();}else if(this.getInErrorState()&&this.oErrorVariantPopOver&&this.oErrorVariantPopOver.isOpen()){this.oErrorVariantPopOver.close();}};W.prototype._initalizeManagementTableColumns=function(){if(this.bManagementTableInitialized){return;}this.oManagementTable.addColumn(new C({width:"3rem",visible:this.getUseFavorites()&&!this._isIndustrySolutionModeAndVendorLayer()}));this.oManagementTable.addColumn(new C({header:new a({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_NAME")}),width:"14rem"}));this.oManagementTable.addColumn(new C({header:new a({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_VARIANTTYPE")}),demandPopin:true,popinDisplay:A.Inline,minScreenWidth:F.Tablet,visible:this.getShowShare()}));this.oManagementTable.addColumn(new C({header:new a({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT"),wrappingType:"Hyphenated"}),hAlign:M.Center,demandPopin:true,popinDisplay:A.Block,minScreenWidth:F.Tablet,visible:this.getShowSetAsDefault()}));this.oManagementTable.addColumn(new C({header:new a({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_EXECUTEONSELECT"),wrappingType:"Hyphenated"}),hAlign:M.Center,demandPopin:true,popinDisplay:A.Block,minScreenWidth:F.Tablet,visible:this.getShowExecuteOnSelection()}));this.oManagementTable.addColumn(new C({header:new a({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_VISIBILITY")}),width:"8rem",demandPopin:true,popinDisplay:A.Inline,minScreenWidth:F.Tablet,visible:false}));this.oManagementTable.addColumn(new C({header:new a({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_AUTHOR")}),demandPopin:true,popinDisplay:A.Block,minScreenWidth:F.Tablet}));this.oManagementTable.addColumn(new C({hAlign:M.Center}));this.bManagementTableInitialized=true;};W.prototype._initalizeSaveAsDialog=function(){this.oSaveDialogOptionsGrid.removeAllContent();this.oDefault.setVisible(this.getShowSetAsDefault());this.oShare.setVisible(this.getShowShare());this.oExecuteOnSelect.setVisible(this.getShowExecuteOnSelection());this.oCreateTile.setVisible(this.getShowCreateTile());if(this.getShowSetAsDefault()){this.oSaveDialogOptionsGrid.addContent(this.oDefault);}if(this.getShowShare()){this.oSaveDialogOptionsGrid.addContent(this.oShare);}if(this.getShowExecuteOnSelection()){this.oSaveDialogOptionsGrid.addContent(this.oExecuteOnSelect);}if(this.getShowCreateTile()){this.oSaveDialogOptionsGrid.addContent(this.oCreateTile);}};W.prototype.ontap=function(e){if(this.getEnabled()){if(this.oVariantPopoverTrigger&&!this.bPopoverOpen){this.oVariantPopoverTrigger.focus();}this.handleOpenCloseVariantPopover();}};W.prototype.onkeyup=function(e){if(e.which===K.F4||e.which===K.SPACE||e.altKey===true&&e.which===K.ARROW_UP||e.altKey===true&&e.which===K.ARROW_DOWN){if(this.getEnabled()){this._openVariantSelection();}}};W.prototype.onAfterRendering=function(){this.oVariantText.$().off("mouseover").on("mouseover",function(){this.oVariantPopoverTrigger.addStyleClass("sapUICompVarMngmtTriggerBtnHover");}.bind(this));this.oVariantText.$().off("mouseout").on("mouseout",function(){this.oVariantPopoverTrigger.removeStyleClass("sapUICompVarMngmtTriggerBtnHover");}.bind(this));};W.prototype.onBeforeRendering=function(){var e=function(X){var a1,b1=0;for(var i=0;i<X.length;i++){a1=X[i].$().width();if(a1>b1){b1=a1;}}return b1;};if(this.oSaveDialogOptionsGrid&&this.oSaveDialog&&this.oSaveDialog.getVisible()){var X=this.oSaveDialogOptionsGrid.getContent();if(X&&X.length>0){var Y=this.oSaveDialogOptionsGrid.$().width();var Z=e(X);var $=32;var _=12;if(!this._checkDialogCompactStyle(this.oSaveDialog)){$=48;_=18;}if(($+Z+_)>Y/2){this.oSaveDialogOptionsGrid.setDefaultSpan("L12 M12 S12");}}}};W.prototype._markSharedVariants=function(){var e,X,Y=this._getItems();for(var i=0;i<Y.length;i++){X=Y[i];if(X.getGlobal&&X.getGlobal()){e=this.oVariantList.getItemByKey(X.getKey());if(e){var Z=e.$();if(Z){Z.addClass("sapUiCompVarMngmtSharedVariant");}}}}};W.prototype._variantSavePressed=function(){var i=this._getSelectedItem();if(!i){if(this.getStandardVariantKey()===this.STANDARDVARIANTKEY){i=new r({key:this.STANDARDVARIANTKEY,global:this._isIndustrySolutionModeAndVendorLayer()});i.setText(this._determineStandardVariantName());}else{i=this.getItemByKey(this.getStandardVariantKey());}}var e=false;if(this.getDefaultVariantKey()===i.getKey()){e=true;}if(i.getLifecyclePackage&&i.getGlobal()==true){var X=this;var Y=function($,_){X.oVariantPopOver.close();X.sPackage=$;X.sTransport=_;X.fireSave({name:i.getText(),overwrite:true,key:i.getKey(),def:e,global:(X._isIndustrySolutionModeAndVendorLayer()&&(X.getStandardVariantKey()===X.getStandardVariantKey())),lifecyclePackage:X.sPackage,lifecycleTransportId:X.sTransport});i.setLifecycleTransportId(X.sTransport);X.oModel.setProperty("/enabled",false);X._eventDone();};var Z=function($){X.sTransport=null;X.sPackage=null;X._cancelAllEvents();};this._assignTransport(i,Y,Z,this.oVariantText);}else{this.oVariantPopOver.close();this.fireSave({name:i.getText(),overwrite:true,key:i.getKey(),def:e});this.oModel.setProperty("/enabled",false);this._eventDone();}};W.prototype._assignTransport=function(e,i,X,Y){var Z={type:"variant",name:"",namespace:""};Z["package"]="";if(e!==null){Z["package"]=e.getLifecyclePackage();Z["name"]=e.getKey();Z["namespace"]=e.getNamespace();}var _=function(b1){var c1;var a1;a1=b1.getParameters().selectedTransport;c1=b1.getParameters().selectedPackage;i(c1,a1);};var $=function(b1){X(b1);};if(this.getLifecycleSupport()){var a1=null;if(e){a1=e.getLifecycleTransportId();}if(a1!=null&&a1.trim().length>0){i(Z["package"],a1);}else{this._getTransportSelection().then(function(b1){b1.selectTransport(Z,_,$,this._checkDialogCompactStyle(Y),Y);}.bind(this));}}else{i(Z["package"],"");}};W.prototype._getTransportSelection=function(){if(this.getTransportSelection){return this.getTransportSelection();}else{return this._getFlTransportSelection();}};W.prototype._getFlTransportSelection=function(){return sap.ui.getCore().loadLibrary('sap.ui.fl',{async:true}).then(function(){return new Promise(function(e){sap.ui.require(["sap/ui/fl/write/api/SmartVariantManagementWriteAPI"],function(i){e(i._getTransportSelection());});});});};W.prototype.getDefaultVariantKey=function(){var e=this.getProperty("defaultVariantKey");if(e===""){if(this.bVariantItemMode){e=this.getStandardVariantKey();}}return e;};W.prototype._compareItems=function(e,i){var X=e.getText();var Y=i.getText();var Z=X.toUpperCase();var $=Y.toUpperCase();if(Z==$){if(X==Y){return 0;}if(X<Y){return-1;}if(X>Y){return 1;}}if(Z<$){return-1;}if(Z>$){return 1;}};W.prototype._accessOptionsText=function(e){var i=null;switch(e){case"R":i=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LAYER");break;case"RD":i=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LANGUAGE");break;default:i=null;}return i;};W.prototype._openSaveAsDialog=function(){this._initSaveAsDialog();this.oSaveDialog.open();};W.prototype._initSaveAsDialog=function(){this._initalizeSaveAsDialog();this.oInputName.setValue(this.oModel.getProperty("/selectedVariant"));this.oInputName.setEnabled(true);this.oInputName.setValueState(x.None);this.oInputName.setValueStateText(null);this.oDefault.setSelected(false);this.oShare.setSelected(false);this.oCreateTile.setSelected(false);this.oExecuteOnSelect.setSelected(false);if(this._isIndustrySolutionModeAndVendorLayer()){this.oInputName.setValue(this.oResourceBundle.getText("VARIANT_MANAGEMENT_STANDARD"));}this._createSaveDialog();this._setDialogCompactStyle(this,this.oSaveDialog);this.oVariantPopOver.close();this.sTransport=null;this.sPackage=null;if(this.bManualVariantKey){this.oInputKey.setVisible(true);this.oInputKey.setEnabled(true);this.oInputKey.setValueState(x.None);this.oInputKey.setValueStateText(null);this.oLabelKey.setVisible(true);}else{this.oInputKey.setVisible(false);this.oLabelKey.setVisible(false);}};W.prototype._checkManageItemNameChange=function(e){var i="";var X=null;var Y=this;X=e.getCells()[W.NAME_COLUMN];i=X.getValue();i=i.trim();var Z=e;var $=Z.getKey();this._checkVariantNameConstraints(X,this.oManagementTable);if(X.getValueState()===x.Error){this._eventDone();return;}if(this.oVariantList.getItemByKey($).getText().trim()===i){this._eventDone();return;}if(Z.getGlobal()){var _=function(b1,c1){Z.setLifecyclePackage(b1);Z.setLifecycleTransportId(c1);Y._eventDone();};var a1=function(b1){if(Y&&Y.oVariantList){var c1=Y.oVariantList.getItemByKey($);X.setValue(c1.getText());}Y._cancelAllEvents();};this._createManagementDialog();this._assignTransport(Z,_,a1,this.oManagementDialog);}else{this._eventDone();}};W.prototype._handleManageSavePressed=function(){var e=this.oManagementTable.getItems();var i,X;var Y=false;var Z="";var $=null;var _=0;var a1=[];for(var iG=0;iG<e.length;iG++){i=this.oVariantList.getItemByKey(e[iG].getKey());X=e[iG].getCells()[W.NAME_COLUMN];if(X&&X.getValue){Z=X.getValue();}else if(X&&X.getTitle){Z=X.getTitle();}else if(X&&X.getText){Z=X.getText();}Z=Z.trim();if(i.getText()!==Z){this.aRenamedVariants.push({key:i.getKey(),name:Z});$=this.getItemByKey(e[iG].getKey());$.setText(Z);if($.setLifecyclePackage){$.setLifecyclePackage(e[iG].getLifecyclePackage());$.setLifecycleTransportId(e[iG].getLifecycleTransportId());}if(this.lastSelectedVariantKey===i.getKey()){this._setVariantText(Z);}}if(this.getUseFavorites()&&!this._isIndustrySolutionModeAndVendorLayer()){var c1=e[iG].getKey();if(this._mFavoriteChanges&&this._mFavoriteChanges[c1]!==undefined){var d1=this._mFavoriteChanges[c1];if(c1===this.STANDARDVARIANTKEY){if(this.getStandardFavorite()!==d1){a1.push({key:c1,visible:d1});this.setStandardFavorite(d1);}}else{$=this.getItemByKey(e[iG].getKey());if($&&i.getFavorite&&(i.getFavorite()!==d1)){a1.push({key:c1,visible:d1});$.setFavorite(d1);}}}}if(this.getShowExecuteOnSelection()&&i.getExecuteOnSelection&&e[iG].getCells()[W.EXEC_COLUMN].isA("sap.m.CheckBox")&&i.getExecuteOnSelection()!=e[iG].getCells()[W.EXEC_COLUMN].getSelected()){var e1=e[iG].getCells()[W.EXEC_COLUMN].getSelected();var f1=this.getItemByKey(e[iG].getKey());if(!f1&&(this.getSupportExecuteOnSelectOnSandardVariant()&(e[iG].getKey()===this.getStandardVariantKey()))){f1=new r();}if(f1&&f1.setExecuteOnSelection){f1.setExecuteOnSelection(e1);if(this.getSupportExecuteOnSelectOnSandardVariant()&(e[iG].getKey()===this.getStandardVariantKey())){this._executeOnSelectForStandardVariantByUser(e1);}this.aExeVariants.push({key:i.getKey(),exe:e1});if(f1.setLifecyclePackage&&!f1.getReadOnly()){f1.setLifecyclePackage(e[iG].getLifecyclePackage());f1.setLifecycleTransportId(e[iG].getLifecycleTransportId());}}}}if(this.oManagementDialog){this.oManagementDialog.close();}if(this.bVariantItemMode===false){if(this.getDefaultVariantKey()!=this.sNewDefaultKey){var g1=null;if(this.sNewDefaultKey==this.getStandardVariantKey()){g1=this.getItemByKey(this.getDefaultVariantKey());this.fireSave({name:g1.getText(),overwrite:true,key:g1.getKey(),def:false});}else{g1=this.getItemByKey(this.sNewDefaultKey);this.fireSave({name:g1.getText(),overwrite:true,key:g1.getKey(),def:true});}}}if(this.sNewDefaultKey!=this.getDefaultVariantKey()){this.setDefaultVariantKey(this.sNewDefaultKey);}for(_=0;_<this.aRemovedVariants.length;_++){i=this.getItemByKey(this.aRemovedVariants[_]);for(var iE=0;iE<this.aRemovedVariantTransports.length;iE++){if(this.aRemovedVariants[_]===this.aRemovedVariantTransports[iE].key){var i1=this.aRemovedVariantTransports[iE];if(i.setLifecyclePackage){i.setLifecycleTransportId(i1.transport);}break;}}}this.fireManage({renamed:this.aRenamedVariants,deleted:this.aRemovedVariants,exe:this.aExeVariants,def:this.getDefaultVariantKey(),fav:a1});for(_=0;_<this.aRemovedVariants.length;_++){i=this.getItemByKey(this.aRemovedVariants[_]);if(i){this._removeItem(i);i.destroy();}if(this.lastSelectedVariantKey===this.aRemovedVariants[_]){Y=true;this._setSelectedItem(null);this.oModel.setProperty("/enabled",false);}}if(Y){this.bFireSelect=true;}this._eventDone();};W.prototype._createEvent=function(e,i){var X={name:e,fFunc:i,args:[]};return X;};W.prototype._handleNextEvent=function(){if(this.aEvents.length>0){if(!this.bEventRunning){this.bEventRunning=true;var e=this.aEvents.pop();e.fFunc.apply(this,e.args);}}};W.prototype._addEvent=function(e){this.aEvents.push(e);this._handleNextEvent();};W.prototype._cancelAllEvents=function(){this.aEvents=[];this.bEventRunning=false;};W.prototype._eventDone=function(){this.bEventRunning=false;this._handleNextEvent();};W.prototype._handleManageExecuteOnSelectionChanged=function(e){var i=this;var X=e.getParent();if(X&&X.getGlobal()&&!X.getReadOnly()){var Y=function($,_){X.setLifecyclePackage($);X.setLifecycleTransportId(_);i._eventDone();};var Z=function($){e.setSelected(!e.getSelected());i._cancelAllEvents();};this._createManagementDialog();this._assignTransport(X,Y,Z,this.oManagementDialog);}else{this._eventDone();}};W.prototype._handleManageDeletePressed=function(e){var i=this,X;var Y=function(){var X=null,b1=i.oManagementTable.getItems();b1.some(function(c1){if(c1.getKey()===i.getStandardVariantKey()){X=c1;return true;}});return X;};this._anyInErrorState(this.oManagementTable,e.getParent().getCells()[W.NAME_COLUMN]);X=Y();var Z=e.getParent();if(Z.getGlobal()){var $=function(b1,c1){var d1=Z.getKey();i.aRemovedVariants.push(d1);i.oManagementTable.removeItem(Z);if(i.getShowSetAsDefault()){if((Z.getKey()===i.sNewDefaultKey)){if(X){X.getCells()[W.DEF_COLUMN].setSelected(true);X.getCells()[W.DEF_COLUMN].fireSelect({selected:true});}else{i.setStandardVariantKey(i.STANDARDVARIANTKEY);}i.sNewDefaultKey=i.getStandardVariantKey();}}Z.destroy();var e1={key:d1,transport:c1};i.aRemovedVariantTransports.push(e1);i._eventDone();};var _=function(b1){i._cancelAllEvents();};this._createManagementDialog();this._assignTransport(Z,$,_,this.oManagementDialog);}else{this.aRemovedVariants.push(Z.getKey());this.oManagementTable.removeItem(Z);if(this.getShowSetAsDefault()){if(Z.getKey()===this.sNewDefaultKey){if(X){X.getCells()[W.DEF_COLUMN].setSelected(true);X.getCells()[W.DEF_COLUMN].fireSelect({selected:true});}this.sNewDefaultKey=this.getStandardVariantKey();}}Z.destroy();this._eventDone();}var a1=sap.ui.getCore().byId(this.getId()+"-managementcancel");if(a1){a1.focus();}};W.prototype._handleShareSelected=function(e){var i=this;if(e.getParameters&&e.getParameters()&&e.getParameters().selected){var X=function(Z,$){i.sTransport=$;i.sPackage=Z;i._eventDone();};var Y=function(Z){i.oShare.setSelected(false);i.sTransport=null;i.sPackage=null;i._cancelAllEvents();};this._createSaveDialog();this._assignTransport(null,X,Y,this.oSaveDialog);}else{this.sTransport=null;this.sPackage=null;this._eventDone();}};W.prototype._handleVariantSaveAs=function(){var e="SV"+new Date().getTime();var i=this.oInputName.getValue();var X=this.oInputKey.getValue();var Y="";var Z="";var $=false;var _=false;var a1=null;i=i.trim();if(i==""){this.oInputName.setValueState(x.Error);this.oInputName.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"));this._cancelAllEvents();return;}X=X.trim();if(this.bManualVariantKey&&X==""){this.oInputKey.setValueState(x.Error);this.oInputKey.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"));this._cancelAllEvents();return;}if(this.bManualVariantKey){e=X;}if(this.oSaveDialog){this.oSaveDialog.close();}if(this.oExecuteOnSelect!==null){$=this.oExecuteOnSelect.getSelected();}if(this.oCreateTile!==null){_=this.oCreateTile.getSelected();}if(this.bVariantItemMode){a1=new r({key:e,readOnly:false,executeOnSelection:$,global:this.oShare.getSelected(),lifecycleTransportId:this.sTransport,lifecyclePackage:this.sPackage});a1.setText(i);this.addVariantItem(a1);this._setSelectedItem(a1);}else{a1=new v({key:e});a1.setText(i);this.addItem(a1);this._setSelectedItem(a1);}if(this.oDefault.getSelected()){this.setDefaultVariantKey(e);}if(this.oShare.getSelected()){Z=this.sPackage;Y=this.sTransport;}this.fireSave({name:i,overwrite:false,def:this.oDefault.getSelected(),key:e,exe:this.oExecuteOnSelect.getSelected(),tile:_,global:this.oShare.getSelected(),lifecyclePackage:Z,lifecycleTransportId:Y});this.oModel.setProperty("/enabled",false);this._eventDone();};W.prototype.setBackwardCompatibility=function(e){this._setBackwardCompatibility(e);};W.prototype._setBackwardCompatibility=function(e){if(this.getItems().length===0&&this.getVariantItems().length===0){this.bVariantItemMode=!e;}this._setStandardText();};W.prototype._setStandardText=function(){var e=this.getSelectionKey();if(e===null||e===this.getStandardVariantKey()){if(this.bVariantItemMode==false){this._setVariantText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT"));}else{this._setVariantText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_STANDARD"));}if(this.getStandardItemText()!==null&&this.getStandardItemText()!=""){this._setVariantText(this.getStandardItemText());}}};W.prototype._setVariantText=function(e){var i,X=this.extractBindingInfo(e),Y=e;if((typeof X==="object")&&X.model&&X.path){i=this.getModel(X.model);if(i){Y=i.getProperty(X.path);}}this.oModel.setProperty("/selectedVariant",Y);};W.prototype._getVariantText=function(e){return this.oModel.getProperty("/selectedVariant");};W.prototype._updateVariantInvisibletext=function(e,i){if(i){e=this.oResourceBundle.getText("VARIANT_MANAGEMENT_MODIFIED",[e]);}return e;};W.prototype._setFavoriteIcon=function(i,e){i.setSrc(e?"sap-icon://favorite":"sap-icon://unfavorite");i.setTooltip(this.oResourceBundle.getText(e?"VARIANT_MANAGEMENT_FAV_DEL_TOOLTIP":"VARIANT_MANAGEMENT_FAV_ADD_TOOLTIP"));i.setAlt(this.oResourceBundle.getText(e?"VARIANT_MANAGEMENT_FAV_DEL_ACC":"VARIANT_MANAGEMENT_FAV_ADD_ACC"));};W.prototype._isFavoriteSelected=function(i){return i.getSrc()==="sap-icon://unfavorite";};W.prototype._openVariantManagementDialog=function(){var i;var e=null;var X=0;var Y;var Z;var $;var _;var a1;var b1;var c1;var d1;var e1,f1,g1,h1,i1,j1;var k1=this;this._mFavoriteChanges={};this.oManagementSave.setEnabled(true);this.oManagementTable.destroyItems();e1=function(l1){k1._checkVariantNameConstraints(this,k1.oManagementTable);};f1=function(l1){var n1=k1._createEvent("inputfieldChange",k1._checkManageItemNameChange);n1.args.push(this.getParent());k1._addEvent(n1);};i1=function(l1){var n1=k1._isFavoriteSelected(l1.oSource),i=this.getParent();if(i&&(k1.sNewDefaultKey!==i.getKey())){k1._mFavoriteChanges[i.getKey()]=n1;k1._setFavoriteIcon(l1.oSource,n1);}};g1=function(l1){var n1=(l1.getParameters().selected===true),i=this.getParent();if(i){if(n1){k1.sNewDefaultKey=i.getKey();k1._mFavoriteChanges[i.getKey()]=n1;}var o1=i.getCells()[W.FAV_COLUMN];if(o1&&i.getFavorite){if(n1){k1._setFavoriteIcon(o1,true);}else if(k1._mFavoriteChanges[i.getKey()]!==undefined){k1._setFavoriteIcon(o1,k1._mFavoriteChanges[i.getKey()]);}else{k1._setFavoriteIcon(o1,i.getFavorite()===true);}}}};h1=function(l1){var n1=k1._createEvent("executeOnSelectionChange",k1._handleManageExecuteOnSelectionChanged);n1.args.push(this);k1._addEvent(n1);};j1=function(l1){var n1=k1._createEvent("manageDeletePressed",k1._handleManageDeletePressed);n1.args.push(this);k1._addEvent(n1);};if(this.oManageDialogSearchField){this.oManageDialogSearchField.setValue("");}this._initalizeManagementTableColumns();this.sNewDefaultKey=this.getDefaultVariantKey();this._restoreCompleteList(true);if(this.oVariantList.getItems()[0].getKey()!==this.getStandardVariantKey()&&this.bVariantItemMode==false){i=new r(this.oVariantManage.getId()+"-item-standard",{key:this.getStandardVariantKey(),text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT"),readOnly:true,executeOnSelection:false});this.oVariantList.insertItem(i,0);}if(this.getUseFavorites()){i=this.oVariantList.getItemByKey(this.getStandardVariantKey());if(i){this.oVariantList.removeItem(i);}}e=this.oVariantList.getItems();if(this.getUseFavorites()){e.sort(this._compareItems);if(i){this.oVariantList.insertItem(i);e.splice(0,0,i);}}for(var iH=0;iH<e.length;iH++){if(e[iH].getReadOnly()||e[iH].getLabelReadOnly()){var m1=e[iH].getAccessOptions();d1=this._accessOptionsText(m1);}else{d1=null;}if(e[iH].getReadOnly()){d1=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LAYER");}else if(e[iH].getLabelReadOnly()===true){d1=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LANGUAGE");}if(e[iH].getKey()===this.getStandardVariantKey()){d1=null;}Y=new E(this.oVariantManage.getId()+"-edit-"+X,{key:e[iH].getKey(),global:e[iH].getGlobal(),readOnly:e[iH].getReadOnly(),lifecyclePackage:e[iH].getLifecyclePackage(),lifecycleTransportId:e[iH].getLifecycleTransportId(),namespace:e[iH].getNamespace(),labelReadOnly:e[iH].getLabelReadOnly(),author:e[iH].getAuthor(),favorite:e[iH].getFavorite(),vAlign:w.Middle});Z=new u(this.oVariantManage.getId()+"-fav-"+X,{press:i1});Z.addStyleClass("sapUICompVarMngmtFavColor");if(e[iH].getFavorite){this._setFavoriteIcon(Z,e[iH].getFavorite());}Y.addCell(Z);if(e[iH].getKey()===this.getStandardVariantKey()||e[iH].getReadOnly()===true||e[iH].getLabelReadOnly()===true){Z=new p(this.oVariantManage.getId()+"-text-"+X,{});Z.setTitle(e[iH].getText());if(d1){Z.setTooltip(d1);}}else{Z=new I(this.oVariantManage.getId()+"-input-"+X,{liveChange:e1,change:f1});Z.setValue(e[iH].getText());}Y.addCell(Z);if(e[iH].getGlobal()){c1=this.oResourceBundle.getText("VARIANT_MANAGEMENT_SHARED");}else{c1=this.oResourceBundle.getText("VARIANT_MANAGEMENT_PRIVATE");}$=new a(this.oVariantManage.getId()+"-type-"+X,{text:c1,wrapping:false});$.addStyleClass("sapUICompVarMngmtType");Y.addCell($);_=new R(this.oVariantManage.getId()+"-def-"+X,{groupName:this.oVariantManage.getId(),select:g1});if(this.sNewDefaultKey===e[iH].getKey()||e[iH].getKey()===this.getStandardVariantKey()&&this.sNewDefaultKey===""){_.setSelected(true);if(e[iH].getFavorite){this._setFavoriteIcon(Y.getCells()[0],true);}}Y.addCell(_);if(this.getDisplayTextForExecuteOnSelectionForStandardVariant&&this.getDisplayTextForExecuteOnSelectionForStandardVariant()&&e[iH].getKey()===this.getStandardVariantKey()){a1=new a(this.oVariantManage.getId()+"-exe-"+X,{text:this.getDisplayTextForExecuteOnSelectionForStandardVariant(),textAlign:"Center"});}else{a1=new j(this.oVariantManage.getId()+"-exe-"+X,{selected:false,enabled:false,select:h1});if(e[iH].getExecuteOnSelection){if((e[iH].getKey()===this.getStandardVariantKey()&&this.getSupportExecuteOnSelectOnSandardVariant())){a1.setEnabled(true);if(this.bExecuteOnSelectForStandardByUser!==null){a1.setSelected(this.bExecuteOnSelectForStandardByUser);}else{a1.setSelected(e[iH].getExecuteOnSelection());}}else{a1.setEnabled(!e[iH].getReadOnly());a1.setSelected(e[iH].getExecuteOnSelection());}if(d1){a1.setTooltip(d1);}}}Y.addCell(a1);Y.addCell(new a());$=new a(this.oVariantManage.getId()+"-author-"+X,{text:e[iH].getAuthor(),textAlign:"Begin"});Y.addCell($);b1=new h(this.oVariantManage.getId()+"-del-"+X,{icon:"sap-icon://decline",enabled:true,type:y.Transparent,press:j1,tooltip:this.oResourceBundle.getText("VARIANT_MANAGEMENT_DELETE")});this._assignColumnInfoForDeleteButton(b1);if(e[iH].getReadOnly&&e[iH].getReadOnly()){b1.setEnabled(false);b1.setVisible(false);}Y.addCell(b1);this.oManagementTable.addItem(Y);X++;}this.aRemovedVariants=[];this.aRemovedVariantTransports=[];this.aRenamedVariants=[];this.aExeVariants=[];this._createManagementDialog();this._setDialogCompactStyle(this,this.oManagementDialog);i=this.oVariantList.getSelectedItem();if(i){this.lastSelectedVariantKey=i.getKey();}this.oVariantPopOver.close();this.oManagementDialog.open();};W.prototype._assignColumnInfoForDeleteButton=function(e){if(!this._oInvisibleDeleteColumnName){this._oInvisibleDeleteColumnName=new s({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_ACTION_COLUMN")});this._createManagementDialog();this.oManagementDialog.addContent(this._oInvisibleDeleteColumnName);}if(this._oInvisibleDeleteColumnName){e.addAriaLabelledBy(this._oInvisibleDeleteColumnName);}};W.prototype._enableManualVariantKey=function(e){this.bManualVariantKey=e;};W.prototype._fireSelectAsync=function(e){var i;if(e===undefined||e===null){var X=this._getSelectedItem();if(X===null){i=this.getStandardVariantKey();}else{i=X.getKey();}}this.fireSelect({key:i});};W.prototype.setSupportExecuteOnSelectOnSandardVariant=function(e){this.bSupportExecuteOnSelectOnSandardVariant=e;};W.prototype.getSupportExecuteOnSelectOnSandardVariant=function(){return this.bSupportExecuteOnSelectOnSandardVariant;};W.prototype._executeOnSelectForStandardVariantByXML=function(e){this.bExecuteOnSelectForStandardViaXML=e;};W.prototype._executeOnSelectForStandardVariantByUser=function(e){this.bExecuteOnSelectForStandardByUser=e;};W.prototype.getExecuteOnSelectForStandardVariant=function(){if(this.getSupportExecuteOnSelectOnSandardVariant()){if(this.bExecuteOnSelectForStandardByUser!==null){return this.bExecuteOnSelectForStandardByUser;}}return this.bExecuteOnSelectForStandardViaXML;};W.prototype.getStandardVariantKey=function(){return this._sStandardVariantKey;};W.prototype.setStandardVariantKey=function(e){this._sStandardVariantKey=e;};W.prototype._setVendorLayer=function(e){this._bVendorLayer=e;};W.prototype.setStandardFavorite=function(e){this._isFavorite=e;};W.prototype.getStandardFavorite=function(){return this._isFavorite;};W.prototype._isIndustrySolutionModeAndVendorLayer=function(){if(this._getIndustrySolutionMode()&&this._bVendorLayer){return true;}return false;};W.prototype._setIndustrySolutionMode=function(e){this._bIndustrialSolutionMode=e;};W.prototype._getIndustrySolutionMode=function(){return this._bIndustrialSolutionMode;};return W;});
