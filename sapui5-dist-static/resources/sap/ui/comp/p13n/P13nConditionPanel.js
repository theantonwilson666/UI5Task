/*
 * ! SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/m/P13nConditionPanel','sap/m/library','sap/ui/core/library','sap/ui/core/Control','sap/ui/core/IconPool','sap/ui/Device','sap/ui/core/InvisibleText','sap/ui/core/ResizeHandler','sap/ui/core/Item','sap/ui/core/ListItem','sap/ui/model/odata/type/Boolean','sap/ui/model/type/String','sap/ui/model/odata/type/String','sap/ui/model/type/Date','sap/ui/model/type/Time','sap/ui/model/odata/type/DateTime','sap/ui/model/type/Float','sap/m/Button','sap/m/OverflowToolbar','sap/m/OverflowToolbarLayoutData','sap/m/ToolbarSpacer','sap/m/Text','sap/m/SearchField','sap/m/CheckBox','sap/m/ComboBox','sap/m/Select','sap/m/Label','sap/m/Input','sap/m/DatePicker','sap/m/TimePicker','sap/m/DateTimePicker','sap/base/Log','sap/ui/thirdparty/jquery','sap/ui/comp/p13n/P13nOperationsHelper','sap/m/P13nConditionPanelRenderer',"sap/ui/model/json/JSONModel",'sap/ui/model/Sorter'],function(P,l,c,C,I,D,a,R,b,L,B,S,d,e,T,f,F,g,O,h,k,m,o,p,q,r,s,t,u,v,w,x,Q,y,z,J,A){"use strict";var G,E,H,K=l.ButtonType,M=l.P13nConditionOperation,N=l.P13nConditionOperationType,V=c.ValueState;var U=P.extend("sap.ui.comp.p13n.P13nConditionPanel",{metadata:{library:"sap.ui.comp.valuehelpdialog"},renderer:z.renderer});U.prototype.init=function(){this._oRbComp=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");P.prototype.init.apply(this);this._oOperationsHelper=new y();};U.prototype.setOperations=function(i,j,n){var W=n?N.Exclude:N.Include;j=j||"default";if(this._oTypeOperations[j]===undefined){this._oTypeOperations[j]={};}this._oTypeOperations[j][W]=i;this._updateAllOperations();};U._createKeyFieldTypeInstance=function(i){var j;if(!i.typeInstance){switch(i.type){case"boolean":i.typeInstance=new B();break;case"numc":if(!(i.formatSettings&&i.formatSettings.isDigitSequence)){x.error("sap.m.P13nConditionPanel","NUMC type support requires isDigitSequence==true!");i.formatSettings=Object.assign({},i.formatSettings,{isDigitSequence:true});}j=i.formatSettings;if(i.maxLength){j=Object.assign({},j,{maxLength:i.maxLength});}if(!j.maxLength){x.error("sap.m.P13nConditionPanel","NUMC type suppport requires maxLength!");}i.typeInstance=new d({},j);break;case"date":i.typeInstance=new e(Object.assign({},i.formatSettings,{strictParsing:true}),{});break;case"time":i.typeInstance=new T(Object.assign({},i.formatSettings,{strictParsing:true}),{});break;case"datetime":i.typeInstance=new f(Object.assign({},i.formatSettings,{strictParsing:true}),{displayFormat:"Date"});var W=i.typeInstance;if(!W.oFormat){W.formatValue(new Date(),"string");}if(W.oFormat){W.oFormat.oFormatOptions.UTC=false;}break;case"stringdate":H=H||sap.ui.requireSync("sap/ui/comp/odata/type/StringDate");i.typeInstance=new H(Object.assign({},i.formatSettings,{strictParsing:true}));break;case"numeric":if(i.precision||i.scale){j={};if(i.precision){j["maxIntegerDigits"]=parseInt(i.precision);}if(i.scale){j["maxFractionDigits"]=parseInt(i.scale);}}i.typeInstance=new F(j);break;default:var n=i.formatSettings;if(i.maxLength){n=Object.assign({},n,{maxLength:i.maxLength});}i.typeInstance=new S({},n);break;}}};U.prototype.setKeyFields=function(i){this._aKeyFields=i;this._aKeyFields.forEach(function(j){U._createKeyFieldTypeInstance(j);},this);this._updateKeyFieldItems(this._oConditionsGrid,true);this._updateAllConditionsEnableStates();this._createAndUpdateAllKeyFields();this._updateAllOperations();this._updateConditionFields();};U.prototype.setValues=function(i,j){j=j||"default";this._oTypeValues[j]=i;};U.prototype.addOperation=function(i,j,n){var W=n?N.Exclude:N.Include;j=j||"default";if(this._oTypeOperations[j]===undefined){this._oTypeOperations[j]={};}if(this._oTypeOperations[j][W]===undefined){this._oTypeOperations[j][W]=[];}this._oTypeOperations[j][W].push(i);this._updateAllOperations();};U.prototype.getOperations=function(i,j){var n,W,X,Y;i=i||"default";if(j!==undefined){n=j?N.Exclude:N.Include;Y=this._oTypeOperations[i]&&this._oTypeOperations[i][n]||[];}else{W=this._oTypeOperations[i]&&this._oTypeOperations[i][N.Include]||[];X=this._oTypeOperations[i]&&this._oTypeOperations[i][N.Exclude]||[];Y=W.concat(X);}return Y;};U.prototype._updatePaginatorToolbar=function(){if(this._sConditionType!=="Filter"||this.getMaxConditions()!=="-1"){return;}var i=this._aConditionKeys.length;var j=1+Math.floor(Math.max(0,i-1)/this._iConditionPageSize);var n=1+Math.floor(this._iFirstConditionIndex/this._iConditionPageSize);var W=this.getParent();if(!this._oPaginatorToolbar){if(i>this._iConditionPageSize){this._createPaginatorToolbar();this.insertAggregation("content",this._oPaginatorToolbar,0);this._onGridResize();}else{if(W&&W.getMetadata().getName()==="sap.m.Panel"){if(this._sOrgHeaderText==undefined){this._sOrgHeaderText=W.getHeaderText();}}return;}}this._oPrevButton.setEnabled(this._iFirstConditionIndex>0);this._oNextButton.setEnabled(this._iFirstConditionIndex+this._iConditionPageSize<i);if(W&&W.setHeaderToolbar){if(!W.getHeaderToolbar()){this.removeAggregation("content",this._oPaginatorToolbar);W.setHeaderToolbar(this._oPaginatorToolbar);W.attachExpand(function(Z){this._setToolbarElementVisibility(Z.getSource().getExpanded()&&this._bPaginatorButtonsVisible);}.bind(this));}}if(W&&W.getMetadata().getName()==="sap.m.Panel"){if(this._sOrgHeaderText==undefined){this._sOrgHeaderText=W.getHeaderText();}var X=this._sOrgHeaderText+(i>0?" ("+i+")":"");this._oHeaderText.setText(X);}else{this._oHeaderText.setText(i+" Conditions");}this._oPageText.setText(n+"/"+j);this._bPaginatorButtonsVisible=this._bPaginatorButtonsVisible||j>1;this._setToolbarElementVisibility(this._bPaginatorButtonsVisible);if(n>j){this._iFirstConditionIndex-=Math.max(0,this._iConditionPageSize);this._clearConditions();this._fillConditions();}var Y=0;this._oConditionsGrid.getContent().forEach(function(Z){if(Z.select.getSelected()){Y++;}},this);if(j==n&&(i-this._iFirstConditionIndex)>Y){this._clearConditions();this._fillConditions();}};U.prototype._setToolbarElementVisibility=function(i){this._oPrevButton.setVisible(i);this._oNextButton.setVisible(i);this._oPageText.setVisible(i);this._oFilterField.setVisible(false);this._setLayoutVisible(this._oAddButton,i);this._setLayoutVisible(this._oRemoveAllButton,i);};U.prototype._unregisterResizeHandler=function(){if(this._sContainerResizeListener){R.deregister(this._sContainerResizeListener);this._sContainerResizeListener=null;}};U.prototype._registerResizeHandler=function(){if(this.getContainerQuery()){this._sContainerResizeListener=R.register(this._oConditionsGrid,this._onGridResize.bind(this));this._onGridResize();}};U.prototype._handleRemoveCondition=function(i,j){var n=i.getContent().indexOf(j);this._removeCondition(i,j);if(this.getAutoReduceKeyFieldItems()){this._updateKeyFieldItems(i,false);}if(n>=0){n=Math.min(n,i.getContent().length-1);var j=i.getContent()[n];setTimeout(function(){j.remove.focus();});}this._updatePaginatorToolbar();};U.prototype._getCurrentKeyFieldItem=function(i){if(i.getSelectedKey&&i.getSelectedKey()){var j=i.getSelectedKey();var n=this._aKeyFields;for(var W in n){var X=n[W];if(X.key===j){return X;}}}return null;};U.prototype._createConditionRow=function(i,j,n,W,X){var Y,Z=this,G=U._getGridConstructor(),E=U._getGridDataConstructor(),$=new J();if(W===undefined){W=i.getContent().length;}var _=new G({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:1,vSpacing:0,containerQuery:this.getContainerQuery()}).data("_key",n);for(var a1 in this._aConditionsFields){var b1;var c1=this._aConditionsFields[a1];switch(c1["Control"]){case"CheckBox":b1=new p({enabled:false,layoutData:new E({span:c1["Span"+this._sConditionType]})});this._setLayoutVisible(b1,false);if(c1["ID"]==="showIfGrouped"){b1.setEnabled(true);b1.setText(c1["Label"]);b1.attachSelect(function(){Z._changeField(_);});b1.setSelected(j?j.showIfGrouped:true);}else{if(j){b1.setSelected(true);b1.setEnabled(true);}}break;case"ComboBox":if(c1["ID"]==="keyField"){b1=new q({width:"100%",ariaLabelledBy:this._oInvisibleTextField});var d1=b1.setSelectedKey.bind(b1);b1.setSelectedKey=function(n){d1(n);var q1=Z.getValidationExecutor();if(q1){q1();}};var e1=b1.setSelectedItem.bind(b1);b1.setSelectedItem=function(q1){e1(q1);var r1=Z.getValidationExecutor();if(r1){r1();}};b1.setLayoutData(new E({span:c1["Span"+this._sConditionType]}));this._fillKeyFieldListItems(b1,this._aKeyFields);if(b1.attachSelectionChange){b1.attachSelectionChange(function(q1){var r1=Z.getValidationExecutor();if(r1){r1();}Z._handleSelectionChangeOnKeyField(i,_);});}if(b1.attachChange){b1.attachChange(function(q1){_.keyField.close();Z._handleChangeOnKeyField(i,_);});}if(b1.setSelectedItem){if(j){b1.setSelectedKey(j.keyField);this._aKeyFields.forEach(function(f1,q1){var r1=f1.key;if(r1===undefined){r1=f1;}if(j.keyField===r1){b1.setSelectedItem(b1.getItems()[q1]);}},this);}else{if(this.getUsePrevConditionSetting()&&!this.getAutoReduceKeyFieldItems()){if(W>0&&!n&&X){Y=i.getContent()[W-1];if(Y.keyField.getSelectedKey()){b1.setSelectedKey(Y.keyField.getSelectedKey());}else{if(!b1.getSelectedItem()&&b1.getItems().length>0){b1.setSelectedItem(b1.getItems()[0]);}}}else{this._aKeyFields.some(function(f1,q1){if(f1.isDefault){b1.setSelectedItem(b1.getItems()[q1]);return true;}if(!b1.getSelectedItem()&&f1.type!=="boolean"){b1.setSelectedItem(b1.getItems()[q1]);}},this);if(!b1.getSelectedItem()&&b1.getItems().length>0){b1.setSelectedItem(b1.getItems()[0]);}}}else{this._aKeyFields.forEach(function(f1,q1){if(f1.isDefault){b1.setSelectedItem(b1.getItems()[q1]);}},this);}}}}if(c1["ID"]==="operation"){b1=new q({width:"100%",ariaLabelledBy:this._oInvisibleTextOperator,layoutData:new E({span:c1["Span"+this._sConditionType]})});b1.addEventDelegate({onmouseup:function(){if(!this.isOpen()){this.showItems();}}},b1);b1.setFilterFunction(function(){return true;});b1.setModel($);b1.attachChange(function(q1){Z._validateOperationValue(q1);Z._handleChangeOnOperationField(i,_);});_[c1["ID"]]=b1;this._updateOperationItems(i,_);var f1=this._getCurrentKeyFieldItem(_.keyField),g1=this._getRelevantOperations(f1);if(j){var h1=this.getCurrentOparation(j);g1.some(function(q1){if(h1===q1){b1.setSelectedKey(q1);return true;}},this);}else{if(this.getUsePrevConditionSetting()){if(W>0&&n===null){var Y=i.getContent()[W-1],i1=Y.operation.getSelectedKey()||g1[0];b1.setSelectedKey(i1);}else{b1.setSelectedKey(g1[0]);}}}}if(b1.getSelectedItem&&b1.getSelectedItem()&&b1.getMetadata()._sUIDToken!=="box"){b1.setTooltip(b1.getSelectedItem().getTooltip()||b1.getSelectedItem().getText());}break;case"TextField":var j1=this._getCurrentKeyFieldItem(_.keyField);b1=this._createValueField(j1,c1,_);b1.oTargetGrid=i;if(j&&j[c1["ID"]]!==undefined){var k1=j[c1["ID"]];if(b1 instanceof r){if(typeof k1==="boolean"){b1.setSelectedIndex(k1?2:1);}}else if(k1!==null&&_.oType){if(typeof k1==="string"&&_.oType.getName()==="sap.ui.comp.odata.type.StringDate"){b1.setValue(k1);}else{if(typeof k1==="string"&&["String","sap.ui.model.odata.type.String","sap.ui.model.odata.type.Decimal"].indexOf(_.oType.getName())==-1){try{k1=_.oType.parseValue(k1,"string");b1.setValue(_.oType.formatValue(k1,"string"));}catch(l1){x.error("sap.m.P13nConditionPanel","Value '"+k1+"' does not have the expected type format for "+_.oType.getName()+".parseValue()");}}else{b1.setValue(_.oType.formatValue(k1,"string"));}}}else{b1.setValue(k1);}}break;case"Label":b1=new s({text:c1["Text"]+":",visible:this.getShowLabel(),layoutData:new E({span:c1["Span"+this._sConditionType]})}).addStyleClass("conditionLabel");b1.oTargetGrid=i;break;}_[c1["ID"]]=b1;_.addContent(b1);}this._addButtons(_,i);i.insertContent(_,W);this._updateOperationItems(i,_);this._changeOperationValueFields(i,_);this._updateAllConditionsEnableStates();this._updateConditionButtons(i);if(this.getAutoReduceKeyFieldItems()){this._updateKeyFieldItems(i,false);}if(this._sLayoutMode){this._updateLayout({name:this._sLayoutMode});}if(j){var m1=this._getFormatedConditionText(j.operation,j.value1,j.value2,j.exclude,j.keyField,j.showIfGrouped);j._oGrid=_;j.value=m1;this._oConditionsMap[n]=j;}var n1=_.operation.getSelectedKey();if(n1==="BT"&&_.value1.setMinDate&&_.value2.setMaxDate){var o1=_.value1.getDateValue();var p1=_.value2.getDateValue();this._updateMinMaxDate(_,o1,p1);}else{this._updateMinMaxDate(_,null,null);}return _;};U.prototype._fillOperationListItems=function(i,j,n){var W={items:[]};if(n==="_STRING_"){n="";}if(n==="_TIME_"||n==="_DATETIME_"){n="_DATE_";}if(n==="_BOOLEAN_"||n==="_NUMC_"){n="";}i.destroyItems();if(j&&j.length>0){j.forEach(function(X){var Y=this._oRb.getText("CONDITIONPANEL_OPTION"+n+X);if(Y.startsWith("CONDITIONPANEL_OPTION")){Y=this._oRb.getText("CONDITIONPANEL_OPTION"+X);}W.items.push({key:X,text:Y,sorter:this._oOperationsHelper.isExcludeType(X)?this._oRbComp.getText("VALUEHELPDLG_EXCLUDE"):this._oRbComp.getText("VALUEHELPDLG_INCLUDE"),tooltip:Y});}.bind(this));i.getModel().setData(W);i.bindAggregation("items",{path:"/items",sorter:new A("sorter",true,true),template:new L({key:"{key}",text:"{text}"})});}};U.prototype._validateOperationValue=function(i){var j=i.getSource(),n=j.getSelectedKey(),W=j.getValue();if(!n&&W){j.setValueState(V.Error);j.setValueStateText(this._oRbComp.getText("VALUEHELPDLG_VALUE_NOT_EXIST",W));}else{j.setValueState(V.None);}};U.prototype._fillKeyFieldListItems=function(i,j){i.destroyItems();for(var n in j){var W=j[n];i.addItem(new L({key:W.key,text:W.text,tooltip:W.tooltip?W.tooltip:W.text}));}this._setLayoutVisible(i,i.getItems().length>1);};U.prototype._updateOperationItems=function(i,j){var n=this._getCurrentKeyFieldItem(j.keyField);var W=n&&n.type||"";var X=j.operation;var Y=X.getSelectedItem();var Z=this._getRelevantOperations(n);this._fillOperationListItems(X,Z,W?"_"+W.toUpperCase()+"_":"");if(Y&&X.getItemByKey(Y.getKey())){X.setSelectedKey(Y.getKey());}else{X.setSelectedItem(X.getItems()[1]);}this._sConditionType="Filter";if(Z[0]===M.Ascending||Z[0]===M.Descending){this._sConditionType="Sort";}if(Z[0]===M.GroupAscending||Z[0]===M.GroupDescending){this._sConditionType="Group";}this._adjustValue1Span(j);};U.prototype._updateKeyFieldItems=function(W,X,Y,Z){var n=W.getContent().length;var i;var $={};if(!X){for(i=0;i<n;i++){var _=W.getContent()[i].keyField;var a1=_.getSelectedKey();if(a1!=null&&a1!==""){$[a1]=true;}}}for(i=0;i<n;i++){var _=W.getContent()[i].keyField;var b1=W.getContent()[i].select;var c1=_.getSelectedKey();var j=0;var d1=this._aKeyFields;if(_!==Z){if(Y){j=d1.length-1;}else{_.destroyItems();}for(j;j<d1.length;j++){var e1=d1[j];if(e1.key==null||e1.key===""||!$[e1.key]||e1.key===c1){_.addItem(new L({key:e1.key,text:e1.text,tooltip:e1.tooltip?e1.tooltip:e1.text}));}}this._setLayoutVisible(_,_.getItems().length>1);}if(c1){_.setSelectedKey(c1);}else if(_.getItems().length>0){_.setSelectedItem(_.getItems()[0]);}if(!b1.getSelected()){this._aKeyFields.some(function(f1,g1){if(f1.isDefault){_.setSelectedItem(_.getItems()[g1]);return true;}if(!_.getSelectedItem()){if(f1.type!=="boolean"){_.setSelectedItem(_.getItems()[g1]);}}},this);}if(_.getSelectedItem()){_.setTooltip(_.getSelectedItem().getTooltip()||_.getSelectedItem().getText());}}};U.prototype._adjustValue1Span=function(i){if(this._sConditionType==="Filter"&&i.value1&&i.operation){var j=i.operation;var n=this._aConditionsFields[5]["Span"+this._sConditionType];var W=j.getSelectedKey();if(W!==M.BT&&W!==M.NotBT){n=this._aKeyFields.length>1?"L5 M10 S10":"XL8 L8 M8 S10";}var X=i.value1.getLayoutData();if(X.getSpan()!==n){X.setSpan(n);}}};U.prototype._changeField=function(i,j){var n=i.keyField.getSelectedKey();if(i.keyField.getSelectedItem()){i.keyField.setTooltip(i.keyField.getSelectedItem().getTooltip()||i.keyField.getSelectedItem().getText());}else{i.keyField.setTooltip(null);}var W=i.operation.getSelectedKey();var X=this._oOperationsHelper.isExcludeType(W);W=X?this._oOperationsHelper.getCorrespondingIncludeOperation(W):W;if(i.operation.getSelectedItem()){i.operation.setTooltip(i.operation.getSelectedItem().getTooltip()||i.operation.getSelectedItem().getText());}else{i.operation.setTooltip(null);}var Y=function(k1,l1,j){var f1,m1,i=k1.getParent();if(k1.getDateValue&&!(k1.isA("sap.m.TimePicker"))&&l1.getName()!=="sap.ui.comp.odata.type.StringDate"){m1=k1.getDateValue();if(l1&&m1){if((j&&j.getParameter("valid"))||k1.isValidValue()){f1=l1.formatValue(m1,"string");}else{f1="";}}}else{f1=this._getValueTextFromField(k1);m1=f1;if(l1&&l1.getName()==="sap.ui.comp.odata.type.StringDate"){f1=l1.formatValue(m1,"string");}else if(l1&&f1){try{m1=l1.parseValue(f1,"string");l1.validateValue(m1);if(j&&k1.getId()==j.getSource().getId()&&i.operation.getSelectedKey()===M.BT&&(this._isInvalidFiscalRange(i)||(this._isFieldNumeric(i)&&this._isInvalidRange(i)))){f1="";}}catch(n1){x.error("sap.m.P13nConditionPanel","not able to parse value "+f1+" with type "+l1.getName());f1="";}}}return[m1,f1];}.bind(this);var Z=Y(i.value1,i.oType,j);var $=Z[0],_=Z[1];Z=Y(i.value2,i.oType,j);var a1=Z[0],b1=Z[1];if(this._hasSecondValue(W)){this._updateMinMaxDate(i,$,a1);}else{this._updateMinMaxDate(i,null,null);}var c1=this._getCurrentKeyFieldItem(i.keyField);if(c1&&c1.type==="numc"){if([M.Contains,M.EndsWith].indexOf(W)!=-1){$=i.oType.formatValue($,"string");}}var d1=i.showIfGrouped.getSelected();var e1=i.select;var f1="";var g1;if(n===""||n==null){n=null;g1=this._getKeyFromConditionGrid(i);this._removeConditionFromMap(g1);this._enableCondition(i,false);var h1=this._getIndexOfCondition(i);if(e1.getSelected()){e1.setSelected(false);e1.setEnabled(false);this._bIgnoreSetConditions=true;this.fireDataChange({key:g1,index:h1,operation:"remove",newData:null});this._bIgnoreSetConditions=false;}return;}this._enableCondition(i,true);f1=this._getFormatedConditionText(W,_,b1,X,n,d1);var i1={"value":f1,"exclude":X,"operation":W,"keyField":n,"value1":$,"value2":this._hasSecondValue(W)?a1:null,"showIfGrouped":d1};g1=this._getKeyFromConditionGrid(i);if(f1!==""){e1.setSelected(true);e1.setEnabled(true);var j1="update";if(!this._oConditionsMap[g1]){j1="add";}this._oConditionsMap[g1]=i1;if(j1==="add"){this._aConditionKeys.splice(this._getIndexOfCondition(i),0,g1);}i.data("_key",g1);this.fireDataChange({key:g1,index:this._getIndexOfCondition(i),operation:j1,newData:i1});}else if(this._oConditionsMap[g1]!==undefined){this._removeConditionFromMap(g1);i.data("_key",null);var h1=this._getIndexOfCondition(i);if(e1.getSelected()){e1.setSelected(false);e1.setEnabled(false);this._bIgnoreSetConditions=true;this.fireDataChange({key:g1,index:h1,operation:"remove",newData:null});this._bIgnoreSetConditions=false;}}this._updatePaginatorToolbar();};U.prototype._isFieldNumeric=function(i){var j=this._getCurrentKeyFieldItem(i.keyField),n=j.type;return!!(n==="numc"||n==="numeric");};U.prototype._isFiscalField=function(i){var j=this._getCurrentKeyFieldItem(i.keyField);return j.typeInstance&&j.typeInstance.isA("sap.ui.comp.odata.type.FiscalDate");};U.prototype._isInvalidRange=function(i){var j=i.value1.getValue(),n=i.value2.getValue();return!!(j&&n&&(parseFloat(j)>parseFloat(n)));};U.prototype._isInvalidFiscalRange=function(i){var j,n,W,X,Y=i.value1.getValue(),Z=i.value2.getValue(),$=this._getCurrentKeyFieldItem(i.keyField),_=$.typeInstance&&$.typeInstance.sAnotationType;if(!this._isFiscalField(i)||!Y||!Z){return false;}if(_==="com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"||_==="com.sap.vocabularies.Common.v1.IsFiscalYearQuarter"||_==="com.sap.vocabularies.Common.v1.IsFiscalYearWeek"){if(Y.indexOf("/")!==-1&&Z.indexOf("/")!==-1){j=Y.split("/")[0];W=Z.split("/")[0];n=Y.split("/")[1];X=Z.split("/")[1];return n===X?j>W:n>X;}}else{return parseFloat(Y)>parseFloat(Z);}};U.prototype._validateAndFormatFieldValue=function(i){var j=i.oSource;var n=j.getParent();var W;var X=this._oRbComp.getText("VALUEHELPVALDLG_FIELD_RANGE_MESSAGE");if(j.getDateValue&&i){W=i.getParameter("value");var Y=i.getParameter("valid");this._makeFieldValid(j,Y);return;}else{W=j.getValue&&j.getValue();}if(!n){return;}if(this.getDisplayFormat()==="UpperCase"&&W){W=W.toUpperCase();j.setValue(W);}if(n.oType&&W){try{var Z=n.oType.parseValue(W,"string");n.oType.validateValue(Z);this._makeFieldValid(j,true);W=n.oType.formatValue(Z,"string");j.setValue(W);if(n.operation.getSelectedKey()===M.BT){if((this._isFieldNumeric(n)&&this._isInvalidRange(n,i))||this._isInvalidFiscalRange(n,i)){this._makeFieldValid(j,false,X);}else{this._makeFieldValid(n.value1,true);this._makeFieldValid(n.value2,true);}}}catch($){var _=$.message;this._makeFieldValid(j,false,_);}}else{this._makeFieldValid(j,true);}};U.prototype._changeOperationValueFields=function(i,j){P.prototype._changeOperationValueFields.apply(this,arguments);var n=j.getContent().length,W=j.remove,X=j.indexOfContent(W),Y=n-1;if(X!==Y){j.insertContent(W,Y);}};U.prototype._updateLayout=function(i){};U.prototype._updateConditionFields=function(){this._aConditionsFields=this._createConditionsFields();};U.prototype._addButtons=function(i,j){var n=this;var E=P._getGridDataConstructor();var W=new g({type:K.Transparent,icon:I.getIconURI("decline"),tooltip:this._oRb.getText("CONDITIONPANEL_REMOVE"+(this._sAddRemoveIconTooltipKey?"_"+this._sAddRemoveIconTooltipKey:"")+"_TOOLTIP"),press:function(){n._handleRemoveCondition(this.oTargetGrid,i);},layoutData:new E({span:"XL1 L1 M1 S1"})});W.oTargetGrid=j;i.addContent(W);i["remove"]=W;var X=new g({text:this._oRbComp.getText("VALUEHELPDLG_CONDITIONPANEL_ADD"),tooltip:this._oRb.getText("CONDITIONPANEL_ADD"+(this._sAddRemoveIconTooltipKey?"_"+this._sAddRemoveIconTooltipKey:"")+"_TOOLTIP"),press:function(){n._handleAddCondition(this.oTargetGrid,i,true);},layoutData:new E({span:"XL2 L3 M3 S3",indent:"XL9 L8 M8 S7",linebreak:true})});X.oTargetGrid=j;X.addStyleClass("conditionAddBtnFloatRight");i.addContent(X);i["add"]=X;};U.prototype.getCurrentOparation=function(i){return i.exclude?this._oOperationsHelper.getCorrespondingExcludeOperation(i.operation):i.operation;};U.prototype._hasSecondValue=function(i){return P.prototype._hasSecondValue.apply(this,arguments)||i===M.NotBT;};U.prototype._hasNoValues=function(i){return P.prototype._hasNoValues.apply(this,arguments)||i===M.NotEmpty;};U._getGridConstructor=function(){if(G===undefined){G=sap.ui.requireSync("sap/ui/layout/Grid");}return G;};U._getGridDataConstructor=function(){if(E===undefined){E=sap.ui.requireSync("sap/ui/layout/GridData");}return E;};U.prototype._createConditionsFields=function(){return[{"ID":"select","Label":"","SpanFilter":"L1 M1 S1","SpanSort":"L1 M1 S1","SpanGroup":"L1 M1 S1","Control":"CheckBox","Value":""},{"ID":"keyFieldLabel","Text":"Sort By","SpanFilter":"L1 M1 S1","SpanSort":"L1 M1 S1","SpanGroup":"L1 M1 S1","Control":"Label"},{"ID":"keyField","Label":"","SpanFilter":"L3 M5 S10","SpanSort":"L5 M5 S12","SpanGroup":"L4 M4 S12","Control":"ComboBox"},{"ID":"operationLabel","Text":"Sort Order","SpanFilter":"L1 M1 S1","SpanSort":"L1 M1 S1","SpanGroup":"L1 M1 S1","Control":"Label"},{"ID":"operation","Label":"","SpanFilter":this._aKeyFields.length>1?"L3 M5 S10":"XL3 L3 M3 S10","SpanSort":D.system.phone?"L5 M5 S8":"L5 M5 S9","SpanGroup":"L2 M5 S10","Control":"ComboBox"},{"ID":"value1","Label":this._sFromLabelText,"SpanFilter":this._aKeyFields.length>1?"L3 M10 S10":"XL4 L4 M4 S10","SpanSort":"L3 M10 S10","SpanGroup":"L3 M10 S10","Control":"TextField","Value":""},{"ID":"value2","Label":this._sToLabelText,"SpanFilter":this._aKeyFields.length>1?"L2 M10 S10":"XL4 L4 M4 S10","SpanSort":"L2 M10 S10","SpanGroup":"L2 M10 S10","Control":"TextField","Value":""},{"ID":"showIfGrouped","Label":this._sShowIfGroupedLabelText,"SpanFilter":"L1 M10 S10","SpanSort":"L1 M10 S10","SpanGroup":"L3 M4 S9","Control":"CheckBox","Value":"false"}];};U.prototype._getSecondValueNegativeIndex=function(){return 2;};U.prototype._getConditionsGridAtPosition=function(n){var i=this._oConditionsGrid.getContent();if(n>=i.length){return null;}return i[n];};U.prototype._getConditionsCount=function(){var i=this._oConditionsGrid.getContent();return i.length;};U.prototype.fireDataChange=function(i){var j,n=i.newData;if(n){j=n.operation;n.operation=this._oOperationsHelper.isExcludeType(j)?this._oOperationsHelper.getCorrespondingIncludeOperation(j):j;}return C.prototype.fireEvent.call(this,"dataChange",i);};return U;});
