/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/Log","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/comp/smartmultiedit/Container","sap/ui/comp/smartform/flexibility/changes/AddFields"],function(L,J,C,A){"use strict";var a={};a.applyChange=function(c,g,p){var o=c.getDefinition();var m=p.modifier;var b=p.appComponent;var f=o.content.field.selector;var v=p.view;var F=o.content.field.id;var i=o.content.field.index;var P=o.content.field.propertyName;var s=c.getDependentControl("form",p);var d=s&&m.getFlexDelegate(s);if(!d){if(this._checkChangeDefinition(o)){var j=o.content.field.jsType,e=o.content.field.entitySet;var G=m.createControl("sap.ui.comp.smartform.GroupElement",p.appComponent,p.view,f||F);var h=this._createGroupElementField(m,p.view,G,j,P,e,p.appComponent);m.insertAggregation(g,"groupElements",G,i,p.view);var k=this._getContainerFromGroup(g);if(k){k.indexField(h);}c.setRevertData({newFieldSelector:m.getSelector(G,p.appComponent)});return true;}else{L.error("Change doesn't contain sufficient information to be applied: "+this._getChangeInfo(o));}}return A._addFieldFromDelegate(s,g,f,F,i,P,c,m,v,b);};a.revertChange=function(c,g,p){var o=c.getDefinition(),r=c.getRevertData(),s=r.newFieldSelector,m=p.modifier;if(s){var G=m.bySelector(s,p.appComponent,p.view);m.removeAggregation(g,"groupElements",G);m.destroy(G);var b=this._getContainerFromGroup(g);if(b){b._refreshFields();}var v=r.valueHelpSelector;if(v){var d=p.appComponent;var V=p.view;var e=m.bySelector(v,d,V);var S=c.getDependentControl("form",p);m.removeAggregation(S,"dependents",e);m.destroy(e);}c.resetRevertData();return true;}else{L.error("Change doesn't contain sufficient information to be reverted. Most Likely the Change didn't go through applyChange: "+this._getChangeInfo(o));}};a.completeChangeContent=function(c,s,p){var o=p.appComponent;var b=c.getDefinition();if(!b.content){b.content={};}if(!b.content.field){b.content.field={};}if(s.bindingPath){b.content.field.propertyName=s.bindingPath;}else{throw new Error("oSpecificChangeInfo.bindingPath or bindingPath attribute required");}if(s.newControlId){b.content.field.selector=J.getSelector(s.newControlId,o);}else{throw new Error("oSpecificChangeInfo.newControlId attribute required");}if(s.jsTypes){b.content.field.jsType=s.jsType;}else if(s.bindingPath){b.content.field.jsType="sap.ui.comp.smartmultiedit.Field";}else{throw new Error("oSpecificChangeInfo.jsTypes or bindingPath attribute required");}if(s.index===undefined){throw new Error("oSpecificChangeInfo.index attribute required");}else{b.content.field.index=s.index;}if(s.entitySet){b.content.field.entitySet=s.entitySet;}if(s.relevantContainerId){c.addDependentControl(s.relevantContainerId,"form",p);}};a._checkChangeDefinition=function(c){var b=c.content,m=false;if(b){m=c.content.field&&(c.content.field.selector||c.content.field.id)&&c.content.field.jsType&&c.content.field.propertyName;}return b&&m;};a._createGroupElementField=function(m,v,g,j,p,e,o){var V=m.createControl(j,o,v);m.setProperty(V,"propertyName",p);if(e){m.setProperty(V,"entitySet",e);}m.insertAggregation(g,"elements",V,0,v,true);return V;};a._getContainerFromGroup=function(g){if(g&&typeof g.getParent==="function"&&typeof g.getParent().getParent==="function"&&typeof g.getParent().getParent().getParent==="function"){var c=g.getParent().getParent().getParent();if(c instanceof C){return c;}}};a._getChangeInfo=function(c){return"["+c.layer+"]"+c.namespace+"/"+c.fileName+"."+c.fileType;};return a;},true);
