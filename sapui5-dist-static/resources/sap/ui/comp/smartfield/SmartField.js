/*
 * ! SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/core/library","sap/ui/comp/library","./JSONControlFactory","./ODataControlFactory","./BindingUtil","./SideEffectUtil","./ODataHelper","sap/ui/core/Control","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/ui/model/json/JSONModel","sap/ui/model/BindingMode","sap/base/strings/capitalize","sap/base/Log","sap/m/DisplayListItem","sap/m/InputListItem"],function(C,c,l,J,O,B,S,a,b,P,V,d,e,f,L,D,I){"use strict";var g=c.ValueState;var T=l.smartfield.TextInEditModeSource;var h=l.smartfield.Importance;var k=c.TextAlign;var m=c.TextDirection;var n=l.smartfield.ControlContextType;var o=l.smartfield.ControlProposalType;var p=b.extend("sap.ui.comp.smartfield.SmartField",{metadata:{interfaces:["sap.ui.core.IFormContent","sap.ui.core.ISemanticFormContent"],library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smartfield/SmartField.designtime",properties:{value:{type:"any",group:"Misc",defaultValue:null},enabled:{type:"boolean",group:"Misc",defaultValue:true},entitySet:{type:"string",group:"Misc",defaultValue:""},editable:{type:"boolean",group:"Misc",defaultValue:true},contextEditable:{type:"boolean",group:"Misc",defaultValue:true},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:""},textAlign:{type:"sap.ui.core.TextAlign",group:"Misc",defaultValue:k.Initial},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:m.Inherit},placeholder:{type:"string",group:"Misc",defaultValue:""},name:{type:"string",group:"Misc",defaultValue:""},valueState:{type:"sap.ui.core.ValueState",group:"Appearance",defaultValue:g.None},valueStateText:{type:"string",group:"Appearance",defaultValue:""},showValueStateMessage:{type:"boolean",group:"Appearance",defaultValue:true},jsontype:{type:"sap.ui.comp.smartfield.JSONType",group:"Misc",defaultValue:null},mandatory:{type:"boolean",group:"Misc",defaultValue:false},maxLength:{type:"int",group:"Misc",defaultValue:0},showSuggestion:{type:"boolean",group:"Misc",defaultValue:true},showValueHelp:{type:"boolean",group:"Misc",defaultValue:true},showLabel:{type:"boolean",group:"Appearance",defaultValue:true},textLabel:{type:"string",group:"Misc",defaultValue:""},tooltipLabel:{type:"string",group:"Misc",defaultValue:""},uomVisible:{type:"boolean",group:"Misc",defaultValue:true},uomEditable:{type:"boolean",group:"Misc",defaultValue:true},uomEnabled:{type:"boolean",group:"Misc",defaultValue:true},url:{type:"string",group:"Misc",defaultValue:""},uomEditState:{type:"int",group:"Misc",defaultValue:-1},controlContext:{type:"sap.ui.comp.smartfield.ControlContextType",group:"Misc",defaultValue:n.None},proposedControl:{type:"sap.ui.comp.smartfield.ControlProposalType",group:"Misc",defaultValue:o.None},wrapping:{type:"boolean",group:"Misc",defaultValue:true},clientSideMandatoryCheck:{type:"boolean",group:"Misc",defaultValue:true},fetchValueListReadOnly:{type:"boolean",group:"Misc",defaultValue:true},expandNavigationProperties:{type:"boolean",group:"Behavior",defaultValue:false},textInEditModeSource:{type:"sap.ui.comp.smartfield.TextInEditModeSource",group:"Behavior",defaultValue:T.None},historyEnabled:{type:"boolean",group:"Misc",defaultValue:true},importance:{type:"sap.ui.comp.smartfield.Importance",group:"Misc",defaultValue:h.Low},fixedValueListValidationEnabled:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},configuration:{type:"sap.ui.comp.smartfield.Configuration",multiple:false},controlProposal:{type:"sap.ui.comp.smartfield.ControlProposal",multiple:false},_ariaLabelInvisibleText:{type:"sap.ui.core.InvisibleText",multiple:true,visibility:"hidden"},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{entitySetFound:{parameters:{entitySet:{type:"string"}}},change:{parameters:{value:{type:"string"},newValue:{type:"string"}}},changeModelValue:{parameters:{valueChanged:{type:"boolean"},valueLastValueState:{type:"boolean"},unitChanged:{type:"boolean"},unitLastValueState:{type:"sap.ui.core.ValueState"}}},initialise:{},visibleChanged:{parameters:{visible:{type:"boolean"}}},editableChanged:{parameters:{editable:{type:"boolean"}}},contextEditableChanged:{parameters:{editable:{type:"boolean"}}},innerControlsCreated:{},valueListChanged:{parameters:{changes:{type:"sap.ui.core.Control[]"}}},press:{}}},renderer:{apiVersion:2,render:function(r,i){var j=i.getContent();r.openStart("div",i);r.class("sapUiCompSmartField");r.openEnd();if(j&&i.getMode()==="display"&&i.isFormContextType()&&i._innerControlHasNoValue()){r.openStart("span");r.class("sapUiPseudoInvisibleText");r.openEnd();r.text(C.getLibraryResourceBundle("sap.ui.comp").getText("NO_VALUE"));r.close("span");r.openStart("span");r.attr("aria-hidden","true");r.class("sapMText");r.class("sapUiSelectable");r.class("sapMTextMaxWidth");r.class("sapUiCompSmartFieldValue");r.class("sapUiCompEmptyValue");r.openEnd();r.close("span");}r.renderControl(j);if(i.getAggregation("_ariaLabelInvisibleText")){i.getAggregation("_ariaLabelInvisibleText").forEach(function(q){r.renderControl(q);});}r.close("div");}}});p.prototype.init=function(){this._sAnnotationLabel="";this._bInDestroy=false;this._oSideEffects=new S(this);this._oFactory=null;this._oControl={display:null,"display_uom":null,edit:null,current:null};this._oValue={display:null,edit:null,uom:null,uomset:null};this._oError={bComplex:false,bFirst:false,bSecond:false};this._sBindingContextPath="";this._oUtil=new B();this._bSuppressToggleControl=false;};p.prototype.setVisible=function(v,s){var i=this.getVisible();b.prototype.setVisible.apply(this,arguments);v=this.getVisible();if(v!==i){this.fireVisibleChanged({visible:v});}return this;};p.prototype._setVisibilityBasedOnImportance=function(F){var M,i,s,A,j,q=this._oFactory,G=this.oParent&&this.oParent.isA("sap.ui.comp.smartform.GroupElement")&&this.oParent.getDomRef();if(!q||!G){return;}M=q.getMetaData&&q.getMetaData();i=M&&M.property&&M.property.property;A=q._oHelper&&q._oHelper.oAnnotation;if(A){if(!A.isNullable(i)||A.isStaticMandatory(i)||A.getVisible(i)==="false"){return;}}if(this.getMandatory()||!this.getVisible()||this._fieldControlValue===0||this._fieldControlValue===7){return;}s=(!this.isPropertyInitial("importance")&&this.getImportance())||(A&&A.getImportanceAnnotation(i));switch(F){case h.High:j=s===h.High?"":"none";break;case h.Medium:j=s===h.Low?"none":"";break;default:j="";}G.style.display=j;};p.prototype.getComputedTextLabel=function(){return this.getProperty("textLabel")||this._sAnnotationLabel;};p.prototype.setEditable=function(E){return this.setEditableProperty("editable",E,false);};p.prototype.setContextEditable=function(i){return this.setEditableProperty("contextEditable",i,true);};p.prototype.setEditableProperty=function(s,E,i){var j=f(s),G=this["get"+j].bind(this),q=G(),M,r;this.setProperty(s,E,i);E=G();this._bPendingEditableState=false;var t=E!==q,u=this.isPropertyBeingUpdatedByModel(s);M=this.getMode();if(t&&this._oFactory){if(this._oFactory.reBindIfNecessary&&!E&&q){this._oFactory.reBindIfNecessary();}else if(this._oFactory.reBind&&this.isTextInEditModeSourceNotNone()&&M==="edit"&&E&&!q){this._oFactory.reBind();}}if((t&&!u)||(t&&u&&this._boundEntityExists())||!this._oControl[M]){this._toggleInnerControlIfRequired();}if(this.isContextTable()&&t&&E&&!q){r=this._oControl&&this._oControl.edit;if(r){(r.isA("sap.m.HBox")?r.getItems():[r]).forEach(function(w){if(w.getValueState&&(w.getValueState()===g.Error||w.getValueState()===g.Warning)){w.setValueState(g.None);}});}}if(t){var v="fire"+j+"Changed";this[v]({editable:E});}return this;};p.prototype.isPropertyBeingUpdatedByModel=function(s){var i=this.getBindingInfo(s);return!!(i&&i.skipModelUpdate);};p.prototype._boundEntityExists=function(v){v=v||this.getBindingContext();return!!(v&&v.getObject());};p.prototype.setUomEditable=function(u){this.setProperty("uomEditable",u,true);var U=this._getEmbeddedSmartField();if(U){U.setEditable(this.getUomProperty("editable"));}return this;};p.prototype.setUomEnabled=function(u){this.setProperty("uomEnabled",u,true);var U=this._getEmbeddedSmartField();if(U){U.setEnabled(this.getUomEnabled());}return this;};p.prototype.setUomVisible=function(u){this.setProperty("uomVisible",u,true);var U=this._getEmbeddedSmartField();if(U){u=this.getUomProperty("visible");U.setVisible(u);var M=this._oFactory&&this._oFactory.oMeasureField;if(M){M.toggleStyleClass("smartFieldPaddingRight",u);}}return this;};p.prototype.setMandatory=function(M){this.setProperty("mandatory",M,false);this._setPropertyOnControls("required",this.getMandatory());return this;};p.prototype.setWidth=function(w){this.setProperty("width",w,true);this._setOnInnerControl();return this;};p.prototype.setWrapping=function(w){this.setProperty("wrapping",w,true);this._setOnInnerControl();return this;};p.prototype.setTextAlign=function(t){this.setProperty("textAlign",t,true);this._setOnInnerControl();return this;};p.prototype.setTextDirection=function(t){this.setProperty("textDirection",t);this._setOnInnerControl();return this;};p.prototype.setPlaceholder=function(s){this.setProperty("placeholder",s,true);this._setOnInnerControl();return this;};p.prototype.setName=function(N){this.setProperty("name",N,true);this._setOnInnerControl();return this;};p.prototype.setMaxLength=function(M){this.setProperty("maxLength",M,true);this._setOnInnerControl();return this;};p.prototype.setShowValueHelp=function(v){var i=this.getShowValueHelp();this.setProperty("showValueHelp",v,true);var j=this.getContent();if(j&&(typeof j.setShowValueHelp==="function")){v=this.getShowValueHelp();var q=v!==i,F=this._oFactory;if(q&&F){if(v){if(F.shouldCreateValueHelpForControl(j)){F._createValueHelp();}}else{F.destroyValueHelp();}}j.setShowValueHelp(v);}return this;};p.prototype.setShowSuggestion=function(s){var i=this.getShowSuggestion();this.setProperty("showSuggestion",s,true);var j=this.getContent();if(j&&(typeof j.setShowSuggestion==="function")){s=this.getShowSuggestion();var q=s!==i,F=this._oFactory;if(q&&F){if(s){if(F.shouldCreateValueHelpForControl(j)){F._createValueHelp();}}else{F.destroyValueHelp();}}j.setShowSuggestion(s);}return this;};p.prototype.setConfiguration=function(i){var j=this.getConfiguration(),r=this.setAggregation("configuration",i,true);i=this.getConfiguration();var q=!!((i&&(j===null))||(j&&(i===null))),H=!!this.getContent();if(H&&(q||(i&&j&&((i.getControlType()!==j.getControlType())||(i.getDisplayBehaviour()!==j.getDisplayBehaviour()))))){this._destroyControls();this._toggleInnerControlIfRequired();}return r;};p.prototype.setTextInEditModeSource=function(t){var s=this.getTextInEditModeSource();this.setProperty("textInEditModeSource",t,false);t=this.getTextInEditModeSource();if(t!==s){if(this._oFactory&&this._oFactory.reBind){this._oFactory.reBind();}this._destroyControls();this._toggleInnerControlIfRequired();}return this;};p.prototype.setTooltip=function(t){this._refreshTooltipBaseDelegate(t);this.setAggregation("tooltip",t,true);var i=this.getFirstInnerControl();if(i){i.setTooltip(t);}return this;};p.prototype._setOnInnerControl=function(){var i=this.getContent();if(i){if(typeof i.setWidth==="function"){var w=this.getWidth();if(w){i.setWidth(w);}}this._setPropertyOnControls("wrapping",this.getWrapping());if(typeof i.setName==="function"){i.setName(this.getName());}if(typeof i.setPlaceholder==="function"&&this.getPlaceholder()!==""){i.setPlaceholder(this.getPlaceholder());}if(typeof i.setTextAlign==="function"){i.setTextAlign(this.getTextAlign());}this._setPropertyOnControls("required",this.getMandatory());this._setPropertyOnControls("textDirection",this.getTextDirection());var u=this._getEmbeddedSmartField();if(u){if(!this.isPropertyInitial("uomEditable")){u.setEditable(this.getUomProperty("editable"));}if(!this.isPropertyInitial("uomEnabled")){u.setEnabled(this.getUomEnabled());}if(!this.isPropertyInitial("uomVisible")){u.setVisible(this.getUomProperty("visible"));}}}return this;};p.prototype.getUomProperty=function(s){var u=this._getEmbeddedSmartField(),U=u&&u.getControlFactory(),i=U&&U._oFieldControl,j=f(s),q="getUom"+j,r=this[q]();if(u.isBound(s)&&i){var t=U.getMetaData();if(t){var v=i._oStoredBindings[s],w=i["_get"+j](t,v,s);w.path();var x=w.formatter.call(u,r);return x;}}return r;};p.prototype._setPropertyOnControls=function(s,v,i){i=i||this.getInnerControls();i.forEach(function(j){var M="set"+f(s);if(typeof j[M]==="function"){j[M](this._convertValueForControl(s,v,j));}},this);};p.prototype._convertValueForControl=function(s,v,i){var j;if(i){j=i.getMetadata().getProperty(s);}if(j){switch(s){case"wrapping":switch(j.type){case"boolean":return v;case"sap.ui.core.Wrapping":var w=c.Wrapping;if(v){return w.Soft;}return w.None;}}}return v;};p.prototype.setUrl=function(v){this.setProperty("url",v,true);return this;};p.prototype.setEntitySet=function(v){this.setProperty("entitySet",v,true);this.fireEntitySetFound({entitySet:v});return this;};p.prototype._setPendingEditState=function(i){this.data("pendingEditableState",!i);};p.prototype.applySettings=function(s){if(s&&s.customData){for(var i=0;i<s.customData.length;i++){var j=s.customData[i];if(j&&j.mProperties&&j.mProperties.key==="pendingEditableState"){this._bPendingEditableState=j.mProperties.value;}}}return b.prototype.applySettings.apply(this,arguments);};p.prototype.setEnabled=function(v){this.setProperty("enabled",v,false);this._toggleInnerControlIfRequired();return this;};p.prototype.setContent=function(v){return this.setAggregation("_content",v);};p.prototype.getContent=function(){return this.getAggregation("_content");};p.prototype.getControlFactory=function(){return this._oFactory;};p.prototype.getValue=function(){var i=this.getInnerValueFunction();if(i){return i();}return this.getProperty("value");};p.prototype.getInnerValueFunction=function(){if(this._oValue&&(typeof this._oValue[this.getMode()]==="function")){return this._oValue[this.getMode()];}return null;};p.prototype.getValueState=function(){var i=this.getInnerControls(),j=this._getMaxSeverity(i);if(j>-1){return i[j].getValueState();}return g.None;};p.prototype.setValueState=function(v){this.setProperty("valueState",v,true);var i=this.getInnerControls(),j,M="setSimpleClientError";if(i&&i.length){j=i[0];if(i.length>1){M="setComplexClientErrorFirstOperand";}}if(j&&(typeof j.setValueState==="function")){j.setValueState(v);this[M](v===g.Error);}return this;};p.prototype.getValueStateText=function(){var i=this.getInnerControls(),j=this._getMaxSeverity(i);if(j>-1){return i[j].getValueStateText();}return this.getProperty("valueStateText");};p.prototype.setValueStateText=function(t){this.setProperty("valueStateText",t,true);var i=this.getInnerControls(),j;if(i&&i.length){j=i[0];}if(j&&(typeof j.setValueStateText==="function")){j.setValueStateText(t);}return this;};p.prototype._getMaxSeverity=function(j){var s,q,i,r,t=0,u=-1,v={"Error":3,"Warning":2,"Success":1,"None":0};r=j.length;for(i=0;i<r;i++){q=j[i];if(q.getValueState){s=q.getValueState();if(s&&v[s]>t){t=v[s];u=i;}}}return u;};p.prototype.getFocusDomRef=function(){var i=this.getInnerControls(),j,q=i.length;if(q>0){j=i[0];}if(j&&j.getFocusDomRef){return j.getFocusDomRef();}return b.prototype.getFocusDomRef.apply(this,arguments);};p.prototype.getIdForLabel=function(){var i=this.getInnerControls(),j,q=i.length;if(q>0){j=i[0];}if(j&&(typeof j.getIdForLabel==="function")){return j.getIdForLabel();}return this.getId();};p.prototype.updateBindingContext=function(s,F,u){b.prototype.updateBindingContext.apply(this,arguments);if(this._bInDestroy){return;}this._init(F);if(this._oFactory){if(this.getBindingContext()){this._sBindingContextPath=this.getBindingContext().getPath();}if(typeof this._oFactory.bind==="function"){this._oFactory.bind();}else{this._toggleInnerControlIfRequired();}}};p.prototype.bindProperty=function(s,i){var j=s==="value";if(!j||this.isPropertyInitial("value")){return b.prototype.bindProperty.apply(this,arguments);}var v=this.getBindingPath("value"),q=this.getBindingContext(),r=q&&q.getPath();b.prototype.bindProperty.apply(this,arguments);var t=this.getBindingPath("value"),u=this.getBindingContext(),w=u&&u.getPath();if((t!==v)||(w!==r)){this._destroyFactory();this._init();var F=this._oFactory;if(F&&(typeof F.bind==="function")){F.bind();}}return this;};p.prototype.unbindProperty=function(s,i){b.prototype.unbindProperty.apply(this,arguments);var j=this.getAllInnerControls();j.forEach(function(q){var r=q.getMetadata().getName();var v=O.getBoundPropertiesMapInfoForControl(r,{propertyName:s});if(Array.isArray(v)){v.forEach(function(t){q.unbindProperty(t,i);});}});return this;};p.prototype.getMode=function(){var E=this.getEditable(),i=this.getEnabled(),j=this.getContextEditable();if(this.getControlContext()==="responsiveTable"&&this.data("suppressUnit")!=="true"){if(!E||!j||!i||(this.getProperty("uomEditState")===0)){return"display_uom";}}if(j&&this.data("configdata")&&this.data("configdata").configdata.isUOM&&this.data("configdata").configdata.isInnerControl&&this.data("configdata").configdata.getContextEditable){j=this.data("configdata").configdata.getContextEditable();}return E&&i&&j?"edit":"display";};p.prototype.isInEditMode=function(){return this.getMode()==="edit";};p.prototype._toggleInnerControlIfRequired=function(){if(this._bPendingEditableState||this._bSuppressToggleControl||(!this._oFactory||this._oFactory.bPending)){return;}var M=this.getMode();if((M==="edit")||(M==="display_uom")){this._createControlIfRequired(M);if(this.getContent()){this._checkFieldGroups();}}else{var v=this.getProperty("value"),i=true;var j=this.data("configdata");if(j&&j.configdata&&!j.configdata.isUOM){if(v===null||v===""){i=false;}}if(i){this._createControlIfRequired(M);}else{this.setContent(null);this._oControl.current="display";}}};p.prototype.setImportance=function(i){var s=this.getProperty("importance");if(s===i){return this;}this.setProperty("importance",i);return this;};p.prototype.setValue=function(v){var s=this.getProperty("value");this.setProperty("value",v,true);if(!this.isPropertyBeingUpdatedByModel("value")&&!this.getBindingContext()){var i=this.getFirstInnerControl();if(i){var j=i.getMetadata().getName();var q=O.getBoundPropertiesMapInfoForControl(j,{propertyName:"value"})[0];var r=i.getBinding(q);if((this.getMode()==="display")&&r&&(typeof r.getFormatter()==="function")&&(r.getBindingMode()===e.OneWay)){v=r.getExternalValue();}this._setPropertyOnControls(q,v,[i]);}}var F=this._oFactory;if(!F){return this;}if(!F.bPending){this._toggleInnerControlIfRequired();}v=this.getProperty("value");if(F.oTextArrangementDelegate){F.oTextArrangementDelegate.setValue(v,s);}if(v!==s){this.invalidate();}return this;};p.prototype.isTextInEditModeSourceNotNone=function(){return(this._getComputedTextInEditModeSource()!==T.None);};p.prototype._getComputedTextInEditModeSource=function(){var t=this.getTextInEditModeSource(),s=this.data("defaultTextInEditModeSource");if(s&&this.isPropertyInitial("textInEditModeSource")&&this.getMode()==="edit"){t=s;}return t;};p.prototype._createControlIfRequired=function(E){if(!this._oFactory){return;}var v=this._oControl[E];if((E!==this._oControl.current)||!v){if(!v){var i=this._oFactory.createControl();if(i){this._oControl[E]=i.control;this._placeCallBacks(i,E);}}this._oControl.current=E;this.setContent(this._oControl[E]);this._oFactory.updateControl();this._setOnInnerControl();this.fireInnerControlsCreated(this.getInnerControls());}else if(!this.getContent()){this.setContent(this._oControl[E]);}};p.prototype._placeCallBacks=function(i,M){if(i.params&&i.params.getValue){this._oValue[M]=i.params.getValue;}if(i.params&&i.params.uom){this._oValue.uom=i.params.uom;}if(i.params&&i.params.uomset){this._oValue.uomset=i.params.uomset;}};p.prototype._init=function(M){var i,j,q=this.getBindingContext(),s;if(this._oFactory&&this._sBindingContextPath&&q&&(this._sBindingContextPath!==q.getPath())||(this._sBindingContextPath&&q===null)){this._destroyFactory();}if(!this._oFactory){j=this.data("configdata");if(!j){i=this.getModel(M);}s=this.getBindingPath("value");if(M===undefined&&s&&(j||i)){this._oFactory=this._createFactory(M,i,s,j);}}};p.prototype._destroyFactory=function(){this._bSuppressToggleControl=true;this._bSideEffects=false;if(this._oFactory){this._oFactory.destroy();}this._oFactory=null;this._bSuppressToggleControl=false;this._destroyControls();};p.prototype._destroyControls=function(){if(this._oControl){if(this._oControl.display){this._oControl.display.destroy();}if(this._oControl["display_uom"]){this._oControl["display_uom"].destroy();}if(this._oControl.edit){this._oControl.edit.destroy();}this._oControl.display=null;this._oControl["display_uom"]=null;this._oControl.edit=null;this._oControl.current=null;}this._oValue={display:null,edit:null,uom:null,uomset:null};this.destroyAggregation("_content");};p.prototype._createFactory=function(M,i,s,j){if(i&&i instanceof d){return new J(i,this,{model:M,path:s});}var E;if(!j){E=this._getEntitySet(M);}if(E||j){var q;if(j){q=j.configdata;}else{q={entitySet:E,model:M,path:s};}return new O(i,this,q);}return null;};p.prototype._getEntitySet=function(M){var E=this.getEntitySet(),i=E!=="";if(i&&!M){return E;}var j=this.getBindingContext(M);if(j){var s=j.getPath();if((s==="")||(s===undefined)||(s==="/undefined")){return"";}E=this._oUtil.correctPath(s);this.fireEntitySetFound({entitySet:E});return E;}return"";};p.prototype.getDataType=function(){var i;if(this._oFactory){if(this._oFactory.getDataProperty){i=this._oFactory.getDataProperty();if(i){return i.property.type;}}return this.getJsonType();}return null;};p.prototype.getDataProperty=function(){if(this._oFactory){if(this._oFactory.getDataProperty){return this._oFactory.getDataProperty();}return null;}return null;};p.prototype.getUnitOfMeasure=function(){if(this._oValue.uom){return this._oValue.uom();}return null;};p.prototype.setUnitOfMeasure=function(u){if(u&&this._oValue.uomset){this._oValue.uomset(u);}};p.prototype.setSimpleClientError=function(E){this._oError.bFirst=E;};p.prototype.setComplexClientErrorFirstOperand=function(E){this._oError.bComplex=true;this._oError.bFirst=E;};p.prototype.setComplexClientErrorSecondOperand=function(E){this._oError.bComplex=true;this._oError.bSecond=E;};p.prototype.setComplexClientErrorSecondOperandNested=function(E){var i=this.getParent().getParent();i.setComplexClientErrorSecondOperand(E);};p.prototype._hasClientError=function(){if(this._oError.bComplex){return this._oError.bFirst||this._oError.bSecond;}return this._oError.bFirst;};p.prototype.checkClientError=function(s){s=Object.assign({handleSuccess:false},s);var E="The sap.ui.comp.smartfield.SmartField#checkClientError method is deprecated. "+"Please use the sap.ui.comp.smartfield.SmartField#checkValuesValidity method instead.";L.warning(E,this.getMetadata().getName());if(this.getMode()==="display"){return false;}if(this._hasClientError()&&!s.handleSuccess){return true;}this.getInnerControls().forEach(function(i){this._checkErrors(i,{checkClientErrorsOnly:true,handleSuccess:s.handleSuccess});}.bind(this));return this._hasClientError();};p.prototype.checkValuesValidity=function(s){var i,F=this.getControlFactory(),E;if(F&&F.getEdmProperty){E=F.getEdmProperty();i=E.name;}if(this.getMode()==="display"){return Promise.resolve({property:i,instance:this});}s=s||{};var j={handleSuccess:true,innerControls:this.getInnerControls(),rawValues:[]};var u=this._getEmbeddedSmartField();s=Object.assign(j,s);if(s.rawValues.length===0&&u&&u.data("configdata")&&u.data("configdata").configdata.isUOM){this._updateCurrencyRawValues(s);}return new Promise(function(r,R){var q={rawValues:s.rawValues,handleSuccess:s.handleSuccess,bCheckValuesValidity:true};var t=s.innerControls.map(function(v){return this._checkErrors(v,q);},this);Promise.all(t).then(function(){r({property:i,instance:this});}.bind(this)).catch(function(v){R({property:i,instance:this});}.bind(this));}.bind(this));};p.prototype._updateCurrencyRawValues=function(s){s.rawValues=s.innerControls.map(function(i){var M=i.getMetadata(),j=O.getBoundPropertiesMapInfoForControl(M.getName(),{propertyName:"value"});return M.getProperty(j).get(i);});};p.prototype._checkErrors=function(i,s){s=Object.assign({checkClientErrorsOnly:false,handleSuccess:true},s);var j,q;if(i){var v=O.getBoundPropertiesMapInfoForControl(i.getMetadata().getName(),{propertyName:"value"});q=v&&v[0];}if(q){j=i.getBinding(q);}if(!j){return Promise.resolve();}var r;function t(G){var H={element:i,property:q,type:j.getType(),newValue:r,oldValue:j.getValue(),exception:G,message:G.message};if(G instanceof P){i.fireParseError(H);}else if(G instanceof V){i.fireValidationError(H);}else{throw G;}}function u(){if(s.handleSuccess&&j.hasValidation()){var H={element:i,property:q,type:j.getType(),newValue:r,oldValue:j.getValue(),mParameters:{suppressChangeModelValue:true}};var K=false,N=true;i.fireValidationSuccess(H,K,N);}}try{var M="get"+f(q),w=j.getType(),x=j.sInternalType;r=i[M]();if(x&&w){if(s.checkClientErrorsOnly&&w.async){var E="The deprecated sap.ui.comp.smartfield.SmartField#checkClientError method can not be "+"used with async types. Please use sap.ui.comp.smartfield.SmartField#checkValuesValidity "+"method instead.";L.error(E,this.getMetadata().getName());this.setSimpleClientError(true);return Promise.reject();}if(w.async){var y=j.getDataState();var z=w.formatValue(y.getValue(),x);if(!y.isControlDirty()&&(z===r)){u();return Promise.resolve();}}var R=s.rawValues||j.getValue(),A=w.parseValue(r,j.sInternalType,R),F;if(A&&(A instanceof Promise)){F=A.then(function(H){return w.validateValue(H);}).then(u);F.catch(t);return F;}F=w.validateValue(A,s.bCheckValuesValidity);if(F instanceof Promise){F.catch(t);return F.then(u);}}}catch(G){t(G);return Promise.reject();}u();return Promise.resolve();};p.prototype.isContextTable=function(){return(this.getControlContext()==="responsiveTable"||this.getControlContext()==="table");};p.prototype.isFormContextType=function(){var s=this.getControlContext(),i=l.smartfield.ControlContextType;return(s===i.Form)||(s===i.SmartFormGrid);};p.prototype.isTableContextType=function(){var s=this.getControlContext(),i=l.smartfield.ControlContextType;return(s===i.Table)||(s===i.ResponsiveTable);};p.prototype.getInnerControls=function(){var i,j,q={"sap.m.HBox":function(r){var s,t,u=0;t=r.getItems();if(t){u=t.length;}if(u===0){return[];}if(u===1){return[t[0]];}s=t[1].getContent();if(s){return[t[0],s];}return[t[0]];},"sap.ui.comp.navpopover.SmartLink":function(r){var s=r.getAggregation("innerControl");if(s){return[s];}return[r];}};i=this.getContent();if(i){j=q[i.getMetadata()._sClassName];}if(j){return j(i);}if(i){return[i];}return[];};p.prototype.getAllInnerControls=function(){var i=[],j=this._oControl;if(j){for(var s in j){if(j.hasOwnProperty(s)){var q=j[s];if(q&&(q instanceof Object)){i.push(q);}}}}return i;};p.prototype._getEmbeddedSmartField=function(){var i=this.getContent();if(i){if(i.isA("sap.m.HBox")){var H=i.getItems();if(H){for(var j=0;j<H.length;j++){if(H[j]instanceof p){return H[j];}}}}}return null;};p.prototype.onBeforeRendering=function(){b.prototype.onBeforeRendering.apply(this,arguments);var F=this.getInnerControls();var t=this;var i=this.getClientSideMandatoryCheck(),u=this._getEmbeddedSmartField();if(this.getAriaLabelledBy().length>0){F.forEach(function(j){if(j.addAriaLabelledBy&&j.getAriaLabelledBy){if(j.getAriaLabelledBy().length===0||(t.isContextTable()&&u)){j.addAriaLabelledBy(t.getAriaLabelledBy()[0]);}}});}if(u&&u.data("configdata")&&u.data("configdata").configdata.currency){u.setClientSideMandatoryCheck(i);}};p.prototype.getFirstInnerControl=function(){var i=this.getInnerControls();if(i.length){return i[0]||null;}return null;};p.prototype._checkFieldGroups=function(){var v,M,s=this.getMode();if(this.getBindingContext()&&this._oFactory&&this._oFactory.getMetaData&&(s==="edit")&&!this._bSideEffects){M=this._oFactory.getMetaData();if(M&&(!M.property||(M.property&&!M.property.property))){return;}v=this._getView();if(v&&M){this._setFieldGroup(M,v);}}};p.prototype._setFieldGroup=function(M,v){var i,j=this._oSideEffects.getFieldGroupIDs(M,v);if(j){i=this.getFirstInnerControl();if(i){this._bSideEffects=true;i.setFieldGroupIds(j);}}};p.prototype._getView=function(){var i=this.getParent();while(i){if(i.isA("sap.ui.core.mvc.View")){return i;}i=i.getParent();}return null;};p.prototype._getUomControl=function(){var j=this.getAllInnerControls();if(this.getUomEnabled()&&j&&j.length===1){var q=j[0].getItems?j[0].getItems():[];for(var i=0;i<q.length;i++){if(q[i].isA("sap.ui.comp.smartfield.SmartField")){return q[i];}}}return null;};p.prototype.refreshDataState=function(N,i){var j,q;if(N==="value"){if(i.isLaundering()){if(this.getEditable()){j=this.getBindingContext();if(j&&j.getObject){q=j.getObject();if(q&&q.__metadata&&q.__metadata.created){this._checkCreated=true;return;}}}}if(this._checkCreated&&!i.isLaundering()&&!i.isDirty()){if(this._oFactory){this._oFactory.rebindOnCreated();}this._checkCreated=false;}}};p.prototype.onValidation=function(E){var i,j=E.getParameters(),q=j.newValue!==j.oldValue,r=this.data("configdata")&&this.data("configdata").configdata,s=r&&r.smartFieldRootControl?r.smartFieldRootControl:this,u=s._getEmbeddedSmartField(),U=u&&s._getEmbeddedSmartField().getFirstInnerControl().getId(),t=s.getModel(),v=E.getSource().getId(),w=j.mParameters,x=w&&w.originSource&&w.originSource.getId(),y=w&&w.suppressChangeModelValue||false,z=U&&U!==v,A=U&&U===v,F=U&&x&&U!==x,G=U&&x&&U===x;if(x&&x!==v||y||t.getDefaultBindingMode()!==e.TwoWay){return;}if(F||z){i={valueChanged:q,valueLastValueState:s.getValueState(),unitChanged:false,unitLastValueState:u.getValueState()};}else if(G||A){i={valueChanged:false,valueLastValueState:s.getValueState(),unitChanged:q,unitLastValueState:u.getValueState()};}else{i={valueChanged:q,valueLastValueState:s.getValueState()};}s.fireChangeModelValue(i);};p.prototype.exit=function(){this._bInDestroy=true;var i=null;if(this._oSideEffects){this._oSideEffects.destroy();}if(this._oUtil){this._oUtil.destroy();}if(this._oFactory){this._oFactory.destroy();}var j=this._oControl;if(j){if(j.current==="edit"){i=j["display"]||j["display_uom"];}else{i=j["edit"];}if(j[j.current]&&!j[j.current].getParent()){j[j.current].destroy();}}if(i&&(typeof i.destroy==="function")){i.destroy();}this._oUtil=null;this._oError=null;this._oValue=null;this._oFactory=null;this._oControl=null;this._oSideEffects=null;this._sBindingContextPath="";this._sAnnotationLabel="";};p.getSupportedAnnotationPaths=function(M,E,v,N){var i,u,r=[],j;if(M&&E&&v){j={entitySet:E,entityType:M.getODataEntityType(E.entityType),path:v};i={helper:new a(null,null,M)};if(N){i.navigationPathOnly=N;}i.helper.getProperty(j);p._getFromEntitySet(r,j,i);p._getFromProperty(r,j,i);u=i.helper.getUnitOfMeasure2(j);if(u){p._getFromProperty(r,u,i);}i.helper.destroy();}return r;};p._getFromEntitySet=function(r,M,i){var s;if(M.entitySet){s=i.helper.oAnnotation.getUpdateEntitySetPath(M.entitySet);p._push(s,r,M,i);}};p._push=function(s,r,M,i){var j,q,t,u,R={};if(s){if(i.navigationPathOnly){j=s.split("/");t=j.length;R.entityType=M.entityType;while(t--){q=j.shift();if(q===""){continue;}R=i.helper.getNavigationProperty(R.entityType,q);if(!R.entitySet){break;}if(u){u=u+"/"+q;}else{u=q;}}}else{u=s;}}if(u){if(M.navigationPath){r.push(M.navigationPath+"/"+u);}else{r.push(u);}}};p._getFromProperty=function(r,M,i){var s;if(M.property.property){s=i.helper.oAnnotation.getText(M.property.property);p._push(s,r,M,i);s=i.helper.oAnnotation.getUnit(M.property.property);p._push(s,r,M,i);s=i.helper.oAnnotation.getFieldControlPath(M.property.property);p._push(s,r,M,i);}};p.prototype.addAssociation=function(A,i,s){if(A==="ariaLabelledBy"){this.getInnerControls().forEach(function(j){if(j.addAriaLabelledBy){j.addAriaLabelledBy(i);}});}return b.prototype.addAssociation.apply(this,arguments);};p.prototype.removeAssociation=function(A,v,s){var i=b.prototype.removeAssociation.apply(this,arguments);if(A==="ariaLabelledBy"&&i){this.getInnerControls().forEach(function(j){if(j.removeAriaLabelledBy){j.removeAriaLabelledBy(i);}});}return i;};p.prototype.getAccessibilityInfo=function(){var i=this.getContent();return i&&i.getAccessibilityInfo?i.getAccessibilityInfo():null;};p.prototype.enhanceAccessibilityState=function(E,A){var i=this.getParent();if(i&&i.enhanceAccessibilityState){i.enhanceAccessibilityState(this,A);}};p.prototype.getRequired=function(){if(this.getContextEditable()&&this.getEditable()){return this.getMandatory();}else{return false;}};p.prototype.getBindingMode=function(s){var i=this.getBindingInfo(s);return i?i.parts[0].mode:undefined;};p.prototype._innerControlHasNoValue=function(){var i,j,q,v,r,s,t,u,w=this.getInnerControls(),H=false;for(i=0;i<w.length;i++){r=w[i];s=r.getMetadata().getName();if(s==="sap.m.ObjectStatus"&&!(r.getText().trim()||r.getIcon().trim()||r.getTitle().trim())){H=true;break;}else{u=O.getBoundPropertiesMapInfoForControl(s,{propertyName:"value"});if(!Array.isArray(u)){return false;}q=0;for(j=0;j<u.length;j++){v=undefined;t=u[j];v=r.getProperty(t);if(v===""||v===null){q+=1;}}if(q===u.length){H=true;break;}}}return H;};p.prototype._getHistoryEnabled=function(){return this.getHistoryEnabled();};p.prototype.getFormValueProperty=function(){return"value";};p.prototype.getFormFormattedValue=function(){return this.getValue()?this.getValue():"";};return p;},true);
