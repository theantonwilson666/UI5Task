/*
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/model/SimpleType","sap/ui/core/format/NumberFormat","sap/ui/model/odata/type/Boolean","sap/ui/comp/smartfield/type/Double","sap/ui/comp/smartfield/type/DateTime","sap/ui/comp/odata/type/StringDate","sap/ui/comp/odata/type/FiscalDate","sap/ui/comp/odata/type/NumericText","sap/ui/comp/smartfield/type/DateTimeOffset","sap/ui/comp/smartfield/type/Decimal","sap/ui/comp/smartfield/type/Int16","sap/ui/comp/smartfield/type/Int32","sap/ui/comp/smartfield/type/Int64","sap/ui/comp/smartfield/type/Byte","sap/ui/comp/smartfield/type/SByte","sap/ui/comp/smartfield/type/String","sap/ui/comp/smartfield/type/TextArrangementString","sap/ui/comp/smartfield/type/TextArrangementGuid","sap/ui/comp/smartfield/type/AbapBool","sap/ui/comp/smartfield/type/Currency","sap/ui/comp/smartfield/type/Time","sap/ui/comp/smartfield/type/Guid","sap/ui/comp/odata/MetadataAnalyser","sap/ui/comp/odata/FiscalMetadata"],function(S,N,B,D,a,b,F,c,d,e,I,f,g,h,i,j,T,k,A,C,l,G,M,m){"use strict";var O=function(P){this._oParent=P;};O.prototype.getType=function(P,n,r,s){s=s||{};var t=this._oParent.getBindingInfo("value"),u=t&&t.binding&&t.binding.getType(),v=s.composite&&(u instanceof S);if(u&&!v){return o(u);}if(P&&P.property&&P.property.type){if(!u){r=this.getConstraints(P.property,r);n=this.getFormatOptions(P.property,n);}switch(P.property.type){case"Edm.Boolean":return new B(n,r);case"Edm.Double":return new D(n,r);case"Edm.Decimal":case"Edm.Single":return new e(n,this._getDecimalConstraints(P,r));case"Edm.Int16":return new I(n,r);case"Edm.Int32":return new f(n,r);case"Edm.Int64":return new g(n,r);case"Edm.Byte":return new h(n,r);case"Edm.SByte":return new i(n,r);case"Edm.DateTimeOffset":return new d(n,r);case"Edm.DateTime":return new a(n,this._getDateTimeConstraints(P,r));case"Edm.String":if(this.isCalendarDate(P)){return new b(n);}var w=m.getFiscalAnotationType(P.property);if(w){return new F(n,r,{anotationType:w});}if(!u){r=this._getStringConstraints(P);}if(r.isDigitSequence&&!s.composite){return new c(n,r);}if(s.composite){n=Object.assign({},n,this._getTextArrangementFormatOptions());return new T(n,r,this._getTextArrangementOptions(s));}return new j(n,r);case"Edm.Time":return new l(n,r);case"Edm.Guid":if(s.composite){n=Object.assign({},n,this._getTextArrangementFormatOptions());return new k(n,r,this._getTextArrangementOptions(s));}return new G(n,r);default:return null;}}return null;};function o(t){var P=t.parseValue,n=t.destroy;t.parseValue=function(v,s){var r=P.apply(this,arguments);if(typeof this.oFieldControl==="function"){this.oFieldControl(v,s);}return r;};t.destroy=function(){n.apply(this,arguments);this.oFieldControl=null;};return t;}O.prototype.getConstraints=function(P,n){return Object.assign({},n,{nullable:M.isNullable(P)});};O.prototype.getFormatOptions=function(P,n){var r={};if(M.isUpperCase(P)){r.displayFormat="UpperCase";}return Object.assign({},n,r);};O.prototype._getDateTimeConstraints=function(P,r){var s={},n;if((P.property["sap:display-format"]==="Date")||this.isCalendarDate(P)){s={displayFormat:"Date"};}for(n in r){s[n]=r[n];}return s;};O.prototype.getMaxLength=function(P,n){var v=[],V,r=0;if(n&&n.constraints){if(n.constraints.maxLength&&n.constraints.maxLength>-1){v.push(n.constraints.maxLength);}}if(n&&n.type&&n.type.oConstraints){if(n.type.oConstraints.maxLength&&n.type.oConstraints.maxLength>-1){v.push(n.type.oConstraints.maxLength);}}if(P&&P.property&&P.property.maxLength){var s=parseInt(P.property.maxLength);if(s>-1){v.push(s);}}var t=this._oParent.getMaxLength();if(t>0){v.push(t);}var u=v.length;while(u--){V=v[u];if(V>0){if(r>0){if(V<r){r=V;}}else{r=V;}}}return r;};O.prototype._getDecimalConstraints=function(P,n){var E=P.property;n=n||{};if(E.precision){n.precision=parseInt(E.precision);}if(E.scale){n.scale=parseInt(E.scale);}if(E["sap:variable-scale"]){n.variableScale=E["sap:variable-scale"]==="true";}return n;};O.prototype._getTextArrangementFormatOptions=function(){return{textArrangement:this._oParent.getControlFactory()._getDisplayBehaviourConfiguration()};};O.prototype._getStringConstraints=function(P,n){n=n||{};var r=this._oParent.getBindingInfo("value"),s=this.getMaxLength(P,r),E;if(r&&r.type&&r.type.oConstraints){if(r.type.oConstraints.equals){E=r.type.oConstraints.equals;}}if(s>0||E){if(s>0){n.maxLength=s;}if(E){n.equals=E;}}if(M.isDigitSequence(P.property)){n.isDigitSequence=true;}return n;};O.prototype._getTextArrangementOptions=function(n){var t=this._oParent.getControlFactory().oTextArrangementDelegate;return{keyField:n.keyField,descriptionField:n.descriptionField,valueListNoValidation:n.valueListNoValidation,onBeforeValidateValue:t.onBeforeValidateValue.bind(t)};};O.prototype.isCalendarDate=function(P){var n=P.property["com.sap.vocabularies.Common.v1.IsCalendarDate"];if(n&&n.Bool){return n.Bool?n.Bool!=="false":true;}return false;};O.prototype.getDisplayFormatter=function(P,s){s=s||{};if(s.currency){return this.getCurrencyDisplayFormatter(s);}else if(s.type&&s.type.oConstraints&&s.type.oConstraints.scale&&P.scale){P.scale=s.type.oConstraints.scale;}return this.getUOMDisplayFormatter(P);};O.prototype.getCurrencyDisplayFormatter=function(s){var n=N.getCurrencyInstance({showMeasure:false});return function(r,t){var v,u,P,w=this&&this.oParent&&this.oParent.oParent,x=w&&w.isA("sap.ui.comp.smartfield.SmartField")&&w.isFormContextType();if(!r||!t||t==="*"){return"";}if(!s.currency){v=r+="\u2008";return v;}u=n.oLocaleData.getCurrencyDigits(t);v=n.format(r,t);if(u===0&&!x){v+="\u2008";}P=3-u;if(P&&!x){v=v.padEnd(v.length+P,"\u2007");}else{v+="\u2007";}if(s.mask){return O.maskValue(v);}return v;};};O.prototype.getUOMDisplayFormatter=function(P){var n={};if(P.scale){n.minFractionDigits=n.maxFractionDigits=parseInt(P.scale);}if(P.precision){n.precision=parseInt(P.precision);}var r=N.getFloatInstance(n);return function(v,u){if((v==null)||!u||(u==="*")){return"";}if(isNaN(parseFloat(v))){return v.toString()+"\u2008";}return r.format(v,u)+"\u2008";};};O.maskValue=function(t){if(t){return t.replace(new RegExp(".","igm"),"*");}return t;};O.prototype.getCurrencyType=function(P){if(P){var n=this._getDecimalConstraints(P),r=this.getConstraints(P.property,n),s=p(r),t=q(n);return new C(s,this.getConstraints(P.property,t));}return null;};function p(n){var E=n.nullable?null:0;return{showMeasure:false,parseAsString:true,emptyString:E,precision:n.precision};}function q(n){return{precision:n.precision,scale:n.scale,variableScale:n.variableScale};}O.prototype.getAbapBoolean=function(){return new A();};O.prototype.destroy=function(){this._oParent=null;};return O;},true);
