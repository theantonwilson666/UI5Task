/*
 * ! SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/base/Object","./Constants"],function(B,c){"use strict";var i;var H=B.extend("sap.ui.comp.historyvalues.HistoryGlobalDataService",{constructor:function(){B.apply(this,arguments);this._initialize();}});H.prototype._initialize=function(){this._initializeHistoryData=this._initializeHistoryData.bind(this);this._sContainerId=c.getHistoryPrefix()+"HistorySettings";this._sItemId=c.getHistoryPrefix()+"settings";this._oPersonalizer=null;this._oData={};this._oDataReadyPromise=this._getPersonalizer().getPersData().then(this._initializeHistoryData);};H.prototype._initializeHistoryData=function(d){this._oData=d||this._getDefaultData();return Object.assign({},this._oData);};H.prototype._getPersonalizer=function(){if(this._oPersonalizer){return this._oPersonalizer;}var p=sap.ushell.Container.getService("Personalization"),s={keyCategory:p.constants.keyCategory.FIXED_KEY,writeFrequency:p.constants.writeFrequency.LOW,clientStorageAllowed:false,validity:Infinity},P={container:this._sContainerId,item:this._sItemId};this._oPersonalizer=p.getPersonalizer(P,s);return this._oPersonalizer;};H.prototype._getDefaultData=function(){return{historyEnabled:true,apps:{}};};H.prototype._isDataReady=function(){return this._oDataReadyPromise;};H.prototype.getHistoryEnabled=function(){return this._isDataReady().then(function(){return this._oData.historyEnabled;}.bind(this));};H.prototype.setHistoryEnabled=function(e){return this._isDataReady().then(function(){this._oData.historyEnabled=e;return this._getPersonalizer().setPersData(this._oData);}.bind(this));};H.prototype.getApps=function(){return this._isDataReady().then(function(){return Object.assign({},this._oData.apps);}.bind(this));};H.prototype.setApps=function(a){return this._isDataReady().then(function(){this._oData.apps=a;return this._getPersonalizer().setPersData(this._oData);}.bind(this));};H.prototype.deleteHistory=function(){return this._isDataReady().then(function(){var d=this._oData,D=[],a=d.apps;Object.keys(a).forEach(function(k){D.push(sap.ushell.Container.getService("Personalization").delContainer(a[k]));});return Promise.all(D);}.bind(this));};H.prototype.destroy=function(){B.prototype.destroy.apply(this,arguments);this._sContainerId="";this._sItemId="";this._oPersonalizer=null;this._oData={};this._oDataReadyPromise=null;};return{getInstance:function(){if(!i){i=new H();}return i;}};});
