/*
 * ! SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/thirdparty/jquery','sap/m/library','sap/ui/core/library','sap/ui/core/Core','sap/ui/core/ShortcutHintsMixin','sap/ui/core/format/ListFormat','sap/ui/events/KeyCodes','sap/ui/comp/util/DateTimeUtil','sap/ui/comp/util/FilterUtil','sap/m/Column','sap/m/ColumnListItem','sap/m/Label','sap/m/MessageBox','sap/m/Table','sap/m/Text','sap/m/Title','sap/m/OverflowToolbar','sap/m/ToolbarSpacer','sap/m/OverflowToolbarButton','sap/m/ToolbarSeparator','sap/m/VBox','sap/m/FlexItemData','sap/ui/comp/library','sap/ui/comp/providers/TableProvider','sap/ui/comp/smartfilterbar/FilterProvider','sap/ui/comp/smartvariants/SmartVariantManagement','sap/ui/model/Sorter','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/model/json/JSONModel','sap/ui/table/AnalyticalColumn','sap/ui/table/AnalyticalTable','sap/ui/table/Column','sap/ui/table/Table','sap/ui/table/TreeTable','sap/ui/comp/personalization/Controller','sap/ui/comp/personalization/Util','sap/ui/comp/util/FormatUtil','sap/ui/comp/util/FullScreenUtil','sap/ui/comp/odata/ODataModelUtil','sap/ui/comp/odata/ODataType','sap/ui/comp/state/UIState','sap/ui/comp/smartvariants/PersonalizableInfo','sap/ui/core/format/NumberFormat','sap/ui/Device','sap/base/Log','sap/base/util/deepEqual','sap/base/util/merge',"sap/m/ColumnHeaderPopover",'sap/m/ColumnPopoverActionItem','sap/m/ColumnPopoverSortItem','sap/m/Menu','sap/m/MenuButton','sap/m/MenuItem','sap/m/Button','sap/m/Link','sap/m/MessageStrip','sap/ui/core/InvisibleMessage','sap/ui/util/openWindow','sap/ui/core/theming/Parameters','sap/m/plugins/PluginBase','sap/m/plugins/ColumnResizer'],function(q,M,c,C,S,L,K,D,F,a,b,d,f,R,T,g,O,h,j,k,V,l,m,n,o,p,r,s,t,J,A,u,v,w,x,y,P,z,B,E,G,U,H,N,I,Q,W,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1){"use strict";var k1=M.ButtonType;var l1=M.MenuButtonMode;var m1=M.ToolbarDesign;var n1=M.ToolbarStyle;var o1=c.SortOrder;var p1=m.smarttable.InfoToolbarBehavior;var q1=V.extend("sap.ui.comp.smarttable.SmartTable",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smarttable/SmartTable.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},enableDataStateFiltering:{type:"boolean",group:"Behavior",defaultValue:false,visibility:"hidden"},smartFilterId:{type:"string",group:"Misc",defaultValue:null},ignoredFields:{type:"string",group:"Misc",defaultValue:null},initiallyVisibleFields:{type:"string",group:"Misc",defaultValue:null},requestAtLeastFields:{type:"string",group:"Misc",defaultValue:null},ignoreFromPersonalisation:{type:"string",group:"Misc",defaultValue:null},tableType:{type:"sap.ui.comp.smarttable.TableType",group:"Misc",defaultValue:null},useVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},showVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},useExportToExcel:{type:"boolean",group:"Misc",defaultValue:true},exportType:{type:"sap.ui.comp.smarttable.ExportType",group:"Misc",defaultValue:"UI5Client"},useTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},headerLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:sap.ui.core.TitleLevel.Auto},toolbarStyleClass:{type:"string",group:"Misc",defaultValue:null},enableCustomFilter:{type:"boolean",group:"Misc",defaultValue:true},persistencyKey:{type:"string",group:"Misc",defaultValue:null},useOnlyOneSolidToolbar:{type:"boolean",group:"Misc",defaultValue:false},placeToolbarInTable:{type:"boolean",group:"Misc",defaultValue:false},currentVariantId:{type:"string",group:"Misc",defaultValue:null},editable:{type:"boolean",group:"Misc",defaultValue:false},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},tableBindingPath:{type:"string",group:"Misc",defaultValue:null},editTogglable:{type:"boolean",group:"Misc",defaultValue:false},demandPopin:{type:"boolean",group:"Misc",defaultValue:false},showFullScreenButton:{type:"boolean",group:"Misc",defaultValue:false},initialNoDataText:{type:"string",group:"Misc",defaultValue:null},useInfoToolbar:{type:"sap.ui.comp.smarttable.InfoToolbarBehavior",group:"Behavior",defaultValue:p1.Auto},showDetailsButton:{type:"boolean",group:"Misc",defaultValue:false},detailsButtonSetting:{type:"sap.ui.core.Priority[]",group:"Behavior"},enableAutoColumnWidth:{type:"boolean",group:"Misc",defaultValue:false}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},aggregations:{customToolbar:{type:"sap.m.Toolbar",multiple:false},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false},noData:{type:"sap.ui.core.Control",altTypes:["string"],multiple:false},semanticKeyAdditionalControl:{type:"sap.ui.core.Control",multiple:false}},events:{initialise:{},beforeRebindTable:{},editToggled:{},dataRequested:{},dataReceived:{},afterVariantInitialise:{},afterVariantSave:{parameters:{currentVariantId:{type:"string"}}},afterVariantApply:{parameters:{currentVariantId:{type:"string"}}},showOverlay:{},fieldChange:{},fullScreenToggled:{parameters:{fullScreen:{type:"boolean"}}},beforeExport:{parameters:{exportSettings:{type:"object"},userExportSettings:{type:"object"}}},beforePaste:{allowPreventDefault:true,parameters:{columnInfos:{type:"object[]"}}},paste:{parameters:{result:{type:"object"}}}}},renderer:{apiVersion:2},constructor:function(){V.apply(this,arguments);this._aExistingColumns=[];this._aAlwaysSelect=[];this._oTemplate=null;this._mFieldMetadataByKey={};this._createToolbar();this._oP13nDialogSettings=this.data("p13nDialogSettings");if(typeof this._oP13nDialogSettings==="string"){try{this._oP13nDialogSettings=JSON.parse(this._oP13nDialogSettings);}catch(e){this._oP13nDialogSettings=null;}}this._bIsFilterPanelEnabled=(this._oP13nDialogSettings&&this._oP13nDialogSettings.filter)?this._oP13nDialogSettings.filter.visible!==false:true;this._bIsSortPanelEnabled=(this._oP13nDialogSettings&&this._oP13nDialogSettings.sort)?this._oP13nDialogSettings.sort.visible!==false:true;this._createTable();this.attachModelContextChange(this._initialiseMetadata,this);}});q1.prototype.getEnableDataStateFiltering=function(){return this.getProperty("enableDataStateFiltering");};q1.prototype.setEnableDataStateFiltering=function(e){if(this.getEnableDataStateFiltering()===e){return this;}this.setProperty("enableDataStateFiltering",e,true);if(!e){this._onApplyMessageFilter(e);if(this._oDataStateIndicator){this._oDataStateIndicator.detachEvent("dataStateChange",this._onDataStateChange,this);this._oDataStateIndicator.detachEvent("messageLinkPressed",this._onMessageLinkPressed,this);this._oDataStateIndicator=null;}}this._bApplyFilter=false;this._handleDataStateIndicator();return this;};q1.prototype._handleDataStateIndicator=function(){if(!this._oTable||!this.getEnableDataStateFiltering()){return;}var i=this._oTable.getDependents();if(!i.length){return;}var e=i.find(function(t1){return t1.isA("sap.m.plugins.DataStateIndicator");});if(!e){return;}this._oDataStateIndicator=e;this._oDataStateIndicator.attachEvent("dataStateChange",this._onDataStateChange,this);var s1=C.getLibraryResourceBundle("sap.ui.comp");this._oDataStateIndicator.setMessageLinkText(s1.getText("SMARTTABLE_MESSAGESTRIP_FILTER_ITEMS"));this._oDataStateIndicator.attachEvent("messageLinkPressed",this._onMessageLinkPressed,this);this._oDataStateIndicator.refresh();};q1.prototype.setHeaderLevel=function(e){if(this.getHeaderLevel()===e){return this;}this.setProperty("headerLevel",e,true);this._headerText&&this._headerText.setLevel(e);return this;};q1.prototype._onMessageLinkPressed=function(){this._bApplyFilter=!this._bApplyFilter;this._onApplyMessageFilter(this._bApplyFilter);};q1.prototype._getP13nFilterMessageStrip=function(){var e,i;if(this.getEnableDataStateFiltering()){i=C.getLibraryResourceBundle("sap.ui.comp");e=new e1({text:i.getText("SMARTTABLE_P13N_FILTER_MESSAGESTRIP"),type:"Information",visible:this._bApplyFilter,link:new d1({text:i.getText("SMARTTABLE_MESSAGESTRIP_CLEAR_FILTER"),press:[function(){e.setVisible(false);this._onApplyMessageFilter(false);this._bApplyFilter=!this._bApplyFilter;},this]})});}return e;};q1.prototype._onDataStateChange=function(e){var i=e.getParameter("filteredMessages")||[];this._sDataStateType=e.getSource()._getCombinedType(i).toUpperCase();if(!i.length){this._onApplyMessageFilter(false);}};q1.prototype._onApplyMessageFilter=function(e){this._filterByDataStateError(e);var i=C.getLibraryResourceBundle("sap.ui.comp");if(this._oDataStateIndicator&&!e){this._oDataStateIndicator.setMessageLinkText(i.getText("SMARTTABLE_MESSAGESTRIP_FILTER_ITEMS"));this._getRowBinding().checkDataState();}else if(this._oDataStateIndicator){this._oDataStateIndicator.setMessageLinkText(i.getText("SMARTTABLE_MESSAGESTRIP_CLEAR_FILTER"));}};q1.prototype.init=function(){V.prototype.init.call(this);this.addStyleClass("sapUiCompSmartTable");this.setFitContainer(true);this._aColumnKeys=[];this._aDeactivatedColumns=[];this._mLazyColumnMap={};};q1.prototype._getVariantManagementControl=function(e){var i=null;if(e){if(typeof e==='string'){i=C.byId(e);}else{i=e;}if(i){if(!(i instanceof p)){Q.error("Control with the id="+e.getId?e.getId():e+" not of expected type");return null;}}}return i;};q1.prototype._createVariantManagementControl=function(){if(this._oVariantManagement||(!this.getUseVariantManagement()&&!this.getUseTablePersonalisation())||!this.getPersistencyKey()){return;}var e=new H({type:"table",keyName:"persistencyKey",dataSource:"TODO"});e.setControl(this);var i=this.getSmartVariant();if(i){this._oVariantManagement=this._getVariantManagementControl(i);}else if(this._oSmartFilter&&this._oSmartFilter.data("pageVariantPersistencyKey")){i=this._oSmartFilter.getSmartVariant();if(i){this._oVariantManagement=this._getVariantManagementControl(i);}}else{this._oVariantManagement=new p(this.getId()+"-variant",{showShare:true});}if(this._oVariantManagement){this._oVariantManagement.addPersonalizableControl(e);this._oVariantManagement.attachSave(this._variantSaved,this);this._oVariantManagement.attachAfterSave(this._variantAfterSave,this);this._oVariantManagement.initialise(this._variantInitialised,this);}};q1.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD";}this.fireAfterVariantInitialise();if(this._oVariantManagement&&!this._oVariantManagement.getEnabled()){this._checkAndTriggerBinding();}};q1.prototype._variantSaved=function(){if(this._oPersController){this._oPersController.setPersonalizationData(this._oCurrentVariant,true);}};q1.prototype._variantAfterSave=function(){this.fireAfterVariantSave({currentVariantId:this.getCurrentVariantId()});};q1.prototype.setTableBindingPath=function(e){this.setProperty("tableBindingPath",e,true);return this;};q1.prototype.setShowTablePersonalisation=function(e){this.setProperty("showTablePersonalisation",e,true);if(this._oTablePersonalisationButton){this._oTablePersonalisationButton.setVisible(e);}return this;};q1.prototype.setUseVariantManagement=function(e){this.setProperty("useVariantManagement",e,true);if(this._oPersController){this._oPersController.setResetToInitialTableState(!e);}return this;};q1.prototype.setShowVariantManagement=function(e){this.setProperty("showVariantManagement",e,true);if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(e);if(this._oSeparator){this._oSeparator.setVisible(e);}}return this;};q1.prototype.setToolbarStyleClass=function(e){this.setProperty("toolbarStyleClass",e,true);return this;};q1.prototype.setCustomToolbar=function(e){this._oCustomToolbar=e;return this;};q1.prototype.getCustomToolbar=function(){return this._oCustomToolbar;};q1.prototype.setHeader=function(e){var i=this.getProperty("header"),s1;this.setProperty("header",e,true);if(this.bIsInitialised&&this._oToolbar){s1=(!i===!e);if(!s1){this._createToolbarContent();}else{this._refreshHeaderText();}}return this;};q1.prototype.setShowRowCount=function(e){this.setProperty("showRowCount",e,true);this._refreshHeaderText();return this;};q1.prototype.setEditable=function(e){if((e=!!e)==this.getEditable()){return this;}this.setProperty("editable",e,true);if(this._oEditModel){this._oEditModel.setProperty("/editable",e);}if(this._oEditButton){this._oEditButton.setIcon(e?"sap-icon://display":"sap-icon://edit");}if(this._isMobileTable&&this._oTable.setKeyboardMode){this._oTable.setKeyboardMode(e?"Edit":"Navigation");}this._updateVisibleColumnsWidthForEdit();return this;};q1.prototype.setDemandPopin=function(e){var i=this.getDemandPopin();if(i===e){return this;}this.setProperty("demandPopin",e,true);if(this.bIsInitialised){if(e){this._updateColumnsPopinFeature();}else{this._deactivateColumnsPopinFeature();}}return this;};q1.prototype._refreshHeaderText=function(){if(!this._headerText){return;}if(!this._oNumberFormatInstance){this._oNumberFormatInstance=N.getFloatInstance();}var i;var e=this.getHeader();this._headerText.setVisible(!!e);if(this.getShowRowCount()){i=this._getRowCount(true);var s1=this._oNumberFormatInstance.format(i);e+=" ("+s1+")";}this._headerText.setText(e);this._updateAriaLabelledByInfo();if(this._bUpdateTableAnnouncement){this._bUpdateTableAnnouncement=false;this._updateTableAnnouncement(i);}};q1.prototype._updateAriaLabelledByInfo=function(){var e=this._headerText.getId();if(this._oTable&&this._oTable.addAriaLabelledBy){if(this._headerText.getVisible()){if(this._oTable.getAriaLabelledBy().indexOf(e)===-1){this._oTable.addAriaLabelledBy(e);}}else{this._oTable.removeAriaLabelledBy(e);}}};q1.prototype._updateTableAnnouncement=function(i){var e=f1.getInstance();if(e){var s1=C.getLibraryResourceBundle("sap.ui.comp");var t1=this.getHeader();if(i===undefined&&this._getRowCount(false)>0){e.announce(s1.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED",[t1]));}else if(i>1){e.announce(s1.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED_MULT",[t1,i]));}else if(i===1){e.announce(s1.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED_SING",[t1,i]));}else{e.announce(s1.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED_NOITEMS",[t1]));}}};q1.prototype._addFullScreenButton=function(){if(this._oFullScreenButton){this._oToolbar.removeContent(this._oFullScreenButton);}if(this.getShowFullScreenButton()){if(!this._oFullScreenButton){this._oFullScreenButton=new j(this.getId()+"-btnFullScreen",{press:[function(){this._toggleFullScreen(!this.bFullScreen);},this]});this._oFullScreenButton.addStyleClass("sapUiCompSmartTableToolbarContent");}this._renderFullScreenButton();this._oToolbar.addContent(this._oFullScreenButton);}};q1.prototype._createToolbar=function(){var e=null;if(!this._oToolbar){e=this.getCustomToolbar();if(e){this._oToolbar=e;}else{this._oToolbar=new O({design:m1.Transparent,style:this.getTableType()==="ResponsiveTable"?n1.Standard:n1.Clear});this._oToolbar.addStyleClass("sapUiCompSmartTableToolbar");if(this.getToolbarStyleClass()){this._oToolbar.addStyleClass(this.getToolbarStyleClass());}}this._oToolbar.setLayoutData(new l({shrinkFactor:0}));}};q1.prototype._toggleShowHideDetails=function(e){if(!this._oShowHideDetailsButton||(e===this.bHideDetails)){return;}this.bHideDetails=e;if(this.bHideDetails){this._oTable.setHiddenInPopin(this._getImportanceToHide());}else{this._oTable.setHiddenInPopin([]);}this._renderShowHideDetailsButton();};q1.prototype._getImportanceToHide=function(){var e=this.getDetailsButtonSetting()||[];var i=[];if(e.length){i=e;}else{i=I.system.phone?["Low","Medium"]:["Low"];}return i;};q1.prototype._renderShowHideDetailsButton=function(){var e=C.getLibraryResourceBundle("sap.ui.comp"),i;i=this.bHideDetails?e.getText("TABLE_SHOWDETAILS_TEXT"):e.getText("TABLE_HIDEDETAILS_TEXT");this._oShowHideDetailsButton.setTooltip(i);this._oShowHideDetailsButton.setText(i);};q1.prototype._toggleFullScreen=function(e,i){if(!this._oFullScreenButton||(e===this.bFullScreen&&!i)){return;}this.bFullScreen=e;B.toggleFullScreen(this,this.bFullScreen,this._oFullScreenButton,this._toggleFullScreen);this._renderFullScreenButton();this.fireFullScreenToggled({fullScreen:e});};q1.prototype._renderFullScreenButton=function(){var e=C.getLibraryResourceBundle("sap.ui.comp"),i;i=this.bFullScreen?e.getText("CHART_MINIMIZEBTN_TOOLTIP"):e.getText("CHART_MAXIMIZEBTN_TOOLTIP");this._oFullScreenButton.setTooltip(i);this._oFullScreenButton.setText(i);this._oFullScreenButton.setIcon(this.bFullScreen?"sap-icon://exit-full-screen":"sap-icon://full-screen");};q1.prototype._createToolbarContent=function(){if(!this._oToolbar){this._createToolbar();}this._addVariantManagementToToolbar();this._addSeparatorToToolbar();this._addHeaderToToolbar();this._addSpacerToToolbar();this._addEditTogglableToToolbar();this._addShowHideDetailsButton();this._addTablePersonalisationToToolbar();this._addExportToExcelToToolbar();this._addFullScreenButton();this._bToolbarInsertedIntoItems=true;this._placeToolbar();};q1.prototype._placeToolbar=function(){if(!this.getPlaceToolbarInTable()){this.insertItem(this._oToolbar,0);}else if(this._isMobileTable){this._oTable.setHeaderToolbar(this._oToolbar);}else{this._oTable.addExtension(this._oToolbar);}};q1.prototype.getToolbar=function(){return this._oToolbar;};q1.prototype._addEditTogglableToToolbar=function(){var e;if(this._oEditButton){this._oToolbar.removeContent(this._oEditButton);}if(this.getEditTogglable()){if(!this._oEditButton){e=C.getLibraryResourceBundle("sap.ui.comp").getText("TABLE_EDITTOGGLE_TOOLTIP");this._oEditButton=new j(this.getId()+"-btnEditToggle",{icon:this.getEditable()?"sap-icon://display":"sap-icon://edit",text:e,tooltip:e,press:[function(){var i=this.getEditable();i=!i;this.setEditable(i,true);this.fireEditToggled({editable:i});},this]});this._oEditButton.addStyleClass("sapUiCompSmartTableToolbarContent");}this._oToolbar.addContent(this._oEditButton);}};q1.prototype._addHeaderToToolbar=function(){if(this._headerText){this._oToolbar.removeContent(this._headerText);}if(!this._headerText){this._headerText=new g(this.getId()+"-header");this._headerText.addStyleClass("sapMH4Style");this._headerText.addStyleClass("sapUiCompSmartTableHeader");this._headerText.addStyleClass("sapUiCompSmartTableToolbarContent");this._headerText.setLevel(this.getHeaderLevel());}this._refreshHeaderText();this._oToolbar.insertContent(this._headerText,0);};q1.prototype._addSeparatorToToolbar=function(){if(this._oSeparator){this._oToolbar.removeContent(this._oSeparator);}if(this.getHeader()&&this.getUseVariantManagement()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){if(!this._oSeparator){this._oSeparator=new k(this.getId()+"-toolbarSeperator");if(!this.getShowVariantManagement()){this._oSeparator.setVisible(false);}}this._oToolbar.insertContent(this._oSeparator,0);}if(this._oToolbar){this._oToolbar.addStyleClass("sapMTBHeader-CTX");}};q1.prototype._addVariantManagementToToolbar=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oToolbar.removeContent(this._oVariantManagement);if(this.getUseVariantManagement()){this._oToolbar.insertContent(this._oVariantManagement,0);this._oVariantManagement.addStyleClass("sapUiCompSmartTableToolbarContent");if(!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(this.getShowVariantManagement());}}}};q1.prototype._addSpacerToToolbar=function(){var e=false,s1=this._oToolbar.getContent(),i,t1;if(s1){t1=s1.length;i=0;for(i;i<t1;i++){if(s1[i]instanceof h){e=true;break;}}}if(!e){this._oToolbar.addContent(new h(this.getId()+"-toolbarSpacer"));}};q1.prototype._createShowHideDetailsButton=function(){this._oShowHideDetailsButton=new c1(this.getId()+"-btnShowHideDetails",{visible:false,press:[function(){this._toggleShowHideDetails(!this.bHideDetails);},this]});this._oShowHideDetailsButton.addStyleClass("sapUiCompSmartTableToolbarContent");};q1.prototype._addShowHideDetailsButton=function(){if(this._oShowHideDetailsButton){this._oToolbar.removeContent(this._oShowHideDetailsButton);}if(this.getShowDetailsButton()&&this._isMobileTable){this.bHideDetails=true;if(!this._oShowHideDetailsButton){this._createShowHideDetailsButton();}this._renderShowHideDetailsButton();this._oToolbar.addContent(this._oShowHideDetailsButton);}};q1.prototype._addTablePersonalisationToToolbar=function(){var e;if(this._oTablePersonalisationButton){this._oToolbar.removeContent(this._oTablePersonalisationButton);}if(this.getUseTablePersonalisation()){if(!this._oTablePersonalisationButton){e=C.getLibraryResourceBundle("sap.ui.comp").getText("TABLE_PERSOBTN_TOOLTIP");this._oTablePersonalisationButton=new j(this.getId()+"-btnPersonalisation",{icon:"sap-icon://action-settings",text:e,tooltip:e,press:[function(i){this._oPersController.openDialog();},this]});S.addConfig(this._oTablePersonalisationButton,{messageBundleKey:I.os.macintosh?"SMARTTABLE_SHORTCUT_SHOW_SETTINGS_MAC":"SMARTTABLE_SHORTCUT_SHOW_SETTINGS"},this);this._oTablePersonalisationButton.addStyleClass("sapUiCompSmartTableToolbarContent");this._oTablePersonalisationButton.setVisible(this.getShowTablePersonalisation());}this._oToolbar.addContent(this._oTablePersonalisationButton);}};q1.prototype._triggerGWExport=function(){var e=C.getLibraryResourceBundle("sap.ui.comp");var i=function(){var t1=this._getRowBinding();var u1=t1.getDownloadUrl("xlsx");u1=this._removeExpandParameter(u1);if(u1&&u1.length>2048&&I.browser.msie){f.error(e.getText("DOWNLOAD_TOO_COMPLEX_TEXT"));return;}var v1={url:u1};this.fireBeforeExport({exportSettings:v1});g1(v1.url);}.bind(this);var s1=this._getRowCount(true);if(s1>10000){f.confirm(e.getText("DOWNLOAD_CONFIRMATION_TEXT",s1),{actions:[f.Action.YES,f.Action.NO],onClose:function(t1){if(t1===f.Action.YES){i();}}});}else{i();}};q1.prototype._addExportToExcelToToolbar=function(){if(this._oUseExportToExcel){this._oToolbar.removeContent(this._oUseExportToExcel);}if(!this.getUseExportToExcel()){return;}if(!this._oUseExportToExcel){var e=this.getId()+"-btnExcelExport";var i="sap-icon://excel-attachment";var s1=C.getLibraryResourceBundle("sap.ui.comp");if(this.getExportType()==="UI5Client"){this._oUseExportToExcel=this._createClientExportButton(e,i);}if(this._bTableSupportsExcelExport&&this.getExportType()==="GW"){var t1;t1=s1.getText("TABLE_EXPORT_TEXT");this._oUseExportToExcel=new j(e,{icon:i,text:t1,tooltip:t1,press:[this._triggerGWExport,this]});}this._setExcelExportEnableState();if(this._oUseExportToExcel){this._oUseExportToExcel.addStyleClass("sapUiCompSmartTableToolbarContent");}}this._oToolbar.addContent(this._oUseExportToExcel);};q1.prototype._openExportSettings=function(){var e=this;this._loadExportLibrary().then(function(){sap.ui.require(['sap/ui/export/ExportUtils'],function(i){i.getExportSettingsViaDialog(e._cachedExcelSettings,e).then(function(s1){e._cachedExcelSettings=s1;e._triggerUI5ClientExport(s1);});});});};q1.prototype._createClientExportButton=function(e,i){var s1=C.getLibraryResourceBundle("sap.ui.comp");var t1={fileName:this.getHeader()};if(!this._cachedExcelSettings){this._cachedExcelSettings=t1;}var u1=new a1(e,{icon:i,tooltip:s1.getText("TABLE_EXPORT_TEXT"),type:k1.Ghost,buttonMode:l1.Split,useDefaultActionOnly:true,defaultAction:[function(){this._triggerUI5ClientExport(t1);},this],menu:[new _({items:[new b1({text:s1.getText("QUICK_EXPORT"),press:[function(){this._triggerUI5ClientExport(t1);},this]}),new b1({text:s1.getText("EXPORT_WITH_SETTINGS"),press:[this._openExportSettings,this]})]})]});S.addConfig(u1._getButtonControl(),{addAccessibilityLabel:true,messageBundleKey:I.os.macintosh?"SMARTTABLE_SHORTCUT_EXPORT_TO_EXCEL_MAC":"SMARTTABLE_SHORTCUT_EXPORT_TO_EXCEL"},this);return u1;};q1.prototype.onkeydown=function(e){if(e.isMarked()){return;}if((e.metaKey||e.ctrlKey)&&e.shiftKey&&e.which===K.E){if(this.getUseExportToExcel()&&this.getExportType()==="UI5Client"&&this._oUseExportToExcel&&this._oUseExportToExcel.getEnabled()){this._openExportSettings();e.setMarked();e.preventDefault();}}else if((e.metaKey||e.ctrlKey)&&e.which===K.COMMA){if(this.getUseTablePersonalisation()&&this._oTablePersonalisationButton&&this._oTablePersonalisationButton.getVisible()){this._oPersController.openDialog();e.setMarked();e.preventDefault();}}};q1.prototype._loadExportLibrary=function(){if(!this._oExportLibLoadPromise){this._oExportLibLoadPromise=C.loadLibrary("sap.ui.export",true);}return this._oExportLibLoadPromise;};q1.prototype._getColumnLabel=function(e){var i;if(typeof e==='string'){e=this._getColumnByKey(e);}if(!e){return null;}if(e.getLabel){i=e.getLabel();}if(e.getHeader){i=e.getHeader();}return(i&&i.getText)?i.getText():null;};q1.prototype._getColumnWidthNumber=function(e){if(e.indexOf("em")>0){return Math.round(parseFloat(e));}if(e.indexOf("px")>0){return Math.round(parseInt(e)/16);}return"";};q1.prototype._triggerUI5ClientExport=function(e){var i=this._createExportColumnConfiguration(e);if(!i||!i.length){f.error(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS_EXPORT"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});return;}var s1=this._getRowBinding();var t1=this._getColumnLabel.bind(this);var u1={workbook:{columns:i,hierarchyLevel:(this._isTreeTable&&s1.getTreeAnnotation)?s1.getTreeAnnotation("hierarchy-level-for"):undefined},dataSource:s1,fileName:e?e.fileName:this.getHeader()};this._loadExportLibrary().then(function(){sap.ui.require(['sap/ui/export/ExportUtils','sap/ui/export/Spreadsheet'],function(v1,w1){var x1=Promise.resolve();if(e.includeFilterSettings){x1=v1.parseFilterConfiguration(s1,t1).then(function(y1){if(e.includeFilterSettings&&y1){u1.workbook.context={metaSheetName:y1.name,metainfo:[y1]};}});}x1.then(function(){var y1={splitCells:false,includeFilterSettings:false};if(e){y1.splitCells=e.splitCells;y1.includeFilterSettings=e.includeFilterSettings;}var z1=new w1(u1);z1.attachBeforeExport(function(B1){this.fireBeforeExport({exportSettings:B1.getParameter('exportSettings'),userExportSettings:y1});},this);var A1=function(){z1.destroy();};z1.build().then(A1,A1);}.bind(this));}.bind(this));}.bind(this));};q1.prototype._createExportColumnConfiguration=function(e){var s1,i,t1,u1,v1,w1,x1,y1,z1,A1,B1,C1,D1,E1,F1,G1,H1,I1,J1=[];var K1=e&&e.splitCells;var L1=function(N1,O1){return'{'+(parseInt(O1)-1)+'}';};s1=this._isMobileTable?this._oTable.getColumns(true):this._oTable.getColumns();t1=s1.length;for(i=0;i<t1;i++){x1=null;y1=null;z1=null;u1=s1[i];if(u1.getVisible()){v1=u1.data("p13nData");if(u1.getLeadingProperty){x1=u1.getLeadingProperty();}if(!x1&&v1){x1=v1["leadingProperty"];}if(Array.isArray(x1)){x1=x1[0];}if(x1){w1=this._getColumnLabel(u1);E1=u1.getWidth().toLowerCase()||v1.width||"";E1=this._getColumnWidthNumber(E1);F1=v1.type==="numeric"?"Number":v1.type;I1=v1.typeInstance;H1=null;G1=null;if(v1.unit){F1=v1.isCurrency?"Currency":"Number";if(K1){z1=v1.unit;}}else if(I1&&I1.isA("sap.ui.comp.odata.type.FiscalDate")){var M1=I1.getFormatter();y1=M1.getTemplate().replace(/\$(\d)/g,L1);G1=M1.getRegExPattern().toString().slice(1,-1);F1="String";}else if(F1!="date"&&G.isDateOrTime(v1.edmType)){F1=G.getTypeName(v1.edmType);if(F1==="DateTimeOffset"){F1="DateTime";}}else if(F1==="stringdate"){F1="Date";G1="YYYYMMDD";}else if(F1==="boolean"){F1="Boolean";H1=G.getType(v1.edmType);}else if(v1.description){F1="String";if(!K1){y1=z.getFormattedExpressionFromDisplayBehaviour(v1.displayBehaviour,"{0}","{1}");}else if(v1.displayBehaviour==="descriptionOnly"){x1=v1.description;}else if(v1.displayBehaviour!=="idOnly"){z1=v1.description;}}else if(v1.isDigitSequence){F1="Number";}else if(F1==="string"){F1="String";}else if(F1==="date"){F1="Date";}else if(F1==="time"){F1="Time";}J1.push({columnId:u1.getId(),property:v1.description&&!K1?[x1,v1.description]:x1,type:F1,inputFormat:G1,label:w1?w1:x1,width:E1,textAlign:u1.getHAlign(),template:y1,trueValue:(F1==="Boolean"&&H1)?H1.formatValue(true,"string"):undefined,falseValue:(F1==="Boolean"&&H1)?H1.formatValue(false,"string"):undefined,unitProperty:(F1==="Currency"||(F1==="Number"&&!K1))?v1.unit:undefined,displayUnit:F1==="Currency"&&!K1,precision:v1.precision,scale:v1.scale});if(z1){A1=this._getColumnByKey(z1);B1=w1;w1=null;if(A1){w1=this._getColumnLabel(A1);E1=A1.getWidth().toLowerCase()||"";E1=this._getColumnWidthNumber(E1);D1=A1.getHAlign();}else{C1=this._mFieldMetadataByKey[z1];if(C1){w1=C1.label;E1=C1.width;}}J1.push({columnId:u1.getId()+"-additionalProperty",property:z1,type:"String",label:w1||(B1?B1+" (2)":z1),width:E1,textAlign:D1});}}}}return J1;};q1.prototype._removeExpandParameter=function(e){var i=e.replace(new RegExp("([\\?&]\\$expand=[^&]+)(&?)"),function(s1,t1,u1){return u1?t1.substring(0,1):"";});return i;};q1.prototype._getRowCount=function(e){var i=this._getRowBinding();if(!i){return 0;}var s1=0;if(e&&i.getTotalSize){s1=i.getTotalSize();}else{s1=i.getLength();}if(s1<0||s1==="0"){s1=0;}return s1;};q1.prototype._setExcelExportEnableState=function(){if(this._oUseExportToExcel){var i=this._getRowCount();this._oUseExportToExcel.setEnabled(i>0);}};q1.prototype._createPersonalizationController=function(){if(this._oPersController||!this.getUseTablePersonalisation()){return;}var e=this._oP13nDialogSettings;e=this._setIgnoreFromPersonalisationToSettings(e);e=e||{};if(this._isTreeTable){e.stableColumnKeys=[];e.stableColumnKeys.push(this._aColumnKeys[0]);}if(this._bIsFilterPanelEnabled){e.filter=e.filter?e.filter:{};e.filter.createMessageStrip=this._getP13nFilterMessageStrip.bind(this);}this._oPersController=new y(this.getId()+"-persoController",{table:this._oTable,columnKeys:this._aColumnKeys,setting:e,resetToInitialTableState:!this.getUseVariantManagement(),beforePotentialTableChange:[this._beforePersonalisationModelDataChange,this],afterPotentialTableChange:[this._afterPersonalisationModelDataChange,this],afterP13nModelDataChange:[this._personalisationModelDataChange,this],requestColumns:[this._personalisationRequestColumns,this]});this._oPersController.attachDialogAfterClose(function(i){if(this._fGetDataForKeyUser){if(i.getParameter("cancel")){this._fGetDataForKeyUser([]);}this._cleanUpKeyUser();}}.bind(this));};q1.prototype.getVariantManagement=function(){return this._oVariantManagement;};q1.prototype.openDialogForKeyUser=function(e,i){this._fGetDataForKeyUser=i;this._oPersController.openDialog({useAvailablePanels:true,styleClass:e});};q1.prototype._cleanUpKeyUser=function(){this._fGetDataForKeyUser=null;};q1.prototype._createKeyUserChange=function(){return[{selectorControl:this._oVariantManagement._getPersoController(),changeSpecificData:{changeType:"variantContent",content:{key:this._oVariantManagement.getSelectionKey(),persistencyKey:this.getPersistencyKey(),content:this.fetchVariant()}}}];};q1.prototype._setIgnoreFromPersonalisationToSettings=function(e){var i=P.createArrayFromString(this.getIgnoreFromPersonalisation());if(i.length){if(!e){e={};}var s1=function(t1){if(!e[t1]){e[t1]={};}e[t1].ignoreColumnKeys=i;};s1("filter");s1("sort");s1("group");s1("columns");}return e;};q1.prototype._getRowBinding=function(){if(this._oTable){return this._oTable.getBinding(this._sAggregation);}};q1.prototype.setEntitySet=function(e){this.setProperty("entitySet",e,true);this._initialiseMetadata();return this;};q1.prototype._initialiseMetadata=function(e){var i=this,s1=i;if(e){s1=e.getSource();}if(!s1.bIsInitialised){E.handleModelInit(s1,s1._onMetadataInitialised,true);}};q1.prototype._onMetadataInitialised=function(){this._bMetaModelLoadAttached=false;if(!this.bIsInitialised){this._createTableProvider();if(this._oTableProvider){this._aTableViewMetadata=this._oTableProvider.getTableViewMetadata();if(this._aTableViewMetadata){if(!this._isMobileTable&&this.getDemandPopin()){this.setDemandPopin(false);Q.error("use SmartTable property 'demandPopin' only  with responsive table, property has been set to false");}this.detachModelContextChange(this._initialiseMetadata,this);this.bIsInitialised=true;this._bTableSupportsExcelExport=this._oTableProvider.getSupportsExcelExport();this._bMultiUnitBehaviorEnabled=this._oTableProvider.getMultiUnitBehaviorEnabled();this._listenToSmartFilter();this._createVariantManagementControl();this._createToolbarContent();this._aAlwaysSelect=this._oTableProvider.getRequestAtLeastFields();this._createContent();this._createPersonalizationController();this._oEditModel=new J({editable:this.getEditable()});this.setModel(this._oEditModel,"sm4rtM0d3l");this.attachEvent("_change",this._onPropertyChange,this);this.fireInitialise();if(!this._oVariantManagement||(this._oVariantManagement&&this._bVariantInitialised)){this._checkAndTriggerBinding();}}}}};q1.prototype._checkAndTriggerBinding=function(){if(!this._bAutoBindingTriggered){this._bAutoBindingTriggered=true;if(this.getEnableAutoBinding()){if(this._oSmartFilter){if(this._oSmartFilter.isInitialised()){this._oSmartFilter.search();}else{this._oSmartFilter.attachEventOnce("initialise",function(){this._oSmartFilter.search();},this);}}else{this._reBindTable();}}}};q1.prototype._aStaticProperties=["entitySet","ignoredFields","initiallyVisibleFields","ignoreFromPersonalisation","tableType","useTablePersonalisation","enableAutoBinding","persistencyKey","smartFilterId","showDetailsButton","enableAutoColumnWidth"];q1.prototype._aToolbarRelatedProperties=["useExportToExcel","exportType","showFullScreenButton","editTogglable","placeToolbarInTable"];q1.prototype._onPropertyChange=function(e){var i=e.getParameter("name");if(this._aStaticProperties.indexOf(i)>-1){Q.error("Property "+i+" cannot be changed after the SmartTable with id "+this.getId()+" is initialised");}if(this._oToolbar&&this._aToolbarRelatedProperties.indexOf(i)>-1){if(i==="exportType"&&this._oUseExportToExcel){this._oUseExportToExcel.destroy();this._oUseExportToExcel=null;}this._createToolbarContent();}};q1.prototype._createTableProvider=function(){var e,i,s1;i=this.getEntitySet();s1=this.getIgnoredFields();e=this.getModel();if(e&&i){if(this._aExistingColumns.length){if(s1){s1+=","+this._aExistingColumns.toString();}else{s1=this._aExistingColumns.toString();}}this._oTableProvider=new n({entitySet:i,ignoredFields:s1,initiallyVisibleFields:this.getInitiallyVisibleFields(),isEditableTable:this.getEditable(),smartTableId:this.getId(),isAnalyticalTable:!!this._isAnalyticalTable,isMobileTable:!!this._isMobileTable,dateFormatSettings:this.data("dateFormatSettings"),useUTCDateTime:this.data("useUTCDateTime"),currencyFormatSettings:this.data("currencyFormatSettings"),defaultDropDownDisplayBehaviour:this.data("defaultDropDownDisplayBehaviour"),useSmartField:this.data("useSmartField"),useSmartToggle:this.data("useSmartToggle"),skipAnnotationParse:this.data("skipAnnotationParse"),lineItemQualifier:this.data("lineItemQualifier"),presentationVariantQualifier:this.data("presentationVariantQualifier"),enableInResultForLineItem:this.data("enableInResultForLineItem"),_semanticKeyAdditionalControl:this.getAggregation("semanticKeyAdditionalControl"),model:e,semanticObjectController:this.getSemanticObjectController(),showDetailsButton:this.getShowDetailsButton(),enableAutoColumnWidth:this.getEnableAutoColumnWidth()});}};q1.prototype._listenToSmartFilter=function(){var e,i,s1=false;e=this.getSmartFilterId();this._oSmartFilter=this._findControl(e,"sap.ui.comp.filterbar.FilterBar");if(this._oSmartFilter){this._oSmartFilter.attachSearch(this._reBindTable,this);this._oSmartFilter.attachFilterChange(this._filterChangeEvent,this);s1=true;}i=this.getInitialNoDataText();if(i){s1=i==="$FILTERBAR";if(!s1&&i!=="$NO_FILTERBAR"){this._setNoDataText(i);return;}}if(s1){this._setNoDataText(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_DATA"));}else{this._setNoDataText(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR"));}};q1.prototype._filterChangeEvent=function(){if(this._isTableBound()&&this._oSmartFilter&&!this._oSmartFilter.getLiveMode()&&!this._oSmartFilter.isDialogOpen()){this._showOverlay(true);}};q1.prototype._showOverlay=function(e){if(e){var i={show:true};this.fireShowOverlay({overlay:i});e=i.show;}this._oTable.setShowOverlay(e);};q1.prototype._findControl=function(i,e){var s1,t1;if(i){s1=C.byId(i);if(!s1||!s1.isA(e)){t1=this._getView();if(t1){s1=t1.byId(i);}}if(s1&&!s1.isA(e)){s1=undefined;}}return s1;};q1.prototype._getView=function(){if(!this._oView){var e=this.getParent();while(e){if(e.isA("sap.ui.core.mvc.View")){this._oView=e;break;}e=e.getParent();}}return this._oView;};q1.prototype.rebindTable=function(e){this._reBindTable(null,e);};q1.prototype._reBindTable=function(e,s1){var t1,u1,v1,i,w1,x1,y1=[],z1,A1,B1,C1,D1,E1,F1,G1={},H1={preventTableBind:false};this._bUpdateTableAnnouncement=e&&e.getId&&e.getId()==="search";v1=this._getTablePersonalisationData()||{};if(this._oMessageFilter){z1=this._oMessageFilter;}else{z1=v1.filters;A1=v1.excludeFilters;}F1=v1.sorters;if(this._oSmartFilter){x1=this._oSmartFilter.getFilters();G1=this._oSmartFilter.getParameters()||{};}if(x1&&x1.length){if(A1){y1=[new s([x1[0],A1],true)];}else{y1=x1;}}else if(A1){y1=[A1];}if(z1){z1=y1.concat(z1);}else{z1=y1;}B1=this._getRequestAtLeastFields();D1=this._getRelevantColumnPaths();C1=D1["select"];if(!C1||!C1.length){C1=B1;}else{w1=B1.length;for(i=0;i<w1;i++){if(C1.indexOf(B1[i])<0){C1.push(B1[i]);}}}if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.select){this._mSelectExpandForGroup.select.forEach(function(K1){if(C1.indexOf(K1)<0){C1.push(K1);}});}if(C1.length){G1["select"]=C1.toString();E1=D1["expand"]||[];if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.expand){this._mSelectExpandForGroup.expand.forEach(function(K1){if(E1.indexOf(K1)<0){E1.push(K1);}});}if(E1.length){G1["expand"]=E1.join(",");}}G1["useBatchRequests"]=true;if(!F1){F1=[];}H1.filters=z1;H1.sorter=F1;H1.parameters=G1;H1.length=undefined;H1.startIndex=undefined;H1.events={};this.fireBeforeRebindTable({bindingParams:H1,messageFilterActive:!!this._bApplyFilter});if(!H1.preventTableBind){F1=H1.sorter;z1=H1.filters;G1=H1.parameters;C1=H1.parameters["select"];if(!C1||!C1.length){f.error(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});return;}u1=this.getTableBindingPath()||("/"+this.getEntitySet());if(this._oTable.resumeUpdateAnalyticalInfo){this._oTable.resumeUpdateAnalyticalInfo(true,false);}this._bDataLoadPending=true;this._bIgnoreChange=false;if(this._bForceTableUpdate){s1=true;this._bForceTableUpdate=false;}if(!s1){t1=this._oTable.getBinding(this._sAggregation);if(t1&&t1.mParameters){s1=!(W(G1,t1.mParameters,true)&&W(G1.custom,t1.mParameters.custom)&&!H1.length&&!H1.startIndex&&u1===t1.getPath());}}if(!this._bNoDataUpdated){this._bNoDataUpdated=true;this._setNoDataText();}if(!t1||!this._bIsTableBound||s1){q1._addBindingListener(H1,"change",this._onBindingChange,this);q1._addBindingListener(H1,"dataRequested",this._onDataRequested,this);q1._addBindingListener(H1,"dataReceived",this._onDataReceived,this);if(this._isMobileTable){var I1=this._oTable?this._oTable.getColumns():[];var J1=this._oTemplate?this._oTemplate.getCells():[];if(I1.length===J1.length){I1.forEach(function(K1,L1){J1[L1].setBindingContext(K1.getVisible()?undefined:null);});}}this._oTable.bindRows({path:u1,filters:z1,sorter:F1,parameters:G1,length:H1.length,startIndex:H1.startIndex,template:this._oTemplate,events:H1.events});this._bIsTableBound=true;}else{t1.sort(F1);t1.filter(z1,"Application");}this._showOverlay(false);}};q1.prototype._onDataRequested=function(e){if(e&&e.getParameter&&e.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._bIgnoreChange=true;this.fireDataRequested(e.getParameters());};q1.prototype._onDataReceived=function(e){if(e&&e.getParameter&&e.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._bIgnoreChange=false;this._onDataLoadComplete(e,true);this.fireDataReceived(e);};q1.prototype._onBindingChange=function(e){if(this._bIgnoreChange){return;}var i,s1=false;i=(e&&e.getParameter)?e.getParameter("reason"):undefined;if(!i||i==="filter"||i==="context"||(!this._bDataLoadPending&&i==="change")){s1=true;}if(i==="change"||s1){this._onDataLoadComplete(e,s1);}};q1._addBindingListener=function(e,i,s1,t1){if(!e.events){e.events={};}if(!e.events[i]){e.events[i]=s1.bind(t1);}else{var u1=e.events[i];e.events[i]=function(){s1.apply(t1,arguments);u1.apply(t1,arguments);};}};q1.prototype._onDataLoadComplete=function(e,i){if(this._bDataLoadPending||i){this._bDataLoadPending=false;this.updateTableHeaderState();}};q1.prototype._isTableBound=function(){if(this._bIsTableBound){return true;}if(this._oTable){return this._oTable.isBound(this._sAggregation);}return false;};q1.prototype.setNoData=function(e){this._oNoData=e;if(this._bNoDataUpdated||this._isTableBound()){this._setNoDataText();}return this;};q1.prototype.getNoData=function(){return this._oNoData;};q1.prototype._setNoDataText=function(e){var i=this._oTable.setNoData;if(!i){i=this._oTable.setNoDataText;}if(!i){return;}var s1=e;if(!s1){s1=this.getNoData();}if(!s1){s1=C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_RESULTS");}i.call(this._oTable,s1,true);};q1.prototype.updateTableHeaderState=function(){this._refreshHeaderText();this._setExcelExportEnableState();};q1.prototype._createContent=function(){var i,e=0,s1,t1,u1,v1=[];if(this._aExistingColumns&&this._aExistingColumns.length){this._aColumnKeys=[].concat(this._aExistingColumns.reverse());}t1=this._parseIndexedColumns();e=this._aTableViewMetadata.length;for(i=0;i<e;i++){s1=this._aTableViewMetadata[i];if(s1.isInitiallyVisible){this._aColumnKeys.push(s1.name);}else{v1.push(s1.name);}if(!(s1.isInitiallyVisible||s1.inResult)){this._mLazyColumnMap[s1.name]=s1;}else{u1=this._createColumnForField(s1);this._oTable.addColumn(u1);}this._mFieldMetadataByKey[s1.name]=s1;}this._insertIndexedColumns(t1);this._aColumnKeys=this._aColumnKeys.concat(v1);if(this._isMobileTable&&this.getEnableAutoColumnWidth()){this.setDemandPopin(true);this._oTable.setFixedLayout("Strict");this._oTable.setContextualWidth("auto");this._oTable.addDependent(new j1());}this._updateColumnsPopinFeature();if(this.getShowDetailsButton()){this._oTable.setHiddenInPopin(this._getImportanceToHide());}this._storeInitialColumnSettings();};q1.prototype._createColumnForField=function(e){var i,s1;s1=this.getId()+"-"+e.name.replace(/[^A-Za-z0-9_.:-]+/g,"_");i=this._createColumn(e,s1);e.isColumnCreated=true;i.data("p13nData",{columnKey:e.name,leadingProperty:e.name,additionalProperty:e.additionalProperty,navigationProperty:e.navigationProperty,sortProperty:e.sortable?e.name:undefined,filterProperty:e.filterable?e.name:undefined,isGroupable:e.sortable&&e.filterable&&e.aggregationRole==="dimension",fullName:e.hasValueListAnnotation?e.fullName:null,type:e.filterType,typeInstance:e.modelType,maxLength:e.maxLength,precision:e.precision,scale:e.scale,align:e.align,edmType:e.type,displayBehaviour:e.displayBehaviour,description:e.description,isDigitSequence:e.isDigitSequence,isCurrency:e.isCurrencyField,unit:e.unit,width:e.width,aggregationRole:e.aggregationRole,nullable:e.nullable!=="false"});if(e.filterable&&i.setFilterProperty){i.setFilterProperty(e.name);}if(e.sortable&&i.setSortProperty){i.setSortProperty(e.name);}if(this.getEnableAutoColumnWidth()){e.width=i.getWidth();if(this.getEditable()){this._updateColumnWidthForEdit(i,e);}}this._registerContentTemplateEvents(e.template);return i;};q1.prototype._parseIndexedColumns=function(){var i,e,s1,t1,u1,v1,w1,x1,y1;var z1=this._oTable.getColumns();var A1=null;if(this._oTemplate&&this._oTemplate.getCells){A1=this._oTemplate.getCells();}if(!z1){return null;}t1=[];e=z1.length;for(i=0;i<e;i++){s1=z1[i];u1=s1.data("p13nData");v1=null;w1=null;if(u1){v1=u1.columnIndex;w1=u1.columnKey;}x1=-1;if(v1!==null&&v1!==undefined){x1=parseInt(v1);}if(!isNaN(x1)&&x1>-1){if(A1){y1=A1[i];this._oTemplate.removeCell(y1);}else{y1=null;}this._aColumnKeys.splice(i-t1.length,1);t1.push({index:x1,columnKey:w1,column:s1,template:y1});this._oTable.removeColumn(s1);}}t1.sort(function(B1,C1){return B1.index-C1.index;});return t1;};q1.prototype._insertIndexedColumns=function(e){var i,s1,t1;if(!e){return;}s1=e.length;for(i=0;i<s1;i++){t1=e[i];this._aColumnKeys.splice(t1.index,0,t1.columnKey);this._oTable.insertColumn(t1.column,t1.index);if(t1.template){this._oTemplate.insertCell(t1.template,t1.index);}}};q1.prototype._updateColumnsPopinFeature=function(){if(!this._isMobileTable||!this.getDemandPopin()){return;}if(!this._oTable.getAutoPopinMode()){this._oTable.setAutoPopinMode(true);}var e=this._oTable.getColumns(true);if(!e){return;}e=e.filter(function(i){return i.getVisible();});e.forEach(function(i){if(i.getPopinDisplay()!="WithoutHeader"){i.setPopinDisplay("Inline");}});};q1.prototype._storeInitialColumnSettings=function(){this._aInitialSorters=[];P.createSort2Json(this._oTable,this._aInitialSorters,P.createArrayFromString(this.getIgnoreFromPersonalisation()));};q1.prototype._deactivateColumnsPopinFeature=function(){if(!this._isMobileTable){return;}if(this._oTable.getAutoPopinMode()){this._oTable.setAutoPopinMode(false);}var e=this._oTable.getColumns();if(!e){return;}var s1,t1=e.length;for(var i=0;i<t1;i++){s1=e[i];s1.setDemandPopin(false);s1.setMinScreenWidth("1px");}};q1.prototype._registerContentTemplateEvents=function(e){if(e.isA("sap.ui.comp.SmartToggle")){e=e.getEdit();}if(e&&e.attachChange){e.attachChange(function(i){this.fireFieldChange({changeEvent:i});},this);}};q1.prototype._updateInitialColumns=function(){var i=this._oTable.getColumns(),s1=i?i.length:0,t1,u1,v1;while(s1--){v1=null;t1=i[s1];if(t1){u1=t1.data("p13nData");if(typeof u1==="string"){try{u1=JSON.parse(u1);}catch(e){}if(u1){t1.data("p13nData",u1);}}if(u1){v1=u1["columnKey"];}if(v1){this._aExistingColumns.push(v1);}}}};q1.prototype._getRelevantColumnPaths=function(){var e={},s1=[],t1=[],u1=this._oTable.getColumns(),i,v1=u1?u1.length:0,w1,x1,y1,z1,A1;var B1=function(y1,C1){var D1,E1;if(y1){E1=y1.split(",");D1=E1.length;while(D1--){y1=E1[D1];if(y1&&C1.indexOf(y1)<0){C1.push(y1);}}}};for(i=0;i<v1;i++){w1=u1[i];y1=null;if(w1.getVisible()||(w1.getInResult&&w1.getInResult())){if(w1.getLeadingProperty){y1=w1.getLeadingProperty();}x1=w1.data("p13nData");if(x1){if(!y1){y1=x1["leadingProperty"];}z1=x1["additionalProperty"];A1=x1["navigationProperty"];}if(y1&&s1.indexOf(y1)<0){s1.push(y1);}B1(z1,s1);B1(A1,t1);}}e["select"]=s1;e["expand"]=t1;return e;};q1.prototype._createTable=function(){var e=this.getItems(),i=e?e.length:0,s1,t1;this._sAggregation="rows";while(i--){s1=e[i];if(s1 instanceof w||s1 instanceof R){break;}s1=null;}if(s1){this._oTable=s1;if(s1 instanceof u){this._isAnalyticalTable=true;}else if(s1 instanceof R){this._isMobileTable=true;this._oTemplate=(s1.getItems()&&s1.getItems().length>0)?s1.getItems()[0]:new b();s1.removeAllItems();}else if(s1 instanceof x){this._isTreeTable=true;}this._updateInitialColumns();}else{t1=this.getId()+"-ui5table";if(this.getTableType()==="AnalyticalTable"){this._isAnalyticalTable=true;this._oTable=new u(t1,{enableCustomFilter:true});}else if(this.getTableType()==="ResponsiveTable"){this._isMobileTable=true;this._oTable=new R(t1,{growing:true,autoPopinMode:this.getDemandPopin()});this._oTemplate=new b();}else if(this.getTableType()==="TreeTable"){this._isTreeTable=true;this._oTable=new x(t1,{selectionMode:"MultiToggle"});}else{this._oTable=new w(t1,{selectionMode:"MultiToggle"});}if(this._oTable.setVisibleRowCountMode){this._oTable.setVisibleRowCountMode("Auto");}this.insertItem(this._oTable,2);}this._fColumnPaddingBorder=(this._isMobileTable)?1:1.1875;if(!this._oTable.getLayoutData()){if(this._oTable instanceof R||(this._oTable.getVisibleRowCountMode&&this._oTable.getVisibleRowCountMode()!=="Auto")){this._oTable.setLayoutData(new l({growFactor:1,baseSize:"auto"}));}else{this._oTable.setLayoutData(new l({growFactor:1,baseSize:"0%"}));}}this._oTable.addStyleClass("sapUiCompSmartTableInnerTable");this._oTable.setEnableBusyIndicator(true);this._oTable.setBusyIndicatorDelay(100);if(this._oTable.setEnableCustomFilter){this._oTable.setEnableCustomFilter(this.getEnableCustomFilter());}if(this._oTable.setShowColumnVisibilityMenu){this._oTable.setShowColumnVisibilityMenu(false);}if(this._oTable.getEnableCustomFilter&&this._oTable.getEnableCustomFilter()&&this._bIsFilterPanelEnabled){if(this._oTable.setEnableCellFilter){this._oTable.setEnableCellFilter(false);}if(this._oTable.attachCustomFilter){this._oTable.attachCustomFilter(this._onCustomFilter,this);}}if(this._isAnalyticalTable){this._createColumn=this._createAnalyticalColumn;}else if(this._isMobileTable){if(this.getUseTablePersonalisation()){this._oTable.bActiveHeaders=true;this._oTable.attachEvent("columnPress",this._onColumnPress,this);this._oTable.attachSort=function(){this.attachEvent("sort",arguments[0],arguments[1],arguments[2]);};this._oTable.detachSort=function(){this.detachEvent("sort",arguments[0],arguments[1]);};}this._sAggregation="items";this._createColumn=this._createMobileColumn;this._oTable.bindRows=this._oTable.bindItems;if(this.getShowDetailsButton()){this._oTable.attachEvent("popinChanged",this._onPopinChanged,this);}}if(!this._isMobileTable){this._oTable.attachRowsUpdated(function(){this._setExcelExportEnableState();},this);}if(this._oTable._setLargeDataScrolling){this._oTable._setLargeDataScrolling(true);}this._oTable.attachPaste(this._onInnerTablePaste,this);};q1.prototype._createResponsivePopover=function(e){this._oFilterButton=new Z({text:C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_RP_FILTER"),icon:"sap-icon://filter",press:[function(i){this._onCustomFilter(i);},this]});this._oSortButton=new $({sort:[function(i){this._onCustomSort(i);},this]});this._oColumnHeaderPopover=new Y({items:[this._oSortButton,this._oFilterButton]});if(e){this._oColumnHeaderPopover.addItem(new Z({text:C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_RP_RESIZE"),icon:"sap-icon://resize-horizontal",press:[function(){i1.getPlugin(this._oTable,"sap.m.plugins.ColumnResizer").startResizing(this._oColumnClicked.getDomRef());},this]}));}};q1.prototype._onColumnPress=function(e){this._oColumnClicked=e.getParameter("column");var i=this._oColumnClicked.data("p13nData");var s1=window.matchMedia("(hover:none)").matches&&this._isMobileTable&&this.getEnableAutoColumnWidth();if(!i&&!s1){return;}var t1=i.filterProperty;var u1=i.sortProperty;if(!this._oColumnHeaderPopover){this._createResponsivePopover(s1);}this._oFilterButton.setVisible(!!t1&&this._bIsFilterPanelEnabled);this._oSortButton.setVisible(!!u1&&this._bIsSortPanelEnabled);if((t1&&this._bIsFilterPanelEnabled)||(u1&&this._bIsSortPanelEnabled)||s1){this._oColumnHeaderPopover.removeAllAriaLabelledBy();this._oColumnHeaderPopover.addAriaLabelledBy(this._oColumnClicked.getHeader());this._oColumnHeaderPopover.openBy(this._oColumnClicked);}};q1.prototype._filterByDataStateError=function(e){if(!e){var i=!!this._oMessageFilter;this._oMessageFilter=null;this._createInfoToolbar();if(i){this.rebindTable();}}else{var s1=this._getRowBinding();if(s1&&this._oDataStateIndicator){var t1=this._oDataStateIndicator,u1=t1.getFilter(),v1=u1?function(w1){return u1(w1,t1.getControl());}:undefined;s1.requestFilterForMessages(v1).then(function(w1){if(!w1){return;}this._oMessageFilter=w1;this.rebindTable();this._createInfoToolbar(true);}.bind(this));}}};q1.prototype._onCustomSort=function(){var e=this._oColumnClicked.data("p13nData");if(e){if(!e.sorted){e.sorted={"ascending":true};this._oColumnClicked.data("p13nData",e);}else{e.sorted.ascending=!e.sorted.ascending;}}var i=e.sorted;var s1=i&&i.ascending;this._oTable.fireEvent("sort",{column:this._oColumnClicked,sortOrder:s1?o1.Ascending:o1.Descending,columnAdded:false});};q1.prototype._onCustomFilter=function(e){this._showTableFilterDialog(e.getParameter("column")||this._oColumnClicked);};q1.prototype._onPopinChanged=function(e){if(!this._oShowHideDetailsButton){this._createShowHideDetailsButton();}var i=e.getParameter("hasPopin");var s1=e.getParameter("hiddenInPopin");var t1=e.getSource().getVisibleItems();if(t1.length&&(s1.length||(i&&!this.bHideDetails))){this._oShowHideDetailsButton.setVisible(true);}else{this._oShowHideDetailsButton.setVisible(false);}};q1.prototype.getTable=function(){return this._oTable;};q1.prototype._showTableFilterDialog=function(e){if(this._oPersController){var i={filter:{visible:true}};if(e){i.filter["payload"]={column:e};}this._oPersController.openDialog(i);}};function r1(e,i){i=i||0;e=e||"";if(e.length<=i){return i;}var s1=parseFloat(M.BaseFontSize);if(!q1.oCanvasContext){var t1=function(){q1.oCanvasContext.font=parseFloat(h1.get("sapMFontMediumSize"))*s1+"px "+h1.get("sapUiFontFamily");delete q1.fBooleanWidth;};q1.oCanvasContext=document.createElement("canvas").getContext("2d");C.attachThemeChanged(t1);t1();}return q1.oCanvasContext.measureText(e).width/s1;}q1.prototype._calcColumnWidth=function(e,i,s1){s1=Object.assign({max:19,min:i?1:2,label:i?false:true,defaultWidth:i?4:8,epsilon:i?0:0.05,padding:this._fColumnPaddingBorder},s1);if(!e){return s1.defaultWidth;}var t1,u1=0,v1="w",w1=0,x1=s1.min,y1=s1.max,z1=s1.padding,A1=e.displayBehaviour,B1=e.modelType,C1=e.type||"",D1={"Edm.Int16":5,"Edm.Int32":9,"Edm.Int64":12,"Edm.Float":6,"Edm.Single":6,"Edm.Double":13,"Edm.Decimal":15};if(y1<x1){return y1;}if(i||!e.additionalProperty||A1!="descriptionOnly"){if(e.isImageURL||C1=="Edm.Byte"||C1=="Edm.SByte"){u1+=x1;}else if(e.isCalendarDate||G.isDateOrTime(e.type)){t1=new Date(2023,9,26,22,47,58);if(C1=="Edm.Time"){var E1=t1.getTimezoneOffset()*60*1000;t1=D.dateToEdmTime(t1);t1.ms-=E1;}else if(B1.oFormat&&B1.oFormat.oFormatOptions){(B1.oFormat.oFormatOptions.pattern||"").replace(/[MELc]{3,4}/,function(R1){u1+=(R1.length==4?0.9:0.3);});}}else if(C1 in D1){var F1=Math.min(e.precision||20,D1[C1]);t1=2*Math.pow(10,F1-(e.scale||0)-1);}else if(C1=="Edm.Boolean"){if(!q1.hasOwnProperty("fBooleanWidth")){var G1=r1(B1.formatValue(true,"string"),x1);var H1=r1(B1.formatValue(false,"string"),x1);q1.fBooleanWidth=Math.max(G1,H1);}u1+=q1.fBooleanWidth;}else if(e.type=="Edm.String"){var I1=+e.maxLength||0;if(I1==0){u1+=Math.max(10,y1*0.75);}else if(I1<=x1){u1+=x1;}else if(I1*0.25>y1){u1=y1;}else if(I1<y1*0.7||y1<5){t1=v1.repeat(I1);}else{var J1=r1(v1.repeat(I1),x1);u1+=Math.log(J1-y1*0.2)/Math.log(y1/3)*(y1/2);}}else{u1+=s1.defaultWidth;}if(t1){var K1=B1.formatValue(t1,"string");u1+=r1(K1,x1);u1+=s1.epsilon;}}if(this._isTreeTable&&e.hierarchy&&e.index==0){u1+=3;}if(!i){e.ownWidth=u1=Math.min(u1,y1);}if(!i&&A1!="idOnly"&&e.additionalProperty&&this._oTableProvider&&u1<y1){e.additionalProperty.split(",").forEach(function(R1){if(R1==e.fieldControlProperty){return;}var S1=this._oTableProvider.getFieldMetadata(R1);var T1=Object.assign({padding:0.4,max:y1-u1-0.4},e.vertical&&{padding:0,max:y1});var U1=this._calcColumnWidth(S1,true,T1);if(e.vertical){u1=Math.max(U1,u1);}else{u1+=U1;}},this);if(A1=="descriptionOnly"){e.ownWidth=u1;}else{e.additionalWidth=u1-e.ownWidth;}}if(s1.label){var L1=(e.label||e.fieldLabel||"").trim();var M1=L1.length;u1=Math.max(x1,u1);if(u1<y1&&u1<M1&&M1>x1){var N1=Math.max(1,1-(Math.log(u1-x1*0.85)/Math.log(y1*0.5))+1);var O1=N1*u1;var P1=Math.min(r1(L1)+s1.epsilon,y1*0.7);var Q1=Math.max(0,P1-O1);w1=(Q1<0.15)?P1:O1+Q1*(1-1/u1)/Math.E;e.labelWidth=w1;}}u1=Math.max(x1,u1,w1);u1=Math.min(u1,y1)+z1;u1=Math.round(u1*100)/100;return u1;};q1.prototype._updateColumnWidthForEdit=function(e,i){if(!i||!i.isColumnCreated||i.type=="Edm.Boolean"||i.semanticObjects){return;}var s1=this.data("useSmartField")=="true"||this.data("useSmartField")===true;if(s1&&i["sap:updatable"]=="false"){return;}var t1=e.getWidth();if(!this.getEditable()){if(i.editWidth==t1){e.setWidth(i.width);}}else if(i.width==t1){if(i.editWidth){return e.setWidth(i.editWidth);}if(!this._aEditableColumnAdditionalWidth){var u1=this._fColumnPaddingBorder;var v1=this.$().closest(".sapUiSizeCompact").length?"_Compact":"";var w1=parseFloat(h1.get("_sap_m_InputBase"+v1+"_IconWidth"));u1+=parseFloat(h1.get("_sap_m_InputBaseWrapper_Sum_Border"));u1+=parseFloat(h1.get("_sap_m_InputBase"+v1+"_InnerPadding").split(" ").pop())*2;this._aEditableColumnAdditionalWidth=[u1,u1+w1-0.25];}var x1=(i.displayBehaviour||"").includes("And");var y1=(i.labelWidth||0)+this._fColumnPaddingBorder;if(s1&&x1&&i.additionalWidth&&i.hasValueListAnnotation&&!i.hasFixedValues){i.editWidth=Math.max(i.ownWidth+this._aEditableColumnAdditionalWidth[1],y1)+"rem";return e.setWidth(i.editWidth);}var z1=i.isCalendarDate||G.isDateOrTime(i.type);var A1=i.hasValueListAnnotation||z1;var B1=this._aEditableColumnAdditionalWidth[+A1];if(s1&&x1&&!i.additionalWidth&&i.hasValueListAnnotation&&i.hasFixedValues){B1=Math.max(i.ownWidth+3+B1,y1);}else if(i.ownWidth<4||z1){B1+=i.ownWidth;}else{B1+=2;}var C1=parseFloat(t1);if(C1<B1){i.editWidth=B1+"rem";e.setWidth(i.editWidth);}}};q1.prototype._updateVisibleColumnsWidthForEdit=function(){if(this._oTable&&this.getEnableAutoColumnWidth()){this._oTable.getColumns().forEach(function(e){if(e.getVisible()){var i=e.data("p13nData");var s1=i&&i.columnKey;if(s1){var t1=this._oTableProvider.getFieldMetadata(s1);t1&&this._updateColumnWidthForEdit(e,t1);}}},this);}};q1.prototype._createColumn=function(e,i){var s1=new v(i,{autoResizable:true,hAlign:e.align,width:e.width||this._calcColumnWidth(e)+"rem",visible:e.isInitiallyVisible,label:new d(i+"-header",{textAlign:e.align,text:e.label}),sorted:e.sorted,sortOrder:e.sortOrder,tooltip:e.quickInfo,showSortMenuEntry:e.sortable&&this._bIsSortPanelEnabled,showFilterMenuEntry:e.filterable&&this._bIsFilterPanelEnabled,name:e.fieldName,template:e.template});return s1;};q1.prototype._createAnalyticalColumn=function(e,i){if(e.aggregationRole!=="measure"&&e.isMeasureField&&e.unit&&e.template.addStyleClass){e.template.addStyleClass("sapUiAnalyticalTableSumCellHidden sapUiAnalyticalTableGroupCellHidden");}else if(e.isCurrencyField&&e.template.addStyleClass){e.template.addStyleClass("sapUiCompCurrencyBold");}var s1=new A(i,{autoResizable:true,hAlign:e.align,width:e.width||this._calcColumnWidth(e)+"rem",visible:e.isInitiallyVisible,inResult:e.inResult,label:new d(i+"-header",{textAlign:e.align,text:e.label}),tooltip:e.quickInfo,sorted:e.sorted,sortOrder:e.sortOrder,grouped:e.grouped,showIfGrouped:e.grouped,showSortMenuEntry:e.sortable&&this._bIsSortPanelEnabled,showFilterMenuEntry:e.filterable&&this._bIsFilterPanelEnabled,summed:e.summed,leadingProperty:e.name,template:e.template,groupHeaderFormatter:z.getInlineGroupFormatterFunction(e,true,this._getDateFormatSettings())});return s1;};q1.prototype._createMobileColumn=function(e,i){var s1=new a(i,{hAlign:e.align,visible:e.isInitiallyVisible,header:new d(i+"-header",{textAlign:e.align,text:e.label,tooltip:e.quickInfo,wrapping:!this.getEnableAutoColumnWidth(),wrappingType:M.WrappingType.Hyphenated}),tooltip:e.quickInfo});if(e.importance&&!this._oTableProvider.isLineItemDefaultImportance(e)){s1.setImportance(e.importance);}if(this._oTemplate){this._oTemplate.addCell(e.template);}if(e.width){return s1.setWidth(e.width);}if(!this.getEnableAutoColumnWidth()){return s1.setWidth(e.isImageURL?"3em":"auto");}return s1.setWidth(this._calcColumnWidth(e)+"rem");};q1.prototype.fetchVariant=function(){if(this._oCurrentVariant==="STANDARD"||this._oCurrentVariant===null){return{};}return this._oCurrentVariant;};q1.prototype.applyVariant=function(e,i){this._oCurrentVariant=e;if(this._oCurrentVariant==="STANDARD"){this._oCurrentVariant=null;}this._bApplyingVariant=true;if(this._oTable._setSuppressRefresh){this._oTable._setSuppressRefresh(true);}if(this._oPersController){if(this._oCurrentVariant===null||q.isEmptyObject(this._oCurrentVariant)){this._oPersController.resetPersonalization("ResetFull");}else{this._oPersController.setPersonalizationData(this._oCurrentVariant,true);}}this._bApplyingVariant=false;this.fireAfterVariantApply({currentVariantId:this.getCurrentVariantId()});};q1.prototype.variantsInitialized=function(){this._bVariantInitialised=true;this._checkAndTriggerBinding();};q1.prototype.getUiState=function(){var e=this._oPersController?this._oPersController.getDataSuiteFormatSnapshot():null;return new U({presentationVariant:{SortOrder:e?e.SortOrder:[],GroupBy:e?e.GroupBy:[],Total:e?e.Total:[],RequestAtLeast:this._getRequestAtLeastFields(),Visualizations:e?e.Visualizations:[]},selectionVariant:{SelectOptions:e?e.SelectOptions:[]},variantName:this.getCurrentVariantId()});};q1.prototype.setUiState=function(e){this._setUiState(e,false);};q1.prototype.setUiStateAsVariant=function(e){this._setUiState(e,true);};q1.prototype._setUiState=function(e,i){var s1=e.getPresentationVariant()&&e.getPresentationVariant().RequestAtLeast?[].concat(e.getPresentationVariant().RequestAtLeast):[];if(!W(s1,this._getRequestAtLeastFields())){this._aAlwaysSelect=s1;}if(this._oPersController){if(i){this._oPersController.setPersonalizationDataAsDataSuiteFormat(X({},e.getPresentationVariant(),e.getSelectionVariant()),true);}else{var t1=(this._oVariantManagement&&e.getVariantName())?this._oVariantManagement.getVariantContent(this,e.getVariantName()):{};this._oPersController.setDataSuiteFormatSnapshot(X({},e.getPresentationVariant(),e.getSelectionVariant()),t1,true);}}};q1.prototype._getRequestAtLeastFields=function(){var e=this.getRequestAtLeastFields();var i=e?e.split(","):[];return i.concat(this._aAlwaysSelect);};q1.prototype._personalisationRequestColumns=function(e){var s1=e.getParameter("columnKeys"),t1,i,u1,v1,w1,x1={};u1=s1.length;for(i=0;i<u1;i++){t1=s1[i];v1=this._mLazyColumnMap[t1];if(v1){w1=this._createColumnForField(v1);if(this._isMobileTable){this._oTable.addColumn(w1);}x1[v1.name]=w1;}}this._oPersController.addColumns(x1);};q1.prototype._beforePersonalisationModelDataChange=function(e){if(this._oTable.suspendUpdateAnalyticalInfo){this._oTable.suspendUpdateAnalyticalInfo();}};q1.prototype._afterPersonalisationModelDataChange=function(e){this._updateColumnsPopinFeature();if(this.getEditable()){this._updateVisibleColumnsWidthForEdit();}};q1.prototype._personalisationModelDataChange=function(e){this._oCurrentVariant=e.getParameter("persistentData");if(this._fGetDataForKeyUser){this._fGetDataForKeyUser(this._createKeyUserChange());}var i=e.getParameter("runtimeDeltaDataChangeType");var s1=this._getChangeStatus(i);if(s1==="Unchanged"){return;}if(!(this._bApplyingVariant||this._bDeactivatingColumns)){if(!this.getUseVariantManagement()){this._persistPersonalisation();}else if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true);}}if(s1==="ModelChanged"&&this._isTableBound()){if(i&&i.columns==="ModelChanged"){this._bForceTableUpdate=true;}if(this._oSmartFilter){this._oSmartFilter.search();}else{this._reBindTable(null);}}if(this._isMobileTable){this._adaptCustomSort();}this._createInfoToolbar();};q1.prototype._adaptCustomSort=function(){if(this._oCurrentVariant){var e,i,s1,t1=[],u1;if(this._oCurrentVariant.sort&&this._oCurrentVariant.sort.sortItems){t1=this._oCurrentVariant.sort.sortItems;}this._oTable.getColumns().forEach(function(v1){e=v1.data("p13nData");i=e&&e.columnKey;if(i){s1=t1.filter(function(w1){return i===w1.columnKey;});u1=s1[0];if(u1){if(!e.sorted){e.sorted={"ascending":false};}if(u1.operation!==o1.Descending){e.sorted={"ascending":true};}v1.setSortIndicator(u1.operation);}else if(e&&e.sorted){e.sorted=null;v1.setSortIndicator(c.None);}}else if(v1.getSortIndicator()!==o1.None){v1.setSortIndicator(o1.None);}},this);}};q1.prototype.setUseInfoToolbar=function(e){this.setProperty("useInfoToolbar",e,true);if(this.getTable()){this._createInfoToolbar();}return this;};q1.prototype._updateInfoToolbar=function(i,e){if(!this._oInfoToolbar){this._oInfoToolbar=new O({active:true,visible:true,design:m1.Info,content:[new T({id:this.getId()+"-infoToolbarText",text:i,wrapping:false})],press:[e,this._handleInfoToolbarPress,this]});}else{this._oInfoToolbar.setVisible(true);this._oInfoToolbar.getContent()[0].setText(i);this._oInfoToolbar.detachPress(this._handleInfoToolbarPress,this);this._oInfoToolbar.attachPress(e,this._handleInfoToolbarPress,this);}};q1.prototype._handleInfoToolbarPress=function(e,i){this._showTableFilterDialog(i);};q1.prototype._createInfoToolbar=function(e){var i=this.getUseInfoToolbar(),s1=this.getTable(),t1=this.getId()+"-infoToolbarText",u1,v1=C.getLibraryResourceBundle("sap.ui.comp");if(i===p1.Off){if(this._oInfoToolbar&&this._oInfoToolbar.getVisible()){this._oInfoToolbar.setVisible(false);s1.removeAriaLabelledBy(t1);}return;}if(e){var w1=v1.getText("SMARTTABLE_INFOTOOLBAR_FILTERED_BY",[v1.getText("SMARTTABLE_INFOTOOLBAR_MESS_"+this._sDataStateType)]);this._updateInfoToolbar(w1);if(this._isMobileTable&&!s1.getInfoToolbar()){s1.setInfoToolbar(this._oInfoToolbar);}else if(!this._isMobileTable){var x1=s1.getExtension().some(function(D1){return D1.getId()===this._oInfoToolbar.getId();},this);if(!x1){s1.addExtension(this._oInfoToolbar);}}if(s1.getAriaLabelledBy().indexOf(t1)===-1){s1.addAriaLabelledBy(t1);}}else if(this._isMobileTable){if(s1.getInfoToolbar()&&!this._oInfoToolbar){Q.error("Custom infoToolbar is used, hence set useInfoToolbar property on the SmartTable with id='"+this.getId()+"' to Off");return;}var y1=this._oCurrentVariant&&this._oCurrentVariant.filter&&this._oCurrentVariant.filter.filterItems,z1=y1&&y1.length;if(z1){var A1=[],B1=L.getInstance();y1.forEach(function(D1){var E1=this._getColumnLabel(D1.columnKey);if(E1&&A1.indexOf(E1)===-1){A1.push(E1);}},this);var C1=v1.getText("SMARTTABLE_INFOTOOLBAR_FILTERED_BY",[B1.format(A1)]);u1=this._getColumnByKey(y1[0].columnKey);this._updateInfoToolbar(C1,u1);if(!s1.getInfoToolbar()){s1.setInfoToolbar(this._oInfoToolbar);}if(s1.getAriaLabelledBy().indexOf(t1)===-1){s1.addAriaLabelledBy(t1);}}else if(this._oInfoToolbar&&this._oInfoToolbar.getVisible()){this._oInfoToolbar.setVisible(false);s1.removeAriaLabelledBy(t1);}}else if(this._oInfoToolbar){this._oInfoToolbar.setVisible(false);}};q1.prototype._getChangeStatus=function(e){if(!e){return"ModelChanged";}if(e.sort==="ModelChanged"||e.filter==="ModelChanged"||e.columns==="ModelChanged"||e.group==="ModelChanged"){return"ModelChanged";}if(e.sort==="TableChanged"||e.filter==="TableChanged"||e.columns==="TableChanged"||e.group==="TableChanged"){return"TableChanged";}return"Unchanged";};q1.prototype._getDateFormatSettings=function(){if(this._oTableProvider&&this._oTableProvider._oDateFormatSettings){return this._oTableProvider._oDateFormatSettings;}return undefined;};q1.prototype._getTablePersonalisationData=function(){this._mSelectExpandForGroup=null;if(!this._oCurrentVariant){return null;}var e=[],i=[],s1=[],t1,u1,v1,w1,x1,y1,z1,A1,B1,C1,D1={},E1={},F1="",G1;if(this._isMobileTable&&this._oCurrentVariant.group&&this._oCurrentVariant.group.groupItems){u1=this._oCurrentVariant.group.groupItems[0];if(this._aDeactivatedColumns.indexOf(u1.columnKey)<0){x1=this._getColumnByKey(u1.columnKey);if(x1){F1=x1.getHeader().getText();}C1=this._getPathFromColumnKeyAndProperty(u1.columnKey,"sortProperty");}if(C1){z1=C1;A1=null;var H1=this._mFieldMetadataByKey[u1.columnKey],I1;if(H1){A1=H1.unit||H1.description;I1=z.getInlineGroupFormatterFunction(H1,false,this._getDateFormatSettings());}v1=new r(z1,u1.operation==="GroupDescending",function(L1){var M1=L1.getProperty(z1),N1;if(I1){if(A1){N1=L1.getProperty(A1);}M1=I1(M1,N1);}if(M1===undefined||M1===null){M1="";}return{key:M1,text:F1?F1+": "+M1:M1};});this._mSelectExpandForGroup={select:[z1]};if(H1){if(H1.additionalProperty){this._mSelectExpandForGroup.select.push(H1.additionalProperty);}if(H1.navigationProperty){this._mSelectExpandForGroup.expand=[H1.navigationProperty];}}e.push(v1);}}if(this._oCurrentVariant.sort){w1=this._oCurrentVariant.sort.sortItems;}else{w1=this._aInitialSorters;}if(w1){w1.forEach(function(L1,M1){var N1=L1.operation==="Descending";C1=null;B1=null;if(this._aDeactivatedColumns.indexOf(L1.columnKey)<0){C1=this._getPathFromColumnKeyAndProperty(L1.columnKey,"sortProperty");}if(C1){if(v1&&v1.sPath===C1){v1.bDescending=N1;}else{var H1=this._mFieldMetadataByKey[L1.columnKey];if(!H1){x1=this._getColumnByKey(L1.columnKey);y1=x1.data("p13nData");}if(this._bMultiUnitBehaviorEnabled&&((H1&&H1.isCurrencyField)||(y1&&y1.isCurrency))){B1=H1?H1.unit:y1.unit;if(B1&&!D1[B1]){D1[B1]={index:M1,descending:N1};}}E1[C1]={};if(E1[B1]){delete D1[B1];}else if(D1[C1]){delete D1[C1];}e.push(new r(C1,N1));}}},this);var J1=Object.keys(D1),K1;if(J1.length){J1.reverse().forEach(function(L1){K1=v1?D1[L1].index+1:D1[L1].index;e.splice(K1,0,new r(L1,D1[L1].descending));});}}if(this._oCurrentVariant.filter){this._oCurrentVariant.filter.filterItems.forEach(function(L1){var M1=L1.value1,N1=L1.value2,O1;C1=null;G1=false;x1=null;if(this._aDeactivatedColumns.indexOf(L1.columnKey)<0){x1=this._getColumnByKey(L1.columnKey);}if(x1){if(x1.getFilterProperty){C1=x1.getFilterProperty();}y1=x1.data("p13nData");if(y1){G1=y1.type==="time";if(!C1){C1=y1["filterProperty"];}}}if(C1){if(G1){if(M1 instanceof Date){M1=z.getEdmTimeFromDate(M1);}if(N1 instanceof Date){N1=z.getEdmTimeFromDate(N1);}}else{var P1=y1&&y1.typeInstance&&y1.typeInstance.getName()==="sap.ui.model.odata.type.DateTimeOffset";if(M1 instanceof Date&&!P1&&this._oTableProvider&&this._oTableProvider.getIsUTCDateHandlingEnabled()){M1=D.localToUtc(M1);N1=N1?D.localToUtc(N1):N1;}}var Q1=(L1.exclude?s1:i);if(L1.operation==="Empty"){var R1=L1.exclude?t.NE:t.EQ;if(y1.edmType==="Edm.String"||y1.type==="string"){Q1.push(new s(C1,R1,""));}if(y1.nullable){Q1.push(new s(C1,R1,null));}}else{O1=L1.exclude?F.getTransformedExcludeOperation(L1.operation):L1.operation;Q1.push(new s(C1,O1,M1,N1));}}},this);if(s1.length){t1=new s(s1,true);}}return{filters:i,excludeFilters:t1,sorters:e};};q1.prototype._getColumnByKey=function(e){var s1,t1,u1,i,v1;if(this._oTable){s1=this._oTable.getColumns();u1=s1.length;for(i=0;i<u1;i++){t1=s1[i];v1=t1.data("p13nData");if(v1&&v1.columnKey===e){return t1;}}}return null;};q1.prototype._getPathFromColumnKeyAndProperty=function(e,i){var s1=null,t1,u1;t1=this._getColumnByKey(e);if(t1){if(i=="sortProperty"&&t1.getSortProperty){s1=t1.getSortProperty();}else if(i=="filterProperty"&&t1.getFilterProperty){s1=t1.getFilterProperty();}else if(i=="leadingProperty"&&t1.getLeadingProperty){s1=t1.getLeadingProperty();}if(!s1){u1=t1.data("p13nData");if(u1){s1=u1[i];}}}return s1;};q1.prototype._persistPersonalisation=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){var e=this.getCurrentVariantId();if(!this._bSaving){this._bSaving=true;this._oVariantManagement.fireSave({name:"Personalisation",implicit:true,global:false,overwrite:!!e,key:e,def:true});delete this._bSaving;}}};q1.prototype.getCurrentVariantId=function(){return this._oVariantManagement?this._oVariantManagement.getCurrentVariantId():"";};q1.prototype.setCurrentVariantId=function(e){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setCurrentVariantId(e);}else{Q.error("sap.ui.comp.smarttable.SmartTable.prototype.setCurrentVariantId: VariantManagement does not exist, or is a page variant");}return this;};q1.prototype.setDetailsButtonSetting=function(e){this.setProperty("detailsButtonSetting",e,true);return this;};q1.prototype.isInitialised=function(){return!!this.bIsInitialised;};q1.prototype._aAvailablePanels=["Columns","Sort","Filter","Group"];q1.prototype.openPersonalisationDialog=function(e){if(!e||this._aAvailablePanels.indexOf(e)<0){Q.warning("sap.ui.comp.smarttable.SmartTable.prototype.openPersonalisationDialog: "+e+" is not a valid panel!");return;}if(this._oPersController){var i={};i[e.toLowerCase()]={visible:true};this._oPersController.openDialog(i);}};q1.prototype.deactivateColumns=function(e){this._aDeactivatedColumns=e||[];this._bDeactivatingColumns=true;if(this._oPersController){this._oPersController.addToSettingIgnoreColumnKeys(this._aDeactivatedColumns);}this._bDeactivatingColumns=false;};q1.prototype._onInnerTablePaste=function(e){if(!this.hasListeners("beforePaste")&&!this.hasListeners("paste")){return;}var i=e.getParameter("data");var s1=i.slice(0);var t1=this._getColumnInfoForPaste();if(this.fireBeforePaste({columnInfos:t1})){sap.ui.require(["sap/ui/core/util/PasteHelper"],function(u1){u1.parse(s1,t1).then(function(v1){this.firePaste({result:v1});}.bind(this));}.bind(this));}};q1.prototype._getColumnInfoForPaste=function(){var e=[],s1=this._oTable.getColumns(),i,t1=s1.length,u1,v1,w1,x1,y1,z1;if(this._isMobileTable&&s1.length){s1=s1.sort(function(A1,B1){return A1.getOrder()-B1.getOrder();});}for(i=0;i<t1;i++){u1=s1[i];w1=null;z1=null;if(u1.getVisible()){if(u1.getLeadingProperty){w1=u1.getLeadingProperty();}v1=u1.data("p13nData");if(!w1&&v1){w1=v1["leadingProperty"];}x1=v1.type==="numeric"?"number":v1.type;y1=v1["typeInstance"];if(v1.isCurrency||x1==="number"){z1=v1.unit;}else if(v1.description&&v1.displayBehaviour!=="idOnly"){z1=v1.description;}}e.push({columnId:u1.getId(),property:w1,ignore:!w1,type:y1});y1=G.getType("Edm.String");if(z1){e.push({columnId:u1.getId(),additionalProperty:true,property:z1,type:y1});}}return e;};q1.prototype.exit=function(){var i,e;this.detachEvent("_change",this._onPropertyChange,this);if(this._oSmartFilter){this._oSmartFilter.detachSearch(this._reBindTable,this);this._oSmartFilter.detachFilterChange(this._filterChangeEvent,this);this._oSmartFilter=null;}if(this._oTableProvider&&this._oTableProvider.destroy){this._oTableProvider.destroy();}this._oTableProvider=null;if(this._oPersController&&this._oPersController.destroy){this._oPersController.destroy();}this._oPersController=null;if(this._oVariantManagement){this._oVariantManagement.detachSave(this._variantSaved,this);this._oVariantManagement.detachAfterSave(this._variantAfterSave,this);if(!this._oVariantManagement.isPageVariant()&&this._oVariantManagement.destroy){this._oVariantManagement.destroy();}}this._oNumberFormatInstance=null;B.cleanUpFullScreen(this);if(this._oEditModel){this._oEditModel.destroy();}if(this._oNoData&&this._oNoData.destroy){this._oNoData.destroy();}this.oNoData=null;if(this._aTableViewMetadata){i=this._aTableViewMetadata.length;while(i--){e=this._aTableViewMetadata[i];if(e&&!e.isColumnCreated&&e.template){e.template.destroy();}}}this._aTableViewMetadata=null;this._mFieldMetadataByKey=null;this._mSelectExpandForGroup=null;this._oEditModel=null;this._oVariantManagement=null;this._oCurrentVariant=null;this._aExistingColumns=null;this._mLazyColumnMap=null;this._aColumnKeys=null;this._aDeactivatedColumns=null;this._aAlwaysSelect=null;this._oCustomToolbar=null;if(this._oToolbar&&!this._bToolbarInsertedIntoItems){this._oToolbar.destroy();}this._oToolbar=null;if(this._oUseExportToExcel&&!this.getUseExportToExcel()){this._oUseExportToExcel.destroy();}this._oUseExportToExcel=null;this._oTablePersonalisationButton=null;this._oP13nDialogSettings=null;if(this._oTemplate){this._oTemplate.destroy();}this._oTemplate=null;if(this._oColumnHeaderPopover){this._oColumnHeaderPopover.destroy();}this._oColumnHeaderPopover=null;this._oFilterButton=null;this._oSortButton=null;this._oInfoToolbar=null;this._oView=null;this._oTable=null;};return q1;});
