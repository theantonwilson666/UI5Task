/*
 * ! SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/m/library","sap/m/List","sap/m/Popover","sap/m/StandardListItem",'sap/m/MultiInput','sap/m/MultiComboBox','sap/m/Token','sap/m/Tokenizer','sap/ui/comp/smartfield/SmartField','sap/ui/comp/odata/MetadataAnalyser',"sap/ui/model/ParseException","sap/ui/model/ValidateException",'sap/ui/model/BindingMode','sap/ui/comp/odata/ODataType','sap/ui/comp/providers/ValueHelpProvider',"sap/ui/comp/util/FormatUtil","sap/ui/core/format/DateFormat","sap/ui/comp/smartfilterbar/FilterProvider","sap/base/Log","sap/base/util/deepEqual","sap/ui/comp/library","sap/ui/core/library","sap/ui/core/ResizeHandler","sap/m/Link","sap/m/Text","sap/m/FlexBox","sap/m/HBox","sap/base/util/isEmptyObject"],function(M,L,P,S,a,b,T,c,d,e,f,V,B,O,g,F,D,h,j,k,l,m,R,n,o,p,H,q){"use strict";var r=l.valuehelpdialog.ValueHelpRangeOperation;var s=l.smartfilterbar.DisplayBehaviour;var t=l.smartfield.TextInEditModeSource;var u=m.ValueState;var v=M.PlacementType;var I="-mInput";var w="-mInputTokenizer";var x="-mInputHBox";var y="-mMoreLink";var z=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");var A=d.extend("sap.ui.comp.smartmultiinput.SmartMultiInput",{metadata:{library:"sap.ui.comp",properties:{supportRanges:{type:"boolean",defaultValue:false},supportMultiSelect:{type:"boolean",defaultValue:true},enableODataSelect:{type:"boolean",defaultValue:false},requestAtLeastFields:{type:"string",defaultValue:""},textSeparator:{type:"string",defaultValue:null}},events:{beforeCreate:{allowPreventDefault:true,parameters:{oData:{type:"object"},mParameters:{type:"object"}}},beforeRemove:{allowPreventDefault:true,parameters:{mParameters:{type:"object"}}},tokenUpdate:{parameters:{type:{type:"string"},addedTokens:{type:"sap.m.Token[]"},removedTokens:{type:"sap.m.Token[]"}}},selectionChange:{parameters:{changedItem:{type:"sap.ui.core.Item"},selected:{type:"boolean"}}},selectionFinish:{parameters:{selectedItems:{type:"sap.ui.core.Item[]"}}}}},renderer:function(i,E){d.getMetadata().getRenderer().render(i,E);if(E._oEmptyDash){var G=E.getTokens().length>0?false:true;E._oEmptyDash.setVisible(G);if(G&&E._oMoreLink){E._oMoreLink.setVisible(false);}}}});A.prototype.getTokens=function(){if(this._isReadMode()&&this._oTokenizer){return this._oTokenizer.getTokens();}else if(this._oMultiComboBox&&this._oMultiComboBox.getAggregation("tokenizer")){return this._oMultiComboBox.getAggregation("tokenizer").getTokens();}else if(this._oMultiInput){return this._oMultiInput.getTokens();}return[];};A.prototype.getValue=function(){return this.getTokens();};A.prototype._createMultiInput=function(){var i=this._createAttributes();if(this._oMultiComboBox){this._oMultiComboBox.destroy();this._oMultiComboBox=null;}this._oMultiInput=new a(this.getId()+I,i);this._oMultiInput.attachChange(function(G){this._validateValueOnChange(G.getParameter("value"));},this);if(this.getBindingContext()){this._bindMultiInput();}this._oMultiInput.attachTokenUpdate(function(G){this._validateValueOnChange(this._oMultiInput.getValue());var J=G.getParameters();delete J.id;if(this.getBinding("value").getBindingMode()!=="TwoWay"||!this.getBindingContext()){if(G.getParameter("removedTokens")){G.getParameter("removedTokens").forEach(function(K){K.destroy();});}}this.fireTokenUpdate(J);},this);var E={control:this._oMultiInput,onCreate:"_onMultiInputCreate",params:{type:{type:this._getType(),property:this._oFactory._oMetaData.property}}};this._initMultiInputValueHelp(E);return E;};A.prototype._createMultiComboBox=function(){var i=this._createAttributes();this._oMultiComboBox=new b(this.getId()+"mComboBox",i);if(this.getBindingContext()){this._bindMultiComboBox();}else{this._oMultiInput=this._oMultiComboBox._oTokenizer;}this._oMultiComboBox.attachSelectionChange(function(G){var J=G.getParameters();delete J.id;this.fireSelectionChange(J);},this);this._oMultiComboBox.attachSelectionFinish(function(G){var J=G.getParameters();delete J.id;this.oLocalContext=[];this.fireSelectionFinish(J);},this);var E={control:this._oMultiComboBox,onCreate:"_onCreate",params:{type:{type:this._getType(),property:this._oFactory._oMetaData.property},valuehelp:{annotation:this._getValueListAnnotation(),aggregation:"items",noDialog:true,noTypeAhead:true}}};return E;};A.prototype._createAttributes=function(){var N={width:true,textAlign:true,placeholder:true,tooltip:true,name:true,valueState:true,valueStateText:true};var i=this._oFactory.createAttributes(null,this._oFactory._oMetaData.property,N,{event:"change",parameter:"value"});return i;};function C(E){var G=E.getParameter("tokens"),J,K,i=0,N=[],Q=null,U;this._onCancel();if(this.oControl instanceof sap.m.MultiInput){this.oControl.setValue("");var W=this.oControl.getTokens();var X=[];var Y=[];var Z=[];W.forEach(function($){var a1=G.some(function(c1){return $.getKey()===c1.getKey();});if(!a1){Y.push($);}else{var b1=G.filter(function(c1){return $.getKey()===c1.getKey();})[0];Z.push(b1);}});G.forEach(function($){var a1=W.some(function(b1){return b1.getKey()===$.getKey();});if(!a1){X.push($);Z.push($);}});this.oControl.setTokens(Z);this.oControl.fireTokenUpdate({type:"tokensChanged",removedTokens:Y,addedTokens:X});i=G.length;while(i--){Q=G[i].data("row");if(Q){N.push(Q);}}}else{if(G[0]){if(this.bIsSingleIntervalRange){J=G[0].data("range");if(J){if(this._sType==="datetime"){U=D.getDateTimeInstance(Object.assign({},this._oDateFormatSettings,{UTC:false}));if(typeof J.value1==="string"){J.value1=new Date(J.value1);}if(J.operation==="BT"){if(typeof J.value2==="string"){J.value2=new Date(J.value2);}K=U.format(J.value1)+"-"+U.format(J.value2);}else{K=U.format(J.value1);}}else{if(J.operation==="BT"){K=J.value1+"-"+J.value2;}else{K=J.value1;}}}}else{K=G[0].getKey();}Q=G[0].data("row");if(Q){N.push(Q);}}this.oControl.setValue(K);this.oControl.fireChange({value:K,validated:true});}this._calculateAndSetFilterOutputData(N);}A.prototype._initMultiInputValueHelp=function(i){var E=this._getFilterType(this._oFactory._oMetaData.property.property),G={},J=this._getDateFormatSettings(),K;this._oFactory._getValueHelpDialogTitle(G);if(this._getValueListAnnotation()){i.params.valuehelp={annotation:this._getValueListAnnotation(),aggregation:"suggestionRows",noDialog:false,noTypeAhead:false,supportMultiSelect:this.getSupportMultiSelect(),supportRanges:this.getBindingContext()?false:this.getSupportRanges(),type:E,displayBehaviour:this._getDisplayBehaviour()};}else if(this.getSupportRanges()&&!this.getBindingContext()){K=new g({fieldName:this._getPropertyName(),preventInitialDataFetchInValueHelpDialog:true,model:this.getModel(),control:this._oMultiInput,title:G.dialogtitle,supportMultiSelect:this.getSupportMultiSelect(),supportRanges:true,type:E,dateFormatSettings:J,isUnrestrictedFilter:this._isTimeType(E),displayBehaviour:this._getDisplayBehaviour()});K._onOK=C;this._oMultiInput.addValidator(this._validateToken.bind(this));}else{this._oMultiInput.setShowValueHelp(false);this._oMultiInput.addValidator(this._validateToken.bind(this));}};A.prototype._bindMultiInput=function(){var i=this.getBinding("value").getBindingMode();switch(i){case B.OneTime:this._bindMultiInputOneTime();break;case B.OneWay:this._bindMultiInputOneWay();break;case B.TwoWay:default:this._bindMultiInputTwoWay();}};A.prototype._bindMultiInputOneTime=function(){var i=this;this._readNavigationPropertySet().then(function(E){E.results.forEach(function(G){var K=G[i._getPropertyName()];var J=i._getDescriptionFieldName();var N=J?G[J]:"";i._oMultiInput.addToken(i._createToken(K,N));});});};A.prototype._bindMultiInputOneWay=function(){this._bindMultiInputTokens(this._oMultiInput);};A.prototype._bindMultiInputTwoWay=function(){this._bindMultiInputTokens(this._oMultiInput);this._oMultiInput.attachTokenUpdate(function(E){E.getParameter("addedTokens").forEach(this._addToken.bind(this));E.getParameter("removedTokens").forEach(this._removeToken.bind(this));},this);};A.prototype._bindMultiInputTokens=function(i){var N=this._getNavigationPath(),E=this._getSelectExpandParameter();if(!q(E)){i.bindAggregation("tokens",{path:N,parameters:E,factory:this._tokensFactory.bind(this)});}else{i.bindAggregation("tokens",{path:N,factory:this._tokensFactory.bind(this)});}};A.prototype._getSelectExpandParameter=function(){var i={};if(this.getEnableODataSelect()){i.select=this._addODataSelectParameters();}if(this._oFactory._oMetaData.annotations.text&&this._oFactory._oMetaData.annotations.text.navigationPathHelp){i.expand=this._oFactory._oMetaData.annotations.text.navigationPathHelp;}return i;};A.prototype._addODataSelectParameters=function(i){var E=this._getPropertyName();if(this._getDescriptionFieldName()){E=E+","+this._getDescriptionFieldName();}if(this.getRequestAtLeastFields()){E=E+","+this.getRequestAtLeastFields();}return E;};A.prototype._checkFieldGroups=function(){var i,E,G=this.getMode();if(this.getBindingContext()&&this._oFactory&&this._oFactory._oMeta&&(G==="edit")&&!this._bSideEffects){var J=this._oFactory._oMeta.entitySet,K=this.getModel().getMetaModel().getODataEntitySet(J),N=this.getModel().getMetaModel().getODataEntityType(K.entityType);E={entitySet:K,entityType:N,path:this._getNavigationPath()};i=this._getView();if(i&&E){this._setFieldGroup(E,i);}}};A.prototype._bindMultiComboBox=function(){var i=this.getBinding("value").getBindingMode();switch(i){case B.OneTime:this._bindMultiComboBoxOneTime();break;case B.OneWay:this._bindMultiComboBoxOneWay();break;case B.TwoWay:default:this._bindMultiComboBoxTwoWay();}};A.prototype._bindMultiComboBoxOneTime=function(){var i=this;this._readNavigationPropertySet().then(function(E){var K=E.results.map(function(G){return G[i._getPropertyName()];});i._oMultiComboBox.setSelectedKeys(K);});};A.prototype._bindMultiComboBoxOneWay=function(){this._createAndAttachHelperMultiInput();};A.prototype._bindMultiComboBoxTwoWay=function(){this._createAndAttachHelperMultiInput();this.oLocalContext=[];this._oMultiComboBox.attachSelectionChange(function(E){var i=E.getParameter("selected"),G=E.getParameter("changedItem"),J={},K,N,Q;if(i){J[this._getPropertyName()]=G.getKey();Q=G.getBindingContext("list")||G.getBindingContext();K=Q.getProperty();this._getEntityType().key.propertyRef.forEach(function(U){if(K&&K[U.name]){J[U.name]=K[U.name];}});}else{N=this._oMultiInput.getTokens().filter(function(U){return U.getKey()===G.getKey();})[0];}if(i){this.oLocalContext.push(this._createEntity(J));}else{if(N){this._removeEntity(N.getBindingContext());}else{this.oLocalContext.forEach(function(U,W){if(U.getProperty(this._getPropertyName())===G.getKey()){this._getModel().deleteCreatedEntry(U);this.oLocalContext.splice(W,1);}}.bind(this));}}},this);};A.prototype._readNavigationPropertySet=function(){var i=this;return new Promise(function(E,G){var J=i.getBindingContext(),K=i._getModel(),N=i._getNavigationPath();K.read(N,{context:J,success:function(Q){E(Q);},error:function(Q){i.setValueState(u.Error);i.setValueStateText(Q.responseText);G(Q);}});});};A.prototype._createAndAttachHelperMultiInput=function(){this._oMultiInput=new a();this._oMultiInput.setBindingContext(this.getBindingContext());this._oMultiInput.setModel(this._getModel());this._bindMultiInputTokens(this._oMultiInput);var i=this._oMultiInput.getBinding("tokens");function E(){var K=this._oMultiInput.getTokens().map(function(G){return G.getKey();});if(this._oMultiComboBox){this._oMultiComboBox.setSelectedKeys(K);}}E.call(this);i.attachChange(E,this);};A.prototype._getReadTokenList=function(){if(!this.oReadTokenList){this.oReadTokenList=new L();this.addDependent(this.oReadTokenList);}return this.oReadTokenList;};A.prototype._getReadTokenListPopover=function(){if(!this.oReadTokenListPopover){this.oReadTokenListPopover=new P({showArrow:true,placement:v.Auto,showHeader:false,contentMinWidth:"auto",content:[this.oReadTokenList]});this.addDependent(this.oReadTokenListPopover);}return this.oReadTokenListPopover;};A.prototype._handleNMoreIndicatorPress=function(){var E=this.getTokens();if(!E){return;}var G=this._getReadTokenList();var J=this._getReadTokenListPopover();G.removeAllItems();for(var i=0,K=E.length;i<K;i++){var N=E[i],Q=new S({title:N.getText()});G.addItem(Q);}if(this._oMoreLink.getDomRef()){J.openBy(this._oMoreLink.getDomRef());}};A.prototype._onResize=function(){if(this._isReadMode()&&this._oTokenizer){this._deregisterResizeHandler();this._oTokenizer.setMaxWidth(this.$().width()+"px");this._oTokenizer.setRenderMode("Narrow");this._oTokenizer.scrollToEnd();this._registerResizeHandler();}};A.prototype.onBeforeRendering=function(){if(d.prototype.onBeforeRendering){d.prototype.onBeforeRendering.apply(this,arguments);}this._deregisterResizeHandler();};A.prototype.onAfterRendering=function(){if(d.prototype.onAfterRendering){d.prototype.onAfterRendering.apply(this,arguments);}if(this.getMode()==="display"&&this.bControlNotRendered){this._oHBox.removeAllItems();this._oMoreLink.setVisible(false);this.getTokens().forEach(function(i){var E=this._generateDisplayText(i.getText());this._oHBox.addItem(E);},this);}this._registerResizeHandler();};A.prototype._registerResizeHandler=function(){if(!this._iResizeHandlerId){this._iResizeHandlerId=R.register(this,this._onResize.bind(this));}};A.prototype._deregisterResizeHandler=function(){if(this._iResizeHandlerId){R.deregister(this._iResizeHandlerId);this._iResizeHandlerId=null;}};A.prototype._createTokenizer=function(){this._oTokenizer=new c(this.getId()+w,{editable:false,visible:false,width:"100%"});this._oHBox=new H(this.getId()+x);this._oMoreLink=new n(this.getId()+y,{press:this._handleNMoreIndicatorPress.bind(this)});this._oEmptyDash=new o({text:"â€“",visible:true});var N=this._getNavigationPath(),i=this._getSelectExpandParameter();if(this.getBindingContext()){this._bindMultiInputTokens(this._oTokenizer);this._oHBox.bindAggregation("items",{path:N,parameters:i,factory:this._textFactory.bind(this)});}else{this.attachInnerControlsCreated(this._mirrorTokensToDisplayTokenizer,this);}var E=new p({height:"100%",items:[this._oEmptyDash,this._oHBox,this._oMoreLink,this._oTokenizer]});return{control:E,onCreate:"_onCreate"};};A.prototype._textFactory=function(i,E){var G=E.getProperty(this._getPropertyName()),K=G instanceof Date?this._formatValue(G):G.toString(),J=this._getDescriptionFieldName(),N=J?E.getProperty(J):"",Q=this._getFormattedText(K,N),U;if(this.getDomRef()){this.bControlNotRendered=false;U=this._generateDisplayText(Q);}else{this.bControlNotRendered=true;U=new o({text:Q});}if(this._oEmptyDash){this._oEmptyDash.setVisible(false);}return U;};A.prototype._generateDisplayText=function(i){var E=this.getDomRef(),G=E.offsetWidth,N=W("999 "+z.getText("POPOVER_DEFINE_MORE_LINKS")),J=new o({wrapping:false}),K,Q,U;function W(i){var Z=document.createElement("span");Z.style.whiteSpace="nowrap";Z.innerHTML=i;Z.className="sapMText";E.appendChild(Z);var $=E.childNodes;var a1=$[$.length-1].offsetWidth;E.removeChild(E.childNodes[$.length-1]);return a1;}if(this._oHBox.getItems().length===0){this._iHBoxWidth=0;this._iHiddenLabelsCount=0;}this._oHBox.getItems().filter(function(Z){return!Z.getVisible();}).forEach(function(Z){this._oHBox.removeItem(Z);}.bind(this));J.setTooltip(i);i=this._iHBoxWidth===0?i:"\u00a0"+this.getTextSeparator()+"\u00a0"+i;J.setText(i);var X=W(i);this._iHBoxWidth+=X;if(this._iHiddenLabelsCount===0&&this._iHBoxWidth<G){this._oMoreLink.setVisible(false);}else{while(this._iHBoxWidth>G-N){this._iHiddenLabelsCount+=1;if(this._oHBox.getItems()[0]){var Y=W(this._oHBox.getItems()[0].getText());this._iHBoxWidth-=Y;this._oHBox.removeItem(0);}else{this._iHBoxWidth-=X;J.setVisible(false);}}if(this._oHBox.getItems().length===0&&this._iHiddenLabelsCount===1&&!J.getVisible()){this._iHiddenLabelsCount=0;this._iHBoxWidth+=X;J.setVisible(true);J.setWrapping(true);this._oMoreLink.setVisible(false);}else{if(this._oHBox.getItems().length>0){K=this._oHBox.getItems()[0];K.setText(K.getTooltip());if(this._oHBox.getItems().length-1>0){Q=this._oHBox.getItems()[(this._oHBox.getItems().length-1)];U="\u00a0"+this.getTextSeparator()+"\u00a0"+Q.getTooltip();Q.setText(U);}J.setText(J.getText()+"\u00a0"+this.getTextSeparator()+"\u00a0");}else{J.setText(J.getTooltip()+"\u00a0"+this.getTextSeparator()+"\u00a0");}this._oMoreLink.setVisible(true);this._oMoreLink.setText(this._iHiddenLabelsCount+" "+z.getText("POPOVER_DEFINE_MORE_LINKS"));}}return J;};A.prototype._mirrorTokensToDisplayTokenizer=function(){if(this.getMode()==="display"&&typeof this._oMultiInput!=="undefined"){this._oTokenizer.removeAllTokens();this._oHBox.removeAllItems();this._oMoreLink.setVisible(false);this._oMultiInput.getTokens().forEach(function(i){var N=new T({text:i.getText(),key:i.getKey()});this._oTokenizer.addToken(N);var E=this._generateDisplayText(i.getText());this._oHBox.addItem(E);},this);}};A.prototype.getTextSeparator=function(){var i=this.getProperty("textSeparator");if(i){return i;}return z.getText("SMARTMULTIINPUT_SEPARATOR");};A.prototype._tokensFactory=function(i,E){var G;if(this._oFactory){var J=E.getProperty(this._getPropertyName());var K=J instanceof Date?this._formatValue(J):J.toString();var N=this._getDescriptionFieldName();var Q=N?E.getProperty(N):"";G=this._createToken(K,Q,E);}else{G=new T();}return G;};A.prototype._createToken=function(K,i,E){var G=this._getFormattedText(K,i);var J;J=new T();J.setKey(K);J.setText(G);return J;};A.prototype._addToken=function(i){var E={},G,J=i.data("row"),K=i.data("range");E[this._getPropertyName()]=i.getKey();if(J){this._getEntityType().key.propertyRef.forEach(function(N){if(J[N.name]){E[N.name]=J[N.name];}});}if(K){E["range"]=K;}this.setValueState(u.None);G=this._createEntity(E);i.setBindingContext(G);};A.prototype._createEntity=function(i){var E=this._getModel(),G=this._getEntitySetName(),J=E._resolveGroup(G),K=this._getNavigationPath(),N=this.fireBeforeCreate({oData:i,mParameters:J});J.refreshAfterChange=true;J.context=this.getBindingContext();if(N){J.properties=i;var Q=E.createEntry(K,J);return Q;}};A.prototype._removeToken=function(i){this._removeEntity(i.getBindingContext());i.destroy();};A.prototype._removeEntity=function(i){var E=this._getModel(),G=this._getEntitySetName(),J=E._resolveGroup(G),K=this.fireBeforeRemove({mParameters:J});var N=E.getDeferredGroups().indexOf(J.groupId)>=0||E.getDeferredBatchGroups().indexOf(J.groupId)>=0;if(N&&this._entityHasPendingCreateChange(E,i)){E.deleteCreatedEntry(i);K=false;}J.refreshAfterChange=true;J.context=i;if(K){var Q="";E.remove(Q,J);}};A.prototype._entityHasPendingCreateChange=function(i,E){var G=i.getPendingChanges();var K=i.getKey(E);return!!G[K]&&k(G[K],E.getObject());};A.prototype._getEntityKeyProperties=function(i){var E=this._getModel(),G=E.oMetadata._getEntityTypeByPath(i.getPath()),K={};G.key.propertyRef.forEach(function(J){var N=J.name;K[N]=i.getProperty(N);});return K;};A.prototype.checkClientError=function(){if(this.getMode()==="display"){return false;}return!this._validateMultiInput();};A.prototype.getRangeData=function(){var i=this.getTokens(),E=[];i.forEach(function(G){var J;if(G.data("range")){J=G.data("range");}else{J=this._getDefaultTokenRangeData(G);}E.push(J);},this);return E;};A.prototype.setRangeData=function(i){if(!this.getBindingContext()){var E=Array.isArray(i)?i:[i];if(!this._oMultiInput){var G=this.getEditable(),J=this.getEnabled(),K=this.getContextEditable();this.setEditable(true);this.setEnabled(true);this.setContextEditable(true);this.setEditable(G);this.setEnabled(J);this.setContextEditable(K);}this._oMultiInput.removeAllTokens();E.forEach(function(N){var Q=this._getTokenTextFromRangeData(N);var U=new T({text:Q,key:Q});U.data("range",N);this._oMultiInput.addToken(U);},this);this._mirrorTokensToDisplayTokenizer();}else{j.warning("setRangeData can only be used without property binding");}};A.prototype._getTokenTextFromRangeData=function(i){var E="";switch(i.operation){case r.EQ:E="="+i.value1;break;case r.GT:E=">"+i.value1;break;case r.GE:E=">="+i.value1;break;case r.LT:E="<"+i.value1;break;case r.LE:E="<="+i.value1;break;case r.Contains:E="*"+i.value1+"*";break;case r.StartsWith:E=i.value1+"*";break;case r.EndsWith:E="*"+i.value1;break;case r.BT:E=i.value1+"...";if(i.value2){E+=i.value2;}break;default:E="";}if(i.exclude&&E!==""){E="!("+E+")";}return E;};A.prototype._getComputedTextInEditModeSource=function(){var i=this.getTextInEditModeSource();if(this.isPropertyInitial("textInEditModeSource")&&this.getMode()==="edit"){i=t.None;}return i;};A.prototype.getFilter=function(){var i=[this._getPropertyName()],E={},G=this.getRangeData(),J;E[this._getPropertyName()]={ranges:G,items:[]};J=h.generateFilters(i,E);return J&&J.length===1&&J[0];};A.prototype._getDefaultTokenRangeData=function(i){var E={exclude:false,operation:r.EQ,value1:this._parseValue(i.getKey()),value2:"",keyField:this._getPropertyName()};return E;};A.prototype._validateToken=function(i){var E=i.text;var G=this._validateValue(E);if(G){var J=new T({key:E,text:E});if(this.getSupportRanges()){var K=this._getDefaultTokenRangeData(J);J.data("range",K);J.setText("="+E);}return J;}};A.prototype._validateMultiInput=function(){if(this._oMultiInput.getValueState()!==u.None){return false;}if(this.getRequired()&&this.getTokens().length===0){this.setValueStateText(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("VALUEHELPVALDLG_FIELDMESSAGE"));this.setValueState(u.Error);return false;}else{this.setValueState(u.None);return true;}};A.prototype._validateValueOnChange=function(i){if(i===""){this.setValueState(u.None);this._validateMultiInput();}else{this._validateValue(i);}};A.prototype._parseValue=function(i){return this._getType().parseValue(i,"string");};A.prototype._formatValue=function(i){return this._getType().formatValue(i,"string");};A.prototype._validateValue=function(i){try{var E=this._parseValue(i);this._getType().validateValue(E);this.setValueState(u.None);return true;}catch(G){this.setValueState(u.Error);this.setValueStateText(G.message);var J={element:this._oMultiInput,property:"value",type:this._getType(),newValue:i,oldValue:null,exception:G,message:G.message};if(G instanceof f){this.fireParseError(J);}else if(G instanceof V){this.fireValidationError(J);}return false;}};A.prototype._getModel=function(){if(this._oFactory){return this._oFactory._oModel;}};A.prototype._getDateFormatSettings=function(){var i=this.data("dateFormatSettings");if(typeof i==="string"){try{i=JSON.parse(i);}catch(E){}}return i;};A.prototype._getNavigationPath=function(){return this._oFactory._oMetaData.navigationPath;};A.prototype._getDescriptionFieldName=function(){var i=this._oFactory._oMetaData.annotations.text;if(i){if(i.navigationPathHelp){return i.navigationPathHelp+"/"+i.property.property.name;}return i.property.property.name;}};A.prototype._getType=function(){if(!this._oType){var i;if(this._isEdmTimeType()){i=this._getDateFormatSettings();}this._oType=this._oFactory._oTypes.getType(this._oFactory._oMetaData.property,i);}return this._oType;};A.prototype._isEdmTimeType=function(){var i=["Edm.DateTime","Edm.DateTimeOffset","Edm.Time"];return i.indexOf(this._oFactory._oMetaData.property.property.type)>-1;};A.prototype._isTimeType=function(i){var E=["date","datetime","time"];return E.indexOf(i)>-1;};A.prototype._getPropertyName=function(){return this._oFactory._oMetaData.property.property.name;};A.prototype._getEntitySetName=function(){return this._oFactory._oMetaData.entitySet.name;};A.prototype._getEntityType=function(){return this._oFactory._oMetaData.entityType;};A.prototype._getValueListAnnotation=function(){return this._oFactory._oMetaData.annotations.valuelist;};A.prototype._getDisplayBehaviour=function(){var i=this._oFactory._getDisplayBehaviourConfiguration("defaultInputFieldDisplayBehaviour");if(!i||i===s.auto){i=s.descriptionAndId;}return i;};A.prototype._getFormattedText=function(K,i){var E=this._getDisplayBehaviour();return F.getFormattedExpressionFromDisplayBehaviour(E,K,i);};A.prototype._getFilterType=function(i){if(O.isNumeric(i.type)){return"numeric";}else if(i.type==="Edm.DateTime"&&i["sap:display-format"]==="Date"){return"date";}else if(i.type==="Edm.String"){return"string";}else if(i.type==="Edm.Boolean"){return"boolean";}else if(i.type==="Edm.Time"){return"time";}else if(i.type==="Edm.DateTimeOffset"){return"datetime";}return undefined;};A.prototype.setEntitySet=function(){d.prototype.setEntitySet.apply(this,arguments);this.updateBindingContext(false,this._getModel());return this;};A.prototype.bindProperty=function(i,E){d.prototype.bindProperty.apply(this,arguments);if(i==="value"){this.updateBindingContext(false,this._getModel());}return this;};A.prototype._checkComboBox=function(){var i=this._oFactory._oSelector.checkComboBox();return i&&i.combobox;};A.prototype._isReadMode=function(){return!this.getEditable()||!this.getEnabled()||!this.getContextEditable();};function _(){this._onCreate.apply(this,arguments);if(this._aProviders.length>0){this._aProviders[0]._onOK=C;}}A.prototype._init=function(){var i=this;d.prototype._init.apply(this,arguments);if(this._oFactory){this._oFactory._createMultiInput=this._createMultiInput.bind(this);this._oFactory._createMultiComboBox=this._createMultiComboBox.bind(this);this._oFactory._createTokenizer=this._createTokenizer.bind(this);this._oFactory._onMultiInputCreate=_;this._oFactory._oSelector.getCreator=function(){if(i._isReadMode()){return"_createTokenizer";}else if(i._checkComboBox()){return"_createMultiComboBox";}else{return"_createMultiInput";}};}};A.prototype.exit=function(){this._deregisterResizeHandler();if(this._oMultiInput){this._oMultiInput.destroy();}if(this._oMultiComboBox){this._oMultiComboBox.destroy();}if(this._oTokenizer){this._oTokenizer.destroy();}if(this._oHBox){this._oHBox.destroy();}this._oMultiInput=null;this._oMultiComboBox=null;this._oTokenizer=null;this._oHBox=null;d.prototype.exit.apply(this,arguments);};return A;});
