/*
 * ! SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/core/LocaleData"],function(B,L){"use strict";var F=B.extend("sap.ui.comp.odata.FiscalFormat",{metadata:{library:"sap.ui.comp"},constructor:function(i,f){B.call(this,i,f);var a,P,b,c,l=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale(),o=L.getInstance(l),C=sap.ui.getCore().getConfiguration().getFormatSettings().getCustomLocaleData(),d=/(m|y)(?:.*)(\W)(m|y)/i,s=C["dateFormats-short"];this.oFormatOptions=f;if(this.oFormatOptions.format.length>4){a="yM";}else if(this.oFormatOptions.format==="PPP"){a="M";}else{a=this.oFormatOptions.format;}if(s&&a==="yM"){c=s.match(d).splice(1).join("");if(c){P=c;}}else{P=o.getCustomDateTimePattern(a,this.oFormatOptions.calendarType);}P=P.replace(/([\u4e00-\u9faf\u3000-\u303f\u3040-\u309f\u30a0-\u30ff\uff00-\uffef])+/gi,'');if(this.oFormatOptions.format.length>4){P=P.replace(/y+/i,this.oFormatOptions.format.slice(0,this.oFormatOptions.format.lastIndexOf("Y")+1));P=P.replace(/m+/i,this.oFormatOptions.format.slice(this.oFormatOptions.format.lastIndexOf("Y")+1));}else if(this.oFormatOptions.format==="PPP"){P="PPP";}b=this.parseCldrDatePattern(P);this.oFormatOptions.pattern=b.length>1?P:"";this._setFormatRegex(b);this._setParseRegex(b);this._setValidationRegex(b);}});F.getDateInstance=function(f){return new F(null,f);};F.prototype.getPattern=function(){return this.oFormatOptions.pattern;};F.prototype.getRegExPattern=function(){return this.sFormatRegExPattern;};F.prototype.getTemplate=function(){return this.sFormatRegExGroups;};F.prototype._setFormatRegex=function(f){var r=[],R=[],P,s,o,y,i;for(i=0;i<f.length;i++){P=f[i];s=P.symbol||"";o=this.oSymbols[s].format;if(s===""){R[i]=(P.value);}else if(s==="y"||s==="Y"){r.unshift("("+o.source+")");R[i]=('$'+1);}else{r.push("("+o.source+")");y=f.some(function(P){return P.symbol==="y"||P.symbol==="Y";});R[i]=y?('$'+2):('$'+1);}}this.sFormatRegExPattern=new RegExp(r.join(""));this.sFormatRegExGroups=R.join("");};F.prototype._setParseRegex=function(f){var P,s,r,i,c,R=[],o={},n=0;for(i=0;i<f.length;i++){P=f[i];s=P.symbol||"";r=this.oSymbols[s].parse;if(s===""){R.push("\\D+?");}else{R.push("("+r.source+")");c=++n;o[c]=P;}}this.sParseRegExPattern=new RegExp("^"+R.join("")+"$");this.fnParseRegExReplacer=function(){var P,g,a=[];for(var i in o){P=o[i];g=arguments[i];if(g.length<P.digits){if(P.symbol==="y"||P.symbol==="Y"){g=p(g);}else{g=g.padStart(P.digits,'0');}}if(P.symbol==="y"||P.symbol==="Y"){a.unshift(g);}else{a.push(g);}}return a.join("");};};F.prototype._setValidationRegex=function(f){var i,P,s,r,R=[];for(i=0;i<f.length;i++){P=f[i];s=P.symbol||"";r=this.oSymbols[s].format;if(s===""){continue;}else if(s==="y"||s==="Y"){R.unshift(r.source);}else{R.push(r.source);}}this.sValidationRegExPattern=new RegExp("^("+R.join(")(")+")$");};F.prototype.parseCldrDatePattern=function(P){var i,c,C,o,f=[];for(i=0;i<P.length;i++){c=P[i];if(C!==c){o={};}else{o.digits+=1;continue;}if(typeof this.oSymbols[c]==="undefined"){o.value=c;o.type="text";}else{o.symbol=c;o.digits=1;}C=c;f.push(o);}return f;};F.prototype.format=function(v){if(v==null){return"";}return v.replace(this.sFormatRegExPattern,this.sFormatRegExGroups);};F.prototype.parse=function(v){if(v){return v.replace(this.sParseRegExPattern,this.fnParseRegExReplacer);}return null;};F.prototype.validate=function(v){return this.sValidationRegExPattern.test(v);};F.oRegexFormatPatterns={"year":/[1-9][0-9]{3}/,"period":/[0-9]{3}/,"quarter":/[1-4]/,"week":/0[1-9]|[1-4][0-9]|5[0-3]/,"day":/371|370|3[0-6][0-9]|[1-2][0-9][0-9]|[1-9][0-9]|[1-9]/};F.oRegexParsePatterns={"year":/[0-9]{1,4}/,"period":/[0-9]{1,3}/,"quarter":/[1-4]/,"week":/[0-9]{1,2}/,"day":/[1-9]/};F.prototype.oSymbols={"":"","y":{format:F.oRegexFormatPatterns.year,parse:F.oRegexParsePatterns.year},"Y":{format:F.oRegexFormatPatterns.year,parse:F.oRegexParsePatterns.year},"P":{format:F.oRegexFormatPatterns.period,parse:F.oRegexParsePatterns.period},"W":{format:F.oRegexFormatPatterns.week,parse:F.oRegexParsePatterns.week},"d":{format:F.oRegexFormatPatterns.day,parse:F.oRegexParsePatterns.day},"Q":{format:F.oRegexFormatPatterns.quarter,parse:F.oRegexParsePatterns.quarter},"q":{format:F.oRegexFormatPatterns.quarter,parse:F.oRegexParsePatterns.quarter}};F.prototype.destroy=function(){B.prototype.destroy.apply(this,arguments);if(this._oAnnotationValidationRegexPattern){this._oAnnotationValidationRegexPattern=null;}};function p(y){var Y,i=Number.parseInt(y),c=new Date().getUTCFullYear(),C=Math.floor(c/100);Y=C*100+i-c;if(y.length===3){i+=Math.floor((C-1)/10)*1000;}else if(Y<-70){i+=(C+1)*100;}else if(Y<30){i+=C*100;}else{i+=(C-1)*100;}return i;}return F;});
