/*
 * ! SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/comp/util/DateTimeUtil","sap/ui/comp/util/FilterUtil","sap/m/DateTimePicker","sap/m/Select","sap/ui/core/Item","sap/m/ComboBox","sap/m/DatePicker","sap/m/DateRangeSelection","sap/m/TimePicker","sap/m/Input","sap/m/MultiComboBox","sap/ui/comp/smartfilterbar/SFBMultiInput","sap/ui/comp/smartfilterbar/SortingUtil","sap/m/SearchField","sap/m/Token","sap/ui/comp/odata/MetadataAnalyser","sap/ui/comp/odata/FiscalMetadata","sap/ui/comp/providers/ValueHelpProvider","sap/ui/comp/providers/ValueListProvider","sap/ui/model/Filter","sap/ui/model/json/JSONModel","sap/ui/comp/odata/ODataType","sap/ui/comp/util/FormatUtil","sap/ui/base/EventProvider","sap/ui/comp/util/IdentifierUtil","sap/ui/comp/providers/TokenParser","sap/ui/core/format/DateFormat","sap/ui/comp/library","sap/ui/core/library","sap/ui/model/analytics/odata4analytics","sap/ui/model/FilterOperator","sap/base/Log","sap/base/util/UriParameters","sap/base/security/encodeURL","sap/base/util/merge"],function(D,F,a,S,I,C,b,c,T,d,M,f,g,h,l,m,o,V,p,q,J,O,r,E,s,t,u,v,w,x,y,L,U,z,A){"use strict";var B=v.smartfilterbar.ControlType;var G=v.smartfilterbar.DisplayBehaviour;var H=v.smartfilterbar.FilterType;var K=w.ValueState;var N=v.valuehelpdialog.ValueHelpRangeOperation;var P=v.smartfilterbar.MandatoryType;var Q=function(e){if(!p){p=sap.ui.require("sap/ui/comp/providers/ValueListProvider");}if(!V){V=sap.ui.require("sap/ui/comp/providers/ValueHelpProvider");}this._bInitialized=false;this._bPending=true;this._bConsiderAnalyticalParameters=false;this._bAttachInitializedDone=false;this.aFilterAnnotations=[];if(e){this._oParentODataModel=e.model;this._sServiceURL=e.serviceUrl;this._sBasicSearchFieldName=e.basicSearchFieldName;this._isBasicSearchEnabled=e.enableBasicSearch;this._bUseContainsAsDefault=e.useContainsAsDefaultFilter==="true";this.sEntityType=e.entityType;this.sEntitySet=e.entitySet;this._isRunningInValueHelpDialog=e.isRunningInValueHelpDialog;this._oAdditionalConfiguration=e.additionalConfiguration;this.sDefaultDropDownDisplayBehaviour=e.defaultDropDownDisplayBehaviour;this.sDefaultTokenDisplayBehaviour=e.defaultTokenDisplayBehaviour;if(typeof e.dateFormatSettings==="string"){try{this._oDateFormatSettings=e.dateFormatSettings?JSON.parse(e.dateFormatSettings):undefined;}catch(i){}}else{this._oDateFormatSettings=e.dateFormatSettings;}if(!this._oDateFormatSettings){this._oDateFormatSettings={};}if(!this._oDateFormatSettings.hasOwnProperty("UTC")){this._oDateFormatSettings["UTC"]=true;}this._oSmartFilter=e.smartFilter;this._bConsiderAnalyticalParameters=e.considerAnalyticalParameters;this._bUseDateRangeType=e.useDateRangeType;this._bConsiderSelectionVariants=e.considerSelectionVariants;this._aConsiderNavigations=e.considerNavigations;this._bSuppressValueListsAssociation=e.suppressValueListsAssociation;}this.sFilterModelName=Q.FILTER_MODEL_NAME;this._sBasicFilterAreaID=Q.BASIC_FILTER_AREA_ID;this._aAnalyticalParameters=[];this._aFilterBarViewMetadata=[];this._aFilterBarFieldNames=[];this._aFilterBarMultiValueFieldMetadata=[];this._aFilterBarStringDateFieldNames=[];this._aFilterBarDateFieldNames=[];this._aFilterBarTimeFieldNames=[];this._aFilterBarTimeIntervalFieldNames=[];this._aFilterBarDateTimeMultiValueFieldNames=[];this._aFilterBarStringFieldNames=[];this._aFilterBarDateTimeFieldNames=[];this._aFieldGroupAnnotation=[];this._oMetadataAnalyser=new m(this._oParentODataModel||this._sServiceURL);this.oModel=new J();this._aValueListProvider=[];this._aValueHelpDialogProvider=[];this._mTokenHandler={};this._mConditionTypeFields={};this._aSelectionVariants=[];this._oParameterization=null;this._oNonAnaParameterization=null;this._aPromises=[];};Q.FILTER_MODEL_NAME="fi1t3rM0d31";Q.BASIC_FILTER_AREA_ID="_BASIC";Q.BASIC_SEARCH_FIELD_ID="_BASIC_SEARCH_FIELD";Q.CUSTOM_FIELDS_MODEL_PROPERTY="_CUSTOM";Q.FIELD_NAME_REGEX=/\./g;Q.ASSOCIATE_VALUE_LISTS="AssociateValueLists";Q._createFilterProvider=function(e){var i=new Q(e);return i._intialiseMetadata();};Q.prototype._intialiseMetadata=function(){var e,k,n,R,W,X,i,j,Y,Z,$,_,a1;this._aPromises=[];this._aFilterBarViewMetadata.push({groupName:this._sBasicFilterAreaID,index:0,fields:[]});if(!this.sEntitySet&&this.sEntityType){this.sEntitySet=this._oMetadataAnalyser.getEntitySetNameFromEntityTypeName(this.sEntityType);}this.sEntityType=this._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.sEntitySet);X=this._oMetadataAnalyser.getAllFilterableFieldsByEntitySetName(this.sEntitySet,this._bConsiderAnalyticalParameters,this._aConsiderNavigations);if(X){this._updateDisplayBehaviour();this._aFieldGroupAnnotation=this._oMetadataAnalyser.getFieldGroupsByFilterFacetsAnnotation(this.sEntityType);R=this._oMetadataAnalyser.getSelectionFieldsAnnotation(this.sEntityType);if(R&&R.selectionFields){this._aSelectionFields=R.selectionFields;}if(this._aFieldGroupAnnotation){e=this._aFieldGroupAnnotation.length;for(i=0;i<e;i++){W=this._aFieldGroupAnnotation[i];$=this._createGroupMetadata(W);$.index=this._aFilterBarViewMetadata.length;this._aFilterBarViewMetadata.push($);}}e=X.length;for(i=0;i<e;i++){W=X[i];k=W.fields.length;$=this._createGroupMetadata(W);this._aFilterBarViewMetadata.push($);for(j=0;j<k;j++){Y=W.fields[j];if(Y.type.indexOf("Edm.")===0){Z=this._createFieldMetadata(Y);$.fields.push(Z);this._aFilterBarFieldNames.push(Z.fieldName);}}n=W.hiddenFields&&W.hiddenFields.length;if(this._isRunningInValueHelpDialog&&n){for(j=0;j<n;j++){Y=W.hiddenFields[j];if(Y.type.indexOf("Edm.")===0){Z=this._createFieldMetadata(Y);$.hiddenFields.push(Z);}}}}}a1=this._getAdditionalConfigurationForCustomGroups(X);e=a1.length;for(j=0;j<e;j++){$=this._createGroupMetadataForCustomGroup(a1[j]);if($){this._aFilterBarViewMetadata.push($);}}_=this._getAdditionalConfigurationForCustomFilterFields();k=_.length;for(j=0;j<k;j++){Z=this._createFieldMetadataForCustomFilterFields(_[j]);if(Z){this._aFilterBarViewMetadata[0].fields.push(Z);}}if(this._hasBasicSearch()){Z=this._createBasicSearchFieldMetadata();this._aFilterBarViewMetadata[0].fields.push(Z);}if(!this._isRunningInValueHelpDialog){this._createParameters();}return new Promise(function(b1){Promise.all(this._aPromises).then(function(){if(this._bConsiderSelectionVariants){this._createSelectionVariants();}this._applyGroupId();this._applyIndexes();this._createInitialModel(true);this._initializeConditionTypeFields();this.setPending(this.isPending());this._bInitialized=true;b1(this);}.bind(this));}.bind(this));};Q.prototype._createSelectionVariants=function(){this._aSelectionVariants=this._oMetadataAnalyser.getSelectionVariantAnnotationList(this.sEntityType);};Q.prototype._createParameters=function(){if(this._oMetadataAnalyser.isSemanticAggregation(this.sEntityType)){if(this._bConsiderAnalyticalParameters){var e=sap.ui.require("sap/ui/model/analytics/odata4analytics");if(e){this._createAnalyticalParameters(e);}else{var i=new Promise(function(R){sap.ui.require(["sap/ui/model/analytics/odata4analytics"],function(e){this._createAnalyticalParameters(e);R();}.bind(this));}.bind(this));this._aPromises.push(i);}}}else{this._createNonAnalyticalParameters();}};Q.prototype._createAnalyticalParameters=function(e){this._oParameterization=this._getAnalyticParameterization(e);this._createAnalyticParameters(this._oParameterization);};Q.prototype._getAnalyticParameterization=function(i){var j,k;try{j=new i.Model(new i.Model.ReferenceByModel(this._oParentODataModel));}catch(e){throw"Failed to instantiate analytical extensions for given OData model: "+e.message;}k=j&&j.findQueryResultByName(this.sEntitySet);return(k&&k.getParameterization());};Q.prototype._createNonAnalyticalParameters=function(){if(this.sEntitySet){this._oNonAnaParameterization=this._oMetadataAnalyser.getParametersByEntitySetName(this.sEntitySet);if(this._oNonAnaParameterization){this._createParametersByEntitySetName(this._oNonAnaParameterization.entitySetName,this._oNonAnaParameterization.parameters);}}};Q.prototype.attachPendingChange=function(e){this._attachEvent("PendingChange",e);};Q.prototype.detachPendingChange=function(e){this._detachEvent("PendingChange",e);};Q.prototype.setPending=function(e){var i=this._bPending!==e;this._bPending=e;if(i){var j={};j.pending=e;this._fireEvent("PendingChange",j);}};Q.prototype.isPending=function(){if(!this._bInitialized){return true;}for(var n in this._mConditionTypeFields){if(this._mConditionTypeFields[n].conditionType.isPending()){return true;}}return false;};Q.prototype._updateDisplayBehaviour=function(){this._sTextArrangementDisplayBehaviour=this._oMetadataAnalyser.getTextArrangementValue(this.sEntityType);if(!this.sDefaultDropDownDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultDropDownDisplayBehaviour=this._sTextArrangementDisplayBehaviour;}else{this.sDefaultDropDownDisplayBehaviour=G.descriptionOnly;}}if(!this.sDefaultTokenDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultTokenDisplayBehaviour=this._sTextArrangementDisplayBehaviour;}else{this.sDefaultTokenDisplayBehaviour=G.descriptionAndId;}}};Q.prototype._hasBasicSearch=function(){return this._isBasicSearchEnabled;};Q.prototype._getAdditionalConfigurationForCustomFilterFields=function(){var e,j,i,R;if(!this._oAdditionalConfiguration){return[];}e=this._oAdditionalConfiguration.getControlConfiguration();if(!this._aFilterBarFieldNames||!this._aFilterBarFieldNames.length){return e;}R=[];j=e.length;for(i=0;i<j;i++){if(this._aFilterBarFieldNames.indexOf(e[i].key)<0){R.push(e[i]);}}return R;};Q.prototype._getAdditionalConfigurationForCustomGroups=function(e){var k,n,R,i,W,j,X,Y;if(!this._oAdditionalConfiguration){return[];}k=this._oAdditionalConfiguration.getGroupConfiguration();if(!e||!e.length){return k;}W=[];R=e.length;n=k.length;for(i=0;i<n;i++){X=false;for(j=0;j<R;j++){Y=e[j].groupName||e[j].groupEntitySetName;if(Y===k[i].key){X=true;break;}}if(!X){W.push(k[i]);}}return W;};Q.prototype._createInitialModelForField=function(j,e,i){var k=false,n,R,W=false,X=false,Y=null,Z=null,$,_=null,a1=[],b1=[];if(!e||e.isCustomFilterField){return;}if(e.filterRestriction!==H.multiple){X=true;}if((e.filterType==="date"||e.filterType==="time"||e.filterType==="datetime")&&!e.isFiscalDate){k=true;}if(i){n=e.defaultFilterValues;W=n&&n.length;if(!W){if(e.defaultPropertyValue&&e.isParameter){R=e.defaultPropertyValue;if(e.filterType==="numeric"){R=this._getType(e).parseValue(R,"string");}n=[{low:R}];W=true;}else if(e.defaultFilterValue){R=e.defaultFilterValue;n=[{low:R,high:R,operator:"EQ",sign:"I"}];W=true;}}}if(e.filterRestriction===H.single){if(W){R=n[0];Y=k?this._createDateTimeValue(e,R.low):R.low;}j[e.fieldName]=Y;}else if(e.filterRestriction===H.interval&&e.type!=="Edm.Time"){if(W){R=n[0];Y=k?this._createDateTimeValue(e,R.low):R.low;Z=k?this._createDateTimeValue(e,R.high):R.high;}j[e.fieldName]={low:Y,high:Z};}else{if(W){$=n.length;while($--){R=n[$];if(X){_={"exclude":R.sign==="E","operation":R.operator==="CP"?"Contains":R.operator,"keyField":e.fieldName,"value1":k?this._createDateTimeValue(e,R.low):R.low,"value2":k?null:R.high};if((e.filterType==="time")&&R.high){_.value2=new Date(R.high);}}else{_={key:k?this._createDateTimeValue(e,R.low):R.low,text:k?"":R.low};}a1.push(_);}}this._aFilterBarMultiValueFieldMetadata.push(e);j[e.fieldName]={value:null};if(X){b1=a1.slice(0);a1=[];j[e.fieldName].ranges=b1;}j[e.fieldName].items=a1;this._updateMultiValueControl(e.control,a1,b1);}};Q.prototype._createDateTimeValue=function(e,i){switch(e.type){case"Edm.Time":if(i.indexOf("PT")===0){return this._getTime(i);}else{L.error("Default value for "+e.fieldName+" could not be parsed.");}break;case"Edm.DateTime":if(typeof i=="string"&&e.displayFormat&&e.displayFormat.toLowerCase()=="date"){var j=i.split('T');i=j[0]+"T00:00:00";return new Date(i);}else{L.error("Default value for "+e.fieldName+" could not be parsed.");}break;case"Edm.DateTimeOffset":return new Date(i);default:L.error("Default value for "+e.fieldName+" could not be parsed.");}};Q.prototype._createInitialModel=function(e){var k,n,R,W,X,j,i;k={};this._bCreatingInitialModel=true;this._aFilterBarMultiValueFieldMetadata=[];if(this._aFilterBarViewMetadata){n=this._aFilterBarViewMetadata.length;for(i=0;i<n;i++){X=this._aFilterBarViewMetadata[i];R=X.fields.length;for(j=0;j<R;j++){this._createInitialModelForField(k,X.fields[j],e);}W=X.hiddenFields&&X.hiddenFields.length;if(this._isRunningInValueHelpDialog&&W){for(j=0;j<W;j++){this._createInitialModelForField(k,X.hiddenFields[j],e);}}}}if(this._aAnalyticalParameters){R=this._aAnalyticalParameters.length;for(j=0;j<R;j++){this._createInitialModelForField(k,this._aAnalyticalParameters[j],e);}}this.oModel.setData(k);if(!e){this._clearConditionTypeFields();}this._updateConditionTypeFields();this._bCreatingInitialModel=false;};Q.prototype._updateMultiValueControl=function(e,j,R,k){var i=0,n=null,W=null,X=null,Y=null,Z=null,$,_,a1;if(e&&j){i=j.length;if(e instanceof f){n=[];while(i--){Y=j[i].text||j[i].key;var W=new l();W.setKey(j[i].key);W.setText(Y);W.setTooltip(Y);n.push(W);}if(R){i=R.length;while(i--){X=R[i];if((X.value1===""||X.value1===null)&&(X.operation===y.EQ)){X.operation=N.Empty;X.tokenText=r.getFormattedRangeText(X.operation,null,null,X.exclude);X.value1=null;}if(X.tokenText){Y=X.tokenText;}else{$=X.value1;_=X.value2;if(k){var b1=["date","datetime","time"];if(b1.indexOf(k.filterType)>-1){a1=this._getType(k);if(a1){if($){if(k.filterType==="time"){$=D.dateToEdmTime(D.localToUtc($));}$=a1.formatValue($,"string");}if(_){if(k.filterType==="time"){_=D.dateToEdmTime(D.localToUtc(_));}_=a1.formatValue(_,"string");}}}else if((k.filterType==="numeric")){a1=this._getType(k);if(a1){if($!==""&&($!==undefined)){if(typeof $==="string"&&!isNaN($)){$=parseFloat($);X.value1=$;}$=a1.formatValue($,"string");}if(_!==""&&(_!==undefined)){if(typeof _==="string"&&!isNaN(_)){_=parseFloat(_);X.value2=_;}_=a1.formatValue(_,"string");}}}else if((k.filterType==="boolean")){a1=this._getType(k);if(a1){if($!==""&&($!==undefined)&&$==="false"){$=a1.formatValue(false,"string");}else{$=a1.formatValue($,"string");}if(_!==""&&(_!==undefined)&&_==="false"){_=a1.formatValue(false,"string");}else{_=a1.formatValue($,"string");}}}else{var c1=k.isCalendarDate||k.isFiscalDate||(($ instanceof Date)||(_ instanceof Date));if(c1){a1=this._getType(k);if($){$=a1.formatValue($,"string");}if(_){_=a1.formatValue(_,"string");}}}}Y=r.getFormattedRangeText(X.operation,$,_,X.exclude);}W=new l();W.setText(Y);W.setTooltip(Y);W.data("range",X);n.push(W);}}e.setTokens(n);e.fireTokenUpdate();}if(e instanceof M){Z=[];while(i--){Z.push(j[i].key);}e.setSelectedKeys(Z);}}};Q.prototype._applyIndexes=function(){if(!this._aFilterBarViewMetadata){return;}this._aFilterBarViewMetadata=g.groupSorting(this._aFilterBarViewMetadata);};Q.prototype._applyGroupId=function(){var e=Array.isArray(this._aFilterBarViewMetadata)?this._aFilterBarViewMetadata.length:0,n,R,W,i,j,k;for(i=0;i<e;i++){if(!this._aFilterBarViewMetadata[i].fields){continue;}n=this._aFilterBarViewMetadata[i].fields.length;for(j=0;j<n;j++){W=this._aFilterBarViewMetadata[i].fields[j];if(W&&W.groupId&&W.groupId!==this._aFilterBarViewMetadata[i].groupName){R=undefined;for(k=0;k<e;k++){if(this._aFilterBarViewMetadata[k].groupName===W.groupId){R=this._aFilterBarViewMetadata[k];break;}}if(R){this._aFilterBarViewMetadata[i].fields.splice(j,1);j--;n--;R.fields=R.fields||[];R.fields.push(W);}}}}};Q.prototype._createFilterControlId=function(e){var i=this._oSmartFilter?this._oSmartFilter.getId():"unit-test";var j=s.replace(e.groupId||"");var n=s.replace(e.fieldName);return i+"-filterItemControl"+j+"-"+n;};Q.prototype._createGroupMetadata=function(e){var i,j=null,k;k=e.groupName||e.groupEntitySetName;if(this._oAdditionalConfiguration){j=this._oAdditionalConfiguration.getGroupConfigurationByKey(k);}i={};i.groupName=k;i.groupLabel=this._getGroupLabel(e,j);i.fields=[];i.hiddenFields=[];i.index=this._getGroupIndex(j);return i;};Q.prototype._createGroupMetadataForCustomGroup=function(e){var i;i={};i.groupName=e.key;i.groupLabel=e.label;i.fields=[];i.index=this._getGroupIndex(e);return i;};Q.prototype._getTime=function(e){var i=u.getTimeInstance({pattern:"'PT'hh'H'mm'M'ss'S'"});return i.parse(e);};Q.prototype._checkMetadataDefaultValue=function(e){var i=e.defaultFilterValue||e.defaultPropertyValue;if(i){try{if((e.type==="Edm.Time")&&(i.indexOf("PT")===0)){this._getTime(i);}else{this._getType(e);}}catch(j){e.defaultPropertyValue=null;e.defaultFilterValue=null;L.error("default value for "+e.fieldName+" could not be parsed.");}}};Q.prototype._getType=function(e){var i,j={},k={},n={};if(e.ui5Type){return e.ui5Type;}if(e.precision||e.scale){k.precision=e.precision;k.scale=e.scale;}if(e.maxLength){k.maxLength=e.maxLength;}if(e.displayFormat){k.displayFormat=e.displayFormat;}if(e.isDigitSequence){k.isDigitSequence=e.isDigitSequence;}if(e.isCalendarDate){n.isCalendarDate=true;}if(e.isFiscalDate&&e.fiscalType){n.isFiscalDate=true;n.fiscalType=e.fiscalType;}if((e.filterType==="date")||(e.filterType==="time")||(e.filterType==="datetime")||e.isCalendarDate){j=Object.assign({},this._oDateFormatSettings,{UTC:false});}i=O.getType(e.type,j,k,n);return i;};Q.prototype._setControlDisplayFormat=function(e,i){var j;if(!i){return;}j=i.style||i.pattern;if(!j){return;}e.setDisplayFormat(j);};Q.prototype._createControl=function(e){var i,j,k=false,n,R;if(e.customControl){return e.customControl;}j=this._getType(e);i=new e.fControlConstructor(this._createFilterControlId(e));if(e.fControlConstructor===c){this._setControlDisplayFormat(i,this._oDateFormatSettings);if(e.isCalendarDate){i.bindProperty("dateValue",{path:this.sFilterModelName+">/"+e.fieldName+"/low",type:j});i.bindProperty("secondDateValue",{path:this.sFilterModelName+">/"+e.fieldName+"/high",type:j});}else{i.bindProperty("dateValue",this.sFilterModelName+">/"+e.fieldName+"/low");i.bindProperty("secondDateValue",this.sFilterModelName+">/"+e.fieldName+"/high");}}else if((e.fControlConstructor===C)||(e.fControlConstructor===S)){if(i.setForceSelection){i.setForceSelection(true);}if(e.fControlConstructor===S){i.addItem(new I({key:"",text:""}));i.addItem(new I({key:false,text:j.formatValue(false,"string")}));i.addItem(new I({key:true,text:j.formatValue(true,"string")}));}else{this._associateValueList(i,"items",e,false,this._getSuppressValueListsAssociation());i.attachSelectionChange(function(){if(this._bUpdatingFilterData||this._bCreatingInitialModel){return;}i.fireChange({filterChangeReason:e.fieldName,value:""});}.bind(this));}i.bindProperty('selectedKey',this.sFilterModelName+">/"+e.fieldName);}else if(e.fControlConstructor===M){this._associateValueList(i,"items",e,false,this._getSuppressValueListsAssociation());i.attachSelectionChange(function(X){if(this._bUpdatingFilterData||this._bCreatingInitialModel){return;}var Y=X.getSource(),Z=null,$=[],_;Z=Y.getSelectedItems();if(Z){_=Z.length;while(_--){$.push({key:Z[_].getKey(),text:Z[_].getText()});}}if(this.oModel){this.oModel.setProperty("/"+e.fieldName+"/items",$);}Y.fireChange({filterChangeReason:e.fieldName,value:""});}.bind(this));i.bindProperty("value",this.sFilterModelName+">/"+e.fieldName+"/value");}else if(e.fControlConstructor===f){if(e.controlType===B.date||e.type==="Edm.Time"||e.type==="Edm.DateTimeOffset"){i.setValueHelpOnly(true);if(e.filterRestriction===H.interval){this._associateValueHelpDialog(i,e,false,false);}else{this._associateValueHelpDialog(i,e,true,true);}}else{if(e.hasValueHelpDialog){this._associateValueHelpDialog(i,e,e.filterRestriction!==H.multiple,true);}else{i.setShowValueHelp(false);}i.bindProperty("value",{path:this.sFilterModelName+">/"+e.fieldName+"/value",type:j});}this._handleMultiInput(i,e,j);}else if(e.fControlConstructor===d){if(e.filterRestriction===H.interval){k=true;i.bindProperty("value",this.sFilterModelName+">/"+e.fieldName+"/low");if(!this.oResourceBundle){this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");}if(!this.sIntervalPlaceholder){this.sIntervalPlaceholder=this.oResourceBundle.getText("INTERVAL_PLACEHOLDER_TEXT");}i.setPlaceholder(this.sIntervalPlaceholder);}else{i.bindProperty('value',{path:this.sFilterModelName+">/"+e.fieldName,type:j});}if(e.hasValueHelpDialog){i.setShowValueHelp(true);if(k){i.setValueHelpOnly(true);}this._associateValueHelpDialog(i,e,false,false);}}else if(e.isCalendarDate){this._setControlDisplayFormat(i,this._oDateFormatSettings);i.bindProperty("dateValue",{path:this.sFilterModelName+">/"+e.fieldName,type:j});}else if(e.fControlConstructor===b){i.bindProperty("dateValue",this.sFilterModelName+">/"+e.fieldName);this._setControlDisplayFormat(i,this._oDateFormatSettings);}else if(e.fControlConstructor===T||e.fControlConstructor===a){i.bindProperty("dateValue",this.sFilterModelName+">/"+e.fieldName);if(this._oDateFormatSettings&&this._oDateFormatSettings.style){i.setDisplayFormat(this._oDateFormatSettings.style);}}if(i instanceof b){i.attachChange(function(X){var Y=X.getParameter("valid");i.data("__mandatoryEmpty",null);if(Y){i.setValueState(K.None);i.setValueStateText();}else{var Z=i._parseValue(X.getParameter("newValue")),$=this._getSelectedDateRange(Z);i.setValueState(K.Error);if($[0]&&$[1]){var _=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp"),a1=this._getDateFieldOutOfRangeErrorText(i,$,j,_);i.setValueStateText(a1);}else if(j){try{j.parseValue("foo","string");}catch(b1){i.setValueStateText(b1.message);}}}}.bind(this));}if(e.hasTypeAhead){if(e.hasValueListAnnotation){i.setShowSuggestion(true);}i.setFilterSuggests(false);this._associateValueList(i,"suggestionRows",e,true,this._getSuppressValueListsAssociation());}if((e.displayFormat==="UpperCase")&&(e.controlType!==B.dropDownList)&&i.attachChange&&i.getValue&&i.setValue){i.attachChange(function(X){var Y=i.getValue();if(Y){i.setValue(Y.toUpperCase());}});if(this._mTokenHandler[i.getId()]&&this._mTokenHandler[i.getId()].parser){var W=this._mTokenHandler[i.getId()].parser;W.getKeyFields()[0].displayFormat=e.displayFormat;}}if(i instanceof d){if(e.maxLength){n=parseInt(e.maxLength);if(!isNaN(n)){if(this._mTokenHandler[i.getId()]&&this._mTokenHandler[i.getId()].parser){var W=this._mTokenHandler[i.getId()].parser;W.getKeyFields()[0].maxLength=n;}else{if(!e.hasValueListAnnotation&&!k){i.setMaxLength(n);}}}}if(e.isFiscalDate){i.setPlaceholder(j.formatter.getPattern());}}R=function(X){var Y=X.getParameter("exception");var Z=X.getParameter("element");if(i&&Z&&(i.getId()===Z.getId())){if(Y){if(i.setValueStateText){i.setValueStateText(Y.message);}}if(i.setValueState){i.setValueState(K.Error);}i.data("__mandatoryEmpty",null);}};i.attachParseError(R);i.attachFormatError(R);i.attachValidationError(R);i.attachValidationSuccess(function(X){var Y=X.getParameter("element");if(i&&Y&&(i.getId()===Y.getId())){if(i.setValueState){i.setValueState(K.None);}if(i.setValueStateText){i.setValueStateText();}i.data("__mandatoryEmpty",null);delete i.__sValidationText;}});return i;};Q.prototype._getControlConstructor=function(e,i){var j=d,k,n,R;R=i?i+e.fieldName:e.fieldName;if(e.isCustomFilterField){j=undefined;}else{k=(e.filterRestriction===H.single);n=(e.filterRestriction===H.interval);if(e.controlType===B.date){if(k){j=b;}else{j=n?c:f;}if(e.isCalendarDate){this._aFilterBarStringDateFieldNames.push(R);}else{this._aFilterBarDateFieldNames.push(R);}if(e.filterRestriction===H.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(R);}}else if(e.controlType===B.dropDownList){if(k){j=this._isBooleanWithFixedValuedButWithoutValueListAnnotation(e)?S:C;}else{j=M;}if(!k){e.filterRestriction=H.multiple;}}else if(e.type==="Edm.Time"){if(k){j=T;}else{j=f;}this._aFilterBarTimeFieldNames.push(R);if(n){this._aFilterBarTimeIntervalFieldNames.push(R);}else if(e.filterRestriction===H.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(R);}}else if(!n&&e.controlType===B.dateTimePicker){if(k){j=a;}else{j=f;}this._aFilterBarDateTimeFieldNames.push(R);if(e.filterRestriction===H.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(R);}}else if(n&&e.type==="Edm.DateTimeOffset"){this._aFilterBarDateTimeFieldNames.push(R);}else if(!k&&!n){j=f;}}return j;};Q.prototype._handleTokenUpdate=function(e,i){this._tokenUpdate({control:i.control,fieldViewMetadata:i.fieldViewMetadata,removedTokens:e&&e.getParameter("removedTokens")});};Q.prototype._tokenUpdate=function(e){var R=e.removedTokens,i=e.control,j=e.fieldViewMetadata,k,n=[],W,X,Y,Z=[],$="/"+j.fieldName;if(this._bUpdatingFilterData||this._bCreatingInitialModel){return;}k=i.getTokens();if(R){k=k.filter(function(X){return R.indexOf(X)===-1;});}if(Array.isArray(k)&&k.length>0){W=k.length;while(W--){X=k[W];Y=X.data("range");if(Y){Y.tokenText=X.getText();if(Y&&(X.getKey().indexOf("range_")===0)){if(j.type==="Edm.Time"){if(Y.value1&&(Y.value1.ms||Y.value1.ms===0)){Y.value1=D.utcToLocal(D.edmTimeToDate(Y.value1));}if(Y.value2&&(Y.value2.ms||Y.value2.ms===0)){Y.value2=D.utcToLocal(D.edmTimeToDate(Y.value2));}}}Z.push(Y);}else{n.push({key:X.getKey(),text:X.getText()});}}}if(this.oModel){this.oModel.setProperty($+"/items",n);this.oModel.setProperty($+"/ranges",Z);}if(i.__bValidatingToken){delete i.__bValidatingToken;}if(!i._pendingAutoTokenGeneration){i.fireChange({filterChangeReason:j.fieldName,value:""});}};Q.prototype._handleMultiInput=function(e,i,j){e._setFilterProvider(this);e._setFieldViewMetadata(i);e.attachTokenUpdate({control:e,fieldViewMetadata:i},this._handleTokenUpdate,this);var k,n=((i.type==="Edm.DateTime"&&i.displayFormat==="Date"));if(i.hasValueListAnnotation||(i.type==="Edm.String")||n){e.attachEvent("_validateOnPaste",function(R){var W=R.getParameter("texts"),X,Y,Z,$,_;Y=W?W.length:0;if(Y>1){R.preventDefault();X=this.oModel.getProperty("/"+i.fieldName);_=X.ranges||[];e.setValue("");while(Y--){Z=W[Y];if(Z){$=null;if(n){k=this._getDateValue(Z,j);if(isNaN(k.getDate())){continue;}else{$=Z;Z=k;}}var a1=t._createRangeByText(Z);_.push(Object.assign({"keyField":i.fieldName,"tokenText":$,"value1":Z,"value2":null},a1));}}this.oModel.setProperty("/"+i.fieldName+"/ranges",_);this._updateMultiValueControl(e,X.items,_,i);}}.bind(this));}};Q.prototype._associateValueHelpDialog=function(e,i,j,k){if(this._getSuppressValueListsAssociation()){this._attachEventOnce(Q.ASSOCIATE_VALUE_LISTS,function(){this._associateValueHelpDialogHandler(e,i,j,k);}.bind(this));}else{this._associateValueHelpDialogHandler(e,i,j,k);}};Q.prototype._associateValueHelpDialogHandler=function(e,i,j,k){var n={fieldName:i.fieldName,control:e,model:this._oParentODataModel,filterModel:this.oModel,filterProvider:this,dateFormatSettings:this._oDateFormatSettings,fieldViewMetadata:i,displayFormat:i.displayFormat,displayBehaviour:i.displayBehaviour,loadAnnotation:i.hasValueListAnnotation,fullyQualifiedFieldName:i.fullName,metadataAnalyser:this._oMetadataAnalyser,preventInitialDataFetchInValueHelpDialog:i.preventInitialDataFetchInValueHelpDialog,supportMultiSelect:k,supportRanges:j,isSingleIntervalRange:i.filterRestriction===H.interval,isUnrestrictedFilter:i.filterRestriction!==H.multiple,type:i.filterType,maxLength:i.maxLength,scale:i.scale,precision:i.precision};if(i.isCalendarDate){n.oType=this._getType(i);}var R=new V(n);R.attachValueListChanged(function(X){if(this._oSmartFilter){this._oSmartFilter.fireFilterChange(X);this._oSmartFilter.validateMandatoryFields();}}.bind(this));if(i.visibleInAdvancedArea||(i.groupId===Q.BASIC_FILTER_AREA_ID)){this.aFilterAnnotations.push(R.loadAnnotation());}this._aValueHelpDialogProvider.push(R);if(j&&e.addValidator){var W=new t();W.addKeyField({key:i.fieldName,label:i.label,type:i.filterType,oType:i.ui5Type});if(i.filterType==="numeric"){W.setDefaultOperation("EQ");}W.associateInput(e);this._mTokenHandler[e.getId()]={parser:W};}};Q.prototype._determineFieldLabel=function(e){var i,j=e.label;if(this._oSmartFilter&&this._oSmartFilter.determineFilterItemByName){i=this._oSmartFilter.determineFilterItemByName(e.name);if(i){j=i.getLabel();}}return j;};Q.prototype._associateValueList=function(e,i,j,k,n){var R=j.visibleInAdvancedArea||(j.groupId===Q.BASIC_FILTER_AREA_ID),W={control:e,aggregation:i,fieldViewMetadata:j,hasTypeAhead:k,annotaionIsToBeLoaded:R};if(n&&R){this._attachEventOnce(Q.ASSOCIATE_VALUE_LISTS,function(){this._associateValueListHandler(W);}.bind(this));}else{this._associateValueListHandler(W);}};Q.prototype._associateValueListHandler=function(e){var i,j=e.control,k=e.aggregation,n=e.fieldViewMetadata,R=e.hasTypeAhead,W=e.annotaionIsToBeLoaded;if(this._oSmartFilter&&!this._bAttachInitializedDone&&U.fromQuery(window.location.search).get("sap-ui-comp-filterbar-data-defer")){var X=this._oParentODataModel;this._sDeferredGroupId="sapUiCompFilterBarData";var Y=X.getDeferredGroups?this._oParentODataModel.getDeferredGroups():null;if(Y!==null){Y.push(this._sDeferredGroupId);X.setDeferredGroups(Y);var Z=function(){X.submitChanges({groupId:this._sDeferredGroupId});var Y=X.getDeferredGroups().filter(function($){return $!==this._sDeferredGroupId;}.bind(this));X.setDeferredGroups(Y);delete this._sDeferredGroupId;this._oSmartFilter.detachInitialized(Z);}.bind(this);this._oSmartFilter.attachInitialized(Z);this._bAttachInitializedDone=true;}}if(n.hasValueListAnnotation){i=new p({fieldName:n.fieldName,control:j,model:this._oParentODataModel,filterModel:this.oModel,filterProvider:this,displayFormat:n.displayFormat,dateFormatSettings:this._oDateFormatSettings,fieldViewMetadata:n,displayBehaviour:n.displayBehaviour,loadAnnotation:true,fullyQualifiedFieldName:n.fullName,metadataAnalyser:this._oMetadataAnalyser,type:n.filterType,aggregation:k,typeAheadEnabled:R,enableShowTableSuggestionValueHelp:n.hasValueHelpDialog,deferredGroupId:this._sDeferredGroupId,context:"SmartFilterBar",fieldHistoryEnabled:n.historyEnabled!==undefined?n.historyEnabled:true,fieldHistoryEnabledInitial:n.historyEnabledInitial!==undefined?n.historyEnabledInitial:true});i.attachValueListChanged(function($){if(this._oSmartFilter){this._oSmartFilter.fireFilterChange($);this._oSmartFilter.validateMandatoryFields();}}.bind(this));if(W){this.aFilterAnnotations.push(i.loadAnnotation());}this._aValueListProvider.push(i);}else if(this._mTokenHandler[j.getId()]&&this._mTokenHandler[j.getId()].parser){this._mTokenHandler[j.getId()].parser.setDefaultOperation("EQ");}};Q.prototype._createAnalyticParameters=function(e){var i,j;if(e){j=e.getAllParameterNames();i=e.getEntitySet();if(i){this._createParametersByEntitySetName(i.getQName(),j);}}};Q.prototype._createParametersByEntitySetName=function(e,j){var k,n=this._oMetadataAnalyser.getFieldsByEntitySetName(e);for(var i=0;i<n.length;i++){if(j.indexOf(n[i].name)>=0){k=this._createAnalyticParameterMetadata(n[i]);if(k&&k.visible){if(this._oNonAnaParameterization&&k.isCustomFilterField){continue;}this._aAnalyticalParameters.push(k);}}}};Q.prototype._createAnalyticParameterMetadata=function(e){var i,j=v.ANALYTICAL_PARAMETER_PREFIX;e.filterRestriction="single-value";i=this._createFieldMetadata(e,j);if(i){i.fieldName=j+e.name;i.isMandatory=true;i.isParameter=true;i.visibleInAdvancedArea=true;}else{L.error("_createAnalyticParameterMetadata issue with property: "+e.name);}return i;};Q.prototype.getAnalyticParameters=function(){return this._aAnalyticalParameters;};Q.prototype.getSelectionVariants=function(){return this._aSelectionVariants;};Q.prototype.getAnalyticBindingPath=function(){var e,i=[],j=this.getAnalyticParameters();j.forEach(function(k){i.push(k.fieldName);});e=this.getFilledFilterData(i);if(this._oParameterization){return this._createAnalyticBindingPath(j,e);}else{return this._createNonAnalyticBindingPath(j,e);}};Q.prototype._createAnalyticBindingPath=function(e,i){var j,k="",n;n=this._getParameterizationRequest(this._oParameterization);if(n){e.forEach(function(R){j=i[R.fieldName];if(!j){j="";}else if(R.type==="Edm.Time"&&j instanceof Date){if(this._oDateFormatSettings&&!this._oDateFormatSettings.UTC){j=D.utcToLocal(j);}j=D.localToUtc(j);j={__edmType:"Edm.Time",ms:j.valueOf()};}else if((R.type!=="Edm.DateTimeOffset")&&this._oDateFormatSettings&&this._oDateFormatSettings.UTC&&j instanceof Date){j=D.localToUtc(j);}n.setParameterValue(R.name,j);}.bind(this));k=n.getURIToParameterizationEntry()+'/'+this._oParameterization.getNavigationPropertyToQueryResult();}return k;};Q.prototype._createNonAnalyticBindingPath=function(e,i){var j,k="",n="";if(this._oNonAnaParameterization){k="/"+this._oNonAnaParameterization.entitySetName+'(';e.forEach(function(R){j=i[R.fieldName];if(!j){j="";}else if(R.type==="Edm.Time"&&j instanceof Date){j=D.localToUtc(j);j={__edmType:"Edm.Time",ms:j.valueOf()};}else if((R.type!=="Edm.DateTimeOffset")&&this._oDateFormatSettings&&this._oDateFormatSettings.UTC&&j instanceof Date){j=D.localToUtc(j);}k+=(n+R.name+"="+z(this._oParentODataModel.formatValue(j,R.type)));n=",";}.bind(this));k+=(")/"+this._oNonAnaParameterization.navPropertyName);}return k;};Q.prototype._getParameterizationRequest=function(){return this._oParameterization?new x.ParameterizationRequest(this._oParameterization):null;};Q.prototype._constructContextUrl=function(e,i){var j=e._getServerUrl();if(j&&(j.lastIndexOf('/')===(j.length-1))){j=j.substr(0,j.length-1);}return j+e.sServiceUrl+"/$metadata#"+i;};Q.prototype.getFilterContextUrl=function(){var e,i=null;if(this._oParentODataModel&&this._oParentODataModel.isA("sap.ui.model.odata.v2.ODataModel")&&this._oParentODataModel.getMetaModel()){e=this._oParentODataModel.getMetaModel().getODataEntitySet(this.sEntitySet);if(e){i=this._constructContextUrl(this._oParentODataModel,e.name);}}return i;};Q.prototype.getParameterContextUrl=function(){var e,i=null;if(this._oParentODataModel&&this._oParentODataModel.isA("sap.ui.model.odata.v2.ODataModel")&&this._oParentODataModel.getMetaModel()){if(this._oParameterization&&this._oParameterization.getEntitySet()){e=this._oParameterization.getEntitySet().getQName();}else if(this._oNonAnaParameterization){e=this._oNonAnaParameterization.entitySetName;}if(e){i=this._constructContextUrl(this._oParentODataModel,e);}}return i;};Q.prototype._createFieldMetadata=function(e,i){var j,k,n,R,W;e.fieldName=this._getFieldName(e);e.fieldNameOData=e.fieldName.replace(Q.FIELD_NAME_REGEX,"/");k=this._oAdditionalConfiguration?this._oAdditionalConfiguration.getControlConfigurationByKey(e.fieldName):null;j=Object.assign({},e);j.filterRestriction=this._getFilterRestriction(e.filterRestriction,k);this._updateValueListMetadata(j,e);j.hasValueHelpDialog=this._hasValueHelpDialog(j,k);if(k){j.preventInitialDataFetchInValueHelpDialog=this._getPreventInitialDataFetchInValueHelpDialog(j,k);if(k.displayBehaviour&&k.displayBehaviour!=="auto"){j.displayBehaviour=k.displayBehaviour;}j.isCustomFilterField=!!(k.customControl);j.visibleInAdvancedArea=!!(k.visibleInAdvancedArea);j.defaultFilterValues=k.defaultFilterValues;j.customControl=k.customControl;n=k.conditionType;j.width=this._getWidth(k);j.isVisible=this._isVisible(k);j.historyEnabled=k.historyEnabled;j.historyEnabledInitial=k.historyEnabledInitial;}else{j.preventInitialDataFetchInValueHelpDialog=this._getPreventInitialDataFetchInValueHelpDialog(j);j.isVisible=true;j.isCustomFilterField=false;j.visibleInAdvancedArea=false;}j.controlType=this._getControlType(j,k);j.label=this._getLabel(e,k);j.isMandatory=this._isMandatory(e,k);j.groupId=this._getGroupID(e,k);j.index=this._getIndex(e,k);j.fControlConstructor=this._getControlConstructor(j,i);j.isFiscalDate=o.isFiscalValue(j);j.fiscalType=o.getFiscalAnotationType(j);if(j.isFiscalDate){o.updateViewMetadata(j);}j.filterType=this._getFilterType(j);j.hasTypeAhead=this._hasTypeAhead(j,e,k);j.ui5Type=this._getType(j);if(j.ui5Type&&j.ui5Type.isA("sap.ui.model.odata.type.DateTime")){j.ui5Type.formatValue(new Date(),"string");j.ui5Type.oFormat.oFormatOptions.UTC=false;}j.fCreateControl=function(Z){var $;Z.control=this._createControl(Z);$=this.oModel.getData()[Z.fieldName];if($){this._updateMultiValueControl(Z.control,$.items,$.ranges,Z);}}.bind(this);this._applyWidth(j);if(j.type==="Edm.String"){this._aFilterBarStringFieldNames.push(j.fieldName);}j.conditionType=null;if(!n&&this._bUseDateRangeType&&(j.fControlConstructor===c)){n="sap.ui.comp.config.condition.DateRangeType";}if(n){R="";if(typeof n==="object"){R=n.module;n.module=null;}else{R=n;n=null;}try{R=R.replace(/\./g,"/");var X=sap.ui.require(R);if(X){this._enhanceConditionTypeInfo(X,R,n,j);}else{W=new Promise(function(Z){sap.ui.require([R],function(X){this._enhanceConditionTypeInfo(X,R,n,j);Z();}.bind(this));}.bind(this));this._aPromises.push(W);}}catch(Y){L.error("Module "+R+" could not be loaded");}}else{this._checkMetadataDefaultValue(j);}return j;};Q.prototype._requireConditionType=function(e,i,j){var e=e.replace(/\./g,"/");var k=sap.ui.require(e);if(k){this._enhanceConditionTypeInfo(k,e,i,j);}else{sap.ui.require([e],function(k){this._enhanceConditionTypeInfo(k,e,i,j);}.bind(this));}};Q.prototype._enhanceConditionTypeInfo=function(e,i,j,k){var n=e;k.conditionType=new n(k.fieldName,this,k);this._mConditionTypeFields[k.fieldName]=k;if(j&&!this._bUseDateRangeType){k.conditionType.applySettings(j);}this._checkMetadataDefaultValue(k);};Q.prototype._getFilterType=function(e){return r._getFilterType(e);};Q.prototype._updateValueListMetadata=function(e,i){e.hasValueListAnnotation=i["sap:value-list"]!==undefined;if(e.hasValueListAnnotation){e.hasFixedValues=i["sap:value-list"]==="fixed-values";}else if(i["com.sap.vocabularies.Common.v1.ValueList"]){e.hasValueListAnnotation=true;e.hasFixedValues=this._oMetadataAnalyser.getValueListSemantics(i["com.sap.vocabularies.Common.v1.ValueList"])==="fixed-values";if(!e.hasFixedValues){e.hasFixedValues=m.isValueListWithFixedValues(i);}}};Q.prototype._createBasicSearchFieldMetadata=function(){var e;var R=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");e={};e.filterRestriction=H.single;e.name=Q.BASIC_SEARCH_FIELD_ID;e.fieldName=Q.BASIC_SEARCH_FIELD_ID;e.label=undefined;e.isMandatory=false;e.isVisible=true;e.groupId=Q.BASIC_FILTER_AREA_ID;e.index=-1;e.control=new h(this._oSmartFilter.getId()+"-btnBasicSearch",{showSearchButton:true});if(!this._isRunningInValueHelpDialog){e.control.setPlaceholder(R.getText("FILTER_BAR_BSEARCH_PLACE_HOLDER"));}e.control.bindProperty('value',this.sFilterModelName+">/"+e.fieldName);this._oBasicSearchControl=e.control;return e;};Q.prototype._applyWidth=function(e){if(e&&e.width&&e.control&&(typeof e.control.setWidth==='function')){e.control.setWidth(e.width);}};Q.prototype._createFieldMetadataForCustomFilterFields=function(e){var i;if(!e||!e.customControl){return undefined;}i={};i.name=e.key;i.fieldName=e.key;i.label=e.label;i.visibleInAdvancedArea=!!(e&&e.visibleInAdvancedArea);i.isVisible=this._isVisible(e);i.groupId=e.groupId;i.isMandatory=this._isMandatory(undefined,e);i.index=e.index;i.width=this._getWidth(e);i.control=e.customControl;i.isCustomFilterField=true;this._applyWidth(i);return i;};Q.prototype._getFieldName=function(e){if(!e.parentPropertyName){return e.name;}else{return e.parentPropertyName+"."+e.name;}};Q.prototype._getPreventInitialDataFetchInValueHelpDialog=function(e,i){if(i&&!i.isSetPreventInitialDataFetchInValueHelpDialog){return i.preventInitialDataFetchInValueHelpDialog;}if(m.isValueList(e)&&e["com.sap.vocabularies.Common.v1.ValueList"]&&e["com.sap.vocabularies.Common.v1.ValueList"].FetchValues){return e["com.sap.vocabularies.Common.v1.ValueList"].FetchValues.Int!=="1";}return false;};Q.prototype._hasValueHelpDialog=function(e,i){var j=true;if(i){if(i.controlType===B.dropDownList){j=false;}else if(i.hasValueHelpDialog!==true){j=false;}}if(e&&!e.hasValueListAnnotation){if(e.filterRestriction===H.single||e.filterRestriction===H.multiple){j=false;}}return j;};Q.prototype._isVisible=function(e){if(e&&e.isVisible===false){return false;}return true;};Q.prototype._getWidth=function(e){if(e&&e.width){return e.width;}return undefined;};Q.prototype._isMandatory=function(e,i){if(i&&i.mandatory!==P.auto){return i.mandatory===P.mandatory;}if(e){return e.requiredFilterField;}return false;};Q.prototype._getFilterRestriction=function(e,i){if(i&&i.filterType&&i.filterType!==H.auto){return i.filterType;}switch(e){case"single-value":return H.single;case"multi-value":return H.multiple;case"interval":return H.interval;default:return H.auto;}};Q.prototype._getControlType=function(e,i){var j;if(i&&i.controlType&&i.controlType!==B.auto){j=i.controlType;}else if(e.type==="Edm.DateTime"&&e.displayFormat==="Date"||e.isCalendarDate){j=B.date;}else if(e.type==="Edm.DateTimeOffset"){j=B.dateTimePicker;}else if(e.hasValueListAnnotation&&e.hasFixedValues){j=B.dropDownList;}else if(this._isBooleanWithFixedValuedButWithoutValueListAnnotation(e)){j=B.dropDownList;}else{j=B.input;}return j;};Q.prototype._isBooleanWithFixedValuedButWithoutValueListAnnotation=function(e){if(e.type==="Edm.Boolean"&&!e.hasFixedValues&&!e.hasValueListAnnotation&&(e.filterRestriction==="single")){return true;}return false;};Q.prototype._getGroupID=function(e,i){if(i&&i.groupId){return i.groupId;}else if(e&&(e.requiredFilterField||(this._aSelectionFields&&this._aSelectionFields.indexOf(e.fieldNameOData)>-1))){return this._sBasicFilterAreaID;}return this._getGroupIDFromFieldGroup(e);};Q.prototype._getGroupIDFromFieldGroup=function(e){var i=0,j=null,k;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){i=this._aFieldGroupAnnotation.length;while(i--){j=this._aFieldGroupAnnotation[i];if(j&&j.fields&&j.fields.indexOf(e.fieldNameOData)>-1){k=j.groupName;break;}}}return k;};Q.prototype._getLabel=function(e,i){if(i&&i.label){return i.label;}return this._getLabelFromFieldGroup(e)||e.fieldLabel||e.fieldName;};Q.prototype._getLabelFromFieldGroup=function(e){var i=0,j=null,k;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){i=this._aFieldGroupAnnotation.length;while(i--){j=this._aFieldGroupAnnotation[i];if(j&&j.fields&&j.fields.indexOf(e.fieldNameOData)>-1){k=j.labels[e.fieldNameOData];break;}}}return k;};Q.prototype._getIndex=function(e,i){if(i&&(i.index>=0)){return i.index;}else if(this._aSelectionFields&&this._aSelectionFields.indexOf(e.fieldNameOData)>-1){return this._aSelectionFields.indexOf(e.fieldNameOData);}return this._getIndexFromFieldGroup(e);};Q.prototype._getIndexFromFieldGroup=function(e){var i=0,j=null,k;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){i=this._aFieldGroupAnnotation.length;while(i--){j=this._aFieldGroupAnnotation[i];if(j&&j.fields){k=j.fields.indexOf(e.fieldNameOData);if(k>-1){break;}k=undefined;}}}return k;};Q.prototype._getGroupIndex=function(e){if(e&&(e.index||e.index===0)){return e.index;}};Q.prototype._getGroupLabel=function(e,i){if(i&&i.label){return i.label;}return e.groupLabel||e.groupName||e.groupEntitySetName;};Q.prototype._hasTypeAhead=function(e,i,j){var k;k=true;if(j){k=j.hasTypeAhead;}else if(i.type!=="Edm.String"){return false;}if(!(e.fControlConstructor===d||e.fControlConstructor===f)){return false;}return k;};Q.prototype.getModel=function(){return this.oModel;};Q.prototype.getFilterBarViewMetadata=function(){return this._aFilterBarViewMetadata;};Q.prototype.getAssociatedValueHelpProviders=function(){return this._aValueHelpDialogProvider;};Q.prototype.getAssociatedValueListProviders=function(){return this._aValueListProvider;};Q.prototype.getParameters=function(){var e,i=null;if(this.oModel){i=this.oModel.getProperty("/"+Q.BASIC_SEARCH_FIELD_ID);}if(this._sBasicSearchFieldName||i){e={custom:{}};if(this._sBasicSearchFieldName){e.custom["search-focus"]=this._sBasicSearchFieldName;}e.custom["search"]=i||"";}return e;};Q.prototype.getFilters=function(e){var i=null;if(this.oModel){i=this.oModel.getData();}return Q.generateFilters(e,i,{dateSettings:this._oDateFormatSettings,useContainsAsDefault:this._bUseContainsAsDefault,stringFields:this._aFilterBarStringFieldNames,timeFields:this._aFilterBarTimeFieldNames,dateTimeOffsetValueFields:this._aFilterBarDateTimeFieldNames,viewMetadataData:this._aFilterBarViewMetadata});};Q.prototype.getFilterData=function(){return this.oModel?this.oModel.getData():null;};Q.prototype.getFilterDataAsString=function(){return this.oModel?this.oModel.getJSON():null;};Q.prototype.getFilledFilterData=function(e){var i,j={},k,n,R;i=this.oModel?this.oModel.getData():null;if(i&&e){k=e.length;while(k--){n=e[k];if(n&&n!==Q.BASIC_SEARCH_FIELD_ID){R=i[n];if(R&&R.hasOwnProperty("low")){if(R.low){j[n]=R;}}else if(R&&R.hasOwnProperty("items")){if(R.value&&typeof R.value==="string"){R.value=R.value.trim();}if(R.items.length||(R.ranges&&R.ranges.length)||R.value||(typeof R.value==="boolean")){j[n]=R;}}else if(R){if(typeof R==="string"){R=R.trim();}if(R){j[n]=R;}}}if(k===0){n=Q.CUSTOM_FIELDS_MODEL_PROPERTY;R=i[n];if(R){j[n]=R;}}}}return A({},j);};Q.prototype.getFilledFilterDataAsString=function(e){return JSON.stringify(this.getFilledFilterData(e));};Q.prototype.setFilterData=function(j,R){var e=null,i=null,k=null;if(this.oModel&&j){this._bUpdatingFilterData=true;try{if(R){this._createInitialModel(false);}e=this._parseFilterData(j,R);if(e){this.oModel.setData(e,true);i=[];var n=arguments[2];if(n){i.push(n);}for(k in e){i.push(k);}this._handleFilterDataUpdate(i);}}finally{this._bUpdatingFilterData=false;}}};Q.prototype.setFilterDataAsString=function(j,R){if(j){this.setFilterData(JSON.parse(j),R);}};Q.prototype._parseFilterData=function(j,R){return Q.parseFilterData(this.oModel.getData(),j,{stringDateFields:this._aFilterBarStringDateFieldNames,dateFields:this._aFilterBarDateFieldNames,timeFields:this._aFilterBarTimeFieldNames,timeIntervalFields:this._aFilterBarTimeIntervalFieldNames,dateTimeMultiValueFields:this._aFilterBarDateTimeMultiValueFieldNames,conditionTypeFields:this._mConditionTypeFields,dateTimeOffsetValueFields:this._aFilterBarDateTimeFieldNames,viewMetadataData:this._aFilterBarViewMetadata,filterProvider:this},R);};Q.prototype._handleFilterDataUpdate=function(e){var i=0,j,k,n;if(this._aFilterBarMultiValueFieldMetadata){i=this._aFilterBarMultiValueFieldMetadata.length;while(i--){if(!k){k=this.oModel.getData();}if(k){j=this._aFilterBarMultiValueFieldMetadata[i];if(e.indexOf(j.fieldName)>-1){n=k[j.fieldName];if(n){this._updateMultiValueControl(j.control,n.items,n.ranges,j);}}}}this._updateConditionTypeFields();}};Q.prototype.clear=function(){this._createInitialModel(false);};Q.prototype.reset=function(){this._createInitialModel(true);};Q.prototype._initializeConditionTypeFields=function(){var e=function(i){this.setPending(this.isPending());}.bind(this);for(var n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.initialize(this.oModel.getData()[n]);if(this._mConditionTypeFields[n].conditionType.getAsync()){this._mConditionTypeFields[n].conditionType.attachPendingChange(e);}}};Q.prototype._updateConditionTypeFields=function(){var e=this._oldData;var i=this.oModel.getData();this._oldData=A({},i);if(e!==undefined){var j=[],n;for(n in i){var k=JSON.stringify(i[n]);var R=JSON.stringify(e[n]);if(k!==R){j.push(n);}}if(j.length>0){for(n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.providerDataUpdated(j,i);}}}};Q.prototype._clearConditionTypeFields=function(){var e=this.oModel.getData();for(var n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.initialize(e[n]);}};Q.prototype._validateConditionTypeFields=function(){var i=false;for(var n in this._mConditionTypeFields){var e=this._mConditionTypeFields[n].conditionType.validate();if(!e&&!i){i=true;}}return i;};Q.prototype._getFieldMetadata=function(e){return Q._getFieldMetadata(this.getFilterBarViewMetadata(),e);};Q._getFieldMetadata=function(e,i){var j=null;e.some(function(k){if(k&&k.fields){k.fields.some(function(n){if(n&&n.fieldName===i){j=n;}return j!==null;});}return j!==null;});return j;};Q.prototype._getSelectedDateRange=function(e){if(!Array.isArray(e)){e=[e,e];}return e;};Q.prototype._getDateFieldOutOfRangeErrorText=function(e,i,j,R){var k=e.getMinDate()||e._oMinDate,n=e.getMaxDate()||e._oMaxDate;if(i[0].getTime()<k.getTime()){return R.getText("FILTER_BAR_DATE_FIELD_MIN_DATE_ERROR",[j.formatValue(k,"string")]);}if(i[1].getTime()>n.getTime()){return R.getText("FILTER_BAR_DATE_FIELD_MAX_DATE_ERROR",[j.formatValue(n,"string")]);}};Q.generateFilters=function(e,i,j){var k=[],n=null,R=null,W=null,X=null,Y=Q.FIELD_NAME_REGEX,Z=null,$,_,a1=null,b1=0,c1=0,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1=[],n1,o1,p1;if(j){d1=j.dateSettings;e1=j.useContainsAsDefault;f1=j.stringFields;g1=j.timeFields;j1=j.dateTimeOffsetValueFields;m1=j.viewMetadataData||[];}if(e&&i){c1=e.length;while(c1--){i1=false;k1=false;X=e[c1];l1=Q._getFieldMetadata(m1,X);if(l1&&l1.isCustomFilterField){continue;}if(X&&X!==Q.BASIC_SEARCH_FIELD_ID){a1=null;h1=false;if(e1&&f1){if(f1.indexOf(X)>-1){h1=true;}}else if(g1&&g1.indexOf(X)>-1){i1=true;}else if(j1&&j1.indexOf(X)>-1){k1=true;}Z=i[X];X=X.replace(Y,"/");if(Z&&Z.hasOwnProperty("low")){if(Z.low&&Z.high){$=Z.low;_=Z.high;if(!k1&&d1&&d1.UTC&&$ instanceof Date&&_ instanceof Date){$=D.localToUtc($);_=D.localToUtc(_);}$=Q.adaptTime($,l1);_=Q.adaptTime(_,l1);k.push(new q(X,y.BT,$,_));}else if(Z.low){if(Z.low instanceof Date){$=Z.low;if(!k1&&d1&&d1.UTC){$=D.localToUtc($);}$=Q.adaptTime($,l1);k.push(new q(X,y.EQ,$));}else if(typeof Z.low==="string"){if(k1&&l1){a1=r.parseDateTimeOffsetInterval(Z.low);a1[0]=l1.ui5Type.parseValue(a1[0],"string");if(a1.length===2){a1[1]=l1.ui5Type.parseValue(a1[1],"string");}}else{a1=r.parseFilterNumericIntervalData(Z.low);}if(a1&&a1.length===2){Z[0]=Q.adaptTime(Z[0],l1);Z[1]=Q.adaptTime(Z[1],l1);k.push(new q(X,y.BT,a1[0],a1[1]));}else if(a1&&a1.length===1){Z[0]=Q.adaptTime(Z[0],l1);k.push(new q(X,y.EQ,a1[0]));}else{k.push(new q(X,h1?y.Contains:y.EQ,Z.low));}}}}else if(Z&&Z.hasOwnProperty("items")){n=[];W=[];R=null;if(Z&&Z.hasOwnProperty("ranges")){a1=Z.ranges;b1=a1.length;while(b1--){n1=a1[b1];$=n1.value1;_=n1.value2;if(i1){if($ instanceof Date){$=r.getEdmTimeFromDate($);}if(_ instanceof Date){_=r.getEdmTimeFromDate(_);}}else if(l1&&l1.isCalendarDate){if($ instanceof Date){$=l1.ui5Type.parseValue($);}if(_ instanceof Date){_=l1.ui5Type.parseValue(_);}}else if(!k1&&d1&&d1.UTC){if($ instanceof Date){$=D.localToUtc($);}if(_ instanceof Date){_=D.localToUtc(_);}}$=Q.adaptTime($,l1);_=Q.adaptTime(_,l1);o1=(n1.exclude?W:n);if(n1.operation===N.Empty){if(l1&&["Edm.DateTime","Edm.DateTimeOffset"].indexOf(l1.type)>-1){o1.push(new q(X,n1.exclude?y.NE:y.EQ,null));}else{o1.push(Q._getStringEmptyFilter(X,l1,n1.exclude));}}else{if(n1.operation!==y.BT&&n1.operation!==y.NB){_=undefined;}p1=n1.exclude?F.getTransformedExcludeOperation(n1.operation):n1.operation;o1.push(new q(X,p1,$,_));}}if(W.length){R=new q(W,true);}}a1=Z.items;b1=a1.length;while(b1--){n.push(new q(X,y.EQ,a1[b1].key));}if(Z.value||Z.value===0||Z.value===false){if(typeof Z.value==="string"){Z.value=Z.value.trim();}n.push(new q(X,h1?y.Contains:y.EQ,Z.value));}if(n.length){if(R){k.push(new q([new q(n,false),R],true));}else{k.push(new q(n,false));}}else if(R){k.push(R);}}else if(Z||Z===0||Z===false){if(typeof Z==="string"){Z=Z.trim();}if(Z&&Z instanceof Date){if(i1){Z=r.getEdmTimeFromDate(Z);}else if(!k1&&d1&&d1.UTC){Z=D.localToUtc(Z);}}if(Z||Z===0||Z===false){Z=Q.adaptTime(Z,l1);k.push(new q(X,h1?y.Contains:y.EQ,Z));}}}}}return(k.length>1)?[new q(k,true)]:k;};Q._getStringEmptyFilter=function(e,i,j){var k=j?y.NE:y.EQ;if(i&&i.nullable==="false"){return new q(e,k,"");}else{return new q({and:!!j,filters:[new q(e,k,""),new q(e,k,null)]});}};Q.parseFilterData=function(e,j,k,R){var n={},W=null,X=null,Y=null,Z,$,i,_,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1;if(k){b1=k.stringDateFields;c1=k.dateFields;d1=k.timeFields;e1=k.timeIntervalFields;f1=k.dateTimeMultiValueFields;W=k.conditionTypeFields||{};g1=k.dateTimeOffsetValueFields;h1=k.viewMetadataData||[];j1=k.filterProvider||null;}if(!b1){b1=[];}if(!c1){c1=[];}if(!d1){d1=[];}if(!e1){e1=[];}if(!f1){f1=[];}if(!g1){g1=[];}if(e&&j){$=Object.assign({},j,true);for(X in $){i1=Q._getFieldMetadata(h1,X);if(e.hasOwnProperty(X)&&X!==Q.CUSTOM_FIELDS_MODEL_PROPERTY){Y=e[X];Z=$[X];if(X in W){if(Z&&(("conditionTypeInfo"in Z)||(!("conditionTypeInfo"in Z)&&Z.ranges))){W[X].conditionType.initialize(Z);}}else if(Y&&Y.hasOwnProperty("low")){n[X]=Z;if(Z){if((Z.low||Z.low===0)&&(Z.high||Z.high===0)){if((c1.indexOf(X)>-1)||(d1.indexOf(X)>-1)){if(!(Z.low instanceof Date)){n[X].low=new Date(Z.low);}if(!(Z.high instanceof Date)){n[X].high=new Date(Z.high);}}else if(j1&&i1&&(g1.indexOf(X)>-1)){n[X].low=i1.ui5Type.formatValue(Z.low,"string")+'-'+i1.ui5Type.formatValue(Z.high,"string");n[X].high=null;}else if(b1.indexOf(X)===-1){n[X].low=Z.low+'-'+Z.high;n[X].high=null;}}else if((Z.low||(Z.low===0)||Z.value)&&!Z.high){if(!Z.low&&Z.value){Z.low=Z.value;}if(((c1.indexOf(X)>-1)||(d1.indexOf(X)>-1)||(g1.indexOf(X)>-1))&&!(Z.low instanceof Date)){k1=Date.parse(Z.low);if(!Number.isNaN(k1)){n[X].low=new Date(k1);}}n[X].low=Z.low;n[X].high=null;}}}else if(Y&&Y.hasOwnProperty("items")){if(Z&&(Z.items||Z.ranges)){if(Z.ranges&&Z.ranges.length){if(e1.indexOf(X)>-1){_=Z.ranges.length;for(i=0;i<_;i++){a1=Z.ranges[i];if(!a1.exclude&&(a1.operation==="EQ"||a1.operation==="BT")){break;}a1=null;}if(a1){if(a1.value1&&typeof a1.value1==="string"){a1.value1=new Date(a1.value1);}if(a1.value2&&typeof a1.value2==="string"){a1.value2=new Date(a1.value2);}n[X]={ranges:[a1],items:[],value:""};}continue;}else if(c1.indexOf(X)>-1||d1.indexOf(X)>-1||g1.indexOf(X)>-1){_=Z.ranges.length;for(i=0;i<_;i++){a1=Z.ranges[i];if(a1.value1&&typeof a1.value1==="string"){a1.value1=new Date(a1.value1);}if(a1.value2&&typeof a1.value2==="string"){a1.value2=new Date(a1.value2);}}}else if(i1&&i1.isCalendarDate){_=Z.ranges.length;for(i=0;i<_;i++){a1=Z.ranges[i];if(a1.value1&&(typeof a1.value1==="string")&&!a1.value1.match(/([1-9][0-9]{3,}|0[0-9]{3})(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])/)){a1.value1=i1.ui5Type.parseValue(new Date(a1.value1),"date");}if(a1.value2&&(typeof a1.value2==="string")&&!a1.value2.match(/([1-9][0-9]{3,}|0[0-9]{3})(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])/)){a1.value2=i1.ui5Type.parseValue(new Date(a1.value2),"date");}}}else if(i1&&i1.filterType==="boolean"){_=Z.ranges.length;for(i=0;i<_;i++){a1=Z.ranges[i];if(a1.hasOwnProperty("value1")){if(typeof a1.value1==="string"){a1.value1=(a1.value1==="true");}}if(a1.hasOwnProperty("value2")){if(typeof a1.value2==="string"){a1.value2=(a1.value2==="true");}}}}}n[X]=Z;if(!R&&n[X].ranges){for(i=0;i<n[X].ranges.length;i++){n[X].ranges[i].tokenText=null;}}}else if(typeof Z==="string"||typeof Z==="number"||Z instanceof Date){if(Z&&(c1.indexOf(X)>-1||d1.indexOf(X)>-1)){if(typeof Z==="string"){Z=new Date(Z);}n[X]={ranges:[{"exclude":false,"operation":"EQ","keyField":X,"value1":Z,"value2":null}],items:[],value:""};}else{n[X]={value:Z,items:[]};}}}else{n[X]=null;if(typeof Z==="string"||typeof Z==="boolean"||typeof Z==="number"||Z instanceof Date){if(typeof Z==="string"&&(c1.indexOf(X)>-1||d1.indexOf(X)>-1||g1.indexOf(X)>-1)){n[X]=new Date(Z);}else{n[X]=Z;}}else if(Z&&(Z.value||Z.value===0||Z.value===false)){n[X]=Z.value;}else if(Z&&Z.items&&Z.items.length){n[X]=Z.items[0].key;}else if(Z&&Z.ranges&&Z.ranges.length){_=Z.ranges.length;for(i=0;i<_;i++){a1=Z.ranges[i];if(!a1.exclude&&a1.operation==="EQ"){break;}a1=null;}if(a1&&a1.value1){if(typeof a1.value1==="string"&&(c1.indexOf(X)>-1||d1.indexOf(X)>-1||g1.indexOf(X)>-1)){n[X]=new Date(a1.value1);}else{n[X]=a1.value1;}}}}}else if(R||X===Q.CUSTOM_FIELDS_MODEL_PROPERTY){n[X]=$[X];}}}return n;};Q.adaptTime=function(e,i){var j;if(!(e instanceof Date)||!i){return e;}if(i.displayFormat==="Date"){return D.normalizeDate(e,true);}j=parseInt(i.precision);return D.adaptPrecision(e,j);};Q.prototype._attachEvent=function(e,i){if(!this._oEventProvider){this._oEventProvider=new E();}this._oEventProvider.attachEvent(e,i);};Q.prototype._attachEventOnce=function(e,i){if(!this._oEventProvider){this._oEventProvider=new E();}this._oEventProvider.attachEventOnce(e,i);};Q.prototype._detachEvent=function(e,i){if(!this._oEventProvider){return;}this._oEventProvider.detachEvent(e,i);};Q.prototype._fireEvent=function(e,i){if(!this._oEventProvider){return;}this._oEventProvider.fireEvent(e,i||{});};Q.prototype._getSuppressValueListsAssociation=function(){return this._bSuppressValueListsAssociation;};Q.prototype._getCurrentValidationPromises=function(){return this._aValueListProvider.concat(this._aValueHelpDialogProvider).reduce(function(e,i){return e.concat(i._getCurrentValidationPromises());},[]);};Q.prototype.destroy=function(){var e=function(R){var i;if(R){i=R.length;while(i--){R[i].destroy();}}};this._oParentODataModel=null;this._aAnalyticalParameters=null;this._aFilterBarViewMetadata=null;this._oParameterization=null;this._oNonAnaParameterization=null;this._aFilterBarFieldNames=null;this._aFilterBarStringDateFieldNames=null;this._aFilterBarDateFieldNames=null;this._aFilterBarTimeFieldNames=null;this._aFilterBarTimeIntervalFieldNames=null;this._aFilterBarDateTimeMultiValueFieldNames=null;this._aFilterBarStringFieldNames=null;this._aFilterBarMultiValueFieldMetadata=null;this._aFilterBarDateTimeFieldNames=null;this._aFieldGroupAnnotation=null;this._aSelectionFields=null;this._aSelectionVariants=null;if(this._oBasicSearchControl&&this._oBasicSearchControl.destroy){this._oBasicSearchControl.destroy();}this._oBasicSearchControl=null;if(this._oMetadataAnalyser&&this._oMetadataAnalyser.destroy){this._oMetadataAnalyser.destroy();}this._oMetadataAnalyser=null;e(this._aValueHelpDialogProvider);this._aValueHelpDialogProvider=null;e(this._aValueListProvider);this._aValueListProvider=null;if(this._mTokenHandler){for(var j in this._mTokenHandler){var k=this._mTokenHandler[j];if(k.parser){k.parser.destroy();k.parser=null;}}delete this._mTokenHandler;}this.oResourceBundle=null;this.sIntervalPlaceholder=null;this.sDefaultDropDownDisplayBehaviour=null;this.sDefaultTokenDisplayBehaviour=null;this._oSmartFilter=null;if(this._oEventProvider){if(this._oEventProvider.destroy){this._oEventProvider.destroy();}this._oEventProvider=null;}for(var n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.destroy();}this._mConditionTypeFields=null;if(this.oModel){this.oModel.destroy();this.oModel=null;}this._aPromises=[];this.bIsDestroyed=true;};return Q;},true);
