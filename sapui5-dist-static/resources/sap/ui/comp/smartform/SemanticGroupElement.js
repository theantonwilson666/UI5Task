/*
 * ! SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/comp/library','sap/ui/core/Control','sap/ui/layout/form/SemanticFormElement','sap/m/Label','sap/ui/comp/smartfield/SmartLabel','sap/ui/comp/smartfield/SmartField',"sap/base/Log"],function(l,C,F,L,S,a,b){"use strict";var V;var G;var c=l.smartfield.ControlContextType;var d=F.extend("sap.ui.comp.smartform.SemanticGroupElement",{metadata:{library:"sap.ui.comp",interfaces:["sap.ui.comp.IFormGroupElement"],properties:{elementForLabel:{type:"int",group:"Misc",defaultValue:0}},defaultAggregation:"elements",aggregations:{elements:{type:"sap.ui.core.Control",multiple:true,singularName:"element"}},events:{visibleChanged:{}}},_bVisibleElements:false});function _(i,R){if(i==this._oSetLabelFromOutside){return;}var T;if(this._oSetLabelFromOutside&&this._oSetLabelFromOutside instanceof C){T=e.call(this._oSetLabelFromOutside);}if(!T){T=e.call(this);}if(T){if(i instanceof S){if(R&&R.setTooltipLabel){R.setTooltipLabel(T);}}else{i.setTooltip(T);}}}function e(){var T=this.getTooltip();if(!T||typeof T==="string"||T instanceof String){return T;}else{return T.getText();}}function f(E){if(E.getParameter("name")=="text"){var i=E.oSource;var T=i.getText();if(this._oLabel){this._oLabel.setText(T);}var w=this._getFieldRelevantForLabel();if(w&&w.getComputedTextLabel){if(!w._oTextLabelSetBySemanticGroupElement){w._oTextLabelSetBySemanticGroupElement={oldText:w.getComputedTextLabel()};}w.setTextLabel(T);}}}function g(){if(this.getRequired&&this.getRequired()){return true;}var w=this.getParent();var x=w.getElements();for(var i=0;i<x.length;i++){var y=x[i];if(y.getRequired&&y.getRequired()===true&&(!y.getEditable||y.getEditable())&&(!y.getContextEditable||y.getContextEditable())){return true;}}return false;}function h(){if(this.getDisplayOnly){if(!this.isPropertyInitial("displayOnly")){return this.getDisplayOnly();}var i=this.getParent();var w=i.getParent();if(w){var x=w.getParent();if(x){return!x.getEditable();}}}return false;}function j(){var i=this.getParent();if(i._oSetLabelFromOutside&&!(typeof i._oSetLabelFromOutside==="string")&&i._oSetLabelFromOutside.getWrapping&&!i._oSetLabelFromOutside.isPropertyInitial("wrapping")){return i._oSetLabelFromOutside.getWrapping();}return true;}function k(i,w){if(i._oTextLabelSetBySemanticGroupElement){if(i.getComputedTextLabel()==w){i.setTextLabel(i._oTextLabelSetBySemanticGroupElement.oldText);}delete i._oTextLabelSetBySemanticGroupElement;}}function m(i){i._bCreatedBySemanticGroupElement=true;i.isRequired=g;i.isDisplayOnly=h;i.isWrapping=j;return i;}function n(i){if(i.getEditable){if(!i.getEditable()){i.data("editable",false);}}this._oObserver.observe(i,{properties:["visible"]});if(i.attachInnerControlsCreated){i.attachInnerControlsCreated(this._updateFormElementLabel,this);}if(i.setControlContext){i.setControlContext(c.Form);}if(i.getMetadata().getProperty("mandatory")){this._oObserver.observe(i,{properties:["mandatory"]});}r.call(this,i,this.getProperty("_editable"));s.call(this,i);}function o(i){if(i.name=="mandatory"){this.invalidateLabel();}else if(i.name=="visible"){this._updateFormElementVisibility();}}function p(){this.fireVisibleChanged({visible:this.isVisible()});if(this.getParent()){this.getParent()._updateLineBreaks();}}function q(E){var w=this.getElements();for(var i=0;i<w.length;i++){var x=w[i];r.call(this,x,E);}}function r(i,E){if(i instanceof a){if(!(i.data("editable")===false)){i.setContextEditable(E);}}}function s(w){if(w instanceof a){var x=this.getCustomData();for(var i=0;i<x.length;i++){u.call(this,w,x[i]);}}}function t(w,O){if(w instanceof a){var x=w.getCustomData();for(var i=0;i<x.length;i++){var y=x[i];if(y._bFromSemanticGroupElement&&(!O||O==y._sOriginalId)){w.removeCustomData(y);y.destroy();}}}}function u(i,w){if(i instanceof a&&l.smartform.inheritCostomDataToFields(w)){var N=w.clone();N._bFromSemanticGroupElement=true;N._sOriginalId=w.getId();i.addCustomData(N);}}function v(i){if(i.detachInnerControlsCreated){i.detachInnerControlsCreated(this._updateFormElementLabel,this);}if(i.setControlContext){i.setControlContext(c.None);}t.call(this,i);k.call(this,i,this.getLabelText());}d.prototype.init=function(){F.prototype.init.apply(this,arguments);this._oObserver.observe(this,{properties:["elementForLabel","_editable","delimiter"]});};d.prototype._getFieldRelevantForLabel=function(){var E=this.getElements();var i=this.getElementForLabel();if(E.length>i&&(E[i]instanceof a)){return E[i];}return null;};d.prototype._extractFields=function(E,i){var w=[];E.forEach(function(x){w.push(x);});if(i){w=w.filter(function(x){return!(x instanceof L);});}return w;};d.prototype._observeChanges=function(i){F.prototype._observeChanges.apply(this,arguments);if(i.object==this){switch(i.name){case"useHorizontalLayout":b.error("useHorizontalLayout can't be used with SemanticGroupElement",this);break;case"elementForLabel":this.updateLabelOfFormElement();break;case"_editable":q.call(this,i.current);break;default:break;}}else{o.call(this,i);}};d.prototype._getLabel=function(){if(this._oLabel){return this._oLabel;}else{return this._oSetLabelFromOutside;}};d.prototype._createLabel=function(i){var w=null;var x=this._getFieldRelevantForLabel();if(x){if(x.getShowLabel&&x.getShowLabel()){w=new S(x.getId()+'-label');if(i){if(!x._oTextLabelSetBySemanticGroupElement){x._oTextLabelSetBySemanticGroupElement={oldText:x.getComputedTextLabel()};}x.setTextLabel(i);w.setText(i);}w.setLabelFor(x);}}else{w=new L(this.getId()+"-label",{text:i});}if(w){w=m(w);this._oLabel=w;this.setAggregation("_label",w,true);if(this._oSetLabelFromOutside&&typeof this._oSetLabelFromOutside!=="string"){this._oSetLabelFromOutside.setAlternativeLabelFor(null);}}return w;};d.prototype._updateFormElementLabel=function(E){var R=this._getFieldRelevantForLabel();var i=this._getLabel();var w=E.oSource;var I=E.getParameters();if(i instanceof S&&w&&I&&w===R){i.updateLabelFor(I);}};d.prototype._updateFormElementVisibility=function(){var i=this.getVisibleBasedOnElements();if(this._bVisibleElements!==i){this._bVisibleElements=i;if(this.isPropertyInitial("visible")){p.call(this);this.invalidate();}}};d.prototype._updateGridDataSpan=function(){};d.prototype._setLinebreak=function(i,w,x,y){var z=this.getFields();if(z.length>0){var A=z[0];if(!(A instanceof V)){return;}var B=A.getLayoutData();if(B instanceof G){B.setLinebreakXL(i);B.setLinebreakL(w);B.setLinebreakM(x);B.setLinebreakS(y);}}};d.prototype.setTooltip=function(T){F.prototype.setTooltip.apply(this,[T]);var R=this._getFieldRelevantForLabel();var i=this._getLabel();_.call(this,i,R);return this;};d.prototype.setLabel=function(i){if(this._oSetLabelFromOutside&&(typeof this._oSetLabelFromOutside!=="string")){this._oSetLabelFromOutside.detachEvent("_change",f,this);}var O;var w;var x;if(typeof i==="string"){O=this._getLabel();if(O){w=O.getText();}}else if(!i&&this._oSetLabelFromOutside){w=this.getLabelText();}F.prototype.setLabel.apply(this,[i]);this._oSetLabelFromOutside=i;if(typeof i==="string"){if(this._oLabel instanceof S&&i!=w&&(i.length>0||w.length>0)){x=this._getFieldRelevantForLabel();if(x&&i!=null){if(x.getComputedTextLabel){if(!x._oTextLabelSetBySemanticGroupElement){x._oTextLabelSetBySemanticGroupElement={oldText:x.getComputedTextLabel()};}x.setTextLabel(i);}}}this.setAggregation("_label",this._oLabel,true);this._oLabel.isRequired=g;this._oLabel.isDisplayOnly=h;}else{if(i){if(i.isRequired){i.isRequired=g;}if(i.isDisplayOnly){i.isDisplayOnly=h;}i.attachEvent("_change",f,this);}else{x=this._getFieldRelevantForLabel();if(x){k.call(this,x,w);}}this.updateLabelOfFormElement();}return this;};d.prototype.destroyLabel=function(){var O=this.getLabelText();F.prototype.destroyLabel.apply(this);delete this._oSetLabelFromOutside;var i=this._getFieldRelevantForLabel();if(i){k.call(this,i,O);}this.updateLabelOfFormElement();return this;};d.prototype.getLabel=function(){return this._oSetLabelFromOutside;};d.prototype.getLabelControl=function(){return this._getLabel();};d.prototype.getLabelText=function(){var i="";var w=this._getLabel();if(w){i=w.getText();}return i;};d.prototype.updateLabelOfFormElement=function(){var i=false,O=null;var E=this.getElements();var R=this._getFieldRelevantForLabel();var w=this._getLabel();var D=false;if(w&&w._bCreatedBySemanticGroupElement){if(w instanceof S){if(!R||(w._sSmartFieldId&&w._sSmartFieldId!=R.getId())){D=true;}}else if(R){D=true;}if(D){w.destroy();delete this._oLabel;w=null;if(this._oSetLabelFromOutside&&!R){if(typeof this._oSetLabelFromOutside==="string"){F.prototype.setLabel.apply(this,[this._oSetLabelFromOutside]);w=this._oLabel;this._oLabel.isRequired=g;this._oLabel.isDisplayOnly=h;}else{w=this._oSetLabelFromOutside;}}}}else if(w&&R){if(w==this._oLabel){w.destroy();delete this._oLabel;}w=null;}if(!w){if(this._oSetLabelFromOutside){if(typeof this._oSetLabelFromOutside==="string"){O=this._oSetLabelFromOutside;}else{O=this._oSetLabelFromOutside.getText();}}else{O="";}}if(!w&&E.length>0){w=this._createLabel(O);i=true;}if(w){if(w instanceof S){if(R&&R.setTextLabel&&R.getComputedTextLabel()){w.setText(R.getComputedTextLabel());}}_.call(this,w,R);}if(i){if(w&&w.setLabelFor&&!(w instanceof S)&&!R&&(E.length>0)){w.setLabelFor(E[0]);}}};d.prototype.invalidateLabel=function(){var i=this._getLabel();if(i){i.invalidate();}};d.prototype.getUseHorizontalLayout=function(){b.error("getUseHorizontalLayout can't be used with SemanticGroupElement",this);};d.prototype.setUseHorizontalLayout=function(){b.error("setUseHorizontalLayout can't be used with SemanticGroupElement",this);};d.prototype.getHorizontalLayoutGroupElementMinWidth=function(){b.error("getHorizontalLayoutGroupElementMinWidth can't be used with SemanticGroupElement",this);};d.prototype.setHorizontalLayoutGroupElementMinWidth=function(){b.error("setHorizontalLayoutGroupElementMinWidth can't be used with SemanticGroupElement",this);};d.prototype.setVisible=function(i){var w=this.isVisible();F.prototype.setVisible.apply(this,arguments);if(w!=i){p.call(this);}return this;};d.prototype.isVisible=function(){if(this.isPropertyInitial("visible")){return this._bVisibleElements;}else{return this.getVisible();}};d.prototype.getVisibleBasedOnElements=function(){var i=false;var E=this.getElements();if(E&&E.length>0){i=E.some(function(w){return w.getVisible();});}return i;};d.prototype.getFormElement=function(){return this;};d.prototype.addElement=function(E){if(!E){return this;}E=this.validateAggregation("elements",E,true);n.call(this,E);var i;if(this._oLabel&&this._oLabel._bCreatedBySemanticGroupElement&&this._oLabel._sSmartFieldId){i=this._oLabel._sSmartFieldId;}this.addField(E);if(i&&i!=this._oLabel._sSmartFieldId){this._oLabel.setLabelFor(i);}this.updateLabelOfFormElement();this._updateFormElementVisibility();return this;};d.prototype.insertElement=function(E,i){if(!E){return this;}E=this.validateAggregation("elements",E,true);n.call(this,E);var w;if(this._oLabel&&this._oLabel._bCreatedBySemanticGroupElement&&this._oLabel._sSmartFieldId){w=this._oLabel._sSmartFieldId;}this.insertField(E,i);if(w&&w!=this._oLabel._sSmartFieldId){this._oLabel.setLabelFor(w);}this.updateLabelOfFormElement();this._updateFormElementVisibility();return this;};d.prototype.getElements=function(){var i;i=this.getFields();return i;};d.prototype.indexOfElement=function(E){var i=-1;i=this.indexOfField(E);return i;};d.prototype.removeElement=function(E){var R;var i;if(this._oLabel&&this._oLabel._bCreatedBySemanticGroupElement&&this._oLabel._sSmartFieldId){i=this._oLabel._sSmartFieldId;}R=this.removeField(E);if(R){v.call(this,R);}if(i&&i!=this._oLabel._sSmartFieldId){this._oLabel.setLabelFor(i);}this.updateLabelOfFormElement();this._updateFormElementVisibility();return R;};d.prototype.removeAllElements=function(){var R=this.removeAllFields();if(R&&Array.isArray(R)){for(var i=0;i<R.length;i++){v.call(this,R[i]);}}this.updateLabelOfFormElement();this._updateFormElementVisibility();return R;};d.prototype.destroyElements=function(){this.destroyFields();this.updateLabelOfFormElement();this._updateFormElementVisibility();return this;};d.prototype.addCustomData=function(w){if(!w){return this;}F.prototype.addCustomData.apply(this,arguments);var E=this.getElements();for(var i=0;i<E.length;i++){u.call(this,E[i],w);}return this;};d.prototype.insertCustomData=function(w,I){if(!w){return this;}F.prototype.insertCustomData.apply(this,arguments);var E=this.getElements();for(var i=0;i<E.length;i++){u.call(this,E[i],w);}return this;};d.prototype.removeCustomData=function(w){var x=F.prototype.removeCustomData.apply(this,arguments);if(x){var E=this.getElements();for(var i=0;i<E.length;i++){t.call(this,E[i],x.getId());}}return x;};d.prototype.removeAllCustomData=function(){var w=F.prototype.removeAllCustomData.apply(this,arguments);if(w.length>0){var E=this.getElements();for(var i=0;i<E.length;i++){t.call(this,E[i]);}}return w;};d.prototype.destroyCustomData=function(){F.prototype.destroyCustomData.apply(this,arguments);var E=this.getElements();for(var i=0;i<E.length;i++){t.call(this,E[i]);}return this;};d.prototype.clone=function(I,w){var E=this.removeAllElements();var x=F.prototype.clone.apply(this,arguments);for(var i=0;i<E.length;i++){var y=E[i];var z=y.clone(I,w);this.addElement(y);x.addElement(z);}return x;};return d;});
