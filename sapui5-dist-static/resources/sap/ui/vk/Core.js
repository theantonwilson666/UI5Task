/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/base/strings/capitalize","sap/base/util/each","sap/ui/base/ManagedObject","sap/ui/base/ManagedObjectObserver","sap/ui/core/Core","sap/ui/core/EventBus","./library"],function(c,e,M,a,b,E,v){"use strict";var C=M.extend("sap.ui.vk.Core",{metadata:{aggregations:{eventBus:{type:"sap.ui.core.EventBus",multiple:false,visibility:"hidden"}}},constructor:function(){if(v.getCore){return v.getCore();}M.call(this);var t=this;v.getCore=function(){return t;};this.setAggregation("eventBus",new E());}});C.prototype.getEventBus=function(){return this.getAggregation("eventBus");};function m(d,f){if(f.multiple){return(d==="insert"?"onAdd":"onRemove")+c(f.singularName);}else{return(d==="insert"?"onSet":"onUnset")+c(f.name);}}function n(o,d,f){var g=f.getId();o.forEach(function(h){e(h.getMetadata().getAllAssociations(),function(i,j){if(f.isA(j.type)){var k=h["get"+c(i)]();if(k===g||Array.isArray(k)&&k.indexOf(g)>=0){var l=h[m(d,j)];if(typeof l==="function"){l.call(h,f);}}}});});}C.prototype.observeLifetime=function(o){if(!this._lifetimeObserver){this._lifetimeObserver=new a(function(d){if(d.type==="destroy"&&this._objectsWithAssociations){n(this._objectsWithAssociations.slice(),"remove",d.object);}}.bind(this));}this._lifetimeObserver.observe(o,{destroy:true});if(this._objectsWithAssociations){n(this._objectsWithAssociations.slice(),"insert",o);}return this;};C.prototype.observeAssociations=function(o){if(!o.getId()){throw new Error("To observe an object is must have an ID.");}if(!this._objectsWithAssociations){var t=this;this._objectsWithAssociations=[];this._associationObserver=new a(function(d){var i=t._objectsWithAssociations.indexOf(d.object);if(i<0){return;}if(d.type==="destroy"){e(o.getMetadata().getAllAssociations(),function(j,f){var g;var k=c(f.name);if(f.multiple){g=d.object["removeAll"+k];if(typeof g==="function"){g.call(d.object);}}else{g=d.object["set"+k];if(typeof g==="function"){g.call(d.object,null);}}});t._objectsWithAssociations.splice(i,1);}else if(d.type==="association"){var f=d.object.getMetadata().getAllAssociations()[d.name];var g=d.object[m(d.mutation,f)];if(typeof g==="function"){if(Array.isArray(d.ids)){d.ids.map(function(j){return b.byId(j);}).filter(function(h){return h!=null;}).forEach(g.bind(d.object));}else{var h=b.byId(d.ids);if(h){g.call(d.object,h);}}}}});}if(this._objectsWithAssociations.indexOf(o)<0){this._objectsWithAssociations.push(o);this._associationObserver.observe(o,{associations:true,destroy:true});e(o.getMetadata().getAllAssociations(),function(d,f){var g=o[m("insert",f)];if(typeof g==="function"){var i=o["get"+c(d)]();if(Array.isArray(i)){i.map(function(j){return b.byId(j);}).filter(function(h){return h!=null;}).forEach(g.bind(o));}else{var h=b.byId(i);if(h){g.call(o,h);}}}});}return this;};return new C();});
