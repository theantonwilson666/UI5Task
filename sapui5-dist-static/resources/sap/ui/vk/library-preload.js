//@ui5-bundle sap/ui/vk/library-preload.js
sap.ui.predefine('sap/ui/vk/AnimationInterpolationType',[],function(){"use strict";var A={Discrete:"Discrete",Cubic:"Cubic",Linear:"Linear"};return A;});
sap.ui.predefine('sap/ui/vk/AnimationMath',["sap/base/Log","./glMatrix","./AnimationTrackType","./AnimationTrackValueType"],function(L,g,A,a){"use strict";var t="sap.ui.vk.AnimationMath";var b={};
b.clamp11=function(v){return Math.max(-1,Math.min(1,v));};
b.neutralAngleAxisToGlMatrixQuat=function(v){return g.quat.setAxisAngle(g.quat.create(),g.vec3.fromValues(v[0],v[1],v[2]),v[3]);};
b.neutralEulerToGlMatrixQuat=function(v){var m=1,c=1,d=1,e=1;switch(v[3]){case 6:c=-1;e=-1;break;case 18:c=-1;d=-1;break;case 33:m=-1;e=-1;break;case 36:m=-1;d=-1;break;case 24:d=-1;e=-1;break;case 9:m=-1;c=-1;break;default:}var h=v[0];var f=v[1];var i=v[2];var j=Math.cos(h/2);var s=Math.sin(h/2);var k=Math.cos(f/2);var l=Math.sin(f/2);var n=Math.cos(i/2);var o=Math.sin(i/2);var x=s*k*n+m*j*l*o;var y=j*l*n+c*s*k*o;var z=j*k*o+d*s*l*n;var w=j*k*n+e*s*l*o;return g.quat.fromValues(x,y,z,w);};
b.threeQuatToNeutralEuler=function(q,o){var r=g.mat4.fromQuat(g.mat4.create(),g.quat.fromValues(q.x,q.y,q.z,q.w));var m=r[0],c=r[4],d=r[8];var e=r[1],f=r[5],h=r[9];var i=r[2],j=r[6],k=r[10];var x=0,y=0,z=0;var l=0.9999999;switch(o){case 6:y=Math.asin(b.clamp11(d));if(Math.abs(d)<l){x=Math.atan2(-h,k);z=Math.atan2(-c,m);}else{x=Math.atan2(j,f);}break;case 18:x=Math.asin(-b.clamp11(h));if(Math.abs(h)<l){y=Math.atan2(d,k);z=Math.atan2(e,f);}else{y=Math.atan2(-i,m);}break;case 33:x=Math.asin(b.clamp11(j));if(Math.abs(j)<l){y=Math.atan2(-i,k);z=Math.atan2(-c,f);}else{z=Math.atan2(e,m);}break;case 36:y=Math.asin(-b.clamp11(i));if(Math.abs(i)<l){x=Math.atan2(j,k);z=Math.atan2(e,m);}else{z=Math.atan2(-c,f);}break;case 24:z=Math.asin(b.clamp11(e));if(Math.abs(e)<l){x=Math.atan2(-h,f);y=Math.atan2(-i,m);}else{y=Math.atan2(d,k);}break;case 9:z=Math.asin(-b.clamp11(c));if(Math.abs(c)<l){x=Math.atan2(j,f);y=Math.atan2(d,m);}else{x=Math.atan2(-h,k);}break;default:}var v=[x,y,z,o];return v;};
b.neutralQuatToGlMatrixQuat=function(v){return g.quat.fromValues(v[0],v[1],v[2],v[3]);};
b.glMatrixQuatToNeutral=function(v){return[v[0],v[1],v[2],v[3]];};
b.getModulatedAngularValue=function(o){return o-o%(2*Math.PI);};
b.equalMatrices=function(m,c,e){for(var d=0;d<m.elements.length;d++){if(Math.abs(m.elements[d]-c.elements[d])>e){return false;}}return true;};
b.interpolate=(function(){var c=g.quat;var v=g.vec3;var d=c.create();var e=c.create();var f=v.create();return function(h,i,j,k,l,m,n){var o=i.value;var p=j.value;var s={};var u;var w;var q;var x=0.0001;switch(h){case a.Quaternion:u=b.neutralQuatToGlMatrixQuat(o);w=b.neutralQuatToGlMatrixQuat(p);q=g.quat.slerp(g.quat.create(),u,w,k);if(n!=null){q=g.quat.multiply(g.quat.create(),q,g.quat.invert(g.quat.create(),b.neutralQuatToGlMatrixQuat(n)));}s.value=b.glMatrixQuatToNeutral(q);break;case a.Euler:var r=[b.interpolateScalarLinear(o[0],p[0],k),b.interpolateScalarLinear(o[1],p[1],k),b.interpolateScalarLinear(o[2],p[2],k),o[3]];if(n!=null){r[0]-=n[0];r[1]-=n[1];r[2]-=n[2];}s[a.Euler]=r;q=b.neutralEulerToGlMatrixQuat(r);s.value=b.glMatrixQuatToNeutral(q);break;case a.AngleAxis:var y;var z;var B;var C;var D;var E;var F;c.identity(d);if(n===true){for(z=l.getKeysCount()-1;z>=0;z--){y=l.getKey(z);if(y===j){break;}c.setAxisAngle(e,v.copy(f,y.value),-y.value[3]);c.multiply(d,e,d);}C=p[0];D=p[1];E=p[2];F=(k-1)*p[3];}else{for(z=0,B=l.getKeysCount();z<B;z++){y=l.getKey(z);if(y===j){break;}c.setAxisAngle(e,v.copy(f,y.value),y.value[3]);c.multiply(d,e,d);}C=p[0];D=p[1];E=p[2];F=k*p[3];}s[a.AngleAxis]=[C,D,E,F];c.setAxisAngle(e,v.set(f,C,D,E),F);c.multiply(d,e,d);s.value=b.glMatrixQuatToNeutral(d);break;case a.Vector3:s.value=[b.interpolateScalarLinear(o[0],p[0],k),b.interpolateScalarLinear(o[1],p[1],k),b.interpolateScalarLinear(o[2],p[2],k)];if(n!=null){switch(m){case A.Translate:s.value[0]-=n[0];s.value[1]-=n[1];s.value[2]-=n[2];break;case A.Scale:if(Math.abs(n[0])<x||Math.abs(n[1])<x||Math.abs(n[2])<x){L.error("The scale factor for reverse relative animation is too small","["+n[0]+", "+n[1]+", "+n[2]+"]",t);}else{s.value[0]/=n[0];s.value[1]/=n[1];s.value[2]/=n[2];}break;default:break;}}break;default:s.value=b.interpolateScalarLinear(o,p,k);if(n!=null){switch(m){case A.Opacity:if(Math.abs(n)<x){L.warning("The opacity factor for reverse relative animation is too small","["+n+"]",t);}else{s.value/=n;}break;default:break;}}break;}return s;};})();
b.interpolateScalarLinear=function(v,c,k){return v+k*(c-v);};
b.cartesianToPolar=function(c){var r={azimuth:0,elevation:0,radius:1};if(Array.isArray(c)&&c.length===3){var x=c[0];var y=c[1];var z=c[2];var l=x*x+z*z;if(l>0){r.azimuth=Math.acos(z/Math.sqrt(l))*(x<0?-1:1);}r.radius=Math.sqrt(x*x+y*y+z*z);if(r.radius>0){r.elevation=Math.asin(y/r.radius);}}return r;};
b.polarToCartesian=function(p){var r=[0,0,1];var c="radius"in p?p.radius:1.0;r[0]=c*Math.cos(p.elevation)*Math.sin(p.azimuth);r[1]=c*Math.sin(p.elevation);r[2]=c*Math.cos(p.elevation)*Math.cos(p.azimuth);return r;};
b.cartesianToPolar=function(c){var r={azimuth:0,elevation:0,radius:1};if(Array.isArray(c)&&c.length===3){var x=c[0];var y=c[1];var z=c[2];var l=x*x+z*z;if(l>0){r.azimuth=Math.acos(z/Math.sqrt(l))*(x<0?-1:1);}r.radius=Math.sqrt(x*x+y*y+z*z);if(r.radius>0){r.elevation=Math.asin(y/r.radius);}}return r;};
b.polarToCartesian=function(p){var r=[0,0,1];var c="radius"in p?p.radius:1.0;r[0]=c*Math.cos(p.elevation)*Math.sin(p.azimuth);r[1]=c*Math.sin(p.elevation);r[2]=c*Math.cos(p.elevation)*Math.cos(p.azimuth);return r;};
return b;});
sap.ui.predefine('sap/ui/vk/AnimationRotateType',[],function(){"use strict";var A={AngleAxis:"AngleAxis",Euler:"Euler",Quaternion:"Quaternion"};return A;});
sap.ui.predefine('sap/ui/vk/AnimationTrackType',[],function(){"use strict";var A={Rotate:"rrotate",Translate:"rtranslate",Scale:"rscale",Opacity:"ropacity",Color:"color"};return A;});
sap.ui.predefine('sap/ui/vk/AnimationTrackValueType',[],function(){"use strict";var A={Scalar:"Scalar",Vector3:"Vector3",AngleAxis:"AngleAxis",Quaternion:"Quaternion",Euler:"Euler"};return A;});
sap.ui.predefine('sap/ui/vk/DrawerToolbarButton',[],function(){"use strict";var D={CrossSection:"VIT-Cross-Section",CrossSectionAxis:"VIT-Cross-Section-Axis",Turntable:"VIT-Turntable",Orbit:"VIT-Orbit",Pan:"VIT-Pan",Zoom:"VIT-Zoom",Show:"VIT-Show",Hide:"VIT-Hide",FitToView:"VIT-Fit-To-View",RectangularSelection:"VIT-Rectangular-Selection",PredefinedViews:"VIT-Predefined-Views",FullScreen:"VIT-Fullscreen"};return D;});
sap.ui.predefine('sap/ui/vk/HighlightDisplayState',[],function(){"use strict";var H=function(){};H.playing="playing";H.pausing="pausing";H.stopped="stopped";return H;});
sap.ui.predefine('sap/ui/vk/findIndexInArray',[],function(){"use strict";var f=function(a,p,t){var r=-1;if(Array.isArray(a)&&typeof p==="function"){for(var i=0;i<a.length;i++){if(p.call(t,a[i],i,a)){r=i;break;}}}return r;};return f;});
sap.ui.predefine('sap/ui/vk/threejs/BBoxSubdivider',[],function(){"use strict";var U=function(){this.unpack=function(p){if(!p||(p.bytelength<1)){return false;}try{this.nLevel=p[0];if(this.nLevel>5){return false;}this.numDivision=Math.pow(2,this.nLevel);this.octree=new Uint8Array(Math.pow(this.numDivision,3));this.streamOffset=1;this._decodeRecursive(p,0,0,0,0);}catch(e){return false;}return true;};this.getUnpacked=function(){return this.octree;};this._setValue=function(g,a,b,v){this.octree[b*this.numDivision*this.numDivision+a*this.numDivision+g]=v?1:0;};this._decodeRecursive=function(p,g,a,b,l){if(l===this.nLevel){this._setValue(g,a,b,true);return true;}if(this.streamOffset>=p.length){return false;}var c=p[this.streamOffset];this.streamOffset++;g*=2;a*=2;b*=2;if(l>=this.nLevel){return true;}for(var z=0;z<2;z++){for(var y=0;y<2;y++){for(var x=0;x<2;x++){if((c&(1<<(z*4+y*2+x)))!==0){if(!this._decodeRecursive(p,g+x,a+y,b+z,l+1)){return false;}}else{this._clearBitsRecursive(g+x,a+y,b+z,l+1);}}}}return true;};this._clearBitsRecursive=function(g,a,b,l){if(l===this.nLevel){this._setValue(g,a,b,false);return;}g*=2;a*=2;b*=2;if(l>=this.nLevel){return;}for(var z=0;z<2;z++){for(var y=0;y<2;y++){for(var x=0;x<2;x++){this._clearBitsRecursive(g+x,a+y,b+z,l+1);}}}};};var C=function(n){this.numDivision=n;this.xyzToIndexMap=new Map();this.points=[];this.getOrCreatePointAt=function(x,y,z,f,d){var k=x+":"+y+":"+z+":"+f+":"+d;var i=this.xyzToIndexMap.get(k);if(i){return i;}this.points.push(x/this.numDivision-0.5,y/this.numDivision-0.5,z/this.numDivision-0.5);i=this.points.length/3-1;this.xyzToIndexMap.set(k,i);return i;};};var S=function(l,n,u){this.level=l;this.numDivision=n;this.unpacked=u;this.getValue=function(g,a,b){if(g<0||a<0||b<0||g>=this.numDivision||a>=this.numDivision||b>=this.numDivision){return 0;}return this.unpacked[b*this.numDivision*this.numDivision+a*this.numDivision+g];};};var B=function(){};
B.unpackSubDividedBoundingBox=function(p){var u=new U();if(u.unpack(p)){return new S(u.nLevel,u.numDivision,u.getUnpacked());}return null;};
B.makeSubDividedBoundingBoxGeometry=function(s){if(!s){return null;}var i=[];var n=s.level;var e=Math.pow(2,n);var m=new C(e);var x,y,z,f,a,b,c,d;for(x=0;x<=e;x++){for(y=0;y<e;y++){for(z=0;z<e;z++){f=s.getValue(x,y,z)-s.getValue(x-1,y,z);if(f!==0){a=m.getOrCreatePointAt(x,y,z,0,f);b=m.getOrCreatePointAt(x,y+1,z,0,f);c=m.getOrCreatePointAt(x,y+1,z+1,0,f);d=m.getOrCreatePointAt(x,y,z+1,0,f);if(f<0){i.push(a,b,c);i.push(a,c,d);}else{i.push(c,b,a);i.push(d,c,a);}}}}}for(y=0;y<=e;y++){for(x=0;x<e;x++){for(z=0;z<e;z++){f=s.getValue(x,y,z)-s.getValue(x,y-1,z);if(f!==0){a=m.getOrCreatePointAt(x,y,z,1,f);b=m.getOrCreatePointAt(x+1,y,z,1,f);c=m.getOrCreatePointAt(x+1,y,z+1,1,f);d=m.getOrCreatePointAt(x,y,z+1,1,f);if(f>0){i.push(a,b,c);i.push(a,c,d);}else{i.push(c,b,a);i.push(d,c,a);}}}}}for(z=0;z<=e;z++){for(x=0;x<e;x++){for(y=0;y<e;y++){f=s.getValue(x,y,z)-s.getValue(x,y,z-1);if(f!==0){a=m.getOrCreatePointAt(x,y,z,2,f);b=m.getOrCreatePointAt(x+1,y,z,2,f);c=m.getOrCreatePointAt(x+1,y+1,z,2,f);d=m.getOrCreatePointAt(x,y+1,z,2,f);if(f<0){i.push(a,b,c);i.push(a,c,d);}else{i.push(c,b,a);i.push(d,c,a);}}}}}var g=new THREE.BufferGeometry();var h=new THREE.BufferAttribute(new Uint16Array(i),1);var p=new THREE.BufferAttribute(new Float32Array(m.points),3);g.setIndex(h);g.setAttribute("position",p);g.computeFaceNormals();g.computeVertexNormals();g.computeBoundingSphere();return g;};
return B;});
sap.ui.predefine('sap/ui/vk/threejs/HitTester',["sap/base/Log","../thirdparty/three"],function(L,a){"use strict";var H=function(){this._maskMaterial=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,fog:false});this._depthMaterial=new THREE.ShaderMaterial({vertexShader:["#include <clipping_planes_pars_vertex>","void main() {","	#include <begin_vertex>","	#include <project_vertex>","	#include <clipping_planes_vertex>","}"].join("\n"),fragmentShader:["#include <clipping_planes_pars_fragment>","void main() {","	#include <clipping_planes_fragment>","	highp vec4 value = vec4(fract(vec4(1.0, 255.0, 65025.0, 16581375.0) * gl_FragCoord.z));","	value.xyz -= value.yzw * (1.0 / 255.0);","	gl_FragColor  = value;","}"].join("\n"),side:THREE.DoubleSide,clipping:true});this._renderTarget=new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter});this._renderTarget.texture.generateMipmaps=false;this._renderTarget.depthBuffer=true;};var b;var m=new THREE.Matrix4();var f=new THREE.Frustum();var c=new THREE.Matrix4();var s=new THREE.Vector2();var r=new THREE.Raycaster();var d=new THREE.Ray();var e=new THREE.Sphere();var o=[];var g=new Uint8Array(4);var p=new THREE.Vector3();
function j(h){var i=h.parent;while(i){if(i.userData.closed){h=i;}i=i.parent;}while(h.parent&&h.userData.skipIt){h=h.parent;}return h;}
H.prototype.hitTest=function(x,y,i,k,l,n,q,t){if(!b||b.constructor!==q.constructor){b=new q.constructor();}b.copy(q);var v=q.view;if(v){var w=v.width/i;var h=v.height/k;b.setViewOffset(v.fullWidth,v.fullHeight,v.offsetX+(x-0.5)*w,v.offsetY+(y-0.5)*h,w,h);}else{b.setViewOffset(i,k,x-0.5,y-0.5,1,1);}m.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);f.setFromProjectionMatrix(m);r.setFromCamera(s.set(0,0),b);var u=l.getContext();var A=Math.min(u.getParameter(u.RED_BITS),8);var B=Math.min(u.getParameter(u.GREEN_BITS),8);var C=Math.min(u.getParameter(u.BLUE_BITS),8);var D=A+B;var E=(1<<A)-1;var F=(1<<B)-1;var M=(1<<C)-1;var G=1/E;var I=1/F;var J=1/M;var K=this._maskMaterial;var N=l.getClearColor().clone();var O=l.getClearAlpha();var P=l.autoClear;l.setRenderTarget(this._renderTarget);l.clippingPlanes=t||[];l.autoClear=false;l.setClearColor(0x000000,0);l.clear(true,true,false);var Q=K.color;var R=0;o.length=0;n.traverseVisible(function(U){var V=U.geometry;if(V&&U.material&&f.intersectsObject(U)){var W=U.matrixWorld;if(V.boundingSphere===null){V.computeBoundingSphere();}e.copy(V.boundingSphere);e.applyMatrix4(W);if(r.ray.intersectsSphere(e)===false){return;}c.getInverse(W);d.copy(r.ray).applyMatrix4(c);if(V.boundingBox!==null&&d.intersectsBox(V.boundingBox)===false){return;}R+=1;o.push(U);Q.setRGB((R&E)*G,((R>>A)&F)*I,((R>>D)&M)*J);var T=U.material;U.material=K;l.render(U,b);U.material=T;}});l.readRenderTargetPixels(this._renderTarget,0,0,1,1,g);R=(g[0]>>(8-A))+((g[1]>>(8-B))<<A)+((g[2]>>(8-C))<<D);var S=R>0?o[R-1]:null;var z;if(S){var T=S.material;S.material=this._depthMaterial;l.clear(true,true,false);l.render(S,b);S.material=T;l.readRenderTargetPixels(this._renderTarget,0,0,1,1,g);z=((g[0]+(g[1]+(g[2]+g[3]/255)/255)/255)/255)*2-1;p.set(0,0,z).applyMatrix4(b.projectionMatrixInverse).applyMatrix4(b.matrixWorld);}l.setRenderTarget(null);l.clippingPlanes=[];l.setClearColor(N,O);l.autoClear=P;return S?{distance:r.ray.origin.distanceTo(p),point:p,object:j(S)}:null;};
H.prototype.hitTestPrecise=function(x,y,w,h,k,l,n){r.setFromCamera(s.set((x/w)*2-1,(y/h)*-2+1),l);if(n&&n.length>0){for(var q in n){var u=n[q];var v=u.distanceToPoint(r.ray.origin),t=-v/u.normal.dot(r.ray.direction);if(t>0){if(v<0){r.near=Math.max(r.near,t);}else{r.far=Math.min(r.far,t);}}else if(v<0){return null;}}}var z=r.intersectObjects(k.children,true);if(n&&n.length>0){r.near=0;r.far=Infinity;}if(z){for(var i in z){var A=z[i];var B=j(A.object);if(B.visible&&!B.isBillboard&&!B.isDetailView){A.object=B;return A;}}}return null;};
H.prototype.hitTestPoint=function(x,y,w,h,i,k,l){r.setFromCamera(s.set((x/w)*2-1,(y/h)*-2+1),k);if(l&&l.length>0){for(var n in l){var q=l[n];var u=q.distanceToPoint(r.ray.origin),t=-u/q.normal.dot(r.ray.direction);if(t>0){if(u<0){r.near=Math.max(r.near,t);}else{r.far=Math.min(r.far,t);}}else if(u<0){return null;}}}var v=r.intersectObjects(i.children,true);if(l&&l.length>0){r.near=0;r.far=Infinity;}return v.length===1?v[0].point:null;};
return H;});
sap.ui.predefine('sap/ui/vk/threejs/MarchingCubes',[],function(){"use strict";var e=new Uint32Array([0x0,0x109,0x203,0x30a,0x406,0x50f,0x605,0x70c,0x80c,0x905,0xa0f,0xb06,0xc0a,0xd03,0xe09,0xf00,0x190,0x99,0x393,0x29a,0x596,0x49f,0x795,0x69c,0x99c,0x895,0xb9f,0xa96,0xd9a,0xc93,0xf99,0xe90,0x230,0x339,0x33,0x13a,0x636,0x73f,0x435,0x53c,0xa3c,0xb35,0x83f,0x936,0xe3a,0xf33,0xc39,0xd30,0x3a0,0x2a9,0x1a3,0xaa,0x7a6,0x6af,0x5a5,0x4ac,0xbac,0xaa5,0x9af,0x8a6,0xfaa,0xea3,0xda9,0xca0,0x460,0x569,0x663,0x76a,0x66,0x16f,0x265,0x36c,0xc6c,0xd65,0xe6f,0xf66,0x86a,0x963,0xa69,0xb60,0x5f0,0x4f9,0x7f3,0x6fa,0x1f6,0xff,0x3f5,0x2fc,0xdfc,0xcf5,0xfff,0xef6,0x9fa,0x8f3,0xbf9,0xaf0,0x650,0x759,0x453,0x55a,0x256,0x35f,0x55,0x15c,0xe5c,0xf55,0xc5f,0xd56,0xa5a,0xb53,0x859,0x950,0x7c0,0x6c9,0x5c3,0x4ca,0x3c6,0x2cf,0x1c5,0xcc,0xfcc,0xec5,0xdcf,0xcc6,0xbca,0xac3,0x9c9,0x8c0,0x8c0,0x9c9,0xac3,0xbca,0xcc6,0xdcf,0xec5,0xfcc,0xcc,0x1c5,0x2cf,0x3c6,0x4ca,0x5c3,0x6c9,0x7c0,0x950,0x859,0xb53,0xa5a,0xd56,0xc5f,0xf55,0xe5c,0x15c,0x55,0x35f,0x256,0x55a,0x453,0x759,0x650,0xaf0,0xbf9,0x8f3,0x9fa,0xef6,0xfff,0xcf5,0xdfc,0x2fc,0x3f5,0xff,0x1f6,0x6fa,0x7f3,0x4f9,0x5f0,0xb60,0xa69,0x963,0x86a,0xf66,0xe6f,0xd65,0xc6c,0x36c,0x265,0x16f,0x66,0x76a,0x663,0x569,0x460,0xca0,0xda9,0xea3,0xfaa,0x8a6,0x9af,0xaa5,0xbac,0x4ac,0x5a5,0x6af,0x7a6,0xaa,0x1a3,0x2a9,0x3a0,0xd30,0xc39,0xf33,0xe3a,0x936,0x83f,0xb35,0xa3c,0x53c,0x435,0x73f,0x636,0x13a,0x33,0x339,0x230,0xe90,0xf99,0xc93,0xd9a,0xa96,0xb9f,0x895,0x99c,0x69c,0x795,0x49f,0x596,0x29a,0x393,0x99,0x190,0xf00,0xe09,0xd03,0xc0a,0xb06,0xa0f,0x905,0x80c,0x70c,0x605,0x50f,0x406,0x30a,0x203,0x109,0x0]);var t=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]];var V=function(i,a,b,c,d){var m;var p=[0,0,0];if(Math.abs(i-c)<0.00001){return(a);}if(Math.abs(i-d)<0.00001){return(b);}if(Math.abs(c-d)<0.00001){return(a);}m=(i-c)/(d-c);p[0]=a[0]+m*(b[0]-a[0]);p[1]=a[1]+m*(b[1]-a[1]);p[2]=a[2]+m*(b[2]-a[2]);return(p);};var M=function(){};var v=[[],[],[],[],[],[],[],[],[],[],[],[]];var f=function(a){var b=0.75;var c=0;if(a.val[0]>b){c|=1;}if(a.val[1]>b){c|=2;}if(a.val[2]>b){c|=4;}if(a.val[3]>b){c|=8;}if(a.val[4]>b){c|=16;}if(a.val[5]>b){c|=32;}if(a.val[6]>b){c|=64;}if(a.val[7]>b){c|=128;}if(e[c]==0){return[];}if(e[c]&1){v[0]=V(b,a.pos[0],a.pos[1],a.val[0],a.val[1]);}if(e[c]&2){v[1]=V(b,a.pos[1],a.pos[2],a.val[1],a.val[2]);}if(e[c]&4){v[2]=V(b,a.pos[2],a.pos[3],a.val[2],a.val[3]);}if(e[c]&8){v[3]=V(b,a.pos[3],a.pos[0],a.val[3],a.val[0]);}if(e[c]&16){v[4]=V(b,a.pos[4],a.pos[5],a.val[4],a.val[5]);}if(e[c]&32){v[5]=V(b,a.pos[5],a.pos[6],a.val[5],a.val[6]);}if(e[c]&64){v[6]=V(b,a.pos[6],a.pos[7],a.val[6],a.val[7]);}if(e[c]&128){v[7]=V(b,a.pos[7],a.pos[4],a.val[7],a.val[4]);}if(e[c]&256){v[8]=V(b,a.pos[0],a.pos[4],a.val[0],a.val[4]);}if(e[c]&512){v[9]=V(b,a.pos[1],a.pos[5],a.val[1],a.val[5]);}if(e[c]&1024){v[10]=V(b,a.pos[2],a.pos[6],a.val[2],a.val[6]);}if(e[c]&2048){v[11]=V(b,a.pos[3],a.pos[7],a.val[3],a.val[7]);}var d=[];for(var i=0;i<t[c].length;i+=3){var g=[];g.push(v[t[c][i]]);g.push(v[t[c][i+1]]);g.push(v[t[c][i+2]]);d.push(g);}return d;};
M.march=function(s){var d=s.numDivision;var g=[];var z,y,x;for(z=0;z<d+2;z++){for(y=0;y<d+2;y++){for(x=0;x<d+2;x++){if(x===0||y===0||z===0||x===d+1||y===d+1||z===d+1){g.push(0);}else{var r=s.unpacked[(z-1)*d*d+(y-1)*d+(x-1)];g.push(Number(r));}}}}var a=d+2;var b=d+2;var c=[];for(z=0;z<d+1;z++){for(y=0;y<d+1;y++){for(x=0;x<d+1;x++){var h=g[z*a*a+y*b+x];var j=g[z*a*a+y*b+x+1];var k=g[(z+1)*a*a+y*b+x+1];var l=g[(z+1)*a*a+y*b+x];var m=g[z*a*a+(y+1)*b+x];var n=g[z*a*a+(y+1)*b+x+1];var o=g[(z+1)*a*a+(y+1)*b+x+1];var p=g[(z+1)*a*a+(y+1)*b+x];var q=x/d-0.55;var u=(x+1)/d-0.55;var w=y/d-0.55;var A=(y+1)/d-0.55;var B=z/d-0.55;var C=(z+1)/d-0.55;var D={pos:[[q,w,B],[u,w,B],[u,w,C],[q,w,C],[q,A,B],[u,A,B],[u,A,C],[q,A,C]],val:[h,j,k,l,m,n,o,p]};c=c.concat(f(D));}}}var E=new Uint16Array(c.length*3);var F=new Float32Array(c.length*9);for(var i=0;i<c.length;i++){E[i*3]=(i*3);E[i*3+1]=(i*3+1);E[i*3+2]=(i*3+2);F[i*9]=(c[i][0][0]);F[(i*9)+1]=(c[i][0][1]);F[(i*9)+2]=(c[i][0][2]);F[(i*9)+3]=(c[i][1][0]);F[(i*9)+4]=(c[i][1][1]);F[(i*9)+5]=(c[i][1][2]);F[(i*9)+6]=(c[i][2][0]);F[(i*9)+7]=(c[i][2][1]);F[(i*9)+8]=(c[i][2][2]);}var G=new THREE.BufferGeometry();var H=new THREE.BufferAttribute((E),1);var I=new THREE.BufferAttribute((F),3);G.setIndex(H);G.setAttribute("position",I);G.computeFaceNormals();G.computeVertexNormals();G.computeBoundingSphere();return G;};
return M;});
sap.ui.predefine('sap/ui/vk/threejs/OutlineRenderer',["../thirdparty/three","sap/base/Log","./ThreeUtils"],function(t,L,T){"use strict";var O=function(o){this._outlineWidth=o;this._copyMaterial=new THREE.MeshBasicMaterial({transparent:true,fog:false});this._maskMaterial=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,fog:false});this._outlineMaterial=new THREE.ShaderMaterial({uniforms:{"mask":{value:null},"offset":{value:new THREE.Vector2(1,0,0,1)}},vertexShader:["varying vec2 vTC;","void main() {","	vTC = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["varying vec2 vTC;","uniform sampler2D mask;","uniform vec4 offset;","float delta(vec3 c1,  vec3 c2) {","	vec3 dc = c1 - c2;","	return dot(dc, dc);","}","void main() {","	vec3 c = texture2D(mask, vTC).rgb;","	vec3 c1 = texture2D(mask, vTC + offset.xy).rgb;","	vec3 c2 = texture2D(mask, vTC - offset.xy).rgb;","	vec3 c3 = texture2D(mask, vTC + offset.zw).rgb;","	vec3 c4 = texture2D(mask, vTC - offset.yw).rgb;","	vec4 a = vec4(delta(c, c1), delta(c, c2), delta(c, c3), delta(c, c4));","	gl_FragColor = vec4(1.0, 1.0, 1.0, sign(dot(a, a)));","}"].join("\n")});this._expandMaterial=new THREE.ShaderMaterial({uniforms:{"mask":{value:null},"offset":{value:new THREE.Vector2(1,0,0,1)}},vertexShader:["varying vec2 vTC;","void main() {","	vTC = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["varying vec2 vTC;","uniform sampler2D mask;","uniform vec4 offset;","void main() {","	float a = texture2D(mask, vTC).a;","	a = max(a, texture2D(mask, vTC + offset.xy).a);","	a = max(a, texture2D(mask, vTC - offset.xy).a);","	a = max(a, texture2D(mask, vTC + offset.zw).a);","	a = max(a, texture2D(mask, vTC - offset.yw).a);","	gl_FragColor = vec4(1.0, 1.0, 1.0, a);","}"].join("\n")});this._screenCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this._screenMesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2));};
O.prototype.setOutlineWidth=function(w){this._outlineWidth=w;};
O.prototype.render=function(r,s,c,a,o,j){if(!a||!a.length){return;}var b=r.getSize(new THREE.Vector2());var p=2;var w=b.width*p;var h=b.height*p;if(!this._renderTarget1||this._renderTarget1.width!==w||this._renderTarget1.height!==h){var d={minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter};this._renderTarget1=new THREE.WebGLRenderTarget(w,h,d);this._renderTarget1.texture.generateMipmaps=false;this._renderTarget2=new THREE.WebGLRenderTarget(w,h,d);this._renderTarget2.texture.generateMipmaps=false;}var n;var e;if(j){n=new Map();e=new Map();j.forEach(function(E){if(!E.node||!E.parent){return;}n.set(E.node,E);if(E.parent){var F=e.get(E.parent)||[];F.push(E);e.set(E.parent,F);}});}var f;var g=new Set();var k=function(E){if(E.isMesh){g.add({mesh:E,color:f});}};var i;for(i=0;i<a.length;i++){var l=a[i];f=new THREE.Color(((i+1)&255)/255,(((i+1)>>8)&255)/255,(((i+1)>>16)&255)/255);l._vkTraverseNodes(k,n,e);}if(g.size===0){return;}var m=r.getClearColor().clone();var q=r.getClearAlpha();var u=r.autoClear;r.autoClear=false;r.setClearColor(0x000000,0);var v;var x=this._renderTarget1;var y=this._renderTarget2;r.setRenderTarget(x);r.clear(true,true,false);var z=g.values();var A=z.next();while(!A.done){var B=A.value.mesh;this._maskMaterial.color=A.value.color;A=z.next();v=B.material;B.material=this._maskMaterial;r.render(B,c);B.material=v;}var C=new THREE.Vector4(1/w,0,0,1/h);v=this._outlineMaterial;v.uniforms.mask.value=x.texture;v.uniforms.offset.value=C;this._screenMesh.material=v;r.setRenderTarget(y);r.render(this._screenMesh,this._screenCamera);if(this._outlineWidth>1){v=this._expandMaterial;v.uniforms.offset.value=C;this._screenMesh.material=v;for(i=1;i<this._outlineWidth;i++){var D=x;x=y;y=D;v.uniforms.mask.value=x.texture;r.setRenderTarget(y);r.render(this._screenMesh,this._screenCamera);}}v=this._copyMaterial;v.map=y.texture;v.color=o;this._screenMesh.material=v;r.setRenderTarget(null);r.render(this._screenMesh,this._screenCamera);r.setClearColor(m,q);r.autoClear=u;};
O.prototype.dispose=function(){if(this._copyMaterial){T.disposeMaterial(this._copyMaterial);this._copyMaterial=null;}if(this._maskMaterial){T.disposeMaterial(this._maskMaterial);this._maskMaterial=null;}if(this._outlineMaterial){T.disposeMaterial(this._outlineMaterial);this._outlineMaterial=null;}if(this._expandMaterial){T.disposeMaterial(this._expandMaterial);this._expandMaterial=null;}if(this._screenMesh){T.disposeObject(this._screenMesh);this._screenMesh=null;}};
return O;});
sap.ui.predefine('sap/ui/vk/threejs/ParametricGenerators',["../thirdparty/three"],function(t){"use strict";var P={generateSphere:function(s,m){var g=new THREE.SphereGeometry(s.radius,32,32);var a=new THREE.Mesh(g,m||undefined);a.name="sphere";return a;},generateBox:function(b){},generatePlane:function(p,m){var g=new THREE.PlaneGeometry(p.length,p.width);var a=new THREE.Mesh(g,m||undefined);a.name="plane";a.rotation.x=Math.PI/2;a.position.set(-p.length/2,-p.width/2,0);return a;}};return P;});
sap.ui.predefine('sap/ui/vk/threejs/UsageCounter',["../thirdparty/three"],function(t){"use strict";var U=function(){};
U.increaseMaterialUsed=function(m){if(m&&m.userData&&m.userData.materialUsed!==undefined){m.userData.materialUsed++;return true;}return false;};
U.decreaseMaterialUsed=function(m){if(m&&m.userData&&m.userData.materialUsed!==undefined){m.userData.materialUsed--;return true;}return false;};
U.increaseGeometryUsed=function(g){if(g&&g.userData&&g.userData.geometryUsed!==undefined){g.userData.geometryUsed++;return true;}return false;};
U.decreaseGeometryUsed=function(g){if(g&&g.userData&&g.userData.geometryUsed!==undefined){g.userData.geometryUsed--;return true;}return false;};
return U;});
sap.ui.predefine('sap/ui/vk/tools/AnchorPointToolHandler',["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../thirdparty/three"],function(E,M,a,g,t){"use strict";
var A=E.extend("sap.ui.vk.tools.AnchorPointToolHandler",{
metadata:{},
constructor:function(c){this._priority=10;this._tool=c;this._gizmo=c.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster();this._handleIndex=-1;this._gizmoIndex=-1;this._handleAxis=new THREE.Vector3();this._gizmoOrigin=new THREE.Vector3();this._gizmoScale=1;this._matrixOrigin=new THREE.Matrix4();this._rotationOrigin=new THREE.Matrix4();this._mouse=new THREE.Vector2();this._mouseOrigin=new THREE.Vector2();}
});
A.prototype._updateMouse=function(e){var s=this.getViewport().getRenderer().getSize(new THREE.Vector2());this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
A.prototype._updateHandles=function(e,h){var p=this._handleIndex;this._handleIndex=-1;if(e.n===1||(e.event&&e.event.type==="contextmenu")){for(var i=0,l=this._gizmo.getGizmoCount();i<l;i++){var c=this._gizmo.getTouchObject(i);var f=this._rayCaster.intersectObject(c,true);if(f.length>0){this._handleIndex=c.children.indexOf(f[0].object);if(this._handleIndex>=0){this._gizmoIndex=i;this._gizmoOrigin.setFromMatrixPosition(c.matrixWorld);this._matrixOrigin.copy(c.matrixWorld);this._gizmoScale=c.scale.x;this._rotationOrigin.extractRotation(c.matrixWorld);if(this._handleIndex<3){this._handleAxis.setFromMatrixColumn(c.matrixWorld,this._handleIndex).normalize();}else if(this._handleIndex<6){this._handleAxis.setFromMatrixColumn(c.matrixWorld,this._handleIndex-3).normalize();}else if(this._handleIndex<9){this._handleAxis.setFromMatrixColumn(c.matrixWorld,this._handleIndex-6).normalize();}}}}}this._gizmo.highlightHandle(this._handleIndex,h||this._handleIndex===-1);if(p!==this._handleIndex){this.getViewport().setShouldRenderFrame();}};
A.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);e.handled|=this._handleIndex>=0;}};
A.prototype.click=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);this._gizmo.selectHandle(this._handleIndex);e.handled|=this._handleIndex>=0;}};
var d=new THREE.Vector3();
A.prototype._getAxisOffset=function(){var r=this._rayCaster.ray;var c=this._handleAxis.clone().cross(r.direction).cross(r.direction).normalize();d.copy(r.origin).sub(this._gizmoOrigin);return c.dot(d)/c.dot(this._handleAxis);};
A.prototype._getPlaneOffset=function(){var r=this._rayCaster.ray;d.copy(this._gizmoOrigin).sub(r.origin);var c=this._handleAxis.dot(d)/this._handleAxis.dot(r.direction);return r.direction.clone().multiplyScalar(c).sub(d);};
A.prototype._getMouseAngle=function(){var r=this._rayCaster.ray;var d=this._rotationPoint.clone().sub(r.origin);var c=this._rotationAxis.dot(d)/this._rotationAxis.dot(r.direction);var m=r.direction.clone().multiplyScalar(c).sub(d).normalize();return Math.atan2(m.dot(this._axis2),m.dot(this._axis1));};
A.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,false);if(this._handleIndex>=0){e.handled=true;this._gesture=true;this._mouseOrigin.copy(e);this._gizmo.selectHandle(this._handleIndex);this._gizmo.beginGesture();if(this._handleIndex<3){this._dragOrigin=this._getAxisOffset();}else if(this._handleIndex<6){this._dragOrigin=this._getPlaneOffset();}else if(this._handleIndex<9){this._axis1=new THREE.Vector3().setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+1)%3).normalize();this._axis2=new THREE.Vector3().setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+2)%3).normalize();this._rotationAxis=new THREE.Vector3().crossVectors(this._axis1,this._axis2).normalize();this._rotationPoint=new THREE.Vector3().setFromMatrixPosition(this._matrixOrigin);if(Math.abs(this._rayCaster.ray.direction.dot(this._rotationAxis))<Math.cos(Math.PI*85/180)){var m=this.getViewport().getCamera().getCameraRef().matrixWorld;this._axis1.setFromMatrixColumn(m,0).normalize();this._axis2.setFromMatrixColumn(m,1).normalize();this._rotationAxis.setFromMatrixColumn(m,2).normalize();}var l=this._axis1.clone();var c=2;for(var i=0;i<3;i++){var f=new THREE.Vector3().setComponent(i,1);var h=this._rotationAxis.dot(f);if(c>h){c=h;l.copy(f);}}l.sub(this._rotationAxis.clone().multiplyScalar(l.dot(this._rotationAxis))).normalize();this._levelAngle=Math.atan2(l.dot(this._axis2),l.dot(this._axis1));this._startAngle=this._getMouseAngle();this._prevDeltaAngle=0;}}}};
A.prototype._setOffset=function(o){if(this._tool.getEnableStepping()){var s=Math.pow(10,Math.round(Math.log10(this._gizmoScale)))*0.1;var m=new THREE.Matrix4().getInverse(this._rotationOrigin);var c=this._gizmoOrigin.clone().applyMatrix4(m);var p=this._gizmoOrigin.clone().add(o).applyMatrix4(m);for(var i=0;i<3;i++){var e=p.getComponent(i);if(Math.abs(e-c.getComponent(i))>s*1e-5){var f=Math.round(e/s)*s;d.setFromMatrixColumn(this._rotationOrigin,i).multiplyScalar(f-e);o.add(d);}}}this._gizmo._setOffset(o,this._gizmoIndex);};
A.prototype.move=function(e){if(this._gesture){e.handled=true;this._updateMouse(e);if(this._handleIndex<3){if(isFinite(this._dragOrigin)){this._setOffset(this._handleAxis.clone().multiplyScalar(this._getAxisOffset()-this._dragOrigin));}}else if(this._handleIndex<6){if(isFinite(this._dragOrigin.x)&&isFinite(this._dragOrigin.y)&&isFinite(this._dragOrigin.z)){this._setOffset(this._getPlaneOffset().sub(this._dragOrigin));}}else if(this._handleIndex<9){var c=this._startAngle;var f=this._getMouseAngle()-c;if(f>Math.PI){f-=Math.PI*2;}else if(f<-Math.PI){f+=Math.PI*2;}if(Math.abs(this._prevDeltaAngle)>Math.PI/4){if(this._prevDeltaAngle*f<0){f+=Math.PI*2*Math.sign(this._prevDeltaAngle);}}f=f%(Math.PI*2);var h=c+f;if(this._tool.getEnableStepping()){var s=THREE.Math.degToRad(5);var i=h-c-this._levelAngle;h+=Math.round(i/s)*s-i;}this._prevDeltaAngle=h-c;if(isFinite(c)&&isFinite(h)){this._gizmo._setRotationAxisAngle(this._handleIndex-6,c,h);}}}};
A.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateMouse(e);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateHandles(e,true);this.getViewport().setShouldRenderFrame();}};
function b(v){var s=[];if(v){v.enumerateSelection(function(n){s.push(n);});}return s;}
A.prototype.contextMenu=function(e){if(!this._tool.getAllowContextMenu()){return;}if(this._inside(e)){this._updateMouse(e);this._updateHandles(e,true);if(this._handleIndex>=0){e.handled=true;var v=this.getViewport();var m=new M({items:[new a({text:g().getText("ANCHOR_POINT_TOOL_MOVE_TO_WORLD_ORIGIN")}),new a({text:g().getText("ANCHOR_POINT_TOOL_MOVE_TO_SELECTION_CENTER")}),new a({text:g().getText("ANCHOR_POINT_TOOL_MOVE_TO_SCENE_CENTER")}),new a({text:g().getText("ANCHOR_POINT_TOOL_MOVE_TO_SELECTED_OBJECTS_ORIGIN")})],itemSelected:function(e){var i=e.getParameters("item").item;var c=e.getSource().indexOfItem(i);var p=new THREE.Vector3();switch(c){default:case 0:break;case 1:this._tool.moveTo(b(v._viewStateManager),false);return;case 2:var s=v.getScene()?v.getScene().getSceneRef():null;if(s){var f=new THREE.Box3();s._expandBoundingBox(f,null,true);f.getCenter(p);}break;case 3:this._tool.moveTo(b(v._viewStateManager),true);return;}this._gizmo.setPosition(p);v.setShouldRenderFrame();}.bind(this)});m.openAsContextMenu(e.event,v);}}};
A.prototype.getViewport=function(){return this._tool._viewport;};
A.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
A.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var c=document.getElementById(i);if(c===null){return false;}var o=this._getOffset(c);this._rect={x:o.x,y:o.y,w:c.offsetWidth,h:c.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return A;});
sap.ui.predefine('sap/ui/vk/tools/AxisAngleRotationToolHandler',["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../thirdparty/three","./CoordinateSystem"],function(E,M,a,g,t,C){"use strict";
var A=E.extend("sap.ui.vk.tools.AxisAngleRotationToolHandler",{
metadata:{},
constructor:function(b){this._priority=12;this._tool=b;this._gizmo=b.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster();this._rayCaster.linePrecision=0.2;this._handleIndex=-1;this._gizmoIndex=-1;this._matrixOrigin=new THREE.Matrix4();this._mouse=new THREE.Vector2();this._mouseOrigin=new THREE.Vector2();}
});
A.prototype._updateMouse=function(e){var s=this.getViewport().getRenderer().getSize(new THREE.Vector2());this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
A.prototype._updateHandles=function(e,h){var p=this._handleIndex;this._handleIndex=-1;if(e.n===1||(e.event&&e.event.type==="contextmenu")){for(var i=0,l=this._gizmo.getGizmoCount();i<l;i++){var b=this._gizmo.getTouchObject(i);var c=this._rayCaster.intersectObject(b,true);if(c.length>0){this._handleIndex=b.children.indexOf(c[0].object);if(this._handleIndex>=0&&this._handleIndex<6){this._gizmoIndex=i;this._matrixOrigin.copy(c[0].object.matrixWorld);this._objectSize=this._gizmo._getObjectSize(i)/this._gizmo._getGizmoScale(b.position);}}}}this._gizmo.highlightHandle(this._handleIndex,this._gizmoIndex,h||this._handleIndex===-1);if(p!==this._handleIndex){this.getViewport().setShouldRenderFrame();}};
A.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);e.handled|=this._handleIndex>=0;}};
A.prototype.click=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);e.handled|=this._handleIndex>=0;}};
A.prototype._getMouseAngle=function(){var r=this._rayCaster.ray;var d=this._rotationPoint.clone().sub(r.origin);var b=this._rotationAxis.dot(d)/this._rotationAxis.dot(r.direction);var m=r.direction.clone().multiplyScalar(b).sub(d).normalize();return Math.atan2(m.dot(this._axis2),m.dot(this._axis1));};
A.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,false);if(this._handleIndex>=0&&this._handleIndex<3){e.handled=true;this._gesture=true;this._mouseOrigin.copy(e);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);this._gizmo.beginGesture();this._axis1=new THREE.Vector3().setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+1)%3).normalize();this._axis2=new THREE.Vector3().setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+2)%3).normalize();this._rotationAxis=new THREE.Vector3().crossVectors(this._axis1,this._axis2).normalize();this._rotationPoint=new THREE.Vector3().setFromMatrixPosition(this._matrixOrigin);if(Math.abs(this._rayCaster.ray.direction.dot(this._rotationAxis))<Math.cos(Math.PI*85/180)){var m=this.getViewport().getCamera().getCameraRef().matrixWorld;this._axis1.setFromMatrixColumn(m,0).normalize();this._axis2.setFromMatrixColumn(m,1).normalize();this._rotationAxis.setFromMatrixColumn(m,2).normalize();}this._startAngle=THREE.Math.degToRad(this._gizmo.getValue());this._prevAngle=this._getMouseAngle();this._deltaAngle=0;}}};
A.prototype.move=function(e){if(this._gesture){e.handled=true;this._updateMouse(e);var m=this._getMouseAngle();var b=m-this._prevAngle;this._prevAngle=m;if(b>Math.PI){b-=Math.PI*2;}else if(b<-Math.PI){b+=Math.PI*2;}this._deltaAngle+=b;var c=this._startAngle;var d=c+this._deltaAngle;if(this._tool.getEnableStepping()){var s=5;if(this._objectSize>0){var f=[0.1,1,5,15];var h=[2000,1000,300,0];for(var i=0;i<4;i++){if(this._objectSize>=h[i]){s=f[i];break;}}}s=THREE.Math.degToRad(s);d=Math.round(d/s)*s;}if(this._tool.getEnableSnapping()){this._tool.getDetector().detect({viewport:this._tool._viewport,gizmo:this._gizmo,detectType:"rotate",handleIndex:this._handleIndex,angle1:c,angle2:d});}if(isFinite(c)&&isFinite(d)){this._gizmo._setRotationAxisAngle(this._handleIndex,c,d);}}};
A.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateMouse(e);this._gizmo.endGesture();this._updateHandles(e,true);this.getViewport().setShouldRenderFrame();}};
A.prototype.contextMenu=function(e){if(!this._tool.getAllowContextMenu()){return;}if(this._inside(e)){this._updateMouse(e);this._updateHandles(e,true);if(this._handleIndex>=0){e.handled=true;}}};
A.prototype.getViewport=function(){return this._tool._viewport;};
A.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
A.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d===null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return A;});
sap.ui.predefine('sap/ui/vk/tools/MoveToolHandler',["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../thirdparty/three","./CoordinateSystem"],function(E,M,a,g,t,C){"use strict";
var b=E.extend("sap.ui.vk.tools.MoveToolHandler",{
metadata:{},
constructor:function(c){this._priority=13;this._tool=c;this._gizmo=c.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster();this._handleIndex=-1;this._gizmoIndex=-1;this._handleAxis=new THREE.Vector3();this._gizmoOrigin=new THREE.Vector3();this._gizmoScale=1;this._objectSpace=new THREE.Matrix4();this._mouse=new THREE.Vector2();}
});
b.prototype._updateMouse=function(e){var s=this.getViewport().getRenderer().getSize(new THREE.Vector2());this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
b.prototype._updateHandles=function(e,h){var p=this._handleIndex;this._handleIndex=-1;if(e.n===1||(e.event&&e.event.type==="contextmenu")){for(var i=0,l=this._gizmo.getGizmoCount();i<l;i++){var c=this._gizmo.getTouchObject(i);var f=this._rayCaster.intersectObject(c,true);if(f.length>0){this._handleIndex=c.children.indexOf(f[0].object);if(this._handleIndex>=0){this._gizmoIndex=i;this._gizmoOrigin.setFromMatrixPosition(c.matrixWorld);this._gizmoScale=c.scale.x;this._objectSpace.extractRotation(c.matrixWorld);if(this._gizmo._coordinateSystem!==C.World){this._objectSpace.copyPosition(c.matrixWorld);}if(this._handleIndex<3){this._handleAxis.setFromMatrixColumn(c.matrixWorld,this._handleIndex).normalize();}else if(this._handleIndex<6){this._handleAxis.setFromMatrixColumn(c.matrixWorld,this._handleIndex-3).normalize();}}}}}this._gizmo.highlightHandle(this._handleIndex,h||this._handleIndex===-1);if(p!==this._handleIndex){this.getViewport().setShouldRenderFrame();}};
b.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);e.handled|=this._handleIndex>=0;}};
b.prototype.click=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);e.handled|=this._handleIndex>=0;}};
var d=new THREE.Vector3();
b.prototype._getAxisOffset=function(){var r=this._rayCaster.ray;var c=this._handleAxis.clone().cross(r.direction).cross(r.direction).normalize();d.copy(r.origin).sub(this._gizmoOrigin);return c.dot(d)/c.dot(this._handleAxis);};
b.prototype._getPlaneOffset=function(){var r=this._rayCaster.ray;d.copy(this._gizmoOrigin).sub(r.origin);var c=this._handleAxis.dot(d)/this._handleAxis.dot(r.direction);return r.direction.clone().multiplyScalar(c).sub(d);};
b.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,false);if(this._handleIndex>=0){this._gesture=true;e.handled=true;this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);this._gizmo.beginGesture();if(this._handleIndex<3){this._dragOrigin=this._getAxisOffset();}else if(this._handleIndex<6){this._dragOrigin=this._getPlaneOffset();}}}};
b.prototype._setOffset=function(o){if(this._tool.getEnableStepping()){var s=Math.pow(10,Math.round(Math.log10(this._gizmoScale)))*0.1;var m=new THREE.Matrix4().getInverse(this._objectSpace);var c=this._gizmoOrigin.clone().applyMatrix4(m);var p=this._gizmoOrigin.clone().add(o).applyMatrix4(m);for(var i=0;i<3;i++){var e=p.getComponent(i);if(Math.abs(e-c.getComponent(i))>s*1e-5){var f=Math.round(e/s)*s;d.setFromMatrixColumn(this._objectSpace,i).multiplyScalar(f-e);o.add(d);}}}if(isFinite(o.x)&&isFinite(o.y)&&isFinite(o.z)){this._gizmo._setOffset(o,this._gizmoIndex);}};
b.prototype.move=function(e){if(this._gesture){if(this._tool.getEnableSnapping()){this._tool.getDetector().detect({viewport:this._tool._viewport,gizmo:this._gizmo,detectType:"move"});}e.handled=true;this._updateMouse(e);if(this._handleIndex<3){if(isFinite(this._dragOrigin)){this._setOffset(this._handleAxis.clone().multiplyScalar(this._getAxisOffset()-this._dragOrigin));}}else if(this._handleIndex<6){if(isFinite(this._dragOrigin.x)&&isFinite(this._dragOrigin.y)&&isFinite(this._dragOrigin.z)){this._setOffset(this._getPlaneOffset().sub(this._dragOrigin));}}}};
b.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateMouse(e);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateHandles(e,true);this.getViewport().setShouldRenderFrame();}};
b.prototype.contextMenu=function(e){if(!this._tool.getAllowContextMenu()){return;}if(this._inside(e)){this._updateMouse(e);this._updateHandles(e,true);if(this._handleIndex>=0){e.handled=true;var m=new M({items:[new a({text:g().getText("TOOL_COORDINATE_SYSTEM_WORLD"),key:C.World}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_LOCAL"),key:C.Local}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_PARENT"),key:C.Parent}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_SCREEN"),key:C.Screen}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_CUSTOM"),key:C.Custom})],itemSelected:function(e){var i=e.getParameters("item").item;this._tool.setCoordinateSystem(i.getKey());}.bind(this)});m.openAsContextMenu(e.event,this.getViewport());}}};
b.prototype.getViewport=function(){return this._tool._viewport;};
b.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
b.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var c=document.getElementById(i);if(c===null){return false;}var o=this._getOffset(c);this._rect={x:o.x,y:o.y,w:c.offsetWidth,h:c.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return b;});
sap.ui.predefine('sap/ui/vk/tools/PoiToolHandler',["sap/ui/base/EventProvider","../thirdparty/three"],function(E,t){"use strict";
var P=E.extend("sap.ui.vk.tools.PoiToolHandler",{
metadata:{},
constructor:function(a){this._priority=30;this._tool=a;this._gizmo=a.getGizmo();this._rect=null;this._poiIndex=-1;this._mouse=new THREE.Vector2();}
});
P.prototype._updateMouse=function(e){var s=this.getViewport().getRenderer().getSize(new THREE.Vector2());this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;};
P.prototype._updateActivePOI=function(e){this._poiIndex=-1;if(e.n===1||(e.event&&e.event.type==="contextmenu")){var v=this._tool._viewport.getDomRef().getBoundingClientRect();var h=this._tool._viewport.hitTest(e.x-v.left,e.y-v.top);if(h&&h.object){this._poiZ=new THREE.Vector3().setFromMatrixPosition(h.object.matrixWorld).project(this.getViewport().getCamera().getCameraRef()).z;for(var i=0,l=this._gizmo.getPOICount();i<l;i++){if(this._gizmo.getPOI(i)===h.object){this._poiIndex=i;break;}}}}};
P.prototype._getDragPosition=function(){return new THREE.Vector3(this._mouse.x,this._mouse.y,this._poiZ).unproject(this.getViewport().getCamera().getCameraRef());};
P.prototype.click=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateActivePOI(e,true);this._gizmo.selectPOI(this._poiIndex);e.handled|=this._poiIndex>=0;}};
P.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateActivePOI(e);if(this._poiIndex>=0){this._gesture=true;e.handled=true;this._gizmo.selectPOI(this._poiIndex);this._gizmo.beginGesture();this._dragOrigin=this._getDragPosition();}}};
P.prototype._setOffset=function(o){if(isFinite(o.x)&&isFinite(o.y)&&isFinite(o.z)){this._gizmo._setOffset(o,this._poiIndex);}};
P.prototype.move=function(e){if(this._gesture){e.handled=true;this._updateMouse(e);if(isFinite(this._dragOrigin.x)&&isFinite(this._dragOrigin.y)&&isFinite(this._dragOrigin.z)){this._setOffset(this._getDragPosition().sub(this._dragOrigin));}}};
P.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateMouse(e);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateActivePOI(e);this.getViewport().setShouldRenderFrame();}};
P.prototype.getViewport=function(){return this._tool._viewport;};
P.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
P.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d===null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return P;});
sap.ui.predefine('sap/ui/vk/tools/RectSelectToolHandler',["sap/ui/base/EventProvider"],function(E){"use strict";
var R=E.extend("sap.ui.vk.tools.RectSelectToolHandler",{
metadata:{publicMethods:["beginGesture","endGesture","move","click","doubleClick","contextMenu"]},
constructor:function(T){this._tool=T;this._rect=null;this._gesture=false;this._nomenu=false;this._selectionRect=null;}
});
R.prototype.destroy=function(){this._tool=null;this._rect=null;this._gesture=false;};
R.prototype.activate=function(v){this._deactivate=false;if(v._loco){this._viewport=v;v._loco.addHandler(this,1);}};
R.prototype.deactivate=function(){if(this._gesture){this._deactivate=true;}else if(this._viewport){this._deactivate=false;this._viewport._loco.removeHandler(this);this._viewport=null;}};
R.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
R.prototype._inside=function(a){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};if(document.activeElement){try{document.activeElement.blur();}catch(e){}}d.focus();return(a.x>=this._rect.x&&a.x<=this._rect.x+this._rect.w&&a.y>=this._rect.y&&a.y<=this._rect.y+this._rect.h);};
R.prototype.beginGesture=function(e){if(e.n===1&&this._inside(e)&&!this._gesture){this._gesture=true;e.handled=true;var x=e.x-this._rect.x,y=e.y-this._rect.y;this._selectionRect={x1:x,y1:y,x2:x,y2:y};return;}};
R.prototype.move=function(e){if(this._gesture){e.handled=true;this._nomenu=true;if(this._selectionRect){this._selectionRect.x2=e.x-this._rect.x;this._selectionRect.y2=e.y-this._rect.y;if(this._viewport){this._viewport.setSelectionRect(this._selectionRect);}}}};
R.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;if(this._selectionRect){if(this._viewport){var x=e.x-this._rect.x,y=e.y-this._rect.y;if(this._tool.isViewportType("sap.ui.vk.svg.Viewport")||this._tool.isViewportType("sap.ui.vk.dvl.Viewport")){this._tool.select(this._selectionRect.x1,this._selectionRect.y1,x,y,null,null);}else if(this._tool.isViewportType("sap.ui.vk.threejs.Viewport")){this._tool.select(this._selectionRect.x1,this._selectionRect.y1,x,y,this._viewport.getScene(),this._viewport.getCamera());}}this._viewport.setSelectionRect(null);this._selectionRect=null;}if(this._deactivate){this.deactivate();}}};
R.prototype.getViewport=function(){return this._viewport;};
return R;});
sap.ui.predefine('sap/ui/vk/tools/RotateToolHandler',["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../thirdparty/three","./CoordinateSystem"],function(E,M,a,g,t,C){"use strict";
var R=E.extend("sap.ui.vk.tools.RotateToolHandler",{
metadata:{},
constructor:function(b){this._priority=12;this._tool=b;this._gizmo=b.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster();this._rayCaster.linePrecision=0.2;this._handleIndex=-1;this._gizmoIndex=-1;this._matrixOrigin=new THREE.Matrix4();this._levelingQuaternion=new THREE.Quaternion();this._mouse=new THREE.Vector2();this._mouseOrigin=new THREE.Vector2();}
});
R.prototype._updateMouse=function(e){var s=this.getViewport().getRenderer().getSize(new THREE.Vector2());this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
R.prototype._updateHandles=function(e,h){var p=this._handleIndex;this._handleIndex=-1;if(e.n===1||(e.event&&e.event.type==="contextmenu")){for(var i=0,l=this._gizmo.getGizmoCount();i<l;i++){var b=this._gizmo.getTouchObject(i);var c=this._rayCaster.intersectObject(b,true);if(c.length>0){this._handleIndex=b.children.indexOf(c[0].object);if(this._handleIndex>=0&&this._handleIndex<3){this._gizmoIndex=i;this._matrixOrigin.copy(b.matrixWorld);this._gizmo._getLevelingQuaternion(this._levelingQuaternion,i);this._objectSize=this._gizmo._getObjectSize(i)/this._gizmo._getGizmoScale(b.position);}}}}this._gizmo.highlightHandle(this._handleIndex,h||this._handleIndex===-1);if(p!==this._handleIndex){this.getViewport().setShouldRenderFrame();}};
R.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);e.handled|=this._handleIndex>=0;}};
R.prototype.click=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);e.handled|=this._handleIndex>=0;}};
R.prototype._getMouseAngle=function(){var r=this._rayCaster.ray;var d=this._rotationPoint.clone().sub(r.origin);var b=this._rotationAxis.dot(d)/this._rotationAxis.dot(r.direction);var m=r.direction.clone().multiplyScalar(b).sub(d).normalize();return Math.atan2(m.dot(this._axis2),m.dot(this._axis1));};
R.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,false);if(this._handleIndex>=0&&this._handleIndex<3){e.handled=true;this._gesture=true;this._mouseOrigin.copy(e);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);this._gizmo.beginGesture();this._axis1=new THREE.Vector3().setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+1)%3).normalize();this._axis2=new THREE.Vector3().setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+2)%3).normalize();this._rotationAxis=new THREE.Vector3().crossVectors(this._axis1,this._axis2).normalize();this._rotationPoint=new THREE.Vector3().setFromMatrixPosition(this._matrixOrigin);if(Math.abs(this._rayCaster.ray.direction.dot(this._rotationAxis))<Math.cos(Math.PI*85/180)){var m=this.getViewport().getCamera().getCameraRef().matrixWorld;this._axis1.setFromMatrixColumn(m,0).normalize();this._axis2.setFromMatrixColumn(m,1).normalize();this._rotationAxis.setFromMatrixColumn(m,2).normalize();}this._startAngle=this._getMouseAngle();this._prevDeltaAngle=0;}}};
R.prototype.move=function(e){if(this._gesture){e.handled=true;this._updateMouse(e);var b=this._startAngle;var d=this._getMouseAngle()-b;if(d>Math.PI){d-=Math.PI*2;}else if(d<-Math.PI){d+=Math.PI*2;}if(Math.abs(this._prevDeltaAngle)>Math.PI/4){if(this._prevDeltaAngle*d<0){d+=Math.PI*2*Math.sign(this._prevDeltaAngle);}}d=d%(Math.PI*2);var c=b+d;if(this._tool.getEnableStepping()){var s=5;if(this._objectSize>0){var f=[0.1,1,5,15];var h=[2000,1000,300,0];for(var i=0;i<4;i++){if(this._objectSize>=h[i]){s=f[i];break;}}}s=THREE.Math.degToRad(s);var j=c-b;c+=Math.round(j/s)*s-j;}this._prevDeltaAngle=c-b;if(this._tool.getEnableSnapping()){this._tool.getDetector().detect({viewport:this._tool._viewport,gizmo:this._gizmo,detectType:"rotate",handleIndex:this._handleIndex,angle1:b,angle2:c});}if(isFinite(b)&&isFinite(c)){this._gizmo._setRotationAxisAngle(this._handleIndex,b,c);}}};
R.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateMouse(e);this._gizmo.endGesture();this._updateHandles(e,true);this.getViewport().setShouldRenderFrame();}};
R.prototype.contextMenu=function(e){if(!this._tool.getAllowContextMenu()){return;}if(this._inside(e)){this._updateMouse(e);this._updateHandles(e,true);if(this._handleIndex>=0){e.handled=true;var m=new M({items:[new a({text:g().getText("TOOL_COORDINATE_SYSTEM_WORLD"),key:C.World}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_LOCAL"),key:C.Local}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_SCREEN"),key:C.Screen}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_CUSTOM"),key:C.Custom})],itemSelected:function(e){var i=e.getParameters("item").item;this._tool.setCoordinateSystem(i.getKey());}.bind(this)});m.openAsContextMenu(e.event,this.getViewport());}}};
R.prototype.getViewport=function(){return this._tool._viewport;};
R.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
R.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d===null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return R;});
sap.ui.predefine('sap/ui/vk/tools/ScaleToolHandler',["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../thirdparty/three","./CoordinateSystem"],function(E,M,a,g,t,C){"use strict";
var S=E.extend("sap.ui.vk.tools.ScaleToolHandler",{
metadata:{},
constructor:function(b){this._priority=11;this._tool=b;this._gizmo=b.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster();this._handleIndex=-1;this._gizmoIndex=-1;this._handleAxis=new THREE.Vector3();this._handleDirection=new THREE.Vector3();this._gizmoOrigin=new THREE.Vector3();this._mouse=new THREE.Vector2();this._mouseOrigin=new THREE.Vector2();this._originScale=1;this._objectSize=1;}
});
S.prototype._updateMouse=function(e){var s=this.getViewport().getRenderer().getSize(new THREE.Vector2());this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
S.prototype._updateHandles=function(e,h){var p=this._handleIndex;this._handleIndex=-1;if(e.n===1||(e.event&&e.event.type==="contextmenu")){for(var i=0,l=this._gizmo.getGizmoCount();i<l;i++){var b=this._gizmo.getTouchObject(i);var c=this._rayCaster.intersectObjects(b.children,false);if(c.length>0){this._handleIndex=b.children.indexOf(c[0].object);if(this._handleIndex>=0){this._gizmoIndex=i;this._gizmoOrigin.setFromMatrixPosition(b.matrixWorld);this._handleAxis.setFromMatrixColumn(b.matrixWorld,this._handleIndex%3).normalize();this._originScale=this._gizmo._getObjectScale(i).x;this._objectSize=(this._gizmo._getObjectSize(i)/b.scale.x)||1;var d=new THREE.Vector3().setFromMatrixColumn(b.matrixWorld,(this._handleIndex+1)%3).normalize();var f=new THREE.Vector3().setFromMatrixColumn(b.matrixWorld,(this._handleIndex+2)%3).normalize();this._handleDirection.addVectors(d,f).normalize();}}}}this._gizmo.highlightHandle(this._handleIndex,h||this._handleIndex===-1);if(p!==this._handleIndex){this.getViewport().setShouldRenderFrame();}};
S.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);e.handled|=this._handleIndex>=0;}};
S.prototype.click=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);e.handled|=this._handleIndex>=0;}};
S.prototype._getAxisOffset=function(){var r=this._rayCaster.ray;var d=this._handleAxis.clone().cross(r.direction).cross(r.direction).normalize();var b=r.origin.clone().sub(this._gizmoOrigin);return d.dot(b)/d.dot(this._handleAxis);};
S.prototype._getPlaneOffset=function(){var r=this._rayCaster.ray;var d=this._gizmoOrigin.clone().sub(r.origin);var b=this._handleAxis.dot(d)/this._handleAxis.dot(r.direction);return r.direction.clone().multiplyScalar(b).sub(d);};
S.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,false);if(this._handleIndex>=0){this._gesture=true;e.handled=true;this._mouseOrigin.set(e.x,e.y);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);this._gizmo.beginGesture();if(this._handleIndex<3){this._dragOrigin=this._getAxisOffset();}else if(this._handleIndex<6){this._dragOrigin=this._handleDirection.dot(this._getPlaneOffset());}}}};
S.prototype.move=function(e){if(this._gesture){if(this._tool.getEnableSnapping()){this._tool.getDetector().detect({viewport:this._tool._viewport,gizmo:this._gizmo,detectType:"scale"});}e.handled=true;this._updateMouse(e);var s=new THREE.Vector3().setScalar(1);if(this._handleIndex<3){if(this._tool.getNonUniformScaleEnabled()){s.setComponent(this._handleIndex,this._getAxisOffset()/this._dragOrigin);}else{s.setScalar(this._getAxisOffset()/this._dragOrigin);}}else if(this._handleIndex<6){s.setScalar(this._handleDirection.dot(this._getPlaneOffset())/this._dragOrigin).setComponent(this._handleIndex-3,1);}else{var d=(this._mouseOrigin.y-e.y)/60;s.setScalar(d>=0?1+d:1/(1-d));}if(s.x&&s.y&&s.z&&isFinite(s.x)&&isFinite(s.y)&&isFinite(s.z)){if(this._tool.getEnableStepping()){var b=Math.pow(10,Math.round(Math.log10(this._originScale/this._objectSize)))/this._originScale;if(b>0&&isFinite(b)){s.setScalar(Math.max(Math.round(s.x/b),1)*b);}}this._gizmo._setScale(s);}}};
S.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateMouse(e);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateHandles(e,true);this.getViewport().setShouldRenderFrame();}};
S.prototype.contextMenu=function(e){if(!this._tool.getAllowContextMenu()){return;}if(this._inside(e)){this._updateMouse(e);this._updateHandles(e,true);if(this._handleIndex>=0){e.handled=true;var m=new M({items:[new a({text:g().getText("TOOL_COORDINATE_SYSTEM_WORLD"),key:C.World}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_LOCAL"),key:C.Local}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_SCREEN"),key:C.Screen}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_CUSTOM"),key:C.Custom})],itemSelected:function(e){var i=e.getParameters("item").item;this._tool.setCoordinateSystem(i.getKey());}.bind(this)});m.openAsContextMenu(e.event,this.getViewport());}}};
S.prototype.getViewport=function(){return this._tool._viewport;};
S.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
S.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d===null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return S;});
sap.ui.predefine('sap/ui/vk/totara/CallbackHandler',[],function(){"use strict";var C=function(){this.callbacks=[];};
C.prototype.attach=function(c){this.callbacks.push(c);};
C.prototype.detach=function(c){var i=this.callbacks.indexOf(c);if(i!==-1){this.callbacks.splice(i,1);return true;}return false;};
C.prototype.execute=function(a){for(var i=0;i<this.callbacks.length;i++){this.callbacks[i](a);}};
C.prototype.detachAll=function(){this.callbacks=[];};
return C;});
sap.ui.predefine('sap/ui/vk/totara/GeometryFactory',["./IndexCompressor"],function(I){"use strict";var a=1;var H=2;var b=4;var V=0;var c=3;var G=function(){};
G.getGeometryInfo=function(g,f){var h=new DataView(f.buffer,f.byteOffset,f.byteLength);var o=0;var k=(g.flags&H)>0;var l=(g.flags&b)>0;var m=(g.flags&a)>0;var n=false;var p=[];var q=[];var u=[];var r=[];var s=1;var t=1;var v=1;var w=new THREE.Vector3(0,0,0);var x=[w.x-s/2,w.y-t/2,w.z-v/2,w.x+s/2,w.y+t/2,w.z+v/2];var y=new I(f,f.length);y.setCurByte(o);if(!y.ReadCommand()){throw"buffer over flow";}var z=y.rvalue;var A;if(z){A=U(y,g.pointCount,z,x,p);if(A.isOk){p=A.array;n=true;}else{return false;}}var B=1;if(k){if(!y.ReadCommand()){return false;}B=y.rvalue;if(B){A=d(y,g.pointCount,B);if(A.isOk){q=A.array;}else{return false;}}}var C=1;var N=false;if(l){if(!y.ReadCommand()){return false;}C=y.rvalue;if(C){A=e(y,g.pointCount,C);if(A.isOk){N=true;u=A.array;}else{return false;}}}if(!z||!B||!C||N){if(N){o=y.getCurByte();var D=h.getFloat32(o,true);var E=h.getFloat32(o+4,true);y.moveCurByte(8);if((D!==0.0)||(E!==1.0)){var F=E-D;for(var J=0;J<g.pointCount*2;J++){u[J]=u[J]*F+D;}}}var K;if(!z){o=y.getCurByte();for(K=0;K<g.pointCount;K++){p.push(h.getFloat32(o+K*4,true));p.push(h.getFloat32(o+(K+g.pointCount)*4,true));p.push(h.getFloat32(o+(K+g.pointCount*2)*4,true));}y.moveCurByte(g.pointCount*3*4);}if(!B){o=y.getCurByte();for(K=0;K<g.pointCount;K++){q.push(h.getFloat32(o+(K)*4,true));q.push(h.getFloat32(o+(K+g.pointCount*1)*4,true));q.push(h.getFloat32(o+(K+g.pointCount*2)*4,true));}y.moveCurByte(g.pointCount*3*4);}if(!C){if(l){o=y.getCurByte();for(K=0;K<g.pointCount;K++){u.push(h.getFloat32(o+(K)*4,true));u.push(h.getFloat32(o+(K+g.pointCount*1)*4,true));}y.moveCurByte(g.pointCount*2*4);}}}var L=y.getCurByte();y.Reset();y.setCurByte(L);var M=[0,0,0];var O=m?2:3;for(var i=0;i<g.elementCount;i++){for(var j=0;j<O;j++){if(!y.ReadCommand(M[j])){throw"UIC1 Decompression error!!!";}else{r.push(y.rvalue);M[j]=y.rvalue;}}}return{id:g.id,isPolyline:m,isPositionQuantized:n,data:{indices:r,points:p,normals:q,uvs:u}};};
function U(f,p,n,g){var r={array:new Array(p*3),isOk:false};for(var x=0;x<3;x++){var v=g[V+x];var q=(g[c+x]-v)/n;for(var i=0;i<p;i++){if(!f.ReadCommand()){return r;}r.array[i*3+x]=q*f.rvalue+v;}}r.isOk=true;return r;}
function d(i,p,n){var r={array:[],isOk:false};var t=[];var f;for(f=0;f<p;f++){if(!i.ReadCommand()){return r;}t.push(i.rvalue);}var q=2*Math.PI/n;var g;var h;var k;for(f=0;f<p;f++){if(!i.ReadCommand()){return r;}g=q*t[f];h=q*i.rvalue;k=Math.sin(h);r.array.push(k*Math.cos(g));r.array.push(k*Math.sin(g));r.array.push(Math.cos(h));}r.isOk=true;return r;}
function e(f,p,n){var r={array:new Array(p*2),isOk:false};var q=1.0/n;for(var u=0;u<2;u++){for(var i=0;i<p;i++){if(!f.ReadCommand()){return false;}r.array[i*2+u]=q*f.rvalue;}}r.isOk=true;return r;}
return G;});
sap.ui.predefine('sap/ui/vk/totara/IndexCompressor',[],function(){"use strict";var I=function(b,a){var V=32;var c=16;var C=13;var e=14;var f=0;var g=1;var h=3;var i=4;var k=5;var l=6;var m=7;var n=8;var o=9;var p=10;var q=11;var r=12;var s=15;var E=0;var t=1;var u=2;var v=3;var w=4;var x=5;var y=6;var z=7;var A=8;var B=9;var D=10;var F=11;var G=12;var H=13;var J=4294967295;var K=0;this.rvalue=0;var L=0;var M=b;var N=a;var O=0;var P=new Array(V);var Q=new Array(c);var R=V-1;var S=c-1;var T=false;this.Reset=function(){K=0;this.rvalue=0;L=0;O=0;var j;for(j=0;j<V;j++){P[j]=V-j-1;}for(j=0;j<c;j++){Q[j]=1;}R=V-1;S=c-1;};this.Reset();function U(d){return P[(R>=d)?(R-d):(V+R-d)];}function W(d){return Q[(S>=d)?(S-d):(c+S-d)];}function X(d){R++;if(R>=V){R=0;}P[R]=d;}function Y(d){S++;if(S>=c){S=0;}Q[S]=d;}function Z(){if(O<N){return M[O++];}T=true;return 0;}function $(){return Z()+Z()*256;}function _(){return Z()+Z()*256+Z()*65536+Z()*16777216;}this.ReadCommand=function(j){if(j===undefined){j=J;}T=false;var a1=this.rvalue;if(K){K--;this.rvalue=U(L);}else{var b1=Z();if(T){b1=g;}var c1=b1>>>4;switch(b1&0xF){case f:this.rvalue=U(c1);break;case k:this.rvalue=U(16+c1);break;case C:this.rvalue=U(c1>>>2);L=c1&3;K=1;break;case e:this.rvalue=U(0);L=0;K=c1+2;break;case l:this.rvalue+=W(c1);break;case g:if(b1&16){this.rvalue+=(b1>>>5)+1;}else{this.rvalue-=(b1>>>5)+1;}break;case h:this.rvalue=j+(c1+1);break;case i:this.rvalue=j-(c1+1);break;case m:this.rvalue=j+(c1+17);break;case n:this.rvalue=j-(c1+17);break;case o:this.rvalue+=c1+((Z())<<4)+3;break;case p:this.rvalue-=c1+((Z())<<4)+3;break;case q:this.rvalue=c1+((Z())<<4);break;case r:var d1=$();this.rvalue=c1+(d1<<4);break;case s:switch(b1>>>4){case E:case t:case u:case v:case w:this.rvalue=b1>>>4;break;case x:this.rvalue=0x000000FF;break;case y:this.rvalue=0x0000FF00;break;case z:this.rvalue=0x00FF0000;break;case A:this.rvalue=0xFF000000;break;case B:this.rvalue=0x00FFFFFF;break;case D:this.rvalue=0xFFFFFFFF;break;case H:L=0;K=$()+36;break;case F:{var bl=Z();this.rvalue=($()<<8)+bl;}break;case G:this.rvalue=_();break;default:return false;}break;default:return false;}}if(this.rvalue>0xFFFFFFFF){this.rvalue=this.rvalue-0xFFFFFFFF-1;}X(this.rvalue);var d;if(this.rvalue!=a1){if(this.rvalue>a1){d=this.rvalue-a1;if(d<0x7FFFFFFF){Y(d);}}else{d=a1-this.rvalue;if(d<0x7FFFFFFF){Y(-d);}}}if(T){K=0;this.rvalue=0;return false;}return true;};this.getCurByte=function(){return O;};this.setCurByte=function(d){O=d;};this.moveCurByte=function(d){O=O+d;};};return I;});
sap.ui.predefine('sap/ui/vk/totara/ProgressCounter',[],function(){"use strict";
function C(){this._count=0;this._total=0;var o;this.setOnValueChanged=function(c){o=c;};this.callOnValueChanged=function(){if(o){o();}};}
var p=C.prototype;Object.defineProperty(p,"count",{get:function(){return this._count;},set:function(v){if(v!==this._count){this._count=v;this.callOnValueChanged();}}});Object.defineProperty(p,"total",{get:function(){return this._total;},set:function(v){if(v!==this._total){this._total=v;this.callOnValueChanged();}}});var P=function(){var o;function a(){if(o){o(this);}}this.mesh=new C();this.geometry=new C();this.mesh.setOnValueChanged(a);this.geometry.setOnValueChanged(a);this.setOnProgressChanged=function(c){o=c;};};return P;});
sap.ui.predefine('sap/ui/vk/totara/RequestQueue',["./TotaraUtils","./Command","sap/base/Log"],function(T,C,L){"use strict";
function R(g){this.getBatchSize=g;this.globalList=new Set();this.requestedList=[];this.waitingList=new Map();}
R.prototype.push=function(i,r){if(!this.globalList.has(i)){this.globalList.add(i);this.requestedList.push(r||i);this.waitingList.set(i,r);}};
R.prototype.setBatchSizeInfo=function(b){this.batchSizeInfo=b;};
R.prototype.fetchBatch=function(){var b=this.getBatchSize?this.getBatchSize:1;if(typeof this.getBatchSize==="function"){b=this.getBatchSize();}var a=0;var d=[];for(var i=0;i<b&&this.requestedList.length>0;i++){var r=this.requestedList.pop();var e=r.id?r.id:r;a+=e.toString().length+(i==0||!this.batchSizeInfo?0:this.batchSizeInfo.separatorLength);if(this.batchSizeInfo&&a>this.batchSizeInfo.maxBatchStringLength){this.requestedList.push(e);break;}d.push(e);}return d;};
R.prototype.pop=function(i){return this.waitingList.delete(i);};
R.prototype.isReady=function(i){return this.globalList.has(i)&&!this.waitingList.has(i);};
R.prototype.clear=function(i){this.globalList.clear();this.requestedList=[];this.waitingList.clear();};
R.prototype.isEmpty=function(){return this.requestedList.length===0;};
R.prototype.isWaiting=function(){return this.waitingList.size>0;};
R.prototype.isInitialViewCompleted=function(){var i=this.requestedList.filter(function(l){return l.isInitial;});var a=[];this.waitingList.forEach(function(v,k){if(v&&v.isInitial){a.push(k);}});return(i.length===0&&a.length===0);};
function P(g,a){R.call(this,g);this.getMaxBatchDataSize=a;this.priorityMap=new Map();}
P.prototype=Object.create(R.prototype);P.prototype.constructor=P;
P.prototype.push=function(i,p,s,r){if(!this.globalList.has(i)){s=s||1;this.globalList.add(i);this.requestedList.push(r||i);this.waitingList.set(i,r);this.priorityMap.set(i,{p:p,s:s});}};
P.prototype.clear=function(){R.prototype.clear.call(this);this.priorityMap.clear();};
P.prototype.setBatchSizeInfo=function(b){this.batchSizeInfo=b;};
P.prototype.fetchBatch=function(){var p=this.priorityMap;this.requestedList.sort(function(a,b){return p.get(a.id?a.id:a).p-p.get(b.id?b.id:b).p;});var d=[];var s=0;var e=this.getBatchSize?this.getBatchSize():1;var f=0;var m=this.getMaxBatchDataSize?this.getMaxBatchDataSize():1024*1024;var g=m>>1;for(var i=0;i<e&&this.requestedList.length>0;i++){var r=this.requestedList.pop();var h=r.id?r.id:r;f+=h.toString().length+(i==0||!this.batchSizeInfo?0:this.batchSizeInfo.separatorLength);var j=p.get(h).s;if(this.batchSizeInfo&&f>this.batchSizeInfo.maxBatchStringLength||s>g&&s+j>m){this.requestedList.push(h);break;}s+=j;p.delete(h);d.push(h);}return d;};
var c=function(a,s){this.context=a;this.sceneId=s;this.token=a.token||T.generateToken();var l=a.loader;this.meshes=new R(l.getMeshesBatchSize.bind(l));this.materials=new R(l.getMaterialsBatchSize.bind(l));this.textures=new R();this.geometries=new P(l.getGeometriesBatchSize.bind(l),l.getGeometriesMaxBatchDataSize.bind(l));this.geomMeshes=new P(l.getGeomMeshesBatchSize.bind(l),l.getGeomMeshesMaxBatchDataSize.bind(l));this.annotations=new R(l.getAnnotationsBatchSize.bind(l));this.parametric=new R(128);this.views=new R();this.thumbnails=new R();this.tracks=new R(l.getTracksBatchSize.bind(l));this.sequences=new R(l.getSequencesBatchSize.bind(l));this.highlights=new R();};
c.prototype.isEmpty=function(){return this.meshes.isEmpty()&&this.annotations.isEmpty()&&this.parametric.isEmpty()&&this.materials.isEmpty()&&this.textures.isEmpty()&&this.geometries.isEmpty()&&this.geomMeshes.isEmpty()&&this.views.isEmpty()&&this.thumbnails.isEmpty()&&this.tracks.isEmpty()&&this.sequences.isEmpty()&&this.highlights.isEmpty();};
c.prototype.isWaitingForContent=function(){return this.meshes.isWaiting()||this.textures.isWaiting()||this.materials.isWaiting()||this.geometries.isWaiting()||this.geomMeshes.isWaiting()||this.annotations.isWaiting()||this.parametric.isWaiting()||this.views.isWaiting()||this.thumbnails.isWaiting()||this.tracks.isWaiting()||this.sequences.isWaiting()||this.highlights.isWaiting();};
c.prototype.clearContent=function(){this.meshes.clear();this.annotations.clear();this.parametric.clear();this.materials.clear();this.textures.clear();this.geometries.clear();this.geomMeshes.clear();this.views.clear();this.thumbnails.clear();this.tracks.clear();this.sequences.clear();this.highlights.clear();};
c.prototype.createGetContentCommand=function(a,i,e){var o={sceneId:this.sceneId,ids:i.map(function(b){return parseInt(b,10);}),token:this.token};return T.createRequestCommand(a,e?Object.assign(o,e):o);};
c.prototype.generateRequestCommand=function(){var a;var b=null;if(!this.meshes.isEmpty()){a=this.meshes.fetchBatch();var m=a.map(function(i){return(i.id?i.id:i);});b=this.createGetContentCommand(C.getMesh,m);}else if(!this.annotations.isEmpty()){a=this.annotations.fetchBatch();b=this.createGetContentCommand(C.getAnnotation,a);}else if(!this.parametric.isEmpty()){a=this.parametric.fetchBatch();b=this.createGetContentCommand(C.getParametric,a);}else if(!this.materials.isEmpty()){a=this.materials.fetchBatch();b=this.createGetContentCommand(C.getMaterial,a);}else if(!this.geometries.isEmpty()){a=this.geometries.fetchBatch();b=this.createGetContentCommand(C.getGeometry,a);b.sceneId=this.sceneId;b.geometryIds=a;}else if(!this.geomMeshes.isEmpty()){a=this.geomMeshes.fetchBatch();var g=a.map(function(i){return(i.id?i.id:i);});b=this.createGetContentCommand(C.getGeomMesh,g);b.sceneId=this.sceneId;b.meshIds=g;}else if(!this.textures.isEmpty()){a=this.textures.requestedList.splice(0,1);L.info("Requesting texture: "+a[0].imageId);b=this.createGetContentCommand(C.getImage,[a[0].imageId]);b.sceneId=this.sceneId;b=Object.assign(b,a[0]);}else if(!this.sequences.isEmpty()){a=this.sequences.fetchBatch();b=this.createGetContentCommand(C.getSequence,a);}else if(!this.tracks.isEmpty()){a=this.tracks.fetchBatch();b=this.createGetContentCommand(C.getTrack,a);}else if(!this.views.isEmpty()){a=this.views.requestedList.splice(0,1);var e="nodes,bounds,animation";var d=this.context.includeAnimation!==undefined?this.context.includeAnimation:true;if(!d){e="nodes,bounds";}var s="name,transform,meshId,annotationId,materialId,contentType,visible,opacity,renderOrder,entityId,highlightStyleId";b=T.createRequestCommand(C.getView,{sceneId:this.sceneId,groupId:a[0].viewGroupId,id:a[0].viewId,includeHidden:this.context.includeHidden!==undefined?this.context.includeHidden:true,includeBackground:this.context.includeBackground!==undefined?this.context.includeBackground:true,includeParametric:this.context.includeParametric!==undefined?this.context.includeParametric:true,$expand:e,$select:s,token:this.token});}else if(!this.highlights.isEmpty()){a=this.highlights.requestedList.splice(0,1);b=T.createRequestCommand(C.getHighlightStyle,{sceneId:this.sceneId,id:a[0],token:this.token});}else if(!this.thumbnails.isEmpty()){a=this.thumbnails.requestedList.splice(0,1);b=this.createGetContentCommand(C.getImage,[a[0].imageId]);b.sceneId=this.sceneId;b=Object.assign(b,a[0]);}return b;};
return c;});
sap.ui.predefine('sap/ui/vk/totara/SceneContext',["sap/base/Log","./CallbackHandler","./TotaraUtils","./GeometryFactory","./ProgressCounter","./RequestQueue","../getResourceBundle","../AnimationRotateType"],function(L,C,T,G,P,R,g,A){"use strict";var S=function(s,p,l){this.root=null;this.onActiveCameraCallbacks=new C();this.onInitialSceneFinishedCallbacks=new C();this.onPartialRetrievalFinishedCallbacks=new C();this.onSceneCompletedCallbacks=new C();this.onSetPlaybackCallbacks=new C();this.onViewFinishedCallbacks=new C();this.onViewGroupFinishedCallbacks=new C();this.onContentChangesProgressCallbacks=new C();this.onInitialViewCompletedCallbacks=new C();Object.assign(this,p);this.sceneId=s;this.loader=l;this.sceneBuilder=l.sceneBuilder;this.requestQueue=new R(this,s);this.phase=S.Phase.Started;this.retrievalType=S.RetrievalType.Initial;this.rootNodeId=null;this.meshNodes=new Map();this.parametricNodeMap=new Map();this.annotationNodeMap=new Map();this.leaderLineMaterialIdMap=new Map();this.imageNoteMaterialIdMap=new Map();this.thumbnailViewMap=new Map();this.viewThumbnailMap=new Map();this.viewAnimatedThumbnailMap=new Map();this.progressCount=new P();this.treeNodes=[];this.viewIdTreeNodesMap=new Map();this.viewIdBoxMap=new Map();this.nodeSidsForPartialTree=new Set();this.replacedNodes=new Map();this.updatedNodes=new Set();this.authorizationHandler=null;this.currentViewId=null;this.initialViewId=null;this.initialViewDecided=false;this.initialViewFired=false;this.eventObject={};this.eventObject.percentage=0;this.loadingGeometry=0;};S.Phase={Started:0,FinishedHierarchy:1,FinishedMesh:2,FinishedGeometry:3};S.RetrievalType={Initial:0,Partial:1};S.ProgressPhase={FinishedTree:g().getText("SCENE_CONTEXT_FINISHED_TREE"),FinishedMeshes:g().getText("SCENE_CONTEXT_FINISHED_MESHES"),FinishedMaterials:g().getText("SCENE_CONTEXT_FINISHED_MATERIALS"),FinishedGeomMeshes:g().getText("SCENE_CONTEXT_FINISHED_GEOMETRIES"),LoadingGeomMeshes:g().getText("SCENE_CONTEXT_LOADING_GEOMETRIES"),FinishedTextures:g().getText("SCENE_CONTEXT_FINISHED_TEXTURES")};
S.prototype.setOnProgressChanged=function(c){this.progressCount.setOnProgressChanged(c);};
S.prototype.isLoadingFinished=function(){if(!this.requestQueue.isEmpty()||this.requestQueue.isWaitingForContent()||this.thumbnailViewMap.size>0||this.viewThumbnailMap.size>0||this.viewAnimatedThumbnailMap.size>0||this.meshNodes.size>0||this.annotationNodeMap.size>0||this.parametricNodeMap.size>0||this.leaderLineMaterialIdMap.size>0||this.imageNoteMaterialIdMap.size>0||this.viewIdTreeNodesMap.size>0||this.nodeSidsForPartialTree.size>0){return false;}return true;};
S.prototype.isSceneCompleted=function(){return!this.requestQueue.meshes.isWaiting()&&!this.requestQueue.annotations.isWaiting()&&!this.requestQueue.materials.isWaiting()&&!this.requestQueue.parametric.isWaiting()&&!this.requestQueue.geomMeshes.isWaiting()&&!this.requestQueue.geometries.isWaiting()&&!this.requestQueue.textures.isWaiting();};
S.prototype.isInitialViewCompleted=function(){var t=this.requestQueue.textures.isInitialViewCompleted();var m=this.requestQueue.meshes.isInitialViewCompleted();var a=this.requestQueue.geomMeshes.isInitialViewCompleted();L.info("IsInitialViewCompleted:");L.info("textures: "+t);L.info("meshes: "+m);L.info("geoMeshes: "+a);return(t&&m&&a);};
S.prototype._checkSceneCompletion=function(){if(!this.initialViewFired&&this.isInitialViewCompleted()){L.info("initialView completed.");this.initialViewFired=true;this.onInitialViewCompletedCallbacks.execute();}else if(this.isSceneCompleted()){if(this.eventObject.percentage<100){this.eventObject.percentage=100;this.onContentChangesProgressCallbacks.execute(this.eventObject);}this.onSceneCompletedCallbacks.execute();L.info("Scene completed.");T.mark("sceneCompleted");this.logPerformance("sceneCompleted");}};
S.prototype._fireProgress=function(a){switch(a){case S.ProgressPhase.FinishedTree:this.eventObject.percentage+=10;this.eventObject.phase=S.ProgressPhase.FinishedTree;this.onContentChangesProgressCallbacks.execute(this.eventObject);break;case S.ProgressPhase.FinishedMeshes:if(!this.requestQueue.meshes.isWaiting()){this.eventObject.percentage+=10;this.eventObject.phase=S.ProgressPhase.FinishedMeshes;this.onContentChangesProgressCallbacks.execute(this.eventObject);}break;case S.ProgressPhase.FinishedMaterials:if(!this.requestQueue.materials.isWaiting()){this.eventObject.percentage+=10;this.eventObject.phase=S.ProgressPhase.FinishedMaterials;this.onContentChangesProgressCallbacks.execute(this.eventObject);}break;case S.ProgressPhase.LoadingGeomMeshes:this.eventObject.percentage+=61*(1/this.requestQueue.geomMeshes.globalList.size);if(this.eventObject.percentage>100){this.eventObject.percentage=100;}this.loadingGeometry+=61*(1/this.requestQueue.geomMeshes.globalList.size);if(this.loadingGeometry>=60){this.eventObject.phase=S.ProgressPhase.FinishedGeomMeshes;}else{this.eventObject.phase=S.ProgressPhase.LoadingGeomMeshes;}this.onContentChangesProgressCallbacks.execute(this.eventObject);break;case S.ProgressPhase.FinishedTextures:if(!this.requestQueue.textures.isWaiting()){this.eventObject.percentage+=10;this.eventObject.phase=S.ProgressPhase.FinishedTextures;this.onContentChangesProgressCallbacks.execute(this.eventObject);}break;default:}};
S.prototype.dispose=function(){this.sceneId=null;this.progressCount=null;this.requestQueue=null;this.suppressedBoundingBoxListMap=null;this.treeNodes=null;this.nodeSidsForPartialTree=null;this.meshNodes=null;this.annotationNodeMap=null;this.parametricNodeMap=null;this.leaderLineMaterialIdMap=null;this.imageNoteMaterialIdMap=null;this.thumbnailViewMap=null;this.viewThumbnailMap=null;this.viewAnimatedThumbnailMap=null;this.replacedNodes=null;this.updatedNodes=null;this.viewIdTreeNodesMap=null;this.viewIdBoxMap=null;this.onActiveCameraCallbacks=null;this.onInitialSceneFinishedCallbacks=null;this.onPartialRetrievalFinishedCallbacks=null;this.onSceneCompletedCallbacks=null;this.onViewFinishedCallbacks=null;this.onSetPlaybackCallbacks=null;this.onContentChangesProgressCallbacks=null;this.onInitialViewCompletedCallbacks=null;};
S.prototype.logPerformance=function(n){if(this.progressLogger&&this.token){this.progressLogger.logPerformance(n,this.token);}};
S.prototype.setCameraSingle=function(c){this.sceneBuilder.createCamera(c,this.sceneId);return this.sceneBuilder.getCamera(c.id);};
S.prototype.getPartialTreeNodes=function(t){var p=[];var a=[];var i,j,b;if(t&&t.length){for(i=0;i<t.length;i++){b=t[i];if(b==null){continue;}if(b&&b.children){if(b.entityId!=null&&b.children.length===1){var r=b.children[0];var c=t[r];if(c.entityId==null){c.name=b.name;c.visualisable=false;}}if(b.children){for(j=0;j<b.children.length;j++){var d=b.children[j];t[d].parentNode=b;if(b.renderOrder){t[d].renderOrder=b.renderOrder;}}}}}}if(t&&t.length){for(i=0;i<t.length;i++){b=t[i];if(b==null){continue;}if(b.parent){p.push(b);}else if(!b.parentNode){p.push(b);if(this.rootNodeId){b.parent=this.rootNodeId;}}if(this.nodeSidsForPartialTree.has(b.sid)){a.push(b);}}}this.nodeSidsForPartialTree.clear();if(!a.length){return p;}p=[];for(j=0;j<a.length;j++){var n=a[j];var e=n.parentNode;while(e){if(this.sceneBuilder.getNode(e.sid,this.sceneId)){n.parent=e.sid;p.push(n);break;}else{n=e;e=e.parentNode;}}}return p.length?p:a;};
S.prototype.buildTree=function(a){var r={};if(!this.treeNodes||!this.treeNodes.length){r.error="no tree information";return r;}var t=this.treeNodes;var p=this.getPartialTreeNodes(t);this.replacedNodes.clear();var b=[];var i;var c;for(i=0;i<p.length;i++){c=p[i].parent;if(this.sceneBuilder.getNode(c,this.sceneId)){this.buildNode(p[i],c,true,a);}else{b.push(p[i]);}}for(i=0;i<b.length;i++){c=b[i].parent;if(this.sceneBuilder.getNode(c,this.sceneId)){this.buildNode(p[i],c,true,a);}else{r.error=(r.error||"")+"parent ${parentSid} does not exist in the scene. \n";}}if(this.retrievalType===S.RetrievalType.Partial){this.sceneBuilder.updateViewsForReplacedNodes(this.treeNodes);}this.treeNodes=[];this.progressCount.mesh.total=this.requestQueue.meshes.globalList.size;return r;};
S.prototype.buildNode=function(t,p,r,a){if(!t||!p){this.loader.reportError(this,"SceneContext - buildNode - invalid args");return null;}var e=this.sceneBuilder.getNode(t.sid,this.sceneId);if(e){this.sceneBuilder.remove(t.sid,this.sceneId);}if(t.suppressed===true){return null;}if(!t.sid){this.loader.reportError(this,"sid is missing in treeNode");return null;}t.parentId=p;this.sceneBuilder.createNode(t,this.sceneId);var b=t.parametricId;var m=t.meshId;if(b&&m){if(this.sceneBuilder.preferMeshes()){b=null;}else{m=null;}}if(b){if(this.parametricNodeMap.get(b)==null){this.parametricNodeMap.set(b,[t.sid]);this.requestQueue.parametric.push(b);}else{this.parametricNodeMap.get(b).push(t.sid);}}else if(m&&!this.sceneBuilder.hasMesh(m)){T.pushElementIntoMapArray(this.meshNodes,m,t.sid);if(this.loader.getSkipLowLODRendering()){this.requestQueue.geomMeshes.push(m,null,null,{id:m,isInitial:a});}else{this.requestQueue.meshes.push(m,{id:m,isInitial:a});}}if(t.annotationId){this.annotationNodeMap.set(t.annotationId,t.sid);this.requestQueue.annotations.push(t.annotationId);}var n=this.sceneBuilder.getNode(t.sid,this.sceneId);if(e&&n){this.replacedNodes.set(e,n);}if(r&&t.children){for(var i=0;i<t.children.length;i++){this.buildNode(this.treeNodes[t.children[i]],t.sid,r,a);}}return n;};
S.prototype.setTree=function(j){if(j.sid){var r=this.sceneBuilder.getNode(j.sid,this.sceneId);if(!r||r!==this.root){var a=this.root;a.userData.treeNode={sid:j.sid,name:this.root.name?this.root.name:"root"};a.userData.skipIt=!this.root.name;this.sceneBuilder.setRootNode(a,j.sid,this.sceneId,this.vkScene);this.rootNodeId=j.sid;}}if(j.camera){j.camera.id="initial";var c=this.setCameraSingle(j.camera);if(c){this.onActiveCameraCallbacks.execute(c);}}T.measure("setTreeMeasure-"+this.sceneId,"setTree-"+this.sceneId);};
S.prototype.setTreeNode=function(j){if(!Array.isArray(j.nodes)){return{error:"setTreeNode error: nodes are not properly defined"};}this.treeNodes=this.treeNodes.concat(j.nodes);return{};};
S.prototype.suppressSendRequests=function(){this.loader.setSuppressSendRequests(true);};
S.prototype.unsuppressSendRequests=function(){this.loader.setSuppressSendRequests(false);this.loader.sendRequest(this.requestQueue);};
S.prototype.notifyFinishedTree=function(c,i){this.buildTree(i);this.phase=S.Phase.FinishedHierarchy;this._fireProgress(S.ProgressPhase.FinishedTree);if(this.retrievalType===S.RetrievalType.Initial){this.onInitialSceneFinishedCallbacks.execute(this.initialView);}else if(this.retrievalType===S.RetrievalType.Partial){this.onPartialRetrievalFinishedCallbacks.execute();}this._checkSceneCompletion();};
S.prototype.setViewGroup=function(j){this.sceneBuilder.insertViewGroup(j,this.sceneId);if(!Array.isArray(j.views)){return;}var v=j.id;var i,a;if(!this.currentViewGroupId){if(this.currentViewId){for(i=0;i<j.views.length;i++){a=j.views[i];if(a.id===this.currentViewId){this.currentViewGroupId=v;break;}}}else{this.currentViewGroupId=v;}}if(this.currentViewGroupId!==v){return;}if(!this.currentViewId){this.currentViewId=j.views[0].id;}for(i=0;i<j.views.length;i++){a=j.views[i];var e=this.sceneBuilder.getView(a.id,this.sceneId);for(var t=0;t<2;t++){var p=["thumbnailId","animatedThumbnailId"][t];var b=a[p];if(b!==undefined){a[p]=b=b.toString();if(this.sceneBuilder.hasImage(b)){this.sceneBuilder.setViewThumbnail(b,a.id,this.sceneId);this.loader.onViewGroupUpdatedCallbacks.execute();}else{this.thumbnailViewMap.set(b,a.id);this.requestQueue.thumbnails.push(b,{imageId:b,viewId:a.id});}if(!e){this[["viewThumbnailMap","viewAnimatedThumbnailMap"][t]].set(a.id,b);}}}if(e){e.userData.viewInfo.thumbnailId=a.thumbnailId;e.userData.viewInfo.animatedThumbnailId=a.animatedThumbnailId;continue;}this.requestQueue.views.push(a.id,{viewId:a.id,viewGroupId:v});}if(!this.requestQueue.views.isWaiting()){this.sceneBuilder.finalizeViewGroups(this.sceneId);this.loader.onViewGroupUpdatedCallbacks.execute();if(this.requestQueue.sequences.isEmpty()){this.onViewGroupFinishedCallbacks.execute();}}T.measure("setViewGroupMeasure-"+v,"setViewGroup-"+v);};
S.prototype.setView=function(j){var v=j.viewId;this.viewIdBoxMap.set(v!==undefined?v:"default",j.box);if(!v){this.setTree(j);this.initialViewDecided=true;return;}if(!this.initialViewId&&!this.initialViewDecided){this.initialViewId=v;this.currentViewId=v;this.initialViewDecided=true;}var c;if(this.initialViewId===v){if(j.camera){c=j.camera.id;}this.setTree(j);}var t=this.viewThumbnailMap.get(v);if(t){this.viewThumbnailMap.delete(v);j.thumbnailId=t;}var a=this.viewAnimatedThumbnailMap.get(v);if(a){this.viewAnimatedThumbnailMap.delete(v);j.animatedThumbnailId=a;}this.sceneBuilder.insertView(j,this.sceneId);var b=[];this.viewIdTreeNodesMap.set(v,b);this.viewIdBoxMap.set(v,j.box);if(j.camera){if(c){j.camera.id=c;}this.setCameraSingle(j.camera);this.sceneBuilder.setViewCamera(j.camera.id,v,this.sceneId);}this.logPerformance("setView");T.measure("setViewMeasure-"+v,"setView-"+v);};
S.prototype.setViewNode=function(c,b,i){var r={context:this};if(!c.viewId){this.setTreeNode(c,i);return r;}if(this.initialViewId===c.viewId){this.setTreeNode(c,i);}var v=this.sceneBuilder.getView(c.viewId,c.sceneId);if(!v){r.error="setViewNode error: setViewNode - no setView was in the chain";return r;}if(this.initialViewId===c.viewId){this.initialView=v;}var t=this.viewIdTreeNodesMap.get(c.viewId);t=t.concat(c.nodes);this.viewIdTreeNodesMap.set(c.viewId,t);return r;};
S.prototype.notifyFinishedView=function(j){var v=j.viewId;if(!v){return this.notifyFinishedTree(j);}this.requestQueue.views.pop(v);if(this.initialViewId===v){this.notifyFinishedTree(j,true);this.initialViewId=null;}var a=this.sceneBuilder.getView(v,this.sceneId);if(!a){return{error:"notifyFinishedView error: setViewNode - no setView was in the chain"};}if(a.activeCameraId!==undefined){a.setCamera(this.sceneBuilder.getCamera(a.activeCameraId));}this.updatedNodes.clear();var b=this.buildView(v);this.sceneBuilder.setViewNodeInfos(b.nodeInfos,v,this.sceneId);a.updatedNodes=Array.from(this.updatedNodes);if(!this.requestQueue.views.isWaiting()){this.sceneBuilder.finalizeViewGroups(this.sceneId);this.loader.onViewGroupUpdatedCallbacks.execute();if(this.requestQueue.sequences.isEmpty()){this.onViewGroupFinishedCallbacks.execute();}}this.onViewFinishedCallbacks.execute(a);this.logPerformance("notifyFinishedView");};
S.prototype.buildView=function(v){var r={};this.treeNodes=this.viewIdTreeNodesMap.get(v);if(!this.treeNodes||!this.treeNodes.length){r.error="no tree information in view";return r;}var p=this.getPartialTreeNodes(this.treeNodes);var n=[];for(var i=0;i<p.length;i++){var a=p[i].parent;this.processNodeRecursively(v,p[i],n,a,true);}r.nodeInfos=n;this.treeNodes=[];this.viewIdTreeNodesMap.delete(v);return r;};
S.prototype.processNodeRecursively=function(v,t,n,p,a){var b=this.sceneBuilder.getNode(t.sid,this.sceneId);if(!b){b=this.buildNode(t,p,false);if(!b){return;}b.visible=false;}if(t.materialId){if(!this.sceneBuilder.checkMaterialExists(t.materialId,true)){this.requestQueue.materials.push(t.materialId);}}var c=t.visible!==undefined?t.visible:a;n.push({target:b,visible:c,materialId:t.materialId,opacity:t.opacity,meshId:t.meshId,transform:Array.isArray(t.transform)?T.arrayToColumnMajorMatrixArray16(t.transform):[1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0]});var d=this.treeNodes;var e=this.sceneBuilder.getChildNodeIds(t.sid,this.sceneId);var f=t.children?t.children.map(function(o){return d[o].sid;}):[];var h;var i;for(i=0;i<e.length;i++){h=e[i];for(var j=0;j<f.length;j++){if(h===f[j]){e[i]=undefined;break;}}}for(i=0;i<e.length;i++){var k=e[i];if(k!==undefined){var l=this.sceneBuilder.getNode(k,this.sceneId);var m=false;n.push({target:l,visible:m});}}if(t.children){for(i=0;i<t.children.length;i++){this.processNodeRecursively(v,d[t.children[i]],n,t.sid,c);}}if(t.highlightStyleId){this.sceneBuilder.recordHighlightedNodeInView(t.highlightStyleId,t.sid,v,this.sceneId);if(!this.sceneBuilder.highlightStyleExists(t.highlightStyleId)){this.requestQueue.highlights.push(t.highlightStyleId);}}};
S.prototype.setAnnotationSingle=function(a){var n=this.annotationNodeMap.get(a.id);if(n){a.nodeId=n;if(a.detailView||a.cutaway){this.sceneBuilder.createDetailView(a,this.sceneId);}else if(a.labelMaterialId||(a.label&&a.label.materialId)){var m=a.labelMaterialId||a.label.materialId;if(this.sceneBuilder.checkMaterialExists(m,false)){this.sceneBuilder.createImageNote(a,this.sceneId);}else{this.requestQueue.materials.push(m);T.pushElementIntoMapArray(this.imageNoteMaterialIdMap,m,a);}}else{this.sceneBuilder.createAnnotation(a,this.sceneId);var b=a.leaderLines;if(b){for(var i=0,l=b.length;i<l;i++){var c=b[i];c.annotationId=a.id;if(this.sceneBuilder.checkMaterialExists(c.materialId,false)){this.sceneBuilder.insertLeaderLine(c,this.sceneId);}else{this.requestQueue.materials.push(c.materialId);T.pushElementIntoMapArray(this.leaderLineMaterialIdMap,c.materialId,c);}}}}this.annotationNodeMap.delete(a.id);this.requestQueue.annotations.pop(a.id);}};
S.prototype.setCamera=function(j){if(!Array.isArray(j.cameras)){return{error:"setCamera error: cameras are not properly defined"};}j.cameras.forEach(this.setCameraSingle.bind(this));};
S.prototype.setMeshSingle=function(m){var a=m.id;var i,s,v;if(this.loader.getSkipLowLODRendering()){if(this.requestQueue.geomMeshes.pop(a)){if(this.meshNodes.get(a)){this.meshNodes.delete(a);}if(Array.isArray(m.submeshes)){for(i=0;i<m.submeshes.length;i++){s=m.submeshes[i];s.meshId=a;if(!this.sceneBuilder.checkMaterialExists(s.materialId,true)){this.requestQueue.materials.push(s.materialId);}v=this.viewIdBoxMap.has(this.currentViewId)?this.viewIdBoxMap.get(this.currentViewId):this.viewIdBoxMap.get("default");this.sceneBuilder.insertSubmesh(s,v);}}this.progressCount.mesh.count++;this._fireProgress(S.ProgressPhase.LoadingGeomMeshes);}return;}if(this.requestQueue.meshes.pop(a)){var b=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity];if(Array.isArray(m.submeshes)){for(i=0;i<m.submeshes.length;i++){s=m.submeshes[i];s.meshId=a;if(!this.sceneBuilder.checkMaterialExists(s.materialId,true)){this.requestQueue.materials.push(s.materialId);}v=this.viewIdBoxMap.has(this.currentViewId)?this.viewIdBoxMap.get(this.currentViewId):this.viewIdBoxMap.get("default");this.sceneBuilder.insertSubmesh(s,v);var l=s.lods;if(Array.isArray(l)){for(var c=0;c<l.length;c++){var d=l[c].boundingBox;if(Array.isArray(d)&&d.length===6){for(var j=0;j<6;++j){b[j]=j<3?Math.min(b[j],d[j]):Math.max(b[j],d[j]);}}}}}}var e={x:0,y:0,z:0};if(b[3]>=b[0]&&b[4]>=b[1]&&b[5]>=b[2]){e.x=b[3]-b[0];e.y=b[4]-b[1];e.z=b[5]-b[2];}var t=0;var f=this.meshNodes.get(a);if(f){this.meshNodes.delete(a);f.forEach(function(h){var k=this.sceneBuilder.getNode(h,this.sceneId);t+=k&&k.matrixWorld?k.matrixWorld.getMaxScaleOnAxis():1;}.bind(this));}this.requestQueue.geomMeshes.push(a,(e.x*e.y+e.y*e.z+e.z*e.x)*t,m.geometrySize||0);this.progressCount.mesh.count++;if(!this.requestQueue.meshes.isWaiting()){this.phase=S.Phase.FinishedMesh;this.logPerformance("meshFinished");this.progressCount.geometry.total=this.requestQueue.geometries.globalList.size;this._fireProgress(S.ProgressPhase.FinishedMeshes);}}else{this.requestQueue.geomMeshes.pop(a.toString());this._fireProgress(S.ProgressPhase.LoadingGeomMeshes);}};
S.prototype.setMesh=function(j,b){if(!Array.isArray(j.meshes)){return{error:"setMesh error: meshes are not properly defined"};}if(this.loader.getSkipLowLODRendering()){j.meshes.forEach(this.setMeshSingle.bind(this));}if(b){var d=new DataView(b.buffer,b.byteOffset,b.byteLength);var a=d.getUint16(2,true),o=0;while(a-->0&&o<b.byteLength){var c={sceneId:this.sceneId,id:d.getUint32(o+4,true).toString(),box:[d.getFloat32(o+14,true),d.getFloat32(o+18,true),d.getFloat32(o+22,true),d.getFloat32(o+26,true),d.getFloat32(o+30,true),d.getFloat32(o+34,true)]};var e=d.getUint16(o+12,true);o+=38;if(e!==3){c.flags=d.getUint16(o,true);c.quality=d.getFloat32(o+4,true);c.pointCount=d.getUint16(o+8,true);c.elementCount=d.getUint16(o+10,true);o+=14;}var f=d.getUint32(o,true);var h=b.subarray(o+4,o+4+f);o+=f;this.setGeometry(c,h);}}if(!this.loader.getSkipLowLODRendering()){j.meshes.forEach(this.setMeshSingle.bind(this));}T.measure("setMeshMeasure-"+this.sceneId,"setMesh-"+this.sceneId);this._checkSceneCompletion();};
S.prototype.setMaterialSingle=function(m,a){var b=m.id;this.requestQueue.materials.pop(b);var i;var t=this.sceneBuilder.createMaterial(m);for(i=0;i<t.length;i++){var c=t[i].imageId;this.requestQueue.textures.push(c,{imageId:c,materialId:b,isInitial:a});}var l=this.leaderLineMaterialIdMap.get(b);if(l){this.leaderLineMaterialIdMap.delete(b);for(i=0;i<l.length;i++){this.sceneBuilder.insertLeaderLine(l[i],this.sceneId);}}var d=this.imageNoteMaterialIdMap.get(b);if(d){this.imageNoteMaterialIdMap.delete(b);for(i=0;i<d.length;i++){this.sceneBuilder.createImageNote(d[i],this.sceneId);}}this.loader.onMaterialFinishedCallbacks.execute(b);};
S.prototype.setMaterial=function(j,b,i){if(!Array.isArray(j.materials)){return{error:"setMaterial error: materials are not properly defined"};}j.materials.forEach(function(m){this.setMaterialSingle(m,i);}.bind(this));T.measure("setMaterialMeasure-"+this.sceneId,"setMaterial-"+this.sceneId);this._fireProgress(S.ProgressPhase.FinishedMaterials);this._checkSceneCompletion();};
S.prototype.setGeometry=function(j,b){var a=j.id;this.requestQueue.geometries.pop(a);if(j.data&&!b){b=T.base64ToUint8Array(j.data);}if(!b||b.length===0){return{error:"setGeometry error: no data for geometry "+a};}var c=G.getGeometryInfo(j,b);if(!c){return{error:"setGeometry error: failed to parse geometry "+a+" data"};}this.sceneBuilder.setGeometry(c);this.loader.onSetGeometryCallbacks.execute({id:a});if(!this.requestQueue.geometries.isWaiting()){this.phase=S.Phase.FinishedGeometry;this.logPerformance("geometryFinished");}this.progressCount.geometry.count++;T.measure("setGeometryMeasure-"+a,"setGeometry-"+a);this._checkSceneCompletion();};
S.prototype.setImage=function(j,b){var i=j.id;if(!b){return{error:"setImage error: no image content for "+i};}j.binaryData=b;this.sceneBuilder.createImage(j);if(this.requestQueue.textures.pop(i)){L.info("Received texture image id: "+i);this.loader.onImageFinishedCallbacks.execute({id:i});this._fireProgress(S.ProgressPhase.FinishedTextures);this._checkSceneCompletion();}else if(this.requestQueue.thumbnails.pop(i)){var v=this.thumbnailViewMap.get(i);if(v){this.thumbnailViewMap.delete(i);this.sceneBuilder.setViewThumbnail(i,v,this.sceneId,j.tileWidth);this.loader.onViewGroupUpdatedCallbacks.execute();}}T.measure("setImageMeasure-"+i,"setImage-"+i);};
S.prototype.setAnnotation=function(j){if(!Array.isArray(j.annotations)){return{error:"setAnnotation error: annotations are not properly defined"};}j.annotations.forEach(this.setAnnotationSingle.bind(this));this._checkSceneCompletion();};
S.prototype.setHighlightStyle=function(j){j.id=j.id.toString();this.sceneBuilder.insertHighlightStyle(j);this.requestQueue.highlights.pop(j.id);};
S.prototype.setLineStyle=function(j){j.lineStyles.forEach(function(l){this.sceneBuilder.insertLineStyle(l);},this);};
S.prototype.setFillStyle=function(j){j.fillStyles.forEach(function(f){this.sceneBuilder.insertFillStyle(f);},this);};
S.prototype.setTextStyle=function(j){j.textStyles.forEach(function(t){this.sceneBuilder.insertTextStyle(t);},this);};
S.prototype.setParametric=function(a){for(var i=0;i<a.parametrics.length;i++){var p=a.parametrics[i];var b=p.id.toString();var n=this.parametricNodeMap.get(b);this.requestQueue.parametric.pop(b);this.parametricNodeMap.delete(b);for(var j=0;j<n.length;j++){if(p.shapes){p.shapes.forEach(function(s){if(s.materialID&&this.sceneBuilder.checkMaterialExists(s.materialID,false)===false){this.requestQueue.materials.push(s.materialID);}}.bind(this));}else if(p.materialID&&this.sceneBuilder.checkMaterialExists(p.materialID,false)===false){this.requestQueue.materials.push(p.materialID);}this.sceneBuilder.setParametricContent(n[j],p,this.sceneId);}}this._checkSceneCompletion();};
S.prototype.setPlayback=function(a){if(!Array.isArray(a.playbacks)){return{error:"setPlayback error: playbacks are not properly defined"};}var v=this.sceneBuilder.getView(a.viewId,this.sceneId);var o=false;var i,p;if(this.playbackIds){for(i=0;i<a.playbacks.length;i++){p=a.playbacks[i];for(var j=0;j<this.playbackIds.length;j++){if(p.id===this.playbackIds[j]){p.notLoading=false;break;}}if(p.notLoading===undefined){p.notLoading=true;}}delete this.playbackIds;o=true;if(!v.sortPlaybacks(true)){v.resetPlaybacksStartTimes(true);}}if(Array.isArray(a.joints)){this.sceneBuilder.insertJoints(a.joints,this.sceneId);}for(i=0;i<a.playbacks.length;i++){p=a.playbacks[i];if(p.notLoading){continue;}if(p.id==null){p.id=a.viewId+"-playback";p.sequence.id=a.viewId+"-cont";p.sequenceId=p.sequence.id;this.setSequence({sequences:[p.sequence]});}this.sceneBuilder.insertPlayback(p,a.viewId,this.sceneId);if(p.sequenceId){var e=this.sceneBuilder.getSequence(p.sequenceId);if(e){continue;}else{this.requestQueue.sequences.push(p.sequenceId);}}}if(!this.requestQueue.sequences.isEmpty()){this.loader.hasAnimation=true;}else{this.sceneBuilder.finalizeAnimation();this.sceneBuilder.finalizePlaybacks();this.loader.hasAnimation=false;if(o){this.onSetPlaybackCallbacks.execute(v);}}};
S.prototype.setSequenceSingle=function(s,t){var a=s.id;this.requestQueue.sequences.pop(a);function i(l){for(var m in l){if(l.hasOwnProperty(m)){return false;}}return true;}if(s.nodes){var n=[];for(var b=0;b<s.nodes.length;b++){var c=s.nodes[b];if(c.rotate||c.rrotate){var r;if(c.rotate){r=c.rotate;}else{r=c.rrotate;}var d={};if(r.trackId){d.trackId=r.trackId;}else if(t&&r.track!==undefined){d.trackId=t[r.track].id;}if(d.trackId){if(!t){this.requestQueue.tracks.push(d.trackId);}}d.sid=c.sid;d.binding="ROTATE";if(r.pivot){d.pivot=r.pivot;}if(c.rotate){d.isAbsoluteValue=true;}if(i(r)){d.empty=true;}n.push(d);}if(c.translate||c.rtranslate){var e;if(c.translate){e=c.translate;}else{e=c.rtranslate;}var f={};if(e.trackId){f.trackId=e.trackId;}else if(t&&e.track!==undefined){f.trackId=t[e.track].id;}if(f.trackId){if(!t){this.requestQueue.tracks.push(f.trackId);}}f.sid=c.sid;f.binding="TRANSLATE";if(e.pivot){f.pivot=e.pivot;}if(c.translate){f.isAbsoluteValue=true;}if(i(e)){f.empty=true;}n.push(f);}if(c.scale||c.rscale){var h;if(c.scale){h=c.scale;}else{h=c.rscale;}var j={};if(h.trackId){j.trackId=h.trackId;}else if(t&&h.track!==undefined){j.trackId=t[h.track].id;}if(j.trackId){if(!t){this.requestQueue.tracks.push(j.trackId);}}j.sid=c.sid;j.binding="SCALE";if(h.pivot){j.pivot=h.pivot;}if(c.scale){j.isAbsoluteValue=true;}if(i(h)){j.empty=true;}n.push(j);}if(c.opacity!==undefined||c.ropacity!==undefined){var o;if(c.opacity){o=c.opacity;}else{o=c.ropacity;}var k={};if(o.trackId){k.trackId=o.trackId;}else if(t&&o.track!==undefined){k.trackId=t[o.track].id;}if(k.trackId){if(!t){this.requestQueue.tracks.push(k.trackId);}}k.sid=c.sid;k.binding="OPACITY";if(c.opacity){k.isAbsoluteValue=true;}if(i(o)){k.empty=true;}n.push(k);}}s.nodes=n;}this.sceneBuilder.insertSequence(s,this.sceneId);};
S.prototype.setSequence=function(j){if(!Array.isArray(j.sequences)){return{error:"setSequence error: sequences are not properly defined"};}if(Array.isArray(j.joints)){this.sceneBuilder.insertJoints(j.joints,this.sceneId);}for(var i=0;i<j.sequences.length;i++){this.setSequenceSingle(j.sequences[i],j.tracks);}if(j.tracks){this.setTrack(j);}if(this.requestQueue.tracks.isEmpty()){this.loader.hasAnimation=false;this.loader.onSetSequenceCallbacks.execute();if(!this.requestQueue.views.isWaiting()){this.onViewGroupFinishedCallbacks.execute();}}};
S.prototype.setTrack=function(j){if(!Array.isArray(j.tracks)){return{error:"setTrack error: tracks are not properly defined"};}var t=[];for(var a=0;a<j.tracks.length;a++){var b=j.tracks[a];this.requestQueue.tracks.pop(b.id);b.times=b.time;if(b.vector3){b.values=b.vector3;}else if(b.quaternion){b.values=b.quaternion;b.rotateType=A.Quaternion;}else if(b.angleAxis){b.values=b.angleAxis;b.rotateType=A.AngleAxis;}else if(b.euler){b.values=b.euler;b.rotateType=A.Euler;}else if(b.scalar){b.values=b.scalar;}b.cyclicInfo={};b.cyclicInfo.cyclicStart=b.cyclicStart;b.cyclicInfo.cyclicEnd=b.cyclicEnd;t.push(b);}this.sceneBuilder.insertTracks(t);if(!this.requestQueue.tracks.isWaiting()){this.sceneBuilder.finalizeAnimation();this.sceneBuilder.finalizePlaybacks();this.loader.onSetTrackCallbacks.execute();if(!this.requestQueue.views.isWaiting()&&!this.requestQueue.sequences.isWaiting()){this.onViewGroupFinishedCallbacks.execute();}}};
S.prototype.notifyError=function(j){if(!j.error){j.error="Unknown error";}return j;};
return S;});
sap.ui.predefine('sap/ui/vk/totara/TotaraLoader',["sap/base/Log","./SceneContext","./CallbackHandler","./Command","./TotaraUtils","../helpers/WorkerScriptLoader"],function(L,S,C,a,T,W){"use strict";var b=T.mark;var c=function(){this._pushMesh=false;this._performanceTimingMsg=[];this._isPostable=true;this._suppressSendRequests=false;this._loadingFinishedSent=false;this.currentSceneInfo={};this.contextMap=new Map();this.tokenContextMap=new Map();this._skipLowLODRendering=false;this._maxUrlLength=2*1024;this._maxActiveRequests=4;this._meshesBatchSize=128;this._materialsBatchSize=128;this._geometriesBatchSize=128;this._geometriesMaxBatchDataSize=1024*1024;this._geomMeshesBatchSize=128;this._geomMeshesMaxBatchDataSize=1024*1024;this._annotationsBatchSize=128;this._tracksBatchSize=128;this._sequencesBatchSize=128;this._voxelThreshold=0.0;this.onErrorCallbacks=new C();this.onImageFinishedCallbacks=new C();this.onMaterialFinishedCallbacks=new C();this.onSetGeometryCallbacks=new C();this.onSetSequenceCallbacks=new C();this.onSetTrackCallbacks=new C();this.onViewGroupUpdatedCallbacks=new C();this.onLoadingFinishedCallbacks=new C();};
c.prototype.running=function(){return this._worker!==null&&this._worker!==undefined;};
c.prototype.run=function(){var t=this;return new Promise(function(r){if(!t._worker){t._worker=W.loadScript("sap/ui/vk/totara/TotaraLoaderWorker.js");t._worker.onmessage=function(e){var d;var f=e.data;if(f.ready){return;}f.jsonContent=f.jsonContent||{};if(f.jsonString){var j=JSON.parse(f.jsonString);delete f.jsonString;f.jsonContent=Object.assign(j,f.jsonContent);}if(f.name==="getAuthorization"){if(f.sceneId){d=t.getContext(f.sceneId);}if(d&&d.authorizationHandler){d.authorizationHandler(f.jsonContent.url).then(function(i){t.postMessage({"method":"setAuthorization","authorizationToken":i});}).catch(function(i){t.postMessage({"method":"setAuthorization","authorizationToken":null,"error":i.toString()});});}else{t.postMessage({"method":"setAuthorization","authorizationToken":null});}return;}if(f.name==="protocol"){t.protocolVersion=f.jsonContent.version.split(".").map(function(s){return parseInt(s,10);});return;}if(f.name==="batchSizeInfo"){var g=f.jsonContent.batchSizeInfo;var h=t.getContext(f.jsonContent.sceneId).requestQueue;h.meshes.setBatchSizeInfo(g[a.getMesh]);h.materials.setBatchSizeInfo(g[a.getMaterial]);h.geometries.setBatchSizeInfo(g[a.getGeometry]);h.geomMeshes.setBatchSizeInfo(g[a.getGeomMesh]);h.annotations.setBatchSizeInfo(g[a.getAnnotation]);h.tracks.setBatchSizeInfo(g[a.getTrack]);h.sequences.setBatchSizeInfo(g[a.getSequence]);return;}d=t.processCommand(f.name,f.jsonContent,f.binaryContent,f.isInitial);if(d){t.sendRequest(d.requestQueue);}};t._worker.onerror=function(e){};}});};
c.prototype.getUrl=function(){return this._url;};
c.prototype.setUrl=function(u){this._url=u;return this;};
c.prototype.getCorrelationId=function(){return this._correlationId;};
c.prototype.setCorrelationId=function(d){this._correlationId=d;return this;};
c.prototype.getSkipLowLODRendering=function(){return this._skipLowLODRendering;};
c.prototype.setSkipLowLODRendering=function(s){this._skipLowLODRendering=s;return this;};
c.prototype.getMaxUrlLength=function(){return this._maxUrlLength;};
c.prototype.setMaxUrlLength=function(m){this._maxUrlLength=m;return this;};
c.prototype.getMaxActiveRequests=function(){return this._maxActiveRequests;};
c.prototype.setMaxActiveRequests=function(m){this._maxActiveRequests=m;this.postMessage({method:a.setMaxActiveRequests,maxActiveRequests:m});};
c.prototype.getMeshesBatchSize=function(){return this._meshesBatchSize;};
c.prototype.setMeshesBatchSize=function(m){this._meshesBatchSize=m;return this;};
c.prototype.getMaterialsBatchSize=function(){return this._materialsBatchSize;};
c.prototype.setMaterialsBatchSize=function(m){this._materialsBatchSize=m;return this;};
c.prototype.getGeometriesBatchSize=function(){return this._geometriesBatchSize;};
c.prototype.setGeometriesBatchSize=function(g){this._geometriesBatchSize=g;return this;};
c.prototype.getGeometriesMaxBatchDataSize=function(){return this._geometriesMaxBatchDataSize;};
c.prototype.setGeometriesMaxBatchDataSize=function(g){this._geometriesMaxBatchDataSize=g;return this;};
c.prototype.getGeomMeshesBatchSize=function(){return this._geomMeshesBatchSize;};
c.prototype.setGeomMeshesBatchSize=function(g){this._geomMeshesBatchSize=g;return this;};
c.prototype.getGeomMeshesMaxBatchDataSize=function(){return this._geomMeshesMaxBatchDataSize;};
c.prototype.setGeomMeshesMaxBatchDataSize=function(g){this._geomMeshesMaxBatchDataSize=g;return this;};
c.prototype.getAnnotationsBatchSize=function(){return this._annotationsBatchSize;};
c.prototype.setAnnotationsBatchSize=function(d){this._annotationsBatchSize=d;return this;};
c.prototype.getTracksBatchSize=function(){return this._tracksBatchSize;};
c.prototype.setTracksBatchSize=function(t){this._tracksBatchSize=t;return this;};
c.prototype.getSequencesBatchSize=function(){return this._sequencesBatchSize;};
c.prototype.setSequencesBatchSize=function(s){this._sequencesBatchSize=s;return this;};
c.prototype.getVoxelThreshold=function(){return this._voxelThreshold;};
c.prototype.setVoxelThreshold=function(v){this._voxelThreshold=v;if(this.sceneBuilder){this.sceneBuilder.setVoxelThreshold(v);}return this;};
c.prototype.setSceneBuilder=function(s){this.sceneBuilder=s;this.sceneBuilder.setVoxelThreshold(this.getVoxelThreshold());};
c.prototype.dispose=function(){this.contextMap.forEach(function(d){d.dispose();});this.contextMap.clear();this.tokenContextMap.clear();this.postMessage({method:"close"});this._worker=undefined;this.currentSceneInfo=null;this.sceneBuilder.cleanup();this.sceneBuilder=null;this.onErrorCallbacks=null;this.onMaterialFinishedCallbacks=null;this.onImageFinishedCallbacks=null;this.onSetGeometryCallbacks=null;this.onSetTrackCallbacks=null;this.onSetSequenceCallbacks=null;};
c.prototype.cleanup=function(){this.currentSceneInfo={};this.contextMap.clear();this.tokenContextMap.clear();this.sceneBuilder.cleanup();};
c.prototype.enablePushMesh=function(e){this._pushMesh=e;};
c.prototype.getSceneBuilder=function(){return this.sceneBuilder;};
c.prototype.getContext=function(s){return this.contextMap.get(s);};
c.prototype.createContext=function(s,p){var d=new S(s,p,this);this.contextMap.set(s,d);this.tokenContextMap.set(d.requestQueue.token,d);if(d.onActiveCamera){d.onActiveCameraCallbacks.attach(d.onActiveCamera);delete d.onActiveCamera;}if(d.onInitialSceneFinished){d.onInitialSceneFinishedCallbacks.attach(d.onInitialSceneFinished);delete d.onInitialSceneFinished;}if(d.onPartialRetrievalFinished){d.onPartialRetrievalFinishedCallbacks.attach(d.onPartialRetrievalFinished);delete d.onPartialRetrievalFinished;}if(d.onViewFinished){d.onViewFinishedCallbacks.attach(d.onViewFinished);delete d.onViewFinished;}if(d.onSceneCompleted){d.onSceneCompletedCallbacks.attach(d.onSceneCompleted);delete d.onSceneCompleted;}if(d.onProgressChanged){d.setOnProgressChanged(d.onProgressChanged);delete d.onProgressChanged;}if(d.onLoadingFinished){this.onLoadingFinishedCallbacks.detachAll();this.onLoadingFinishedCallbacks.attach(d.onLoadingFinished);delete d.onLoadingFinished;}if(d.onContentChangesProgress){d.onContentChangesProgressCallbacks.attach(d.onContentChangesProgress);delete d.onContentChangesProgress;}if(d.onInitialViewCompleted){d.onInitialViewCompletedCallbacks.attach(d.onInitialViewCompleted);delete d.onInitialViewCompleted;}return d;};
c.prototype.isLoadingFinished=function(){var d=this.contextMap.values();var e=d.next();while(!e.done){if(!e.value.isLoadingFinished()){return false;}e=d.next();}return true;};
c.prototype.decrementResourceCountersForDeletedTreeNode=function(d,n){if(d){this.sceneBuilder.decrementResourceCountersForDeletedTreeNode(n,d.sceneId);}};
function l(d,n){if(d.progressLogger){d.progressLogger.logPerformance(n,d.token);}}
c.prototype.request=function(s,d,e){if(!d.root){throw"Context must include root where loaded objects are attached to";}var f=this.createContext(s,d);f.token=f.requestQueue.token;this.currentSceneInfo.id=s;f.retrievalType=S.RetrievalType.Initial;f.authorizationHandler=e;f.initialRequestTime=Date.now();if(f.enableLogger){T.createLogger(s,f,this);}f.includeHidden=d.includeHidden;f.includeBackground=d.includeBackground;f.includeParametric=d.includeParametric;f.includeAnimation=d.includeAnimation;f.selectField=d.$select;f.pushViewGroups=d.pushViewGroups;f.pushPMI=d.pushPMI;f.metadataFilter=d.metadataFilter;f.activateView=d.activateView;var g=T.createCommand(a.getScene,{sceneId:s});var m;if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){m=Math.min(2*1024,this.getMaxUrlLength());}else if(sap.ui.Device.browser.mobile){m=Math.min(8*1024,this.getMaxUrlLength());}else{m=Math.min(64*1024,this.getMaxUrlLength());}l(f,"modelRequested");b("modelRequested");this.postMessage({method:"initializeConnection",url:this.getUrl(),cid:this.getCorrelationId(),useSecureConnection:d.useSecureConnection,maxActiveRequests:this.getMaxActiveRequests(),token:f.token,command:g,sceneId:s,maxUrlLength:m});};
c.prototype.postMessage=function(m){if(this._worker){this._worker.postMessage(m);}};
c.prototype.processSetSceneCommand=function(j){var d=this.getContext(j.veid);if(d){d.defaultViewId=j.defaultViewId;d.defaultViewGroupId=j.defaultViewGroupId;d.sceneThumbnailId=j.imageId;d.dimension=j.dimension;d.defaultRootEntityId=j.defaultRootEntityId;if(d.defaultViewGroupId){d.currentViewGroupId=d.defaultViewGroupId;}var i=d.includeHidden!==undefined?d.includeHidden:true;var e=d.includeAnimation!==undefined?d.includeAnimation:true;var f=d.includeBackground!=null?d.includeBackground:true;var g=d.includeParametric!=null?d.includeParametric:true;var s=d.$select!==undefined?d.$select:"name,transform,meshId,annotationId,materialId,contentType,visible,opacity,renderOrder,entityId,highlightStyleId";var p=d.pushViewGroups!==undefined?d.pushViewGroups:true;var h="nodes,bounds,animation";if(!e){h="nodes,bounds";}var v={pushMaterials:true,pushMeshes:this._pushMesh,sceneId:d.sceneId,token:d.token,includeHidden:i,includeParametric:g,includeBackground:f,pushViewGroups:p,pushPMI:d.pushPMI||false,metadataFilter:d.metadataFilter,$select:s,$expand:h};v.context=d.sceneId;if(d.activateView){v.id=d.activateView;}else if(d.defaultViewId){v.id=d.defaultViewId;}if(v.id){d.initialViewId=v.id;d.currentViewId=v.id;d.initialViewDecided=true;}this.postMessage(T.createRequestCommand(a.getView,v,true));}};
c.prototype.update=function(s,d,v){this.currentSceneInfo.id=s;var e=this.getContext(s);if(!e){return Promise.reject("no context for ${sceneVeId}");}var t=this;return new Promise(function(r,f){e.nodeSidsForPartialTree=new Set(d);e.retrievalType=S.RetrievalType.Partial;var i=e.includeHidden!==undefined?e.includeHidden:true;var g=e.includeAnimation!==undefined?e.includeAnimation:true;var h=e.includeBackground!=null?e.includeBackground:true;var j=e.includeParametric!=null?e.includeParametric:true;var k=e.$select!==undefined?e.$select:"name,transform,meshId,annotationId,materialId,contentType,visible,opacity,renderOrder,entityId,highlightStyleId";var o={sceneId:s,token:e.token,pushMaterials:true,pushMeshes:t._pushMesh,filter:d.join(),includeAnimation:g,includeHidden:i,includeParametric:j,includeBackground:h,pushPMI:e.pushPMI||false,metadataFilter:e.metadataFilter,$select:k,breadcrumbs:true};if(v){o.activateView=v;}var m=T.createCommand(a.getTree,o);var n=function(){e.onPartialRetrievalFinishedCallbacks.detach(n);l(e,"updateFinished(mesh)");var p=[];var q=[];e.replacedNodes.forEach(function(x,y){q.push(x);p.push(y);});var u=p;var w=q;r({sceneVeId:s,sids:d,replacedNodeRefs:u,replacementNodeRefs:w});};e.onPartialRetrievalFinishedCallbacks.attach(n);l(e,"updateRequested");t.postMessage({method:"update",command:m});});};
c.prototype.requestViewGroup=function(s,v,i){if(!v){return Promise.reject("invalid arg: viewGroupId undefined");}var d=this.getContext(s);if(!d){return Promise.reject("no context for ${sceneVeId}");}if(i!==undefined){d.includeAnimation=i;}var t=this;var p=new Promise(function(r,e){var f=t.sceneBuilder.getViewGroup(v,s);if(f&&f.length){r(f);return;}var o={sceneId:s,id:v,token:d.token};var g=function(){d.onViewGroupFinishedCallbacks.detach(g);l(d,"onViewGroupFinished");var h=t.sceneBuilder.getViewGroup(v,s);if(h&&h.length){r(h);}else{e("no view ground data");}};d.onViewGroupFinishedCallbacks.attach(g);d.currentViewGroupId=v;t.postMessage(T.createRequestCommand(a.getViewGroups,o));});return p;};
c.prototype.requestView=function(s,v,d,p,i){this.currentSceneInfo.id=s;if(v!=="static"&&v!=="dynamic"){return Promise.reject("invalid arg: supported type - static, dynamic");}if(!d){return Promise.reject("invalid arg: viewId undefined");}var e=this.getContext(s);if(!e){return Promise.reject("no context for ${sceneVeId}");}e.currentViewId=d;var f=e.includeHidden!==undefined?e.includeHidden:true;var g=e.includeBackground!=null?e.includeBackground:true;var h=e.includeParametric!=null?e.includeParametric:true;var j;if(i){j=i;}else{j=e.includeAnimation!==undefined?e.includeAnimation:true;}var k=e.$select!==undefined?e.$select:"name,transform,meshId,annotationId,materialId,contentType,visible,opacity,renderOrder,entityId,highlightStyleId";var m="nodes,bounds,animation";if(!j){m="nodes,bounds";}this.hasAnimation=false;var t=this;var n=new Promise(function(r,o){var q,u;if(v==="static"){q=a.getView;u={sceneId:s,id:d,token:e.token,includeHidden:f,includeParametric:h,includeBackground:g,$select:k,$expand:m};if(p&&p.length){u.$expand="playback";e.playbackIds=p;}}else{q=a.getDynamicView;u={sceneId:s,type:d,token:e.token};}e.onSetPlaybackCallbacks.detachAll();var w=function(A){e.onSetPlaybackCallbacks.detach(w);l(e,"onSetPlayback");if(A){r(A);}else{o("no view data");}};e.onSetPlaybackCallbacks.attach(w);e.onViewFinishedCallbacks.detachAll();var x=function(A){e.onViewFinishedCallbacks.detach(x);l(e,"onViewFinished");if(!t.hasAnimation){if(A){r(A);}else{o("no view data");}}else{e.currentView=A;}};e.onViewFinishedCallbacks.attach(x);t.onSetSequenceCallbacks.detachAll();var y=function(){t.onSetSequenceCallbacks.detach(y);l(e,"onSetSequence");if(e.currentView){r(e.currentView);}};t.onSetSequenceCallbacks.attach(y);t.onSetTrackCallbacks.detachAll();var z=function(A){t.onSetTrackCallbacks.detach(z);l(e,"onSetTrack");if(e.currentView){r(e.currentView);}};t.onSetTrackCallbacks.attach(z);l(e,"viewRequested");t.postMessage(T.createRequestCommand(q,u));});return n;};
c.prototype.requestMaterial=function(s,d){if(!d){return Promise.reject("invalid arg: materialId undefined");}var e=this.getContext(s);if(!e){return Promise.reject("no context for ${sceneVeId}");}var t=this;var p=new Promise(function(r,f){var g=e.sceneBuilder.getMaterial(d);if(g){r(g);return;}e.requestQueue.materials.push(d);var i=function(j){var m=t.sceneBuilder.getMaterial(d);if(m&&!m.userData.imageIdsToLoad){t.onImageFinishedCallbacks.detach(i);r(m);}};var h=function(n){if(d!=n){return;}t.onMaterialFinishedCallbacks.detach(h);var m=t.sceneBuilder.getMaterial(d);if(!m){t.onImageFinishedCallbacks.detach(i);f("no material data");}if(m.userData.imageIdsToLoad){return;}t.onImageFinishedCallbacks.detach(i);r(m);};t.onMaterialFinishedCallbacks.attach(h);t.onImageFinishedCallbacks.attach(i);t.sendRequest(e.requestQueue);});return p;};
c.prototype.setSuppressSendRequests=function(s){this._suppressSendRequests=s;};
c.prototype.sendRequest=function(r){if(!this._worker||this._suppressSendRequests){return false;}var s=false;while(!r.isEmpty()){var n=r.generateRequestCommand();this.postMessage(n);s=true;}return s;};
c.prototype.timestamp=function(j){};
c.prototype.performanceTiming=function(j){};
c.prototype.checkError=function(j){if(!j){return true;}var r=j.result==="failure";if(r){if(j.message){j.error=j.message;delete j.message;}else{j.error="Unknown error";}}return r;};
c.prototype.reportError=function(d,e){this.onErrorCallbacks.execute({error:e,context:d});};
c.prototype.processContextCommand=function(d,n,j,e,i){if(!d){var f=n+" error: unknown context - "+JSON.stringify(j);this.contextMap.forEach(function(d){d[n].call(d,j,e);});return{error:f};}var r;try{r=d[n].call(d,j,e,i);}catch(g){r={error:g};}return r;};
c.prototype.processCommand=function(n,j,d,i){if(this.checkError(j)){if(n===a.setTree){if(j.events&&j.events.length){var e=j.events[0];if(e.values&&e.values.id){this.contextMap.delete(e.values.id);}}}this.onErrorCallbacks.execute(j);return null;}var f=null;if(j.sceneId!==undefined){f=this.getContext(j.sceneId);}else if(j.token!==undefined){f=this.tokenContextMap.get(j.token);}if(f){this.currentSceneInfo.id=f.sceneId;}this.setPerformance(n,j,f?f.sceneId:null);var r;switch(n){case a.setScene:this.processSetSceneCommand(j);break;case a.setTree:case a.setTreeNode:case a.notifyFinishedTree:case a.setView:case a.setViewNode:case a.setViewGroup:case a.notifyFinishedView:case a.setCamera:case a.setMesh:case a.setMaterial:case a.setGeometry:case a.setImage:case a.setAnnotation:case a.setLineStyle:case a.setFillStyle:case a.setTextStyle:case a.setParametric:case a.setPlayback:case a.setHighlightStyle:case a.setSequence:case a.setTrack:case a.suppressSendRequests:case a.unsuppressSendRequests:r=this.processContextCommand(f,n,j,d,i);break;case a.notifyError:r={error:j.errorText};break;case a.timestamp:r=this.timestamp(j);break;case a.performanceTiming:r=this.performanceTiming(j);break;default:r={error:"Unknown command: "+n};break;}if(this.isLoadingFinished()){if(n!==a.setScene&&n!==a.setView&&n!==a.setViewNode&&n!==a.timestamp&&n!==a.performanceTiming&&n!==a.suppressSendRequests&&n!==a.unsuppressSendRequests&&this._loadingFinishedSent===false){this.onLoadingFinishedCallbacks.execute();this._loadingFinishedSent=true;L.info("Loading is finished - all streaming requests are fulfilled.");}}else if(this._loadingFinishedSent){this._loadingFinishedSent=false;}if(r&&r.error){L.error(r.error);this.onErrorCallbacks.execute(r);}return f;};
c.prototype.setPerformance=function(n,j,s){var i;switch(n){case a.setGeometry:i=j.id;b("setGeometry-"+i);break;case a.setImage:i=j.id;b("setImage-"+i);break;case a.setView:i=j.viewId;b("setView-"+i);break;case a.setViewGroup:i=j.id;b("setViewGroup-"+i);break;case a.setMesh:b("setMesh-"+s);break;case a.setMaterial:b("setMaterial-"+s);break;case a.setTree:b("setTree-"+s);break;case a.performanceTiming:this._isPostable=true;this.postPerformanceTiming();break;default:break;}};
c.prototype.postPerformanceTiming=function(m){if(m){this._performanceTimingMsg.push(m);}if(this._isPostable&&this._performanceTimingMsg.length>0){this.postMessage(this._performanceTimingMsg.shift());this._isPostable=false;}};
c.prototype.printLogTokens=function(){this.contextMap.forEach(function(d,s){L.info("log tokens for scene => "+s);L.info("---------------------------------------");if(d.progressLogger){d.progressLogger.getTokens().forEach(function(t){L.info(t);});}L.info("---------------------------------------");});};
return c;});
sap.ui.predefine('sap/ui/vk/totara/TotaraUtils',["./Command"],function(C){"use strict";var T=function(){};
T.createCommand=function(c,o){var r=JSON.stringify(o);return c+("["+r.length+"]")+r;};
T.createRequestCommand=function(c,o,i){return{command:T.createCommand(c,o),method:c,isInitialView:(i?true:false)};};
function P(i,c,t){if(!i||!c||!t){throw"ProgressLogger: invalid args";}this.context=c;this.loader=t;var d=new Set();this.logPerformance=function(n,a){if(!n||!a){return;}d.add(a);var o={name:n,timestamp:Date.now(),token:a};var m={method:C.addClientLog,url:this.loader.getUrl(),authorizationHandler:c.authorizationHandler,token:c.token,command:T.createCommand(C.addClientLog,o)};this.loader.postMessage(m);};this.getTokens=function(){return d;};this.logPerformanceTiming=function(m,p){var e=this;m.sort(function(a,b){return a.timestamp-b.timestamp;});if(!m.length){return;}d.add(c.token);var f=[];while(m.length){f.push(m.splice(0,10));}f.forEach(function(a){var o={records:[],timestamp:Date.now()};a.forEach(function(h){o.records.push({name:h.name,timestamp:h.timestamp,uuid:h.uuid,duration:h.duration,value:h.value,parent_uuid:p});});var b=T.createCommand(C.performanceTiming,o);e.loader.postPerformanceTiming({method:C.performanceTiming,url:e.loader.getUrl(),authorizationHandler:c.authorizationHandler,token:c.token,command:b});});};}
T.mark=function(t){window.performance.mark(t);};
T.measure=function(n,s,e){var p=window.performance;if(performance.getEntriesByName(s).length!==0){if(!e){p.measure(n,s);}else{p.measure(n,s,e);}}p.clearMarks(s);if(e){p.clearMarks(e);}p.clearMeasures(n);};
T.perfObserve=function(c){if(!window.PerformanceObserver){return;}var _=[];var s;var a=performance.timing.navigationStart;var p=new window.PerformanceObserver(function(l){l.getEntries().forEach(function(e){e.uuid=T.generateToken();e.timestamp=a+e.startTime;if(e.name==="sceneMeasure"){s=e.uuid;}_.push(e);});if(_.find(function(b){return b.name==="sceneCompleted";})){T.measure("sceneMeasure","modelRequested","sceneCompleted");}if(s){_=_.filter(function(b){return b instanceof PerformanceMeasure;});c.progressLogger.logPerformanceTiming(_,s);s="";}});p.observe({entryTypes:["mark","measure"]});};
T.createLogger=function(i,c,a){if(!c){return null;}c.progressLogger=new P(i,c,a);T.perfObserve(c);return c.progressLogger;};
T.base64ToUint8Array=function(b){var a=atob(b);var l=a.length;var c=new Uint8Array(l);for(var i=0;i<l;i++){c[i]=a.charCodeAt(i);}return c;};
T.arrayToColumnMajorMatrixArray16=function(a){if(a.length===16){return[a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]];}if(a.length===12){return[a[0],a[3],a[6],a[9],a[1],a[4],a[7],a[10],a[2],a[5],a[8],a[11],0.0,0.0,0.0,1.0];}if(a.length===3){return[1,0,0,a[0],0,1,0,a[1],0,0,1,a[2],0,0,0,1];}return null;};
T.pushElementIntoMapArray=function(m,k,e){var a=m.get(k);if(!a){a=[];m.set(k,a);}else if(a.length>0&&a[a.length-1]===e){return;}a.push(e);};
T.generateToken=function(){return g();};
function g(){function s(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);}return s()+s()+"-"+s()+"-"+s()+"-"+s()+"-"+s()+s()+s();}
return T;});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine('sap/ui/vk/ContainerBase',["./library","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/core/Popup","sap/ui/core/ResizeHandler","sap/ui/core/delegate/ScrollEnablement","sap/ui/Device","sap/m/library","./ContainerBaseRenderer","./MapContainerButtonType","./getResourceBundle","sap/base/util/uid","sap/base/Log"],function(v,C,I,P,R,S,D,m,a,M,g,u,L){"use strict";
var b=C.extend("sap.ui.vk.ContainerBase",{metadata:{library:"sap.ui.vk",properties:{"showFullScreen":{type:"boolean",group:"Misc",defaultValue:true},"showSettings":{type:"boolean",group:"Misc",defaultValue:true},"showSelection":{type:"boolean",group:"Misc",defaultValue:true},"fullScreen":{type:"boolean",group:"Misc",defaultValue:false},"title":{type:"string",group:"Misc",defaultValue:""},"autoAdjustHeight":{type:"boolean",group:"Misc",defaultValue:false}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.vk.ContainerContent",multiple:true,singularName:"content"},"toolbar":{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{"contentChange":{parameters:{selectedItemId:"string"}},"settingsPressed":{}}}});
b.prototype.switchContent=function(c){this.setSelectedContent(c);this.rerender();};
b.prototype.updateContainer=function(){this._contentChanged=true;this.rerender();};
b.prototype.setSelectedContent=function(c){this._oSelectedContent=c;};
b.prototype.getSelectedContent=function(){return this._oSelectedContent;};
b.prototype.init=function(){this._selectionState="SINGLE";this._firstTime=true;this._aContentIcons=[];this._selectedContent=null;this._oSelectedContent=null;this._bSegmentedButtonSaveSelectState=false;this._oMenu=null;this._customButtons=[];var l=new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.High});var c=sap.m.ButtonType.Transparent;this._oFullScreenButton=new sap.m.OverflowToolbarButton({layoutData:l,type:c,icon:"sap-icon://full-screen",text:g().getText("CONTAINERBASE_FULLSCREEN"),tooltip:g().getText("CONTAINERBASE_FULLSCREEN"),press:function(){this._bSegmentedButtonSaveSelectState=true;this._toggleFullScreen();}.bind(this)});this._oSettingsButton=new sap.m.OverflowToolbarButton({layoutData:l.clone(),type:c,icon:"sap-icon://action-settings",text:g().getText("CONTAINERBASE_SETTINGS"),tooltip:g().getText("CONTAINERBASE_SETTINGS"),press:function(){this._bSegmentedButtonSaveSelectState=true;this.fireSettingsPressed();}.bind(this)});this._oSelectionButtonSingle=new sap.m.SegmentedButtonItem({icon:"sap-icon://map-container/selection-single",tooltip:g().getText("CONTAINERBASE_MENU_SINGLE"),press:this._handleSelection.bind(this,"SINGLE")});this._oSelectionButtonRectangle=new sap.m.SegmentedButtonItem({icon:"sap-icon://map-container/selection-rectangle",tooltip:g().getText("CONTAINERBASE_MENU_RECT"),press:this._handleSelection.bind(this,"RECT")});this._oSelectionButtonLasso=new sap.m.SegmentedButtonItem({icon:"sap-icon://map-container/selection-lasso",tooltip:g().getText("CONTAINERBASE_MENU_LASSO"),press:this._handleSelection.bind(this,"LASSO")});this._selectionMenu=new sap.m.SegmentedButton({items:[this._oSelectionButtonSingle,this._oSelectionButtonRectangle,this._oSelectionButtonLasso]});this._oPopup=new P({modal:true,shadow:false,autoClose:false});this._oContentSegmentedButton=new sap.m.SegmentedButton({layoutData:l.clone(),select:this._onContentButtonSelect.bind(this)});this._oContTitle=new sap.m.Label();this._oToolbar=new sap.m.OverflowToolbar({width:"auto"}).addStyleClass("sapUiVkContainerBaseToolbar");this.setAggregation("toolbar",this._oToolbar);this.sResizeListenerId=null;if(D.system.desktop){this.sResizeListenerId=R.register(this,jQuery.proxy(this._performHeightChanges,this));}else{D.orientation.attachHandler(this._performHeightChanges,this);D.resize.attachHandler(this._performHeightChanges,this);}var d=[{name:"selection-lasso",unicode:"E000"},{name:"selection-rectangle",unicode:"E001"},{name:"selection-single",unicode:"E002"}],e="map-container",f="map-container";d.forEach(function(i){I.addIcon(i.name,e,f,i.unicode);});};
b.prototype.exit=function(){if(this._oFullScreenButton){this._oFullScreenButton.destroy();this._oFullScreenButton=undefined;}if(this._oPopup){this._oPopup.destroy();this._oPopup=undefined;}if(this._oContentSegmentedButton){this._oContentSegmentedButton.destroy();this._oContentSegmentedButton=undefined;}if(this._oSelectedContent){this._oSelectedContent.destroy();this._oSelectedContent=undefined;}if(this._oToolbar){this._oToolbar.destroy();this._oToolbar=undefined;}if(D.system.desktop&&this.sResizeListenerId){R.deregister(this.sResizeListenerId);this.sResizeListenerId=null;}else{D.orientation.detachHandler(this._performHeightChanges,this);D.resize.detachHandler(this._performHeightChanges,this);}};
b.prototype.setFullScreen=function(f){if(this._firstTime){return;}if(this.getFullScreen()==f){return;}var c=this.getProperty("fullScreen");if(c!==f){this._toggleFullScreen();}};
b.prototype.onAfterRendering=function(){var t=this;if((this.sResizeListenerId===null)&&(D.system.desktop)){this.sResizeListenerId=R.register(this,jQuery.proxy(this._performHeightChanges,this));}if(this.getAutoAdjustHeight()||this.getFullScreen()){setTimeout(function(){t._performHeightChanges();},500);}this._firstTime=false;if(this.getSelectedContent()!==null){var c=this.getSelectedContent().getContent();if(c instanceof sap.ui.vbm.GeoMap||c instanceof sap.ui.vbm.AnalyticMap){if(this.getShowSelection()){if(this._selectionState==="LASSO"){c.setLassoSelection(true);}else if(this._selectionState==="RECT"){c.setRectangularSelection(true);}else if(this._selectionState==="SINGLE"){c.setRectangularSelection(false);c.setLassoSelection(false);}}}}};
b.prototype.onBeforeRendering=function(){var t=this;if(t._contentChanged){t._contentChange();}t._oToolbar.getContent().forEach(function(e){var c=e.getId();var d=e["getPressed"]?e.getPressed():null;for(var i in t._customButtons){if(t._customButtons[i].button&&t._customButtons[i].button.getId()==c){t._customButtons[i].toggled=d;}}});t._oToolbar.removeAllContent();t._addToolbarContent();};
b.prototype.setTitle=function(V){this._oContTitle.setText(V);this.setProperty("title",V,true);};
b.prototype.addContent=function(o){this.addAggregation("content",o);this._contentChanged=true;};
b.prototype.insertContent=function(o,i){this.insertAggregation("content",o,i);this._contentChanged=true;};
b.prototype.updateContent=function(){this.updateAggregation("content");this._contentChanged=true;};
b.prototype._toggleFullScreen=function(){var f=this.getProperty("fullScreen");var s;var h;var c;if(f){this._closeFullScreen();this.setProperty("fullScreen",false,true);c=this.getSelectedContent().getContent();s=c.getId();c.setWidth("100%");h=this._contentHeight[s];if(h){c.setHeight(h);}this.invalidate();}else{var o=this.getAggregation("content");this._contentHeight={};if(o){for(var i=0;i<o.length;i++){c=o[i].getContent();s=c.getId();if(jQuery.isFunction(c.getHeight)){h=c.getHeight();}else{h=0;}this._contentHeight[s]=h;}}this._openFullScreen(true);this.setProperty("fullScreen",true,true);}var d=(f?"sap-icon://full-screen":"sap-icon://exit-full-screen");this._oFullScreenButton.setIcon(d);this._oFullScreenButton.focus();};
b.prototype._openFullScreen=function(n){if((n!==null)&&(n===true)){this._oScrollEnablement=new S(this,this.getId()+"-wrapper",{horizontal:true,vertical:true});}this.$content=this.$();if(this.$content){this.$tempNode=jQuery("<div></div>");this.$content.before(this.$tempNode);this._$overlay=jQuery("<div id='"+u()+"'></div>");this._$overlay.addClass("sapUiVkContainerBaseOverlay");this._$overlay.append(this.$content);this._oPopup.setContent(this._$overlay);}else{L.warning("Overlay: content does not exist or contains more than one child");}this._oPopup.open(200,undefined,undefined,jQuery("body"));};
b.prototype._closeFullScreen=function(){if(this._oScrollEnablement!==null){this._oScrollEnablement.destroy();this._oScrollEnablement=null;}this.$tempNode.replaceWith(this.$content);this._oToolbar.setDesign(sap.m.ToolbarDesign.Auto);this._oPopup.close();this._$overlay.remove();};
b.prototype._performHeightChanges=function(){if(this.getAutoAdjustHeight()||this.getFullScreen()){var $=this.$();if(($.find(".sapUiVkContainerBaseToolbarArea").children()[0])&&($.find(".sapUiVkContainerBaseContentArea").children()[0])){var o=this.getSelectedContent().getContent();if(o.getDomRef().offsetWidth!==this.getDomRef().clientWidth){this.rerender();}}}};
b.prototype._switchContent=function(c){var o=this._findContentById(c);this.setSelectedContent(o);this.fireContentChange({selectedItemId:c});this.rerender();};
b.prototype._contentChange=function(){var c=this.getContent();this._oContentSegmentedButton.removeAllButtons();this._destroyButtons(this._aContentIcons);this._aContentIcons=[];if(c.length===0){this._oContentSegmentedButton.removeAllButtons();this._setDefaultOnSegmentedButton();this.switchContent(null);}if(c){for(var i=0;i<c.length;i++){var d=c[i].getContent();if(d.setWidth){d.setWidth("100%");}var B=new sap.m.SegmentedButtonItem({icon:c[i].getIcon(),tooltip:c[i].getTitle(),key:d.getId()});this._aContentIcons.push(B);this._oContentSegmentedButton.addItem(B);if(i===0){this.setSelectedContent(c[i]);}}}this._contentChanged=false;};
b.prototype._onContentButtonSelect=function(e){var c=e.getParameter("key");this._switchContent(c);};
b.prototype._findContentById=function(s){var c=null;var o=this.getAggregation("content");if(o){for(var i=0;!c&&i<o.length;i++){if(o[i].getContent().getId()===s){c=o[i];}}}return c;};
b.prototype._addToolbarContent=function(){this._oToolbar.addContent(new sap.m.ToolbarSpacer());if(this._aContentIcons.length>1){this._oToolbar.addContent(this._oContentSegmentedButton);}if(this.getSelectedContent()!==null){var c=this.getSelectedContent().getContent();if(c instanceof sap.ui.vbm.GeoMap||c instanceof sap.ui.vbm.AnalyticMap){if(this.getShowSelection()){this._oToolbar.addContent(this._selectionMenu);}}}this._customButtons.forEach(function(i){if(i.visible){var s={type:sap.m.ButtonType.Transparent,layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.High})};if("active"in i){s.enabled=i.active;}if("icon"in i){s.icon=i.icon;}if("activeIcon"in i){s.activeIcon=i.activeIcon;}if("text"in i){s.text=i.text;}if("tooltip"in i){s.tooltip=i.tooltip;}if("press"in i){s.press=i.press;}if("toggled"in i){s.pressed=i.toggled;}if("overflow"in i){s.overflow=i.overflow;}switch(i.type){case M.Click:i.button=s.overflow?new sap.m.OverflowToolbarButton(s):new sap.m.Button(s);break;default:i.button=s.overflow?new sap.m.OverflowToolbarToggleButton(s):new sap.m.ToggleButton(s);break;}this._oToolbar.addContent(i.button);}},this);if(this.getShowSettings()){this._oToolbar.addContent(this._oSettingsButton);}if(!D.system.phone&&this.getShowFullScreen()){this._oToolbar.addContent(this._oFullScreenButton);}};
b.prototype._setDefaultOnSegmentedButton=function(){if(!this._bSegmentedButtonSaveSelectState){this._oContentSegmentedButton.setSelectedButton(null);}this._bSegmentedButtonSaveSelectState=false;};
b.prototype._destroyButtons=function(c){c.forEach(function(B){B.destroy();});};
b.prototype._handleSelection=function(c){var d=this.getSelectedContent().getContent();if(d instanceof sap.ui.vbm.GeoMap||d instanceof sap.ui.vbm.AnalyticMap){if(c==="LASSO"){d.setLassoSelection(true);this._selectionState=c;}else if(c==="RECT"){d.setRectangularSelection(true);this._selectionState=c;}else if(c==="SINGLE"){d.setRectangularSelection(false);d.setLassoSelection(false);this._selectionState=c;}}};
return b;});
sap.ui.predefine('sap/ui/vk/ContainerBaseRenderer',function(){"use strict";var C={};
C.render=function(r,c){var t=c.getTooltip_AsString();var T=c.getTitle();var l=c.getAriaLabelledBy();var d=c.getAriaDescribedBy();r.write("<div");r.writeControlData(c);r.writeAttribute("role",sap.ui.core.AccessibleRole.Group);if(T){r.writeAttributeEscaped("aria-label",T);}else if(t){r.writeAttributeEscaped("aria-label",t);}if(l&&l.length>0){r.writeAttributeEscaped("aria-labelledby",l.join(" "));}if(d&&d.length>0){r.writeAttributeEscaped("aria-describedby",d.join(" "));}r.addClass("sapUiVkContainerBase");r.writeClasses(c);r.write(">");r.write("<div");r.writeAttributeEscaped("id",c.getId()+"-wrapper");r.writeAttribute("role",sap.ui.core.AccessibleRole.Presentation);r.addClass("sapUiVkContainerBaseWrapper");r.writeClasses();r.write(">");this.writeContentArea(r,c);this.writeToolbarArea(r,c);r.write("</div>");r.write("</div>");};
C.writeContentArea=function(r,c){var s=c.getSelectedContent();r.write("<div");r.addClass("sapUiVkContainerBaseContentArea");r.writeAttribute("role",sap.ui.core.AccessibleRole.Img);r.writeClasses();r.write(">");if(s!==null){r.renderControl(s);}else if(c.getContent().length>0){s=c.getContent()[0];r.renderControl(s);}r.write("</div>");};
C.writeToolbarArea=function(r,c){r.write("<div");r.addClass("sapUiVkContainerBaseToolbarArea");r.writeAttribute("role",sap.ui.core.AccessibleRole.Group);r.writeClasses();r.write(">");r.renderControl(c._oToolbar);r.write("</div>");};
return C;},true);
sap.ui.predefine('sap/ui/vk/ContainerContent',["./library","sap/ui/core/Control","./ContainerContentRenderer"],function(v,C,a){"use strict";
var b=C.extend("sap.ui.vk.ContainerContent",{metadata:{library:"sap.ui.vk",properties:{"icon":{type:"string",group:"Misc",defaultValue:null},"title":{type:"string",group:"Misc",defaultValue:null}},aggregations:{"content":{type:"sap.ui.core.Control",multiple:false}}}});
b.prototype.setContent=function(c){if(c instanceof sap.ui.vbm.GeoMap){c.setNavcontrolVisible(false);c.setWidth("100%");c.setHeight("100%");}this.setAggregation("content",c);return this;};
return b;});
sap.ui.predefine('sap/ui/vk/ContainerContentRenderer',function(){"use strict";var C={};
C.render=function(r,c){r.renderControl(c.getContent());};
return C;},true);
sap.ui.predefine('sap/ui/vk/LegendItem',["sap/m/StandardListItem","./LegendItemRenderer"],function(S,L){"use strict";
var a=S.extend("sap.ui.vk.LegendItem",{metadata:{library:"sap.ui.vk",properties:{color:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:null},semanticSpotType:{type:"sap.ui.vbm.SemanticType",group:"Behavior",defaultValue:null}},aggregations:{}}});
return a;});
sap.ui.predefine('sap/ui/vk/LegendItemRenderer',["sap/m/StandardListItemRenderer","sap/ui/core/Renderer"],function(B,R){"use strict";var L=R.extend(B);
L.renderLIContent=function(r,c){var s=c.getColor();var t=c.getSemanticSpotType();var i=null;if(s){r.write("<span");r.addClass("sapUiVkLegendItemSquare");r.addStyle("background-color",s);r.writeStyles();r.writeClasses();r.write(">");r.write("</span>");}if(t){switch(t){case sap.ui.vbm.SemanticType.Error:i=sap.ui.require.toUrl("sap/ui/vbm/themes/base/img/Pin_Red.png");break;case sap.ui.vbm.SemanticType.Warning:i=sap.ui.require.toUrl("sap/ui/vbm/themes/base/img/Pin_Orange.png");break;case sap.ui.vbm.SemanticType.Success:i=sap.ui.require.toUrl("sap/ui/vbm/themes/base/img/Pin_Green.png");break;case sap.ui.vbm.SemanticType.Default:i=sap.ui.require.toUrl("sap/ui/vbm/themes/base/img/Pin_Blue.png");break;case sap.ui.vbm.SemanticType.Inactive:i=sap.ui.require.toUrl("sap/ui/vbm/themes/base/img/Pin_Grey.png");break;default:break;}if(i){c.addStyleClass("sapUiVkLegendItemSpotType");c.setIcon(i);}}B.renderLIContent(r,c);};
return L;},true);
sap.ui.predefine('sap/ui/vk/ListPanel',["./library","sap/ui/core/Control","sap/m/library","./ListPanelRenderer"],function(v,C,m,L){"use strict";
var a=C.extend("sap.ui.vk.ListPanel",{metadata:{library:"sap.ui.vk",properties:{"headerText":{type:"string",group:"Misc"},"headerIcon":{type:"sap.ui.core.URI",group:"Misc"},"expanded":{type:"boolean",group:"Misc",defaultValue:true},"expandAnimation":{type:"boolean",group:"Misc",defaultValue:true},"selectionMode":{type:"sap.m.ListMode",group:"Misc",defaultValue:sap.m.ListMode.MultiSelect}},aggregations:{"items":{type:"sap.m.ListItemBase",multiple:true,singularName:"item"},"panel":{type:"sap.m.Panel",multiple:false,visibility:"hidden"}},events:{headerIconPress:{},expand:{},selectionChange:{parameters:{listItem:{type:"sap.m.ListItemBase"},listItems:{type:"sap.m.ListItemBase[]"},selected:{type:"boolean"}}},itemPress:{parameters:{listItem:{type:"sap.m.ListItemBase"},srcControl:{type:"sap.ui.core.Control"}}}}}});
a.prototype.getSelectedItem=function(){return this._oList.getSelectedItem();};
a.prototype.setSelectedItem=function(l,s,f){this._oList.setSelectedItem(l,s,f);};
a.prototype.getSelectedItems=function(){return this._oList.getSelectedItems();};
a.prototype.init=function(){this._oList=new sap.m.ListBase({mode:this.getSelectionMode(),itemPress:this.fireItemPress.bind(this),selectionChange:this.fireSelectionChange.bind(this)});this._oPanel=new sap.m.Panel({expandable:true,expanded:true,expandAnimation:true,headerToolbar:new sap.m.Toolbar({active:false}),content:[this._oList],expand:this.fireExpand.bind(this)});this._oPanel.getHeaderToolbar().addStyleClass("sapUiVkLPTb");this.setAggregation("panel",this._oPanel,true);this._oHeaderIcon=null;this._oHeaderText=null;this._bHeaderToolbarChanged=true;};
a.prototype.exit=function(){this._destroyControl(this._oList);this._destroyControl(this._oPanel);this._destroyControl(this._oHeaderIcon);this._destroyControl(this._oHeaderText);};
a.prototype.getItems=function(){return this._oList.getItems();};
a.prototype.addItem=function(o){return this._oList.addItem(o);};
a.prototype.insertItem=function(o,i){return this._oList.insertItem(o,i);};
a.prototype.removeItem=function(o){return this._oList.removeItem(o);};
a.prototype.removeAllItems=function(){return this._oList.removeAllItems();};
a.prototype.setHeaderText=function(b){if(!this._oHeaderText){this._oHeaderText=new sap.m.Title();}this._oHeaderText.setText(b);this._bHeaderToolbarChanged=true;if(this._oHeaderIcon){this._oHeaderIcon.setTooltip(b);this._oHeaderIcon.addAriaLabelledBy(this._oHeaderText);this._oHeaderIcon.addAriaDescribedBy(this._oHeaderText);}return this.setProperty("headerText",b);};
a.prototype.getExpanded=function(){return this._oPanel.getExpanded();};
a.prototype.setExpanded=function(b){return this._oPanel.setExpanded(b);};
a.prototype.getExpandAnimation=function(){return this._oPanel.getExpandAnimation();};
a.prototype.setExpandAnimation=function(b){return this._oPanel.setExpandAnimation(b);};
a.prototype.setHeaderIcon=function(b){if(!this._oHeaderIcon){this._oHeaderIcon=new sap.m.Button({press:this.fireHeaderIconPress.bind(this),type:sap.m.ButtonType.Transparent,tooltip:this.getHeaderText()});}this._oHeaderIcon.setIcon(b);this._bHeaderToolbarChanged=true;if(this._oHeaderText){this._oHeaderIcon.addAriaLabelledBy(this._oHeaderText);this._oHeaderIcon.addAriaDescribedBy(this._oHeaderText);}return this.setProperty("headerIcon",b);};
a.prototype.setSelectionMode=function(b){this._oList.setMode(b);return this.setProperty("selectionMode",b);};
a.prototype.onBeforeRendering=function(){if(this._bHeaderToolbarChanged){var t=this._oPanel.getHeaderToolbar();t.removeAllContent();if(this._oHeaderIcon){t.addContent(this._oHeaderIcon);}if(this._oHeaderText){t.addContent(this._oHeaderText);}this._bHeaderToolbarChanged=false;}};
a.prototype._destroyControl=function(c){if(c){c.destroy();c=undefined;}};
return a;});
sap.ui.predefine('sap/ui/vk/ListPanelRenderer',function(){"use strict";var L={};
L.render=function(r,c){var p=c._oPanel;p.addStyleClass("sapUiVkListPanel");r.write("<div");r.writeControlData(c);r.writeAttribute("role",sap.ui.core.AccessibleRole.Presentation);r.write(">");r.renderControl(p);r.write("</div>");};
return L;},true);
sap.ui.predefine('sap/ui/vk/ListPanelStack',["./library","sap/ui/core/Control","sap/ui/layout/library","./ListPanelStackRenderer"],function(v,C,l,L){"use strict";
var a=C.extend("sap.ui.vk.ListPanelStack",{metadata:{library:"sap.ui.vk",properties:{"width":{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"100%"},"expanded":{type:"boolean",group:"Misc",defaultValue:true},"expandAnimation":{type:"boolean",group:"Misc",defaultValue:true},"collapsible":{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{"content":{type:"sap.ui.vk.ListPanel",multiple:true,singularName:"content"},"layout":{type:"sap.ui.layout.VerticalLayout",multiple:false,visibility:"hidden"}}}});
a.prototype.init=function(){this._oLayout=new sap.ui.layout.VerticalLayout();this._oLayout.addStyleClass("sapUiVkLPSTrans");this.setAggregation("layout",this._oLayout,true);this._bFirstTime=true;};
a.prototype.exit=function(){if(this._oLayout){this._oLayout.destroy();this._oLayout=undefined;}};
a.prototype.getContent=function(){return this._oLayout.getContent();};
a.prototype.addContent=function(o){o.attachExpand(this._onContentExpand.bind(this));o.attachHeaderIconPress(this._onContentHeaderIconPress.bind(this));return this._oLayout.addContent(o);};
a.prototype.removeContent=function(o){return this._oLayout.removeContent(o);};
a.prototype.insertContent=function(o,i){return this._oLayout.insertContent(o,i);};
a.prototype.removeAllContent=function(){return this._oLayout.removeAllContent();};
a.prototype.getWidth=function(){return this._oLayout.getWidth();};
a.prototype.setWidth=function(b){this.setProperty("width",b,true);return this._oLayout.setWidth(b);};
a.prototype.setExpanded=function(b){if(b!=this.getExpanded()){if(b){this._expand();}else{this._collapse();}}return this;};
a.prototype.setExpandAnimation=function(b){this._oLayout.removeStyleClass("sapUiVkLPSTrans");if(b){this._oLayout.addStyleClass("sapUiVkLPSTrans");}return this.setProperty("expandAnimation",b,true);};
a.prototype.onBeforeRendering=function(){if(this._bFirstTime){var e=false;var c=this.getContent();for(var i=0;i<c.length;++i){if(c[i].getExpanded()){e=true;}}this.setExpanded(e);this._bFirstTime=false;}};
a.prototype.onAfterRendering=function(){if(!this.getExpanded()){this._updateCollapsedLayoutWidth();}};
a.prototype._onContentExpand=function(e){var b=false;var c=this._oLayout.getContent();for(var i=0;i<c.length;++i){if(c[i].getExpanded()){b=true;}}this.setExpanded(b);};
a.prototype._onContentHeaderIconPress=function(e){var b=e.oSource.getExpanded()?false:true;e.oSource.setExpanded(b);var E=false;var c=this._oLayout.getContent();for(var i=0;i<c.length;++i){if(c[i].getExpanded()){E=true;break;}}this.setExpanded(E);};
a.prototype._expand=function(){this._oLayout.removeStyleClass("sapUiVkLPSCollapse");this._oLayout.setWidth(this.getProperty("width"));this.setProperty("expanded",true,true);};
a.prototype._collapse=function(){if(!this.getCollapsible()){return;}var c=this.getContent();for(var i=0;i<c.length;++i){c[i].setExpanded(false);}this._oLayout.addStyleClass("sapUiVkLPSCollapse");this._updateCollapsedLayoutWidth();this.setProperty("expanded",false,true);};
a.prototype._updateCollapsedLayoutWidth=function(){if(this._oLayout.$().closest(".sapUiSizeCompact").length===0){this._oLayout.setWidth("3rem");}else{this._oLayout.setWidth("2.5rem");}};
return a;});
sap.ui.predefine('sap/ui/vk/ListPanelStackRenderer',function(){"use strict";var L={};
L.render=function(r,c){c._oLayout.addStyleClass("sapUiVkListPanelStack");r.renderControl(c._oLayout);};
return L;},true);
sap.ui.predefine('sap/ui/vk/MapContainer',["./ContainerBase","sap/ui/core/IconPool","sap/ui/vbm/lib/sapvbi","sap/ui/Device","./MapContainerRenderer","./MapContainerButtonType","./getResourceBundle"],function(C,I,s,D,M,a,g){"use strict";
var b=C.extend("sap.ui.vk.MapContainer",{metadata:{library:"sap.ui.vk",properties:{"showNavbar":{type:"boolean",group:"Misc",defaultValue:true},"showHome":{type:"boolean",group:"Misc",defaultValue:true},"showMapLayer":{type:"boolean",group:"Misc",defaultValue:true},"showRectangularZoom":{type:"boolean",group:"Misc",defaultValue:true},"showZoom":{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{"listPanelStack":{type:"sap.ui.vk.ListPanelStack",multiple:false},"scrollCont":{type:"sap.m.ScrollContainer",multiple:false,visibility:"hidden"}},associations:{},events:{}}});
b.prototype.init=function(){this._currentText=new sap.m.Text({}).addStyleClass("mapLayerSelectedText");C.prototype.init.apply(this,arguments);var m=new sap.ui.model.json.JSONModel();m.setData({rectZoom:false});this.setModel(m,"rectZoom");this._oNavbar=new sap.m.Toolbar({width:"auto"});this._oScrollCont=new sap.m.ScrollContainer({horizontal:false,vertical:true,focusable:false});this.setAggregation("scrollCont",this._oScrollCont,true);this._oHomeButton=new sap.m.Button({icon:"sap-icon://home",type:sap.m.ButtonType.Transparent,tooltip:g().getText("MAPCONTAINER_HOME"),press:this._onNavbarHome.bind(this)});this._oRectZoomButton=new sap.m.ToggleButton({icon:"sap-icon://draw-rectangle",type:sap.m.ButtonType.Transparent,pressed:"{rectZoom>/rectZoom}",tooltip:g().getText("MAPCONTAINER_RECT_ZOOM")}).setModel(m,"rectZoom");this._oZoomInButton=new sap.m.Button({icon:"sap-icon://add",type:sap.m.ButtonType.Transparent,tooltip:g().getText("MAPCONTAINER_ZOOMIN"),press:this._onNavbarZoomIn.bind(this)});this._oZoomOutButton=new sap.m.Button({icon:"sap-icon://less",type:sap.m.ButtonType.Transparent,tooltip:g().getText("MAPCONTAINER_ZOOMOUT"),press:this._onNavbarZoomOut.bind(this)});if(D.system.phone){this._oMenuOpenButton=new sap.m.Button({layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow}),icon:"sap-icon://menu2",type:sap.m.ButtonType.Transparent,tooltip:g().getText("CONTAINERBASE_MENU"),press:function(){this._bSegmentedButtonSaveSelectState=true;this._showListPanelStack();}.bind(this)});this._oMenuCloseButton=new sap.m.Button({type:sap.m.ButtonType.Transparent,icon:"sap-icon://nav-back",press:function(){this._bSegmentedButtonSaveSelectState=true;this._hideListPanelStack();}.bind(this)});}};
b.prototype.exit=function(){if(this._oNavbar){this._oNavbar.destroy();this._oNavbar=undefined;}if(this._oScrollCont){this._oScrollCont.destroy();this._oScrollCont=undefined;}C.prototype.exit.apply(this,arguments);};
b.prototype.getListPanelStack=function(){return this._oScrollCont.getContent()[0];};
b.prototype.setListPanelStack=function(p){if(D.system.phone){p.setCollapsible(false);p.setWidth("100%");}this._oScrollCont.removeAllContent();return this._oScrollCont.addContent(p);};
b.prototype.onBeforeRendering=function(){C.prototype.onBeforeRendering.apply(this,arguments);this._oNavbar.removeAllContent();var c=this.getSelectedContent();if(c!==null){var d=c.getContent();this._isInstanceGeoAnalytic=d instanceof sap.ui.vbm.GeoMap||d instanceof sap.ui.vbm.AnalyticMap;if(this._isInstanceGeoAnalytic){if(this.getShowHome()){this._oNavbar.addContent(this._oHomeButton);}if(!D.system.phone&&this.getShowRectangularZoom()){this._oNavbar.addContent(this._oRectZoomButton);}if(this.getShowZoom()){this._oNavbar.addContent(this._oZoomInButton);this._oNavbar.addContent(this._oZoomOutButton);}this._shouldRenderListPanel=true;}else{this._shouldRenderListPanel=false;}this._isSupportingMapLayerSwitch=d instanceof sap.ui.vbm.GeoMap&&!(d instanceof sap.ui.vbm.AnalyticMap);if(this._isSupportingMapLayerSwitch&&d.getMapConfiguration()!==null&&this.getShowMapLayer()){var e=d.getMapConfiguration();var l=[].concat(e.MapLayerStacks);if(l.length>1){this._box=new sap.m.HBox({}).addStyleClass("mapContainerHboxPopover");this._popover=new sap.m.Popover({enableScrolling:false,placement:sap.m.PlacementType.Horizontal,content:this._box,showHeader:false});this._selectionMap=new sap.m.Image({width:"4.7rem",press:function(f){if(this._popover.isOpen()){this._popover.close();}else{this._popover.openBy(this._selectionMap);}}.bind(this)}).addStyleClass("mapLayerPopoverItem");}this._shouldRenderMapLayerSwitch=true;}else{this._shouldRenderMapLayerSwitch=false;}}};
b.prototype.onAfterRendering=function(){if(D.system.phone){var l=document.getElementById(this.getId()+"-LPW");this.getDomRef().appendChild(l);}C.prototype.onAfterRendering.apply(this,arguments);if(this.getSelectedContent()!==null){var c=this.getSelectedContent().getContent();if(this._isSupportingMapLayerSwitch===true&&c.getMapConfiguration()){var d=c.getMapConfiguration();var e=[].concat(d.MapLayerStacks);if(e.length>1){e.forEach(function(v,i){var f=new sap.ui.layout.VerticalLayout({});var h=c.mVBIContext.GetMainScene();var j=c.mVBIContext.m_MapLayerStackManager.GetMapLayerStack(v.name);var o=new sap.m.Image({width:"4.5rem",press:function(m){this._popover.close();o.setAlt(v.name);var p=m.getSource();var t=p.getAlt();c.setRefMapLayerStack(t);this._currentText.setText(v.name);h.GetPreviewImage(j,function(q){jQuery(".mapLayerPopoverItem").attr("src",q.src);});this._currentMapLayerStackIndex=i;}.bind(this)});var k=new sap.m.Text({text:v.name}).addStyleClass("mapLayerPopoverItemText");o.addStyleClass("layerType");h.GetPreviewImage(j,function(m){o.setSrc(m.src);});h.GetPreviewImage(h.m_MapLayerStack,function(m){jQuery(".mapLayerPopoverItem").attr("src",m.src);});var n=e[this._currentMapLayerStackIndex||0].name;this._currentText.setText(n);this._box.addItem(f);f.addContent(o);f.addContent(k);},this);}}}};
b.prototype.setToolbarItem=function(c){if(!c||!c.id){return null;}var o;for(var i=0;i<this._customButtons.length;++i){if(c.id===this._customButtons[i].id){o=this._customButtons[i];o.index=i;this._customButtons.splice(i,1);break;}}if(!o){o={id:c.id,visible:true,active:true,index:this._customButtons.length,type:a.Click};}if("index"in c){o.index=c.index;}if("visible"in c){o.visible=c.visible;}if("overflow"in c){o.overflow=c.overflow;}if("active"in c){o.active=c.active;}if("text"in c){o.text=c.text;}if("tooltip"in c){o.tooltip=c.tooltip;}if("icon"in c){o.icon=c.icon;}if("activeIcon"in c){o.activeIcon=c.activeIcon;}if("press"in c){o.press=c.press;}if("toggled"in c){o.toggled=c.toggled;if(o.button){o.button.setPressed(c.toggled);}}if("type"in c){o.type=c.type;}if(o.index>this._customButtons.length){o.index=this._customButtons.length;}else if(o.index<0){o.index=0;}this._customButtons.splice(o.index,0,o);this.invalidate();return o;};
b.prototype.setSelectedContent=function(c){var o;if(this._oSelectedContent){if((o=this._oSelectedContent.getContent())instanceof sap.ui.vbm.GeoMap){o.unbindProperty("rectZoom","rectZoom>/rectZoom");}}C.prototype.setSelectedContent.apply(this,arguments);var n=this._oSelectedContent.getContent();if(n instanceof sap.ui.vbm.GeoMap){n.bindProperty("rectZoom","rectZoom>/rectZoom");}};
b.prototype._addToolbarContent=function(){if(D.system.phone){this._oToolbar.addContent(this._oMenuOpenButton);}C.prototype._addToolbarContent.apply(this,arguments);};
b.prototype._onNavbarZoomIn=function(e){var c=this.getSelectedContent().getContent();if(c.getZoomlevel&&c.setZoomlevel&&c.setEnableAnimation){c.setEnableAnimation(true);c.setZoomlevel(c.getZoomlevel()+1);}};
b.prototype._onNavbarZoomOut=function(e){var c=this.getSelectedContent().getContent();if(c.getZoomlevel&&c.setZoomlevel&&c.setEnableAnimation){c.setEnableAnimation(true);c.setZoomlevel(c.getZoomlevel()-1);}};
b.prototype._onNavbarHome=function(e){var c=this.getSelectedContent().getContent();if(c.goToStartPosition){c.goToStartPosition();}};
b.prototype._showListPanelStack=function(){jQuery("#"+this.getId()+"-LPW").addClass("sapUiVkMapContainerLPWIn");jQuery("#"+this.getId()+"-wrapper").addClass("sapUiVkMapContainerMapOut");};
b.prototype._hideListPanelStack=function(){jQuery("#"+this.getId()+"-LPW").removeClass("sapUiVkMapContainerLPWIn");jQuery("#"+this.getId()+"-wrapper").removeClass("sapUiVkMapContainerMapOut");};
return b;});
sap.ui.predefine('sap/ui/vk/MapContainerRenderer',["./ContainerBaseRenderer","sap/ui/core/Renderer","sap/ui/Device"],function(B,R,D){"use strict";var M=R.extend(B);
M.render=function(r,c){c.addStyleClass("sapUiVkMapContainer");B.render.apply(this,arguments);};
M.writeToolbarArea=function(r,c){r.write("<div");r.addClass("sapUiVkMapContainerOverlay");r.writeAttribute("role",sap.ui.core.AccessibleRole.Presentation);r.writeClasses();r.write(">");if(c.getShowNavbar()){r.write("<div");r.addClass("sapUiVkMapContainerNavbarArea");r.writeAttribute("role",sap.ui.core.AccessibleRole.Presentation);r.writeClasses();r.write(">");if(c.getShowMapLayer()&&c._shouldRenderMapLayerSwitch){r.renderControl(c._currentText);r.renderControl(c._selectionMap);}r.write("<div");r.addClass("sapUiVkMapContainerNavbarContainer");r.writeAttribute("role",sap.ui.core.AccessibleRole.Navigation);r.writeClasses();r.write(">");r.renderControl(c._oNavbar);r.write("</div>");r.write("</div>");}if(!D.system.phone&&c._shouldRenderListPanel){c._oScrollCont.addStyleClass("sapUiVkMapContainerListPanelArea");r.renderControl(c._oScrollCont);}B.writeToolbarArea(r,c);r.write("</div>");if(D.system.phone){r.write("<div id="+c.getId()+"-LPW");r.addClass("sapUiVkMapContainerLPW");r.writeClasses();r.write(">");r.renderControl(c._oMenuCloseButton);c._oScrollCont.addStyleClass("sapUiVkMapContainerListPanelArea");r.renderControl(c._oScrollCont);r.write("</div>");}};
return M;},true);
sap.ui.predefine('sap/ui/vk/NativeViewport',["./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","./Core","./Loco","./ViewportHandler","./Messages","./NativeViewportRenderer","./getResourceBundle","sap/base/util/uid","sap/base/Log"],function(v,C,R,a,L,V,M,N,g,u,b){"use strict";
var c=C.extend("sap.ui.vk.NativeViewport",{
metadata:{library:"sap.ui.vk",properties:{limitZoomOut:{type:"boolean",group:"Behavior",defaultValue:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false}},events:{"resize":{parameters:{oldSize:"object",size:"object"}},"move":{parameters:{pan:"object",zoom:"float"}}}},
constructor:function(i,s){C.apply(this,arguments);this._canvas=null;this._canvas=document.createElement("div");this._canvas.style.textAlign="left";this._canvas.id=u();this._resizeListenerId=null;this._viewportHandler=new V(this);this._loco=new L(this);this._loco.addHandler(this._viewportHandler,-1);this._reset();this._svgid=this.getId()+"-svg";a.observeAssociations(this);}
});
c.prototype.destroy=function(){this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}C.prototype.destroy.call(this);};
c.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}};
c.prototype.onAfterRendering=function(){if(this._canvas){var d=this.getDomRef();d.appendChild(this._canvas);this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._handleResize({size:{width:d.clientWidth,height:d.clientHeight}});}};
c.prototype._handleResize=function(e){this.fireResize({oldSize:e.oldSize,size:e.size});if(this._s===0||this._svgError){this._bestFit();}else{this._update();}};
c.prototype._reset=function(){this._img=null;this._svg=null;this._svgError=null;this._imageW=0;this._imageH=0;this._s4BestFit=0;this._s=0;this._x=0;this._y=0;this._gx=0;this._gy=0;this._canvas.style.visibility="hidden";while(this._canvas.lastChild){this._canvas.removeChild(this._canvas.lastChild);}};
c.prototype._update=function(){var i=this._svgError||this._img||this._svg;if(i){var x=this._x-(this._imageW-this._canvas.clientWidth)/2;var y=this._y-(this._imageH-this._canvas.clientHeight)/2;var t="matrix("+this._s+",0,0,"+this._s+","+x+","+y+")";i.style.transform=t;i.style.webkitTransform=t;i.style.msTransform=t;i.style.MozTransform=t;i.style.OTransform=t;}};
c.prototype._bestFit=function(){if(this._svgError){this._imageW=550;this._imageH=512;}else if(this._svg){this._imageW=this._svg.clientWidth;this._imageH=this._svg.clientHeight;}else if(this._img){this._imageW=this._img.width;this._imageH=this._img.height;}else{return;}if(!this._imageW||!this._imageH||!this._canvas.clientWidth||!this._canvas.clientHeight){return;}var s=Math.min(this._canvas.clientWidth/this._imageW,this._canvas.clientHeight/this._imageH);this._s4BestFit=s;this._s=s;this._x=0;this._y=0;this._update();this._canvas.style.visibility="visible";};
c.prototype.loadUrl=function(d,o,e,f,h){if(/^(svg)$/.test(h.toLowerCase())){this._reset();this._svg=document.createElement("object");this._svg.setAttribute("type","image/svg+xml");this._svg.setAttribute("data",d);this._svg.setAttribute("id",this._svgid);this._svg.setAttribute("class","SVGImage");this._canvas.appendChild(this._svg);var s=document.createElement("div");s.style.position="absolute";s.style.top=0;s.style.left=0;s.style.height="100%";s.style.width="100%";this._canvas.appendChild(s);this._svg.onload=function(){this._svg.onload=null;setTimeout(function(){this._bestFit();if(o){o();}}.bind(this),0);}.bind(this);this._svg.onerror=function(){b.error(g().getText(M.VIT1.summary),M.VIT1.code,"sap.ui.vk.NativeViewport");this._reset();if(e){e();}}.bind(this);this._svg.src=d;return this;}else if(/^(jpg|jpeg|png|gif|bmp|tif|tiff)$/.test(h.toLowerCase())){this._reset();this._img=new Image();this._img.draggable=false;this._img.onload=function(){setTimeout(function(){this._bestFit();this._canvas.appendChild(this._img);if(o){o();}}.bind(this),0);}.bind(this);this._img.onerror=function(){b.error(g().getText(M.VIT2.summary),M.VIT2.code,"sap.ui.vk.NativeViewport");if(e){e();}};this._img.src=d;return this;}else{b.error(g().getText(M.VIT3.summary),M.VIT3.code,"sap.ui.vk.NativeViewport");if(e){e();}}};
c.prototype.loadFailed=function(t){this._reset();this._svgError=document.createElement("div");this._svgError.className="svgErrorContainer";var s="http://www.w3.org/2000/svg";this._svgErrorElement=document.createElementNS(s,"svg");this._svgErrorElement.setAttribute("width","550px");this._svgErrorElement.setAttribute("height","512px");this._svgErrorElement.setAttribute("viewBox","-244 -244 512 512");this._svgErrorElement.setAttribute("enable-background","new -244 -244 512 512");this._svgErrorElement.setAttribute("id","SVGError");var d=document.createElementNS(s,"rect");d.setAttribute("fill","#FFFFFF");d.setAttribute("x","-244");d.setAttribute("y","-244");d.setAttribute("width","512");d.setAttribute("height","512");d.setAttribute("opacity","0.1");this._svgErrorElement.appendChild(d);var e=document.createElementNS(s,"path");e.setAttribute("fill","#474747");e.setAttribute("d","M12.833,89.742c-70.781,0-128.366-57.584-128.366-128.366c0-70.781,57.584-128.365,128.366-128.365 s128.365,57.584,128.365,128.365C141.198,32.158,83.614,89.742,12.833,89.742z M12.833-146.989 c-59.753,0-108.366,48.612-108.366,108.365c0,59.752,48.613,108.366,108.366,108.366S121.198,21.129 121.198-38.624 C121.198-98.376,72.586-146.989,12.833-146.989z");e.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(e);var f=document.createElementNS(s,"rect");f.setAttribute("fill","#474747");f.setAttribute("x","-2.167");f.setAttribute("y","-120.847");f.setAttribute("width","30");f.setAttribute("height","119.447");f.setAttribute("fill","#474747");f.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(f);var h=document.createElementNS(s,"rect");h.setAttribute("fill","#474747");h.setAttribute("x","-2.167");h.setAttribute("y","13.6");h.setAttribute("width","30");h.setAttribute("height","30");h.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(h);var i=document.createElementNS(s,"path");i.setAttribute("fill","#474747");i.setAttribute("d","M10.833,87.33c-70.781,0-128.366-57.584-128.366-128.365c0-70.781,57.584-128.365,128.366-128.365 s128.365,57.584,128.365,128.365C139.198,29.746,81.614,87.33,10.833,87.33z M10.833-149.4 c-59.753,0-108.366,48.612-108.366,108.365S-48.92,67.33,10.833,67.33S119.198,18.718,119.198-41.035S70.586-149.4,10.833-149.4z");this._svgErrorElement.appendChild(i);var j=document.createElementNS(s,"rect");j.setAttribute("fill","#474747");j.setAttribute("x","-4.167");j.setAttribute("y","-123.259");j.setAttribute("width","30");j.setAttribute("height","119.447");j.setAttribute("fill","#474747");this._svgErrorElement.appendChild(j);var k=document.createElementNS(s,"rect");k.setAttribute("fill","#474747");k.setAttribute("x","-4.167");k.setAttribute("y","11.188");k.setAttribute("width","30");k.setAttribute("height","30");k.setAttribute("fill","#474747");this._svgErrorElement.appendChild(k);var l=document.createElementNS(s,"text");l.setAttribute("id","textError");l.setAttribute("left","auto");l.setAttribute("right","auto");l.setAttribute("y","150");l.setAttribute("x","10");l.setAttribute("display","block");l.setAttribute("text-anchor","middle");l.setAttribute("fill","#474747");l.setAttribute("style","font-family:Arial");l.setAttribute("font-size","32");l.textContent=t?t:g().getText("VIEWPORT_MESSAGEUNSUPPORTEDFILEFORMAT");this._svgErrorElement.appendChild(l);this._svgError.appendChild(this._svgErrorElement);this._bestFit();this._canvas.appendChild(this._svgError);return this;};
c.prototype.beginGesture=function(x,y){this._gx=(x-this._canvas.clientWidth/2-this._x)/this._s;this._gy=(y-this._canvas.clientHeight/2-this._y)/this._s;return this;};
c.prototype.endGesture=function(){this._gx=0;this._gy=0;return this;};
c.prototype.pan=function(d,e){if(this._svgError){return this;}this._x+=d;this._y+=e;this._update();this.fireMove({pan:{x:d,y:e},zoom:1.0});return this;};
c.prototype.rotate=function(d,e){if(this._svgError){return this;}this._x+=d;this._y+=e;this._update();this.fireMove({pan:{x:d,y:e},zoom:1.0});return this;};
c.prototype._getZoomInLimit=function(){return 500;};
c.prototype._getZoomOutLimit=function(){return(this.getLimitZoomOut())?this._s4BestFit*0.25:0.0001;};
c.prototype._getZoomFactor=function(){return this._s;};
c.prototype.zoom=function(z){if(this._svgError){return this;}var d=this._gx*this._s;var e=this._gy*this._s;var o=this._s;this._s=Math.min(Math.max(this._s*z,this._getZoomOutLimit()),this._getZoomInLimit());z=this._s/o;var f=this._gx*this._s;var h=this._gy*this._s;var i=d-f;var j=e-h;this._x+=i;this._y+=j;this._update();this.fireMove({pan:{x:i,y:j},zoom:z});return this;};
c.prototype.tap=function(x,y,i){if(i){this._bestFit();}return this;};
c.prototype.queueCommand=function(d){d();return this;};
c.prototype.getViewInfo=function(){var d={};d.camera=[this._s,0,0,this._s,this._x,this._y];return d;};
c.prototype.setViewInfo=function(d){if(this._svgError){return this;}var e=d.camera;this._s=e[0];this._x=e[4];this._y=e[5];this._update();return this;};
c.prototype.getOutputSize=function(){var d=this.getDomRef().getBoundingClientRect();return{left:d.width/2,top:d.height/2,sideLength:1024};};
c.prototype.onSetContentConnector=function(d){d.attachContentReplaced(this._onContentReplaced,this);this._setImage(d.getContent());};
c.prototype.onUnsetContentConnector=function(d){this._setImage(null);d.detachContentReplaced(this._onContentReplaced,this);};
c.prototype._onContentReplaced=function(e){this._setImage(e.getParameter("newContent"));};
c.prototype._setImage=function(i){this._reset();if(i instanceof HTMLObjectElement){this._svg=i;i.setAttribute("id",this._svgid);i.onload=function(){i.onload=null;setTimeout(function(){this._bestFit();}.bind(this),0);}.bind(this);if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){setTimeout(function(){this._bestFit();}.bind(this),0);}this._canvas.appendChild(i);var s=document.createElement("div");s.style.position="absolute";s.style.top=0;s.style.left=0;s.style.height="100%";s.style.width="100%";this._canvas.appendChild(s);}else if(i instanceof HTMLImageElement){this._img=i;i.draggable=false;setTimeout(function(){this._bestFit();this._canvas.appendChild(i);}.bind(this),0);}return this;};
var r=2;var p=2;[{key:"left",dx:-p,dy:0},{key:"right",dx:+p,dy:0},{key:"up",dx:0,dy:-p},{key:"down",dx:0,dy:+p}].forEach(function(i){c.prototype["onsap"+i.key]=function(e){this.beginGesture(this.$().width()/2,this.$().height()/2);this.pan(i.dx,i.dy);this.endGesture();e.preventDefault();e.stopPropagation();};});[{key:"left",dx:-r,dy:0},{key:"right",dx:+r,dy:0},{key:"up",dx:0,dy:-r},{key:"down",dx:0,dy:+r}].forEach(function(i){c.prototype["onsap"+i.key+"modifiers"]=function(e){if(e.shiftKey&&!(e.ctrlKey||e.altKey||e.metaKey)){this.beginGesture(this.$().width()/2,this.$().height()/2);this.rotate(i.dx,i.dy);this.endGesture();e.preventDefault();e.stopPropagation();}};});[{key:"minus",d:0.98},{key:"plus",d:1.02}].forEach(function(i){c.prototype["onsap"+i.key]=function(e){this.beginGesture(this.$().width()/2,this.$().height()/2);this.zoom(i.d);this.endGesture();e.preventDefault();e.stopPropagation();};});return c;});
sap.ui.predefine('sap/ui/vk/Notifications',["sap/base/Log","./library","sap/ui/core/Control","./Messages","sap/m/ToggleButton","./NotificationsRenderer","./getResourceBundle"],function(L,v,C,M,T,N,g){"use strict";
var a=C.extend("sap.ui.vk.Notifications",{metadata:{library:"sap.ui.vk",publicMethods:["clearAllMessages"],aggregations:{_messagePopover:{type:"sap.m.MessagePopover",multiple:false,visibility:"hidden"},_messagePopoverToggleButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"}},events:{allMessagesCleared:{},messageAdded:{}}}});
a.prototype.init=function(){if(C.prototype.init){C.prototype.init.call(this);}var m;var b=new T({icon:"sap-icon://message-popup",type:sap.m.ButtonType.Emphasized,tooltip:g().getText("MESSAGEPOPOVERBUTTON"),text:"0",press:function(e){if(b.getPressed()){m.openBy(b);}else{m.close();}}});b.addStyleClass("messagePopoverButton");this.setAggregation("_messagePopoverToggleButton",b);m=new sap.m.MessagePopover({headerButton:new sap.m.Button({text:g().getText("MESSAGEPOPOVER_CLEARBUTTON"),type:sap.m.ButtonType.Emphasized,tooltip:g().getText("MESSAGEPOPOVER_CLEARBUTTON"),press:function(e){m.getParent().clearAllMessages();}}),afterClose:b.setPressed.bind(b,false)});m.addStyleClass("sapVizKitNotificationPopover");this.setAggregation("_messagePopover",m);L.addLogListener(this);};
a.prototype.exit=function(){L.removeLogListener(this);if(C.prototype.exit){C.prototype.exit.call(this);}};
a.prototype.onLogEntry=function(e){if(e.component.startsWith("sap.ui.vk")&&(e.level===L.Level.WARNING||e.level===L.Level.ERROR||e.level===L.Level.FATAL)){var m=e.details,c,r,b;if(M[e.details]){m=g().getText(M[e.details].summary);c=g().getText(M[e.details].cause);r=g().getText(M[e.details].resolution);b=g().getText("ERROR_DESCRIPTION_CODE");}var d=g().getText("ERROR_DESCRIPTION_COMPONENT");var f=g().getText("ERROR_DESCRIPTION_DATE");var t=g().getText("ERROR_DESCRIPTION_TIME");var l=g().getText("ERROR_DESCRIPTION_LEVEL");var h=g().getText("ERROR_DESCRIPTION_MESSAGE");var i=g().getText("ERROR_DESCRIPTION_CAUSE");var j=g().getText("ERROR_DESCRIPTION_RESOLUTION");var k="<div><b>"+d+":</b><br>"+e.component+"</div><br>"+"<div><b>"+f+":</b><br>"+e.date+"</div><br>"+(b?"<div><b>"+b+":</b><br>"+e.details+"</div><br>":"")+"<div><b>"+t+":</b><br>"+e.time.slice(0,e.time.indexOf("."))+"</div><br>"+"<div><b>"+l+":</b><br>"+e.level+"</div><br>"+"<div><b>"+h+":</b><br>"+m+"</div><br>"+(c?"<div><b>"+i+":</b><br>"+c+"</div><br>":"")+(r?"<div><b>"+j+":</b><br>"+r+"</div>":"");var n=new sap.m.MessageItem({markupDescription:true,title:e.message,description:k});var o=this.getAggregation("_messagePopover");o.addItem(n);this.getAggregation("_messagePopoverToggleButton").setText(o.getItems().length);this.fireMessageAdded();}};
a.prototype.clearAllMessages=function(){var m=this.getAggregation("_messagePopover");m.removeAllItems();m.close();this.getAggregation("_messagePopoverToggleButton").setText(m.getItems().length);this.fireAllMessagesCleared();return this;};
return a;});
sap.ui.predefine('sap/ui/vk/Overlay',["./library","sap/ui/core/Control","sap/ui/vbm/library","sap/ui/vbm/lib/sapvbi","./Messages","./OverlayRenderer","./getResourceBundle","./OverlayArea","sap/base/Log"],function(v,C,a,b,M,O,g,c,L){"use strict";
var d=C.extend("sap.ui.vk.Overlay",{metadata:{library:"sap.ui.vk",properties:{zoomOnResize:{type:"boolean",group:"Behavior",defaultValue:true}},aggregations:{areas:{type:"sap.ui.vk.OverlayArea",multiple:true,singularName:"area"}},associations:{target:{type:"sap.ui.core.Control",cardinality:"0..1"}},events:{click:{parameters:{clientX:{type:"int"},clientY:{type:"int"},pos:{type:"string"}}},contextMenu:{parameters:{pos:{type:"string"},menu:{type:"sap.ui.unified.Menu"}}}}}});
d.prototype.getPositionInteractive=function(p,e){if(!this.mIACreateCB&&e&&typeof(e)==="function"){this.mIACreateCB=e;var t="POS";if(p){t+="ARRAY";}var l={"SAPVB":{"Automation":{"Call":{"handler":"OBJECTCREATIONHANDLER","name":"CreateObject","object":"MainScene","scene":"MainScene","instance":"","Param":{"name":"data","#":"{"+t+"}"}}}}};this._load(l);return true;}else{return false;}};
d.prototype.openContextMenu=function(m){this._openContextMenu("Overlay",this,m);};
d.prototype.setPanAndZoom=function(n,e,z){if(n===0&&e===0&&z===1){return;}var s=this.mVBIContext.GetMainScene();this.totalCenterOffset.dx+=n;this.totalCenterOffset.dy+=e;if(z===1){s.MoveMap(n,e);}else{var f=s.m_Canvas[0];var h=f.m_nExactLOD+Math.log(z)*Math.LOG2E;s.ZoomToGeoPosition(VBI.MathLib.DegToRad([0.5,0.5]),h);s.MoveMap(this.totalCenterOffset.dx,this.totalCenterOffset.dy);}};
d.prototype.reset=function(){this.totalCenterOffset.dx=this.totalCenterOffset.dy=0;var s=this.mVBIContext.GetMainScene();if(s){s.ZoomToGeoPosition(VBI.MathLib.DegToRad([0.5,0.5]),this.initialZoom);}return this;};
d.prototype.init=function(){this.aLoadQueue=null;this.oTargetDomRef=null;this.mVBIContext=new VBI.VBIContext(this);this.resizeID="";this.resizeIDTarget="";this.bVosDirty=true;this.bWindowsDirty=true;this.bSceneDirty=true;this.bDataDeltaUpdate=false;this.bHandleDataChangeActive=false;this.bForceDataUpdate=false;this.mAddMenuItems=[];this.totalCenterOffset={dx:0,dy:0};this.initialZoom=10;};
d.prototype.exit=function(){if(this.mVBIContext){this.mVBIContext.clear();}if(this.resizeID!=""){sap.ui.core.ResizeHandler.deregister(this.resizeID);this.resizeID="";}if(this.resizeIDTarget!=""){sap.ui.core.ResizeHandler.deregister(this.resizeIDTarget);this.resizeIDTarget="";}};
d.prototype.resize=function(e){var f=(this.oControl!=undefined)?this.oControl:this;var h=f.mVBIContext;if(h){var s=h.GetMainScene();if(s){if(f.getZoomOnResize()&&e&&e.oldSize.width>0){var z=Math.log(e.size.width/e.oldSize.width)*Math.LOG2E;s.ZoomToGeoPosition(s.GetCenterPos(),s.GetCurrentZoomlevel()+z,false,true,true);}s.resizeCanvas(e,true,true);}}};
d.prototype.setTarget=function(t){if(!t){return;}this.setAssociation("target",t);this.reset();if(t instanceof sap.m.Image){t.addDelegate({onAfterRendering:function(e){this.oTargetDomRef=t.getDomRef();this.oTargetDomRef.addEventListener("load",jQuery.proxy(this._adaptSizeOfTarget,this));}.bind(this)});}else{t.addDelegate({onAfterRendering:function(e){this.oTargetDomRef=t.getDomRef();this._adaptSizeOfTarget();}.bind(this)});}if(this.resizeIDTarget!=""){sap.ui.core.ResizeHandler.deregister(this.resizeIDTarget);this.resizeIDTarget="";}this.resizeIDTarget=sap.ui.core.ResizeHandler.register(t,this._adaptSizeOfTarget.bind(this));};
d.prototype._adaptSizeOfTarget=function(){var t=this.oTargetDomRef;var f=this.getDomRef();if(t){try{var T=jQuery(t);var p={top:T.offset().top,left:T.offset().left,width:T.outerWidth(),height:T.outerHeight()};jQuery(f).width(p.width).height(p.height).css("position","absolute");jQuery(f).css("top","0px").css("left","0px").css("visibility","");}catch(e){L.error(e);}}else{jQuery(f).css("position","fixed").width("0px").height("0px").css("top","0px").css("left","0px").css("visibility","hidden");}};
d.prototype.onAfterRendering=function(){if(this.$oldContent.length>0){this.$().append(this.$oldContent);}this._adaptSizeOfTarget();if(this.aLoadQueue){var n;for(n=0;n<this.aLoadQueue.length;++n){this._load(this.aLoadQueue[n]);}this.aLoadQueue=null;}if(this.resizeID==""){this.resize();this.resizeID=sap.ui.core.ResizeHandler.register(this,this.resize);}var o=this.getId();if(this.mVBIContext.m_Windows){this.mVBIContext.m_Windows.Awake(o);}};
d.prototype.onBeforeRendering=function(){this.$oldContent=sap.ui.core.RenderManager.findPreservedContent(this.getId());};
d.prototype.invalidate=function(s){this.bSceneDirty=true;if(s instanceof c){this.bVosDirty=true;this.bDataDeltaUpdate=this.bHandleDataChangeActive;}sap.ui.core.Control.prototype.invalidate.apply(this,arguments);};
d.prototype._load=function(e){if(!this.isRendered()){if(!this.aLoadQueue){this.aLoadQueue=[];}this.aLoadQueue.push(e);return;}this._loadHtml(e);};
d.prototype._loadHtml=function(e){var o=this.getId();var f=null;if(typeof e=="string"){f=JSON.parse(e.indexOf("{")?e.substr(e.indexOf("{")):e);}else if(typeof e=="object"){f=e;}if(!f){return;}if(!f["SAPVB"]){var m;if(this.mVBIContext&&(m=(new VBI.Adaptor(this.mVBIContext)).CreateLoadData(f))){this.loadHtml(m);return;}else{return;}}var h=false;var i=false;var j=false;if(jQuery.type(f)=="object"){if(f.SAPVB){if(f.SAPVB.Config){this.mVBIContext.GetConfig().load(f.SAPVB.Config,this.mVBIContext);}if(f.SAPVB.Resources){this.mVBIContext.GetResources().load(f.SAPVB.Resources,this.mVBIContext);}if(f.SAPVB.DataTypes){if(!this.mVBIContext["m_DataTypeProvider"]){this.mVBIContext["m_DataTypeProvider"]=new VBI.DataTypeProvider();}this.mVBIContext["m_DataTypeProvider"].load(f.SAPVB.DataTypes,this.mVBIContext);}if(f.SAPVB.Data){if(!this.mVBIContext["m_DataProvider"]){this.mVBIContext["m_DataProvider"]=new VBI.DataProvider();}this.mVBIContext["m_DataProvider"].load(f.SAPVB.Data,this.mVBIContext);h=true;}if(f.SAPVB.Windows){if(!this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"]=new VBI.Windows();}this.mVBIContext["m_Windows"].load(f.SAPVB.Windows,this.mVBIContext);j=true;}if(f.SAPVB.Actions){if(!this.mVBIContext["m_Actions"]){this.mVBIContext["m_Actions"]=new VBI.Actions();}this.mVBIContext["m_Actions"].load(f.SAPVB.Actions,this.mVBIContext);}if(f.SAPVB.Automation){if(!this.mVBIContext["m_Automations"]){this.mVBIContext["m_Automations"]=new VBI.Automations();}this.mVBIContext["m_Automations"].load(f.SAPVB.Automation,this.mVBIContext);}if(f.SAPVB.Menus){if(!this.mVBIContext["m_Menus"]){this.mVBIContext["m_Menus"]=new VBI.Menus();}this.mVBIContext["m_Menus"].load(f.SAPVB.Menus,this.mVBIContext);}if(f.SAPVB.Scenes){if(!this.mVBIContext["m_SceneManager"]){this.mVBIContext["m_SceneManager"]=new VBI.SceneManager();}this.mVBIContext["m_SceneManager"].load(f.SAPVB.Scenes,this.mVBIContext);i=true;}}if(h){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].NotifyDataChange();}}if(i||j){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].Awake(o);}}if(i||h){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].RenderAsync();}}}};
d.prototype._openContextMenu=function(t,i,m){if(m&&m.vbi_data&&m.vbi_data.VBIName=="DynContextMenu"){if(!this.mVBIContext["m_Menus"]){this.mVBIContext["m_Menus"]=new window.VBI.Menus();}for(var n=0;n<this.mAddMenuItems.length;++n){m.addItem(this.mAddMenuItems[n]);}this.mVBIContext.m_Menus.m_menus.push(m);this._loadHtml({"SAPVB":{"version":"2.0","Automation":{"Call":{"earliest":"0","handler":"CONTEXTMENUHANDLER","instance":i.sId,"name":"SHOW","object":t,"refID":"CTM","Param":[{"name":"x","#":i.mClickPos[0]},{"name":"y","#":i.mClickPos[1]},{"name":"scene","#":"MainScene"}]}}}});}this.mAddMenuItems=[];};
d.prototype._update=function(){var A={SAPVB:{}};if(this.bSceneDirty){this._updateScene(A);}this._updateWindows(A);if(A.SAPVB.Actions){Array.prototype.push.apply(A.SAPVB.Actions.Set.Action,this._getActionArray());}return this._minimizeApp(A);};
d.prototype._minimizeApp=function(A){var t,s;var e;s=null;if(!this.bWindowsDirty){e=(t=A)&&(t=t.SAPVB)&&(t=t.Windows)&&(s=JSON.stringify(t))&&(s==this.mCurWindows)&&(delete A.SAPVB.Windows);if(!e){this.mCurWindows=s?s:this.mCurWindows;}}else{this.bWindowsDirty=false;}s=null;e=(t=A)&&(t=t.SAPVB)&&(t=t.Scenes)&&(s=JSON.stringify(t))&&(s==this.mCurScenes)&&(delete A.SAPVB.Scenes);if(!e){this.mCurScenes=s?s:this.mCurScenes;}s=null;e=(t=A)&&(t=t.SAPVB)&&(t=t.Actions)&&(s=JSON.stringify(t))&&(s==this.mCurActions)&&(delete A.SAPVB.Actions);if(!e){this.mCurActions=s?s:this.mCurActions;}s=null;e=(t=A)&&(t=t.SAPVB)&&(t=t.DataTypes)&&(s=JSON.stringify(t))&&(s==this.mCurDataTypes)&&(delete A.SAPVB.DataTypes);if(!e){this.mCurDataTypes=s?s:this.mCurDataTypes;}if(!this.bForceDataUpdate){s=null;e=(t=A)&&(t=t.SAPVB)&&(t=t.Data)&&(s=JSON.stringify(t))&&(s==this.mCurData)&&(delete A.SAPVB.Data);if(!e){this.mCurData=s?s:this.mCurData;}}else{this.bForceDataUpdate=false;}return A;};
d.prototype._updateWindows=function(A){A.SAPVB.Windows={"Set":[{"name":"Main","Window":{"id":"Main","caption":"MainWindow","type":"geo","refParent":"","refScene":"MainScene","modal":"true"}}]};};
d.prototype._updateScene=function(A){var s=[];var e=[];var f=[];var h=[];this._updateVOData(s,e,f,h);var _=JSON.stringify(s);var m=true;if(!this.saVO){((((A.SAPVB.Scenes={}).Set={}).SceneGeo={id:"MainScene",scaleVisible:"false",navControlVisible:"false",VisualFrame:{minLOD:5},NavigationDisablement:{move:"true",zoom:"true"},initialZoom:this.initialZoom.toString(),initialStartPosition:"0.5;0.5;0"}).VO=s);}else if(this.bRefMapLayerStackDirty||!(this.saVO===_)){(A.SAPVB.Scenes=this._getSceneVOdelta(JSON.parse(this.m_saVO),s));}else{m=false;}this.saVO=_;if(this.bDataDeltaUpdate){A.SAPVB.Data=[];for(var n=0;n<e.length;++n){A.SAPVB.Data.push({Set:{name:e[n].name,type:"N",N:e[n]}});}}else{((A.SAPVB.Data={}).Set={}).N=e;}if(m){(((A.SAPVB.DataTypes={}).Set={}).N=f);}(((A.SAPVB.Actions={}).Set={}).Action=h);this.bSceneDirty=this.bVosDirty=this.bDataDeltaUpdate=false;};
d.prototype._isEventRegistered=function(A,e){var f=this.getAggregation(A);if(!f){return false;}for(var n=0;n<f.length;++n){var i=f[n];if(i.hasListeners(e)){return true;}}return false;};
d.prototype._getTemplateBindingInfo=function(A){var B=this.getBindingInfo(A);if(B&&B.template){return B.template.mBindingInfos;}};
d.prototype._getBindInfo=function(A){var B={};var t=this._getTemplateBindingInfo(A);B.C=(t)?t.hasOwnProperty("color"):true;B.CB=(t)?t.hasOwnProperty("colorBorder"):true;B.DCH=(t)?t.hasOwnProperty("deltaColorHot"):true;B.CS=(t)?t.hasOwnProperty("colorSelect"):true;B.CNS=(t)?t.hasOwnProperty("colorNonSelect"):true;B.TT=(t)?t.hasOwnProperty("tooltip"):true;B.M=(t)?t.hasOwnProperty("changeable"):true;B.hasTemplate=(t)?true:false;return B;};
d.prototype._updateVOData=function(s,e,f,h){var B,V;this.AreaBindInfo=B=(this.AreaBindInfo)?this.AreaBindInfo:this._getBindInfo("areas");V=(B.hasTemplate)?this.getBindingInfo("areas").template:null;var o={id:"OverlayArea",datasource:"OverlayArea",type:"{00100000-2012-0004-B001-F311DE491C77}"};o["posarray.bind"]=o.id+".P";if(B.C){o["color.bind"]=o.id+".C";}else{o.color=V.getColor();}if(B.CB){o["colorBorder.bind"]=o.id+".C";}else{o.colorBorder=V.getColorBorder();}if(B.DCH){o["hotDeltaColor.bind"]=o.id+".DCH";}else{o.hotDeltaColor=V.getDeltaColorHot();}if(B.CS){o["colorSelect.bind"]=o.id+".C";}else{o.colorSelect=V.getColorSelect();}if(B.CNS){o["colorNonSelect.bind"]=o.id+".C";}else{o.colorNonSelect=V.getColorNonSelect();}if(!B.M){o["VB:c"]=V.getChangeable();}s.push(o);var i={name:o.id,key:"K"};i.A=[{"name":"K","alias":"K","type":"string"},{"name":"VB:s","alias":"VB:s","type":"boolean"},{"name":"P","alias":"P","type":"vectorarray","changeable":"true"}];if(B.C){i.A.push({"name":"C","alias":"C","type":"color"});}if(B.CB){i.A.push({"name":"CB","alias":"CB","type":"string"});}if(B.DCH){i.A.push({"name":"DCH","alias":"DCH","type":"string"});}if(B.CS){i.A.push({"name":"CS","alias":"CS","type":"string"});}if(B.CNS){i.A.push({"name":"CNS","alias":"CNS","type":"string"});}if(B.TT){i.A.push({"name":"TT","alias":"TT","type":"string"});}f.push(i);var j=o.id;if(this._isEventRegistered("areas","click")){h.push({"id":j+"1","name":"click","refScene":"MainScene","refVO":j,"refEvent":"Click","AddActionProperty":[{"name":"pos"}]});}if(this._isEventRegistered("areas","contextMenu")){h.push({"id":j+"2","name":"contextMenu","refScene":"MainScene","refVO":j,"refEvent":"ContextMenu"});}if(this._isEventRegistered("areas","edgeClick")){h.push({"id":j+"7","name":"edgeClick","refScene":"MainScene","refVO":j,"refEvent":"EdgeClick"});}h.push({"id":j+"4","name":"handleMoved","refScene":"MainScene","refVO":j,"refEvent":"HandleMoved"});h.push({"id":j+"5","name":"handleContextMenu","refScene":"MainScene","refVO":j,"refEvent":"HandleContextMenu"});h.push({"id":j+"8","name":"edgeContextMenu","refScene":"MainScene","refVO":j,"refEvent":"EdgeContextMenu"});if(this._isEventRegistered("areas","handleClick")){h.push({"id":j+"6","name":"handleClick","refScene":"MainScene","refVO":j,"refEvent":"HandleClick"});}var k={name:o.id,E:[]};var l=this.getAreas();for(var n=0;n<l.length;++n){k.E.push(l[n].getDataElement());}e.push(k);};
d.prototype._getSceneVOdelta=function(o,n){var V=[];var r=[];var e={};for(var f=0,l=o.length;f<l;++f){e[o[f].id]=o[f];}for(var h=0;h<n.length;++h){if(e[n[h].id]){if(JSON.stringify(n[h])!=JSON.stringify(e[n[h].id])){r.push({"id":n[h].id,"type":"VO"});V.push(n[h]);}}else{V.push(n[h]);}delete e[n[h].id];}for(var i in e){r.push({"id":i,"type":"VO"});}var j={"Merge":{"name":"MainScene","type":"SceneGeo","SceneGeo":{"id":"MainScene"}}};if(r.length){j.Merge.SceneGeo.Remove=r;}if(V.length){j.Merge.SceneGeo.VO=V;}return j;};
d.prototype._getActionArray=function(){var A=[];if(this.mEventRegistry["click"]){A.push({"id":"Overlay1","name":"click","refScene":"MainScene","refVO":"Map","refEvent":"Click","AddActionProperty":[{"name":"pos"}]});}if(this.mEventRegistry["contextMenu"]){A.push({"id":"Overlay2","name":"contextMenu","refScene":"MainScene","refVO":"Map","refEvent":"ContextMenu","AddActionProperty":[{"name":"pos"}]});}A.push({"id":"Overlay3","name":"GetPosComplete","refScene":"MainScene","refVO":"General","refEvent":"CreateComplete"});return A;};
d.prototype._handleChangedData=function(n){try{this.bHandleDataChangeActive=true;if(n&&n.length){for(var e=0,N;e<n.length;++e){N=n[e];if(N.E&&N.E.length){for(var f=0,E,i;f<N.E.length;++f){E=N.E[f];i=this._findInstance(E.K);if(i){i.handleChangedData(E);}}}}}this.bHandleDataChangeActive=false;}catch(h){this.bHandleDataChangeActive=false;throw h;}};
d.prototype._findInstance=function(i){var I=(i.indexOf(".")!==-1)?i.split(".")[1]:i;var A=this.getAreas();for(var n=0;n<A.length;++n){var e=A[n];if(e.getId()===I){return e;}}return null;};
d.prototype._handleAggregationEvent=function(e){var E;if((E=this._findInstance(e.Action.instance))){try{E.handleEvent(e);}catch(f){L.error(g().getText(M.VIT11.summary),M.VIT11.code,"sap.ui.vk.Overlay");}}};
d.prototype.isRendered=function(){return this.getDomRef()?true:false;};
d.prototype.fireSubmit=function(e){var f=JSON.parse(e.data);if(f.Data&&f.Data.Merge){this._handleChangedData(f.Data.Merge.N);}if(f.Action.object==="OverlayArea"){this._handleAggregationEvent(f);}else{var A=f.Action.name,h;if(A==="click"||A==="contextMenu"){h=[f.Action.Params.Param[0]["#"],f.Action.Params.Param[1]["#"]];}switch(A){case"GetPosComplete":if(this.mIACreateCB){try{this.mIACreateCB(f.Action.Params.Param[0]["#"]);this.mIACreateCB=null;}catch(i){this.mIACreateCB=null;throw i;}}break;case"click":this.fireClick({clientX:h[0],clientY:h[1],pos:f.Action.AddActionProperties.AddActionProperty[0]["#"]});break;case"contextMenu":if(this.mVBIContext.m_Menus){this.mVBIContext.m_Menus.deleteMenu("DynContextMenu");}sap.ui.getCore().loadLibrary("sap.ui.unified");var m=new sap.ui.unified.Menu();m["vbi_data"]={};m["vbi_data"].menuRef="CTM";m["vbi_data"].VBIName="DynContextMenu";this.mClickPos=h;this.fireContextMenu({pos:f.Action.AddActionProperties.AddActionProperty[0]["#"],menu:m});break;default:break;}}};
d.prototype.fireRender=function(e){};
d.prototype.fireMove=function(e){};
d.prototype.fireZoom=function(e){};
d.prototype.fireOpenWindow=function(e){};
d.prototype.fireCloseWindow=function(e){};
return d;});
sap.ui.predefine('sap/ui/vk/OverlayArea',["sap/ui/core/Element","./getResourceBundle"],function(E,g){"use strict";
var O=E.extend("sap.ui.vk.OverlayArea",{metadata:{library:"sap.ui.vk",properties:{key:{type:"string",group:"Misc",defaultValue:null},position:{type:"string",group:"Misc",defaultValue:null},color:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 0.3)"},colorBorder:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 1.0)"},colorSelect:{type:"string",group:"Misc",defaultValue:null},colorNonSelect:{type:"string",group:"Misc",defaultValue:null},deltaColorHot:{type:"string",group:"Misc",defaultValue:"RHLSA(0;1.3;1.0;1.0)"},select:{type:"boolean",group:"Misc",defaultValue:false},changeable:{type:"boolean",group:"Misc",defaultValue:false}},events:{click:{clientX:{type:"int"},clientY:{type:"int"}},contextMenu:{parameters:{menu:{type:"sap.ui.unified.Menu"}}},edgeClick:{parameters:{index:{type:"int"}}},edgeContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleMoved:{},handleContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleClick:{index:{type:"int"}}}}});
O.prototype.openContextMenu=function(m){this.getParent().openContextMenu("OverlayArea",this,m);};
O.prototype.getDataElement=function(){var e={};var b=this.getParent().AreaBindInfo;e.K=this.getId();if(b.C){e.C=this.getColor();}if(b.CB){e.CB=this.getColorBorder();}if(b.DCH){e.DCH=this.getDeltaColorHot();}if(b.CS){e.CS=this.getColorSelect();}if(b.CNS){e.CNS=this.getColorNonSelect();}if(b.TT){e.TT=this.getTooltip();}e["VB:s"]=this.getSelect();e.P=this.getPosition();if(b.M){e["VB:c"]=this.getChangeable();}return e;};
O.prototype.handleChangedData=function(e){if(e.P){this.setPosition(e.P);}};
O.prototype.handleEvent=function(e){var a=e.Action.name;var f="fire"+a[0].toUpperCase()+a.slice(1);if(a==="contextMenu"||a==="edgeContextMenu"||a==="handleContextMenu"){var p=this.getParent();this.mClickPos=[e.Action.Params.Param[0]["#"],e.Action.Params.Param[1]["#"]];if(p.mVBIContext.m_Menus){p.mVBIContext.m_Menus.deleteMenu("DynContextMenu");}sap.ui.getCore().loadLibrary("sap.ui.unified");var m=new sap.ui.unified.Menu();m["vbi_data"]={};m["vbi_data"].menuRef="CTM";m["vbi_data"].VBIName="DynContextMenu";if(this.getChangeable()){if(a==="edgeContextMenu"){var s=e.Action.Params.Param[2]["#"];p.mAddMenuItems.push(new sap.ui.unified.MenuItem({text:g().getText("OVL_AREA_EDGE_SPLIT"),select:this._handleCtxFunction.bind(this,"SPLIT",s)}));}else if(a==="handleContextMenu"){var h=e.Action.Params.Param[2]["#"];p.mAddMenuItems.push(new sap.ui.unified.MenuItem({text:g().getText("OVL_AREA_HANDLE_REMOVE"),select:this._handleCtxFunction.bind(this,"REMOVE",h)}));}}if(this.hasListeners(a)){if(a==="contextMenu"){this.firecontextMenu({menu:m});}else{this[f]({index:e.Action.Params.Param[2]["#"],menu:m});}}else{p._openContextMenu(e.Action.object,this,m);}}else if(a=="click"){this.mClickPos=e.Action.AddActionProperties.AddActionProperty[0]["#"];this.fireClick({clientX:e.Action.Params.Param[0]["#"],clientY:e.Action.Params.Param[1]["#"]});}else if(a.indexOf("Click")>-1){this[f]({index:e.Action.Params.Param[2]["#"]});}else{this[f]();}};
O.prototype.getKey=function(){var k=this.getProperty("key");if(!k){k=this.getId();}return k;};
O.prototype._handleCtxFunction=function(f,c){var p=this.getPosition().split(";");var o=c*3;if(f==="REMOVE"){p.splice(o,3);}else if(f==="SPLIT"){var s=[p[o],p[o+1]];var e=(o+3<p.length)?[p[o+3],p[o+4]]:[p[0],p[1]];var m=[parseFloat(s[0])+(e[0]-s[0])/2,parseFloat(s[1])+(e[1]-s[1])/2];p.splice(o+3,0,m[0].toString(),m[1].toString(),"0");}this.setPosition(p.toString().replace(/,/g,";"));};
return O;});
sap.ui.predefine('sap/ui/vk/OverlayRenderer',function(){"use strict";var O={};
O.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkOverlay");r.writeClasses(c);r.write(">");r.write("</div>");var a;if((a=c._update())){c._load(a);}};
return O;},true);
sap.ui.predefine('sap/ui/vk/ViewGalleryThumbnail',["sap/m/Image","./Core","./ViewGalleryThumbnailRenderer"],function(I,v,V){"use strict";
var a=I.extend("sap.ui.vk.ViewGalleryThumbnail",{
metadata:{associations:{viewGallery:{type:"sap.ui.vk.ViewGallery"}},properties:{enabled:{type:"boolean",defaultValue:true},thumbnailWidth:{type:"sap.ui.core.CSSSize",defaultValue:"5rem"},thumbnailHeight:{type:"sap.ui.core.CSSSize",defaultValue:"5rem"},source:{type:"string",defaultValue:""},tooltip:{type:"string",defaultValue:""},selected:{type:"boolean",defaultValue:false},processing:{type:"boolean",defaultValue:false},animated:{type:"boolean",defaultValue:false}}},
constructor:function(i,s){I.apply(this,arguments);this._viewGallery=null;v.observeAssociations(this);}
});
a.prototype.onSetViewGallery=function(b){this._viewGallery=b;};
a.prototype.onUnsetViewGallery=function(b){this._viewGallery=null;};
a.prototype._getIndex=function(){return this._viewGallery?this._viewGallery._viewItems.indexOf(this):-1;};
return a;});
sap.ui.predefine('sap/ui/vk/Viewer',["./library","sap/ui/core/Control","./Scene","./ContentResource","./ContentConnector","./dvl/ContentManager","./FlexibleControl","sap/m/VBox","sap/m/FlexItemData","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","./DvlException","./Messages","./ProgressIndicator","./Notifications","./ViewStateManager","./Toolbar","./SceneTree","./StepNavigation","./ViewGallery","./ViewManager","./AnimationPlayer","./Viewport","./NativeViewport","./RedlineDesign","./ViewerRenderer","./SelectionMode","./getResourceBundle","./cssColorToColor","./colorToCSSColor","./abgrToColor","./colorToABGR","sap/base/Log"],function(v,C,S,a,b,D,F,V,c,d,e,f,M,P,N,g,T,h,j,k,m,A,n,o,R,p,q,r,s,t,u,w,L){"use strict";
var x=C.extend("sap.ui.vk.Viewer",{metadata:{library:"sap.ui.vk",properties:{enableOverlay:{type:"boolean",defaultValue:false},enableSceneTree:{type:"boolean",defaultValue:true},showSceneTree:{type:"boolean",defaultValue:true},enableStepNavigation:{type:"boolean",defaultValue:true},enableNotifications:{type:"boolean",defaultValue:true},showStepNavigation:{type:"boolean",defaultValue:false},showStepNavigationThumbnails:{type:"boolean",defaultValue:true},overlayStepNavigation:{type:"boolean",defaultValue:false},enableToolbar:{type:"boolean",defaultValue:true},enableProgressIndicator:{type:"boolean",defaultValue:true},width:{type:"sap.ui.core.CSSSize",defaultValue:null},height:{type:"sap.ui.core.CSSSize",defaultValue:null},toolbarTitle:{type:"string",defaultValue:""},shouldTrackVisibilityChanges:{type:"boolean",defaultValue:false},recursiveSelection:{type:"boolean",defaultValue:false},runtimeSettings:{type:"object",defaultValue:{}},webGLContextAttributes:{type:"object",defaultValue:{antialias:true,alpha:true,premultipliedAlpha:false}},showAllHotspots:{type:"boolean",defaultValue:false},hotspotColorABGR:{type:"int",defaultValue:0xc00000ff},hotspotColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 0, 0, 0.7529411764705882)"}},aggregations:{contentResources:{type:"sap.ui.vk.ContentResource",forwarding:{getter:"_getContentConnector",aggregation:"contentResources"}},overlay:{type:"sap.ui.vk.Overlay",multiple:false},progressIndicator:{type:"sap.ui.vk.ProgressIndicator",multiple:false,visibility:"hidden"},layout:{type:"sap.m.VBox",multiple:false,visibility:"hidden"},contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false,visibility:"hidden"},viewStateManager:{type:"sap.ui.vk.ViewStateManager",multiple:false,visibility:"hidden"}},defaultAggregation:"contentResources",events:{contentResourceChangesProcessed:{},sceneLoadingSucceeded:{parameters:{scene:{type:"sap.ui.vk.Scene"}}},sceneLoadingFailed:{parameters:{reason:{type:"object"}}},sceneDestroying:{parameters:{scene:{type:"sap.ui.vk.Scene"},preventGarbageCollection:{type:"function"}}},selectionChanged:{parameters:{selected:{type:"any[]"},unselected:{type:"any[]"}}},fullScreen:{parameters:{isFullScreen:{type:"boolean"}}},urlClicked:{parameters:{nodeRef:"any",url:"string"}},nodeClicked:{parameters:{nodeRef:"any",x:"int",y:"int"}}}}});
x.prototype.applySettings=function(i){this._inApplySettings=true;C.prototype.applySettings.apply(this,arguments);delete this._inApplySettings;if(this._viewStateManager){this._viewStateManager.setShouldTrackVisibilityChanges(this.getShouldTrackVisibilityChanges());this._viewStateManager.setRecursiveSelection(this.getRecursiveSelection());}this._componentsState={sceneTree:{defaultEnable:this.getEnableSceneTree(),shouldBeEnabled:true,userInteractionShow:this.getShowSceneTree()},stepNavigation:{defaultEnable:this.getEnableStepNavigation(),userInteractionShow:this.getShowStepNavigation()},progressIndicator:{defaultEnable:this.getEnableProgressIndicator()},messagePopover:{defaultEnable:this.getEnableNotifications()}};this.setEnableSceneTree(false);this.setEnableStepNavigation(false);};
x.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}this._contentConnector=new b(this.getId()+"-contentconnector");this.setAggregation("contentConnector",this._contentConnector);this._contentConnector.attachContentReplaced(this._handleContentReplaced,this);this._contentConnector.attachContentChangesStarted(this._handleContentChangesStarted,this);this._contentConnector.attachContentChangesFinished(this._handleContentChangesFinished,this);this._contentConnector.attachContentChangesProgress(this._handleContentChangesProgress,this);this._viewStateManager=new g(this.getId()+"-viewstatemanager",{contentConnector:this._contentConnector});this.setAggregation("viewStateManager",this._viewStateManager);L.debug("sap.ui.vk.Viewer.init() called.");this._animationPlayer=new A({viewStateManager:this._viewStateManager});this._viewManager=new m({contentConnector:this._contentConnector,animationPlayer:this._animationPlayer});this._viewStateManager.setViewManager(this._viewManager);this._mainScene=null;this._busyIndicatorCounter=0;this._viewport=null;this._nativeViewport=null;this._redlineDesign=null;this._stepNavigation=null;this._sceneTree=null;this._overlayManager={initialized:false,changed:false,control:null,onNativeViewportMove:function(i){var l=i.getParameter("pan");var z=i.getParameter("zoom");this.control.setPanAndZoom(l.x,l.y,z);},onViewportZoom:function(i){var z=i.getParameter("zoomFactor");this.control.setPanAndZoom(0,0,z);},onViewportPan:function(i){var l=i.getParameter("dx");var y=i.getParameter("dy");this.control.setPanAndZoom(l,y,1);}};this._overlayManager.delegate={onAfterRendering:this._onAfterRenderingOverlay.bind(this,this._viewport,this._nativeViewport,this._overlayManager)};this._toolbar=new T({title:this.getToolbarTitle(),visible:this.getEnableToolbar(),viewer:this});this._stackedViewport=new F(this.getId()+"-stackedViewport",{width:"100%",height:"100%",layout:"Stacked",layoutData:new e({size:"auto",minSize:200})});this._splitter=new d(this.getId()+"-splitter",{layoutData:new sap.m.FlexItemData({growFactor:1,minHeight:"200px"}),contentAreas:[this._stackedViewport]}).addStyleClass("sapUiVizKitSplitter");this._messagePopover=new N({visible:true});this._messagePopover.attachAllMessagesCleared(this._updateLayout,this);this._messagePopover.attachMessageAdded(this._updateLayout,this);this._layout=new V(this.getId()+"-vbox",{height:"100%",items:[this._toolbar,this._splitter,this._messagePopover]}).addStyleClass("sapUiVizKitLayout");this.setAggregation("layout",this._layout);this.setTooltip(r().getText("VIEWER_TITLE"));if(this.getEnableProgressIndicator()){this._progressIndicator=new P({visible:false}).addStyleClass("sapUiVizKitProgressIndicator");this.setAggregation("progressIndicator",this._progressIndicator);}};
x.prototype.exit=function(){L.debug("sap.ui.vk.Viewer.exit() called.");if(this._viewport){this._viewport.detachEvent("viewActivated",this._onViewportViewActivated,this);this._viewport.destroy();this._viewport=null;}if(this._nativeViewport){this._nativeViewport.destroy();this._nativeViewport=null;}this._setMainScene(null);this._toolbar=null;this._messagePopover=null;this._sceneTree=null;this._stepNavigation=null;this._componentsState=null;this._viewStateManager=null;this._contentConnector=null;this._viewManager=null;if(C.prototype.exit){C.prototype.exit.apply(this);}};
x.prototype._setMainScene=function(i){if(i){if(i!==this._mainScene){this._mainScene=i;this._showViewport();if(this._componentsState.sceneTree.defaultEnable){this._instantiateSceneTree();this.setEnableSceneTree(true);if(this._componentsState.sceneTree.userInteractionShow&&this._componentsState.sceneTree.shouldBeEnabled){this.setShowSceneTree(true);this._sceneTree.setVisible(true);}else{this.setShowSceneTree(false);}}else if(this._sceneTree&&this._viewStateManager){this._sceneTree.setScene(i,this._viewStateManager);}this.setEnableStepNavigation(this.getEnableStepNavigation()||this._componentsState.stepNavigation.defaultEnable);if(this.getEnableStepNavigation()){this._instantiateStepNavigation();this.setShowStepNavigation(this._componentsState.stepNavigation.userInteractionShow);}}if(this._stepNavigation){this._stepNavigation.refresh(i);}}else{this._mainScene=null;this.setEnableSceneTree(false);this.setEnableStepNavigation(false);}return this;};
x.prototype.getGraphicsCore=function(){return this._mainScene instanceof v.dvl.Scene?this._mainScene.getGraphicsCore():null;};
x.prototype.getScene=function(){return this._mainScene;};
x.prototype.getViewStateManager=function(){return this._viewStateManager;};
x.prototype.getViewport=function(){if(!this._viewport){this._viewport=new n(this.getId()+"-viewport",{viewStateManager:this._viewStateManager,selectionMode:q.Exclusive,contentConnector:this._contentConnector});this._viewport.attachEvent("viewActivated",this._onViewportViewActivated,this);}return this._viewport;};
x.prototype.getNativeViewport=function(){return this._nativeViewport;};
x.prototype.getToolbar=function(){return this._toolbar;};
x.prototype.getSceneTree=function(){return this._sceneTree;};
x.prototype.getRedlineDesign=function(){return this._redlineDesign;};
x.prototype.getOverlay=function(){return this._overlayManager.control;};
x.prototype.setEnableOverlay=function(i){if(i!==this.getProperty("enableOverlay")){this.setProperty("enableOverlay",i);this._overlayManager.changed=true;}return this;};
x.prototype.setEnableSceneTree=function(i){this.setProperty("enableSceneTree",i,true);if(!i){this.setProperty("showSceneTree",false);}this._updateLayout();return this;};
x.prototype.setEnableNotifications=function(i){this.setProperty("enableNotifications",i,true);this._messagePopover.setVisible(false);this._updateLayout();return this;};
x.prototype.setShowSceneTree=function(i){this.setProperty("showSceneTree",i,true);this._updateLayout();return this;};
x.prototype.setEnableStepNavigation=function(i){this.setProperty("enableStepNavigation",i,true);if(!i){this.setProperty("showStepNavigation",false);}this._updateLayout();return this;};
x.prototype.setShowStepNavigation=function(i){this.setProperty("showStepNavigation",i,true);this._updateLayout();return this;};
x.prototype.setEnableToolbar=function(i){this.setProperty("enableToolbar",i,true);this._toolbar.setVisible(i);return this;};
x.prototype.setRecursiveSelection=function(i){this.setProperty("recursiveSelection",i,true);if(this._viewStateManager){this._viewStateManager.setRecursiveSelection(i);}return this;};
x.prototype.setToolbarTitle=function(i){this.setProperty("toolbarTitle",i);this._toolbar.setTitle(i);return this;};
x.prototype.activateFullScreenMode=function(i){var l=function(B){return!!(B.fullScreen||B.webkitIsFullScreen||B.mozFullScreen||B.msFullscreenElement);};if(i){if(!l(document)){if(!this._fullScreenHandler){var y=this;this._fullScreenHandler=function(B){var E=l(document);if(!E){y.removeStyleClass("sapVizKitViewerFullScreen");document.removeEventListener("fullscreenchange",y._fullScreenHandler);document.removeEventListener("mozfullscreenchange",y._fullScreenHandler);document.removeEventListener("webkitfullscreenchange",y._fullScreenHandler);document.removeEventListener("MSFullscreenChange",y._fullScreenHandler);}y.fireFullScreen({isFullScreen:E});};}var z=document.getElementsByTagName("body")[0];if(z.requestFullScreen){document.addEventListener("fullscreenchange",this._fullScreenHandler);z.requestFullScreen();}else if(z.webkitRequestFullScreen){document.addEventListener("webkitfullscreenchange",this._fullScreenHandler);z.webkitRequestFullScreen();}else if(z.mozRequestFullScreen){document.addEventListener("mozfullscreenchange",this._fullScreenHandler);z.mozRequestFullScreen();}else if(z.msRequestFullscreen){document.addEventListener("MSFullscreenChange",this._fullScreenHandler);z.msRequestFullscreen();}}this.addStyleClass("sapVizKitViewerFullScreen");}else{if(l(document)){if(document.cancelFullScreen){document.cancelFullScreen();}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}}this.removeStyleClass("sapVizKitViewerFullScreen");}return this;};
x.prototype.getShowAllHotspots=function(){var i=this.getViewport().getImplementation();return i?i.getShowAllHotspots():this.getProperty("showAllHotspots");};
x.prototype.setShowAllHotspots=function(i){this.setProperty("showAllHotspots",i,true);var l=this.getViewport().getImplementation();if(l){l.setShowAllHotspots(i);}return this;};
x.prototype.getHotspotColorABGR=function(){var i=this.getViewport().getImplementation();return i?i.getHotspotColorABGR():this.getProperty("hotspotColorABGR");};
x.prototype.setHotspotColorABGR=function(i){this.setProperty("hotspotColorABGR",i,true);this.setProperty("hotspotColor",t(u(i)),true);var l=this.getViewport().getImplementation();if(l){l.setHotspotColorABGR(i);}return this;};
x.prototype.getHotspotColor=function(){var i=this.getViewport().getImplementation();return i?i.getHotspotColor():this.getProperty("hotspotColor");};
x.prototype.setHotspotColor=function(i){this.setProperty("hotspotColor",i,true);this.setProperty("hotspotColorABGR",w(s(i)),true);var l=this.getViewport().getImplementation();if(l){l.setHotspotColor(i);}return this;};
x.prototype.setRuntimeSettings=function(i){if(this._inApplySettings){this.setProperty("runtimeSettings",i,true);D.setRuntimeSettings(i);}else{L.error(r().getText(M.VIT29.summary),M.VIT29.code,"sap.ui.vk.Viewer");}return this;};
x.prototype.setWebGLContextAttributes=function(i){if(this._inApplySettings){this.setProperty("webGLContextAttributes",i,true);D.setWebGLContextAttributes(i);}else{L.error(r().getText(M.VIT30.summary),M.VIT30.code,"sap.ui.vk.Viewer");}return this;};
x.prototype.invalidate=function(i){if(i instanceof a){this._contentConnector.invalidate(i);return;}C.prototype.invalidate.apply(this,arguments);};
x.prototype._getContentConnector=function(){return this._contentConnector;};
x.prototype.onBeforeRendering=function(){this._showOverlay();};
x.prototype.isTreeBinding=function(i){return i==="contentResources";};
x.prototype.setBusy=function(i){if(i){if(this._busyIndicatorCounter===0){this.setBusyIndicatorDelay(0);C.prototype.setBusy.call(this,true);}this._busyIndicatorCounter+=1;}else{this._busyIndicatorCounter-=1;if(this._busyIndicatorCounter==0){C.prototype.setBusy.call(this,false);}}};
x.prototype._updateLayout=function(){if(this._sceneTree){if(this.getShowSceneTree()&&this.getEnableSceneTree()){this._sceneTree.setVisible(true);if(this._splitter.indexOfContentArea(this._sceneTree)<0){this._splitter.insertContentArea(this._sceneTree,0);}}else{if(this._splitter.indexOfContentArea(this._sceneTree)>=0){this._splitter.removeContentArea(this._sceneTree);}this._sceneTree.setVisible(false);}}if(this._stepNavigation){this._stepNavigation.setVisible(this.getShowStepNavigation()&&this.getEnableStepNavigation());}if(this._messagePopover){this._messagePopover.setVisible(this.getEnableNotifications()&&this._messagePopover.getAggregation("_messagePopover").getItems().length>0);}if(this._toolbar){this._toolbar.refresh();}};
x.prototype._instantiateSceneTree=function(){if(!this._sceneTree){this._sceneTree=new h({layoutData:new e({size:"320px",minSize:200}),viewStateManager:this._viewStateManager,contentConnector:this._contentConnector});}return this;};
x.prototype._instantiateStepNavigation=function(){if(this._stepNavigation){this._layout.removeItem(this._stepNavigation);this._viewport.removeContent(this._stepNavigation);this._splitter.detachResize(this._handleSplitterResize,this);this._stepNavigation=null;}if(this._mainScene instanceof v.dvl.Scene){this._stepNavigation=new j({showThumbnails:this.getShowStepNavigationThumbnails(),contentConnector:this._contentConnector});this._layout.insertItem(this._stepNavigation,3);}else if(this._mainScene instanceof v.threejs.Scene||this._mainScene instanceof v.svg.Scene){this._stepNavigation=new k({host:this.getViewport(),contentConnector:this._contentConnector,viewManager:this._viewManager});if(!this.getOverlayStepNavigation()){this._layout.insertItem(this._stepNavigation,3);}else{this._stepNavigation.addStyleClass("sapVizKitViewGallery");this._viewport.addContent(this._stepNavigation);this._splitter.attachResize(this._handleSplitterResize,this);}this._stepNavigation.setAnimationPlayer(this._animationPlayer);}return this;};
x.prototype._handleSplitterResize=function(){this._stepNavigation.resizeToolbarSpacer();};
x.prototype._showViewport=function(){var i=this.getViewport().getImplementation();if(i){i.setHotspotColor(this.getProperty("hotspotColor"));i.setHotspotColorABGR(this.getProperty("hotspotColorABGR"));i.setShowAllHotspots(this.getProperty("showAllHotspots"));}if(this._nativeViewport){this._nativeViewport.setVisible(false);}this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._viewport);this._viewport.setVisible(true);return this;};
x.prototype._showNativeViewport=function(){if(!this._nativeViewport){this._nativeViewport=new o(this.getId()+"-nativeViewport",{limitZoomOut:true,contentConnector:this._contentConnector});}if(this._viewport){this._viewport.setVisible(false);}this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._nativeViewport);this._nativeViewport.setVisible(true);return this;};
x.prototype._showOverlay=function(){var O=this._overlayManager;if(O.changed){var i;if(this.getEnableOverlay()){sap.ui.require(["sap/ui/vk/Overlay"],function(l){if(!O.initialized){if(!(i=this.getAggregation("overlay"))){i=new l();}i.setZoomOnResize(false);O.control=i;O.initialized=true;}else{i=O.control;i.reset();}if(this._nativeViewport&&this._nativeViewport.getVisible()){i.setTarget(this._nativeViewport);O.savedLimitZoomOutState=this._nativeViewport.getLimitZoomOut();this._nativeViewport.setLimitZoomOut(true);this._nativeViewport.attachEvent("move",O.onNativeViewportMove,O);}else if(this._viewport&&this._viewport.getVisible()){i.setTarget(this._viewport);O.savedLimitZoomOutState=false;this._viewport.attachEvent("zoom",O.onViewportZoom,O);this._viewport.attachEvent("pan",O.onViewportPan,O);}this._stackedViewport.addContent(i);this._stackedViewport.addDelegate(O.delegate);}.bind(this));}else{this._nativeViewport.detachEvent("move",O.onNativeViewportMove,O);this._stackedViewport.removeDelegate(O.delegate);this._stackedViewport.removeContent(O.control);this._nativeViewport.setLimitZoomOut(O.savedLimitZoomOutState);}O.changed=false;}};
x.prototype._onAfterRenderingOverlay=function(E){var i=this._overlayManager.control.getDomRef();if(i&&(this._nativeViewport||this._viewport)){var l=this._nativeViewport&&this._nativeViewport.getVisible()?this._nativeViewport.getDomRef():this._viewport.getDomRef();if(i.parentNode!==l){i.parentNode.style.display="none";}l.appendChild(i);i.style.width="100%";i.style.height="100%";}};
x.prototype.setDecryptionHandler=function(i){this._contentConnector.setDecryptionHandler(i);return this;};
x.prototype.setAuthorizationHandler=function(i){this._contentConnector.setAuthorizationHandler(i);return this;};
x.prototype._instantiateRedlineDesign=function(i){var l=this.getViewport().getImplementation();if((l&&l.getVisible())||(this.getNativeViewport()&&this.getNativeViewport().getVisible())){var y=l&&l.getVisible()?l:this.getNativeViewport();var z=y.getOutputSize();this._redlineDesign=new R({visible:false,virtualTop:z.top,virtualLeft:z.left,virtualSideLength:z.sideLength,redlineElements:i});this._redlineDesign._setTargetViewport(y);}return this;};
x.prototype.activateRedlineDesign=function(i){var l=this.getViewport().getImplementation();if(l instanceof v.threejs.Viewport){l._viewportGestureHandler._activateRedline();}if(l instanceof v.dvl.Viewport&&l.getViewInfo().camera&&l.getViewInfo().camera.projectionType==="perspective"){l._activateRedline();}i=i||[];this._instantiateRedlineDesign(i);this.getRedlineDesign().placeAt(this._stackedViewport);this.getRedlineDesign().setVisible(true);var y=function(I){var J=I.getParameter("deltaX"),K=I.getParameter("deltaY");l.queueCommand(function(J,K){l.pan(J,K);l.endGesture();}.bind(this,J,K));};var z=function(I){var J=I.getParameter("originX"),K=I.getParameter("originY"),O=I.getParameter("zoomFactor");l.queueCommand(function(J,K,O){l.beginGesture(J,K);l.zoom(O);l.endGesture();}.bind(this,J,K,O));};var B=function(I){var J=I.getParameter("deltaX"),K=I.getParameter("deltaY");this.getNativeViewport().queueCommand(function(){this.getNativeViewport().pan(J,K);this.getNativeViewport().endGesture();}.bind(this));};var E=function(I){var J=I.getParameter("originX"),K=I.getParameter("originY"),O=I.getParameter("zoomFactor");this.getNativeViewport().queueCommand(function(J,K,O){this.getNativeViewport().beginGesture(J,K);this.getNativeViewport().zoom(O);this.getNativeViewport().endGesture();}.bind(this,J,K,O));};var G=function(I){var J=I.getParameter("deltaX"),K=I.getParameter("deltaY");l.queueCommand(function(J,K){l._viewportGestureHandler._cameraController.beginGesture(J,K);l._viewportGestureHandler._cameraController.pan(J,K);l._viewportGestureHandler._cameraController.endGesture();}.bind(this,J,K));};var H=function(I){var J=I.getParameter("originX"),K=I.getParameter("originY"),O=I.getParameter("zoomFactor");l.queueCommand(function(J,K,O){l._viewportGestureHandler._cameraController.beginGesture(J,K);l._viewportGestureHandler._cameraController.zoom(O);l._viewportGestureHandler._cameraController.endGesture();}.bind(this,J,K,O));};if(this.getNativeViewport()&&this.getNativeViewport().getVisible()){this.getRedlineDesign().attachEvent("pan",B.bind(this));this.getRedlineDesign().attachEvent("zoom",E.bind(this));}else if(l instanceof v.dvl.Viewport&&l.getVisible()){this.getRedlineDesign().attachEvent("pan",y.bind(this));this.getRedlineDesign().attachEvent("zoom",z.bind(this));}else if(l instanceof v.threejs.Viewport&&l.getVisible()){this.getRedlineDesign().attachEvent("pan",G.bind(this));this.getRedlineDesign().attachEvent("zoom",H.bind(this));}else{L.error("Error: Viewport not supported");}return this;};
x.prototype.destroyRedlineDesign=function(){if(this.getRedlineDesign()){var i=this.getViewport().getImplementation();if(i instanceof v.dvl.Viewport){i._deactivateRedline();}else if(i instanceof v.threejs.Viewport){i._viewportGestureHandler._deactivateRedline();}this.getRedlineDesign().destroy();this._redlineDesign=null;}return this;};
x.prototype._onViewportViewActivated=function(i){this._componentsState.sceneTree.shouldBeEnabled=i.getParameter("type")==="3D";};
x.prototype._removeProgressIndicator=function(i){setTimeout(function(){this._progressIndicator.setVisible(false);this._progressIndicator.setDisplayValue("");this._progressIndicator.setPercentValue(0);}.bind(this),i);};
x.prototype._handleContentReplaced=function(i){var l=i.getParameter("newContent");if(l&&l instanceof v.Scene){this._showViewport();if(this.getRedlineDesign()){this.getRedlineDesign().updatePanningRatio();}this._setMainScene(l);}else if(l instanceof HTMLImageElement||l instanceof HTMLObjectElement){this._setMainScene(null);this._showNativeViewport();if(this.getEnableOverlay()){this._overlayManager.changed=true;this._showOverlay();}}else{this._setMainScene(null);if(this._viewport){this._viewport.setVisible(false);}if(this._nativeViewport){this._nativeViewport.setVisible(false);}this._stackedViewport.removeAllContent();}};
x.prototype._handleContentChangesStarted=function(i){this.setBusy(true);if(this._componentsState.progressIndicator.defaultEnable){this._progressIndicator.setPercentValue(0.0);this._progressIndicator.setVisible(true);this.getViewport().stopAnimation();}};
x.prototype._handleContentChangesFinished=function(i){L.info("Finished");this.setBusy(false);var l=i.getParameter("content");if(l){this.fireSceneLoadingSucceeded({scene:l});}var y=i.getParameter("failureReason");if(y){this.fireSceneLoadingFailed({reason:y});this._showNativeViewport();var z=r().getText("VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_CAUSE");if(y.errorMessage===z){this._nativeViewport.loadFailed();}else{var B=r().getText("VIEWPORT_MESSAGEERRORLOADINGFILE");this._nativeViewport.loadFailed(B);}(Array.isArray(y)?y:[y]).forEach(function(E){L.error(r().getText(M.VIT13.summary),E.errorMessage,"sap.ui.vk.Viewer");});}if(y||this._progressIndicator.getPercentValue()===0){this._removeProgressIndicator(0);}this.fireContentResourceChangesProcessed();};
x.prototype._handleContentChangesProgress=function(y){function z(J,B){for(var i=0,l=J.length;i<l;i++){var K=J[i];var O=K.getSource();if((O===B)||(O instanceof File&&O.name===B)){return K;}K=z(K.getContentResources(),B);if(K){return K;}}return null;}if(this._progressIndicator.getVisible()){var B=y.getParameter("source")||"",E=y.getParameter("percentage"),G=y.getParameter("phase");var H=z(this.getContentResources(),B);if(H&&H.getName()!==undefined){B=H.getName();}else{if(B instanceof File){B=B.name;}var I=B.match(/\..{3,4}$/);B=I&&I[0]?B.split(/\\|\//).pop():"";}this._progressIndicator.setPercentValue(E);this._progressIndicator.setDisplayValue(B+" "+G+" / "+r().getText("PROGRESS_INDICATOR_TOTAL_PERCENT_DONE")+": "+(E?Math.floor(E)+"%":""));if(E>=100){this._removeProgressIndicator(0);}}};
x.prototype._handleContentDestroying=function(i){this.fireSceneDestroying({scene:i.getParameter("content").scene,preventGarbageCollection:i.getParameter("preventGarbageCollection")});};
return x;});
sap.ui.predefine('sap/ui/vk/library',["sap/base/util/ObjectPath","./BillboardBorderLineStyle","./BillboardCoordinateSpace","./BillboardHorizontalAlignment","./BillboardStyle","./BillboardTextEncoding","./CameraFOVBindingType","./CameraProjectionType","./ContentResourceSourceCategory","./ContentResourceSourceTypeToCategoryMap","./DetailViewShape","./DetailViewType","./DvlException","./LeaderLineMarkStyle","./MapContainerButtonType","./Redline","./RenderMode","./SelectionMode","./TransformationMatrix","./VisibilityMode","./ZoomTo","./abgrToColor","./colorToABGR","./cssColorToColor","./colorToCSSColor","./getResourceBundle","./utf8ArrayBufferToString","./dvl/GraphicsCoreApi","./dvl/checkResult","./dvl/getJSONObject","./dvl/getPointer","./tools/AxisColours","./tools/CoordinateSystem","./tools/HitTestClickType","./tools/HitTestIdMode","./tools/PredefinedView"],function(O){"use strict";sap.ui.getCore().initLibrary({name:"sap.ui.vk",dependencies:["sap.ui.core"],interfaces:["sap.ui.vk.AuthorizationHandler","sap.ui.vk.DecryptionHandler","sap.ui.vk.IPlaybackCollection"],types:[],controls:["sap.ui.vk.AnimationTimeSlider","sap.ui.vk.ContainerBase","sap.ui.vk.ContainerContent","sap.ui.vk.DrawerToolbar","sap.ui.vk.FlexibleControl","sap.ui.vk.LegendItem","sap.ui.vk.ListPanel","sap.ui.vk.ListPanelStack","sap.ui.vk.MapContainer","sap.ui.vk.NativeViewport","sap.ui.vk.Notifications","sap.ui.vk.Overlay","sap.ui.vk.ProgressIndicator","sap.ui.vk.RedlineDesign","sap.ui.vk.RedlineSurface","sap.ui.vk.SceneTree","sap.ui.vk.StepNavigation","sap.ui.vk.Toolbar","sap.ui.vk.Viewer","sap.ui.vk.ViewGallery","sap.ui.vk.Viewport","sap.ui.vk.ViewportBase","sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport","sap.ui.vk.tools.AnchorPointToolGizmo","sap.ui.vk.tools.CrossSectionToolGizmo","sap.ui.vk.tools.Gizmo","sap.ui.vk.tools.MoveToolGizmo","sap.ui.vk.tools.RotateToolGizmo","sap.ui.vk.tools.ScaleToolGizmo","sap.ui.vk.tools.SceneOrientationToolGizmo","sap.ui.vk.tools.TooltipToolGizmo"],elements:["sap.ui.vk.ContentConnector","sap.ui.vk.FlexibleControlLayoutData","sap.ui.vk.OverlayArea","sap.ui.vk.RedlineElement","sap.ui.vk.RedlineElementEllipse","sap.ui.vk.RedlineElementFreehand","sap.ui.vk.RedlineElementLine","sap.ui.vk.RedlineElementRectangle","sap.ui.vk.RedlineElementText","sap.ui.vk.ViewStateManager","sap.ui.vk.ViewStateManagerBase","sap.ui.vk.dvl.ViewStateManager","sap.ui.vk.threejs.NodesTransitionHelper","sap.ui.vk.threejs.ViewStateManager","sap.ui.vk.svg.ViewStateManager","sap.ui.vk.tools.AnchorPointTool","sap.ui.vk.tools.CrossSectionTool","sap.ui.vk.tools.HitTestTool","sap.ui.vk.tools.MoveTool","sap.ui.vk.tools.RectSelectTool","sap.ui.vk.tools.RotateOrbitTool","sap.ui.vk.tools.RotateTool","sap.ui.vk.tools.RotateTurntableTool","sap.ui.vk.tools.ScaleTool","sap.ui.vk.tools.SceneOrientationTool","sap.ui.vk.tools.Tool","sap.ui.vk.tools.TooltipTool","sap.ui.vk.tools.PoiManipulationTool"],noLibraryCSS:false,version:"1.88.0",designtime:"sap/ui/vk/designtime/library.designtime"});var v=O.get("sap.ui.vk");var s={};s["sap/ui/vk/thirdparty/three"]={exports:"THREE",amd:true};s["sap/ui/vk/thirdparty/html2canvas"]={exports:"html2canvas",amd:true};s["sap/ui/vk/thirdparty/gl-matrix"]={exports:"glMatrix",amd:true};sap.ui.loader.config({shim:s});var l=function(a,b){var m="new extend getMetadata";if(b){m+=" "+b;}sap.ui.lazyRequire("sap.ui.vk."+a,m);};l("AnimationPlayback");l("AnimationSequence");l("BaseNodeProxy");l("Camera");l("ContentConnector","registerSourceType");l("ContentManager");l("ContentResource");l("Core");l("DownloadManager");l("ImageContentManager");l("LayerProxy");l("Loco");l("Material");l("NodeHierarchy");l("NodeProxy");l("OrthographicCamera");l("PerspectiveCamera");l("RedlineDesignHandler");l("RedlineGesturesHandler");l("Scene");l("Smart2DHandler");l("Texture");l("View");l("ViewportHandler");l("dvl.BaseNodeProxy");l("dvl.ContentManager","getRuntimeSettings setRuntimeSettings getWebGLContextAttributes setWebGLContextAttributes getDecryptionHandler setDecryptionHandler");l("dvl.GraphicsCore");l("dvl.LayerProxy");l("dvl.NodeHierarchy");l("dvl.NodeProxy");l("dvl.Scene");l("helpers.RotateOrbitHelperDvl");l("helpers.RotateOrbitHelperThree");l("helpers.RotateTurntableHelperDvl");l("helpers.RotateTurntableHelperThree");l("Highlight");l("svg.BaseNodeProxy");l("svg.ContentManager","registerLoader");l("svg.NodeHierarchy");l("svg.NodeProxy");l("svg.Scene");l("threejs.AnimationSequence");l("threejs.BaseNodeProxy");l("threejs.Billboard");l("threejs.Callout");l("threejs.ContentDeliveryService");l("threejs.ContentManager","registerLoader");l("threejs.DetailView");l("threejs.LayerProxy");l("threejs.Material");l("threejs.NodeHierarchy");l("threejs.NodeProxy");l("threejs.OrthographicCamera");l("threejs.PerspectiveCamera");l("threejs.Scene");l("threejs.Texture");l("threejs.Thrustline");l("threejs.ViewportGestureHandler");l("tools.AnchorPointToolHandler");l("tools.CrossSectionToolHandler");l("tools.HitTestToolHandler");l("tools.MoveToolHandler");l("tools.RectSelectToolHandler");l("tools.RotateToolHandler");l("tools.ScaleToolHandler");l("tools.TooltipToolHandler");return v;});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine('sap/ui/vk/AnimationPlayback',["sap/ui/base/EventProvider","./AnimationSequence","./AnimationTrackType"],function(E,A,a){"use strict";
var b=E.extend("sap.ui.vk.AnimationPlayback",{constructor:function(i,p){var u=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:(r&0x3|0x8);return v.toString(16);});};if(typeof i==="object"){p=i;i=undefined;}if(i==null){i=u();}this._sequence=p&&p.sequence?p.sequence:undefined;this._jsonData={};this._jsonData.id=i;this._jsonData.startTime=p&&p.startTime?p.startTime:0;this._jsonData.sequence=this._sequence?this._sequence.getJSONData():undefined;this._jsonData.timeScale=p&&p.timeScale?p.timeScale:1.0;this._jsonData.preDelay=p&&p.preDelay?p.preDelay:0.0;this._jsonData.postDelay=p&&p.postDelay?p.postDelay:0.0;this._jsonData.repeats=p&&p.repeats?p.repeats:1;this._jsonData.reversed=p&&p.reversed?p.reversed:false;this._jsonData.infinite=p&&p.infinite?p.infinite:false;}});
b.prototype.setJSONModel=function(m){this._model=m;if(this._sequence){this._sequence.setJSONModel(m);}return this;};
b.prototype.getId=function(){return this._jsonData.id;};
b.prototype.getStartTime=function(){return this._jsonData.startTime;};
b.prototype.setStartTime=function(s){this._jsonData.startTime=s;if(this._model){this._model.updateBindings();}return this;};
b.prototype.getSequence=function(){return this._sequence;};
b.prototype.setSequence=function(s){this._sequence=s;this._jsonData.sequence=s.getJSONData();if(this._model){this._model.updateBindings();}return this;};
b.prototype.getTimeScale=function(){return this._jsonData.timeScale;};
b.prototype.setTimeScale=function(t){this._jsonData.timeScale=t;if(this._model){this._model.updateBindings();}return this;};
b.prototype.getPreDelay=function(){return this._jsonData.preDelay;};
b.prototype.setPreDelay=function(p){this._jsonData.preDelay=p;if(this._model){this._model.updateBindings();}return this;};
b.prototype.getPostDelay=function(){return this._jsonData.postDelay;};
b.prototype.setPostDelay=function(p){this._jsonData.postDelay=p;if(this._model){this._model.updateBindings();}return this;};
b.prototype.getRepeats=function(){return this._jsonData.repeats;};
b.prototype.setRepeats=function(r){this._jsonData.repeats=r;if(this._model){this._model.updateBindings();}return this;};
b.prototype.getReversed=function(){return this._jsonData.reversed;};
b.prototype.setReversed=function(r){this._jsonData.reversed=r;if(this._model){this._model.updateBindings();}return this;};
b.prototype.getInfinite=function(){return this._jsonData.infinite;};
b.prototype.setInfinite=function(i){this._jsonData.infinite=i;if(this._model){this._model.updateBindings();}return this;};
b.prototype.getDuration=function(){var s=this._sequence?this._sequence.getDuration():0;return this._jsonData.preDelay+this._jsonData.postDelay+s*this._jsonData.repeats*this._jsonData.timeScale;};
b.prototype.getJSONData=function(){return this._jsonData;};
b.prototype.getNodeBoundaryProperty=function(n,t,i){var p;var c;if(i){c=this._nodeEndPropertiesMap;}else{c=this._nodeStartPropertiesMap;}if(c){var d=c.get(n);if(d){p=d[t];}}return p;};
b.prototype._hasCompleteNodesBoundaryProperties=function(){if(!this._nodeEndPropertiesMap||!this._nodeEndPropertiesMap.size||!this._nodeStartPropertiesMap||!this._nodeStartPropertiesMap.size){return false;}return true;};
b.prototype._clearNodesBoundaryProperties=function(){if(this._nodeEndPropertiesMap){this._nodeEndPropertiesMap.clear();}if(this._nodeStartPropertiesMap){this._nodeStartPropertiesMap.clear();}};
b.prototype._setCurrentNodesPropertiesAsBoundary=function(v,i,f){if(!f&&((this._nodeEndPropertiesMap&&this._nodeEndPropertiesMap.size&&i)||(this._nodeStartPropertiesMap&&this._nodeStartPropertiesMap.size&&!i))){return;}var n;if(i){if(!this._nodeEndPropertiesMap){this._nodeEndPropertiesMap=new Map();}else{this._nodeEndPropertiesMap.clear();}n=this._nodeEndPropertiesMap;}else{if(!this._nodeStartPropertiesMap){this._nodeStartPropertiesMap=new Map();}else{this._nodeStartPropertiesMap.clear();}n=this._nodeStartPropertiesMap;}var s=this.getSequence();if(s){s._getCurrentNodesProperties(v,n);}};
b.prototype._getNodeEndPropertiesMap=function(){return this._nodeEndPropertiesMap;};
b.prototype._getNodeStartPropertiesMap=function(){return this._nodeStartPropertiesMap;};
return b;});
sap.ui.predefine('sap/ui/vk/AnimationPlayer',["sap/ui/core/Element","./Core","./AnimationMath","./AnimationTrackType","./AnimationTrackValueType","./glMatrix"],function(E,v,A,a,b,g){"use strict";
var c=E.extend("sap.ui.vk.AnimationPlayer",{
metadata:{associations:{viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false}},events:{viewActivated:{type:"sap.ui.vk.View"},beforeTimeChanged:{time:{type:"float"},nextTime:{type:"float"},currentPlayback:{type:"sap.ui.vk.AnimationPlayback"},nextPlayback:{type:"sap.ui.vk.AnimationPlayback"}},timeChanged:{time:{type:"float"},previousTime:{type:"float"},currentPlayback:{type:"sap.ui.vk.AnimationPlayback"},previousPlayback:{type:"sap.ui.vk.AnimationPlayback"}},stateChanged:{playing:{type:"boolean"},stopped:{type:"boolean"},endOfAnimation:{type:"boolean"}}}},
constructor:function(i,s){E.apply(this,arguments);v.observeLifetime(this);}
});
c.prototype._getViewStateManager=function(){var d=this.getViewStateManager();return d?sap.ui.getCore().byId(d):undefined;};
c.prototype.init=function(){this._step=this._step.bind(this);this._playbackCollection=null;this._currentPlayback=null;this._time=0;this._nodeChanges=new Map();v.getEventBus().subscribe("sap.ui.vk","readyForAnimation",this._onViewApplied,this);v.getEventBus().subscribe("sap.ui.vk","sequenceChanged",this._onSequenceChanged,this);v.getEventBus().subscribe("sap.ui.vk","playbacksChanged",this._onPlaybacksChanged,this);v.getEventBus().subscribe("sap.ui.vk","trackChanged",this._onTrackChanged,this);v.getEventBus().subscribe("sap.ui.vk","nodeAnimationRemoved",this._onNodeAnimationRemoved,this);};
c.prototype.exit=function(){this._playbackCollection=null;this._currentPlayback=null;v.getEventBus().unsubscribe("sap.ui.vk","readyForAnimation",this._onViewApplied,this);v.getEventBus().unsubscribe("sap.ui.vk","sequenceChanged",this._onSequenceChanged,this);v.getEventBus().unsubscribe("sap.ui.vk","playbacksChanged",this._onPlaybacksChanged,this);v.getEventBus().unsubscribe("sap.ui.vk","trackChanged",this._onTrackChanged,this);v.getEventBus().unsubscribe("sap.ui.vk","nodeAnimationRemoved",this._onNodeAnimationRemoved,this);};
c.prototype._onViewApplied=function(d,e,f){if(f.source.getId()!=this.getViewStateManager()){return;}var h=f.view;var i=f.ignoreAnimationPosition;this.activateView(h,i);};
c.prototype._onSequenceChanged=function(d,e,f){if(this._currentPlayback){var h=this._getViewStateManager();var s=this._currentPlayback.getSequence();if(h&&s){if(s.getId()===f.sequenceId){h.setJoints(s.getJoint(),this._currentPlayback);}}}this._clearPlaybackBoundaryProperties();this._setPlaybackBoundaryProperties();};
c.prototype._resetNodesAnimation=function(n,p){if(!Array.isArray(n)){n=[n];}var d=this._getViewStateManager();n.forEach(function(e){if(p){d.resetNodeProperty(e,p);}else{d.resetNodeProperty(e);d.resetNodeProperty(e,a.Opacity);}});};
c.prototype._onPlaybacksChanged=function(d,e,f){if(f.operation==="playbackRemoved"&&this._currentPlayback&&this._currentPlayback===f.playback&&this._currentPlayback.getSequence()){var h=this._currentPlayback.getSequence().getNodeAnimation();var i=h.map(function(j){return j.nodeRef;});this._resetNodesAnimation(i);}this._clearPlaybackBoundaryProperties();};
c.prototype._onTrackChanged=function(d,e,f){this._clearPlaybackBoundaryProperties();if(f.emptyTrack&&this._currentPlayback){var h=this._getViewStateManager();var s=this._currentPlayback.getSequence();if(h&&s){var i=s.getNodeAnimation();i.forEach(function(j){for(var t in a){var k=a[t];var l=j[k];if(l&&l.getId()===f.trackId){h.resetNodeProperty(j.nodeRef,k);return;}}});}this._setPlaybackBoundaryProperties();}};
c.prototype._onNodeAnimationRemoved=function(d,e,f){if(this._currentPlayback){var h=this._getViewStateManager();var s=this._currentPlayback.getSequence();if(h&&s){if(s.getId()===f.sequenceId){h.setJoints(s.getJoint(),this._currentPlayback);this._resetNodesAnimation(f.nodeRefs,f.property);}}}this._clearPlaybackBoundaryProperties();};
c.prototype.getAnimatedProperty=function(n,p){var r={};var d=this._getViewStateManager();if(!d){return null;}if(p!==a.Opacity){var w=d.getTransformationWorld(n);if(p===a.Rotate){r.world=w.quaternion;}else if(p===a.Translate){r.world=w.translation;}else{r.world=w.scale;}}var e=this._nodeChanges.get(n);if(!e||e[p]===undefined){r.offsetToPrevious=null;r.offsetToRest=null;if(p===a.Opacity){r.absolute=d.getOpacity(n);r.totalOpacity=d.getTotalOpacity(n);}else{var t=d.getTransformation(n);if(p===a.Rotate){r.absolute=t.quaternion;}else if(p===a.Translate){r.absolute=t.translation;}else{r.absolute=t.scale;}}return r;}if(p===a.Opacity){var o=e[p];r.offsetToRest=o;r.offsetToPrevious=e.offsetToPrevious[p];r.opacity=e.absolute.opacity;r.totalOpacity=e["totalOpacity"];return r;}var f=e[p];r.offset=f;if(p===a.Rotate){r.absolute=e.absolute.quaternion;}else if(p===a.Translate){r.absolute=e.absolute.translate;}else{r.absolute=e.absolute.scale;}r.offsetToPrevious=e.offsetToPrevious[p];r.offsetToRest=e[p];return r;};
c.prototype.setTime=function(t,p,d){this._setPlaybackBoundaryProperties();this._setTime(t,p,d);return this;};
c.prototype._setTime=function(t,p,d){var e=this._time;var f=this._currentPlayback;if(!this._playbackCollection||!Array.isArray(this._playbackCollection.getPlaybacks())){this._currentPlayback=undefined;this._time=0;}else{if(p!=null){t=this._getAbsoluteTime(t,p);}var h=this._getViewStateManager();var i=this._currentPlayback;var n;if(t<0||t>this.getTotalDuration()){n=undefined;}else if(p!=null){n=this._playbackCollection.getPlayback(p);}else{n=this._findPlaybackByAbsoluteTime(t);}if(!d&&(t!==this._time||n!==this._currentPlayback)){this.fireBeforeTimeChanged({time:this._time,nextTime:t,currentPlayback:this._currentPlayback,nextPlayback:n});}this._time=t;this._currentPlayback=n;if(h&&this._currentPlayback&&i!==this._currentPlayback){var s=this._currentPlayback.getSequence();if(s){h.setJoints(s.getJoint(),this._currentPlayback);}}else if(!this._currentPlayback||!this._currentPlayback.getSequence()){h.setJoints(undefined);}if(h){var j={nodeRefs:[],positions:[]};var o={nodeRefs:[],opacities:[]};this._collectNodeChanges();this._nodeChanges.forEach(function(k,l){var m={rtranslate:k.rtranslate,rscale:k.rscale,rrotate:k.rrotate,Euler:k.Euler,ropacity:k.offsetToPrevious&&k.offsetToPrevious.ropacity?k.offsetToPrevious.ropacity:k.ropacity};h.setInterpolatedRelativeValues(l,m);var r=h.getRestTransformation(l);var q=h._addToTransformation(r,k.rtranslate,k.rrotate,k.rscale,k.originalRotationType,k.Euler);if(q){j.nodeRefs.push(l);j.positions.push(q);k.absolute={};k.absolute.translate=q.translation;k.absolute.scale=q.scale;k.absolute.quaternion=q.quaternion;}if(k[a.Opacity]!==undefined){var u=h.getRestOpacity(l);if(u===0){u=1;}var w=k[a.Opacity]*u;l.userData.animatedOpacity=true;k.absolute={};k.absolute.opacity=w;o.nodeRefs.push(l);o.opacities.push(w);}},this);h.setTransformation(j.nodeRefs,j.positions);h.setOpacity(o.nodeRefs,o.opacities);h._propagateOpacityToJointChildren(o.nodeRefs,o.opacities);h._setJointNodeMatrix();this._nodeChanges.forEach(function(k,l){if(k[a.Opacity]!==undefined){k.totalOpacity=h.getTotalOpacity(l);}},this);}}if(!d&&(this._time!==e||this._currentPlayback!==f)){this.fireTimeChanged({time:this._time,previousTime:e,currentPlayback:this._currentPlayback,previousPlayback:f});}};
c.prototype.getTime=function(){return this._time;};
c.prototype.getCurrentPlayback=function(){return this._currentPlayback;};
c.prototype.getCurrentPlaybackTime=function(){var t=this._time;var p=this._playbackCollection.getPlaybacks();if(!Array.isArray(p)||!this.getCurrentPlayback()){return-1;}var i=0;while(p[i]!=this.getCurrentPlayback()){t-=p[i].getDuration();i++;}return t;};
c.prototype.getStartTime=function(p){if(!this._playbackCollection){return undefined;}if(typeof p==="number"){p=this._playbackCollection.getPlayback(p);}return p?p.getStartTime():undefined;};
c.prototype.getTotalDuration=function(){if(!this._playbackCollection){return 0;}var t=0;this._playbackCollection.getPlaybacks().forEach(function(p){t+=p.getDuration();});return t;};
c.prototype._step=function(t){if(!this._lastFrameTimestamp){this._lastFrameTimestamp=t;}var p=t-this._lastFrameTimestamp;this._lastFrameTimestamp=t;var n=this.getTime()+p/1000;var r=n>=0&&n<=this.getTotalDuration();if(n>this.getTotalDuration()){n=this.getTotalDuration();}this.setTime(n);if(r){this._frameId=window.requestAnimationFrame(this._step);}else{this.stop();}};
c.prototype._interpolate=function(d,e,t,f,h){if(!e.before&&!e.after){return undefined;}if(!e.before){e.before=e.after;}if(!e.after){if(d===b.AngleAxis){e.after={value:[0,0,1,0],time:e.before.time};}else{e.after=e.before;}}var k;if(e.before.time===e.after.time){k=1;}else{k=(e.time-e.before.time)/(e.after.time-e.before.time);}return A.interpolate(d,e.before,e.after,k,t,f,h);};
c.getBoundaryKey=function(t,i){var d=t.getKeysCount();if(!d){return null;}var e;if(i){e=t.getKey(0);}else{e=t.getKey(d-1);}var f=t.getKeysType();var q,r={};if(f===b.Euler){r[f]=e.value;q=A.neutralEulerToGlMatrixQuat(e.value);r.value=A.glMatrixQuatToNeutral(q);r.time=e.time;}else if(f===b.Quaternion){q=A.neutralQuatToGlMatrixQuat(e.value);r.value=A.glMatrixQuatToNeutral(q);r.time=e.time;}else if(f!==b.AngleAxis){r.value=e.value;r.time=e.time;}else{var h;var k=1;if(i){h=e;if(d>1){h=t.getKey(1);k=0;}}else{h=e;if(d>1){e=t.getKey(d-2);}}r=A.interpolate(f,e,h,k,t);r.time=i?e.time:h.time;}return r;};
c.prototype._getKeyFramesBracket=function(t,d){var k=d.getKeysCount();if(k===0){return null;}var r={time:t,before:undefined,after:undefined};for(var i=0;i<k;i++){var e=d.getKey(i);if(e.time===t){r.before=r.after=e;break;}else if(e.time>t){r.before=(i===0?undefined:d.getKey(i-1));r.after=e;break;}}if(!r.before&&!r.after&&k>0){r.before=d.getKey(k-1);}if(k>1&&(!r.after&&d.isCycleForward()||!r.before&&d.isCycleBackward())){var f=d.getKey(0).time;var h=d.getKey(k-1).time-f;var j=Math.floor((t-f)/h);var l=t-h*j;return this._getKeyFramesBracket(l,d);}return r;};
c.prototype._collectNodeChangesFromPlaybackBoundaryKeys=function(n,p,i){var s=p.getSequence();if(!s){return;}var d=s.getNodeAnimation();if(!d){return;}var e=this._getViewStateManager();var t=this;var f=function(k,l,m){if(!k||!l||m===undefined||m===null){return;}var o=n.get(k);if(o&&o.hasOwnProperty(l)){return;}if(!o){o={};n.set(k,o);}if(!o.offsetToPrevious){o.offsetToPrevious={};}if(l===a.Opacity){o[l]=m;if(!o.offsetToPrevious[l]){var q=e.getOpacity(k);var r=e.getRestOpacity(k);if(r===0){r=1;}if(r>0&&(q!==undefined||q!==null)){var u=e._getEndPropertyInPreviousPlayback(k,l,t._currentPlayback);if(u){q/=u;}o.offsetToPrevious[l]=q/r;}else{o.offsetToPrevious[l]=1;}}}else{o[l]=m.slice();var w=e.getRelativeTransformation(k);if(l===a.Scale){if(!o.offsetToPrevious[l]){o.offsetToPrevious[l]=w.scale.slice();var x=e._getEndPropertyInPreviousPlayback(k,l,t._currentPlayback);if(x){o.offsetToPrevious[l][0]/=x[0];o.offsetToPrevious[l][1]/=x[1];o.offsetToPrevious[l][2]/=x[2];}}}if(l===a.Translate){if(!o.offsetToPrevious[l]){o.offsetToPrevious[l]=w.translation.slice();var y=e._getEndPropertyInPreviousPlayback(k,l,t._currentPlayback);if(y){o.offsetToPrevious[l][0]-=y[0];o.offsetToPrevious[l][1]-=y[1];o.offsetToPrevious[l][2]-=y[2];}}}if(l===a.Rotate){o.offsetToPrevious[l]=[0,0,1,0];}else if(!o.offsetToPrevious[l]){o.offsetToPrevious[l]=[0,0,0];}}};var h;if(i){h=p._getNodeEndPropertiesMap();}else{h=p._getNodeStartPropertiesMap();}if(!h){return;}if(this._currentPlayback){var j=this._currentPlayback.getSequence();h.forEach(function(k,l){for(var m in k){if(j._isNodePropertyDefined(l,m)){continue;}f(l,m,k[m]);}},this);}};
c.prototype._collectSequenceNodeChanges=function(t,n,p,i){var s=p.getSequence();var d=s.getNodeAnimation();if(!d){return;}var e=this._getViewStateManager();var f=function(k,l,r,m){if(!k||!l||!r||r.value===undefined||r.value===null){return;}var o=n.get(k);if(!o){o={};n.set(k,o);}if(!o.animationProperties){o.animationProperties={};}o.animationProperties[l]=true;if(m){o.originalRotationType=m;}if(!o.offsetToPrevious){o.offsetToPrevious={};}var u;if(l===a.Opacity){o[l]=r.value;o.offsetToPrevious[l]=r.value;u=e._getEndPropertyInPreviousPlayback(k,l,p,true);if(u){o[l]*=u;}}else{o[l]=r.value.slice();o.offsetToPrevious[l]=r.value.slice();u=e._getEndPropertyInPreviousPlayback(k,l,p);if(u){if(l===a.Translate){o[l][0]+=u[0];o[l][1]+=u[1];o[l][2]+=u[2];}else if(l===a.Scale){o[l][0]*=u[0];o[l][1]*=u[1];o[l][2]*=u[2];}}}if(m===b.Euler||m===b.AngleAxis){o[m]=r[m].slice();o.offsetToPrevious[l]=r[m].slice();if(u){var w=A.neutralQuatToGlMatrixQuat(u);var x=A.neutralQuatToGlMatrixQuat(o[l]);var q=g.quat.multiply(g.quat.create(),x,w);o[l]=A.glMatrixQuatToNeutral(q);}}};var h=p.getReversed();var j=s.getDuration();d.forEach(function(k){var l;for(var m in a){var o=a[m];var q=k[o];if(q&&q.getKeysCount()&&(!i||(i&&q.isInfinite()))){l=this._getKeyFramesBracket(t,q);if(!l){return;}var r=q.getKeysType();var u=null;if(h){if(r===b.AngleAxis){u=this._interpolate(r,l,q,o,true);}else{var w=this._getKeyFramesBracket(j,q);var x=this._interpolate(r,w,q,o);u=this._interpolate(r,l,q,o,x.value);}}else{u=this._interpolate(r,l,q,o);}if(o===a.Rotate){f(k.nodeRef,o,u,r);}else{f(k.nodeRef,o,u);}}}},this);};
c.prototype._collectPlaybackNodeChanges=function(d,n,p){var s=p.getSequence();if(!s){return;}var t=d-p.getStartTime();if(t<0){return;}var e=s.getDuration()*p.getTimeScale()*p.getRepeats();var f=(t-p.getPreDelay())/p.getTimeScale();var h=0.0001;if(f>0&&f%s.getDuration()===0){f=s.getDuration();}else if(f>s.getDuration()+h){f=f%s.getDuration();}else if(f>s.getDuration()){f=s.getDuration();}f=p.getReversed()?p.getSequence().getDuration()-f:f;if(t<p.getPreDelay()){if(t===0){this._collectSequenceNodeChanges(f,n,p,false);}}else if(t>p.getPreDelay()+e+h){this._collectSequenceNodeChanges(f,n,p,true);}else{this._collectSequenceNodeChanges(f,n,p,false);}};
c.prototype._collectNodeChanges=function(){this._nodeChanges.clear();if(!this._currentPlayback){return;}var p=this._playbackCollection.getPlaybacks();var d=this.getTime();var i;var e=0;for(i=0;i<p.length;i++){if(this._currentPlayback&&this._currentPlayback!==p[i]){continue;}this._collectPlaybackNodeChanges(d,this._nodeChanges,p[i]);e=i;}if(!this._currentPlayback.getReversed()){for(i=e-1;i>=0;i--){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,p[i],true);}for(i=e+1;i<p.length;i++){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,p[i],false);}}else{for(i=e+1;i<p.length;i++){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,p[i],false);}for(i=e-1;i>=0;i--){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,p[i],true);}}};
c.prototype._clearPlaybackBoundaryProperties=function(){if(!this._playbackCollection){return;}var p=this._playbackCollection.getPlaybacks();for(var i=0;p&&i<p.length;i++){var d=p[i];if(!d){continue;}d._clearNodesBoundaryProperties();}};
c.prototype._setPlaybackBoundaryProperties=function(f){if(!this._playbackCollection){return;}var d=this._time;var e=this._currentPlayback;var n=false;var p=this._playbackCollection.getPlaybacks();var i;var t=0;var h,s;if(f){this._clearPlaybackBoundaryProperties();}for(i=0;i<p.length;i++){h=p[i];if(!h){continue;}var j=this._getViewStateManager();s=h.getSequence();if(j&&s){if(!f&&h._hasCompleteNodesBoundaryProperties()){continue;}t=h.getPreDelay();this._setTime(t,i,true);h._setCurrentNodesPropertiesAsBoundary(j,false,f);t+=s.getDuration();this._setTime(t,i,true);h._setCurrentNodesPropertiesAsBoundary(j,true,f);n=true;}}if(n){if(!e){this._time=d;this._setTime(this._time,null,true);this._currentPlayback=e;}else{var k=-1;var l=0;for(i=0;i<p.length;i++){h=p[i];if(h===e){k=i;break;}var m=0;s=h.getSequence();if(s){m=s.getDuration()*h.getTimeScale()*h.getRepeats();}l+=h.getPreDelay()+m+h.getPostDelay();}if(k!==-1){var o=d-l;this._setTime(o,k,true);}}}};
c.prototype.play=function(){this._lastFrameTimestamp=undefined;this._frameId=window.requestAnimationFrame(this._step);v.getEventBus().publish("sap.ui.vk","animationPlayStateChanged",{source:this,view:this._playbackCollection,playing:true,stopped:false,endOfAnimation:false});this.fireStateChanged({playing:true,stopped:false});return this;};
c.prototype.stop=function(){if(this._frameId){window.cancelAnimationFrame(this._frameId);this._frameId=undefined;}this._lastFrameTimestamp=undefined;this.fireStateChanged({playing:false,stopped:true,endOfAnimation:this.getTime()>=this.getTotalDuration()});v.getEventBus().publish("sap.ui.vk","animationPlayStateChanged",{source:this,view:this._playbackCollection,playing:false,stopped:true,endOfAnimation:this.getTime()>=this.getTotalDuration()});return this;};
c.prototype.activateView=function(d,p){this.stop();var e=this._getViewStateManager();var f=d.getPlaybacks();if(f&&f.length>0){for(var i=0;i<f.length;i++){var h=f[i];var s=h.getSequence();if(s){e._convertTracksToRelative(s,h.getReversed());}}}if(!p){this._playbackCollection=d;}else{this._playbackCollection=undefined;}this._currentPlayback=undefined;this.setTime(0);if(p){this._playbackCollection=d;}this.fireViewActivated({view:d});return this;};
c.prototype._getAbsoluteTime=function(t,p){if(!this._playbackCollection||!Array.isArray(this._playbackCollection.getPlaybacks())){return-1;}var d=this._playbackCollection.getPlaybacks();if(p<0||p>=d.length){return-1;}var e=this._playbackCollection.getPlayback(p);if(!e||e.getDuration()<t||t<0){return-1;}var f=t;var i=0;while(i<p){var h=d[i].getDuration();f+=h;i++;}return f;};
c.prototype._findPlaybackByAbsoluteTime=function(t){if(!this._playbackCollection||!Array.isArray(this._playbackCollection.getPlaybacks())){return undefined;}var p=this._playbackCollection.getPlaybacks();var l=-1;var d=-1;p.forEach(function(f,h){if(f.getStartTime()>d){l=h;d=f.getStartTime();}});var i=0;while(i<p.length){var e=p[i].getDuration();var s=p[i].getStartTime();if((i!==l&&t>=s&&t<(s+e))||(i===l&&t>=s&&t<=(s+e))){return p[i];}i++;}return undefined;};
return c;});
sap.ui.predefine('sap/ui/vk/AnimationSequence',["sap/ui/base/Object","./AnimationTrackType","./findIndexInArray","./AnimationPlayer","./AnimationTrack","./Core"],function(B,A,f,a,b,v){"use strict";
var c=B.extend("sap.ui.vk.AnimationSequence",{constructor:function(i,p){this._jsonData={};this._jsonData.id=i;this._jsonData.name=p&&p.name?p.name:"";this._jsonData.duration=p&&p.duration?p.duration:1.0;this._jsonData.joints=[];this._jsonData.nodes=[];this._trackMap=new Map();}});
c.prototype.setJSONModel=function(m){this._model=m;return this;};
c.prototype.getId=function(){return this._jsonData.id;};
c.prototype.getName=function(){return this._jsonData.name;};
c.prototype.setName=function(n){this._jsonData.name=n;if(this._model){this._model.updateBindings();}return this;};
c.prototype.getDuration=function(){return this._jsonData.duration;};
c.prototype.setDuration=function(d,e){this._jsonData.duration=d;if(this._model){this._model.updateBindings();}if(!e){this._fireSequenceChanged();}return this;};
c.prototype._findJointIndex=function(p,n){var j=this._jsonData.joints.filter(function(d){return d.node&&d.parent;});return f(j,function(d){return(p?d.parent==p:true)&&(n?d.node==n:true);});};
c.prototype.setJoint=function(j,d){if(!Array.isArray(j)){j=[j];}j.forEach(function(e){var i=this._findJointIndex(e.parent,e.node);if(i<0){if(!e.parentSid&&e.parent&&e.parent.userData&&e.parent.userData.treeNode){e.parentSid=e.parent.userData.treeNode.sid;}if(!e.nodeSid&&e.node&&e.node.userData&&e.node.userData.treeNode){e.nodeSid=e.node.userData.treeNode.sid;}e.type="RELATIVE";this._jsonData.joints.push(e);}},this);if(this._model){this._model.updateBindings();}if(!d){this._fireSequenceChanged();}return this;};
c.prototype.getJoint=function(j){var r;if(!j||(!j.parent&&!j.node)){r=this._jsonData.joints;}else if(j&&j.node){r=this._jsonData.joints.filter(function(i){return i.node==j.node&&(j.parent?i.parent==j.parent:true);});}else if(j&&j.parent&&!j.node){r=this._jsonData.joints.filter(function(i){return i.parent==j.parent;});}return r;};
c.prototype.removeJoint=function(j){var n=[];if(!j){this._jsonData.joints.forEach(function(d){n.push(d.node);});this._jsonData.joints.splice(0);}else if(j&&(j.node||j.parent)){var i;do{i=this._findJointIndex(j.parent,j.node);if(i>=0){n.push(this._jsonData.joints[i].node);this._jsonData.joints.splice(i,1);}}while(i>=0);}if(this._model){this._model.updateBindings();}if(n.length){v.getEventBus().publish("sap.ui.vk","nodeAnimationRemoved",{nodeRefs:n,sequenceId:this._jsonData.id});}return this;};
c.prototype._findNodeIndex=function(n){return f(this._jsonData.nodes,function(d){return(d?d.nodeRef==n:true);});};
c.prototype.getNodeAnimation=function(n,p){var d=function(n,p){var i=this._findNodeIndex(n);var e,r;if(i!==-1){e=this._jsonData.nodes[i];}if(e){if(p){if(e[p]){r=this._trackMap.get(e[p]);}}else{r={nodeRef:n};for(var t in A){var g=A[t];if(e[g]){r[g]=this._trackMap.get(e[g]);}}}}return r;}.bind(this);var r;if(n&&!Array.isArray(n)){return d(n,p);}else if(!n){r=[];this._jsonData.nodes.forEach(function(e){r.push(d(e.nodeRef,p));},this);}else{r=[];n.forEach(function(e){r.push(d(e,p));},this);}return r;};
c.prototype.setNodeAnimation=function(n,p,t,d){var i=this._findNodeIndex(n);var e;if(i!==-1){e=this._jsonData.nodes[i];}if(!e){e={};e.nodeRef=n;if(n.userData&&n.userData.treeNode){e.sid=n.userData.treeNode.sid;}this._jsonData.nodes.push(e);}e[p]=t.getJSONData();this._trackMap.set(t.getJSONData(),t);t.setJSONModel(this._model);if(this._model){this._model.updateBindings();}if(!d){this._fireSequenceChanged();}return this;};
c.prototype.removeNodeAnimation=function(n,d,e){var i=this._findNodeIndex(n);if(i===-1){return this;}var g=this._jsonData.nodes[i];var t;if(!d){for(var p in g){t=this._trackMap.get(g[p]);if(t){t.setJSONModel(null);this._trackMap.delete(g[p]);}}this._jsonData.nodes.splice(i,1);}else{t=this._trackMap.get(g[d]);if(t){t.setJSONModel(null);this._trackMap.delete(g[d]);delete g[d];}}if(this._model){this._model.updateBindings();}if(!e){v.getEventBus().publish("sap.ui.vk","nodeAnimationRemoved",{nodeRefs:[n],property:d,sequenceId:this._jsonData.id});}return this;};
c.prototype.resetDuration=function(d){var m=0;this._jsonData.nodes.forEach(function(n){var t;for(var e in n){if(e==="sid"){continue;}var g=this._trackMap.get(n[e]);if(g){if(g.getKeysCount()){var k=g.getKey(g.getKeysCount()-1);t=k.time;}if(t&&t>m){m=t;}}}},this);if(m>0.0){this._jsonData.duration=m;if(this._model){this._model.updateBindings();}}if(!d){this._fireSequenceChanged();}return this;};
c.prototype.getNodesBoundaryValues=function(i){var r=new Map();var s=function(n,p,d){var e=r.get(n);if(!e){e={};r.set(n,e);}e[p]=d;};this._jsonData.nodes.forEach(function(n){for(var t in n){if(t==="sid"){continue;}var d=this._trackMap.get(n[t]);if(d&&d.getKeysCount()){var e=a.getBoundaryKey(d,i);s(n.nodeRef,t,e.value);}}}.bind(this));return r;};
c.prototype._fireSequenceChanged=function(){v.getEventBus().publish("sap.ui.vk","sequenceChanged",{sequenceId:this._jsonData.id});};
c.prototype._isNodePropertyDefined=function(n,p){var t=this.getNodeAnimation(n,p);if(t&&t.getKeysCount()){return true;}var j={node:n};var d=this.getJoint(j);if(d&&d.length){return true;}return false;};
c.prototype._getCurrentNodesProperties=function(d,n){this._jsonData.nodes.forEach(function(e){var g={};var t=d.getRelativeTransformation(e.nodeRef);for(var p in e){if(p===A.Rotate){g[A.Rotate]=t.quaternion.slice();}else if(p===A.Translate){g[A.Translate]=t.translation.slice();}else if(p===A.Scale){g[A.Scale]=t.scale.slice();}else if(p===A.Opacity){var o=d.getOpacity(e.nodeRef);var r=d.getRestOpacity(e.nodeRef);if(o!==null&&o!==undefined){if(!r){r=1;}g[A.Opacity]=o/r;}}}n.set(e.nodeRef,g);});this._jsonData.joints.forEach(function(j){if(!j.node||!j.parent){return;}var e={};var t=d.getRelativeTransformation(j.node);e[A.Rotate]=t.quaternion.slice();e[A.Translate]=t.translation.slice();e[A.Scale]=t.scale.slice();var o=d.getOpacity(j.node);var r=d.getRestOpacity(j.node);if(o!==null&&o!==undefined){if(!r){r=1;}e[A.Opacity]=o/r;}n.set(j.node,e);});};
c.prototype.getJSONData=function(){return this._jsonData;};
return c;});
sap.ui.predefine('sap/ui/vk/AnimationTimeSlider',["sap/m/Slider","./AnimationTimeSliderRenderer"],function(S,A){"use strict";
var a=S.extend("sap.ui.vk.AnimationTimeSlider",{metadata:{library:"sap.ui.vk"}});
a.prototype.init=function(){if(S.prototype.init){S.prototype.init.call(this);}};
a.prototype.handleAnimationStarted=function(e){this.setProgress(true);this.setValue(0);this.setStep(0.1);};
a.prototype.handleAnimationUpdated=function(e){var v=e.getParameter("value");this.setValue(v);};
a.prototype.handleAnimationFinished=function(e){this.setValue(100);};
return a;});
sap.ui.predefine('sap/ui/vk/AnimationTimeSliderRenderer',["sap/m/SliderRenderer"],function(S){"use strict";return S;},true);
sap.ui.predefine('sap/ui/vk/AnimationTrack',["sap/ui/base/Object","./AnimationTrackValueType","./findIndexInArray","./Core"],function(B,A,f,v){"use strict";
var c=B.extend("sap.ui.vk.AnimationTrack",{constructor:function(i,p){this._jsonData={};this._jsonData.id=i;this._jsonData.type=p&&p.trackValueType?p.trackValueType:A.Scalar;this._jsonData.keys=[];this._jsonData.cycleForward=!!(p&&p.cycleForward);this._jsonData.cycleBackward=!!(p&&p.cycleBackward);this._jsonData.infinite=!!(p&&p.infinite);this._jsonData._isAbsoluteValue=p&&p.isAbsoluteValue?p.isAbsoluteValue:false;}});
c.prototype.setJSONModel=function(m){this._model=m;return this;};
c.prototype.getIsAbsoluteValue=function(){return this._jsonData._isAbsoluteValue;};
c.prototype.setIsAbsoluteValue=function(i){this._jsonData._isAbsoluteValue=i;};
c.prototype.getId=function(){return this._jsonData.id;};
c.prototype.getKeysType=function(){return this._jsonData.type;};
c.prototype.setKeysType=function(t){if(this.getKeysCount()>0){return false;}this._jsonData.type=t;return true;};
c.prototype.isCycleForward=function(){return this._jsonData.cycleForward;};
c.prototype.setCycleForward=function(a){this._jsonData.cycleForward=a;if(this._model){this._model.updateBindings();}return this;};
c.prototype.isCycleBackward=function(){return this._jsonData.cycleBackward;};
c.prototype.setCycleBackward=function(a){this._jsonData.cycleBackward=a;if(this._model){this._model.updateBindings();}return this;};
c.prototype.isInfinite=function(){return this._jsonData.infinite;};
c.prototype.setInfinite=function(i){this._jsonData.infinite=i;if(this._model){this._model.updateBindings();}return this;};
c.prototype.getKeysCount=function(){return this._jsonData.keys.length;};
c.prototype.getKey=function(i){if(i<0||i>=this._jsonData.keys.length){return undefined;}return this._jsonData.keys[i];};
c.prototype.updateKey=function(i,a,b){if(i>=0||i<this._jsonData.keys.length){this._jsonData.keys[i].value=a;if(this._model){this._model.updateBindings();}}if(!b){this._fireTrackChanged();}return this;};
c.prototype.removeKey=function(i,b){var e=false;if(i>=0||i<this._jsonData.keys.length){this._jsonData.keys.splice(i,1);if(this._jsonData.keys.length===0){e=true;}if(this._model){this._model.updateBindings();}}if(!b){this._fireTrackChanged(e);}return this;};
c.prototype.findKeyIndex=function(t){var i=-1;if(this._jsonData.keys.length===1){i=0;}else if(this._jsonData.keys.length>1){for(var a=1;a<this._jsonData.keys.length;a++){var l=this.getKey(a-1);var r=this.getKey(a);if(t>=l.time&&t<=r.time){i=t-l.time<r.time-t?a-1:a;break;}}}return i;};
c.prototype.insertKey=function(t,d,e){var i=f(this._jsonData.keys,function(k){return k.time===t;});if(i<0){this._jsonData.keys.push({time:t,value:d});this._jsonData.keys.sort(function(a,b){return a.time-b.time;});}else{this.updateKey(i,d,true);if(this._model){this._model.updateBindings();}}if(!e){this._fireTrackChanged();}return this;};
c.prototype._fireTrackChanged=function(e){v.getEventBus().publish("sap.ui.vk","trackChanged",{trackId:this._jsonData.id,emptyTrack:e});};
c.prototype.getJSONData=function(){return this._jsonData;};
return c;});
sap.ui.predefine('sap/ui/vk/AnimationTrackValueTypeSize',["./AnimationTrackValueType"],function(A){"use strict";var a={};
a.get=function(v){switch(v){case A.Vector3:return 3;case A.AngleAxis:return 4;case A.Quaternion:return 4;case A.Euler:return 4;default:return 1;}};
return a;},true);
sap.ui.predefine('sap/ui/vk/Annotation',["sap/ui/core/Control","./Core","./AnnotationStyle","./NodeUtils","sap/m/FormattedText","sap/ui/richtexteditor/RichTextEditor","sap/ui/richtexteditor/library","./AnnotationRenderer"],function(C,v,A,N,F,R,r,a){"use strict";
var b=C.extend("sap.ui.vk.Annotation",{
metadata:{properties:{annotationId:"string",name:"string",nodeRef:"any",text:{type:"string",defaultValue:""},style:{type:"sap.ui.vk.AnnotationStyle",defaultValue:A.Default},display:{type:"boolean",defaultValue:false},animate:{type:"boolean",defaultValue:true},animationDelay:{type:"float",defaultValue:-1},selected:{type:"boolean",defaultValue:false},editable:{type:"boolean",defaultValue:false},xCoordinate:{type:"float",defaultValue:0},yCoordinate:{type:"float",defaultValue:0},xOffset:{type:"float",defaultValue:0},yOffset:{type:"float",defaultValue:0},height:{type:"float"},width:{type:"float"}},associations:{viewport:{type:"sap.ui.vk.Viewport",multiple:false}},aggregations:{textEditor:{type:"sap.ui.core.Control",multiple:false}}},
constructor:function(i,S){C.apply(this,arguments);}
});
b.prototype.setViewport=function(d){this.setAssociation("viewport",d);this._viewport=sap.ui.getCore().byId(this.getViewport());};
b.prototype._firePositionChanged=function(d){v.getEventBus().publish("sap.ui.vk","annotationPositionChanged",{annotation:d,x:d.getXCoordinate(),y:d.getYCoordinate()});};
b.prototype._fireSizeChanged=function(d,e,f){v.getEventBus().publish("sap.ui.vk","annotationSizeChanged",{annotation:d,width:e,height:f});};
b.prototype.getTargetNodes=function(){this._targetNodes=this._targetNodes||[];return this._targetNodes;};
b.prototype.getAttachmentNode=function(){return this._attachmentNode;};
b.prototype.setAttachmentNode=function(d){this._attachmentNode=d;this.rerender();};
b.prototype.getDisplay=function(){if(this.getNodeRef()){var d=sap.ui.getCore().byId(this._viewport.getViewStateManager());return d.getVisibilityState(this.getNodeRef());}return this.getProperty("display");};
b.prototype.setDisplay=function(d){var e=sap.ui.getCore().byId(this._viewport.getViewStateManager());var n=this.getNodeRef();if(n&&e.getVisibilityState(n)!==d){e.setVisibilityState(n,d);}if(this.getProperty("display")===d){return this;}this.setProperty("display",d,true);var f=this.getDomRef();if(f){if(d){this._reverse=false;this.rerender();}else{this._reverse=true;this.rerender();}}return this;};
b.prototype.getSelected=function(){if(this.getNodeRef()){var d=sap.ui.getCore().byId(this._viewport.getViewStateManager());return d.getSelectionState(this.getNodeRef());}return this.getProperty("selected");};
b.prototype.setSelected=function(d){this.setProperty("selected",d,!this.getEditable());if(d){this._setMaxZ();}var e=sap.ui.getCore().byId(this._viewport.getViewStateManager());var n=this.getNodeRef();if(e.getSelectionState(n)!==d){e.setSelectionState(n,d);}this._moving=false;return this;};
b.prototype.setAnnotationId=function(n){this.setProperty("annotationId",n,true);if(this._viewport&&this.sourceData){this._viewport.getScene().setAnnotationPersistentId(this.sourceData.annotation,n);}};
b.prototype._getNodeRefScreenCenter=function(d,n){var e=N.centerOfNodes([n]);return d.projectToScreen(e[0],e[1],e[2],d.getCamera());};
b.prototype._getSortIndex=function(d){this.zIndex=this.zIndex||"auto";var n=this.getTargetNodes()[0];if(n){var e=N.centerOfNodes([n]);var f=d.projectToScreen(e[0],e[1],e[2],d.getCamera());this.zIndex=Math.floor(10000*(1-f.depth));}return this.zIndex;};
b.prototype._getOpacity=function(){if(this._viewport){var z=this.zIndex;var d=[];this._viewport.getAnnotations().forEach(function(h){if(h.getDisplay()===true){d.push(h);}});if(d.length>1){var e=Array.from(d,function(h){return h.zIndex;});var f=Math.max.apply(null,e);var g=Math.min.apply(null,e);return 0.7+(z-g)*0.3/(f-g);}}return 1;};
b.prototype._updateBlocked=function(){var t=this.getTargetNodes()[0];if(this.getDisplay()&&t){var d=this._viewport;var e=d.getDomRef().getBoundingClientRect();var n=this._getNodeRefScreenCenter(d,t);var h=d.hitTest(n.x,e.height-n.y);var f=this.getDomRef();if(t.visible==false){f.style.visibility="hidden";}else{f.style.visibility="visible";}if(h&&f){var g=[];t._vkTraverseMeshNodes(function(k){g.push(k);});if(g.indexOf(h.object)>=0){f.style.visibility="visible";}else{var i=sap.ui.getCore().byId(d.getViewStateManager());var w=i.getTransformationWorld(h.object).translation;var j=d.projectToScreen(w[0],w[1],w[2],d.getCamera());if(j.depth<n.depth){f.style.visibility="hidden";}}}}return this.getDisplay();};
b.prototype.setName=function(n){this.setProperty("name",n);if(this.getNodeRef()){this.getNodeRef().name=n;}};
b.prototype.getName=function(){if(this.getNodeRef()){return this.getNodeRef().name;}return this.getProperty("name");};
b.prototype.setText=function(t){this.setProperty("text",t,true);if(this.sourceData){this.sourceData.annotation.text={html:t};}if(this.getTextEditor()){this._textDiv.value=t;return this;}if(this._textDiv==null){this._textDiv=new F({width:this._textWidth?this._textWidth+"px":"auto",height:this._textHeight?this._textHeight+"px":"auto"});this._textDiv.addStyleClass("sapUiVizKitAnnotationText");}if(this.getStyle()===A.Random&&this.getAnimate()){this._setRandomText(t);}else if(this.getStyle()===A.Expand&&this.getAnimate()){this._setExpandText(t);}else{this._textDiv.setHtmlText(t);}this._textDiv.rerender();this.update();return this;};
b.prototype._setRandomText=function(t){if(this.getTextEditor()){return this;}var n="";for(var i=0;i<t.length;i++){if(t[i]==="<"){n+="<";while(t[i]!==">"){i++;n+=t[i];}}if(t[i]!==">"){var d=this.getAnimationDelay();if(d===-1){d=0;}var e=(d+Math.random())+"s";var f=this.getAnimate()?"annotationRandomTextSpan":"annotationStatic";n+="<span style='animation: "+f+" 4s linear "+e+" 1 alternate both;'>";n+=t[i];n+="</span>";}}this._textDiv.setHtmlText(n);return this;};
b.prototype._setExpandText=function(t){if(this.getTextEditor()){return this;}var n="";var l=t.length;for(var i=0;i<l;i++){if(t[i]==="<"){n+="<";while(t[i]!==">"){i++;n+=t[i];}}if(t[i]!==">"){var d=(this.getAnimationDelay()+0.5+"s");var e=this.getAnimate()?"annotationExpandTextSpan":"annotationStatic";n+="<span style='animation: "+e+" "+((0.1/l)*(i+1))+"s linear "+d+" ;'>";n+=t[i];n+="</span>";}}this._textDiv.setHtmlText(n);return this;};
b.prototype.setStyle=function(d){this.setProperty("style",d);if(this.sourceData){this.sourceData.annotation.style=d;}this.setText(this.getText());};
b.prototype.setAnimate=function(d){this.setProperty("animate",d);if(this.sourceData){this.sourceData.annotation.animate=d;}this.setText(this.getText());};
b.prototype._setMaxZ=function(){var d=this.getDomRef();if(d){var m=Math.max.apply(null,this._viewport.getAnnotations().map(function(e){return e.zIndex||1;}));if(!this.zIndex||this.zIndex<m){this.zIndex=m+1;}d.style.zIndex=this.zIndex;}};
b.prototype.onclick=function(e){if(this.getTextEditor()==null&&!this._moving){if(this._firstClick){v.getEventBus().publish("sap.ui.vk","annotationDoubleClicked",{annotation:this});this._firstClick=false;}else{this._firstClick=true;setTimeout(function(){if(this._firstClick){this._firstClick=false;this._viewport.tapObject(this.getNodeRef());}}.bind(this),250);}}e.stopPropagation();};
b.prototype.openEditor=function(){if(!this.getEditable()){return null;}var d=new R({editorType:r.EditorType.TinyMCE4,width:this._textDiv.getWidth(),height:this._textDiv.getHeight(),value:this.getText()});if(this._textDiv){this._textDiv.destroy();}d.addStyleClass("sapUiVizKitRichTextEditor");this._textDiv=d;this.setTextEditor(d);return d;};
b.prototype.closeEditor=function(){if(this.getTextEditor()==null){return;}var t=this._textDiv.getValue();this.destroyTextEditor();this._textDiv=null;this.setText(t);};
b.prototype.onAfterRendering=function(){var d=this.getDomRef();if(d){this._initialOffsetWidth=d.offsetWidth;this._initialOffsetHeight=d.offsetHeight;if(!this.getDisplay()){d.style.visibility="hidden";}if(this.getAnimate()&&this.getAnimationDelay()>0){d.style.animationDelay=this.getAnimationDelay()+"s";}this.setXCoordinate(this.getXCoordinate());this.setYCoordinate(this.getYCoordinate());this.setWidth(this.getWidth());this.setHeight(this.getHeight());this.update();}this.setEditableState(this.getEditable()&&this.getSelected());if(this.zIndex){d.style.zIndex=this.zIndex;}};
b.prototype.setEditable=function(e){if(this.getEditable()==e){return;}this.setProperty("editable",e);if(this.sourceData){this.sourceData.annotation.editable=e;}this._previousState=this._previousState||{};var d=this.getDomRef();if(d&&e){var f=d.getBoundingClientRect();this._previousState.x=f.x;this._previousState.y=f.y;}};
b.prototype.setHeight=function(h){if(h<0){return;}this.setProperty("height",h,true);if(this.getNodeRef()){this.getNodeRef().scale.setY(h);}if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){var d=this._viewport.deNormalizeRectangle(0,0,0,h);var t=this._textDiv.getDomRef();if(this._textDiv.getNativeApi){if(this._resized){t.style.height="calc("+d.height+"px)";}else{t.style.height="calc("+d.height+"px + 0.6rem)";}}else{t.style.height="calc("+d.height+"px - 1rem)";}if(t.clientHeight<t.scrollHeight){t.style.height="calc("+t.scrollHeight+"px - 1rem)";}}};
b.prototype.setWidth=function(w){if(w<0){return;}this.setProperty("width",w,true);if(this.getNodeRef()){this.getNodeRef().scale.setX(w);}if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){var d=this._viewport.deNormalizeRectangle(0,0,w,0);var t=this._textDiv.getDomRef();if(this._textDiv.getNativeApi){if(this._resized){t.style.width="calc("+d.width+"px)";}else{t.style.width="calc("+d.width+"px + 0.6rem)";}}else{t.style.width="calc("+d.width+"px - 1rem)";}if(t.clientHeight<t.scrollHeight){t.style.height="calc("+t.scrollHeight+"px - 1rem)";}t.style.maxWidth=t.style.width;}};
b.prototype.setXCoordinate=function(x){this.setProperty("xCoordinate",x,true);if(this.getNodeRef()){this.getNodeRef().position.setX(x);}if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){var d=this._viewport.deNormalizeRectangle(x,0,0,0);this.getDomRef().style.left=d.x+"px";}};
b.prototype.setYCoordinate=function(y){this.setProperty("yCoordinate",y,true);if(this.getNodeRef()){this.getNodeRef().position.setY(y);}if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){var d=this._viewport.deNormalizeRectangle(0,y,0,0);this.getDomRef().style.top=d.y+"px";}};
b.prototype._resizeEnd=function(){this._handleViewportStop();var t=this._textDiv.getDomRef();var d=this._viewport.normalizeRectangle(0,0,t.clientWidth,t.clientHeight);this._resized=true;this.setWidth(d.width);this.setHeight(d.height);this._fireSizeChanged(this,d.width,d.height);};
b.prototype.setEditableState=function(e){if(!e){this.ontouchstart=null;return;}var d=new Map();var f=[];var g=this._viewport;var h=function(){f=g.getAnnotations().filter(function(z){return z.getEditable()&&z.getSelected();});f.forEach(function(i){var z=window.getComputedStyle(i._textDiv.getDomRef());var B=parseInt(z.width.slice(0,-2),10);var D=parseInt(z.height.slice(0,-2),10);var E=parseInt(z.maxWidth.slice(0,-2),10);d.set(i.getAnnotationId(),{width:B,height:D,maxWidth:E});});};var t=this;var i=this.getDomRef();var j=i.childNodes;var k={strategies:{"sapUiVizKitAnnotationElement0":n,"sapUiVizKitAnnotationElement1":o,"sapUiVizKitAnnotationElement2":p,"sapUiVizKitAnnotationElement3":q,"sapUiVizKitAnnotationElement4":u,"sapUiVizKitAnnotationElement5":w,"sapUiVizKitAnnotationElement6":x,"sapUiVizKitAnnotationElement7":y},resize:l};this.ontouchstart=function(z){var E=z||event;E.stopPropagation();h();var B=k.strategies[E.targetTouches[0].target.className];if(B){k.resize(E,B);}else{t._previousState.offsetTop=t._offsetTop;t._previousState.offsetLeft=t._offsetTop;f.forEach(function(i){i._initialX=E.clientX?E.clientX:E.targetTouches[0].clientX;i._initialY=E.clientY?E.clientY:E.targetTouches[0].clientY;});var D=function(z){E=z||event;t._viewport._viewportGestureHandler._gesture=false;E.stopPropagation();f.forEach(function(i){i._moving=true;var H=E.clientX?E.clientX:E.targetTouches[0].clientX;var I=E.clientY?E.clientY:E.targetTouches[0].clientY;i._currentX=H-i._initialX;i._currentY=I-i._initialY;s(i._currentX,i._currentY,i.getDomRef());i.update();});};var G=function(z){E=z||event;E.stopPropagation();f.forEach(function(i){i._handleViewportStop();});document.removeEventListener("mousemove",D);document.removeEventListener("mouseup",G);document.removeEventListener("touchmove",D);document.removeEventListener("touchend",G);};document.addEventListener("mousemove",D);document.addEventListener("mouseup",G);document.addEventListener("touchmove",D);document.addEventListener("touchend",G);t.update();}};function l(E,z){var B=E.clientX?E.clientX:E.targetTouches[0].clientX;var D=E.clientY?E.clientY:E.targetTouches[0].clientY;var G=B-j[0].offsetLeft;var H=D-j[0].offsetTop;var T=jQuery(E.currentTarget).control()[0]._viewport.$();var I=jQuery("iframe[id$='-textarea_ifr']");if(I.length){var J=jQuery("<div></div>");J.attr("id","rte_ifr_cov");J.css({position:"absolute"});J.css({opacity:0});J.css({top:T.offset().top,left:T.offset().left});J.height(T.height());J.width(T.width());jQuery("body").append(J[0]);}document.onmousemove=function(K){t._viewport._viewportGestureHandler._gesture=false;var E=K||event;var B=E.clientX?E.clientX:E.targetTouches[0].clientX;var D=E.clientY?E.clientY:E.targetTouches[0].clientY;var L=B-G;var M=D-H;f.forEach(function(i){i._moving=true;z(i,L,M);i.update();});};document.onmouseup=function(){var I=jQuery("#rte_ifr_cov");if(I){I.remove();}f.forEach(function(i){var K=d.get(i.getAnnotationId());K.width=i._textWidth;K.height=i._textHeight;K.maxWidth=i._textMaxWidth;i._resizeEnd();});document.onmousemove=null;document.onmouseup=null;document.ontouchmove=null;document.ontouchend=null;};document.ontouchmove=document.onmousemove;document.ontouchend=document.onmouseup;}var m=function(i,z,B,D){var E=i._textDiv.getDomRef();if(z){i._textWidth=z;E.style.width=i._textWidth+"px";i._textDiv.setProperty("width",E.style.width,true);}if(B){i._textMaxWidth=B;E.style.maxWidth=i._textMaxWidth+"px";}if(D){i._textHeight=D;E.style.height=i._textHeight+"px";i._textDiv.setProperty("height",E.style.height,true);}};function n(i,z,B){m(i,d.get(i.getAnnotationId()).width-z,d.get(i.getAnnotationId()).maxWidth-z,d.get(i.getAnnotationId()).height-B);i._currentX=z;i._currentY=B;s(z,B,i.getDomRef());}function o(i,z,B){m(i,null,null,d.get(i.getAnnotationId()).height-B);i._currentX=0;i._currentY=B;s(0,B,i.getDomRef());}function p(i,z,B){m(i,d.get(i.getAnnotationId()).width+z,d.get(i.getAnnotationId()).maxWidth+z,d.get(i.getAnnotationId()).height-B);i._currentX=0;i._currentY=B;s(0,B,i.getDomRef());}function q(i,z,B){m(i,d.get(i.getAnnotationId()).width+z,d.get(i.getAnnotationId()).maxWidth+z,null);}function u(i,z,B){m(i,d.get(i.getAnnotationId()).width+z,d.get(i.getAnnotationId()).maxWidth+z,d.get(i.getAnnotationId()).height+B);}function w(i,z,B){m(i,null,null,d.get(i.getAnnotationId()).height+B);}function x(i,z,B){m(i,d.get(i.getAnnotationId()).width-z,d.get(i.getAnnotationId()).maxWidth-z,d.get(i.getAnnotationId()).height+B);i._currentX=z;i._currentY=0;s(z,0,i.getDomRef());}function y(i,z,B){m(i,d.get(i.getAnnotationId()).width-z,d.get(i.getAnnotationId()).maxWidth-z,null);i._currentX=z;i._currentY=0;s(z,0,i.getDomRef());}};
b.prototype.update=function(){var d=this.getDomRef();if(!d){return;}var i=this._updateBlocked();if(this.getProperty("display")!=i){this.setDisplay(i);}if(!this.getText()){d.style.display=this.getDisplay()?"block":"none";}var e=this.getSelected();if(this.getProperty("selected")!=e){this.setSelected(e);}var f=d.childNodes[8];var g=d.childNodes[9];if(this.getWidth()&&!this._moving){this.setWidth(this.getWidth());}if(this.getHeight()&&!this._moving){this.setHeight(this.getHeight());}this._resized=false;if(!this.getAnimate()){d.style.setProperty("--animation-name","annotationStatic");}var n=this.getTargetNodes()[0];var h=n?this._getNodeRefScreenCenter(this._viewport,n):{x:0,y:0,depth:0};var j=this._viewport.getDomRef().getBoundingClientRect();if(this.getAttachmentNode()){var k=this._getNodeRefScreenCenter(this._viewport,this.getAttachmentNode());if(k.depth>1){k.x=j.width+1000;}var l=this._viewport.normalizeRectangle(k.x,j.height-k.y,0,0);this.setXCoordinate(l.x+this.getXOffset());this.setYCoordinate(l.y+this.getYOffset());}var m=this._viewport.deNormalizeRectangle(this.getXCoordinate(),this.getYCoordinate(),0,0);if(this.getEditable()&&this.getSelected()){d.style.left=this._previousState.x-j.x+"px";d.style.top=this._previousState.y-j.y+"px";}else{switch(this.getStyle()){case A.Default:d.childNodes[0].style.visibility="hidden";d.childNodes[1].style.visibility="hidden";d.childNodes[2].style.visibility="hidden";d.childNodes[3].style.visibility="hidden";d.childNodes[4].style.visibility="hidden";break;case A.Explode:d.childNodes[0].style.visibility="hidden";d.childNodes[1].style.visibility="hidden";d.childNodes[2].style.visibility="hidden";break;case A.Square:d.childNodes[0].style.visibility="hidden";d.childNodes[1].style.visibility="hidden";d.childNodes[2].style.visibility="hidden";break;case A.Random:d.childNodes[0].style.visibility="hidden";break;default:break;}}if(n){var p=h.x-m.x;var o=j.height-h.y-m.y;if(this._moving){p-=this._currentX;o-=this._currentY;}f.style.left=p+"px";f.style.top=o+"px";var q=new Map([[A.Default,{isElbow:true,toHeight:0.5}],[A.Explode,{isElbow:true,toHeight:0.5}],[A.Square,{isElbow:false,toHeight:0.95}],[A.Random,{isElbow:false,toHeight:0.5}],[A.Expand,{isElbow:true,toHeight:0.5}]]).get(this.getStyle());c(f,d,d.childNodes[10],{isElbow:q.isElbow,toHeight:q.toHeight});}else{f.style.visibility="hidden";g.style.visibility="hidden";}this.setXCoordinate(this.getProperty("xCoordinate"));this.setYCoordinate(this.getProperty("yCoordinate"));};
b.prototype._handleViewportStop=function(){setTimeout(function(){this._moving=false;this.update();}.bind(this),300);var d=this.getDomRef();var e=window.getComputedStyle(d);var t=d.style.transform;d.style.transform="";this._currentX=0;this._currentY=0;var x=parseFloat(t.substring(t.indexOf("(")+1,t.indexOf(",")));var y=parseFloat(t.substring(t.indexOf(",")+1,t.indexOf(")")));if(x||y){d.style.left=(parseFloat(e.left)+x)+"px";d.style.top=(parseFloat(e.top)+y)+"px";this._offsetTop=d.offsetTop;this._offsetLeft=d.offsetLeft;var n=this._viewport.normalizeRectangle(this._offsetLeft,this._offsetTop,0,0);this.setXCoordinate(n.x);this.setYCoordinate(n.y);this._firePositionChanged(this);}};
function s(x,y,d){d.style.transform="translate("+x+"px, "+y+"px)";}
function c(f,t,l,o){o=o||{};var d=f.getBoundingClientRect();var e=t.getBoundingClientRect();var x=d.x-e.x+d.width/2;var y=d.y-e.y+d.height/2;var g=x<0?0:e.width;var h=e.height*(o.toHeight||0.5);if(x<0&&!t.classList.contains("leaderlineLeft")){t.classList.remove("leaderlineRight");t.classList.add("leaderlineLeft");}if(x>=0&&!t.classList.contains("leaderlineRight")){t.classList.remove("leaderlineLeft");t.classList.add("leaderlineRight");}var i=Math.min(x,g);var j=Math.min(y,h);l.style.left=i+"px";l.style.top=j+"px";l.style.width=Math.abs(g-x)+"px";l.style.height=Math.abs(h-y)+"px";var k=g>x?0:x-g;var m=h>y?0:y-h;var n=g-x;var p=h-y;var q="M"+k+" "+m+"v"+p+"h"+n;if(x>0&&x<e.width){q="M"+k+" "+m+"h"+n+"v"+p+"h-2";}if(!o.isElbow){q="M"+k+" "+m+"l"+n+" "+p;}var u=l.childNodes[0];if(q!==u.getAttribute("d")){u.setAttribute("d",q);u.style.setProperty("--stroke-dasharray",u.getTotalLength());u.style.setProperty("--stroke-dashoffset",u.getTotalLength());}}
b.prototype.setLeaderLine=function(f,t,l){var d=t.getBoundingClientRect();var T=f.offsetTop+f.offsetHeight/2;var e=d.height/2;var L=f.offsetLeft+f.offsetWidth/2;var g=0;if(L>g){g=d.width;}var h=Math.abs(e-T);var i=Math.abs(g-L);var j=Math.sqrt(h*h+i*i);var k=180/Math.PI*Math.acos(h/j);var m,n;if(e>T){m=(e-T)/2+T;}else{m=(T-e)/2+e;}if(g>L){n=(g-L)/2+L;}else{n=(L-g)/2+g;}if((T<e&&L<g)||(e<T&&g<L)||(T>e&&L>g)||(e>T&&g>L)){k*=-1;}m-=j/2;l.style.transform="rotate("+k+"deg)";l.style.top=m+"px";l.style.left=n+"px";l.style.height=j+"px";};
b.prototype.getTransform=function(){var d=this.getNodeRef();d.updateMatrix();return sap.ui.vk.TransformationMatrix.convertTo4x3(d.matrix.elements);};
b.prototype.setTransform=function(t){var d=this.getNodeRef();d.position.set(t[9],t[10],t[11]);d.scale.set(t[0],t[4],t[8]);d.updateMatrix();this.setXCoordinate(d.position.x);this.setYCoordinate(d.position.y);this.setWidth(d.scale.x);this.setHeight(d.scale.y);this.update();return this;};
b.prototype.updateNodeId=function(n){var d=this.getNodeRef();d.userData.nodeId=n;this.sourceData.annotation.nodeId=n;this._viewport.getScene().setNodePersistentId(d,n);return this;};
b.prototype.setInitialOffset=function(){var t=this.getTargetNodes().values().next().value;var n={x:0,y:0,width:0.1,height:0.08};if(t&&this.getXCoordinate()===0&&this.getYCoordinate()===0){var d=this._getNodeRefScreenCenter(this._viewport,t);var e=this._viewport.getDomRef().getBoundingClientRect();var i=d.x>=e.width/2?d.x-150:d.x+50;var f=d.y>=e.height/2?f=e.height-d.y+20:e.height-d.y-120;n=this._viewport.normalizeRectangle(i,f,0,0);}this.setTransform([0.1,0,0,0,0.08,0,0,0,1,n.x,n.y,0]);return this;};
b.prototype.fitToText=function(m,d){if(this._textDiv==null||this._textDiv.getDomRef()==null){return this;}var e=document.createElement("div");e.style.setProperty("whiteSpace","nowrap","important");e.style.setProperty("visibility","hidden","important");e.style.setProperty("position","absolute");if(m!=null){e.style.maxWidth=m+"px";}if(d!=null){e.style.maxHeight=d+"px";}e.innerHTML=this._textDiv.getDomRef().innerHTML;document.body.appendChild(e);e.style.setProperty("width","calc("+e.clientWidth+"px + 1rem)");e.style.setProperty("height","calc("+e.clientHeight+"px + 1rem)");var n=this._viewport.normalizeRectangle(0,0,e.clientWidth,e.clientHeight);document.body.removeChild(e);this.setWidth(n.width);this.setHeight(n.height);return this;};
b.getStyles=function(){var d=[{style:A.Default,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAAGSM0KYAAAACXBIWXMAAAsTAAALEwEAmpwYAAALC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0MzUyLCAyMDIwLzAxLzMwLTE1OjUwOjM4ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTAzLTI2VDE0OjM1OjIzKzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wMy0yNlQxNDozNToyMysxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MmZhNTI3NDEtOGZkZi00NTM0LWE0N2UtMWRmZWMyOTc3NTliIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6MDRkNjFiNzktZDUxMC01MDQwLThjNjYtYjk4ZWIyZWMxOWI0IiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjcyOWFhOWVjLTE0ZmItNDdiZS1hNTNhLTAyYzgyOWEyMjlhOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNToyMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjJmYTUyNzQxLThmZGYtNDUzNC1hNDdlLTFkZmVjMjk3NzU5YiIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNToyMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjcyOWFhOWVjLTE0ZmItNDdiZS1hNTNhLTAyYzgyOWEyMjlhOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiLz4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJURVhUIiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJURVhUIi8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8cmRmOmxpIHBob3Rvc2hvcDpMYXllck5hbWU9IlRleHQiIHBob3Rvc2hvcDpMYXllclRleHQ9IlRleHQiLz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJUZXh0IiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJUZXh0Ii8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOlRleHRMYXllcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+ZojRogAABeNJREFUeJztnD1MHEcUx/9vdD6wZURcGFzFBZGSCndxZUp3HE3iYCkHrJlxFXd2FUtRJFK5tKsc6IRoiNMdVRASkqloEU2kKAqWIhmQJZ9BOmxgXorsntbLzd7u7e7tHuxPGrG3HzPz5r35ePMBMTOEEKy1JhhwPy/Y9y4LIfpNH7gjE96HSqmG6UMAADODiPrd4cGDB8r9m5nhBLJlMGbHztKRc+3IcKS1Nn4ghIDznJjZN8tnPjbFaIKIKLAOAFuGNkJfNmaprQ7sPLG7zKWUjycmJoa9eiAitv8Se5P1orU+cmQpODdML3tLTPiVkB3Zpx+0i9H1IQFo2lJbOQLQ0rzMJhASk+0WWt71UCqVBq9fv/6IiAbn5+efhEk4tiJya95t3rEVkUnZjt35mlIUQrcXYQlURIeHh3x8fNxRTtxK7rio/PqVQI12EEztR2xWZCK9BKanp8eUUg0p5ar7vpTyZZgEfHVgdxGvT05OHgshbgohysxcn5+fv+t916SDtm0RM+8IIW4JIcYBjBLR69gkCMP5taLmYAcwdxrt8B26ZKKxSzwBpzFMJAG7fP/2K2c/2urAHs0ygI6a8mYCMY2N4sB3+O4lcSNKmswJELYtyZwAYYkkgNvjmp2dfTo5OXnTuQYAy7LKlmWVlVJ/RsummVg0oJRqENHY1atXK1LKZwsLC3NKqcbbt29r1Wp1iZl3ImfU1NY2XX6Paxo2TE1NfW165nVx/YJ7GuKTKQnbJT5zP2vNqHHcYxi6X+xKnARhu/zmmDpJBzZJMqeBsMQqQJRhZTtMFpJrAPi/4o2MjPD79+8xMjKSrA/jTTuuiJgZxWIRSftgXrwdGYDut0jeuhMmfbcAABB5BiEGGmEEyCtx2jQF6HRWJW3OjwZ6lZ4XINBqkxfv6mOlUjE6QpZljVer1ZVO0gmEx20L5UZKKeeIqP/+/ftfOtczMzN3HfdSSjn38OHDHedZwNDSdTSFWExoYGBg03HkFxcXX/X3928qpd7s7+8/Z+adhYWFuTjSaUVkAaanp8cA1KWUq8y8AQBa6ycA6rVarR41/nZEFmBxcfEVgM8PDw8VEd0BACHEU631kmVZ40BTyGSIUgfcYWZm5m4nUy5R68An099xLAfFQD6Y6ynOjwCdriGlTW/m2oV3LBRpxbVTomg/8ZXcpOl5E8oFSJtcgLTpeQE68om9eNvxbvYjcWngm7W1NV5bW2MA92KKMxCxdGRCiA9a66J9/VFr3Rc50oDEYkIAvl9fX39pm9JUTHEG4owG7Ln6lh5Rr86fBsVnTOa75z8KfhZ0xj3uVZchIsZzB3FwIUs0S7RUwHlvasKQdFnkNSBlcgWkTK6AlIlrHN2WUqk0eO3atVum51rrd0tLS1vdyk9WSK0GFIvFPy5dulSOIy4p5ar3rFWv0NIR01pT0stkSqmG1voXZ+nYsqzxQqHgHFDbAjDKzBt7e3vfXrly5bOBgYFNADuVSuW28y4zvwAAIioDADNvtTp/FgX3geQ443XoWhPkR6lUGrQLf0tr7eymWBFC/Dg0NPS7Xag3pJQv7d0Z9aOjo9tOkyWlvAUAcRe+mxA7YT9orQMbbyYUUKvV6kopMHPdvZlidnb2ndZ6BwDK5fIoEY0x8wYR3enr63sEQHUrj0FrQNgty5lQAADs7u7eGB4eXnXtP6oz80q1Wn0hpXxGRD+cnJzcc/YbKaU2lVJvDg4Obp+eni4VCoVflVKNg4ODr5aXlyMfc+kWqfUBvULYPiBsf5H7ASmTKyBlcgWkTOj/SHTRSLos8pJOmVwBKWPyA1o6E716ujUoSZ77NHFGAee9kP1IQ/a8CUqZXAEpk5m5IC9CiH8B7AMwLuJklH/CvJzZPd5JzsFnibwJSplcASmTGQU4Lr8Q4p4QYhvARyHEthCiq9uVu06Ys5VJBiICEW2vr6+zm42NDSai7bTzl1TITA1wOD099f193sjMKMj5L/NCiO8A/ATgCwB/AfhZa/1burlLjv8A3MQpISu2+rQAAAAASUVORK5CYII="},{style:A.Explode,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAAGSM0KYAAAACXBIWXMAAAsTAAALEwEAmpwYAAALC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0MzUyLCAyMDIwLzAxLzMwLTE1OjUwOjM4ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTAzLTI2VDE0OjM0OjQyKzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wMy0yNlQxNDozNDo0MisxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MTkxNWVjMTctNGM5Mi00YzljLWE0MTUtMjA0NDFhMmQwNTFhIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6ZDNjNTE2ZDgtOTgxOC1hYzQwLWJiM2EtNmNiYjI5Nzg3NTcwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjYzNzdjM2ExLTQ0OGQtNDVmOC05YmRjLTdlZmZmZjMxM2Y5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo0MisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjE5MTVlYzE3LTRjOTItNGM5Yy1hNDE1LTIwNDQxYTJkMDUxYSIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo0MisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjYzNzdjM2ExLTQ0OGQtNDVmOC05YmRjLTdlZmZmZjMxM2Y5OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiLz4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJURVhUIiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJURVhUIi8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8cmRmOmxpIHBob3Rvc2hvcDpMYXllck5hbWU9IlRleHQiIHBob3Rvc2hvcDpMYXllclRleHQ9IlRleHQiLz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJUZXh0IiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJUZXh0Ii8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOlRleHRMYXllcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+jDd+1gAABfdJREFUeJztnDtsFEccxr//6DAHwnJQZEwVykQKgi5UuKTzuQmOKQ578QwSUuigSSidijJIJ+VsnSw3iHTnKi5x5ZQWUZTSVDxkhZORzihmJoV3zHrvZp+zt3vH/qSR73b3Zuabb2bnsbMmpRQYY0pKSTDgPV9xj51hjFVNP/BGxvwnhRBd0w8BAEopEFHVG+7cuSO835VS0IFcDcbsuFk60J+1hgMppfEHjH3KOXNjCMy2e74B4ChL/WL0R+Km0iAiiuwBAFSklBQi+syJCLxfQj0Aen3gnD+YnZ2dsuZDFNEnvvct1qAf9VQ+f4x+tAYFX/EloG/10lXJqDkqpupY6XvUR61Wm5icnLxPRBMrKysP4yR8bEKY1WF4q4IX5kYebnUIRrO9tTZtIKIGEcEbbCegw6eEIjaEpEX4p7cdJK6uQf1KpJtFFAJrUZbkl8DCwsK0EKLLOd/0HuecP4uTQKAHbhfx8vDw8AFj7BJjrK6U6qysrNzwX2vyIPRepJTaZYxdZYzNALhCRC+tKYjD6NYiXUQAwscwJkx3UilltHtR0kSklCPgQWg78EpP4lGkTh+A8icWEfJ2+jbGRjYIHL77ydzjrDkWYGPwaIO49XR0HEiCd8a1tLT0aH5+/pL+DACO49Qdx6kLIf5Jl00zVhwQQnSJaPrcuXNNzvnj1dXVZSFEd29vr91qtdaVUrs20umLb1xcTRpu3779nemcf4obFGKP5b19pY1xS1pM4x4To9OIbUwwbRC3N7Y23LIJY6wB4F7YdQMZziVEZ74RdmFRBWhChRRdgMYoxEobcBueNyJKOj/yxBdEA8A9a3Mm2wLi4J8PABj8yNR/C4+TvlcAAOTeEwPoxhEwLI3YyOgIGFSjCyNu+xsdB4aVoRcQdeHpBP6nj81m07ie5DjOTKvV2kiSTiTSTCk558tEVL1169bX+vPi4uINPb3knC/fvXt3V5/LYkpppQqNj49v64n82tra82q1ui2EePX27dtflVK7q6uryzbS6UdqAQsLC9MAOpzzTaXUFgBIKR8C6LTb7U7a+MNILWBtbe05gK/ev38viOg6ADDGHkkp1x3HmQGORWaDrWWVxcXFG0mWXMpllawyMihKAXnjXdjKMx/HxF1gK0auU+CfUgIY/NzA574CEDon0Hks3NKiK+ZLAHtB12kBRa1CezgSEUpRBQARRRRZABBBRNEFACEihkEAECBiWAQABhFWBDDGToQM6RFhK7XvcdQBKQBzluI0cUKEreX1DwDG3K+RetK0HK/gWdo4epOIlBt+sLkpNdaMzC1NYwkWZf00KwLab+D29zQELcz1TI+LMmUYMLGm6HH5LEu0SPS0AN3UPtPa3oN7282sUytLOWdKA3KmNCBnEj2eTEKtVps4f/78VdN5KeW79fX1nUHlpyjk1gLGxsb+OHXqVN1GXJzzTf+7VsOCcSqc9WMyIURXSvmLfnTsOM5MpVLRL6jtALiilNp68+bNzbNnz34xPj6+DWC32Wxe09cqpZ4AABHVAUAptdPv/bM0xH1UF5eB3YKCqNVqE27h70gp9W6KDcbYzxcuXPjdLdSLnPNn7u6MzsHBwTV9y+KcXwUA24U/CAphQLvd7gghoJTqeDdTLC0tvZNS7gJAvV6/QkTTSqktIrp++vTp+wBEbpm2RCEMAIDXr19fnJqa2vTsP+oopTZardYTzvljIvrx8PBwTu83EkJsCyFe7e/vX/v48eN6pVL5TQjR3d/f/+bp06fZveZimdz6gGEh6z6gnAfkTGlAzpQG5ExPJxz0QOZzRL9Nk9UDmbIF5ExpQM6Y5gF9x6ZF+S8HWRG0O5IxFrrlLSreZ+s9LUBKSaZgI/EiE6CbcFT4DUTctheV8hYUj3uwbERpQDKsGVEakI7URpQG2CGxEaUBdoltRGlANkQ2ojAGePZXzzHGXjDGPrh/5waw7zorQo0ozHs+bgG/APBtn9N/Abic1+Zgi+Y3APwkpfxXHyjME7EiY9H4nv9LVbR2fRnAPIC/Afzn/p13j48k/wOvLDJRx+b4hQAAAABJRU5ErkJggg=="},{style:A.Square,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAAGSM0KYAAAACXBIWXMAAAsTAAALEwEAmpwYAAALC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0MzUyLCAyMDIwLzAxLzMwLTE1OjUwOjM4ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTAzLTI2VDE0OjM1OjA4KzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wMy0yNlQxNDozNTowOCsxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NTk0ZjlmZWYtYzE5MS00Nzc3LWFhZjgtZDEyYTdkNjhmZWJiIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6YmUxMTFiMDktOWRjOC03YjQ4LTllYzQtMTBmNDYxNjllZTY5IiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmJlMjcwOTQwLWZlNjctNGQyMS04ZTI5LWE5MzIzMzM1YjliZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNTowOCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjU5NGY5ZmVmLWMxOTEtNDc3Ny1hYWY4LWQxMmE3ZDY4ZmViYiIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNTowOCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmJlMjcwOTQwLWZlNjctNGQyMS04ZTI5LWE5MzIzMzM1YjliZCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiLz4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJURVhUIiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJURVhUIi8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8cmRmOmxpIHBob3Rvc2hvcDpMYXllck5hbWU9IlRleHQiIHBob3Rvc2hvcDpMYXllclRleHQ9IlRleHQiLz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJUZXh0IiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJUZXh0Ii8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOlRleHRMYXllcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+RxTC0wAABwBJREFUeJztnE9o21gawH9ytFM3MyyZeFm8zcwgSreTpWCI5JRODrn42lz2kEsuvSxiCN0umNI5DGt6KF0IJYSllFIC7TXTQg+FOYVAB0LpHwVy8i5tcWAp2s4mdUvauDOO3h5kaVw3tiVLjuWpfvCILT2/933v0/vzve8pkhACP8heMyYSCYBUwkfhKWBTBhBt5KrdllyRJElqWbQQAsuybNEab1YqFQAuX76854+lWnUtRbIsi0Qi8YtIfppW8pP55U1JeLJDzQZYlpD82MH5cUK0Q1XVYecHnuwASE3tsLy8TD6fb/FTSWorkqZpKSEEQgjPdnAz+LKDXzzbzSuOfal1HcsSkgyQzWY/Bw4GLH/34MGD2zs7O/8FNt2rQghPhmjH7u7uO8ZyUssntVQqUSqV3rnWrNs2o2UFiqKgKAq6rnPnzh0AJiYmfFXQ9SaSAVRV/SKbzQY2MvCy8WLX+sHLm5KANjYIg9A6Wl0nqyFJlmV1X4OuVyBpmjYIfBa0HOBHwzC26i9aloUMfPbgwYN/BayA8fHxSeCHxutepxwvVJ1pqZ7eGblUKrG0tNS9ChRFIZVKMTc3h67rXL9+PdwK6snlcpw4cYJ8Po+u6/5q0DTtaOChVAihadpXjSOpaDfhhIHv5WC7sva6+J/x8fEvAxYuAT/ueaNb80E3ceYaCHE6CJP3p5ZGpN+9WBKbEFELtFAgRW3N2HS1H1FStb+bjTeirkBTwV2EEGia9rkkSSIKqfwdovwdQtO0TyRJoll6Z9lLza/Za7rebyzL4vjx4xPAAcuyttvlj/oj1JaOhtFGf01RlBBE6YyOFHAEXl5eJpfLoes6R44cYXBwkJmZGa5du8bU1BSPHz9mZWWFw4cPMzs7G6bcLqE8QplMhrNnzzI2NsbQ0BCmaTI/P8/Jkye7KjzgjkJHw3CQw6DmZH+1l6O9V+r7Ttz3CjideAe8LKL2B1VV3wJvveSN5GLOD32nwMubEtRt9EbjmQlA3ysQOY/Mgzd25cWScDebItcH2ihwBfga+s8jgzrh6+kXBfYUHvpDgabCQ/QVaCk8RFuBtsKDvYkvA78FPsUeVns9LO2sra39XQjxl1aZnFFIBpKAYhjGo30Qri0vlgS5f2hfGIbhKb8MfAR8XK1WwwpGBGJgYABV9R79TWDv/FaBpnsw+5kcVFXFsqymqV6BviZWoNf4Xo1WKhVM03S/J5NJ0ul0qEL5oWMLXLx40VM+v6cs/OJbgWQy6e7MKYpCuVxG13V0XadSqbgniZyTHE+fPg1V4EYCOzTz8/NMT08DsLi4yKVLl9B1nfPnz5NOp9nY2AgsZCtC8chyuRwAIyMjmKZJJpPh7t27rmLdJPAotLCwgK7r5PN5RkdHKRQKzM7OsrGxQblcZn19nXK5HIKoeyNpmpYCjt6/f381ChtbiUQCVVW/BP798OHD9vm7L1J3iRXoNX2vgOOBhXnqY1+RgZ+A17IcqU26Ha8ZZaAClFRVPUJEfGJaReYbiNzWol/6XoF+oDGmUU/fj6L9TmwADyQSiUCpFfEQ5IGAPsYV4FsaDvq5ZQcpOaYlV7DP+31Ni1VFbIDw8dTwDrEBwsNXwzvEBghORw3vEBugcwI1vIMkhCCbzUrAQC39BtslduJ+HzICsLBjnz8Du4Zh/JO6VY1fGldBzg7KR8DH2HH6YeBA3b1qJxX9CpABlr95dNe58Ke//uGPqqr+zTAMT+coPVeC/dLAp8DvDcNYffXqlZCiEKuPANXvP3E/Hzp0SGC3VegGGKh9lgEGBwelKAQ4ooD1511kWUZV1Uns9hlQVRUvARcv1Ley4MMdbrxQpQtbxfFj3mNiA/SY2AA9Zl8CeaVSqeVxokwm0/GrZcVikXv37nHq1KkOpest+2IARVG4evWq+13Xdaanp91DOQDlcplHj+yTtpqmMTQ0BNjGe/LkCceOHXMPsq2trbG1tcXw8DC3b98GfnkJst+IRCi7UCiwvb3NhQsXSCaTFItFzp075xrp2bNnFAoFpqamWFlZIZ1Oc/r0aZLJJKurqwB92fgQAQOUSiVM0ySdTrO4uOhez2Qy7OzYpwucf/V048aNdxr/10DPJ2FFUchkMpimydjYGDMzM4yOjrK+vs7IyAgAc3Nz3Lp1i4WFBSYnJzlz5gzFYtEt4/nz5++9UN4vOJtxKeydvZRhGKvVarUn77CapkmlUvH9Nn6lUqFcLnflsLNlWY4nPIG9AbcJbIblCfd8CKqn0wbs9UnzIPR8CPrQiQ3QY2ID9Jh6A0hEbE6IGDJdiBA6Db6Lvd1aBXjz5k0ckKkh7JNrziuZVey2Cg1nGXqAOCTZSL3+b4Et4BXwGngb9jL0J2zLvgb+RxyUd3gvKE83ekBM7/g/nE5w7+aEM3oAAAAASUVORK5CYII="},{style:A.Random,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAAGSM0KYAAAACXBIWXMAAAsTAAALEwEAmpwYAAALC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0MzUyLCAyMDIwLzAxLzMwLTE1OjUwOjM4ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTAzLTI2VDE0OjM0OjU0KzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OWZkYTc5MGItNmU4NC00ZWY1LWE0ZjEtODRlYWIwYjA1YmM4IiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6OGFkNDQ1MGUtN2ZmNS1iZTQyLTlmNTAtOGE0ZDBlYTU4MmFlIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjlmZGE3OTBiLTZlODQtNGVmNS1hNGYxLTg0ZWFiMGIwNWJjOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiLz4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJURVhUIiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJURVhUIi8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8cmRmOmxpIHBob3Rvc2hvcDpMYXllck5hbWU9IlRleHQiIHBob3Rvc2hvcDpMYXllclRleHQ9IlRleHQiLz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJUZXh0IiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJUZXh0Ii8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOlRleHRMYXllcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+COBQAABfZJREFUeJztnD1sE0kYht9vZCBBRL7oBLnqKO+q0B0VKeniNFwEhUmWzCAhHR1UR5mrKO8kS2dHUZQGOVSmupRQpU13ZahOoMixguQU0XxXsBPWm/2b9dq7TvaRRnK865l5552Znb8NMTOEEKy1JoTgvV5xv5sWQkyF/cAbmfBfVEr1w34IAGBmENGUNzx58kR5/2ZmmECuhtDsuFk6MZ+NhhOtdegPhPiWc+HGEJlt93oDwNcsJcFNpUFElNgDwNUQI3p6IALvH7EeAAARsbfMpZQvlpaW5kJ9ICL2J+vH60MS0YM5SlKs54yzwdSlWB0JCKxe1jkKI6w6VgCg22bMLoeWK2q1WvXmzZvPiajaarVeBt3Te0sMgKoPBss8syLyVgUvmRWRv/qc4a21wwYiahARvCHrBEz4llDS/iVNMXXbzF6TEdVEYyIObd6JOu0kjLwWhZFfAisrKwtKqb6Uctf7vZSybZNApAfuI+Lj6enpCyHEbSFEnZl7rVbrvv/ebpv71Qd8zuiK/ws/zHwghLgjhFgEME9EH4PuC4o8VoENF7cWmSICED+GCSOsJ9VaZ9cXBSWitb4AHozH5CwIehYMJJDR2CgLIofvfkZuwagpnADbvqRwAmwZSoB3xrW2tvbq4cOHt81nAHAcp+44Tl0p9W/SOHtv6SwkIRMHlFJ9Ilq4ceNGU0r5emNjY10p1T88POxsbm5uM/NBFukE4hkTD0xNbcPjx49/Cbvmn+JGBeuxfNG60bBxTxiXuxGPgtBJagiZTv2yQgjRAPAs7r6xDOdSYjLfiLuxqAIMsUKKLsAQKqSobSDyuhlKAwV1QGsdGbz4H2QmglTrRGnxpm2bvlcAAAy9gpABfRsBhaxCNlwcAWlXVfLm4jgwqUy8gNgV3iD8u4/NZjN0IuQ4zuLm5ua7NOkkgplxtAMc7eDcrnNckFKuE9HUo0ePfjKfV1dX75vppZRy/enTpwfmWsLARzvJt5BMFWI3pGJmZmbPTOS3trbeT01N7Sml/vv8+fOfzHywsbGxnjSubtsuG0YAucGalZWVBQA9KeUuM38AAK31SwC9TqfTs40vauM0CAEA1QcM/05pUra2tt4D+PHLly+KiO4BgBDildZ623GcReBMZGKs8uLbbky9rLK6uno/zZJLUBtItazillw5mBs3pYC8ORNgu6BUFCYz1x78U0oA458b+NxnJHiomjwWblnFFfM9gMOo+4yAolahQ3wVEUtRBQAJRRRZAJBARNEFADEiJkEAECFiUgQAISImSQAQIKKoz4FQ3ClnsZfXbSicAJu9ASCgCrlr9YFjkUldP01KRPWNPP4+DFELc+emx5M6ZRgSq5MPtlzKEi0SgQZc9K7GhlGXRdkCcqY0IGdKA3Im1fZkGmq1WnV2dvZO2HWt9dH29vb+uPJTFHJrAVevXv3nypUr9SziklLu+t+1mhQGJmLuK50AgNllGunpY6VUX2v9h9k6dhxnsVKpmBfU9gHMM/OHT58+/Xr9+vXvZmZm9gAcNJvNu+ZeZv4LAIioDgDMvB/0/tkwdNvsPYxAgOXmaQxj64KiqNVqVbfw97XW5jTFOyHE77du3dpxC/UHKWXbPZ3ROzk5uWu6LCnlHQDIuvDHgd8Aml0m7raZMMZTf51Op6eUAjP3vIcp1tbWjrTWBwBQr9fniWiBmT8Q0b1r1649B6DGkD1vmWQfedBakNaaRr1T7++CarVadW5ubhfAvHtLj5nftVotJaV8TUS/nZ6eLpvzRkqpPQC3j4+P705PTy9UKpW/AeD4+PjnN2/eZPaai9b6JO5/cAxDbgZMCqM2oJwH5ExpQM6UBuRMoAGXdN0/kFGXRVnSOVMakDNhM+HAufa43yUbN/5313zXYo+8JcW7yXOuBWitKSxkkXiRidBN+Fr4DSQ8tpeUsguy4xkyNqI0IB2ZGVEaMBxDG1EakA2pjSgNyBZrI0oDRkNiIwp3vLiIZLAc0QDwqtvmc/OI0oAEDGuA/0z6QNxDxXxJiDtybnsk3UtpQM78D6oZB7/ZFWiVAAAAAElFTkSuQmCC"},{style:A.Expand,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAAGSM0KYAAAACXBIWXMAAAsTAAALEwEAmpwYAAALC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0MzUyLCAyMDIwLzAxLzMwLTE1OjUwOjM4ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTAzLTI2VDE0OjM1OjIzKzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wMy0yNlQxNDozNToyMysxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MmZhNTI3NDEtOGZkZi00NTM0LWE0N2UtMWRmZWMyOTc3NTliIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6MDRkNjFiNzktZDUxMC01MDQwLThjNjYtYjk4ZWIyZWMxOWI0IiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjcyOWFhOWVjLTE0ZmItNDdiZS1hNTNhLTAyYzgyOWEyMjlhOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNToyMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjJmYTUyNzQxLThmZGYtNDUzNC1hNDdlLTFkZmVjMjk3NzU5YiIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNToyMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjcyOWFhOWVjLTE0ZmItNDdiZS1hNTNhLTAyYzgyOWEyMjlhOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiLz4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJURVhUIiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJURVhUIi8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8cmRmOmxpIHBob3Rvc2hvcDpMYXllck5hbWU9IlRleHQiIHBob3Rvc2hvcDpMYXllclRleHQ9IlRleHQiLz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJUZXh0IiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJUZXh0Ii8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOlRleHRMYXllcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+ZojRogAABeNJREFUeJztnD1MHEcUx/9vdD6wZURcGFzFBZGSCndxZUp3HE3iYCkHrJlxFXd2FUtRJFK5tKsc6IRoiNMdVRASkqloEU2kKAqWIhmQJZ9BOmxgXorsntbLzd7u7e7tHuxPGrG3HzPz5r35ePMBMTOEEKy1JhhwPy/Y9y4LIfpNH7gjE96HSqmG6UMAADODiPrd4cGDB8r9m5nhBLJlMGbHztKRc+3IcKS1Nn4ghIDznJjZN8tnPjbFaIKIKLAOAFuGNkJfNmaprQ7sPLG7zKWUjycmJoa9eiAitv8Se5P1orU+cmQpODdML3tLTPiVkB3Zpx+0i9H1IQFo2lJbOQLQ0rzMJhASk+0WWt71UCqVBq9fv/6IiAbn5+efhEk4tiJya95t3rEVkUnZjt35mlIUQrcXYQlURIeHh3x8fNxRTtxK7rio/PqVQI12EEztR2xWZCK9BKanp8eUUg0p5ar7vpTyZZgEfHVgdxGvT05OHgshbgohysxcn5+fv+t916SDtm0RM+8IIW4JIcYBjBLR69gkCMP5taLmYAcwdxrt8B26ZKKxSzwBpzFMJAG7fP/2K2c/2urAHs0ygI6a8mYCMY2N4sB3+O4lcSNKmswJELYtyZwAYYkkgNvjmp2dfTo5OXnTuQYAy7LKlmWVlVJ/RsummVg0oJRqENHY1atXK1LKZwsLC3NKqcbbt29r1Wp1iZl3ImfU1NY2XX6Paxo2TE1NfW165nVx/YJ7GuKTKQnbJT5zP2vNqHHcYxi6X+xKnARhu/zmmDpJBzZJMqeBsMQqQJRhZTtMFpJrAPi/4o2MjPD79+8xMjKSrA/jTTuuiJgZxWIRSftgXrwdGYDut0jeuhMmfbcAABB5BiEGGmEEyCtx2jQF6HRWJW3OjwZ6lZ4XINBqkxfv6mOlUjE6QpZljVer1ZVO0gmEx20L5UZKKeeIqP/+/ftfOtczMzN3HfdSSjn38OHDHedZwNDSdTSFWExoYGBg03HkFxcXX/X3928qpd7s7+8/Z+adhYWFuTjSaUVkAaanp8cA1KWUq8y8AQBa6ycA6rVarR41/nZEFmBxcfEVgM8PDw8VEd0BACHEU631kmVZ40BTyGSIUgfcYWZm5m4nUy5R68An099xLAfFQD6Y6ynOjwCdriGlTW/m2oV3LBRpxbVTomg/8ZXcpOl5E8oFSJtcgLTpeQE68om9eNvxbvYjcWngm7W1NV5bW2MA92KKMxCxdGRCiA9a66J9/VFr3Rc50oDEYkIAvl9fX39pm9JUTHEG4owG7Ln6lh5Rr86fBsVnTOa75z8KfhZ0xj3uVZchIsZzB3FwIUs0S7RUwHlvasKQdFnkNSBlcgWkTK6AlIlrHN2WUqk0eO3atVum51rrd0tLS1vdyk9WSK0GFIvFPy5dulSOIy4p5ar3rFWv0NIR01pT0stkSqmG1voXZ+nYsqzxQqHgHFDbAjDKzBt7e3vfXrly5bOBgYFNADuVSuW28y4zvwAAIioDADNvtTp/FgX3geQ443XoWhPkR6lUGrQLf0tr7eymWBFC/Dg0NPS7Xag3pJQv7d0Z9aOjo9tOkyWlvAUAcRe+mxA7YT9orQMbbyYUUKvV6kopMHPdvZlidnb2ndZ6BwDK5fIoEY0x8wYR3enr63sEQHUrj0FrQNgty5lQAADs7u7eGB4eXnXtP6oz80q1Wn0hpXxGRD+cnJzcc/YbKaU2lVJvDg4Obp+eni4VCoVflVKNg4ODr5aXlyMfc+kWqfUBvULYPiBsf5H7ASmTKyBlcgWkTOj/SHTRSLos8pJOmVwBKWPyA1o6E716ujUoSZ77NHFGAee9kP1IQ/a8CUqZXAEpk5m5IC9CiH8B7AMwLuJklH/CvJzZPd5JzsFnibwJSplcASmTGQU4Lr8Q4p4QYhvARyHEthCiq9uVu06Ys5VJBiICEW2vr6+zm42NDSai7bTzl1TITA1wOD099f193sjMKMj5L/NCiO8A/ATgCwB/AfhZa/1burlLjv8A3MQpISu2+rQAAAAASUVORK5CYII="}];return d;};
b.createAnnotation=function(d,e){var f=new b({viewport:e,annotationId:d.annotation.id,nodeRef:d.node,style:d.annotation.style,animate:d.annotation.animate===undefined?true:d.annotation.animate,editable:!!d.annotation.editable,name:d.node.name,text:d.annotation.text?d.annotation.text.html:"",xCoordinate:d.node.position.x,yCoordinate:d.node.position.y,width:d.node.scale.x,height:d.node.scale.y});f._attachmentNode=d.attachment;if(d.targetNodes){d.targetNodes.forEach(function(t){f.getTargetNodes().push(t);});}f.sourceData=d;return f;};
b.prototype._getBackgroundColor=function(){var d="rgba(221, 221, 221, 0.5)";var e=this.sourceData.annotation;if(e.label&&e.label.colour){var f=e.label.colour;d="rgba("+f[0]*255+", "+f[1]*255+", "+f[2]*255+", "+f[3]+")";}return d;};
return b;});
sap.ui.predefine('sap/ui/vk/AnnotationRenderer',[],function(){"use strict";var A={};
A.render=function(r,c){r.write("<div");r.writeControlData(c);var s=c.getEditable()&&c.getSelected()?"Editing":c.getStyle();r.addClass("sapUiVizKitAnnotation"+s);if(c._reverse===true){r.addClass("sapUiVizKitAnnotationReverse");}r.writeClasses();r.write(">");for(var i=0;i<8;i++){r.write("<div");r.addClass("sapUiVizKitAnnotationElement"+i);r.writeClasses();r.write(">");r.write("</div>");}r.write("<div");r.addClass("sapUiVizKitAnnotationNode"+s);r.writeClasses();r.write(">");r.write("</div>");r.write("<div");r.addClass("sapUiVizKitAnnotationLeader"+s);r.writeClasses();r.write(">");r.write("</div>");r.write("<svg xmlns='http://www.w3.org/2000/svg'");r.addClass("sapUiVizKitAnnotationSVG"+s);r.writeClasses();r.write(">");r.write("<path />");r.write("</svg>");if(c._textDiv){r.renderControl(c._textDiv);}r.write("</div>");};
return A;},true);
sap.ui.predefine('sap/ui/vk/AnnotationStyle',[],function(){"use strict";var A={Default:"Default",Explode:"Explode",Square:"Square",Random:"Random",Expand:"Expand"};return A;},true);
sap.ui.predefine('sap/ui/vk/BaseNodeProxy',["sap/ui/base/Object"],function(B){"use strict";
var a=B.extend("sap.ui.vk.BaseNodeProxy",{metadata:{"abstract":true}});
return a;});
sap.ui.predefine('sap/ui/vk/BillboardBorderLineStyle',[],function(){"use strict";var B={None:"None",Solid:"Solid",Dash:"Dash",Dot:"Dot",DashDot:"DashDot",DashDotDot:"DashDotDot"};return B;},true);
sap.ui.predefine('sap/ui/vk/BillboardCoordinateSpace',[],function(){"use strict";var B={Viewport:"Viewport",Screen:"Screen",World:"World"};return B;},true);
sap.ui.predefine('sap/ui/vk/BillboardHorizontalAlignment',[],function(){"use strict";var B={Left:"left",Center:"center",Right:"right"};return B;},true);
sap.ui.predefine('sap/ui/vk/BillboardStyle',[],function(){"use strict";var B={RectangularShape:"RectangularShape",CircularShape:"CircularShape",None:"None",TextGlow:"TextGlow"};return B;},true);
sap.ui.predefine('sap/ui/vk/BillboardTextEncoding',[],function(){"use strict";var B={PlainText:"PlainText",HtmlText:"HtmlText"};return B;},true);
sap.ui.predefine('sap/ui/vk/Camera',["sap/ui/base/ManagedObject"],function(M){"use strict";
var C=M.extend("sap.ui.vk.Camera",{metadata:{properties:{"position":{type:"float[]",defaultValue:[0,0,0]},"targetDirection":{type:"float[]",defaultValue:[1,0,0]},"upDirection":{type:"float[]",defaultValue:[0,1,0]},"nearClipPlane":{type:"float",defaultValue:0.1},"farClipPlane":{type:"float",defaultValue:1.0}}}});
C.prototype.getCameraRef=function(){return null;};
C.prototype.getIsModified=function(){return!!this._isModified;};
C.prototype.setIsModified=function(v){this._isModified=v;};
return C;});
sap.ui.predefine('sap/ui/vk/CameraFOVBindingType',[],function(){"use strict";var C={Minimum:"minimum",Maximum:"maximum",Horizontal:"horizontal",Vertical:"vertical"};return C;},true);
sap.ui.predefine('sap/ui/vk/CameraProjectionType',[],function(){"use strict";var C={Perspective:"perspective",Orthographic:"orthographic"};return C;},true);
sap.ui.predefine('sap/ui/vk/ContentConnector',["sap/ui/base/ManagedObjectObserver","sap/ui/core/Element","./Messages","./getResourceBundle","./ContentResource","./Core","sap/base/Log"],function(M,E,a,g,C,v,L){"use strict";var b=E.prototype;
var c=E.extend("sap.ui.vk.ContentConnector",{
metadata:{library:"sap.ui.vk",aggregations:{contentResources:{type:"sap.ui.vk.ContentResource",bindable:"bindable"},viewStateManagers:{type:"sap.ui.vk.ViewStateManager"},contentManagers:{type:"sap.ui.vk.ContentManager",visibility:"hidden"}},defaultAggregation:"contentResources",events:{contentChangesStarted:{parameters:{}},contentChangesFinished:{parameters:{content:{type:"any"},failureReason:{type:"any"}}},contentChangesProgress:{parameters:{phase:{type:"string"},percentage:{type:"float"},source:{type:"any"}}},contentLoadingFinished:{parameters:{source:{type:"any"},node:{type:"any"}}},contentReplaced:{parameters:{newContent:{type:"any"},oldContent:{type:"any"}}},contentDestroying:{parameters:{content:{type:"any"},preventGarbageCollection:{type:"function"}}}}},
constructor:function(i,s){this._inLoading=false;this._delayContentResourcesUpdate=false;this._scheduleContentResourcesUpdateTimerId=null;this._content=null;this._contentManager=null;this._decryptionHandler=null;this._authorizationHandler=null;b.constructor.apply(this,arguments);v.observeLifetime(this);}
});
c.prototype.isTreeBinding=function(n){return n==="contentResources";};
c.prototype.init=function(){if(b.init){b.init.call(this);}this._selfObserver=new M(this._observeChanges.bind(this));this._selfObserver.observe(this,{aggregations:["contentResources","viewStateManagers"]});};
c.prototype.destroy=function(){c._cleanAssociatedLoaders();this._selfObserver.disconnect();this._selfObserver=null;if(this._scheduleContentResourcesUpdateTimerId){clearTimeout(this._scheduleContentResourcesUpdateTimerId);this._scheduleContentResourcesUpdateTimerId=null;}this._delayContentResourcesUpdate=false;this._setContent(null,null);b.destroy.call(this);};
c.prototype._observeChanges=function(e){if(e.name==="contentResources"){if(e.mutation==="remove"){this._setContent(null,null);}else{this._scheduleContentResourcesUpdate();}}else if(e.name==="viewStateManagers"){if(e.mutation==="insert"){e.child.setContentConnector(this);}else if(e.mutation==="remove"){e.child.setContentConnector(null);}}};
c.prototype.invalidate=function(o){if(o instanceof C){this._scheduleContentResourcesUpdate();return;}b.invalidate.apply(this,arguments);};
c.prototype._scheduleContentResourcesUpdate=function(){if(this._inLoading){this._delayContentResourcesUpdate=true;return this;}if(!this._scheduleContentResourcesUpdateTimerId){this._scheduleContentResourcesUpdateTimerId=setTimeout(function(){this._scheduleContentResourcesUpdateTimerId=null;var e=this.getContentResources();if(e.length>0){this._collectContentResourceSourceTypeInformation(e).then(function(i){if(i.dimensions.length>1){setTimeout(function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:g().getText(a.VIT17.cause)}});L.error(g().getText(a.VIT17.summary),a.VIT17.code,"sap.ui.vk.ContentConnector");}.bind(this),0);}else if(i.contentManagerClassNames.length>1){setTimeout(function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:g().getText(a.VIT35.cause)}});L.error(g().getText(a.VIT35.summary),a.VIT35.code,"sap.ui.vk.ContentConnector");}.bind(this),0);}else if(i.contentManagerClassNames.length===0){setTimeout(function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:g().getText(a.VIT36.cause)}});L.error(g().getText(a.VIT36.summary),a.VIT36.code,"sap.ui.vk.ContentConnector");}.bind(this),0);}else if(i.contentManagerClassNames.length===1){var t=this;this._getContentManagerByClassName(i.contentManagerClassNames[0]).then(function(f){if(t._contentManager&&f!==t._contentManager){t.fireContentChangesStarted();t._setContent(null,null);t.fireContentChangesFinished({content:null});}f.loadContent(t._content,e);});}}.bind(this));}else{setTimeout(function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null});}.bind(this),0);}}.bind(this),0);}return this;};
c.prototype._handleContentChangesStarted=function(e){this._inLoading=true;this.fireContentChangesStarted();};
c.prototype._handleContentChangesFinished=function(e){var f=e.getParameter("content");this._setContent(f,e.getSource());this.fireContentChangesFinished({content:f,failureReason:e.getParameter("failureReason")});this._inLoading=false;if(this._delayContentResourcesUpdate){this._delayContentResourcesUpdate=false;this._scheduleContentResourcesUpdate();}};
c.prototype._handleContentChangesProgress=function(e){this.fireContentChangesProgress({phase:e.getParameter("phase"),source:e.getParameter("source"),percentage:e.getParameter("percentage")});};
c.prototype._handleContentLoadingFinished=function(e){this.fireContentLoadingFinished({source:e.getParameter("source"),node:e.getParameter("node")});};
c.prototype._getContentManagerByClassName=function(e){var f,h=this.getAggregation("contentManagers",[]);for(var i=0,j=h.length;i<j;++i){f=h[i];if(f.getMetadata().getName()===e){return Promise.resolve(f);}}var t=this;return new Promise(function(k,l){sap.ui.require([e.replace(/\./g,"/")],function(m){var f=new m();t.addAggregation("contentManagers",f);f.attachContentChangesStarted(t._handleContentChangesStarted,t);f.attachContentChangesFinished(t._handleContentChangesFinished,t);f.attachContentChangesProgress(t._handleContentChangesProgress,t);f.attachContentLoadingFinished(t._handleContentLoadingFinished,t);t._assignDecryptionHandler([f]);t._assignAuthorizationHandler([f]);k(f);});});};
c.prototype.getContent=function(){return this._content;};
c.prototype.getContentManager=function(){return this._contentManager;};
c.prototype._assignDecryptionHandler=function(e){for(var i=0;i<e.length;i++){e[i].setDecryptionHandler(this._decryptionHandler);}};
c.prototype._assignAuthorizationHandler=function(e){for(var i=0;i<e.length;i++){e[i].setAuthorizationHandler(this._authorizationHandler);}};
c.prototype.setDecryptionHandler=function(h){this._decryptionHandler=h;this._assignDecryptionHandler(this.getAggregation("contentManagers",[]));return this;};
c.prototype.setAuthorizationHandler=function(h){this._authorizationHandler=h;this._assignAuthorizationHandler(this.getAggregation("contentManagers",[]));return this;};
c.prototype._setContent=function(n,e){var o=this._content,f=this._contentManager;if(o!==n){this._content=n;this._contentManager=e;this.fireContentReplaced({oldContent:o,newContent:n});if(o){var p=false;this.fireContentDestroying({content:o,preventGarbageCollection:function(h){p=h;}});f.destroyContent(o);if(!p){f.collectGarbage();}}}return this;};
var r=[{pattern:/(^threejs[:.])|(^(threejs|stream|vds4)$)/,dimension:3,contentManagerClassName:"sap.ui.vk.threejs.ContentManager"},{pattern:/^vdsl?$/,dimension:3,contentManagerClassName:"sap.ui.vk.dvl.ContentManager"},{pattern:/^(png|jpg|jpeg|gif|bmp|tiff?|svg)$/,dimension:2,contentManagerClassName:"sap.ui.vk.ImageContentManager"},{pattern:/^(stream2d|vds4-2d)$/,dimension:2,contentManagerClassName:"sap.ui.vk.svg.ContentManager"}];var d=function(e){return new Promise(function(f,h){var i=r.slice();var t=function(j){if(j>=i.length){h();return;}var k=i[j];(function(){var s=e.getSourceType();if(s){s=s.toLowerCase();}if(typeof k==="function"){return k(e);}else if(typeof k.pattern==="string"){var p=k.pattern.toLowerCase();if(p===s){return Promise.resolve(k);}}else if(k.pattern instanceof RegExp){if(k.pattern.test(s)){return Promise.resolve(k);}}return Promise.reject();})().then(function(l){f({dimension:l.dimension,contentManagerClassName:l.contentManagerClassName,settings:l.settings});},function(){t(j+1);});};t(0);});};
c.addContentManagerResolver=function(e){if(typeof e==="function"){r.unshift(e);}else{r.unshift({pattern:e.pattern,dimension:e.dimension,contentManagerClassName:e.contentManagerClassName,settings:e.settings});}return this;};
c.removeAllContentManagerResolvers=function(){r=[];return this;};
c.removeContentManagerResolver=function(e){var f=typeof e==="function",h=typeof e==="string",j=typeof e==="object",k=e instanceof RegExp;for(var i=0,l=r.length;i<l;++i){if(f||h){if(r[i]===e){r.splice(i,1);return true;}}else if(k){if(typeof r[i]==="object"&&r[i].pattern instanceof RegExp&&r[i].pattern.source===e.source){r.splice(i,1);return true;}}else if(j){if(typeof r[i]==="object"&&e.pattern&&r[i].pattern===e.pattern){r.splice(i,1);return true;}}}return false;};
c._cleanAssociatedLoaders=function(){for(var i=0,e=r.length;i<e;++i){var f=r[i];if(f.settings&&f.settings.loader&&f.settings.loader.exit){f.settings.loader.exit();}}};
c.prototype._collectContentResourceSourceTypeInformation=function(e){var n=false,u=false,f={},h={},j=[];e.forEach(function k(i){j.push(i);i.getContentResources().forEach(k);});return Promise.all(j.map(function(i){return d(i).then(function(k){f[k.dimension]=true;h[k.contentManagerClassName]=true;return k;},function(){if(i.getSourceType()){u=true;}else{n=true;}return false;});})).then(function(k){for(var i=0,l=j.length;i<l;++i){if(k[i]){j[i]._contentManagerResolver=k[i];}}return{noSourceTypes:n,unknownSourceTypes:u,dimensions:Object.getOwnPropertyNames(f).sort(),contentManagerClassNames:Object.getOwnPropertyNames(h)};});};
return c;});
sap.ui.predefine('sap/ui/vk/ContentManager',["sap/ui/base/ManagedObject"],function(M){"use strict";
var C=M.extend("sap.ui.vk.ContentManager",{metadata:{"abstract":true,library:"sap.ui.vk",events:{contentChangesStarted:{parameters:{}},contentChangesFinished:{parameters:{content:{type:"any"},failureReason:{type:"object"}}},contentChangesProgress:{parameters:{phase:{type:"string"},percentage:{type:"float"},source:{type:"any"}}},contentLoadingFinished:{parameters:{source:{type:"any"},node:{type:"any"}}}}}});
var b=C.getMetadata().getParent().getClass().prototype;
C.prototype.init=function(){if(b.init){b.init.call(this);}this._decryptionHandler=null;this._authorizationHandler=null;};
C.prototype.destroyContent=function(c){return this;};
C.prototype.collectGarbage=function(){return this;};
C.prototype.createOrthographicCamera=function(){return null;};
C.prototype.createPerspectiveCamera=function(){return null;};
C.prototype.destroyCamera=function(c){return this;};
C.prototype.setDecryptionHandler=function(h){this._decryptionHandler=h;return this;};
C.prototype.setAuthorizationHandler=function(h){this._authorizationHandler=h;return this;};
return C;});
sap.ui.predefine('sap/ui/vk/ContentResource',["sap/ui/base/ManagedObject","./ContentResourceSourceTypeToCategoryMap"],function(M,C){"use strict";
var a=M.extend("sap.ui.vk.ContentResource",{
metadata:{properties:{source:"any",sourceType:"string",sourceId:"string",localMatrix:"sap.ui.vk.TransformationMatrix",name:"string",password:"string",useSecureConnection:{type:"boolean",defaultValue:true},veid:"string",includeHidden:"boolean",includeAnimation:"boolean",pushPMI:"boolean",metadataFilter:"string",activateView:"string",enableLogger:"boolean",pushViewGroups:"boolean",includeBackground:"boolean",includeParametric:"boolean"},aggregations:{contentResources:"sap.ui.vk.ContentResource"}},
constructor:function(i,s,S){M.apply(this,arguments);}
});
a.prototype.isTreeBinding=function(n){return n==="contentResources";};
a.prototype.destroy=function(){M.prototype.destroy.call(this);};
a.prototype.setLocalMatrix=function(v){var n=this.getNodeProxy();if(n){n.setLocalMatrix(v);}this.setProperty("localMatrix",v,true);return this;};
a.prototype.getSourceProperties=function(){return this._shadowContentResource&&this._shadowContentResource.sourceProperties||{};};
a.prototype.getNodeProxy=function(){return this._shadowContentResource&&this._shadowContentResource.nodeProxy||null;};
a.collectCategories=function(r){var c=[];var m={};function g(b){var s=(b.getSourceType()||"").toLowerCase();if(s){var d=C[s]||"unknown";if(!m.hasOwnProperty(d)){m[d]=true;c.push(d);}}b.getContentResources().forEach(g);}r.forEach(g);return c;};
return a;});
sap.ui.predefine('sap/ui/vk/ContentResourceSourceCategory',[],function(){"use strict";var C={"3D":"3D","2D":"2D"};return C;},true);
sap.ui.predefine('sap/ui/vk/ContentResourceSourceTypeToCategoryMap',["./ContentResourceSourceCategory"],function(C){"use strict";var a={"vds":C["3D"],"vdsl":C["3D"],"cgm":C["3D"],"png":C["2D"],"jpg":C["2D"],"jpeg":C["2D"],"gif":C["2D"],"bmp":C["2D"],"tiff":C["2D"],"tif":C["2D"],"svg":C["2D"]};return a;},true);
sap.ui.predefine('sap/ui/vk/Core',["sap/base/strings/capitalize","sap/base/util/each","sap/ui/base/ManagedObject","sap/ui/base/ManagedObjectObserver","sap/ui/core/Core","sap/ui/core/EventBus","./library"],function(c,e,M,a,b,E,v){"use strict";
var C=M.extend("sap.ui.vk.Core",{
metadata:{aggregations:{eventBus:{type:"sap.ui.core.EventBus",multiple:false,visibility:"hidden"}}},
constructor:function(){if(v.getCore){return v.getCore();}M.call(this);var t=this;v.getCore=function(){return t;};this.setAggregation("eventBus",new E());}
});
C.prototype.getEventBus=function(){return this.getAggregation("eventBus");};
function m(d,f){if(f.multiple){return(d==="insert"?"onAdd":"onRemove")+c(f.singularName);}else{return(d==="insert"?"onSet":"onUnset")+c(f.name);}}
function n(o,d,f){var g=f.getId();o.forEach(function(h){e(h.getMetadata().getAllAssociations(),function(i,j){if(f.isA(j.type)){var k=h["get"+c(i)]();if(k===g||Array.isArray(k)&&k.indexOf(g)>=0){var l=h[m(d,j)];if(typeof l==="function"){l.call(h,f);}}}});});}
C.prototype.observeLifetime=function(o){if(!this._lifetimeObserver){this._lifetimeObserver=new a(function(d){if(d.type==="destroy"&&this._objectsWithAssociations){n(this._objectsWithAssociations.slice(),"remove",d.object);}}.bind(this));}this._lifetimeObserver.observe(o,{destroy:true});if(this._objectsWithAssociations){n(this._objectsWithAssociations.slice(),"insert",o);}return this;};
C.prototype.observeAssociations=function(o){if(!o.getId()){throw new Error("To observe an object is must have an ID.");}if(!this._objectsWithAssociations){var t=this;this._objectsWithAssociations=[];this._associationObserver=new a(function(d){var i=t._objectsWithAssociations.indexOf(d.object);if(i<0){return;}if(d.type==="destroy"){e(o.getMetadata().getAllAssociations(),function(j,f){var g;var k=c(f.name);if(f.multiple){g=d.object["removeAll"+k];if(typeof g==="function"){g.call(d.object);}}else{g=d.object["set"+k];if(typeof g==="function"){g.call(d.object,null);}}});t._objectsWithAssociations.splice(i,1);}else if(d.type==="association"){var f=d.object.getMetadata().getAllAssociations()[d.name];var g=d.object[m(d.mutation,f)];if(typeof g==="function"){if(Array.isArray(d.ids)){d.ids.map(function(j){return b.byId(j);}).filter(function(h){return h!=null;}).forEach(g.bind(d.object));}else{var h=b.byId(d.ids);if(h){g.call(d.object,h);}}}}});}if(this._objectsWithAssociations.indexOf(o)<0){this._objectsWithAssociations.push(o);this._associationObserver.observe(o,{associations:true,destroy:true});e(o.getMetadata().getAllAssociations(),function(d,f){var g=o[m("insert",f)];if(typeof g==="function"){var i=o["get"+c(d)]();if(Array.isArray(i)){i.map(function(j){return b.byId(j);}).filter(function(h){return h!=null;}).forEach(g.bind(o));}else{var h=b.byId(i);if(h){g.call(o,h);}}}});}return this;};
return new C();});
sap.ui.predefine('sap/ui/vk/DetailViewShape',[],function(){"use strict";var D={Box:"Box",Circle:"Circle",CircleLine:"CircleLine",CirclePointer:"CirclePointer",CircleArrow:"CircleArrow",CircleBubbles:"CircleBubbles",BoxLine:"BoxLine",BoxNoOutline:"BoxNoOutline",SolidPointer:"SolidPointer",SolidArrow:"SolidArrow"};return D;},true);
sap.ui.predefine('sap/ui/vk/DetailViewType',[],function(){"use strict";var D={DetailView:"DetailView",Cutaway:"Cutaway"};return D;},true);
sap.ui.predefine('sap/ui/vk/DownloadManager',["sap/ui/base/EventProvider","./Messages","./getResourceBundle","sap/base/Log"],function(E,M,g,L){"use strict";
var D=E.extend("sap.ui.vk.DownloadManager",{
metadata:{events:{itemSucceeded:{parameters:{source:{type:"any"},response:{type:"object"}}},itemProgress:{parameters:{source:{type:"any"},loaded:{type:"int"},total:{type:"int"}}},itemFailed:{parameters:{source:{type:"any"},status:{type:"any"},statusText:{type:"string"}}},allItemsCompleted:{}}},
constructor:function(s,m,a){E.apply(this);this._maxParallelTasks=m||5;this._sourcesToProcess=s.slice();this._sourcesBeingProcessed=[];this._authorizationHandler=a;}
});
D.prototype.start=function(){while(this._pickAndDispatchTask()){}return this;};
D.prototype.queue=function(s){this._sourcesToProcess.push(s);this._pickAndDispatchTask();return this;};
D.prototype._pickAndDispatchTask=function(){if(this._sourcesToProcess.length>0&&this._sourcesBeingProcessed.length<this._maxParallelTasks){var s=this._sourcesToProcess.shift();this._sourcesBeingProcessed.push(s);var t=this;if(this._authorizationHandler){this._authorizationHandler(s).then(function(a){var b=null;if(a!=null){b=a.token_type+" "+a.access_token;}var c=a?a.tenant_uuid:null;t._runTask(s,b,c);}).catch(function(r){t.fireItemFailed({source:s,status:0,statusText:r});t._taskFinished(s);if(t._queueIsEmpty()){t._asyncFireAllItemsCompleted();}});}else{this._runTask(s);}return true;}return false;};
D.prototype._taskFinished=function(s){var i=this._sourcesBeingProcessed.indexOf(s);if(i>=0){this._sourcesBeingProcessed.splice(i,1);}return this;};
D.prototype._queueIsEmpty=function(){return this._sourcesToProcess.length===0&&this._sourcesBeingProcessed.length===0;};
D.prototype._runTask=function(s,a,t){var b=this;if(typeof s==="string"){var x=new(typeof sinon==="object"&&sinon.xhr&&sinon.xhr.XMLHttpRequest||XMLHttpRequest);x.onerror=function(e){b._taskFinished(s);b._pickAndDispatchTask();b.fireItemFailed({source:s,status:x.status,statusText:x.statusText});if(b._queueIsEmpty()){b._asyncFireAllItemsCompleted();}};x.onload=function(e){b._taskFinished(s);b._pickAndDispatchTask();if(x.status===200||x.status===0){b.fireItemSucceeded({source:s,response:x.response});}else{b.fireItemFailed({source:s,status:x.status,statusText:x.statusText});}if(b._queueIsEmpty()){b._asyncFireAllItemsCompleted();}};x.onprogress=function(e){b.fireItemProgress({source:s,loaded:e.loaded,total:e.total});};x.open("GET",s,true);x.responseType="arraybuffer";if(a){x.setRequestHeader("Authorization",a);}if(t){x.setRequestHeader("X-TenantUuid",t);}x.send(null);}else if(s instanceof File){var f=new FileReader();f.onload=function(e){b._taskFinished(s);b._pickAndDispatchTask();b.fireItemSucceeded({source:s,response:f.result});if(b._queueIsEmpty()){b._asyncFireAllItemsCompleted();}};f.onerror=function(e){b._taskFinished(s);b._pickAndDispatchTask();b.fireItemFailed({source:s,status:f.error.name,statusText:f.error.message});if(b._queueIsEmpty()){b._asyncFireAllItemsCompleted();}};f.onprogress=function(e){b.fireItemProgress({source:s.name,loaded:e.loaded,total:e.total});};f.readAsArrayBuffer(s);}else{L.error(g().getText(M.VIT5.summary),M.VIT5.code,"sap.ui.vk.DownloadManager");}return this;};
D.prototype._asyncFireAllItemsCompleted=function(){setTimeout(function(){this.fireAllItemsCompleted();}.bind(this),0);};
D.prototype.attachItemSucceeded=function(d,f,l){return this.attachEvent("itemSucceeded",d,f,l);};
D.prototype.detachItemSucceeded=function(f,l){return this.detachEvent("itemSucceeded",f,l);};
D.prototype.fireItemSucceeded=function(p,a,e){return this.fireEvent("itemSucceeded",p,a,e);};
D.prototype.attachItemFailed=function(d,f,l){return this.attachEvent("itemFailed",d,f,l);};
D.prototype.detachItemFailed=function(f,l){return this.detachEvent("itemFailed",f,l);};
D.prototype.fireItemFailed=function(p,a,e){return this.fireEvent("itemFailed",p,a,e);};
D.prototype.attachAllItemsCompleted=function(d,f,l){return this.attachEvent("allItemsCompleted",d,f,l);};
D.prototype.detachAllItemsCompleted=function(f,l){return this.detachEvent("allItemsCompleted",f,l);};
D.prototype.fireAllItemsCompleted=function(p,a,e){return this.fireEvent("allItemsCompleted",p,a,e);};
D.prototype.attachItemProgress=function(d,f,l){return this.attachEvent("itemProgress",d,f,l);};
D.prototype.detachItemProgress=function(f,l){return this.detachEvent("itemProgress",f,l);};
D.prototype.fireItemProgress=function(p,a,e){return this.fireEvent("itemProgress",p,a,e);};
return D;});
sap.ui.predefine('sap/ui/vk/DrawerToolbar',["./library","./DrawerToolbarRenderer","sap/ui/core/Control","sap/m/VBox","sap/m/FlexItemData","sap/m/OverflowToolbar","sap/ui/core/Icon","sap/m/Button","sap/m/ToolbarSeparator","sap/m/ToggleButton","sap/m/MenuButton","./tools/Tool","./tools/RectSelectTool","./tools/CrossSectionTool","sap/m/Menu","sap/m/MenuItem","./ZoomTo","./getResourceBundle","./Viewport","./DrawerToolbarButton","sap/ui/base/ManagedObjectObserver"],function(v,D,C,V,F,O,I,B,T,a,M,b,R,c,d,e,Z,g,f,h,j){"use strict";
var k=C.extend("sap.ui.vk.DrawerToolbar",{
metadata:{properties:{expanded:{type:"boolean",defaultValue:true}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_getToolbar",aggregation:"content",forwardBinding:true}}},associations:{viewport:{type:"sap.ui.vk.Viewport",multiple:false}},events:{expanded:{parameters:{expand:{type:"boolean"}}}}},
constructor:function(i,S){C.apply(this,arguments);}
});
var l=[{name:"show",unicode:"e000"},{name:"hide",unicode:"e001"},{name:"turntable",unicode:"e002"},{name:"orbit",unicode:"e003"},{name:"pan",unicode:"e004"},{name:"zoom",unicode:"e005"},{name:"fit-to-view",unicode:"e006"},{name:"rectangular-selection",unicode:"e007"},{name:"structure-browser",unicode:"e008"},{name:"configuration",unicode:"e009"},{name:"setting",unicode:"e00a"},{name:"full-screen",unicode:"e00b"},{name:"predefined-views",unicode:"e00c"},{name:"authoring-app",unicode:"e00d"},{name:"dot",unicode:"e00e"},{name:"empty",unicode:"e00f"},{name:"right-panel-menu",unicode:"e010"},{name:"viewer-app",unicode:"e011"},{name:"hide-association",unicode:"e012"},{name:"cross-section",unicode:"e013"},{name:"cross-section-x",unicode:"e014"},{name:"cross-section-z",unicode:"e015"},{name:"cross-section-y",unicode:"e016"},{name:"reverse-direction",unicode:"e017"},{name:"create-editable-visualisation",unicode:"e018"},{name:"cross-section-z-",unicode:"e019"}],m="vk-icons",n="vk-icons";l.forEach(function(i){sap.ui.core.IconPool.addIcon(i.name,m,n,i.unicode);});var o="sap-icon://vk-icons/";
k.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}this._itemsVisibility=new Map();this._itemsVisibilityObserver=new j(this._itemVisibilityChanged.bind(this));this._toolbar=new O({width:"auto",design:sap.m.ToolbarDesign.Solid,layoutData:new F({growFactor:0,shrinkFactor:0}),content:this.createButtons()});this._toolbar.ontouchstart=function(i){i.setMarked();};this._toolbarObserver=new j(this._toolbarContentChanged.bind(this));this._toolbarObserver.observe(this._toolbar,{aggregations:["content"]});this._container=new V({renderType:sap.m.FlexRendertype.Bare,alignContent:sap.m.FlexAlignContent.Center,alignItems:sap.m.FlexAlignItems.Center,items:[this._toolbar,new I({src:"sap-icon://navigation-up-arrow",noTabStop:true,press:function(i){this._toggleExpanded();}.bind(this),layoutData:new F({growFactor:0,shrinkFactor:0})}).addStyleClass("drawerToolbarIcon")]});this._rectSelectTool=new R();};
k.prototype._toolbarContentChanged=function(){var p=this._toolbar.getContent();for(var i=0;i<p.length;i++){if(p[i].getMetadata().getName()=="sap.m.ToolbarSeparator"){if(p[i-1]==undefined||p[i+1]==undefined||p[i-1].getMetadata().getName()=="sap.m.ToolbarSeparator"){this._toolbar.removeContent(i);}}}};
k.prototype._itemVisibilityChanged=function(i){if(!this._ignoreVisiblityChange){this._itemsVisibility.set(i.object,i.current);}};
k.prototype._getViewport=function(){var i=sap.ui.getCore().byId(this.getViewport());if(i.getMetadata().getName()==="sap.ui.vk.threejs.Viewport"||i.getMetadata().getName()==="sap.ui.vk.svg.Viewport"){return i;}if(i instanceof f&&i.getImplementation()&&(i.getImplementation().getMetadata().getName()==="sap.ui.vk.threejs.Viewport"||i.getImplementation().getMetadata().getName()==="sap.ui.vk.svg.Viewport")){return i.getImplementation();}return null;};
k.prototype._getViewStateManager=function(){var i=sap.ui.getCore().byId(this.getViewport());var p=i.getViewStateManager();if(p){return sap.ui.getCore().byId(p);}return null;};
var q=[null,new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),0),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),-Math.PI/2),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2)];
k.prototype.createButtons=function(){var i=this;var p,x;function y(U,W,X){p.setPressed(true);if(i._crossSectionTool){i._crossSectionTool.setActive(true,U);if(W!==undefined){i._crossSectionTool.setAxis(W);x.setIcon(o+"cross-section-"+["x","y","z"][W]);}}}p=new a({icon:o+"cross-section",type:sap.m.ButtonType.Transparent,tooltip:"Cross Section",press:function(U){var W=i._getViewport();if(W){if(this.getPressed()){y(W);}else if(i._crossSectionTool){i._crossSectionTool.setActive(false,W);}}}});p.vitId=h.CrossSection;x=new M({type:sap.m.ButtonType.Transparent,tooltip:"Cross Section Axis",icon:o+"cross-section-x",menu:new d({items:[new e({icon:o+"cross-section-x",text:g().getText("CROSS_SECTION_X"),press:function(U){var W=i._getViewport();if(W){y(W,0,false);}}}),new e({icon:o+"cross-section-y",text:g().getText("CROSS_SECTION_Y"),press:function(U){var W=i._getViewport();if(W){y(W,1,false);}}}),new e({icon:o+"cross-section-z",text:g().getText("CROSS_SECTION_Z"),press:function(U){var W=i._getViewport();if(W){y(W,2,false);}}}),new e({icon:o+"reverse-direction",text:g().getText("CROSS_SECTION_REVERSE"),startsSection:true,press:function(U){var W=i._getViewport();if(W&&i._crossSectionTool&&i._crossSectionTool.getActive()){i._crossSectionTool.setFlip(!i._crossSectionTool.getFlip());}}})]})});x.vitId=h.CrossSectionAxis;var z=new a({icon:o+"turntable",type:sap.m.ButtonType.Transparent,tooltip:"Turntable",press:function(U){var W=i._getViewport();if(W){i._activateGesture(W,0);}}});z.vitId=h.Turntable;var A=new a({icon:o+"orbit",type:sap.m.ButtonType.Transparent,tooltip:"Orbit",pressed:false,press:function(U){var W=i._getViewport();if(W){i._activateGesture(W,1);}}});A.vitId=h.Orbit;var E=new a({icon:o+"pan",type:sap.m.ButtonType.Transparent,tooltip:"Pan",press:function(U){var W=i._getViewport();if(W){i._activateGesture(W,2);}}});E.vitId=h.Pan;var G=new a({icon:o+"zoom",type:sap.m.ButtonType.Transparent,tooltip:"Zoom",press:function(){var U=i._getViewport();if(U){i._activateGesture(U,3);}}});G.vitId=h.Zoom;this._activeGesture=-1;this._gestureButtons=[z,A,E,G];var H=new B({icon:o+"show",type:sap.m.ButtonType.Transparent,tooltip:"Show",press:function(){var U=i._getViewStateManager();if(U){var W=[];U.enumerateSelection(function(X){W.push(X);});U.setVisibilityState(W,true,false);}}});H.vitId=h.Show;var J=new B({icon:o+"hide",type:sap.m.ButtonType.Transparent,tooltip:"Hide",press:function(){var U=i._getViewStateManager();if(U){var W=[];U.enumerateSelection(function(X){W.push(X);});U.setVisibilityState(W,false,false);}}});J.vitId=h.Hide;var K=new B({icon:o+"fit-to-view",type:sap.m.ButtonType.Transparent,tooltip:g().getText("FIT_TO_VIEW"),press:function(){var U=sap.ui.getCore().byId(i.getViewport());if(U){U.zoomTo(Z.All,null,0.5,0);}}});K.vitId=h.FitToView;this._rectSelectionButton=new a({icon:o+"rectangular-selection",type:sap.m.ButtonType.Transparent,tooltip:"Rectangular Selection"});this._rectSelectionButton.vitId=h.RectangularSelection;var L=new M({icon:o+"predefined-views",activeIcon:o+"predefined-views",type:sap.m.ButtonType.Transparent,tooltip:g().getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),menu:new d({items:[new e({text:g().getText("PREDEFINED_VIEW_INITIAL")}),new e({text:g().getText("PREDEFINED_VIEW_FRONT"),startsSection:true}),new e({text:g().getText("PREDEFINED_VIEW_BACK")}),new e({text:g().getText("PREDEFINED_VIEW_LEFT")}),new e({text:g().getText("PREDEFINED_VIEW_RIGHT")}),new e({text:g().getText("PREDEFINED_VIEW_TOP")}),new e({text:g().getText("PREDEFINED_VIEW_BOTTOM")})]}).attachItemSelected(function(U){var W=i._getViewport();if(W){var X=U.getParameters("item").item;var Y=this.indexOfItem(X);W._viewportGestureHandler.setView(q[Y],1000);}})});L.vitId=h.PredefinedViews;var N=new a({icon:o+"full-screen",type:sap.m.ButtonType.Transparent,tooltip:g().getText("VIEWER_FULLSCREENBUTTONTOOLTIP"),press:function(U){var W=i._getViewport();var X=function($){return!!($.fullScreen||$.webkitIsFullScreen||$.mozFullScreen||$.msFullscreenElement);};if(this.getPressed()){if(!X(document)){if(!i._fullScreenHandler){i._fullScreenHandler=function(U){var $=X(document);if(!$){document.removeEventListener("fullscreenchange",i._fullScreenHandler);document.removeEventListener("mozfullscreenchange",i._fullScreenHandler);document.removeEventListener("webkitfullscreenchange",i._fullScreenHandler);document.removeEventListener("MSFullscreenChange",i._fullScreenHandler);this.setPressed(false);W.removeStyleClass("sapVizKitViewerFullScreen");}}.bind(this);}var Y=document.getElementsByTagName("body")[0];if(Y.requestFullscreen){document.addEventListener("fullscreenchange",i._fullScreenHandler);Y.requestFullscreen();}else if(Y.webkitRequestFullScreen){document.addEventListener("webkitfullscreenchange",i._fullScreenHandler);Y.webkitRequestFullscreen();}else if(Y.mozRequestFullScreen){document.addEventListener("mozfullscreenchange",i._fullScreenHandler);Y.mozRequestFullScreen();}else if(Y.msRequestFullscreen){document.addEventListener("MSFullscreenChange",i._fullScreenHandler);Y.msRequestFullscreen();}}W.addStyleClass("sapVizKitViewerFullScreen");}else{if(X(document)){if(document.cancelFullScreen){document.cancelFullScreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}}W.removeStyleClass("sapVizKitViewerFullScreen");}}});N.vitId=h.FullScreen;var P=new T();var Q=new T();this._items3D=[this._gestureButtons[0],this._gestureButtons[1],p,x,P,L,Q];var S=[H,J,new T(),this._gestureButtons[0],this._gestureButtons[1],this._gestureButtons[2],this._gestureButtons[3],new T(),K,new T(),this._rectSelectionButton,new T(),p,x,P,L,Q,N];S.forEach(function(U){this._itemsVisibility.set(U,true);this._itemsVisibilityObserver.observe(U,{properties:["visible"]});}.bind(this));return S;};
var r=["drawerToolbarIconTurntable","drawerToolbarIconOrbit","drawerToolbarIconPan","drawerToolbarIconZoom"];var s=function(i,p){this.viewport=i;this._toolbar=p;this._mode=1;this._gesture=false;this._x=0;this._y=0;};
function t(p,x){r.forEach(function(y,i){if(p.hasStyleClass(y)&&i!==x){p.removeStyleClass(y);}else if(i===x){p.addStyleClass(y);}});}
function u(i){var p=i.viewport;var x=i._mode;var y=p.hasStyleClass(r[x])?x:-1;i._isScrolling=true;if(y!==3){t(p,3);setTimeout(function(){i._isScrolling=false;t(p,y);},500);}}
function w(i){return i?i.getMetadata().getName()==="sap.ui.vk.threejs.Viewport":false;}
s.prototype.beginGesture=function(i){this._gesture=true;if(this._mode<3){this._x=i.points[0].x;this._y=i.points[0].y;}else{this._x=i.x;this._y=i.y;}if(i.scroll){u(this);}if(this._toolbar._rectSelectionButton.getPressed()||(i.event&&(sap.ui.Device.os.macintosh?i.event.metaKey:i.event.ctrlKey))){var p=this.viewport.getDomRef().getBoundingClientRect();this._selectionRect={x1:this._x-p.left,y1:this._y-p.top,x2:this._x-p.left,y2:this._y-p.top};}};
s.prototype.endGesture=function(){this._gesture=false;if(this._selectionRect&&(this._selectionRect.x1!==this._selectionRect.x2||this._selectionRect.y1!==this._selectionRect.y2)){this._toolbar._rectSelectTool._select(this._selectionRect.x1,this._selectionRect.y1,this._selectionRect.x2,this._selectionRect.y2,this.viewport,this.viewport.getScene(),this.viewport.getCamera());this._selectionRect=null;this.viewport.setSelectionRect(null);}else if(!this._isScrolling){t(this.viewport,-1);}};
s.prototype.move=function(i){if(this._gesture&&i.n==1){var p=i.points[0];if(this._selectionRect){var x=this.viewport.getDomRef().getBoundingClientRect();this._selectionRect.x2=p.x-x.left;this._selectionRect.y2=p.y-x.top;this.viewport.setSelectionRect(this._selectionRect);}else{t(this.viewport,this._mode);var y=p.x-this._x;var z=p.y-this._y;var A=w(this.viewport)?this.viewport._viewportGestureHandler._cameraController:this.viewport;switch(this._mode){case 0:A.rotate(y,z,true);break;case 1:A.rotate(y,z,false);break;case 2:A.pan(y,z);break;case 3:A.zoom(1+z*0.005);break;default:break;}this._x=p.x;this._y=p.y;}i.handled=true;}};
s.prototype.hover=function(){};
s.prototype.getViewport=function(){return this.viewport;};
k.prototype._activateGesture=function(i,p){this._activeGesture=p;this._gestureButtons.forEach(function(x,y){x.setPressed(y===p);});if(!this._cameraHandler||this._cameraHandler.getViewport()!=i){this._cameraHandler=new s(i,this);i._loco.addHandler(this._cameraHandler,0);}this._cameraHandler._mode=p;};
k.prototype._getToolbar=function(){return this._toolbar;};
k.prototype._toggleExpanded=function(){var i=!this.getExpanded();this.setExpanded(i);this.fireExpanded({expand:i});};
k.prototype.setExpanded=function(E){this.setProperty("expanded",E,true);var i=this.getDomRef();if(i){if(!E){i.classList.add("drawerToolbarCollapsed");i.classList.remove("drawerToolbarExpanded");this._container.addStyleClass("vboxCollapsed");}else{i.classList.add("drawerToolbarExpanded");i.classList.remove("drawerToolbarCollapsed");this._container.removeStyleClass("vboxCollapsed");}}return this;};
k.prototype.onBeforeRendering=function(){var i=this._getViewport();if(i){var p=w(i);this._ignoreVisiblityChange=true;this._items3D.forEach(function(x){x.setVisible(p&&this._itemsVisibility.get(x));}.bind(this));this._ignoreVisiblityChange=false;if(p){this._crossSectionTool=this._crossSectionTool||new c();i.addTool(this._crossSectionTool);}this._activateGesture(i,Math.max(this._activeGesture,p?0:2));}};
return k;});
sap.ui.predefine('sap/ui/vk/DrawerToolbarRenderer',[],function(){"use strict";var D={};
D.render=function(r,d){r.write("<div ");r.writeControlData(d);r.addClass("drawerToolbar");if(!d.getExpanded()){r.addClass("drawerToolbarCollapsed");}else{r.addClass("drawerToolbarExpanded");}r.writeClasses();r.write(">");r.renderControl(d._container);r.write("</div>");};
return D;},true);
sap.ui.predefine('sap/ui/vk/DvlException',["sap/ui/base/Exception"],function(E){"use strict";var D=function(c,m){this.name="DvlException";this.code=c;this.message=m;};D.prototype=Object.create(E.prototype);return D;});
sap.ui.predefine('sap/ui/vk/FlexibleControl',["./library","sap/ui/core/Control","sap/ui/core/EnabledPropagator","./FlexibleControlRenderer"],function(v,C,E,F){"use strict";
var a=C.extend("sap.ui.vk.FlexibleControl",{metadata:{library:"sap.ui.vk",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},layout:{type:"string",group:"Behavior",defaultValue:"Stacked"},enabled:{type:"boolean",group:"Behavior",defaultValue:true}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"}},designTime:true}});
E.call(a.prototype);return a;});
sap.ui.predefine('sap/ui/vk/FlexibleControlLayoutData',["sap/ui/core/LayoutData"],function(L){"use strict";
var F=L.extend("sap.ui.vk.FlexibleControlLayoutData",{metadata:{library:"sap.ui.vk",properties:{size:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"auto"},minSize:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"},marginTop:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"},marginBottom:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"}}}});
return F;});
sap.ui.predefine('sap/ui/vk/FlexibleControlRenderer',[],function(){"use strict";var F={};
F.render=function(r,f){var a=r;a.write("<div");a.writeControlData(f);a.addClass("sapUiFlexControl");if(f.getWidth()&&f.getWidth()!=""){a.addStyle("width",f.getWidth());}if(f.getHeight()&&f.getHeight()!=""){a.addStyle("height",f.getHeight());}a.writeStyles();a.writeClasses();a.write(">");var c=f.getContent();var l=f.getLayout();var b="sapUiFlexCellStacked";if(l=="Vertical"){b="sapUiFlexCellVertical";}for(var i=0;i<c.length;i++){var d=c[i];a.write("<div id=\""+f.getId()+"Content_"+i+"\" class=\""+b+"\"");var e=d.getLayoutData();if(e&&l!="Stacked"){a.write(" style=\"");if(e.getSize()&&e.getSize()!=""){a.write("height: "+e.getSize()+";");}if(e.getMinSize()&&e.getMinSize()!=""){a.write("min-height: "+e.getMinSize()+";");}if(e.getMarginTop()&&e.getMarginTop()!=""){a.write("margin-top: "+e.getMarginTop()+";");}if(e.getMarginBottom()&&e.getMarginBottom()!=""){a.write("margin-bottom: "+e.getMarginBottom()+";");}a.write("\"");}a.write(">");a.renderControl(d);a.write("</div>");}a.write("</div>");};
return F;},true);
sap.ui.predefine('sap/ui/vk/Highlight',["sap/ui/base/Object"],function(B){"use strict";
var H=B.extend("sap.ui.vk.Highlight",{constructor:function(i,p){this._id=i;this._name=p&&p.name?p.name:"";this._duration=p&&p.duration?p.duration:0.0;this._cycles=p&&p.cycles?p.cycles:0;this._colours=p&&p.colours?p.colours:[];this._opacities=p&&p.opacities?p.opacities:[];this._fadeOut=p&&p.fadeOut?p.fadeOut:false;this._reset();}});
H.prototype.getId=function(){return this._id;};
H.prototype.getName=function(){return this._name;};
H.prototype.setName=function(n){this._name=n;return this;};
H.prototype.getDuration=function(){return this._duration;};
H.prototype.setDuration=function(d){this._duration=d;this._reset();return this;};
H.prototype.getCycles=function(){return this._cycles;};
H.prototype.setCycles=function(c){this._cycles=c;this._reset();return this;};
H.prototype.getOpacities=function(){return this._opacities;};
H.prototype.setOpacities=function(o){this._opacities=o;this._reset();return this;};
H.prototype.getColours=function(){return this._colours;};
H.prototype.setColours=function(c){this._colours=c;this._reset();return this;};
H.prototype._reset=function(){var k,o,t;var n=false;if(this._opacities&&this._opacities.length){for(var i=0;i<this._opacities.length;i++){if(this._opacities[i]<0.999){n=true;break;}}}if(n){if(Math.abs(this._duration-0.0)<0.000000001||this._opacities.length===1){this._adjustedOpacities=[this._opacities[0]];this._opacityTimes=[0.0];}else if(this._cycles>0){t=this._duration/this._opacities.length;this._adjustedOpacities=[];this._opacityTimes=[];for(k=0;k<this._cycles;k++){for(o=0;o<this._opacities.length;o++){this._adjustedOpacities.push(this._opacities[o]);this._opacityTimes.push(t*(k*this._opacities.length+o));}}}else{t=this._duration/this._opacities.length;this._adjustedOpacities=[];this._opacityTimes=[];for(o=0;o<this._opacities.length;o++){this._adjustedOpacities.push(this._opacities[o]);this._opacityTimes.push(t*o);}this._adjustedOpacities.push(this._opacities[0]);this._opacityTimes.push(t*this._opacities.length);}}else{this._adjustedOpacities=[];this._opacityTimes=[];}var a=true;if(this._colours&&this._colours.length){for(var j=0;j<this._colours.length;j++){if(this._colours[j][3]<0){a=false;break;}}}else{a=false;}if(a){if(this._cycles===0&&this._duration>0.0){if(this._colours.length===1){this._colours.push([0,0,0,0]);}}if(Math.abs(this._duration-0.0)<0.000000001||this._colours.length===1){this._adjustedColours=[this._colours[0]];this._colourTimes=[0.0];}else if(this._cycles>0){t=this._duration/this._colours.length;this._adjustedColours=[];this._colourTimes=[];for(k=0;k<this._cycles;k++){for(o=0;o<this._colours.length;o++){this._adjustedColours.push(this._colours[o]);this._colourTimes.push(t*(k*this._colours.length+o));}}}else{t=this._duration/this._colours.length;this._adjustedColours=[];this._colourTimes=[];for(o=0;o<this._colours.length;o++){this._adjustedColours.push(this._colours[o]);this._colourTimes.push(t*o);}this._adjustedColours.push(this._colours[0]);this._colourTimes.push(t*this._colours.length);}}else{this._adjustedColours=[];this._colourTimes=[];}};
H.prototype.getOpacity=function(t){if(!this._adjustedOpacities||!this._adjustedOpacities.length){return undefined;}var r={};if(this._adjustedOpacities.length===1){r.opacity=this._adjustedOpacities[0];r.isCompleted=true;return r;}var d=this._opacityTimes[this._opacityTimes.length-1];var c=t;if(this._cycles===0){while(c>d){c-=d;}}if(c>=d){if(this._cycles>0){r.isCompleted=true;r.opacity=undefined;}else{r.isCompleted=false;r.opacity=this._adjustedOpacities[this._adjustedOpacities.length-1];}return r;}var a=this._opacityTimes[1]-this._opacityTimes[0];var b=c/a;var i=Math.floor(b);var e=b-i;r.opacity=this._adjustedOpacities[i]*(1-e)+this._adjustedOpacities[i+1]*e;r.isCompleted=false;return r;};
H.prototype.getColour=function(t){if(!this._adjustedColours||!this._adjustedColours.length){return undefined;}var c={};if(this._adjustedColours.length===1){c.colour=this._adjustedColours[0];c.isCompleted=true;return c;}var d=this._colourTimes[this._colourTimes.length-1];var e=t;if(this._cycles===0){while(e>d){e-=d;}}if(e>=d){if(this._cycles>0){c.isCompleted=true;c.colour=undefined;}else{c.isCompleted=false;c.colour=this._adjustedColours[this._adjustedColours.length-1];}return c;}var f=this._colourTimes[1]-this._colourTimes[0];var h=e/f;var i=Math.floor(h);var j=h-i;var r=this._adjustedColours[i][0]*(1-j)+this._adjustedColours[i+1][0]*j;var g=this._adjustedColours[i][1]*(1-j)+this._adjustedColours[i+1][1]*j;var b=this._adjustedColours[i][2]*(1-j)+this._adjustedColours[i+1][2]*j;var a=this._adjustedColours[i][3]*(1-j)+this._adjustedColours[i+1][3]*j;c.colour=[r,g,b,a];c.isCompleted=false;return c;};
H.prototype.getLastOpacity=function(){var r;if(this._opacities&&this._opacities.length>0){r=this._opacities[this._opacities.length-1];}return r;};
H.prototype.isFadeOut=function(){return this._fadeOut;};
return H;});
sap.ui.predefine('sap/ui/vk/ImageContentManager',["./Messages","./ContentManager","./getResourceBundle"],function(M,C,g){"use strict";
var I=C.extend("sap.ui.vk.ImageContentManager",{metadata:{library:"sap.ui.vk"}});
var b=I.getMetadata().getParent().getClass().prototype;
I.prototype.init=function(){if(b.init){b.init.call(this);}this._handleLoadSucceededProxy=this._handleLoadSucceeded.bind(this);this._handleLoadFailedProxy=this._handleLoadFailed.bind(this);};
I.prototype.exit=function(){if(b.exit){b.exit.call(this);}};
I.prototype.loadContent=function(c,a){if(a.length!==1){setTimeout(function(){this.fireContentChangesStarted();this.fireContentChangesFinished({content:null,failureReason:{errorMessage:g().getText("IMAGECONTENTMANAGER_ONLY_LOAD_SINGLE_IMAGE")}});}.bind(this),0);}else if(a[0].getContentResources().length>0){setTimeout(function(){this.fireContentChangesStarted();this.fireContentChangesFinished({content:null,failureReason:{errorMessage:g().getText("IMAGECONTENTMANAGER_CANNOT_LOAD_IMAGE_HIERARCHY")}});}.bind(this),0);}else{var d=a[0],s=d.getSource(),e=d.getSourceType(),l=null;if(d._contentManagerResolver&&d._contentManagerResolver.settings&&d._contentManagerResolver.settings.loader){l=d._contentManagerResolver.settings.loader;}if(s instanceof File){var f=new FileReader();f.onload=function(h){this._loadImageFromUrl(c,f.result,e,l);}.bind(this);f.readAsDataURL(s);}else{var t=new sap.m.Image({src:s});s=t.getSrc();t.destroy();this._loadImageFromUrl(c,s,e,l);}}};
I.prototype._addEventListeners=function(h){h.addEventListener("load",this._handleLoadSucceededProxy);h.addEventListener("error",this._handleLoadFailedProxy);};
I.prototype._removeEventListeners=function(h){h.removeEventListener("error",this._handleLoadFailedProxy);h.removeEventListener("load",this._handleLoadSucceededProxy);};
I.prototype._addSvgQuirks=function(h){h.style.setProperty("visibility","collapse");h.style.setProperty("width","0");h.style.setProperty("height","0");h.style.setProperty("position","absolute");document.body.appendChild(h);return this;};
I.prototype._removeSvgQuirks=function(h){h.parentElement.removeChild(h);h.style.removeProperty("visibility");h.style.removeProperty("width");h.style.removeProperty("height");h.style.removeProperty("position");return this;};
I.prototype._loadImageFromUrl=function(c,u,s,l){this.fireContentChangesStarted();switch(s.toLowerCase()){case"svg":var a=document.createElement("object");this._addEventListeners(a);a.type="image/svg+xml";a.data=u;a.className="SVGImage";this._addSvgQuirks(a);break;case"jpg":case"jpeg":case"png":case"gif":case"bmp":case"tif":case"tiff":var i=document.createElement("img");this._addEventListeners(i);if(l){var t=this;l(u).then(function(r){i.src=r;},function(e){t.fireContentChangesFinished({content:null,failureReason:{errorMessage:e}});});}else{i.src=u;}break;default:setTimeout(function(){this.fireContentChangesFinished({content:null,failureReason:{errorMessage:g().getText("IMAGECONTENTMANAGER_UNSUPPORTED_IMAGE_TYPE"),sourcesFailedToDownload:[{source:u}]}});}.bind(this),0);break;}};
I.prototype._handleLoadSucceeded=function(e){var c=e.target;this._removeEventListeners(c);if(c instanceof HTMLObjectElement){this._removeSvgQuirks(c);}this.fireContentChangesFinished({content:c});};
I.prototype._handleLoadFailed=function(e){var c=e.target;this._removeEventListeners(c);if(c instanceof HTMLObjectElement){this._removeSvgQuirks(c);}this.fireContentChangesFinished({content:null,failureReason:{errorMessage:g().getText("IMAGECONTENTMANAGER_IMAGE_LOAD_FAILED"),sourcesFailedToDownload:[{source:c instanceof HTMLImageElement?c.src:c.data}]}});};
return I;});
sap.ui.predefine('sap/ui/vk/JointUtils',["./glMatrix"],function(g){"use strict";var m=g.mat4;var A=g.glMatrix.ARRAY_TYPE;var J={recalculateJoints:function(j,n,t){var w;if(t.length===16){w=t;}else{w=new A(16);m.fromRotationTranslationScale(w,t.quaternion||[0,0,0,1],t.translation||[0,0,0],t.scale||[1,1,1]);}var i=new A(16);m.invert(i,w);var a=new A(16);var b=[];j.forEach(function(c){if(!c.node||!c.parent){return;}if(c.parent===n){m.multiply(a,i,c.node.matrixWorld.elements);}else if(c.node===n){m.invert(a,c.parent.matrixWorld.elements);m.multiply(a,a,w);}else{return;}m.getTranslation(c.translation,a);m.getScaling(c.scale,a);m.scale(a,a,[1/c.scale[0],1/c.scale[1],1/c.scale[2]]);m.getRotation(c.quaternion,a);b.push(c);});return b;}};return J;});
sap.ui.predefine('sap/ui/vk/LayerProxy',["sap/ui/base/Object"],function(B){"use strict";
var L=B.extend("sap.ui.vk.LayerProxy",{metadata:{"abstract":true}});
return L;});
sap.ui.predefine('sap/ui/vk/LeaderLineMarkStyle',[],function(){"use strict";var L={None:"None",Point:"Point",Arrow:"Arrow"};return L;},true);
sap.ui.predefine('sap/ui/vk/Loco',["sap/ui/base/EventProvider"],function(E){"use strict";
var L=E.extend("sap.ui.vk.Loco",{
metadata:{publicMethods:["addHandler","removeHandler"]},
constructor:function(v){if(L._instance&&this.viewport===v){return L._instance;}E.apply(this);this._handlers=[];this._gesture=false;this._n=0;this._touchStart=0;this._touchOrigin={x:0,y:0};this._touchMoved=false;this._clickTimer=0;if(v){this.attachViewportEventHandlers(v);}L._instance=this;}
});
L.prototype.destroy=function(){};
function e(a){var p=[];var b={points:p,buttons:a.buttons||0,handled:false,event:a,timeStamp:a.timeStamp,scroll:a.wheelDelta};if(a.touches&&a.touches.length>0){for(var i=0;i<a.touches.length;i++){var t=a.touches[i];p.push({x:t.pageX,y:t.pageY});}}else if(a.pageX!==undefined){p.push({x:a.pageX,y:a.pageY});}else{p.push({x:a.originalEvent.pageX,y:a.originalEvent.pageY});}if((a.buttons&2)&&p.length===1){p.push(p[0]);}b.n=p.length;if(b.n===2){var d=p[0].x-p[1].x,c=p[0].y-p[1].y;b.x=(p[0].x+p[1].x)*0.5;b.y=(p[0].y+p[1].y)*0.5;b.d=Math.sqrt(d*d+c*c);}else{b.x=p[0].x;b.y=p[0].y;b.d=0;}return b;}
L.prototype.attachViewportEventHandlers=function(v){this.viewport=v;v.ontouchstart=function(a){if(!a.isMarked()){var i=e(a);if(this._gesture){this._endGesture(i);i.handled=false;}this._beginGesture(i);}}.bind(this);v.ontouchend=function(a){var i=e(a);this._endGesture(i);if(a.touches.length>0){i.handled=false;this._beginGesture(i);}}.bind(this);if(sap.ui.Device.support.touch){v.attachBrowserEvent("touchmove",function(a){this._move(e(a));}.bind(this));}v.attachBrowserEvent("mousemove",function(a){this._move(e(a));}.bind(this));v.ontap=function(a){if(!a.isMarked()&&!this._touchMoved){if(this._clickTimer>0){clearTimeout(this._clickTimer);this._click(e(a),true);}else{this._clickTimer=setTimeout(function(l){l._click(e(a),false);},250,this);}}}.bind(this);v.attachBrowserEvent(sap.ui.Device.browser.firefox?"DOMMouseScroll":"mousewheel",function(a){if(!a.isMarked()){var o=a.originalEvent;var i={x:o.pageX,y:o.pageY,d:0,buttons:a.buttons,scroll:o.detail?o.detail*(-40):o.wheelDelta,n:2,points:[{x:o.pageX,y:o.pageY},{x:o.pageX,y:o.pageY}],handled:false};this._beginGesture(i);i.points[0].y-=i.scroll*0.2;i.points[1].y+=i.scroll*0.2;i.d=Math.abs(i.scroll)*0.4;i.handled=false;this._move(i);i.handled=false;this._endGesture(i);if(i.handled){a.setMarked();a.preventDefault();}}},this);v.oncontextmenu=function(a){var i=e(a);this._contextMenu(i);}.bind(this);v.attachBrowserEvent("keyup",function(a){this._keyEventHandler(a);},this);};
L.prototype.addHandler=function(h,p){if(!this.viewport){this.attachViewportEventHandlers(h.getViewport());}h.priority=p|0;if(this._handlers.indexOf(h)===-1){this._handlers.push(h);}this._handlers.sort(function(a,b){return a.priority-b.priority;});};
L.prototype.removeHandler=function(h){var i=this._handlers.indexOf(h);if(i>=0){this._handlers.splice(i,1);}};
L.prototype._handleInput=function(h,a){for(var i=this._handlers.length-1;i>=0&&!a.handled;i--){if(this._handlers[i][h]){this._handlers[i][h](a);}}if(a.handled&&a.event){a.event.preventDefault();}};
L.prototype._beginGesture=function(i){this._handleInput("beginGesture",i);this._touchStart=i.timeStamp;this._touchMoved=false;this._gesture=true;this._touchOrigin.x=i.x;this._touchOrigin.y=i.y;this._n=i.n;};
L.prototype._move=function(i){if(this._gesture&&this._n===i.n){if(!this._touchMoved){this._touchMoved=(i.timeStamp-this._touchStart>200)&&(Math.abs(this._touchOrigin.x-i.x)>3||Math.abs(this._touchOrigin.y-i.y)>3);}this._handleInput("move",i);}else{this._handleInput("hover",i);}};
L.prototype._endGesture=function(i){if(!this._gesture){return;}this._handleInput("endGesture",i);this._gesture=false;};
L.prototype._click=function(i,a){this._clickTimer=0;this._handleInput(a?"doubleClick":"click",i);};
L.prototype._contextMenu=function(i){this._handleInput("contextMenu",i);};
L.prototype._keyEventHandler=function(a){this._handleInput("keyEventHandler",a);};
return L;});
sap.ui.predefine('sap/ui/vk/MapContainerButtonType',[],function(){"use strict";var M={Click:"Click",Toggle:"Toggle"};return M;},true);
sap.ui.predefine('sap/ui/vk/Material',["sap/ui/base/ManagedObject"],function(M){"use strict";
var a=M.extend("sap.ui.vk.Material",{metadata:{properties:{"id":{type:"string"},"name":{type:"string"},"ambientColour":{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},"diffuseColour":{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},"specularColour":{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},"emissiveColour":{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},"opacity":{type:"float",defaultValue:1.0},"glossiness":{type:"float",defaultValue:0.0},"lineColour":{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},"lineWidth":{type:"float",defaultValue:0.0},"textureDiffuse":{type:"sap.ui.vk.Texture",defaultValue:null},"textureBump":{type:"sap.ui.vk.Texture",defaultValue:null},"textureOpacity":{type:"sap.ui.vk.Texture",defaultValue:null},"textureReflection":{type:"sap.ui.vk.Texture",defaultValue:null},"textureEmissive":{type:"sap.ui.vk.Texture",defaultValue:null},"textureAmbientOcclusion":{type:"sap.ui.vk.Texture",defaultValue:null}}}});
a.prototype.getMaterialRef=function(){return null;};
return a;});
sap.ui.predefine('sap/ui/vk/Messages',[],function(){"use strict";var M={VIT1:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CHECKEXISTS_RESOLUTION",code:"VIT1"},VIT2:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CHECKEXISTS_RESOLUTION",code:"VIT2"},VIT3:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CHECKFILEFORMAT_RESOLUTION",code:"VIT3"},VIT4:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CHECKFILEFORMAT_RESOLUTION",code:"VIT4"},VIT5:{summary:"DOWNLOADMANAGER_MSG_NOTBELOADED_SUMMARY",cause:"DOWNLOADMANAGER_MSG_NOTBELOADED_VALUESOURCEUNSUPPORTED_CAUSE",resolution:"DOWNLOADMANAGER_MSG_NOTBELOADED_VALUESOURCEUNSUPPORTED_CHECKSOURCEISURLORFILE_RESOLUTION",code:"VIT5"},VIT6:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INVALIDQUERY_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INVALIDQUERY_SPECIFYVALUEPROPERTY_RESOLUTION",code:"VIT6"},VIT7:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_PREDICATENOTSPECIFIED_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_PREDICATENOTSPECIFIED_SPECIFYPREDICATE_RESOLUTION",code:"VIT7"},VIT8:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_INVALIDPREDICATE_RESOLUTION",code:"VIT8"},VIT9:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_INVALIDPREDICATE_RESOLUTION",code:"VIT9"},VIT10:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_NOMETADATASPECIFIED_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_NOMETADATASPECIFIED_SPECIFYMETADATACATEGORY_RESOLUTION",code:"VIT10"},VIT11:{summary:"OVERLAY_MSG_EVENTHANDLERFAILED_SUMMARY",cause:"OVERLAY_MSG_EVENTHANDLERFAILED_UNSUPPORTEDEVENTTYPE_CAUSE",resolution:"OVERLAY_MSG_EVENTHANDLERFAILED_UNSUPPORTEDEVENTTYPE_CHECKEVENTTYPE_RESOLUTION",code:"VIT11"},VIT12:{summary:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_SUMMARY",cause:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_INCORRECTSTEPEVENTTYPE_CAUSE",resolution:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_INCORRECTSTEPEVENTTYPE_CHECKSTEPEVENTTYPEVALUE_RESOLUTION",code:"VIT12"},VIT13:{summary:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_SUMMARY",cause:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_NONEXISTINGORUNSUPPORTEDFILE_CAUSE",resolution:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_NONEXISTINGORUNSUPPORTEDFILE_CHECKFILEEXISTSANDIFSUPPORT_RESOLUTION",code:"VIT13"},VIT14:{summary:"VIEWER_MSG_FAILEDTOBUILDSCENE_SUMMARY",cause:"VIEWER_MSG_FAILEDTOBUILDSCENE_COULDNOTCREATESCENE_CAUSE",resolution:"VIEWER_MSG_FAILEDTOBUILDSCENE_COULDNOTCREATESCENE_RELOADORSELECTANOTHERFILE_RESOLUTION",code:"VIT14"},VIT15:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_LOADINGMULTIPLE2DNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_LOADINGMULTIPLE2DNOTSUPPORTED_LOADONE2D_RESOLUTION",code:"VIT15"},VIT16:{summary:"VIEWER_MSG_NOTBELOADED_SUMMARY",cause:"VIEWER_MSG_NOTBELOADED_NONATIVESUPPORT_CAUSE",resolution:"VIEWER_MSG_NOTBELOADED_NONATIVESUPPORT_CHECKFILEFORMATSUPPORT_RESOLUTION",code:"VIT16"},VIT17:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOF2D3DNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOF2D3DNOTSUPPORTED_MULTIPLESUPPORTFOR3DONLY_RESOLUTION",code:"VIT17"},VIT18:{summary:"VIEWPORT_MSG_ERRORLOADINGVIEWPORT_SUMMARY",cause:"VIEWPORT_MSG_ERRORLOADINGVIEWPORT_CREATINGMULTIPLEVIEWPORTINSTANCES_CAUSE",resolution:"VIEWPORT_MSG_ERRORLOADINGVIEWPORT_CREATINGMULTIPLEVIEWPORTINSTANCES_ONEINSTANCEOFVIEWPORTSUPPORTED_RESOLUTION",code:"VIT18"},VIT19:{summary:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SUMMARY",cause:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SPECIFIEDCAMERAPROJECTIONNOTSUPPORTED_CAUSE",resolution:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SPECIFIEDCAMERAPROJECTIONNOTSUPPORTED_CHECKPROJECTIONTYPESUPPORTED_RESOLUTION",code:"VIT19"},VIT20:{summary:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_SUMMARY",cause:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_CAUSE",resolution:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_RESOLUTION",code:"VIT20"},VIT21:{summary:"VIEWER_MSG_FAILEDTOBUILDSCENE_SUMMARY",cause:"VIEWER_MSG_FAILEDTOBUILDSCENE_MISSINGPASSWORD_CAUSE",resolution:"VIEWER_MSG_FAILEDTOBUILDSCENE_MISSINGPASSWORD_PROVIDEPASSWORD_RESOLUTION",code:"VIT21"},VIT22:{summary:"GRAPHICSCORE_MSG_VDSL_NOFILEPROPERTY_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_EMPTY_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_RESOLUTION",code:"VIT22"},VIT23:{summary:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_WRONGFORMAT_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_RESOLUTION",code:"VIT23"},VIT24:{summary:"GRAPHICSCORE_MSG_VDSL_RELATIVE_IN_LOCAL_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_WRONGFORMAT_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_RELATIVE_IN_LOCAL_RESOLUTION",code:"VIT24"},VIT25:{summary:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_SUMMARY",cause:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_CAUSE",resolution:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_RESOLUTION",code:"VIT25"},VIT26:{summary:"VIEWPORT_UNSUPPORTED_STEP_INDEX_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_STEP_INDEX_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_STEP_INDEX_RESOLUTION",code:"VIT26"},VIT27:{summary:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_RESOLUTION",code:"VIT27"},VIT28:{summary:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_RESOLUTION",code:"VIT28"},VIT29:{summary:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_SUMMARY",cause:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_CAUSE",resolution:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_RESOLUTION",code:"VIT29"},VIT30:{summary:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_SUMMARY",cause:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_CAUSE",resolution:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_RESOLUTION",code:"VIT30"},VIT31:{summary:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_RESOLUTION",code:"VIT31"},VIT32:{summary:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_RESOLUTION",code:"VIT32"},VIT33:{summary:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_SUMMARY",cause:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_CAUSE",resolution:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_RESOLUTION",code:"VIT33"},VIT34:{summary:"VIEWER_SOURCE_FAILED_TO_LOAD_SUMMARY",cause:"VIEWER_SOURCE_FAILED_TO_LOAD_CAUSE",resolution:"VIEWER_SOURCE_FAILED_TO_LOAD_RESOLUTION",code:"VIT34"},VIT35:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOFDIFFRENTCONTENTMANAGERSNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOFDIFFRENTCONTENTMANAGERSNOTSUPPORTED_MULTIPLESUPPORTFORSAMECONTENTMANAGER_RESOLUTION",code:"VIT35"},VIT36:{summary:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_SUMMARY",cause:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_CAUSE",resolution:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_RESOLUTION",code:"VIT36"},VIT37:{summary:"VIEWER_MSG_FAILEDTOLOADCONTENT_SUMMARY",cause:"VIEWER_MSG_FAILEDTOLOADCONTENT_URLORAUTHENTICATION_CAUSE",resolution:"VIEWER_MSG_FAILEDTOLOADCONTENT_URLORAUTHENTICATION_RESOLUTION",code:"VIT37"}};return M;},true);
sap.ui.predefine('sap/ui/vk/NativeViewportRenderer',[],function(){"use strict";var N={};
N.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitNativeViewport");r.writeClasses();r.writeAttribute("tabindex",0);r.write(">");r.write("</div>");};
return N;},true);
sap.ui.predefine('sap/ui/vk/NodeContentType',[],function(){"use strict";var N={Regular:"Regular",Reference:"Reference",Annotation:"Annotation",Background:"Background",Symbol:"Symbol",Hotspot:"Hotspot"};return N;},true);
sap.ui.predefine('sap/ui/vk/NodeHierarchy',["sap/ui/base/ManagedObject","./Messages","./getResourceBundle","sap/base/util/array/uniqueSort","sap/base/Log"],function(M,a,g,u,L){"use strict";
var N=M.extend("sap.ui.vk.NodeHierarchy",{metadata:{"abstract":true,events:{changed:{},nodeCreated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeRemoving:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeReplaced:{parameters:{ReplacedNodeRef:{type:"any"},ReplacementNodeRef:{type:"any"},ReplacedNodeId:{type:"string"},ReplacementNodeId:{type:"string"}}},nodeUpdated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}}}}});
N.prototype.findNodesById=function(q){if(q.fields.some(function(e){return!e.caseSensitive;})){q=jQuery.extend(true,{},q);q.fields.forEach(function(e){if(!e.caseSensitive){e.value=e.value.toLowerCase();}});}var c=function(p,e,v,h){var m;p=p||"equals";h=h||"";var j=e?v:v.toLowerCase();switch(p){case"equals":m=(j===h);break;case"contains":m=(j.indexOf(h)!==-1);break;case"startsWith":m=(j.indexOf(h)===0);break;default:m=false;L.error(g().getText(a.VIT8.summary),a.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy");}return m;};var i=function(l,e){return!l.some(function(v){return e.name===v.name?c(e.predicate,e.caseSensitive,v.value,e.value):false;});};var f=function(q,v){return q.source===v.source&&q.type===v.type&&!q.fields.some(i.bind(undefined,v.fields));};var b=this.findNodesByName();var d=b.filter(function(n){var e=this.createNodeProxy(n);var v=e.getVeIds();this.destroyNodeProxy(e);return v.some(f.bind(undefined,q));}.bind(this));return d;};
N.prototype.findNodesByMetadata=function(q){var c=function(m,j,k,v,h,i){if(m&&m.hasOwnProperty(j)){var l=m[j];if(l.hasOwnProperty(k)){var n=l[k];if(!i){n=n.toLowerCase();}return v.some(h.bind(undefined,n));}}return false;};var b=function(m,j){return m&&m.hasOwnProperty(j);};var d=function(e,f,j,k,v,h,i){var n=this._baseNodeProxyPool.borrowObject();var r=e.filter(function(l){n.init(this,l);var m=n.getNodeMetadata();var o=f(m,j,k,v,h,i);n.reset();return o;}.bind(this));this._baseNodeProxyPool.returnObject(n);return r;};var e=this.findNodesByName(),r=[];if(q===undefined||q===null||jQuery.isEmptyObject(q)){r=e;}else if(q.category!==null&&q.category!==undefined&&q.category!==""){var f,v,p,h,i=!!(q&&q.caseSensitive);if(q.key===undefined||q.key===null){f=b;}else{v=q.value;p=q.predicate||"equals";if(v===undefined||v===null){v="";p="contains";}if(!Array.isArray(v)){v=[v];}if(!i){v=v.map(function(j){return j.toLowerCase();});}switch(p){case"equals":h=function(m,j){return m===j;};break;case"contains":h=function(m,j){return m.indexOf(j)!==-1;};break;case"startsWith":h=function(m,j){return m.indexOf(j)===0;};break;default:L.error(g().getText(a.VIT9.summary),a.VIT9.code,"sap.ui.vk.dvl.NodeHierarchy");}f=c;}r=d.bind(this)(e,f,q.category,q.key,v,h,i);}else{L.error(g().getText(a.VIT10.summary),a.VIT10.code,"sap.ui.vk.dvl.NodeHierarchy");}return u(r);};
N.prototype._appendAncestors=function(n,s){s=s?new Set(s):null;var b=new Set(n);n.forEach(function(d){var e=this.getAncestors(d);e.forEach(function(f){if(s===null||!s.has(f)){b.add(f);}});},this);var c=[];b.forEach(function(d){c.push(d);});return c;};
return N;});
sap.ui.predefine('sap/ui/vk/NodeProxy',["sap/ui/base/ManagedObject"],function(M){"use strict";
var N=M.extend("sap.ui.vk.NodeProxy",{metadata:{properties:{nodeRef:"any",veIds:"object[]",name:"string",localMatrix:{type:"sap.ui.vk.TransformationMatrix",bindable:"bindable"},worldMatrix:{type:"sap.ui.vk.TransformationMatrix",bindable:"bindable"},material:{type:"sap.ui.vk.Material"},opacity:{type:"float",bindable:"bindable"},tintColorABGR:{type:"int",bindable:"bindable"},tintColor:{type:"sap.ui.core.CSSColor",bindable:"bindable"},nodeMetadata:"object",hasChildren:"boolean",closed:"boolean"}}});
N.prototype.setClosed=function(v){return this;};
N.prototype.setHasChildren=function(v){return this;};
N.prototype.setName=function(v){return this;};
N.prototype.setNodeId=function(v){return this;};
N.prototype.setNodeMetadata=function(v){return this;};
N.prototype.setVeIds=function(v){return this;};
N.prototype.assignMaterial=function(v){return this;};
N.prototype.getLocalTranslate=function(){return[0,0,0];};
N.prototype.getLocalScale=function(){return[1,1,1];};
N.prototype.getLocalRotationInQuaternion=function(){return[1,0,0,1];};
N.prototype.getLocalRotationInAngleAxis=function(){return[1,0,0,0];};
N.prototype.getLocalRotationInEuler=function(){return[0,0,0,0];};
return N;});
sap.ui.predefine('sap/ui/vk/NodeUtils',["./glMatrix"],function(g){"use strict";var N={centerOfNodes:function(n,v){function u(c,t){var d=c.min.x;var e=c.min.y;var f=c.min.z;var h=c.max.x;var i=c.max.y;var j=c.max.z;var p=[];p.push(g.vec3.fromValues(d,e,f));p.push(g.vec3.fromValues(d,e,j));p.push(g.vec3.fromValues(d,i,f));p.push(g.vec3.fromValues(d,i,j));p.push(g.vec3.fromValues(h,e,f));p.push(g.vec3.fromValues(h,e,j));p.push(g.vec3.fromValues(h,i,f));p.push(g.vec3.fromValues(h,i,j));var k=Number.MAX_SAFE_INTEGER;var l=Number.MAX_SAFE_INTEGER;var o=Number.MAX_SAFE_INTEGER;var q=-Number.MAX_SAFE_INTEGER;var r=-Number.MAX_SAFE_INTEGER;var s=-Number.MAX_SAFE_INTEGER;var w=g.vec3.create();p.forEach(function(x){g.vec3.transformMat4(w,x,t);if(w[0]<k){k=w[0];}if(w[1]<l){l=w[1];}if(w[2]<o){o=w[2];}if(w[0]>q){q=w[0];}if(w[1]>r){r=w[1];}if(w[2]>s){s=w[2];}});return[k,l,o,q,r,s];}var m={x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY,z:Number.NEGATIVE_INFINITY};var a={x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,z:Number.POSITIVE_INFINITY};var b=false;n.forEach(function(c){c.traverse(function(d){var e=d.userData.boundingBox;if(!e&&d.geometry){e=d.geometry.boundingBox;}if(e){var f=u(e,d.matrixWorld.elements);a.x=Math.min(a.x,f[0]);a.y=Math.min(a.y,f[1]);a.z=Math.min(a.z,f[2]);m.x=Math.max(m.x,f[3]);m.y=Math.max(m.y,f[4]);m.z=Math.max(m.z,f[5]);b=true;}});});if(!b){return[0,0,0];}return[Math.abs(m.x-a.x)/2+a.x,Math.abs(m.y-a.y)/2+a.y,Math.abs(m.z-a.z)/2+a.z];}};return N;});
sap.ui.predefine('sap/ui/vk/NotificationsRenderer',[],function(){"use strict";var N={};
N.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitNotifications");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("_messagePopoverToggleButton"));r.write("</div>");};
return N;},true);
sap.ui.predefine('sap/ui/vk/ObjectType',[],function(){"use strict";var O={PMI:0,Hotspot:1};return O;},true);
sap.ui.predefine('sap/ui/vk/OrthographicCamera',["./Camera"],function(C){"use strict";
var O=C.extend("sap.ui.vk.OrthographicCamera",{metadata:{properties:{"zoomFactor":{type:"float"}}}});
return O;});
sap.ui.predefine('sap/ui/vk/PerspectiveCamera',["./Camera"],function(C){"use strict";
var P=C.extend("sap.ui.vk.PerspectiveCamera",{metadata:{properties:{"fov":{type:"float"}}}});
return P;});
sap.ui.predefine('sap/ui/vk/ProgressIndicator',["sap/m/ProgressIndicator","./ProgressIndicatorRenderer","sap/base/Log"],function(M,P,L){"use strict";
var a=M.extend("sap.ui.vk.ProgressIndicator");
a.prototype.setPercentValue=function(p){var i=function i(v){return(typeof(v)==="number")&&!isNaN(v)&&v>=0&&v<=100;};var t=this,$,f,b=this.$(),A,u=false;if(!i(p)){p=0;L.warning(this+": percentValue ("+p+") is not correct! Setting the default percentValue:0.");}if(this.getPercentValue()!==p){f=this.getPercentValue()-p;this.setProperty("percentValue",p,true);if(!b.length){return this;}["sapMPIValueMax","sapMPIValueMin","sapMPIValueNormal","sapMPIValueGreaterHalf"].forEach(function(c){b.removeClass(c);});b.addClass(this._getCSSClassByPercentValue(p));b.addClass("sapMPIAnimate").attr("aria-valuenow",p).attr("aria-valuetext",this._getAriaValueText({fPercent:p}));A=u?Math.abs(f)*20:0;$=this.$("bar");$.animate({"flex-basis":p+"%"},A,"linear",function(){t._setText.apply(t);t.$().removeClass("sapMPIAnimate");});}return this;};
return a;});
sap.ui.predefine('sap/ui/vk/ProgressIndicatorRenderer',["sap/m/ProgressIndicatorRenderer"],function(P){"use strict";return P;},true);
sap.ui.predefine('sap/ui/vk/Redline',[],function(){"use strict";var R={ElementType:{Line:"line",Rectangle:"rectangle",Ellipse:"ellipse",Freehand:"freehand",Text:"text"},svgNamespace:"http://www.w3.org/2000/svg"};return R;},true);
sap.ui.predefine('sap/ui/vk/RedlineDesign',["sap/ui/core/Control","./RedlineSurface","./RedlineElement","./RedlineGesturesHandler","./RedlineDesignHandler","./Loco","./RedlineDesignRenderer"],function(C,R,a,b,c,L,d){"use strict";
var e=R.extend("sap.ui.vk.RedlineDesign",{metadata:{library:"sap.ui.vk",events:{elementCreated:{parameters:{element:"object"}}},aggregations:{activeElementInstance:{type:"sap.ui.vk.RedlineElement",multiple:false,visibility:"hidden"}}}});
e.prototype.init=function(){this._isAddingModeActive=false;this._isDrawingOn=false;this._activeElementInstance=null;this.addStyleClass("sapUiVizkitRedlineInteractionMode");this._gestureHandler=new b(this);this._designHandler=new c(this);this._loco=new L(this);};
e.prototype.onBeforeRendering=function(){if(this._loco){this._loco.removeHandler(this._gestureHandler);this._loco.removeHandler(this._designHandler);}};
e.prototype.onAfterRendering=function(){var f=this.getDomRef();f.style.width="100%";f.style.height="100%";if(this._isAddingModeActive){this._loco.addHandler(this._designHandler);}else{this._loco.addHandler(this._gestureHandler);}this.updatePanningRatio();};
e.prototype.startAdding=function(f){this._isAddingModeActive=true;this._activeElementInstance=f;this.setAggregation("activeElementInstance",this._activeElementInstance);this.addStyleClass("sapUiVizkitRedlineDesignMode");this.removeStyleClass("sapUiVizkitRedlineInteractionMode");return this;};
e.prototype.stopAdding=function(){this._isAddingModeActive=false;this._isDrawingOn=false;this.setAggregation("activeElementInstance",null);this._activeElementInstance=null;this.addStyleClass("sapUiVizkitRedlineInteractionMode");this.removeStyleClass("sapUiVizkitRedlineDesignMode");return this;};
e.prototype._getOffset=function(o){var r=o.getBoundingClientRect();return{x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};};
e.prototype._getTargetViewport=function(){return this._targetViewport;};
e.prototype._setTargetViewport=function(v){this._targetViewport=v;this._targetViewport.attachEvent("resize",this,this._onresize,this);};
e.prototype._onresize=function(f){var v=f.oSource.getOutputSize();this.setProperty("virtualLeft",v.left,true);this.setProperty("virtualTop",v.top,true);this.setProperty("virtualSideLength",v.sideLength,true);this.invalidate();};
return e;});
sap.ui.predefine('sap/ui/vk/RedlineDesignHandler',["sap/ui/base/EventProvider","sap/ui/core/ResizeHandler"],function(E,R){"use strict";
var a=E.extend("sap.ui.vk.RedlineDesignHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(r){this._redlineDesign=r;this._x=0;this._y=0;this._gesture=false;}
});
a.prototype.destroy=function(){this._redlineDesign=null;this._rect=null;this._gesture=false;};
a.prototype._getOffset=function(d){var r=d.getBoundingClientRect();return{x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};};
a.prototype._inside=function(e,r){var b=r.getDomRef(),i=false;if(b!==null){var c=this._getOffset(b);var d={x:c.x,y:c.y,width:b.getBoundingClientRect().width,height:b.getBoundingClientRect().height};i=(e.x>=d.x&&e.x<=d.x+d.width&&e.y>=d.y&&e.y<=d.y+d.height);}return i;};
a.prototype._onresize=function(e){this._gesture=false;};
a.prototype.beginGesture=function(e){var v=this.getViewport();if(this._inside(e,v)&&v._activeElementInstance){this._gesture=true;this._x=e.x;this._y=e.y;v._isDrawingOn=true;var d=v.getDomRef();var t=v._toVirtualSpace(e.x-d.getBoundingClientRect().left-window.pageXOffset,e.y-d.getBoundingClientRect().top-window.pageYOffset);v._activeElementInstance.setOriginX(t.x);v._activeElementInstance.setOriginY(t.y);if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){v.invalidate();}else{var r=sap.ui.getCore().createRenderManager();v._activeElementInstance.render(r);r.flush(v.getDomRef(),false,true);r.destroy();var x=v.$();x.html(x.html());}e.handled=true;}return this;};
a.prototype.move=function(e){var v=this.getViewport();if(v._activeElementInstance&&v._isDrawingOn){var b=v.getDomRef().getBoundingClientRect(),o=e.x-b.left-window.pageXOffset,c=e.y-b.top-window.pageYOffset;v._activeElementInstance.edit(o,c);e.handled=true;}return this;};
a.prototype.endGesture=function(e){var v=this.getViewport();this._gesture=false;if(v._activeElementInstance){v.addRedlineElement(v._activeElementInstance);v.fireElementCreated({element:v._activeElementInstance});v.stopAdding();e.handled=true;}return this;};
a.prototype.contextMenu=function(e){e.handled=true;};
a.prototype.getViewport=function(){return this._redlineDesign;};
return a;});
sap.ui.predefine('sap/ui/vk/RedlineDesignRenderer',["./RedlineSurfaceRenderer","sap/ui/core/Renderer"],function(R,a){"use strict";var b=a.extend(R);
b.render=function(r,c){R.render.call(this,r,c);};
b.renderAfterRedlineElements=function(r,c){if(c._activeElementInstance&&c._isDrawingOn){c._activeElementInstance.render(r);}};
return b;},true);
sap.ui.predefine('sap/ui/vk/RedlineElement',["sap/ui/core/Element"],function(E){"use strict";
var R=E.extend("sap.ui.vk.RedlineElement",{metadata:{library:"sap.ui.vk",properties:{elementId:{type:"string"},originX:{type:"float",defaultValue:0},originY:{type:"float",defaultValue:0},opacity:{type:"float",defaultValue:1},strokeWidth:{type:"float",defaultValue:2},strokeColor:{type:"sap.ui.core.CSSColor",defaultValue:"#e6600d"},strokeDashArray:{type:"float[]",defaultValue:[]},halo:{type:"boolean",defaultValue:false}},events:{elementClicked:{parameters:{elementId:"string"}}}}});
R.prototype.init=function(){var g=function(){var s=function(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);};return s()+s()+"-"+s()+"-"+s()+"-"+s()+"-"+s()+s()+s();};this.setElementId(g());};
R.prototype.applyZoom=function(){};
R.prototype.render=function(r){this.renderElement(r,this.getHalo());};
R.prototype.renderElement=function(r,h){};
R.prototype.exportJSON=function(){var j={originX:this.getOriginX(),originY:this.getOriginY(),opacity:this.getOpacity(),strokeColor:this.getStrokeColor(),strokeWidth:this.getStrokeWidth(),elementId:this.getElementId(),halo:this.getHalo()};if(this.getStrokeDashArray().length>0){j["strokeDashArray"]=this.getStrokeDashArray();}return j;};
R.prototype.importJSON=function(j){if(j.hasOwnProperty("originX")){this.setOriginX(j.originX);}if(j.hasOwnProperty("originY")){this.setOriginY(j.originY);}if(j.hasOwnProperty("opacity")){this.setOpacity(j.opacity);}if(j.hasOwnProperty("strokeColor")){this.setStrokeColor(j.strokeColor);}if(j.hasOwnProperty("strokeWidth")){this.setStrokeWidth(j.strokeWidth);}if(j.hasOwnProperty("strokeDashArray")){this.setStrokeDashArray(j.strokeDashArray);}if(j.hasOwnProperty("elementId")){this.setElementId(j.elementId);}if(j.hasOwnProperty("halo")){this.setHalo(j.halo);}return this;};
R.prototype.exportSVG=function(){return null;};
R.prototype.importSVG=function(s){if(s.getAttribute("x")){this.setOriginX(parseFloat(s.getAttribute("x")));}if(s.getAttribute("y")){this.setOriginY(parseFloat(s.getAttribute("y")));}if(s.getAttribute("opacity")){this.setOpacity(parseFloat(s.getAttribute("opacity")));}if(s.getAttribute("stroke")){this.setStrokeColor(s.getAttribute("stroke"));}if(s.getAttribute("stroke-width")){this.setStrokeWidth(parseFloat(s.getAttribute("stroke-width")));}if(s.getAttribute("stroke-dasharray")){this.setStrokeDashArray(s.getAttribute("stroke-dasharray").split(",").map(parseFloat));}if(s.getAttribute("data-sap-element-id")){this.setElementId(s.getAttribute("data-sap-element-id"));}this.setHalo(s.getAttribute("data-sap-halo")==="true");return this;};
R.prototype.onclick=function(e){this.fireElementClicked({elementId:this.getElementId()});};
return R;});
sap.ui.predefine('sap/ui/vk/RedlineElementEllipse',["./RedlineElement","./Redline","sap/base/Log"],function(R,a,L){"use strict";
var b=R.extend("sap.ui.vk.RedlineElementEllipse",{metadata:{library:"sap.ui.vk",properties:{radiusX:{type:"float",defaultValue:0.0001},radiusY:{type:"float",defaultValue:0.0001},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 0)"}}}});
b.prototype.edit=function(o,c){var p=this.getParent(),t=p._toVirtualSpace(o,c),r=t.x-this.getOriginX(),d=t.y-this.getOriginY();this.setRadiusX(r>0?r:-r);this.setRadiusY(d>0?d:-d);return this;};
b.prototype.applyZoom=function(z){this.setProperty("radiusX",this.getRadiusX()*z,true);this.setProperty("radiusY",this.getRadiusY()*z,true);return this;};
b.prototype.setRadiusX=function(r){this.setProperty("radiusX",r,true);var d=this.getDomRef();if(d){d.setAttribute("rx",this.getParent()._toPixelSpace(r));}};
b.prototype.setRadiusY=function(r){this.setProperty("radiusY",r,true);var d=this.getDomRef();if(d){d.setAttribute("ry",this.getParent()._toPixelSpace(r));}};
b.prototype.renderElement=function(r,h){var p=this.getParent();r.write("<ellipse");r.writeElementData(this);var o=p._toPixelSpace(this.getOriginX(),this.getOriginY());r.writeAttribute("cx",o.x);r.writeAttribute("cy",o.y);r.writeAttribute("rx",p._toPixelSpace(this.getRadiusX()));r.writeAttribute("ry",p._toPixelSpace(this.getRadiusY()));r.writeAttribute("fill",this.getFillColor());r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){r.writeAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}r.writeAttribute("opacity",this.getOpacity());if(h){r.writeAttribute("filter","url(#halo)");}r.write("></ellipse>");};
b.prototype.exportJSON=function(){return jQuery.extend(true,R.prototype.exportJSON.call(this),{type:a.ElementType.Ellipse,version:1,radiusX:this.getRadiusX(),radiusY:this.getRadiusY(),fillColor:this.getFillColor()});};
b.prototype.importJSON=function(j){if(j.type===a.ElementType.Ellipse){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("radiusX")){this.setRadiusX(j.radiusX);}if(j.hasOwnProperty("radiusY")){this.setRadiusY(j.radiusY);}if(j.hasOwnProperty("fillColor")){this.setFillColor(j.fillColor);}}else{L.error("wrong version number");}}else{L.error("Redlining JSON import: Wrong element type");}return this;};
b.prototype.exportSVG=function(){var e=document.createElementNS(a.svgNamespace,"ellipse");e.setAttribute("x",this.getOriginX());e.setAttribute("y",this.getOriginY());e.setAttribute("rx",this.getRadiusX());e.setAttribute("ry",this.getRadiusY());e.setAttribute("fill",this.getFillColor());e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}e.setAttribute("data-sap-element-id",this.getElementId());e.setAttribute("data-sap-halo",this.getHalo());return e;};
b.prototype.importSVG=function(s){if(s.tagName==="ellipse"){R.prototype.importSVG.call(this,s);if(s.getAttribute("rx")){this.setRadiusX(parseFloat(s.getAttribute("rx")));}if(s.getAttribute("ry")){this.setRadiusY(parseFloat(s.getAttribute("ry")));}if(s.getAttribute("fill")){this.setFillColor(s.getAttribute("fill"));}}else{L("Redlining SVG import: Wrong element type");}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/RedlineElementFreehand',["./RedlineElement","./Redline","sap/base/Log"],function(R,a,L){"use strict";
var b=R.extend("sap.ui.vk.RedlineElementFreehand",{metadata:{library:"sap.ui.vk",properties:{path:{type:"float[]",defaultValue:null}}}});
b.prototype.setPath=function(p){this.setProperty("path",p,true);var d=this.getDomRef();if(d){d.setAttribute("d",this._getProcessedPath());}};
b.prototype.edit=function(o,c){var p=this.getParent();var t=p._toVirtualSpace(o,c);var d=this.getPath()||[];d.push(t.x-this.getOriginX(),t.y-this.getOriginY());this.setPath(d);var e=this.getDomRef();if(e){e.setAttribute("d",this._getProcessedPath());}return this;};
b.prototype.applyZoom=function(z){this.setProperty("path",this.getPath().map(function(v){return v*z;}),true);return this;};
b.prototype._getProcessedPath=function(){var p=this.getParent(),o=p._toPixelSpace(this.getOriginX(),this.getOriginY());var d="";(this.getPath()||[]).forEach(function(e,i){e=p._toPixelSpace(e);if(i===0){d+="M "+(o.x+e);}else if(i===1){d+=" "+(o.y+e);}else{d+=" "+(i%2===0?"L "+(o.x+e):(o.y+e));}});return d;};
b.prototype.renderElement=function(r,h){r.write("<path");r.writeElementData(this);r.writeAttribute("d",this._getProcessedPath());r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){r.writeAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}r.writeAttribute("opacity",this.getOpacity());r.writeAttribute("fill","none");if(h){r.writeAttribute("filter","url(#halo)");}r.write("></path>");};
b.prototype.exportJSON=function(){return jQuery.extend(true,R.prototype.exportJSON.call(this),{type:a.ElementType.Freehand,version:1,path:(this.getPath()||[]).slice()});};
b.prototype.importJSON=function(j){if(j.type===a.ElementType.Freehand){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("path")){this.setPath(j.path.slice());}}else{L.error("wrong version number");}}else{L.error("Redlining JSON import: Wrong element type");}return this;};
b.prototype.exportSVG=function(){var e=document.createElementNS(a.svgNamespace,"path");e.setAttribute("x",this.getOriginX());e.setAttribute("y",this.getOriginY());e.setAttribute("d",this.getPath());e.setAttribute("fill","none");e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}e.setAttribute("data-sap-element-id",this.getElementId());e.setAttribute("data-sap-halo",this.getHalo());return e;};
b.prototype.importSVG=function(s){if(s.tagName==="path"){R.prototype.importSVG.call(this,s);if(s.getAttribute("d")){this.setPath(s.getAttribute("d").split(",").map(parseFloat));}}else{L.error("Redlining SVG import: Wrong element type");}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/RedlineElementLine',["./RedlineElement","./Redline","sap/base/Log"],function(R,a,L){"use strict";
var b=R.extend("sap.ui.vk.RedlineElementLine",{metadata:{library:"sap.ui.vk",properties:{deltaX:{type:"float",defaultValue:0},deltaY:{type:"float",defaultValue:0}}}});
b.prototype.edit=function(o,c){var p=this.getParent(),t=p._toVirtualSpace(o,c);this.setDeltaX(t.x-this.getOriginX());this.setDeltaY(t.y-this.getOriginY());return this;};
b.prototype.applyZoom=function(z){this.setProperty("deltaX",this.getDeltaX()*z);this.setProperty("deltaY",this.getDeltaY()*z);return this;};
b.prototype.getP2=function(v){return this.getParent()._toPixelSpace(this.getOriginX()+this.getDeltaX(),this.getOriginY()+this.getDeltaY());};
b.prototype.setDeltaX=function(v){this.setProperty("deltaX",v);var d=this.getDomRef();if(d){d.setAttribute("x2",this.getP2().x);}};
b.prototype.setDeltaY=function(v){this.setProperty("deltaY",v);var d=this.getDomRef();if(d){d.setAttribute("y2",this.getP2().y);}};
b.prototype.renderElement=function(r,h){var p=this.getParent()._toPixelSpace(this.getOriginX(),this.getOriginY());var c=this.getP2();r.write("<line");r.writeElementData(this);r.writeAttribute("x1",p.x);r.writeAttribute("y1",p.y);r.writeAttribute("x2",c.x);r.writeAttribute("y2",c.y);r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){r.writeAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}r.writeAttribute("opacity",this.getOpacity());if(h){r.writeAttribute("filter","url(#halo)");}r.write("></line>");};
b.prototype.exportJSON=function(){return jQuery.extend(true,R.prototype.exportJSON.call(this),{type:a.ElementType.Line,version:1,deltaX:this.getDeltaX(),deltaY:this.getDeltaY()});};
b.prototype.importJSON=function(j){if(j.type===a.ElementType.Line){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("deltaX")){this.setDeltaX(j.deltaX);}if(j.hasOwnProperty("deltaY")){this.setDeltaY(j.deltaY);}}else{L.error("wrong version number");}}else{L.error("Redlining JSON import: Wrong element type");}return this;};
b.prototype.exportSVG=function(){var e=document.createElementNS(a.svgNamespace,"line");e.setAttribute("x1",this.getOriginX());e.setAttribute("y1",this.getOriginY());e.setAttribute("x2",this.getOriginX()+this.getDeltaX());e.setAttribute("y2",this.getOriginY()+this.getDeltaY());e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}e.setAttribute("data-sap-element-id",this.getElementId());e.setAttribute("data-sap-halo",this.getHalo());return e;};
b.prototype.importSVG=function(s){if(s.tagName==="line"){R.prototype.importSVG.call(this,s);if(s.getAttribute("x1")){this.setOriginX(parseFloat(s.getAttribute("x1")));}if(s.getAttribute("y1")){this.setOriginY(parseFloat(s.getAttribute("y1")));}if(s.getAttribute("x2")){this.setDeltaX(parseFloat(s.getAttribute("x2"))-this.getOriginX());}if(s.getAttribute("y2")){this.setDeltaY(parseFloat(s.getAttribute("y2"))-this.getOriginY());}}else{L("Redlining SVG import: Wrong element type");}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/RedlineElementRectangle',["./RedlineElement","./Redline","sap/base/Log"],function(R,a,L){"use strict";
var b=R.extend("sap.ui.vk.RedlineElementRectangle",{metadata:{library:"sap.ui.vk",properties:{width:{type:"float",defaultValue:0.001},height:{type:"float",defaultValue:0.001},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 0)"}}}});
b.prototype.init=function(){R.prototype.init.apply(this);this._originX=0;this._originY=0;};
b.prototype.setOriginX=function(o){this.setProperty("originX",o);this._originX=o;};
b.prototype.setOriginY=function(o){this.setProperty("originY",o);this._originY=o;};
b.prototype.edit=function(o,c){var p=this.getParent(),t=p._toVirtualSpace(o,c),w=t.x-this._originX,h=t.y-this._originY;this.setProperty("originX",w<0?t.x:this._originX);this.setProperty("originY",h<0?t.y:this._originY);this.setWidth(Math.abs(w));this.setHeight(Math.abs(h));this.rerender();return this;};
b.prototype.applyZoom=function(z){this.setProperty("width",this.getWidth()*z,true);this.setProperty("height",this.getHeight()*z,true);return this;};
b.prototype.setWidth=function(w){this.setProperty("width",w,true);var d=this.getDomRef();if(d){d.setAttribute("width",this.getParent()._toPixelSpace(w));}};
b.prototype.setHeight=function(h){this.setProperty("height",h,true);var d=this.getDomRef();if(d){d.setAttribute("height",this.getParent()._toPixelSpace(h));}};
b.prototype.renderElement=function(r,h){var p=this.getParent();r.write("<rect");r.writeElementData(this);var o=p._toPixelSpace(this.getOriginX(),this.getOriginY());r.writeAttribute("x",o.x);r.writeAttribute("y",o.y);r.writeAttribute("width",p._toPixelSpace(this.getWidth()));r.writeAttribute("height",p._toPixelSpace(this.getHeight()));r.writeAttribute("fill",this.getFillColor());r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){r.writeAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}r.writeAttribute("opacity",this.getOpacity());if(h){r.writeAttribute("filter","url(#halo)");}r.write("></rect>");};
b.prototype.exportJSON=function(){return jQuery.extend(true,R.prototype.exportJSON.call(this),{type:a.ElementType.Rectangle,version:1,width:this.getWidth(),height:this.getHeight(),fillColor:this.getFillColor()});};
b.prototype.importJSON=function(j){if(j.type===a.ElementType.Rectangle){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("width")){this.setWidth(j.width);}if(j.hasOwnProperty("height")){this.setHeight(j.height);}if(j.hasOwnProperty("fillColor")){this.setFillColor(j.fillColor);}}else{L("wrong version number");}}else{L("Redlining JSON import: Wrong element type");}return this;};
b.prototype.exportSVG=function(){var e=document.createElementNS(a.svgNamespace,"rect");e.setAttribute("x",this.getOriginX());e.setAttribute("y",this.getOriginY());e.setAttribute("height",this.getHeight());e.setAttribute("width",this.getWidth());e.setAttribute("fill",this.getFillColor());e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}e.setAttribute("data-sap-element-id",this.getElementId());e.setAttribute("data-sap-halo",this.getHalo());return e;};
b.prototype.importSVG=function(s){if(s.tagName==="rect"){R.prototype.importSVG.call(this,s);if(s.getAttribute("width")){this.setWidth(parseFloat(s.getAttribute("width")));}if(s.getAttribute("height")){this.setHeight(parseFloat(s.getAttribute("height")));}if(s.getAttribute("fill")){this.setFillColor(s.getAttribute("fill"));}}else{L("Redlining SVG import: Wrong element type");}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/RedlineElementText',["./RedlineElement","./Redline","sap/base/Log"],function(R,a,L){"use strict";
var b=R.extend("sap.ui.vk.RedlineElementText",{metadata:{library:"sap.ui.vk",properties:{text:{type:"string",defaultValue:"Text"},font:{type:"string",defaultValue:""},fontSize:{type:"float",defaultValue:32},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0,0,0,0)"}}}});
b.prototype.edit=function(p,c){var d=this.getParent(),e=d._toVirtualSpace(p,c);this.setOriginX(e.x);this.setOriginY(e.y);this.rerender();return this;};
b.prototype.applyZoom=function(z){this.setFontSize(this.getFontSize()*z);return this;};
b.prototype.renderElement=function(r,h){var p=this.getParent()._toPixelSpace(this.getOriginX(),this.getOriginY());r.write("<text");r.writeElementData(this);r.writeAttribute("x",p.x);r.writeAttribute("y",p.y);if(this.getFont()){r.writeAttribute("font-family",this.getFont());}r.writeAttribute("font-size",this.getFontSize());r.writeAttribute("fill",this.getFillColor());r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){r.writeAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}r.writeAttribute("opacity",this.getOpacity());if(h){r.writeAttribute("filter","url(#halo)");}r.write(">");r.write(this.getText());r.write("</text>");};
b.prototype.exportJSON=function(){return jQuery.extend(true,R.prototype.exportJSON.call(this),{type:a.ElementType.Text,version:1,text:this.getText(),font:this.getFont(),fontSize:this.getFontSize(),fillColor:this.getFillColor()});};
b.prototype.importJSON=function(j){if(j.type===a.ElementType.Text){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("text")){this.setText(j.text);}if(j.hasOwnProperty("font")){this.setFont(j.font);}if(j.hasOwnProperty("fontSize")){this.setFontSize(j.fontSize);}if(j.hasOwnProperty("fillColor")){this.setFillColor(j.fillColor);}}else{L.error("wrong version number");}}else{L.error("Redlining JSON import: Wrong element type");}return this;};
b.prototype.exportSVG=function(){var e=document.createElementNS(a.svgNamespace,"text");e.setAttribute("x",this.getOriginX());e.setAttribute("y",this.getOriginY());if(this.getFont()){e.setAttribute("font-family",this.getFont());}e.setAttribute("font-size",this.getFontSize());e.setAttribute("fill",this.getFillColor());e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}e.setAttribute("data-sap-element-id",this.getElementId());e.setAttribute("data-sap-halo",this.getHalo());e.textContent=this.getText();return e;};
b.prototype.importSVG=function(e){if(e.tagName==="text"){R.prototype.importSVG.call(this,e);if(e.getAttribute("x")){this.setOriginX(parseFloat(e.getAttribute("x")));}if(e.getAttribute("y")){this.setOriginY(parseFloat(e.getAttribute("y")));}if(e.getAttribute("text")){this.setText(e.getAttribute("text"));}if(e.getAttribute("font-family")){this.setFont(e.getAttribute("font-family"));}if(e.getAttribute("font-size")){this.setFontSize(parseFloat(e.getAttribute("font-size")));}if(e.getAttribute("fill")){this.setFillColor(e.getAttribute("fill"));}}else{L("Redlining SVG import: Wrong element type");}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/RedlineGesturesHandler',["sap/ui/base/EventProvider","sap/ui/core/ResizeHandler","./NativeViewport"],function(E,R,N){"use strict";
var a=E.extend("sap.ui.vk.RedlineGesturesHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(r){this._redlineDesign=r;this._x=0;this._y=0;this._d=0;this._zoomFactor=1;this._gesture=false;}
});
a.prototype.destroy=function(){this._redlineDesign=null;this._rect=null;this._gesture=false;};
a.prototype._getOffset=function(d){var r=d.getBoundingClientRect();return{x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};};
a.prototype._inside=function(e,r){var b=r.getDomRef(),i=false;if(b!==null){var c=this._getOffset(b);var d={x:c.x,y:c.y,width:b.getBoundingClientRect().width,height:b.getBoundingClientRect().height};i=(e.x>=d.x&&e.x<=d.x+d.width&&e.y>=d.y&&e.y<=d.y+d.height);}return i;};
a.prototype._onresize=function(e){this._gesture=false;};
a.prototype.beginGesture=function(e){var v=this.getViewport();if(this._inside(e,v)){this._gesture=true;this._x=e.x;this._y=e.y;this._d=e.d;this._initd=e.d;e.handled=true;}return this;};
a.prototype._pan=function(e){var v=this.getViewport(),d=e.x-this._x,b=e.y-this._y;if(d||b){this._x=e.x;this._y=e.y;var p=v.getPanningRatio();v.firePan({deltaX:d*p,deltaY:b*p});v.getRedlineElements().forEach(function(c){c.setOriginX(c.getOriginX()+v._toVirtualSpace(d));c.setOriginY(c.getOriginY()+v._toVirtualSpace(b));});this._manualRender(v);}};
a.prototype._zoom=function(e){var v=this.getViewport(),z=1;var d=e.d-this._d;this._d=e.d;if(this._initd>0){z=1+d*(1/this._initd);}else if(e.n===2){if(e.points[0].y>e.points[1].y){z=Math.max(1-d*0.005,0.333);}else{z=Math.min(1+d*0.005,3);}}z=Math.min(Math.max(z,0.88),1.12);var t=v._getTargetViewport();var b=32;var c=1/8;if(t instanceof N){b=t._getZoomInLimit();c=t._getZoomOutLimit();this._zoomFactor=t._getZoomFactor();}z=Math.min(Math.max(this._zoomFactor*z,c),b)/this._zoomFactor;this._zoomFactor*=z;var o=this._getOffset(v.getDomRef());var s=1-z,p=v._toVirtualSpace(e.x-o.x,e.y-o.y);v.getRedlineElements().forEach(function(f){f.applyZoom(z);var g=f.getOriginX(),h=f.getOriginY();g+=(p.x-g)*s;h+=(p.y-h)*s;f.setOriginX(g);f.setOriginY(h);});this._manualRender(v);v.fireZoom({originX:e.x-o.x,originY:e.y-o.y,zoomFactor:z});};
a.prototype.move=function(e){if(this.getViewport().getDomRef()){if(e.n===1||e.n===2){this._pan(e);}if(e.n===2&&!e.buttons){this._zoom(e);}}e.handled=true;return this;};
a.prototype._manualRender=function(r){if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){r.invalidate();}else{var b=sap.ui.getCore().createRenderManager();r.getRedlineElements().forEach(function(e){e.render(b);});b.flush(r.getDomRef(),false,false);b.destroy();var x=r.$();x.html(x.html());}};
a.prototype.endGesture=function(e){this._gesture=false;e.handled=true;return this;};
a.prototype.contextMenu=function(e){e.handled=true;};
a.prototype.getViewport=function(){return this._redlineDesign;};
return a;});
sap.ui.predefine('sap/ui/vk/RedlineSurface',["./library","sap/ui/core/Control","./Loco","./RedlineGesturesHandler","./RedlineSurfaceRenderer","./Redline","sap/base/Log"],function(v,C,L,R,a,b,c){"use strict";
var d=C.extend("sap.ui.vk.RedlineSurface",{metadata:{library:"sap.ui.vk",aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement"}},properties:{virtualLeft:{type:"float"},virtualTop:{type:"float"},virtualSideLength:{type:"float"},panningRatio:{type:"float",defaultValue:1}},events:{pan:{parameters:{deltaX:"float",deltaY:"float"}},zoom:{parameters:{originX:"float",originY:"float",zoomFactor:"float"}}}}});
d.prototype.init=function(){};
d.prototype.onAfterRendering=function(){};
d.prototype.exportJSON=function(){return this.getRedlineElements().map(function(e){return e.exportJSON();});};
d.prototype.importJSON=function(j){if(!jQuery.isArray(j)){j=[j];}j.forEach(function(e){var E;switch(e.type){case b.ElementType.Rectangle:E=sap.ui.vk.RedlineElementRectangle;break;case b.ElementType.Ellipse:E=sap.ui.vk.RedlineElementEllipse;break;case b.ElementType.Freehand:E=sap.ui.vk.RedlineElementFreehand;break;case b.ElementType.Line:E=sap.ui.vk.RedlineElementLine;break;case b.ElementType.Text:E=sap.ui.vk.RedlineElementText;break;default:c.warning("Unsupported JSON element type "+e.type);}if(E!=null){this.addRedlineElement(new E().importJSON(e));}}.bind(this));return this;};
d.prototype._toVirtualSpace=function(x,y){if(arguments.length===1){return x/this.getVirtualSideLength();}else{return{x:(x-this.getVirtualLeft())/this.getVirtualSideLength(),y:(y-this.getVirtualTop())/this.getVirtualSideLength()};}};
d.prototype._toPixelSpace=function(x,y){if(arguments.length===1){return x*this.getVirtualSideLength();}else{return{x:x*this.getVirtualSideLength()+this.getVirtualLeft(),y:y*this.getVirtualSideLength()+this.getVirtualTop()};}};
d.prototype.setPanningRatio=function(p){this.setProperty("panningRatio",p,true);};
d.prototype.updatePanningRatio=function(){var e=this.getVirtualLeft(),f=this.getVirtualTop(),r=this.getDomRef(),g=r.getBoundingClientRect(),h=g.height,w=g.width,p;if(e===0&&(h<w&&f<0||(h>w&&f>0))){p=h/w;}else{p=1;}this.setPanningRatio(p);return this;};
d.prototype.exportSVG=function(){var s=document.createElementNS(b.svgNamespace,"svg");this.getRedlineElements().map(function(e){s.appendChild(e.exportSVG());});return s;};
d.prototype.importSVG=function(s){s.childNodes.forEach(function(t){if(t.getAttribute){var E;switch(t.tagName){case"rect":E=sap.ui.vk.RedlineElementRectangle;break;case"ellipse":E=sap.ui.vk.RedlineElementEllipse;break;case"path":E=sap.ui.vk.RedlineElementFreehand;break;case"line":E=sap.ui.vk.RedlineElementLine;break;case"text":E=sap.ui.vk.RedlineElementText;break;default:c.warning("Unsupported SVG element type "+E);}if(E){this.addRedlineElement(new E().importSVG(t));}}}.bind(this));return this;};
return d;});
sap.ui.predefine('sap/ui/vk/RedlineSurfaceRenderer',[],function(){"use strict";var R={};
R.render=function(r,c){r.write("<svg");r.writeControlData(c);r.addClass("sapUiVizkitRedlineSurface");r.writeClasses();r.write(">");r.write("			<defs>				<filter id='halo' filterUnits='userSpaceOnUse' >					<feGaussianBlur in='SourceAlpha' stdDeviation='4' result='blur' />					<feMerge>						<feMergeNode in='blur' />						<feMergeNode in='SourceGraphic' />					</feMerge>				</filter>			</defs>		");c.getRedlineElements().forEach(function(a){a.render(r);});this.renderAfterRedlineElements(r,c);r.write("</svg>");};
R.renderAfterRedlineElements=function(r,c){};
return R;},true);
sap.ui.predefine('sap/ui/vk/RenderMode',[],function(){"use strict";var R={Default:"Default",XRay:"XRay",LineIllustration:"LineIllustration",ShadedIllustration:"ShadedIllustration",SolidOutline:"SolidOutline"};return R;},true);
sap.ui.predefine('sap/ui/vk/RotationType',[],function(){"use strict";var R={Quaternion:"Quaternion",AngleAxis:"AngleAxis",Euler:"Euler"};return R;},true);
sap.ui.predefine('sap/ui/vk/SafeArea',["sap/ui/core/Control","sap/ui/vk/SafeAreaRenderer"],function(C,S){"use strict";
var a=C.extend("sap.ui.vk.SafeArea",{
metadata:{aggregations:{settingsControl:{type:"sap.ui.core.Control",multiple:false}}},
constructor:function(i,s){C.apply(this,arguments);}
});
a.prototype.onAfterRendering=function(){this.resize();};
a.prototype.resize=function(){var s=this.getDomRef();var v=this.getParent();if(!s||!v){return;}var b=v.getDomRef().getBoundingClientRect();var c=b.width/b.height;var d=c;var e=v.getCurrentView();if(e&&e.getAspectRatio()&&e.getAspectRatio()>0&&e.getAspectRatio()<25){d=e.getAspectRatio();}var h=b.height;var w=b.width;if(c>d){s.style.height=(h-4)+"px";s.style.width=(h*d-4)+"px";s.style.left=(w-(h*d-4))/2+"px";s.style.top="";}else if(c<d){s.style.height=(w/d-4)+"px";s.style.width=(w-4)+"px";s.style.top=(h-(w/d-4))/2+"px";s.style.left="";}else{s.style.height=(h-4)+"px";s.style.width=(w-4)+"px";}if(this.getSettingsControl()){var f=this.getSettingsControl().getDomRef();var g=window.getComputedStyle(document.getElementById(this.getSettingsControl().sId));var i=g.height;f.style.position="absolute";if(c<d&&((h-parseFloat(s.style.height))/2)>parseFloat(i)){f.style.bottom=(parseFloat(s.style.height)+2)+"px";f.style.left="-2px";f.style.top="";}else{f.style.top="0px";f.style.left="0px";f.style.bottom="";}}};
return a;});
sap.ui.predefine('sap/ui/vk/SafeAreaRenderer',[],function(){"use strict";var S={};
S.render=function(r,c){r.write("<div");r.writeControlData(c);var v=c.getParent();if(v){if(v.getShowSafeArea()){r.addClass("sapVizKitSafeAreaVisible");}else{r.addClass("sapVizKitSafeAreaNotVisible");}}r.writeClasses();r.write(">");if(c.getSettingsControl()){r.renderControl(c.getSettingsControl());}r.write("</div>");};
return S;},true);
sap.ui.predefine('sap/ui/vk/Scene',["sap/ui/base/ManagedObject","./AnimationSequence","./AnimationTrack","./ViewGroup","./View","./Highlight"],function(M,A,a,V,b,H){"use strict";
var S=M.extend("sap.ui.vk.Scene",{metadata:{"abstract":true,properties:{doubleSided:{type:"boolean",defaultValue:false}}}});
S.prototype.getInitialView=function(){return null;};
S.prototype.createSequence=function(i,p){var s=new A(i,p);this.addSequence(s);return s;};
S.prototype.getSequences=function(){if(!this._sequences){this._sequences=[];}return this._sequences;};
S.prototype.findSequence=function(s){if(!this._sequences){return undefined;}return this._sequences.find(function(c){return c.getId()===s;});};
S.prototype.addSequence=function(s){if(!this._sequences){this._sequences=[];}this._sequences.push(s);return this;};
S.prototype.insertSequence=function(s,i){if(!this._sequences){this._sequences=[];}if(i<0){i=0;}else if(i!==0&&i>=this._sequences.length){i=this._sequences.length;}this._sequences.splice(i,0,s);return this;};
S.prototype.indexOfSequence=function(s){if(!this._sequences){return-1;}return this._sequences.find(function(i){return i==s;});};
S.prototype.removeSequence=function(s){if(this._sequences){var i=this.indexOfSequence(s);if(i>=0){this._sequences.splice(i,1);}}return this;};
S.prototype.removeSequences=function(){if(this._sequences){this._sequences.splice(0);}return this;};
S.prototype.createTrack=function(i,p){var t=new a(i,p);this.addTrack(t);return t;};
S.prototype.getTracks=function(){if(!this._tracks){this._tracks=[];}return this._tracks;};
S.prototype.findTrack=function(t){if(!this._tracks){return undefined;}return this._tracks.find(function(c){return c.getId()===t;});};
S.prototype.addTrack=function(t){if(!this._tracks){this._tracks=[];}this._tracks.push(t);return this;};
S.prototype.insertTrack=function(t,i){if(!this._tracks){this._tracks=[];}if(i<0){i=0;}else if(i!==0&&i>=this._tracks.length){i=this._tracks.length;}this._tracks.splice(i,0,t);return this;};
S.prototype.indexOfTrack=function(t){if(!this._tracks){return-1;}return this._tracks.findIndex(function(i){return i==t;});};
S.prototype.removeTrack=function(t){if(this._tracks){var i=this.indexOfTrack(t);if(i>=0){this._tracks.splice(i,1);}}return this;};
S.prototype.removeTracks=function(){if(this._tracks){this._tracks.splice(0);}return this;};
S.prototype.getViewGroups=function(){if(!this._viewGroups){this._viewGroups=[];}return this._viewGroups;};
S.prototype.createViewGroup=function(p){if(!this._viewGroups){this._viewGroups=[];}var v=new V(p);this._viewGroups.push(v);return v;};
S.prototype.indexOfViewGroup=function(v){if(!this._viewGroups){return-1;}return this._viewGroups.find(function(i){return i==v;});};
S.prototype.insertViewGroup=function(v,i){if(!this._viewGroups){this._viewGroups=[];}if(i<0){i=0;}else if(i!==0&&i>=this._viewGroups.length){i=this._viewGroups.length;}this._viewGroups.splice(i,0,v);return this;};
S.prototype.removeViewGroup=function(v){var i=this.indexOfViewGroup(v);if(i>=0){this._viewGroups.splice(i,1);}return this;};
S.prototype.removeViewGroups=function(){this._viewGroups.splice(0);return this;};
S.prototype.findViewGroupByView=function(v){var r;if(this._viewGroups){for(var i=0;i<this._viewGroups.length;i++){if(this._viewGroups[i].indexOfView(v)>=0){r=this._viewGroups[i];break;}}}return r;};
S.prototype.getViews=function(){if(!this._views){this._views=[];}return this._views;};
S.prototype.createView=function(p){if(!this._views){this._views=[];}var v=new b(p);this._views.push(v);return v;};
S.prototype.removeView=function(v){if(!this._views){return this;}var c=this.getViewGroups();if(Array.isArray(c)){c.forEach(function(d){d.removeView(v);});}var i=this._views.indexOf(v);if(i>=0){this._views.splice(i,1);}return this;};
S.prototype.createHighlight=function(i,p){var h=new H(i,p);if(!this._highlights){this._highlights=new Map();}this._highlights.set(i,h);return h;};
S.prototype.getHighlight=function(i){var h;if(this._highlights){h=this._highlights.get(i);}return h;};
S.prototype.removeHighlight=function(i){if(this._highlights){this._highlights.delete(i);}return this;};
return S;});
sap.ui.predefine('sap/ui/vk/SceneTree',["./library","sap/ui/core/Control","sap/ui/table/TreeTable","sap/ui/table/Column","sap/ui/model/json/JSONModel","sap/ui/core/Core","sap/ui/core/ResizeHandler","sap/m/Title","sap/m/SearchField","sap/m/Toolbar","sap/m/ToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/Text","sap/ui/core/Icon","./Core","./ViewStateManager","./SceneTreeRenderer","./getResourceBundle"],function(v,C,T,a,J,c,R,b,S,d,e,f,g,I,h,V,j,k){"use strict";
var m=C.extend("sap.ui.vk.SceneTree",{
metadata:{library:"sap.ui.vk",properties:{title:{type:"string",defaultValue:k().getText("SCENETREE_TITLE")},showTitle:{type:"boolean",defaultValue:true},showSearchField:{type:"boolean",defaultValue:true}},aggregations:{treeTable:{type:"sap.ui.table.TreeTable",multiple:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false}},events:{contentChanged:{enableEventBubbling:true}}},
constructor:function(i,s){C.apply(this,arguments);h.observeAssociations(this);}
});
var n="sap-icon://show",o="sap-icon://hide";var t=k().getText("SCENETREE_VISIBILITYSTATEVISIBLE"),p=k().getText("SCENETREE_VISIBILITYSTATEHIDDEN");
m.prototype._createNodeForSceneTree=function(i,l,q){var r=q.getVisibilityState(l);return{name:i,id:l,visible:r};};
m.prototype.setScene=function(s,i){this.setViewStateManager(i);this._setScene(s);};
m.prototype._setScene=function(s){this._scene=s;this.refresh();};
m.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}var i=this;this._title=new b({width:"100%",textAlign:sap.ui.core.TextAlign.Center,text:this.getTitle()});this._searchField=new S({layoutData:new e({shrinkable:true,maxWidth:"400px"}),search:function(q){var r=q.getParameter("query"),s=i._scene.getDefaultNodeHierarchy(),u=i._viewStateManager;if(s&&u){var w=!r?[]:s.findNodesByName({value:r,predicate:"contains"});var x=new Set(w);var y=[];u.enumerateSelection(function(z){if(!x.has(z)){y.push(z);}});u.setSelectionState(y,false,false);u.setSelectionState(w,true,false);}}});this._toolbar=new d({content:[this._title,new f(),this._searchField]});var l=new I({src:n,tooltip:t,width:"2em",height:"1.3em",size:"1.2em",press:function(q){var r=this.getSrc()!==n;this.setSrc(r?n:o);this.setTooltip(r?t:p);i._toggleVisibilityForAllChildren(i._model.getData(),r);}});this._tree=new T({title:this._toolbar,columnHeaderHeight:32,columns:[new a({label:k().getText("SCENETREE_NAME"),tooltip:k().getText("SCENETREE_NAME"),template:new g({text:"{name}",maxLines:1,tooltip:"{name}"}),resizable:false}),new a(this.getId()+"-visibilityColumn",{label:l,template:new I({src:{path:"",formatter:function(q){if(!q){return null;}return q.visible?n:o;}},tooltip:{path:"",formatter:function(q){if(!q){return null;}return q.visible?t:p;}},height:"1.3em",size:"1.2em",press:function(q){var r=i._tree.getContextByIndex(this.getParent().getIndex());var s=r?r.getObject():null;if(s){i._viewStateManager.setVisibilityState(s.id,!s.visible,false);}}}),width:"2.5em",resizable:false,hAlign:"Center"})],enableSelectAll:false,selectionMode:"MultiToggle",selectionBehavior:"RowSelector",visibleRowCountMode:"Fixed",expandFirstLevel:false,collapseRecursive:false,rowHeight:32});this.setAggregation("treeTable",this._tree);this.attachContentChanged(function(q){l.setSrc(n);l.setTooltip(t);});this._scene=null;this._syncing=false;this._updateSelectionTimer=0;this._updateVisibilityTimer=0;this._model=new J();this._tree.setModel(this._model);this._tree.bindRows({path:"/"});this._tree.attachRowSelectionChange(this._handleRowSelectionChange.bind(this));this._tree.attachFirstVisibleRowChanged(this._updateSelection.bind(this));this._tree.getBinding("rows").attachChange(this._dataChange.bind(this));};
m.prototype.setTitle=function(i){this.setProperty("title",i,true);this._title.setText(i);return this;};
m.prototype.setShowTitle=function(i){this.setProperty("showTitle",i,true);this._title.setVisible(i);this._updateTitleBar();return this;};
m.prototype.setShowSearchField=function(i){this.setProperty("showSearchField",i,true);this._searchField.setVisible(i);this._updateTitleBar();return this;};
m.prototype._updateTitleBar=function(){this._tree.setTitle(this.getShowTitle()||this.getShowSearchField()?this._toolbar:null);this._handleResize();};
m.prototype.onBeforeRendering=function(){this._tree.setVisible(true);if(!this._resizeListenerId){this._resizeListenerId=R.register(this,this._handleResize.bind(this));}};
m.prototype._handleRowSelectionChange=function(l){if(this._syncing||this._tree.getBinding("rows")._aSelectedContexts!=undefined){return;}var s=[];var q=[];var r=l.getParameter("rowIndices");for(var i in r){var u=r[i];var w=this._tree.getContextByIndex(u);var x=w?w.getObject().id:null;if(x){(this._tree.isIndexSelected(u)?s:q).push(x);}}if(s.length>0){this._viewStateManager.setSelectionState(s,true);}if(q.length>0){this._viewStateManager.setSelectionState(q,false);}};
m.prototype._onSelectionChanged=function(q){if(this._syncing){return;}function r(u,w){var x=u.getBinding("rows");if(x){for(var i=u.getFirstVisibleRow(),l=Math.min(i+u.getVisibleRowCount(),x.getLength());i<l;i++){var y=x.getContextByIndex(i);if(y&&y.getObject().id===w){return true;}}}return false;}var s=q.getParameter("selected");if(s.length===1&&!r(this._tree,s[0])){if(this._updateSelectionTimer>0){clearTimeout(this._updateSelectionTimer);this._updateSelectionTimer=0;}this._expandToNode(s[0],this._updateSelection.bind(this));}else if(this._updateSelectionTimer===0){this._updateSelectionTimer=setTimeout(this._updateSelection.bind(this),0);}};
m.prototype._updateSelection=function(){this._updateSelectionTimer=0;if(this._syncing){return;}this._syncing=true;var q=this._viewStateManager,r=this._tree,s=r.getBinding("rows");if(q&&s){for(var i=r.getFirstVisibleRow(),l=Math.min(i+r.getVisibleRowCount(),s.getLength());i<l;i++){var u=s.getContextByIndex(i);if(u){var w=u.getObject().id;if(w){var x=q.getSelectionState(w);if(x!=r.isIndexSelected(i)){r[x?"addSelectionInterval":"removeSelectionInterval"](i,i);}}}}}this._syncing=false;};
m.prototype._expandToNode=function(i,l){var q={tree:this._tree,rows:this._tree.getBinding("rows"),index:0,nodeRef:i,ancestors:new Set(this._scene.getDefaultNodeHierarchy().getAncestors(i)),callback:l};function s(u,w,x){var y=u.getFirstVisibleRow(),z=u.getVisibleRowCount();if((w<y)||(w>=(y+z))){y=Math.min(Math.max(w-(z>>1),0),x-z);setTimeout(function(){u.setFirstVisibleRow(y);},0);}}function r(q,u){if(u&&u.getParameter("reason")!=="expand"){return;}var w=q.rows.getLength();while(q.index<w){var x=q.rows.getContextByIndex(q.index);if(!x){break;}var i=x.getObject().id;if(i===q.nodeRef){s(q.tree,q.index,w);break;}if(q.ancestors.has(i)&&!q.tree.isExpanded(q.index)){q.tree.expand(q.index++);return;}q.index++;}q.rows.detachChange(q.expandHandlerProxy);q.callback();}q.expandHandlerProxy=r.bind(this,q);q.rows.attachChange(q.expandHandlerProxy);r(q);};
m.prototype._dataChange=function(i){var r=i.getParameter("reason");if((r==="expand"||r==="collapse")&&this._updateSelectionTimer===0){this._updateSelectionTimer=setTimeout(this._updateSelection.bind(this),0);}};
m.prototype._toggleVisibilityForAllChildren=function(l,q){var r=l.hasOwnProperty("children")?l.children:l;for(var i=0;r[i]!=null;i++){this._viewStateManager.setVisibilityState(r[i].id,q,true);}};
m.prototype._onVisibilityChanged=function(i){if(this._updateVisibilityTimer===0){this._updateVisibilityTimer=setTimeout(this._updateVisibility.bind(this),0);}};
m.prototype._updateVisibility=function(){this._updateVisibilityTimer=0;this._getNodeVisibilityRecursive(this._model.getData());this._tree.getModel().refresh(true);};
m.prototype._getNodeVisibilityRecursive=function(l){if(l.id!=null){l.visible=this._viewStateManager.getVisibilityState(l.id);}var q=l.hasOwnProperty("children")?l.children:l;for(var i=0;q[i]!=null;i++){this._getNodeVisibilityRecursive(q[i]);}};
m.prototype._handleResize=function(i){var l=i?i.size.height:this.getDomRef().clientHeight;var q=this._tree.getTitle()?2.1:1.1;this._tree.setVisibleRowCount(Math.max(Math.floor(l/(this._tree.getRowHeight()+1)-q),0));this._updateSelection();};
m.prototype.refresh=function(){if(!this._scene||!this._viewStateManager||!this._viewStateManager.getNodeHierarchy()){this._model.setData([]);return;}var i=this._scene.getDefaultNodeHierarchy();var l=[];var q=function(l,r){r.forEach(function(s){if(s.userData&&s.userData.skipIt){q(l,i.getChildren(s));}else{var u=i.createNodeProxy(s);var w=this._createNodeForSceneTree(u.getName(),u.getNodeRef(),this._viewStateManager);l.push(w);i.destroyNodeProxy(u);w.children=[];q(w.children,i.getChildren(s));}}.bind(this));}.bind(this);q(l,i.getChildren());this._model.setData(l);this._tree.setModel(this._model);this._tree.bindRows({path:"/",parameters:{arrayNames:["children"]}});this._tree.getBinding("rows").attachChange(this._dataChange.bind(this));this.fireContentChanged();};
m.prototype.onSetViewStateManager=function(i){this._viewStateManager=i;i.attachNodeHierarchyReplaced(this._onNodeHierarchyReplaced,this);i.attachSelectionChanged(this._onSelectionChanged,this);i.attachVisibilityChanged(this._onVisibilityChanged,this);this.refresh();};
m.prototype.onUnsetViewStateManager=function(i){this._viewStateManager=null;i.detachVisibilityChanged(this._onVisibilityChanged,this);i.detachSelectionChanged(this._onSelectionChanged,this);i.detachNodeHierarchyReplaced(this._onNodeHierarchyReplaced,this);this.refresh();};
m.prototype._onNodeHierarchyReplaced=function(i){this.refresh();};
m.prototype._setContent=function(i){this._setScene(i);};
m.prototype.onSetContentConnector=function(i){i.attachContentReplaced(this._onContentReplaced,this);i.attachContentChangesFinished(this._onContentChangesFinished,this);this._setContent(i.getContent());};
m.prototype.onUnsetContentConnector=function(i){this._setContent(null);i.detachContentChangesFinished(this._onContentChangesFinished,this);i.detachContentReplaced(this._onContentReplaced,this);};
m.prototype._onContentReplaced=function(i){this._setContent(i.getParameter("newContent"));};
m.prototype._onContentChangesFinished=function(i){this.refresh();};
return m;});
sap.ui.predefine('sap/ui/vk/SceneTreeRenderer',[],function(){"use strict";var S={};
S.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiSizeCompact");r.addClass("sapUiVkSceneTree");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("treeTable"));r.write("</div>");};
return S;},true);
sap.ui.predefine('sap/ui/vk/SelectionDisplayMode',[],function(){"use strict";var S={Highlight:"Highlight",Outline:"Outline"};return S;},true);
sap.ui.predefine('sap/ui/vk/SelectionMode',[],function(){"use strict";var S={None:"none",Exclusive:"exclusive",Sticky:"sticky"};return S;},true);
sap.ui.predefine('sap/ui/vk/Smart2DHandler',["sap/ui/base/EventProvider","sap/ui/core/ResizeHandler"],function(E,R){"use strict";
var S=E.extend("sap.ui.vk.Smart2DHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(v,a){this._viewport=v;this._rect=null;this._x=0;this._y=0;this._gesture=false;this._hitEndTimer=0;this._lastRender=0;this._viewport.attachEvent("resize",this,this._onresize);this._viewStateManager=a;this._previousColoring={nodeRef:null,nodeId:null,color:null};}
});
S.prototype.destroy=function(){this._viewport=null;this._rect=null;this._gesture=false;this._viewport.detachEvent("resize",this,this._onresize);this._viewStateManager=null;this._previousColoring=null;};
S.prototype._getOffset=function(d){var r=d.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
S.prototype._inside=function(e){var v=this._viewport.getDomRef();if(v==null){return false;}var a=this._getOffset(v);this._rect={x:a.x,y:a.y,w:v.offsetWidth,h:v.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
S.prototype._onresize=function(e){this._gesture=false;this._rect=null;};
S.prototype.beginGesture=function(e){if(this._inside(e)){this._gesture=true;this._x=e.x;this._y=e.y;}};
S.prototype.callbackHover=function(){var n=this._viewStateManager.getNodeHierarchy();this._lastRender=Date.now();this._hitEndTimer=0;var h=this._viewport.hitTest(this._x,this._y);if(this._highlightedNodeRef!==h){if(this._highlightedNodeRef!==sap.ve.dvl.DVLID_INVALID){var t=this._highlightedNodeRef===this._previousColoring.nodeRef?this._previousColoring.color:0;this._viewport.showHotspots(this._highlightedNodeRef,true,t);}if(n.getHotspotNodeIds().indexOf(h)!==-1){var a=n.createNodeProxy(h);this._previousColoring={nodeRef:h,nodeId:h,color:a.getTintColorABGR()};n.destroyNodeProxy(a);this._viewport.showHotspots(h,true);}this._highlightedNodeRef=h;}this._viewport.renderFrame();};
S.prototype.hover=function(e){if(e.n==1&&this._inside(e)){this._x=e.x-this._rect.x;this._y=e.y-this._rect.y;if(!this.getViewport().getShowAllHotspots()){var t=Date.now();if(t-this._lastRender>20){this.callbackHover();}if(this._hitEndTimer!=0){clearTimeout(this._hitEndTimer);}this._hitEndTimer=setTimeout(this.callbackHover.bind(this),20);}e.handled=true;}};
S.prototype.move=function(e){if(this._gesture&&e.n==1){this._viewport.pan(e.x-this._x,e.y-this._y);this._x=e.x;this._y=e.y;e.handled=true;}};
S.prototype.endGesture=function(e){this._gesture=false;};
S.prototype.click=function(e){};
S.prototype.doubleClick=function(e){};
S.prototype.contextMenu=function(e){};
S.prototype.getViewport=function(){return this._viewport;};
return S;});
sap.ui.predefine('sap/ui/vk/StepNavigation',["sap/ui/core/Control","./library","./Core","./Messages","./DvlException","./ContentConnector","./StepNavigationRenderer","./dvl/GraphicsCoreApi","./dvl/getPointer","./dvl/getJSONObject","./dvl/Scene","./getResourceBundle","sap/base/Log"],function(C,v,a,M,D,b,S,G,g,c,d,f,L){"use strict";
var h=C.extend("sap.ui.vk.StepNavigation",{
metadata:{library:"sap.ui.vk",properties:{settings:"object",width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},showThumbnails:{type:"boolean",group:"Appearance",defaultValue:true},showToolbar:{type:"boolean",group:"Appearance",defaultValue:true},showStepInfo:{type:"boolean",group:"Appearance",defaultValue:false}},publicMethods:["setScene","playStep","pauseStep","playAllSteps","getStep","getNextStep","getPreviousStep","getProceduresAndSteps","refresh","clear"],associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"}},aggregations:{procedureItemTemplate:{type:"sap.ui.core.Item",multiple:false},stepInfoPopup:{type:"sap.ui.core.Control",multiple:false},layout:{type:"sap.m.Toolbar",multiple:false},thumbnailsContainer:{type:"sap.m.ScrollContainer",multiple:false}},events:{"resize":{parameters:{oldSize:"object",size:"object"}},"stepChanged":{parameters:{clientId:"object",type:"object",stepId:"object"}}}},
constructor:function(i,s){C.apply(this,arguments);a.observeAssociations(this);}
});
h.prototype._onStepEvent=function(p){var s=this.getSettings();this.instanceSettings.currentStepId=p.stepId;switch(p.type){case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_FINISHED:s.currentStepFinished=true;s.currentStepPaused=false;s.playAllActive=false;s.isPlaying=false;this._togglePlayPause(true);break;case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_SWITCHED:case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED:s.currentStepId=p.stepId;s.currentStepFinished=false;this._highlightStep(p.stepId);if(s.currentStepPaused){this.pauseStep();}break;default:L.error(f().getText(M.VIT12.summary),M.VIT12.code,"sap.ui.vk.StepNavigation");}this.fireStepChanged({clientId:p.clientId,type:p.type,stepId:p.stepId});};
h.prototype.setScene=function(s){if(this._scene){this.oDvl.Client.detachStepEvent(this._onStepEvent,this);this.oDvl=null;}if(s){var e=s.getMetadata().getName();if(e!=="sap.ui.vk.dvl.Scene"){return;}}this._scene=s;this.instanceSettings={};if(this._scene){this.oDvl=s.getGraphicsCore().getApi(G.LegacyDvl);this.oDvl.Client.attachStepEvent(this._onStepEvent,this);}delete this._procedures;var p=this.getProcedureList();var o=this.getSettings();o.reset();p.unbindItems();p.setSelectedItem(p.getFirstItem());if(o.stepInfo.stepMessagePopup){if(!o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}o.stepInfo.stepMessagePopup.destroy();o.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(f().getText("STEP_NAV_STEPDESCRIPTIONHEADING"));}var i=this._getStepThumbnails();this.oModel.setData(i);this._togglePlayPause(true);this._refreshControl();this.refresh();};
h.prototype.init=function(){this._emptyThumbnail="iVBORw0KGgoAAAANSUhEUgAAAE4AAAA8CAYAAADIQIzXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFFmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA2LTA1VDEzOjU1OjAzKzEyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHN0RXZ0OndoZW49IjIwMTgtMDYtMDVUMTM6NTU6MDMrMTI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6QcBQiAAAGO0lEQVR4nO2ca1MbRxaGn+6emR7dzMUEOxRbla04H+LE+f+/YlO1oWIiA8IGhGQZJCSkkeZ28mEsOxtYRxoGIVx6vwip5tI8OrfuPho1DuIzoMZK82igxkEsDz2KxygNDB56EI9QA/3QI3isWoHLqRW4nHLmOdgYg1IgX0E6USp7TZKUNJVP72fVXOCiKEJEUPPeZUklIhhj0Hp+Y5gJnFIKx9EcHBxzeXmJtTbPOJdKIkIcx7x48QObm0+YTJK5zp/b4iaTyVw3WFZNwaVpmuv8uWOc4zg4zlynLaXko2/mDTuFEJBHki2KjM13AqeUIkkSoiieOystUiKgtcJ13cKueSdwYRiyvr7O8+fPiOMUWE7LM8YQBAHNZhMoxvLuBC5JYqz12dhcyz5YTm6gYDQscXZ2lr19aHBTV5UUoihd2ljneYYwDAu95mrKlVMrcDn1qAqyLDtqXFehFCQJxPF8FX9RWig4EXAcgzFZTJx3cu2XDEkMvd6AJEkol8uUKx5xJMRxutCSaGHgRMB1DXGcMByOqVQqwOwJxfMMve6Ak5MTrq+vSdMUz/PY2dnh22+f4zh6ofAWEuNEwPUMIsL+/mt+/fU/XF1d4Vk906qEtYbBYMje3h69Xg/HcbDWEscx9Xqdw6MG2ii0XpzJ3Ts4ETBGYwy8e3dCt9vFdV0ajSPCMMH3zUzwWq0WaZpSLpc/1WGu61KplGm3WvS6fTxvcbnu3u+ktcL1FCfvzmk2m1QqFXzfZzwOqP9RJ0kEx/n/w8iq/pjB4BrP8264ttYGgPE4gAXGuHsH51lN67zD4eEBruugtUZE8P0SnU6Hs7NzHFfNYHVfPmDRtfe9gRMB6xtGw5Dj4wbWWhzH+R+LKZVKtFrnBMMQv3S7y6Zpil9yqFSqhGF4Y7qUpsmnay1yyncv4ESy0mE0GrO3t0eayq1u5rouURSx/8c+cZTieTfhiQgI7O7u4jgOo9GIKaE4jhmNRuzu7rKx8YQwzLcomUeFgxMRrG9IYuH17/tMJmOstbeWHZnL+vT7VzQax2jDrZkxDBOqVZ+XL3+kVqsxmYSMx2OUUnz//Qu+++5fJImQposzuULruKxWc1AK3rw5ZDgcUqlUvliriQjlcoV2u8Xm5lOebq0xDpIb9dhkkrC+8YSfq6/o9XrEcUy1WqVa84lCIUkecQFsjMI4cFA/pt1u/SO0qbTWGGM4OjqkWv0Fax0mk5vwxkGCMZqtrXVQkCYwGWcxbtELqYW6qutpTk/anDVPKZfLM58nInieJQgCDg+PUCqr/f4upbJkMR4nRKGgTZaArG8+Zusi/5svqzBwntVcXlzx9m0D31q0nu/SmcuW6XTec3raxvXUjSwpkq0B+iWD1ormWZs39SPety/QOvvccWYrqO+qQlxVabgeBNTr9WwP1nVzLWoqpbDWcnr6ls3NDcoVj3GQuaIxOoMJdN5f0GyeMxj0SdOUdrvN2toaW99ssbmxiV9yQCCKJPf23z+psBg3HI6I4xjf93OvBIsIrusSBAEHB2/46eeXWGtQGpIYPnS6dD50uPhwkVmeX0IphYjQ7/fpdrtUq1W2t7+hVntCpVLF2vuxwMLAGWMwxty5RUJEKJVK9Ho9Dg8avPjh33x43+X8vEm/n7Xy2Y+hQEQ+fUnT7oIwDGk0jnEch1KpxM7ODtvbTwtv21jKhczP8Lr89t8R19dDIKv5/nrMbZpumIsIl5eXKKXYfva08DEuJTjISpQ0TRmNRnieO7fFTOOl53n3Mr6lBTd1+SI3kYvUarMmp1bgcmoFLqdW4HJqBS6nCsuqItn0Jk3TpekRno7nPlQYuCms7HU5wEGxzYR/VQHgsoHVajVevfplaawNPneVQ/Ff5Z3AZUVq9rfnGaw/+xrcwjSdmRW8WX0ncJ5nGQz6vP69vrS9cfC5j08pVZhH3AmcMYYoihiNRkvlon+XiHzsclqSHuDpgL6GH4zMq1Udl1MzW5xS2SJhEIyWOp7NKhEhiqKszssRZWYGlyTC9vYzarUaxiztatQcygp23/dJcvy6Xo2DuM8MDzMQEax1UF+Zc+fczB7M4aqKMHyYftv7Vp6C4Cuzn8VpBS6nVuByavXAlpxygCarRwTNq8GfDrbV1CI5dZUAAAAASUVORK5CYII=";if(C.prototype.init){C.prototype.init.call(this);}if(this.getSettings()==undefined){this.setSettings(new this._settings());}this._scene=null;this.oModel=new sap.ui.model.json.JSONModel();this.setModel(this.oModel);this._layout=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid});this.setAggregation("layout",this._layout);if(this.getShowThumbnails()){this._thumbnailsScroller=new sap.m.ScrollContainer(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false,focusable:true});this.setAggregation("thumbnailsContainer",this._thumbnailsScroller);}this.playPreviousButton=new sap.m.Button(this.getId()+"-playPreviousButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-left",tooltip:f().getText("STEP_NAV_PREVIOUSSTEPBUTTON"),press:function(e){var s=this.getSettings();var p=this.getPreviousStep(s.currentProcedureIndex);if(p){s.currentStepPaused=false;this.playStep(p.id,true,s.playAllActive);this._togglePlayPause(false);}}.bind(this)});this.playNextButton=new sap.m.Button(this.getId()+"-playNextButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-right",tooltip:f().getText("STEP_NAV_NEXTSTEPBUTTON"),press:function(e){var s=this.getSettings();var n=this.getNextStep(s.currentProcedureIndex);if(n){s.currentStepPaused=false;this.playStep(n.id,true,s.playAllActive);this._togglePlayPause(false);}}.bind(this)});this.playOptionButton=new sap.m.Button(this.getId()+"-playOptionButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-play",tooltip:f().getText("STEP_NAV_PLAYBUTTON_PLAY"),visible:true,press:function(e){var k=this.getPlayMenuButton().getSelectedKey();var s=this.getSettings();var i=null;switch(k){case"0":if(!s.currentStepId){i=this.getNextStep(s.currentProcedureIndex);if(i){s.currentStepId=i.id;}else{return;}}s.playAllActive=false;this.playStep(s.currentStepId,!s.currentStepPaused,s.playAllActive);s.isPlaying=true;s.currentStepPaused=false;this._togglePlayPause(false);break;case"1":s.playAllActive=true;s.currentStepPaused=false;this.playAllSteps(s.currentProcedureId);s.isPlaying=true;this._togglePlayPause(false);break;case"2":if(!s.currentStepId){i=this.getNextStep(s.currentProcedureIndex);if(i){s.currentStepId=i.id;}else{return;}}s.playAllActive=true;var p=!s.currentStepPaused;s.currentStepPaused=false;this.playStep(s.currentStepId,p,s.playAllActive);s.isPlaying=true;this._togglePlayPause(false);break;default:break;}}.bind(this)});this.procedureList=new sap.m.Select(this.getId()+"-procedureList",{tooltip:f().getText("STEP_NAV_PROCEDURESLISTHEADING"),selectedKey:"0",type:sap.m.SelectType.Default,enabled:true,width:"30%",autoAdjustWidth:true,change:function(o){var p=this.getProcedureList();var s=this.getSettings();s.currentProcedureIndex=0;s.currentProcedureId=this.instanceSettings.currentProcedureId=p.getSelectedKey();s.currentStepId=this.instanceSettings.currentStepId=null;for(var i=0;i<this.oModel.oData.procedures.length;i++){if(this.oModel.oData.procedures[i].id==s.currentProcedureId){s.currentProcedureIndex=i;s.currentProcedure=this.oModel.oData.procedures[i];break;}}if(s.stepInfo.stepMessagePopup){if(!s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close();}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null;}this._refreshItems();}.bind(this)});this.procedureList.addStyleClass("sapVizKitStepNavigationProcedureList");this.setAggregation("procedureItemTemplate",(new sap.ui.core.ListItem().bindProperty("text","name").bindProperty("key","id").bindProperty("tooltip","name")));this.playMenuButton=(new sap.m.Select(this.getId()+"-playMenuButtonIcon",{selectedKey:"0",type:sap.m.SelectType.Default,tooltip:f().getText("STEP_NAV_PLAYMENU_PLAYOPTIONS"),enabled:true,autoAdjustWidth:false,items:[new sap.ui.core.ListItem({key:"0",icon:"sap-icon://media-play",text:f().getText("STEP_NAV_PLAYMENU_PLAY"),tooltip:f().getText("STEP_NAV_PLAYMENU_PLAY")}),new sap.ui.core.ListItem({key:"1",icon:"sap-icon://media-play",text:f().getText("STEP_NAV_PLAYMENU_PLAYALL"),tooltip:f().getText("STEP_NAV_PLAYMENU_PLAYALL")}),new sap.ui.core.ListItem({key:"2",icon:"sap-icon://media-play",text:f().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING"),tooltip:f().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING")})]}));this.playMenuButton.addStyleClass("sapVizKitStepNavigationPlayOptionsSelect");this.pauseButton=new sap.m.Button(this.getId()+"-pauseButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-pause",visible:false,tooltip:f().getText("STEP_NAV_PLAYMENU_PAUSE"),press:function(e){var s=this.getSettings();this.pauseStep();s.currentStepPaused=true;s.isPlaying=false;this._togglePlayPause(true);}.bind(this)});this.showStepInfoButton=new sap.m.ToggleButton(this.getId()+"-showStepInfoButton",{icon:"sap-icon://hide",type:sap.m.ButtonType.Transparent,pressed:false,text:f().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),tooltip:f().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),press:function(e){var t=e.getSource();if(t.getPressed()){this.setShowStepInfo(true);t.setIcon("sap-icon://show");t.setTooltip(f().getText("STEP_NAV_HIDESTEPDESCRIPTIONBUTTON"));}else{this.setShowStepInfo(false);t.setIcon("sap-icon://hide");t.setTooltip(f().getText("STEP_NAV_SHOWSTEPDESCRIPTIONBUTTON"));}}.bind(this)});this._layout.addContent(this.playPreviousButton).addContent(this.playOptionButton).addContent(this.pauseButton).addContent(this.playMenuButton).addContent(this.procedureList).addContent(this.showStepInfoButton).addContent(new sap.m.ToolbarSpacer()).addContent(this.playNextButton);};
h.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent());};
h.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentReplaced(this._onContentReplaced,this);};
h.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"));};
h.prototype.getScroller=function(){return this._thumbnailsScroller;};
h.prototype.getProcedureList=function(){var i=this.getId()+"-procedureList";var e=this._layout;var k=sap.ui.getCore().byId(i);return e.getContent()[e.indexOfContent(k)];};
h.prototype.getPlayMenuButton=function(){var i=this.getId()+"-playMenuButtonIcon";var e=this._layout;var k=sap.ui.getCore().byId(i);return e.getContent()[e.indexOfContent(k)];};
h.prototype.getPlayOptionButton=function(){var i=this.getId()+"-playOptionButton";var e=this._layout;var k=sap.ui.getCore().byId(i);return e.getContent()[e.indexOfContent(k)];};
h.prototype.getPauseButton=function(){var i=this.getId()+"-pauseButton";var e=this._layout;var k=sap.ui.getCore().byId(i);return e.getContent()[e.indexOfContent(k)];};
h.prototype.getPlayNextButton=function(){var i=this.getId()+"-playNextButton";var e=this._layout;var k=sap.ui.getCore().byId(i);return e.getContent()[e.indexOfContent(k)];};
h.prototype.getPlayPreviousButton=function(){var i=this.getId()+"-playPreviousButton";var e=this._layout;var k=sap.ui.getCore().byId(i);return e.getContent()[e.indexOfContent(k)];};
h.prototype.getShowStepInfoButton=function(){var i=this.getId()+"-showStepInfoButton";var e=this._layout;var k=sap.ui.getCore().byId(i);return e.getContent()[e.indexOfContent(k)];};
h.prototype._settings=function(){return{enabled:false,toggle:{addCss:function(k,p,o,e){if(!this.targets[k]){this.targets[k]={"type":"css","property":p,"onValue":o,"offValue":e};}},addMethod:function(t,m,o,e,u){var k=t.getId();if(!this.targets[k]){this.targets[k]={"type":"method","target":t,"method":m,"onValue":o,"offValue":e,"useJQuery":u};}},targets:{}},currentProcedureIndex:0,currentProcedureId:"",currentProcedure:null,currentStepId:null,currentStep:null,currentStepPaused:false,isPlaying:false,currentStepFinished:true,playAllActive:false,showToolbar:true,showThumbnails:true,portfolioMode:false,reset:function(){this.currentStep=null;this.currentProcedure=null;this.currentProcedureIndex=0;this.currentProcedureId="";this.currentStepId=null;this.currentStepPaused=false;this.currentStepFinished=true;this.playAllActive=false;this.portfolioMode=false;},stepInfo:{lastTop:null,lastLeft:null,stepMessagePopup:null,openPopup:function(p,t,e,i){this._customHeaderText=this._customHeaderText||new sap.m.Text({width:"100%",textAlign:sap.ui.core.TextAlign.Center}).addStyleClass("sapVizKitStepNavigationPopoverTitle");this._customHeaderText.setText(p);this._customHeaderText.setTooltip(p);this._customHeader=this._customHeader||new sap.m.Bar({contentLeft:[this._customHeaderText]});this._textContent=this._textContent||new sap.m.Text({});this._textContent.addStyleClass("sapVizKitStepNavigationPopoverContent");this._textContent.setText(t);this.stepMessagePopup=this.stepMessagePopup||new sap.m.ResponsivePopover({placement:i,showCloseButton:true,verticalScrolling:true,contentHeight:"10%",contentWidth:"30%",content:[this._textContent],customHeader:this._customHeader});this.stepMessagePopup.addStyleClass("sapVizKitStepNavigationPopoverStepInfo");this.stepMessagePopup.openBy(e);}}};};
h.prototype.refresh=function(s){L.info("StepNavigation refresh() called.");if(this.getVisible()&&(this["_getStepThumbnails"]&&this._scene!=null)){var p=this.getProcedureList();var o=this.getSettings();o.reset();p.setSelectedItem(p.getFirstItem());var e=this._getStepThumbnails();if(o.stepInfo.stepMessagePopup){if(!o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}o.stepInfo.stepMessagePopup.destroy();o.stepInfo.stepMessagePopup=null;}this.oModel.setData(e);this._togglePlayPause(true);this._refreshControl();}else if(this.getVisible()){this._refreshControl();}return true;};
h.prototype.clear=function(){L.info("StepNavigation clear() called.");return true;};
h.prototype.onBeforeRendering=function(){if(this.getShowToolbar()){var p=this.getProcedureList();p.setModel(this.oModel);var P=this.getProcedureItemTemplate();p.bindItems("/procedures",P);}};
h.prototype.onAfterRendering=function(){var s=this.getSettings();this._togglePlayPause(!s.isPlaying);if(s.currentStepId){this._highlightStep(s.currentStepId);}};
var j={onAfterRendering:function(e){e.srcControl.focus();e.srcControl.removeEventDelegate(this);}};
h.prototype._togglePlayPause=function(p){this.togglePlayPauseActive=true;if(this.getSettings().showToolbar){var e=this.getPlayOptionButton(),i=this.getPauseButton();if(p){if(sap.ui.getCore().getCurrentFocusedControlId()===i.getId()){e.addEventDelegate(j);}i.setVisible(false);e.setVisible(true);}else{if(sap.ui.getCore().getCurrentFocusedControlId()===e.getId()){i.addEventDelegate(j);}e.setVisible(false);i.setVisible(true);}}};
h.prototype._refreshControl=function(){if(!this.oModel.oData.procedures){return;}var p=this.getProcedureList();var P=this.getProcedureItemTemplate();var s=this.getSettings();if(s.stepInfo.stepMessagePopup){if(!s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close();}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(f().getText("STEP_NAV_STEPDESCRIPTIONHEADING"));}p.unbindItems();if(this.oModel.oData.procedures.length>0){var e=this.oModel.oData.procedures[0];if(this.getShowToolbar()){p.bindItems("/procedures",P);p.selectedKey=e.id;p.enabled=true;}this._refreshItems();}else{if(this.getShowToolbar()){p.bindItems("/procedures",P);p.enabled=false;}if(this.getShowThumbnails()){var o=this.getScroller();o.destroyContent();}}};
h.prototype._refreshItems=function(){var t=this;var s=[];var p=this.getProcedureList();var o=t.getSettings();var e=new sap.m.HBox();if(!o.currentProcedure){o.currentProcedure=t.oModel.oData.procedures[o.currentProcedureIndex];p.setSelectedItem(p.getFirstItem());}if(o.currentProcedureId!=""||t.oModel.oData.procedures.length>0){if(t.getShowThumbnails()){var k=t.getScroller();k.removeAllContent();s=t.oModel.oData.procedures[o.currentProcedureIndex].steps;var l=function(q){o.currentStepPaused=false;var r=sap.ui.getCore().byId(q.getSource().getId());t.playStep(r.getCustomData()[0].getValue("stepId"));o.playAllActive=false;t._togglePlayPause(false);};var m=function(q){var r=80;var n=q.getSource();var u=n.getDomRef().width;var w=n.getDomRef().height;var x=u/w;if(u>w){n.setWidth(r+"px");n.setHeight(r/x+"px");}else{n.setHeight(r+"px");n.setWidth(r*x+"px");}};for(var i=0;i<s.length;i++){var n=new sap.m.Image({alt:s[i].name,src:"data:image/"+s[i].thumbnailType+";base64,"+s[i].thumbnailData,densityAware:false,tooltip:s[i].name,press:l.bind(t),load:m,layoutData:new sap.m.FlexItemData({shrinkFactor:0})});n.data("stepId",s[i].id);n.addCustomData(new sap.ui.core.CustomData({key:"stepId",value:s[i].id}));n.addStyleClass("sapVizKitStepNavigationStepItem");e.addItem(n);}k.addContent(e);}}};
h.prototype._getPopupPlacement=function(e){var p=null;var y=0;while(e){y+=e.offsetTop;e=e.offsetParent;}if(y>200){p=sap.m.PlacementType.Top;}else{p=sap.m.PlacementType.Bottom;}return p;};
h.prototype._isScrollingNecessary=function(i,s){var e;if(i&&s){var k=jQuery(i).offset().left+jQuery(i).width();var t=jQuery(s).width();if(k-jQuery(i).width()<0){e=true;}else if((t-k)<jQuery(i).width()){e=true;}else{e=false;}}else{e=false;}return e;};
h.prototype._scrollToItem=function(i,s){var p={},o=jQuery(i).offset(),e=jQuery(s).scrollLeft();p.scrollLeft=o.left+(e-jQuery(s).offset().left);p.scrollLeft-=parseInt(jQuery(i).css("marginLeft"),10)||0;p.scrollLeft-=parseInt(jQuery(i).css("borderLeftWidth"),10)||0;jQuery(s).animate(p,50);};
h.prototype._highlightStep=function(s){var t=this;if(t.getVisible()){var o=t.getSettings();var e=t.getStep(0,o.currentProcedureIndex,s);if(!o.currentProcedure){o.currentProcedure=t.oModel.oData.procedures[t.oSettings.currentProcedureIndex];}var k=t.getShowStepInfoButton();var p;var l=document.getElementById(k.getId());p=t._getPopupPlacement(l);if(t.getShowStepInfo()){o.stepInfo.openPopup.call(this,e.name,e.description,k,p);}else if(o.stepInfo.stepMessagePopup&&o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}if(t.getShowThumbnails()){var m=t.getScroller();var T=m.getContent()[0].getItems();for(var i=0;i<T.length;i++){if(T[i].getCustomData()[0].getValue("stepId")==s){T[i].addStyleClass("selected");if(t._isScrollingNecessary(T[i].$()[0],jQuery("#"+m.sId)[0])){t._scrollToItem(T[i].$()[0],jQuery("#"+m.sId)[0]);}}else{T[i].removeStyleClass("selected");}}}}};
h.prototype.getProceduresAndSteps=function(){return this._getStepThumbnails();};
h.prototype._getStepThumbnails=function(){var p=function(s,i,k){var t,l,m;try{var n=i.Scene.RetrieveThumbnail(s,k.id);if(n===sap.ve.dvl.DVLRESULT.NOTFOUND){t=this._emptyThumbnail;}else{t=g(n);}m=t.substring(0,3);if(m==="iVB"){l="png";}else{l="jpg";}k.thumbnailData=t;k.thumbnailType=l;}catch(o){if(o.code!==sap.ve.dvl.DVLRESULT.NOTFOUND){L.error(o.message,o.code,"sap.ui.vk.StepNavigation");}k.thumbnailData=null;k.thumbnailType=null;}};var e=this._retrieveProcedures();if(e.sceneId!=null){e.procedures.forEach(function(i){i.steps.forEach(p.bind(this,e.sceneId,this.oDvl));},this);e.portfolios.forEach(function(i){i.steps.forEach(p.bind(this,e.sceneId,this.oDvl));},this);e.hasThumbnails=true;}this._procedures=e;return e;};
h.prototype._retrieveProcedures=function(i){var t=this;var p={};if(!t._procedures){p={sceneId:null,hasThumbnails:false,"procedures":[],"portfolios":[]};}else{p=t._procedures;}if(t._scene&&(p.sceneId!=(i||t._scene._dvlSceneRef))){var s=i||t._scene._dvlSceneRef;if(s!=null){p={sceneId:null,hasThumbnails:false,"procedures":[],"portfolios":[]};try{var k=c(t.oDvl.Scene.RetrieveProcedures(s));if(k!=null){p.hasThumbnails=false;p.sceneId=t._scene._dvlSceneRef;p.procedures=k.procedures;p.portfolios=k.portfolios;}}catch(e){if(!(e instanceof D&&e.code===sap.ve.dvl.DVLRESULT.NOTIMPLEMENTED)){throw e;}}}}return p;};
h.prototype.getStep=function(r,e,s){var t=this;var i=t.oDvl.Settings.LastLoadedSceneId;var k=null;if(i!=null){e=e!=null?e:0;var l=s?s:t.instanceSettings.currentStepId;var p=t._retrieveProcedures(i);var m=p.procedures[e];if(m&&m.steps.length>0){k=m.steps[0];}else{return null;}if(l!=""){for(var n=0;n<m.steps.length;n++){var _=m.steps[n];if(_.id==l){var x=n+r;if(x<m.steps.length&&x>=0){k=m.steps[x];}else{k=null;}break;}}}}return k;};
h.prototype.pauseStep=function(){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;if(s!=null){t.oDvl.Scene.PauseCurrentStep(s);}};
h.prototype._stepCount=function(e){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;var i=0;if(s!=null){var p=t._retrieveProcedures(s);for(var k=0;k<p.procedures.length;k++){if(p.procedures[k].id==e){i=p.procedures[k].steps.length;break;}else if(e==null){i+=p.procedures[k].steps.length;}}}return i;};
h.prototype.getPreviousStep=function(p){var t=this;return t.getStep(-1,p);};
h.prototype.getNextStep=function(p){var t=this;return t.getStep(1,p);};
h.prototype.playStep=function(e,i,k){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;if(s!=null){t.instanceSettings.currentStepId=e;t.oDvl.Scene.ActivateStep(s,e,i!=null?i:true,k!=null?k:false);}};
h.prototype.playAllSteps=function(p){var t=this;var e=t.oDvl.Settings.LastLoadedSceneId;if(e!=null){var i=t._retrieveProcedures(e);var k=0;if(p!=null&&i.procedures.length>1){for(var l=0;l<i.procedures.length;l++){if(i.procedures[l].id==p){k=l;break;}}}if(i.procedures.length>0){var s=i.procedures[k].steps[0];if(s){t.instanceSettings.currentStepId=s.id;t.oDvl.Scene.ActivateStep(e,s.id,true,true);}}}};
h.prototype._setContent=function(e){var s=null;if(e&&e instanceof d){s=e;}this.setScene(s);return this;};
return h;});
sap.ui.predefine('sap/ui/vk/StepNavigationRenderer',[],function(){"use strict";var S={};
S.render=function(r,c){if(!c.getVisible()){return;}if(c.getShowToolbar()||c.getShowThumbnails){var w=c.getWidth()!=="auto"?c.getWidth():"100%";var h=c.getHeight()!=="auto"?c.getHeight():"auto";r.write("<div");r.addStyle("width",w);r.addStyle("height",h);r.writeControlData(c);r.addClass("sapVizKitStepNavigation");r.writeClasses();var t=c.getTooltip_AsString();if(t){r.writeAttributeEscaped("title",t);}if(!c.getVisible()){r.addStyle("visibility","hidden");}r.writeStyles();r.write(">");r.renderControl(c.getAggregation("layout"));if(c.getShowThumbnails()){S._renderScrollerDiv(r,c);}r.write("</div>");}};
S._renderScrollerDiv=function(r,c){r.renderControl(c.getAggregation("thumbnailsContainer"));};
return S;},true);
sap.ui.predefine('sap/ui/vk/Texture',["sap/ui/base/ManagedObject"],function(M){"use strict";
var T=M.extend("sap.ui.vk.Texture",{metadata:{properties:{"id":{type:"string"},"filterMode":{type:"int",defaultValue:0},"uvRotationAngle":{type:"float",defaultValue:0.0},"uvHorizontalOffset":{type:"float",defaultValue:0.0},"uvVerticalOffset":{type:"float",defaultValue:0.0},"uvHorizontalScale":{type:"float",defaultValue:0.0},"uvVerticalScale":{type:"float",defaultValue:0.0},"uvHorizontalTilingEnabled":{type:"boolean",defaultValue:true},"uvVerticalTilingEnabled":{type:"boolean",defaultValue:true}}}});
T.prototype.load=function(i){return this;};
T.prototype.getTextRef=function(){return null;};
return T;});
sap.ui.predefine('sap/ui/vk/Toolbar',["./library","sap/ui/core/Control","./ToolbarRenderer","./getResourceBundle"],function(v,C,T,g){"use strict";
var a=C.extend("sap.ui.vk.Toolbar",{metadata:{library:"sap.ui.vk",properties:{title:{type:"string",group:"Appearance",defaultValue:""}},events:{},associations:{viewer:{type:"sap.ui.vk.Viewer",cardinality:"0..1"}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_getToolbar",aggregation:"content",forwardBinding:true}},_toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"},_helpButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_stepNavigationButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_sceneTreeButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_enterFullScreenButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_exitFullScreenButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_toolbarTitle:{type:"sap.m.Title",multiple:false,visibility:"hidden"}}}});
a.prototype._getToolbar=function(){return this._toolbar;};
a.prototype._onSceneTree=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer!=null){this.oViewer._componentsState.sceneTree.userInteractionShow=this._sceneTreeButton.getPressed();this.oViewer.setShowSceneTree(this.oViewer._componentsState.sceneTree.userInteractionShow);}};
a.prototype._onStepNavigation=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer!=null){this.oViewer._componentsState.stepNavigation.userInteractionShow=this._stepNavigationButton.getPressed();this.oViewer.setShowStepNavigation(this.oViewer._componentsState.stepNavigation.userInteractionShow);}};
a.prototype._onFullScreen=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer!=null){var n=this._enterFullScreenButton.getPressed();this.oViewer.activateFullScreenMode(n);}};
a.prototype._fullScreenHandler=function(e){var f=e.mParameters.isFullScreen;this._enterFullScreenButton.setPressed(f);if(f){this._enterFullScreenButton.setIcon("sap-icon://exit-full-screen");}else{this._enterFullScreenButton.setIcon("sap-icon://full-screen");}};
a.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}var _=new sap.m.Button({icon:"sap-icon://sys-help",type:sap.m.ButtonType.Transparent,tooltip:g().getText("VIEWER_HELPBUTTONTOOLTIP")});this.setAggregation("_helpButton",_);this._stepNavigationButton=new sap.m.ToggleButton({icon:"sap-icon://step",type:sap.m.ButtonType.Transparent,enabled:false,tooltip:g().getText("STEP_NAV_MENUBUTTONTOOLTIP"),press:this._onStepNavigation.bind(this)});this.setAggregation("_stepNavigationButton",this._stepNavigationButton);this._sceneTreeButton=new sap.m.ToggleButton({icon:"sap-icon://tree",type:sap.m.ButtonType.Transparent,tooltip:g().getText("SCENETREE_MENUBUTTONTOOLTIP"),press:this._onSceneTree.bind(this)});this.setAggregation("_sceneTreeButton",this._sceneTreeButton);this._toolbarTitle=new sap.m.Title();this.setAggregation("_toolbarTitle",this._toolbarTitle);this._enterFullScreenButton=new sap.m.ToggleButton({icon:"sap-icon://full-screen",type:sap.m.ButtonType.Transparent,tooltip:g().getText("VIEWER_FULLSCREENBUTTONTOOLTIP"),press:this._onFullScreen.bind(this)});this.setAggregation("_enterFullScreenButton",this._enterFullScreenButton);var b=new sap.m.Button({icon:"sap-icon://exit-full-screen",type:sap.m.ButtonType.Transparent,tooltip:g().getText("VIEWER_FULLSCREENBUTTONTOOLTIP")});this.setAggregation("_exitFullScreenButton",b);var t=t=[new sap.m.ToolbarSpacer(),this._toolbarTitle,new sap.m.ToolbarSpacer(),new sap.m.ToolbarSeparator(),this._sceneTreeButton,new sap.m.ToolbarSeparator(),this._stepNavigationButton,new sap.m.ToolbarSeparator(),this._enterFullScreenButton];this._toolbar=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid,content:t});this.setAggregation("_toolbar",this._toolbar,true);};
a.prototype.exit=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer){this.oViewer.detachFullScreen(this._fullScreenHandler.bind(this));}};
a.prototype.onBeforeRendering=function(){this._toolbar.setVisible(true);this._toolbarTitle.setText(this.getTitle());};
a.prototype.refresh=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());this._stepNavigationButton.setPressed(this.oViewer.getShowStepNavigation());this._stepNavigationButton.setEnabled(this.oViewer.getEnableStepNavigation());this._sceneTreeButton.setPressed(this.oViewer.getShowSceneTree());this._sceneTreeButton.setEnabled(this.oViewer.getEnableSceneTree());this.oViewer.attachFullScreen(this._fullScreenHandler.bind(this));return true;};
a.prototype.onAfterRendering=function(){this.refresh();};
return a;});
sap.ui.predefine('sap/ui/vk/ToolbarRenderer',[],function(){"use strict";var T={};
T.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitToolbar");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("_toolbar"));r.write("</div>");};
return T;},true);
sap.ui.predefine('sap/ui/vk/TransformationMatrix',["sap/ui/base/DataType","sap/base/assert"],function(D,c){"use strict";var T=D.getType("float[]");
T.parseValue=function(v){var a=T.getComponentType();return v.split(/\s*,\s*|\s+/).map(a.parseValue.bind(a));};
T.convertTo4x4=function(a){var m=a;return[m[0],m[1],m[2],0,m[3],m[4],m[5],0,m[6],m[7],m[8],0,m[9],m[10],m[11],1];};
T.canConvertTo4x3=function(m){var e=function(a,b){return Math.abs(a-b)<1e-5;};return(e(m[3],0)&&e(m[7],0)&&e(m[11],0)&&e(m[15],1));};
T.convertTo4x3=function(a){var m=a;c(T.canConvertTo4x3(m),"The transformation matrix is invalid. The last column must be [0, 0, 0, 1].");return[m[0],m[1],m[2],m[4],m[5],m[6],m[8],m[9],m[10],m[12],m[13],m[14]];};
T.convert3x2To4x3=function(m){return[m[0],m[1],0,m[2],m[3],0,0,0,1,m[4],m[5],0];};
T.convert4x3To3x2=function(m){return new Float32Array([m[0],m[1],m[3],m[4],m[9],m[10]]);};
T.convert4x4To3x2=function(m){return new Float32Array([m[0],m[1],m[4],m[5],m[12],m[13]]);};
T.convertTo3x2=function(m){if(m){if(m.length===12){return T.convert4x3To3x2(m);}else if(m.length===16){return T.convert4x4To3x2(m);}}return new Float32Array([1,0,0,1,0,0]);};
return T;},true);
sap.ui.predefine('sap/ui/vk/View',["sap/ui/base/ManagedObject","sap/ui/model/json/JSONModel","./findIndexInArray","./AnimationPlayback","./Core"],function(M,J,f,A,v){"use strict";
var V=M.extend("sap.ui.vk.View",{metadata:{library:"sap.ui.vk",interfaces:["sap.ui.vk.IPlaybackCollection"],properties:{viewId:{type:"string"},name:{type:"string"},description:{type:"string"},aspectRatio:{type:"float"}}}});
V.prototype.init=function(){this._playbacks=[];this._playbacksJSONData=[];this._model=new J({playbacks:this._playbacksJSONData});this._model.setSizeLimit(1000*1000);this._highlightIdNodesMap=new Map();};
V.prototype.exit=function(){this._playbacks=undefined;this._playbacksJSONData=undefined;this._highlightIdNodesMap=undefined;};
V.prototype.getCamera=function(){return this._camera;};
V.prototype.setCamera=function(c){this._camera=c;return this;};
V.prototype.hasHighlight=function(){return this._highlightIdNodesMap&&this._highlightIdNodesMap.size;};
V.prototype.getHighlightIdNodesMap=function(){return this._highlightIdNodesMap;};
V.prototype.addHighlightedNodes=function(h,n){var a=this._highlightIdNodesMap.get(h);if(!Array.isArray(n)){n=[n];}if(!a){this._highlightIdNodesMap.set(h,n);}else{a=a.concat(n.filter(function(i){return a.indexOf(i)<0;}));this._highlightIdNodesMap.set(h,a);}};
V.prototype.hasAnimation=function(){return this._playbacks&&this._playbacks.length;};
V.prototype.getPlaybacks=function(){return this._playbacks;};
V.prototype.getPlayback=function(i){if(i<0||i>=this._playbacks.length){return undefined;}return this._playbacks[i];};
V.prototype.indexOfPlayback=function(p){return f(this._playbacks,function(i){return i===p;});};
V.prototype.addPlayback=function(p,b){this._playbacks.push(p);this._playbacksJSONData.push(p.getJSONData());if(this._model){this._model.updateBindings();}p.setJSONModel(this._model);if(!b){this._firePlaybacksChanged("playbackAdded",p);}return this;};
V.prototype.insertPlayback=function(p,i,b){if(i<0){i=0;}else if(i!==0&&i>=this._playbacks.length){i=this._playbacks.length;}this._playbacks.splice(i,0,p);this._playbacksJSONData.splice(i,0,p.getJSONData());if(this._model){this._model.updateBindings();}if(!b){this._firePlaybacksChanged("playbackInserted",p);}return this;};
V.prototype.sortPlaybacks=function(p,a,b){this._playbacks.sort(function(e,g){return e.getStartTime()-g.getStartTime();});this._playbacksJSONData=[];this._playbacks.forEach(function(p){this._playbacksJSONData.push(p.getJSONData());}.bind(this));var c=true;for(var i=0;i<this._playbacks.length-1;i++){var s=this._playbacks[i].getStartTime();var d=this._playbacks[i+1].getStartTime();if(d-s<0.00001){c=false;break;}}if(!b){this._firePlaybacksChanged("playbacksOrderChanged");}return c;};
V.prototype.removePlayback=function(o,b){var i;if(typeof o==="number"){i=o;}else if(typeof o==="string"){i=f(this._playbacks,function(a){return a.getId()===o;});}else{i=f(this._playbacks,function(a){return a===o;});}var r;if(i!=null&&i>=0&&i<this._playbacks.length){r=this._playbacks[i];this._playbacks.splice(i,1);this._playbacksJSONData.splice(i,1);if(this._model){this._model.updateBindings();}}if(!b){this._firePlaybacksChanged("playbackRemoved",r);}return this;};
V.prototype.removePlaybacks=function(b){this._playbacks.splice(0);this._playbacksJSONData.splice(0);if(this._model){this._model.updateBindings();}if(!b){this._firePlaybacksChanged("playbacksRemoved");}return this;};
V.prototype.switchPlaybacks=function(p,a,b){var c,d;for(var i=0;i<this._playbacks.length;i++){if(this._playbacks[i]===p){c=i;}else if(this._playbacks[i]===a){d=i;}}if(c!==undefined&&d!==undefined){var t=this._playbacks[c];var e=this._playbacksJSONData[c];this._playbacks[c]=this._playbacks[d];this._playbacksJSONData[c]=this._playbacksJSONData[d];this._playbacks[d]=t;this._playbacksJSONData[d]=e;}this.resetPlaybacksStartTimes(true);if(!b){this._firePlaybacksChanged("playbacksOrderChanged");}return this;};
V.prototype.resetPlaybacksStartTimes=function(b){if(this._playbacks.length===0){return this;}var s=0;for(var i=0;i<this._playbacks.length;i++){this._playbacks[i].setStartTime(s);s+=this._playbacks[i].getDuration();}if(!b){this._firePlaybacksChanged("playbacksStartTimeChanged");}return this;};
V.prototype._firePlaybacksChanged=function(o,p){v.getEventBus().publish("sap.ui.vk","playbacksChanged",{viewId:this.getViewId(),operation:o,playback:p});};
V.prototype.setPlaybacksReversed=function(r,b){for(var i=0;i<this._playbacks.length;i++){this._playbacks[i].setReversed(r);}if(!b){this._firePlaybacksChanged();}return this;};
V.prototype.getNodeInfos=function(){return this._nodeInfos;};
V.prototype.setNodeInfos=function(i){this._nodeInfos=i;return this;};
V.prototype.updateNodeInfos=function(u){var c=this.getNodeInfos();if(!c){return this.setNodeInfos(u);}var i=new Map();c.forEach(function(d,a){i.set(d.target,a);});var m=function(d,s){for(var p in s){d[p]=s[p];}};u.forEach(function(d){var a=i.get(d.target);if(a==null){c.push(d);}else{m(c[a],d);}});this.setNodeInfos(c);return this;};
V.prototype.getModel=function(){return this._model;};
return V;});
sap.ui.predefine('sap/ui/vk/ViewGallery',["sap/ui/core/Control","sap/ui/core/IconPool","./library","./Core","sap/m/Slider","./ViewGalleryRenderer","./getResourceBundle","./ViewGalleryThumbnail","sap/m/HBox","sap/m/VBox","sap/m/FormattedText","sap/m/FlexItemData","sap/m/Image","sap/m/ScrollContainer","sap/m/Button","sap/m/ToggleButton","sap/m/Toolbar","sap/m/Popover","sap/m/Title","sap/m/SelectList","sap/m/ToolbarSpacer","sap/ui/model/json/JSONModel","sap/ui/core/dnd/DropInfo","sap/ui/core/dnd/DragInfo","sap/base/Log"],function(C,I,v,a,A,V,g,b,H,c,F,d,e,S,B,T,f,P,h,l,m,J,D,o,L){"use strict";
var p=C.extend("sap.ui.vk.ViewGallery",{
metadata:{library:"sap.ui.vk",properties:{showAnimationTimeSlider:{type:"boolean",defaultValue:true},showToolbar:{type:"boolean",defaultValue:true},showThumbnailContainer:{type:"boolean",defaultValue:true},selectedViewIndex:{type:"int",defaultValue:-1},selectedViewGroupIndex:{type:"int",defaultValue:-1},enableViewReordering:{type:"boolean",defaultValue:false},transparency:{type:"float",defaultValue:1}},associations:{animationPlayer:{type:"sap.ui.vk.AnimationPlayer"},contentConnector:{type:"sap.ui.vk.ContentConnector"},host:{type:"sap.ui.vk.ViewportBase"},viewManager:{type:"sap.ui.vk.ViewManager"}},aggregations:{toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"},container:{type:"sap.m.ScrollContainer",multiple:false,visibility:"hidden"},animationTimeSlider:{type:"sap.m.Slider",multiple:false,visibility:"hidden"}},events:{selectionChange:{parameters:{item:"sap.ui.core.Control"}},viewOrderChange:{parameters:{view:"sap.ui.vk.View",viewIndex:"int"}}}},
constructor:function(i,s){C.apply(this,arguments);a.observeAssociations(this);}
});
p.prototype.init=function(){if(C.prototype.init){C.prototype.init.call(this);}var t=this;window.addEventListener("resize",function(){t.resizeToolbarSpacer();},true);this._scene=null;this._vkScene=null;this._viewItems=[];this._viewManager=null;this._host=null;this._cdsLoader=null;this._selectedGroupIndex=-1;this._previousOrientationVertical=false;this._playingAnimation=true;this._draggedModelView={};this._animationPlayer=null;this._manualTimeChange=false;I.addIcon("landscape-text","vk-icons","vk-icons","e019");I.addIcon("portrait-text","vk-icons","vk-icons","e01a");this.oModel=new J();if(this.getShowThumbnailContainer()){this.createThumbnailContainer();}if(this.getShowToolbar()){this.createToolbar();}if(this.getShowAnimationTimeSlider()){this.setAggregation("animationTimeSlider",new A());this._attachAnimationTimeSlider(this.getAnimationTimeSlider());}a.getEventBus().subscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);a.getEventBus().subscribe("sap.ui.vk","procedureFinished",this._onProcedureFinished,this);};
p.prototype.exit=function(){a.getEventBus().unsubscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);a.getEventBus().unsubscribe("sap.ui.vk","procedureFinished",this._onProcedureFinished,this);};
p.prototype.onSetViewManager=function(i){this._viewManager=i;};
p.prototype.onUnsetViewManager=function(i){this._viewManager=null;};
p.prototype._getSelectedViewGroup=function(){var i=this.getSelectedViewGroupIndex();var r;if(this._vkScene){var j=this._vkScene.getViewGroups();if(i>=0&&i<j.length){r=j[i];}}return r;};
p.prototype._getSelectedView=function(){var r;var i=this.getSelectedViewIndex();var j=this._getViews();if(j&&i>=0&&i<j.length){r=j[i];}return r;};
p.prototype._getViewGroups=function(){var r;if(this._vkScene){r=this._vkScene.getViewGroups();}return r;};
p.prototype._getViews=function(){var i=this._getSelectedViewGroup();var j;if(i){j=i.getViews();}else if(this._vkScene){j=this._vkScene.getViews();}return j;};
p.prototype._getViewIndex=function(i){var r=-1;var j=this._getViews();if(Array.isArray(j)){r=j.indexOf(i);}return r;};
p.prototype._getViewAnimationDuration=function(i){i=i||this._getSelectedView();var r;if(i){var j=i.getPlaybacks();if(Array.isArray(j)&&j.length){r=j.reduce(function(k,n){return k+n.getDuration();},0);}}return r;};
p.prototype.setVisible=function(i){if(C.prototype.setVisible){C.prototype.setVisible.call(this,i);}this.setDescription();};
p.prototype.resizeToolbarSpacer=function(){if(this.getDomRef()){var i=this._nextItemButton.getDomRef().getBoundingClientRect().width;i+=this._playButton.getDomRef().getBoundingClientRect().width;i+=this._previousItemButton.getDomRef().getBoundingClientRect().width;var t=this.toolbar.getDomRef().getBoundingClientRect().width;var w=(i/t)*100;var j=50-w;this._toolbarSpacer.setWidth(j+"%");}};
p.prototype.onAfterRendering=function(){this.resizeToolbarSpacer();if(document.getElementById("body")){var i=window.getComputedStyle(document.getElementById("body"));var j=i.getPropertyValue("background-color");var t;var k=this.getDomRef();if(j){if(j.indexOf("a")===-1){t=j.replace("rgb","rgba").replace(")",", "+this.getTransparency()+")");k.style.backgroundColor=t;}else{var r=new RegExp("([^,]*)$");t=j.replace(r," "+this.getTransparency()+")");k.style.backgroundColor=t;}}if(this.toolbar){var n=this.toolbar.getDomRef();n.style.backgroundColor="rgba(0, 0, 0, 0)";}}if(this._host&&this._host.getContent().indexOf(this)!==-1){this.adjustStepDescriptionBoxes();}};
p.prototype.setShowAnimationTimeSlider=function(i){this.setProperty("showAnimationTimeSlider",i);if(i){this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.setAggregation("animationTimeSlider",new A());this._attachAnimationTimeSlider(this.getAnimationTimeSlider());}else{this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.destroyAggregation("animationTimeSlider");}this._setupAnimationSlider();};
p.prototype.getAnimationTimeSlider=function(){return this.getAggregation("animationTimeSlider");};
p.prototype.destroyToolbar=function(){this.destroyAggregation("toolbar");};
p.prototype.destroyThumbnailContainer=function(){this.destroyAggregation("container");};
p.prototype.createThumbnailContainer=function(){var t=this;this._hbox=new H();if(this.getEnableViewReordering()){this._hbox.addDragDropConfig(new D({dropEffect:sap.ui.core.dnd.DropEffect.Move,dropPosition:sap.ui.core.dnd.DropPosition.On,targetAggregation:"items",drop:function(E){var i=E.getParameter("droppedControl");t.reorderViews(i);t.fireViewOrderChange({view:t._draggedModelView,viewIndex:t._viewItems.indexOf(i)});}}));this._hbox.getMetadata().getAggregation().dnd.droppable=true;}this._scrollContainer=new S(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false,focusable:true,content:[this._hbox]});this._scrollContainer.addStyleClass("sapVizKitViewGalleryScrollContainer");this.setAggregation("container",this._scrollContainer);};
p.prototype.reorderViews=function(i){var j=this._modelViews.indexOf(this._draggedModelView);this._modelViews.splice(j,1);var k=this._viewItems.indexOf(i);this._modelViews.splice(k,0,this._draggedModelView);this._refreshItems();};
p.prototype.createToolbar=function(){var t=this;this.toolbar=new f({design:sap.m.ToolbarDesign.Auto});this.setAggregation("toolbar",this.toolbar);this._previousItemButton=new B(this.getId()+"-previousItemButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://close-command-field",tooltip:g().getText("STEP_NAV_PREVIOUSSTEPBUTTON"),press:function(j){var i=t.getSelectedViewIndex();if(i>0){t.setSelectedItem(t._viewItems[i-1]);}}});this._nextItemButton=new B(this.getId()+"-nextItemButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://open-command-field",tooltip:g().getText("STEP_NAV_NEXTSTEPBUTTON"),press:function(j){var i=t.getSelectedViewIndex();if(i>=0&&i+1<t._viewItems.length){t.setSelectedItem(t._viewItems[i+1]);}}});this._viewGroupSelector=new P({showHeader:false,contentWidth:"20%",placement:sap.m.PlacementType.Top,horizontalScrolling:false,verticalScrolling:false,content:[new S({horizontal:false,vertical:true,content:[this._procedureList=new l({width:"100%",itemPress:function(i){t._clearUI();var j=this.indexOfItem(i.getParameter("item"));t.setSelectedViewGroupIndex(j);}})]})]});this._playButton=new T(this.getId()+"-playButton",{type:sap.m.ButtonType.Transparent,pressed:false,icon:"sap-icon://media-play",visible:true,tooltip:g().getText("STEP_NAV_PLAYMENU_PLAY"),press:function(E){this._setPlayState(E.getSource().getPressed());if(E.getSource().getPressed()){this._playProcedure();}else{this._pauseAnimation();}}.bind(this)});this._stepCount=new h({textAlign:sap.ui.core.TextAlign.Right,level:"H5",titleStyle:"H5"});this._currentGroupTitle=new h({text:g().getText("STEP_NAV_PROCEDURES"),tooltip:g().getText("STEP_NAV_PROCEDURES"),level:"H5",titleStyle:"H5"}).addStyleClass("sapVizKitViewGalleryCurrentGroupTitle");this._separatorTitle=new h({width:(5/1920)*100+"%",level:"H5",titleStyle:"H5"});this._currentStepTitle=new h({level:"H5",titleStyle:"H5"}).addStyleClass("sapVizKitViewGalleryCurrentStepTitle");this._currentGroupTitle.addEventDelegate({ontap:function(){this._viewGroupSelector.openBy(this._currentGroupTitle);}.bind(this)});this._toolbarSpacer=new m();this.toolbar.addContent(this._currentGroupTitle).addContent(this._separatorTitle).addContent(this._currentStepTitle).addContent(new m()).addContent(this._stepCount).addContent(this._toolbarSpacer).addContent(this._previousItemButton).addContent(this._playButton).addContent(this._nextItemButton);};
p.prototype._setPlayState=function(i){if(this.getAggregation("toolbar")){this._playButton.setPressed(i);if(i){this._playButton.setIcon("sap-icon://media-pause");this._playButton.setTooltip(g().getText("STEP_NAV_PLAYMENU_PAUSE"));}else{this._playButton.setIcon("sap-icon://media-play");this._playButton.setTooltip(g().getText("STEP_NAV_PLAYMENU_PLAY"));}}};
p.prototype._createStepDescriptionBoxes=function(){this._stepDescription=new c({renderType:sap.m.FlexRendertype.Bare,fitContainer:false,alignContent:sap.m.FlexAlignContent.Start,alignItems:sap.m.FlexAlignItems.Start,justifyContent:sap.m.FlexJustifyContent.End,items:[this._stepDescriptionToolbar=new f({design:sap.m.ToolbarDesign.Solid,content:[this._stepDescriptionIcon=new sap.ui.core.Icon({src:"sap-icon://navigation-up-arrow",press:function(i){this._toggleViewDescription();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionIcon sapVizKitViewGalleryStepDescriptionIconTransform"),new m(),this._stepDescriptionOrientationIcon=new sap.ui.core.Icon({src:"sap-icon://vk-icons/landscape-text",press:function(i){this._toggleOrientation();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionOrientationIcon")],layoutData:new d({shrinkFactor:0})}).addStyleClass("sapVizKitViewGalleryStepDescriptionToolbar"),this._stepDescriptionScroll=new S({horizontal:false,vertical:true,content:[this._stepDescriptionText=new F({visible:true}).addStyleClass("sapVizKitViewGalleryStepDescriptionText")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionScroll")]}).addStyleClass("sapVizKitViewGalleryStepDescription");this._stepDescription.vitId="VIT-StepDescription";this._stepDescriptionVertical=new H({renderType:sap.m.FlexRendertype.Bare,fitContainer:false,alignContent:sap.m.FlexAlignContent.Start,alignItems:sap.m.FlexAlignItems.Start,justifyContent:sap.m.FlexJustifyContent.End,items:[this._stepDescriptionVerticalScroll=new S({horizontal:false,vertical:true,content:[this._stepDescriptionVerticalText=new F({visible:false}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalText")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalScroll"),this._stepDescriptionVerticalToolbar=new f({design:sap.m.ToolbarDesign.Solid,content:[this._stepDescriptionVerticalIcon=new sap.ui.core.Icon({src:"sap-icon://navigation-right-arrow",press:function(i){this._toggleViewDescriptionVertical();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalIcon sapVizKitViewGalleryStepDescriptionIconTransform"),this._stepDescriptionVerticalOrientationIcon=new sap.ui.core.Icon({src:"sap-icon://vk-icons/portrait-text",press:function(i){this._toggleOrientation();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalOrientationIcon")],layoutData:new d({shrinkFactor:0})}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalToolbar")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionVertical");this._stepDescriptionVertical.vitId="VIT-StepDescriptionVertical";};
p.prototype.adjustStepDescriptionBoxes=function(){if(this._stepDescription.getDomRef()){var i=this.getDomRef().getBoundingClientRect().height;var s=this._stepDescription.getDomRef().id;var j=this._stepDescriptionVertical.getDomRef().id;document.getElementById(s).style.bottom=i+"px";document.getElementById(j).style.bottom=i+"px";var k=this._host.getDomRef().getBoundingClientRect().height;document.getElementById(j).style.height=k-i+"px";}};
p.prototype._toggleOrientation=function(){if(this._stepDescriptionToolbar.getVisible()){this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(true);this._previousOrientationVertical=true;if(this._stepDescriptionText.getVisible()){this._stepDescriptionVerticalText.setVisible(true);}this._stepDescriptionText.setVisible(false);}else{this._stepDescriptionToolbar.setVisible(true);this._previousOrientationVertical=false;if(this._stepDescriptionVerticalText.getVisible()){this._stepDescriptionText.setVisible(true);}this._stepDescriptionVerticalToolbar.setVisible(false);this._stepDescriptionVerticalText.setVisible(false);}this._stepDescription.rerender();this._stepDescriptionVertical.rerender();if(this._host&&this._host.getContent().indexOf(this)!==-1){this.adjustStepDescriptionBoxes();}};
p.prototype._toggleViewDescription=function(){if(!this._stepDescriptionText.getVisible()){this._stepDescriptionText.setVisible(true);this._stepDescriptionIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionVerticalIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}else{this._stepDescriptionText.setVisible(false);this._stepDescriptionIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionVerticalIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}this._stepDescriptionText.rerender();};
p.prototype._toggleViewDescriptionVertical=function(){if(!this._stepDescriptionVerticalText.getVisible()){this._stepDescriptionVerticalText.setVisible(true);this._stepDescriptionVerticalIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}else{this._stepDescriptionVerticalText.setVisible(false);this._stepDescriptionVerticalIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}this._stepDescriptionVerticalText.rerender();};
p.prototype._getHBox=function(){return this._hbox;};
p.prototype._playProcedure=function(){this._manualTimeChange=false;if(this._viewManager){var s=this._getSelectedView();if(!s){var i=this._getViews();if(i&&i.length){s=i[0];}}if(s){this._viewManager.playViewGroup(s,this._getSelectedViewGroup());}}};
p.prototype._pauseAnimation=function(){if(this._viewManager){this._viewManager.stopPlayingViewGroup();}};
p.prototype.setPlayingAnimation=function(i){this._playingAnimation=i;};
p.prototype.onSetAnimationPlayer=function(i){this._animationPlayer=i;i.attachTimeChanged(this._onAnimationPlayerTimeChanged,this);i.attachStateChanged(this._onAnimationPlayerStateChanged,this);this._setupAnimationSlider();};
p.prototype.onUnsetAnimationPlayer=function(i){i.detachTimeChanged(this._onAnimationPlayerTimeChanged,this);i.detachStateChanged(this._onAnimationPlayerStateChanged,this);this._animationPlayer=null;};
p.prototype._setupAnimationSlider=function(){var i=this.getAnimationTimeSlider();if(i&&this._animationPlayer){var j=this._getViewAnimationDuration();if(j){i.setMax(j);i.setStep(j/100);i.setValue(this._animationPlayer.getTime());}}};
p.prototype._onAnimationPlayerTimeChanged=function(i){var t=i.getParameter("time");var j=this.getAnimationTimeSlider();if(j){j.setValue(t);}};
p.prototype._onAnimationPlayerStateChanged=function(i){var j=i.getParameter("playing");this._setPlayState(j);};
p.prototype._onProcedureFinished=function(i){this._setPlayState(false);};
p.prototype.setScene=function(s){if(s&&s.loaders){for(var i=0;i<s.loaders.length;i++){var j=s.loaders[i];if(j.getMetadata&&j.getMetadata().getName()==="sap.ui.vk.threejs.ContentDeliveryService"){this._cdsLoader=j;this._cdsLoader.detachLoadingFinished(this._handleCdsViewGroupUpdate,this);this._cdsLoader.attachLoadingFinished(this._handleCdsViewGroupUpdate,this);break;}else if(j.requestViewGroup){this._loader=j;break;}}}this._vkScene=s;this._refreshProcedures();this._resetCurrentView();};
p.prototype._onViewActivated=function(n,r,s){var t;var u=s.view;var w=this._getViewGroups();if(w&&w.length>0){var x=w[this.getSelectedViewGroupIndex()];if(x&&x.getViewGroupId()!=u.viewGroupId){for(var i=0;i<w.length;i++){if(w[i].getViewGroupId()===u.viewGroupId){for(var k=0;k<w[i].getViews().length;k++){if(w[i].getViews()[k]===u){t=k;this.setSelectedViewGroupIndex(i,t);break;}}}}}else{for(var j=0;x&&j<x.getViews().length;j++){if(x.getViews()[j]===u){t=j;this.viewActivated(t,u);break;}}}}};
p.prototype.onSetHost=function(j){if(j.getContent()){var k=function(n){var r=j.getContent();for(var i=0;i<r.length;i++){if(r[i].vitId==n){return i;}}};j.removeContent(k("VIT-StepDescription"));j.removeContent(k("VIT-StepDescriptionVertical"));}this._createStepDescriptionBoxes();j.addContent(this._stepDescription);j.addContent(this._stepDescriptionVertical);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(false);this._attachAnimationTimeSlider(this.getAnimationTimeSlider());};
p.prototype.onUnsetHost=function(i){this._detachAnimationTimeSlider(this.getAnimationTimeSlider());};
p.prototype._attachAnimationTimeSlider=function(i){if(!i){return;}i.attachChange(this._onSliderValueChange,this);i.attachLiveChange(this._onSliderValueLiveChange,this);};
p.prototype._detachAnimationTimeSlider=function(i){if(!i){return;}i.detachChange(this._onSliderValueChange,this);i.detachLiveChange(this._onSliderValueLiveChange,this);};
p.prototype._onSliderValueLiveChange=function(i){var j=i.getParameter("value");this._manualTimeChange=true;if(this._animationPlayer&&this._animationPlayer.getTime()!==j){this._animationPlayer.setTime(j);}};
p.prototype._onSliderValueChange=function(i){var j=i.getParameter("value");this._manualTimeChange=true;if(this._animationPlayer&&this._animationPlayer.getTime()!==j){this._animationPlayer.setTime(j);}};
p.prototype._refreshProcedures=function(i){if(this.getAggregation("toolbar")){this._procedureList.removeAllItems();}this._modelViews=null;var j=this._getViewGroups();if(j&&j.length>0){this._selectedGroupIndex=0;var k=0;j.forEach(function(n){if(this.getAggregation("toolbar")){this._procedureList.addItem(new sap.ui.core.Item({key:n.getViewGroupId(),text:n.getName()}));}if(i&&n.getViewGroupId()===i){this._selectedGroupIndex=k;}k++;}.bind(this));this._modelViews=this._getViews();if(this.getAggregation("toolbar")){this._currentGroupTitle.setText(j[this._selectedGroupIndex].getName()).setTooltip(j[this._selectedGroupIndex].getName());}}else if(this.getAggregation("toolbar")){this._currentGroupTitle.setText(g().getText("STEP_NAV_PROCEDURES"));}this._refreshItems();};
p.prototype.refresh=function(s){this.setScene(s);};
var q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE4AAAA8CAYAAADIQIzXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFFmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA2LTA1VDEzOjU1OjAzKzEyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHN0RXZ0OndoZW49IjIwMTgtMDYtMDVUMTM6NTU6MDMrMTI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6QcBQiAAAGO0lEQVR4nO2ca1MbRxaGn+6emR7dzMUEOxRbla04H+LE+f+/YlO1oWIiA8IGhGQZJCSkkeZ28mEsOxtYRxoGIVx6vwip5tI8OrfuPho1DuIzoMZK82igxkEsDz2KxygNDB56EI9QA/3QI3isWoHLqRW4nHLmOdgYg1IgX0E6USp7TZKUNJVP72fVXOCiKEJEUPPeZUklIhhj0Hp+Y5gJnFIKx9EcHBxzeXmJtTbPOJdKIkIcx7x48QObm0+YTJK5zp/b4iaTyVw3WFZNwaVpmuv8uWOc4zg4zlynLaXko2/mDTuFEJBHki2KjM13AqeUIkkSoiieOystUiKgtcJ13cKueSdwYRiyvr7O8+fPiOMUWE7LM8YQBAHNZhMoxvLuBC5JYqz12dhcyz5YTm6gYDQscXZ2lr19aHBTV5UUoihd2ljneYYwDAu95mrKlVMrcDn1qAqyLDtqXFehFCQJxPF8FX9RWig4EXAcgzFZTJx3cu2XDEkMvd6AJEkol8uUKx5xJMRxutCSaGHgRMB1DXGcMByOqVQqwOwJxfMMve6Ak5MTrq+vSdMUz/PY2dnh22+f4zh6ofAWEuNEwPUMIsL+/mt+/fU/XF1d4Vk906qEtYbBYMje3h69Xg/HcbDWEscx9Xqdw6MG2ii0XpzJ3Ts4ETBGYwy8e3dCt9vFdV0ajSPCMMH3zUzwWq0WaZpSLpc/1WGu61KplGm3WvS6fTxvcbnu3u+ktcL1FCfvzmk2m1QqFXzfZzwOqP9RJ0kEx/n/w8iq/pjB4BrP8264ttYGgPE4gAXGuHsH51lN67zD4eEBruugtUZE8P0SnU6Hs7NzHFfNYHVfPmDRtfe9gRMB6xtGw5Dj4wbWWhzH+R+LKZVKtFrnBMMQv3S7y6Zpil9yqFSqhGF4Y7qUpsmnay1yyncv4ESy0mE0GrO3t0eayq1u5rouURSx/8c+cZTieTfhiQgI7O7u4jgOo9GIKaE4jhmNRuzu7rKx8YQwzLcomUeFgxMRrG9IYuH17/tMJmOstbeWHZnL+vT7VzQax2jDrZkxDBOqVZ+XL3+kVqsxmYSMx2OUUnz//Qu+++5fJImQposzuULruKxWc1AK3rw5ZDgcUqlUvliriQjlcoV2u8Xm5lOebq0xDpIb9dhkkrC+8YSfq6/o9XrEcUy1WqVa84lCIUkecQFsjMI4cFA/pt1u/SO0qbTWGGM4OjqkWv0Fax0mk5vwxkGCMZqtrXVQkCYwGWcxbtELqYW6qutpTk/anDVPKZfLM58nInieJQgCDg+PUCqr/f4upbJkMR4nRKGgTZaArG8+Zusi/5svqzBwntVcXlzx9m0D31q0nu/SmcuW6XTec3raxvXUjSwpkq0B+iWD1ormWZs39SPety/QOvvccWYrqO+qQlxVabgeBNTr9WwP1nVzLWoqpbDWcnr6ls3NDcoVj3GQuaIxOoMJdN5f0GyeMxj0SdOUdrvN2toaW99ssbmxiV9yQCCKJPf23z+psBg3HI6I4xjf93OvBIsIrusSBAEHB2/46eeXWGtQGpIYPnS6dD50uPhwkVmeX0IphYjQ7/fpdrtUq1W2t7+hVntCpVLF2vuxwMLAGWMwxty5RUJEKJVK9Ho9Dg8avPjh33x43+X8vEm/n7Xy2Y+hQEQ+fUnT7oIwDGk0jnEch1KpxM7ODtvbTwtv21jKhczP8Lr89t8R19dDIKv5/nrMbZpumIsIl5eXKKXYfva08DEuJTjISpQ0TRmNRnieO7fFTOOl53n3Mr6lBTd1+SI3kYvUarMmp1bgcmoFLqdW4HJqBS6nCsuqItn0Jk3TpekRno7nPlQYuCms7HU5wEGxzYR/VQHgsoHVajVevfplaawNPneVQ/Ff5Z3AZUVq9rfnGaw/+xrcwjSdmRW8WX0ncJ5nGQz6vP69vrS9cfC5j08pVZhH3AmcMYYoihiNRkvlon+XiHzsclqSHuDpgL6GH4zMq1Udl1MzW5xS2SJhEIyWOp7NKhEhiqKszssRZWYGlyTC9vYzarUaxiztatQcygp23/dJcvy6Xo2DuM8MDzMQEax1UF+Zc+fczB7M4aqKMHyYftv7Vp6C4Cuzn8VpBS6nVuByavXAlpxygCarRwTNq8GfDrbV1CI5dZUAAAAASUVORK5CYII=";
p.prototype._clearUI=function(){if(this.getAggregation("toolbar")){this._currentStepTitle.setText("");this._separatorTitle.setText("");this._viewGroupSelector.close();this._nextItemButton.setEnabled(false);this._previousItemButton.setEnabled(false);this._stepCount.setText("");if(this._stepDescriptionText){this._stepDescriptionText.setHtmlText("");}if(this._stepDescriptionVerticalText){this._stepDescriptionVerticalText.setHtmlText("");}}if(this.getAggregation("container")){this._hbox.destroyItems();}this._viewItems=[];if(this._stepDescriptionToolbar){this._stepDescriptionToolbar.setVisible(false);}if(this._stepDescriptionVerticalToolbar){this._stepDescriptionVerticalToolbar.setVisible(false);}};
p.prototype._refreshItems=function(){this._clearUI();var t=this;if(this._modelViews){var j=function(i){this.setSelectedItem(i.getSource());}.bind(this);this._modelViews.forEach(function(k){var n=true;var r=k.name||k.getName&&k.getName();var s=new b({alt:r,densityAware:false,tooltip:r,viewGallery:this,source:k.thumbnailData||q,press:function(i){s.detachBrowserEvent("mouseenter",function(i){t.startAnimate();});s.setSource(k.thumbnailData||q);clearInterval(i.getSource().interval);j(i);},layoutData:new d({shrinkFactor:0})});var u=function(w,y){var z=w.width/y;var E=w.height;var G=y;var K=E;var M=document.createElement("canvas");var N=M.getContext("2d");var O=[];M.width=G;M.height=K;for(var i=0;i<z;i++){var x=G*i;N.clearRect(0,0,G,K);N.drawImage(w,x,0,G,K,0,0,G,K);O.push(M.toDataURL());}t.startAnimate=function(){if(n){n=false;s.detachBrowserEvent("mouseenter",function(R){t.startAnimate();});var i=0;var Q=function(){if(i<z){s.setSource(O[i]);i++;}else{s.setSource(O[0]);i=0;}};s.interval=setInterval(function(){Q();},250);}};s.attachBrowserEvent("mouseenter",function(Q){t.startAnimate();});s.attachBrowserEvent("mouseout",function(Q){n=true;s.attachBrowserEvent("mouseenter",function(Q){t.startAnimate();});clearInterval(s.interval);s.setSource(k.thumbnailData);});};if(k.animatedThumbnailData!==undefined){var w=document.createElement("img");w.onload=function(){u(w,k.tileWidth);};w.src=k.animatedThumbnailData;}if(this.getEnableViewReordering()){s.addDragDropConfig(new o({dragStart:function(){t._draggedModelView=k;}}));s.getMetadata().dnd.draggable=true;}s.data("modelView",k);this._viewItems.push(s);if(this.getAggregation("container")){this._hbox.addItem(s);}if(this._hbox.getItems().length===1){s.data("help-id","vit-view-thumbnail",true);}}.bind(this));this.rerender();}};
p.prototype.setSelectedItem=function(i){if(i.getCustomData().length>0){var j=i.getCustomData()[0].getValue();if(this._viewManager){this._viewManager.activateView(j);}}return this;};
p.prototype.setDescription=function(){if(!this._selectedItem){return;}if(!this.getVisible()){this._stepDescription.setVisible(false);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVertical.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(false);return;}if(this._selectedItem.getCustomData().length>0){var i=this._selectedItem.getCustomData()[0].getValue();var j=i.getDescription();if(j){if(this._previousOrientationVertical===false){this._stepDescription.setVisible(true);this._stepDescriptionToolbar.setVisible(true);this._stepDescriptionVerticalToolbar.setVisible(false);}else{this._stepDescriptionVertical.setVisible(true);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(true);this._previousOrientationVertical=true;}}else if(this._previousOrientationVertical===true){this._stepDescriptionVertical.setVisible(false);}else{this._stepDescription.setVisible(false);this._previousOrientationVertical=false;}if(j!=null){this._stepDescriptionText.setHtmlText(j);this._stepDescriptionVerticalText.setHtmlText(j);}}};
p.prototype.viewActivated=function(i){if(this._selectedItem){if(this.getSelectedViewIndex()!==i){this._selectedItem.removeStyleClass("selected");}}this._selectedItem=this._viewItems[i];if(!this._selectedItem){return this;}if(this.getAggregation("toolbar")){var t=g().getText("VIEWS_TITLE_WITH_COUNT",[i+1,this._viewItems.length]);this._stepCount.setText(t);this._previousItemButton.setEnabled(this._selectedItem!==this._viewItems[0]&&this._viewItems.length>1);this._nextItemButton.setEnabled(this._selectedItem!==this._viewItems[this._viewItems.length-1]&&this._viewItems.length>1);this._setPlayState(true);}this._selectedItem.addStyleClass("selected");if(this._isScrollingNecessary(this._selectedItem.getDomRef(),this._scrollContainer.getDomRef())){this._scrollContainer.scrollToElement(this._selectedItem,500);}if(this._selectedItem.getCustomData().length>0){var j=this._selectedItem.getCustomData()[0].getValue();var k=j.getPlaybacks();var s=this.getAnimationTimeSlider();if(s){if(!k||k.length===0){s.setEnabled(false);s.setValue(0);}else{s.setEnabled(true);}}var n=j.name||j.getName&&j.getName();if(this.getAggregation("toolbar")){this._separatorTitle.setText("/");this._currentStepTitle.setText(n).setTooltip(n);}}this.setDescription();this.fireSelectionChange({item:this._selectedItem});this._setupAnimationSlider();return this;};
p.prototype.getSelectedItem=function(){return this._selectedItem;};
p.prototype.getSelectedViewIndex=function(){for(var n=0;n<this._viewItems.length;n++){if(this._viewItems[n]===this.getSelectedItem()){return n;}}return-1;};
p.prototype.setSelectedViewIndex=function(i){if(this._viewItems.length>i){this.setSelectedItem(this._viewItems[i]);}};
p.prototype.getSelectedViewGroupIndex=function(){return this._selectedGroupIndex;};
p.prototype.setSelectedViewGroupIndex=function(i,j){var k=this._getViewGroups();if(k&&k.length>i){this._selectedGroupIndex=i;if(j==null){j=0;}this._currentGroupTitle.setText(k[i].getName()).setTooltip(k[i].getName());this._separatorTitle.setVisible(true);this._modelViews=this._getViews();if(!this._modelViews||this._modelViews.length===0){var n=k[i].getViewGroupId();var s=k[i].sceneId;var t=this;if(this._loader&&this._loader.requestViewGroup){this._loader.requestViewGroup(s,n,false).then(function(r){t._refreshItems();t.setSelectedViewIndex(j);}).catch(function(r){L.error(r);});}else if(this._cdsLoader){this._cdsLoader.loadViewGroup(s,n).then(function(r){t._refreshItems();t.setSelectedViewIndex(j);});}}else{this._refreshItems();this.setSelectedViewIndex(j);}}};
p.prototype._isScrollingNecessary=function(i,s){if(i&&s){var r=i.getBoundingClientRect();return r.left<0||r.right>s.clientWidth;}return false;};
p.prototype._setContent=function(j){var s=j&&j.getMetadata&&j.getMetadata().getName();var k=s==="sap.ui.vk.threejs.Scene"||s==="sap.ui.vk.svg.Scene";this.setScene(k?j:null);if(k&&j.builders){for(var i=0;i<j.builders.length;i++){j.builders[i]._fireThumbnailLoaded=function(r){var t=null;for(var n=0;n<this._viewItems.length;n++){if(this._viewItems[n].data("modelView")==r.modelView){t=this._viewItems[n];break;}}if(t){t.setSource(r.modelView.thumbnailData);}}.bind(this);}}this._attachAnimationTimeSlider(this.getAnimationTimeSlider());};
p.prototype.onSetContentConnector=function(i){i.attachContentReplaced(this._onContentReplaced,this);i.attachContentChangesStarted(this._onContentChangesStarted,this);i.attachContentLoadingFinished(this._onContentLoadingFinished,this);this._setContent(i.getContent());};
p.prototype.onUnsetContentConnector=function(i){this._setContent(null);i.detachContentChangesStarted(this._onContentChangesStarted,this);i.detachContentLoadingFinished(this._onContentLoadingFinished,this);i.detachContentReplaced(this._onContentReplaced,this);};
p.prototype._onContentChangesStarted=function(i){this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.setScene(null);};
p.prototype._onContentLoadingFinished=function(i){this._handleCdsViewGroupUpdate(i);};
p.prototype._onContentReplaced=function(i){this._setContent(i.getParameter("newContent"));};
p.prototype._handleCdsViewGroupUpdate=function(i){var j=i.getParameter("currentViewGroupId");if(this._modelViews&&this._modelViews.length){this._refreshItems();}else{this._refreshProcedures(j);}this._resetCurrentView();};
p.prototype._resetCurrentView=function(){if(this._viewManager){var j=this._viewManager.getActiveView();if(j&&this._viewItems){for(var i=0;i<this._viewItems.length;i++){var k=this._viewItems[i];var n=k.getCustomData()[0].getValue();if(n===j){if(this._selectedItem!==k){this.viewActivated(i);break;}}}}if(this._selectedGroupIndex!==-1){var r=this._getViewGroups();if(r&&r.length){this._procedureList.setSelectedKey(r[0].getViewGroupId());}}}};
return p;});
sap.ui.predefine('sap/ui/vk/ViewGalleryRenderer',[],function(){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.writeClasses();r.write(">");r.renderControl(c.getAggregation("animationTimeSlider"));r.renderControl(c.getAggregation("toolbar"));r.renderControl(c.getAggregation("container"));r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/ViewGalleryThumbnailRenderer',["./library","sap/ui/Device"],function(l,D){"use strict";var V={};
V.render=function(r,i){r.write("<div ");r.writeControlData(i);r.addStyle("height",i.getThumbnailHeight());r.addStyle("width",i.getThumbnailWidth());r.addStyle("background-image","url("+i.getSource()+")");r.writeStyles();r.addClass("sapVizKitViewGalleryThumbnail");r.writeClasses();r.writeAttribute("tabindex",0);var t=i.getTooltip();if(t){r.attr("title",t);}r.write(">");var a=i._getIndex()+1;if(a>0){r.write("<div class='sapVizKitViewGalleryStepNumberText'>");r.writeEscaped(a.toString());r.write("</div>");}r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/ViewGroup',["sap/ui/base/ManagedObject","./findIndexInArray"],function(M,f){"use strict";
var V=M.extend("sap.ui.vk.ViewGroup",{metadata:{properties:{viewGroupId:{type:"string"},name:{type:"string"},description:{type:"string"}},associations:{}}});
V.prototype.init=function(){this._views=[];};
V.prototype.exit=function(){this._views=null;};
V.prototype.getViews=function(){return this._views;};
V.prototype.addView=function(v){this._views.push(v);return this;};
V.prototype.insertView=function(v,i){if(i<0){i=0;}else if(i!==0&&i>=this._views.length){i=this._views.length;}this._views.splice(i,0,v);return this;};
V.prototype.indexOfView=function(v){return f(this._views,function(i){return i==v;});};
V.prototype.removeView=function(v){var i=this.indexOfView(v);if(i>=0){this._views.splice(i,1);}return this;};
V.prototype.removeViews=function(){if(this._views){this._views.splice(0);}return this;};
return V;});
sap.ui.predefine('sap/ui/vk/ViewManager',["sap/ui/core/Element","./Core","./Scene"],function(E,v,S){"use strict";
var V=E.extend("sap.ui.vk.ViewManager",{
metadata:{interfaces:["sap.ui.vk.IViewManager"],properties:{autoPlayAnimation:{type:"boolean",defaultValue:true},autoAdvanceViewTimeout:{type:"int",defaultValue:1000}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"},animationPlayer:{type:"sap.ui.vk.AnimationPlayer"}}},
constructor:function(i,s){E.apply(this,arguments);v.observeLifetime(this);v.observeAssociations(this);}
});
V.prototype._setScene=function(s){if(this._scene!==s){this._scene=s;if(this._scene){var i=s.getInitialView();if(i){this.activateView(i);}}}return this;};
V.prototype.getScene=function(){return this._scene;};
V.prototype.getActiveView=function(){return this._activeView;};
V.prototype.getNextView=function(a,b){var s=this.getScene();if(!b){b=s.findViewGroupByView(a);}var c;var i=-1;if(!b){c=s.getViews();i=c.indexOf(a);}else{c=b.getViews();i=b.indexOfView(a);}if(i<0){return undefined;}else if(i>=c.length-1){return undefined;}i++;return c[i];};
V.prototype._setContent=function(c){var s=null;if(c&&c instanceof S){s=c;}this._setScene(s);};
V.prototype.onSetContentConnector=function(c){c.attachContentReplaced(this._onContentReplaced,this);this._setContent(c.getContent());};
V.prototype.onUnsetContentConnector=function(c){this._setContent(null);c.detachContentReplaced(this._onContentReplaced,this);};
V.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"));};
V.prototype.activateView=function(a,n){return this._activateView(a,null,!this.getAutoPlayAnimation(),false,n);};
V.prototype.playViewGroup=function(a,b){this._cancelPlayingViewGroup=false;if(a===this.getActiveView()){var c=sap.ui.getCore().byId(this.getAnimationPlayer());if(c){if(c.getTime()>=c.getTotalDuration()){c.setTime(0);}}return this._autoPlay(a,b,false,true);}this._activateView(a,b,false,true);return this;};
V.prototype.stopPlayingViewGroup=function(){this._cancelPlayingViewGroup=true;var a=sap.ui.getCore().byId(this.getAnimationPlayer());if(a){a.stop();}};
V.prototype._autoPlay=function(a,b,s,c){var e=v.getEventBus();var d=sap.ui.getCore().byId(this.getAnimationPlayer());var f=function(){if(this._cancelPlayingViewGroup){return;}var n=this.getNextView(a,b);if(n){this._activateView(n,b,s,c);}else{e.publish("sap.ui.vk","procedureFinished");}}.bind(this);var o=function(h,i,j){if(j.source!==d){return;}if(j.stopped){e.unsubscribe("sap.ui.vk","animationPlayStateChanged",o,this);if(j.endOfAnimation){f();}}};var g=function(){if(c){if(d&&a.hasAnimation()){e.subscribe("sap.ui.vk","animationPlayStateChanged",o,this);}else{setTimeout(function(){f();},this.getAutoAdvanceViewTimeout());}}if((!s||c)&&a.hasAnimation()){if(d){d.play();}else{}}}.bind(this);g();};
V.prototype._activateView=function(a,b,s,c,n){var d=sap.ui.getCore().byId(this.getAnimationPlayer());if(d){d.stop();}this._cancelPlayingViewGroup=false;var t=this;return new Promise(function(r,e){var f=v.getEventBus();t._activeView=a;var o=function(g,h,i){f.unsubscribe("sap.ui.vk","readyForAnimation",o,t);if(i.view!==a){return;}if(t._cancelPlayingViewGroup){return;}t._autoPlay(a,b,s,c,true);r({view:i.view});return;};f.subscribe("sap.ui.vk","readyForAnimation",o,t);f.publish("sap.ui.vk","activateView",{source:t,view:a,notAnimateCameraChange:n,playViewGroup:c});});};
return V;});
sap.ui.predefine('sap/ui/vk/ViewStateManager',["sap/base/util/ObjectPath","./Scene","./ViewStateManagerBase"],function(O,S,V){"use strict";
var a=V.extend("sap.ui.vk.ViewStateManager",{metadata:{}});
var b=a.getMetadata().getParent().getClass().prototype;
a.prototype.init=function(){if(b.init){b.init.call(this);}this._implementation=null;};
a.prototype.exit=function(){this._destroyImplementation();if(b.exit){b.exit.call(this);}};
a.prototype._destroyImplementation=function(){if(this._implementation){this._implementation.destroy();this._implementation=null;}return this;};
a.prototype.getImplementation=function(){return this._implementation;};
a.prototype._setContent=function(c){var s=null;if(c&&c instanceof S){s=c;}this._setScene(s);return this;};
a.prototype._setScene=function(s){if(s&&s instanceof S){var c=s.getMetadata().getName(),i=this._implementation&&this._implementation.getMetadata().getName(),r=c==="sap.ui.vk.dvl.Scene"&&i==="sap.ui.vk.dvl.ViewStateManager"||c==="sap.ui.vk.threejs.Scene"&&i==="sap.ui.vk.threejs.ViewStateManager"||c==="sap.ui.vk.svg.Scene"&&i==="sap.ui.vk.svg.ViewStateManager";if(!r){this._destroyImplementation();var n;if(c==="sap.ui.vk.dvl.Scene"){n="sap.ui.vk.dvl.ViewStateManager";}else if(c==="sap.ui.vk.threejs.Scene"){n="sap.ui.vk.threejs.ViewStateManager";}else if(c==="sap.ui.vk.svg.Scene"){n="sap.ui.vk.svg.ViewStateManager";}if(n){var t=this;var C=O.get(n);this._implementation=new C({shouldTrackVisibilityChanges:this.getShouldTrackVisibilityChanges(),recursiveSelection:this.getRecursiveSelection(),contentConnector:this.getContentConnector(),viewManager:this.getViewManager(),visibilityChanged:function(e){t.fireVisibilityChanged({visible:e.getParameter("visible"),hidden:e.getParameter("hidden")});},selectionChanged:function(e){t.fireSelectionChanged({selected:e.getParameter("selected"),unselected:e.getParameter("unselected")});},outliningChanged:function(e){t.fireOutliningChanged({outlined:e.getParameter("outlined"),unoutlined:e.getParameter("unoutlined")});},opacityChanged:function(e){t.fireOpacityChanged({changed:e.getParameter("changed"),opacity:e.getParameter("opacity")});},tintColorChanged:function(e){t.fireTintColorChanged({changed:e.getParameter("changed"),tintColor:e.getParameter("tintColor"),tintColorABGR:e.getParameter("tintColorABGR")});},nodeHierarchyReplaced:function(e){t.fireNodeHierarchyReplaced({oldNodeHierarchy:e.getParameter("oldNodeHierarchy"),newNodeHierarchy:e.getParameter("newNodeHierarchy")});},viewStateApplying:function(e){t.fireViewStateApplying({view:e.getParameter("view")});},viewStateApplied:function(e){t.fireViewStateApplied({view:e.getParameter("view")});},transformationChanged:function(e){t.fireTransformationChanged(e.getParameters());},highlightColorChanged:function(e){t.fireHighlightColorChanged(e.getParameters());}});var v=sap.ui.getCore().byId(this.getViewManager());if(v){var d=sap.ui.getCore().byId(v.getAnimationPlayer());if(d){d.setViewStateManager(this._implementation);}}}}}else{this._destroyImplementation();}return this;};
a.prototype.getAnimationPlayer=function(){var c;var v=sap.ui.getCore().byId(this.getViewManager());if(v){c=sap.ui.getCore().byId(v.getAnimationPlayer());}return c;};
a.prototype.getNodeHierarchy=function(){return this._implementation&&this._implementation.getNodeHierarchy();};
a.prototype.getVisibilityChanges=function(){return this._implementation&&this._implementation.getVisibilityChanges();};
a.prototype.getVisibilityComplete=function(){return this._implementation&&this._implementation.getVisibilityComplete();};
a.prototype.getVisibilityState=function(n){return this._implementation&&this._implementation.getVisibilityState(n);};
a.prototype.setVisibilityState=function(n,v,r){if(this._implementation){this._implementation.setVisibilityState(n,v,r);}return this;};
a.prototype.resetVisibility=function(){return this._implementation&&this._implementation.resetVisibility();};
a.prototype.enumerateSelection=function(c){if(this._implementation){this._implementation.enumerateSelection(c);}return this;};
a.prototype.enumerateOutlinedNodes=function(c){if(this._implementation&&this._implementation.enumerateOutlinedNodes){this._implementation.enumerateOutlinedNodes(c);}return this;};
a.prototype.setShowSelectionBoundingBox=function(v){if(this._implementation){this._implementation.setShowSelectionBoundingBox(v);}};
a.prototype.getShowSelectionBoundingBox=function(){if(this._implementation){return this._implementation.getShowSelectionBoundingBox();}};
a.prototype.getSelectionState=function(n){return this._implementation&&this._implementation.getSelectionState(n);};
a.prototype.setSelectionState=function(n,s,r){if(this._implementation){this._implementation.setSelectionState(n,s,r);}return this;};
a.prototype.setSelectionStates=function(s,u,r){if(this._implementation){this._implementation.setSelectionStates(s,u,r);}return this;};
a.prototype.getOutliningState=function(n){if(this._implementation&&this._implementation.getOutliningState){return this._implementation.getOutliningState(n);}else{return false;}};
a.prototype.setOutliningStates=function(o,u,r){if(this._implementation&&this._implementation.setOutliningStates){this._implementation.setOutliningStates(o,u,r);}return this;};
a.prototype.getJoints=function(){if(this._implementation&&this._implementation.getJoints){return this._implementation.getJoints();}return undefined;};
a.prototype.setJoints=function(j,p){if(this._implementation&&this._implementation.setJoints){this._implementation.setJoints(j,p);}return this;};
a.prototype.getOpacity=function(n){return this._implementation&&this._implementation.getOpacity(n);};
a.prototype.setOpacity=function(n,o,r){if(this._implementation){this._implementation.setOpacity(n,o,r);}return this;};
a.prototype.getTotalOpacity=function(n){if(this._implementation&&this._implementation.getTotalOpacity){return this._implementation.getTotalOpacity(n);}return 1;};
a.prototype.setTotalOpacity=function(n,t){if(this._implementation&&this._implementation.setTotalOpacity){return this._implementation.setTotalOpacity(n,t);}return null;};
a.prototype.getRestOpacity=function(n){if(this._implementation&&this._implementation.getRestOpacity){return this._implementation.getRestOpacity(n);}return null;};
a.prototype.setRestOpacity=function(n,o){if(this._implementation&&this._implementation.setRestOpacity){this._implementation.setRestOpacity(n,o);}return this;};
a.prototype.restoreRestOpacity=function(n){if(this._implementation&&this._implementation.restoreRestOpacity){this._implementation.restoreRestOpacity(n);}return this;};
a.prototype.updateRestOpacity=function(n){if(this._implementation&&this._implementation.updateRestOpacity){this._implementation.updateRestOpacity(n);}return this;};
a.prototype.getTintColor=function(n,i){return this._implementation&&this._implementation.getTintColor(n,i);};
a.prototype.setTintColor=function(n,t,r){if(this._implementation){this._implementation.setTintColor(n,t,r);}return this;};
a.prototype.setHighlightColor=function(c){if(this._implementation&&this._implementation.setHighlightColor){this._implementation.setHighlightColor(c);}return this;};
a.prototype.getHighlightColor=function(i){if(this._implementation&&this._implementation.getHighlightColor){return this._implementation.getHighlightColor(i);}};
a.prototype.setOutlineColor=function(c){if(this._implementation&&this._implementation.setOutlineColor){this._implementation.setOutlineColor(c);}return this;};
a.prototype.getOutlineColor=function(i){if(this._implementation&&this._implementation.getOutlineColor){return this._implementation.getOutlineColor(i);}else{return null;}};
a.prototype.setOutlineWidth=function(w){if(this._implementation&&this._implementation.setOutlineWidth){this._implementation.setOutlineWidth(w);}return this;};
a.prototype.getOutlineWidth=function(){if(this._implementation&&this._implementation.getOutlineWidth){return this._implementation.getOutlineWidth();}else{return 0.0;}};
a.prototype.setRecursiveOutlining=function(p){this.setProperty("recursiveOutlining",p,true);if(this._implementation&&this._implementation.setRecursiveOutlining){this._implementation.setRecursiveOutlining(p);}return this;};
a.prototype.setRecursiveSelection=function(p){this.setProperty("recursiveSelection",p,true);if(this._implementation){this._implementation.setRecursiveSelection(p);}return this;};
a.prototype.setHighlightDisplayState=function(s){if(this._implementation&&this._implementation.setHighlightDisplayState){this._implementation.setHighlightDisplayState(s);}return this;};
a.prototype.setTransformation=function(n,t){if(this._implementation&&this._implementation.setTransformation){this._implementation.setTransformation(n,t);}return this;};
a.prototype.getTransformation=function(n){if(this._implementation&&this._implementation.getTransformation){return this._implementation.getTransformation(n);}return null;};
a.prototype.getTransformationWorld=function(n){if(this._implementation&&this._implementation.getTransformationWorld){return this._implementation.getTransformationWorld(n);}return null;};
a.prototype.getRestTransformationWorld=function(n){if(this._implementation&&this._implementation.getRestTransformationWorld){return this._implementation.getRestTransformationWorld(n);}return null;};
a.prototype.getRestTransformationUsingJoint=function(n){if(this._implementation&&this._implementation.getRestTransformationUsingJoint){return this._implementation.getRestTransformationUsingJoint(n);}return null;};
a.prototype.updateRestTransformation=function(n){if(this._implementation&&this._implementation.updateRestTransformation){this._implementation.updateRestTransformation(n);}return this;};
a.prototype.restoreRestTransformation=function(n){if(this._implementation&&this._implementation.restoreRestTransformation){this._implementation.restoreRestTransformation(n);}return this;};
a.prototype.setRestTransformation=function(n,t,q,s){if(this._implementation&&this._implementation.setRestTransformation){this._implementation.setRestTransformation(n,t,q,s);}return this;};
a.prototype.getRelativeTransformation=function(n){if(this._implementation&&this._implementation.getRelativeTransformation){return this._implementation.getRelativeTransformation(n);}return null;};
a.prototype.getRestTransformation=function(n){if(this._implementation&&this._implementation.getRestTransformation){return this._implementation.getRestTransformation(n);}return null;};
a.prototype.setInterpolatedRelativeValues=function(n,v){if(this._implementation&&this._implementation.setInterpolatedRelativeValues){return this._implementation.setInterpolatedRelativeValues(n,v);}return null;};
a.prototype._getEndPropertyInLastPlayback=function(n,p){if(this._implementation&&this._implementation._getEndPropertyInLastPlayback){return this._implementation._getEndPropertyInLastPlayback(n,p);}return null;};
a.prototype._getEndPropertyInPreviousPlayback=function(n,p,c){if(this._implementation&&this._implementation._getEndPropertyInPreviousPlayback){return this._implementation._getEndPropertyInPreviousPlayback(n,p,c);}return null;};
a.prototype._convertTracksToRelative=function(s){if(this._implementation&&this._implementation._convertTracksToRelative){this._implementation._convertTracksToRelative(s);}return this;};
a.prototype._setJointNodeOffsets=function(n,t){if(this._implementation&&this._implementation._setJointNodeOffsets){this._implementation._setJointNodeOffsets(n,t);}return this;};
a.prototype._setJointNodeMatrix=function(){if(this._implementation&&this._implementation._setJointNodeMatrix){this._implementation._setJointNodeMatrix();}return this;};
a.prototype._propagateOpacityToJointChildren=function(n,o){if(this._implementation&&this._implementation._propagateOpacityToJointChildren){this._implementation._propagateOpacityToJointChildren(n,o);}return this;};
a.prototype.setTranslationKey=function(n,t,p,c){if(this._implementation&&this._implementation.setTranslationKey){this._implementation.setTranslationKey(n,t,p,c);}return this;};
a.prototype.setScaleKey=function(n,t,p,c){if(this._implementation&&this._implementation.setScaleKey){this._implementation.setScaleKey(n,t,p,c);}return this;};
a.prototype.setRotationKey=function(n,t,e,p,c){if(this._implementation&&this._implementation.setRotationKey){this._implementation.setRotationKey(n,t,e,p,c);}return this;};
a.prototype.setOpacityKey=function(n,t,p,c){if(this._implementation&&this._implementation.setOpacityKey){this._implementation.setOpacityKey(n,t,p,c);}return this;};
a.prototype.getSymbolNodes=function(n){if(this._implementation&&this._implementation.getSymbolNodes){return this._implementation.getSymbolNodes(n);}return[];};
a.prototype.getBackgroundImageType=function(){if(this._implementation&&this._implementation.getBackgroundImageType){return this._implementation.getBackgroundImageType();}return null;};
a.prototype.setBackgroundImageType=function(i){if(this._implementation&&this._implementation.setBackgroundImageType){return this._implementation.setBackgroundImageType(i);}return undefined;};
return a;});
sap.ui.predefine('sap/ui/vk/ViewStateManagerBase',["sap/ui/core/Element","./Core"],function(E,v){"use strict";
var V=E.extend("sap.ui.vk.ViewStateManagerBase",{
metadata:{"abstract":true,properties:{shouldTrackVisibilityChanges:{type:"boolean",defaultValue:false},recursiveSelection:{type:"boolean",defaultValue:false},recursiveOutlining:{type:"boolean",defaultValue:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"},viewManager:{type:"sap.ui.vk.ViewManager"}},events:{visibilityChanged:{parameters:{visible:{type:"any[]"},hidden:{type:"any[]"}},enableEventBubbling:true},selectionChanged:{parameters:{selected:{type:"any[]"},unselected:{type:"any[]"}},enableEventBubbling:true},outliningChanged:{parameters:{outlined:{type:"any[]"},unoutlined:{type:"any[]"}},enableEventBubbling:true},opacityChanged:{parameters:{changed:{type:"any[]"},opacity:{type:"any"}},enableEventBubbling:true},tintColorChanged:{parameters:{changed:{type:"any[]"},tintColor:{type:"any"},tintColorABGR:{type:"any"}},enableEventBubbling:true},nodeHierarchyReplaced:{parameters:{oldNodeHierarchy:{type:"sap.ui.vk.NodeHierarchy"},newNodeHierarchy:{type:"sap.ui.vk.NodeHierarchy"}}},highlightColorChanged:{parameters:{highlightColor:{type:"sap.ui.core.CSSColor"},highlightColorABGR:{type:"int"}},enableEventBubbling:true},transformationChanged:{parameters:{changed:{type:"any"},transformation:{type:"any"}}},viewStateApplying:{parameters:{view:{type:"sap.ui.vk.View"}}},viewStateApplied:{parameters:{view:{type:"sap.ui.vk.View"}}},readyForAnimation:{parameters:{view:{type:"sap.ui.vk.View"}}},outlineColorChanged:{parameters:{outlineColor:{type:"sap.ui.core.CSSColor"},outlineColorABGR:{type:"int"}},enableEventBubbling:true},outlineWidthChanged:{parameters:{width:{type:"float"}},enableEventBubbling:true}}},
constructor:function(i,s){E.apply(this,arguments);v.observeLifetime(this);v.observeAssociations(this);}
});
V.prototype.onSetContentConnector=function(c){c.attachContentReplaced(this._onContentReplaced,this);this._setContent(c.getContent());};
V.prototype.onUnsetContentConnector=function(c){c.detachContentReplaced(this._onContentReplaced,this);this._setContent(null);};
V.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"));};
V.prototype._setContent=function(c){return this;};
return V;});
sap.ui.predefine('sap/ui/vk/ViewerRenderer',[],function(){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewer");r.writeClasses();if(c.getWidth()){r.addStyle("width",c.getWidth());}if(c.getHeight()){r.addStyle("height",c.getHeight());}r.writeStyles();r.write(">");r.renderControl(c._layout);r.renderControl(c._progressIndicator);r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/Viewport',["sap/base/util/ObjectPath","./ViewportBase","./ViewStateManager","./ViewportRenderer","./VisibilityMode","./RenderMode","./Scene","./Camera","sap/base/Log"],function(O,V,a,b,d,R,S,C,L){"use strict";
var e=V.extend("sap.ui.vk.Viewport",{metadata:{library:"sap.ui.vk",designtime:"sap/ui/vk/designtime/Viewport.designtime"}});
var f=e.getMetadata().getParent().getClass().prototype;
e.prototype.init=function(){if(f.init){f.init.call(this);}this._implementation=null;};
e.prototype.exit=function(){this._destroyImplementation();if(f.exit){f.exit.call(this);}};
e.prototype.getImplementation=function(){return this._implementation;};
e.prototype._destroyImplementation=function(){if(this._implementation){var m=this.removeAllContent();var t=this;m.forEach(function(c){t.addAggregation("content",c);});this.setAggregation("safeArea",this._implementation.getSafeArea());this._implementation.destroy();this._implementation=null;}return this;};
e.prototype.getShowDebugInfo=function(){if(this._implementation){return this._implementation.getShowDebugInfo();}return f.getShowDebugInfo.call(this);};
e.prototype.setShowDebugInfo=function(v){f.setShowDebugInfo.call(this,v);if(this._implementation){this._implementation.setShowDebugInfo(v);}return this;};
e.prototype.getBackgroundColorTop=function(){if(this._implementation){return this._implementation.getBackgroundColorTop();}return f.getBackgroundColorTop.call(this);};
e.prototype.setBackgroundColorTop=function(v){f.setBackgroundColorTop.call(this,v);if(this._implementation){this._implementation.setBackgroundColorTop(v);}return this;};
e.prototype.getBackgroundColorBottom=function(){if(this._implementation){return this._implementation.getBackgroundColorBottom();}return f.getBackgroundColorBottom.call(this);};
e.prototype.setBackgroundColorBottom=function(v){f.setBackgroundColorBottom.call(this,v);if(this._implementation){this._implementation.setBackgroundColorBottom(v);}return this;};
e.prototype.setWidth=function(v){f.setWidth.call(this,v);if(this._implementation){this._implementation.setWidth(v);}return this;};
e.prototype.setHeight=function(v){f.setHeight.call(this,v);if(this._implementation){this._implementation.setHeight(v);}return this;};
e.prototype.setSelectionMode=function(v){this.setProperty("selectionMode",v,true);if(this._implementation){this._implementation.setProperty("selectionMode",v,true);}return this;};
e.prototype.getSelectionMode=function(){if(this._implementation){return this._implementation.getSelectionMode();}return f.getSelectionMode.call(this);};
e.prototype.setSelectionDisplayMode=function(v){f.setSelectionDisplayMode.call(this,v);if(this._implementation){this._implementation.setSelectionDisplayMode(v);}return this;};
e.prototype.getSelectionDisplayMode=function(){if(this._implementation){return this._implementation.getSelectionDisplayMode();}return f.getSelectionDisplayMode.call(this);};
e.prototype.setShowSelectionBoundingBoxes=function(v){f.setShowSelectionBoundingBoxes.call(this,v);if(this._implementation){this._implementation.setShowSelectionBoundingBoxes(v);}return this;};
e.prototype.getShowSelectionBoundingBoxes=function(){if(this._implementation){return this._implementation.getShowSelectionBoundingBoxes();}return f.getShowSelectionBoundingBoxes.call(this);};
e.prototype.setShowSafeArea=function(v){f.setShowSafeArea.call(this,v);if(this._implementation){this._implementation.setShowSafeArea(v);}return this;};
e.prototype.getShowSafeArea=function(){if(this._implementation){return this._implementation.getShowSafeArea();}return f.getShowSafeArea.call(this);};
e.prototype.setShowAllHotspots=function(v){f.setShowAllHotspots.call(this,v);if(this._implementation){this._implementation.setShowAllHotspots(v);}return this;};
e.prototype.getShowAllHotspots=function(){if(this._implementation){return this._implementation.getShowAllHotspots();}return f.getShowAllHotspots.call(this);};
e.prototype.setDisableHotspotHovering=function(v){f.setDisableHotspotHovering.call(this,v);if(this._implementation){this._implementation.setDisableHotspotHovering(v);}return this;};
e.prototype.getDisableHotspotHovering=function(){if(this._implementation){return this._implementation.getDisableHotspotHovering();}return f.getDisableHotspotHovering.call(this);};
e.prototype.setHotspotColorABGR=function(v){f.setHotspotColorABGR.call(this,v);if(this._implementation){this._implementation.setHotspotColorABGR(v);}return this;};
e.prototype.getHotspotColorABGR=function(){if(this._implementation){return this._implementation.getHotspotColorABGR();}return f.getHotspotColorABGR.call(this);};
e.prototype.setHotspotColor=function(v){f.setHotspotColor.call(this,v);if(this._implementation){this._implementation.setHotspotColor(v);}return this;};
e.prototype.getHotspotColor=function(){if(this._implementation){return this._implementation.getHotspotColor();}return f.getHotspotColor.call(this);};
e.prototype.setCamera=function(v){f.setCamera.call(this,v);if(this._implementation){this._implementation.setCamera(v);return this;}return this;};
e.prototype.getCamera=function(){if(this._implementation){return this._implementation.getCamera();}return f.getCamera.call(this);};
e.prototype.setShouldRenderFrame=function(){if(this._implementation){this._implementation.setShouldRenderFrame();}return this;};
e.prototype.shouldRenderFrame=function(){if(this._implementation){this._implementation.shouldRenderFrame();}};
e.prototype.setRenderMode=function(v){if(this._implementation&&this._implementation.setRenderMode){this._implementation.setRenderMode(v);}return this;};
e.prototype.getRenderMode=function(){if(this._implementation&&this._implementation.getRenderMode){return this._implementation.getRenderMode();}return R.Default;};
e.prototype.setFreezeCamera=function(v){f.setFreezeCamera.call(this,v);if(this._implementation){this._implementation.setFreezeCamera(v);}return this;};
e.prototype.showHotspots=function(n,c,m){if(this._implementation&&this._implementation.showHotspots){this._implementation.showHotspots(n,c,m);}return this;};
e.prototype.addTool=function(t){this.addAssociation("tools",t);if(this._implementation){this._implementation.addTool(t);}};
e.prototype.removeTool=function(t){this.removeAssociation("tools",t);if(this._implementation){this._implementation.removeTool(t);}};
e.prototype.getTools=function(){if(this._implementation){return this._implementation.getTools();}return this.getAssociation("tools",[]);};
e.prototype.removeAllTools=function(){this.removeAllAssociation("tools");if(this._implementation){this._implementation.removeAllTools();}};
e.prototype.addContent=function(c){if(this._implementation){this._implementation.addContent(c);}else{this.addAggregation("content",c);}};
e.prototype.removeContent=function(c){if(this._implementation){return this._implementation.removeContent(c);}return this.removeAggregation("content",c);};
e.prototype.getContent=function(){if(this._implementation){return this._implementation.getContent();}return this.getAggregation("content");};
e.prototype.removeAllContent=function(){if(this._implementation){return this._implementation.removeAllContent();}return this.removeAggregation("content");};
e.prototype.setSafeArea=function(c){if(this._implementation){this._implementation.setSafeArea(c);}else{this.setAggregation("safeArea",c);}};
e.prototype.getSafeArea=function(){if(this._implementation){return this._implementation.getSafeArea();}return this.getAggregation("safeArea");};
e.prototype.removeSafeArea=function(){if(this._implementation){return this._implementation.removeAggregation("safeArea");}return this.removeAggregation("safeArea");};
e.prototype.addAnnotation=function(c){if(this._implementation){this._implementation.addAnnotation(c);}else{this.addAggregation("annotations",c);}};
e.prototype.destroyAnnotations=function(){if(this._implementation){return this._implementation.destroyAnnotations();}return this.destroyAggregation("annotations");};
e.prototype.getAnnotations=function(){if(this._implementation){return this._implementation.getAnnotations();}return this.getAggregation("annotations");};
e.prototype.getSymbolNodes=function(n){if(this._implementation&&this._implementation.getSymbolNodes){return this._implementation.getSymbolNodes(n);}return[];};
e.prototype.indexOfAnnotation=function(c){if(this._implementation){return this._implementation.indexOfAnnotation(c);}return this.indexOfAggregation("annotations",c);};
e.prototype.removeAllAnnotations=function(){if(this._implementation){return this._implementation.removeAllAnnotations();}return this.removeAggregation("annotations");};
e.prototype.removeAnnotation=function(c){if(this._implementation){return this._implementation.removeAnnotation(c);}return this.removeAggregation("annotations",c);};
e.prototype.insertAnnotation=function(c,m){if(this._implementation){return this._implementation.insertAnnotation(c,m);}return this.insertAggregation("annotations",c,m);};
e.prototype.startAnimation=function(p){if(this._implementation&&this._implementation.startAnimation){this._implementation.startAnimation(p);}};
e.prototype.stopAnimation=function(){if(this._implementation&&this._implementation.stopAnimation){this._implementation.stopAnimation();}};
e.prototype.playProcedure=function(m,v,n){if(this._implementation&&this._implementation.playProcedure){this._implementation.playProcedure(m,v,n);}};
e.prototype.getCurrentView=function(){if(this._implementation&&this._implementation.getCurrentView){return this._implementation.getCurrentView();}return null;};
e.prototype.pan=function(c,m){if(this._implementation&&this._implementation.pan){this._implementation.pan(c,m);}};
e.prototype.rotate=function(c,m){if(this._implementation&&this._implementation.rotate){this._implementation.rotate(c,m);}};
e.prototype.zoom=function(c){if(this._implementation&&this._implementation.zoom){this._implementation.zoom(c);}};
e.prototype.pauseAnimation=function(){if(this._implementation&&this._implementation.pauseAnimation){return this._implementation.pauseAnimation();}};
e.prototype.resumeAnimation=function(){if(this._implementation&&this._implementation.resumeAnimation){return this._implementation.resumeAnimation();}};
e.prototype.handleDragAnimation=function(c){if(this._implementation&&this._implementation.handleDragAnimation){this._implementation.handleDragAnimation(c);}};
e.prototype.handleCompleteDraggingAnimation=function(c){if(this._implementation&&this._implementation.handleCompleteDraggingAnimation){this._implementation.handleCompleteDraggingAnimation(c);}};
e.prototype.AddHandlersToAnimationSequenceEvents=function(c){if(this._implementation&&this._implementation.AddHandlersToAnimationSequenceEvents){this._implementation.AddHandlersToAnimationSequenceEvents(c);}};
e.prototype._setContent=function(c){var m=null;var n=null;if(c){m=c;if(!(m instanceof S)){m=null;}n=c.camera;if(!(n instanceof C)){n=null;}}this._setScene(m);if(n){this.setCamera(n);}return this;};
e.prototype._setScene=function(c){if(c instanceof S){var m=c.getMetadata().getName(),n=this._implementation&&this._implementation.getMetadata().getName(),r=m==="sap.ui.vk.dvl.Scene"&&n==="sap.ui.vk.dvl.Viewport"||m==="sap.ui.vk.threejs.Scene"&&n==="sap.ui.vk.threejs.Viewport"||m==="sap.ui.vk.svg.Scene"&&n==="sap.ui.vk.svg.Viewport";if(!r){this._destroyImplementation();var o;var p=this.getCamera();if(m==="sap.ui.vk.dvl.Scene"){o="sap.ui.vk.dvl.Viewport";}else if(m==="sap.ui.vk.threejs.Scene"){o="sap.ui.vk.threejs.Viewport";}else if(m==="sap.ui.vk.svg.Scene"){o="sap.ui.vk.svg.Viewport";}if(o){var q=O.get(o);this._implementation=new q({viewStateManager:this.getViewStateManager(),tools:this.getAssociation("tools"),content:this.getContent(),safeArea:this.getSafeArea(),showSafeArea:this.getShowSafeArea(),showAllHotspots:this.getShowAllHotspots(),disableHotspotHovering:this.getDisableHotspotHovering(),hotspotColorABGR:this.getHotspotColorABGR(),showDebugInfo:this.getShowDebugInfo(),width:this.getWidth(),height:this.getHeight(),backgroundColorTop:this.getBackgroundColorTop(),backgroundColorBottom:this.getBackgroundColorBottom(),selectionMode:this.getSelectionMode(),selectionDisplayMode:this.getSelectionDisplayMode(),showSelectionBoundingBoxes:this.getShowSelectionBoundingBoxes(),freezeCamera:this.getFreezeCamera(),renderMode:this.getRenderMode()});this._implementation.setContentConnector(this.getContentConnector());var t=this.getAggregation("annotations");if(t){t.forEach(function(u){this.removeAggregation("annotations",u);this._implementation.addAnnotation(u);},this);}if(p){this._camera=null;this._implementation.setCamera(p);}this._implementation.setParent(this);}this.invalidate();}}else{this._destroyImplementation();this.invalidate();}return this;};
e.prototype.onSetViewStateManager=function(v){if(this._implementation){this._implementation.setViewStateManager(v);}};
e.prototype.onUnsetViewStateManager=function(v){if(this._implementation){this._implementation.setViewStateManager(null);}};
e.prototype.activateView=function(v,p,n){if(this._implementation){this._implementation.activateView(v,p,n);return this;}else{L.error("no implementation");return this;}};
e.prototype.resetCurrentView=function(){if(this._implementation&&this._implementation.resetCurrentView){this._implementation.resetCurrentView();return this;}else{L.error("no implementation");return this;}};
e.prototype.zoomTo=function(w,n,c,m){if(this._implementation){this._implementation.zoomTo(w,n,c,m);}else{L.error("zoomTo: no implementation");}return this;};
e.prototype.tap=function(x,y,c){if(this._implementation){this._implementation.tap(x,y,c);}return this;};
e.prototype.tapObject=function(n){if(this._implementation&&this._implementation.tapObject){this._implementation.tapObject(n);}return this;};
var s=function(c){c.camera={};};var g=function(c){if(typeof c.camera==="object"&&c.camera!==null){c.camera.matrices=false;}};var h=function(c){if(typeof c.camera==="object"&&c.camera!==null){c.camera.useTransitionCamera=false;}};var i=function(c){c.animation=true;};var j=function(c){c.visibility=false;};var k=function(c){if(typeof c.visibility==="object"&&c.visibility!==null){c.visibility.mode=d.Complete;}};var l=function(c){c.selection=false;};
e.prototype.getViewInfo=function(q){if(!this._implementation){L.error("no implementation");return null;}var c={};if(typeof q!=="object"||q===null){s(c);g(c);h(c);i(c);j(c);k(c);l(c);}else{if(typeof q.camera==="object"&&q.camera!==null){c.camera={};if(typeof q.camera.matrices==="boolean"){c.camera.matrices=q.camera.matrices;}else if("matrices"in q.camera){c.camera.matrices=false;}else{g(c);}if(typeof q.camera.useTransitionCamera==="boolean"){c.camera.useTransitionCamera=q.camera.useTransitionCamera;}else if("useTransitionCamera"in q.camera){c.camera.useTransitionCamera=false;}else{h(c);}}else if(typeof q.camera==="boolean"){if(q.camera===true){c.camera={};g(c);h(c);}else{c.camera=false;}}else if("camera"in q){c.camera=false;}else{s(c);g(c);h(c);}if(typeof q.animation==="boolean"){c.animation=q.animation;}else if("animation"in q){c.animation=false;}else{i(c);}if(typeof q.visibility==="object"&&q.visibility!==null){c.visibility={};if(q.visibility.mode===d.Complete||q.visibility.mode===d.Differences){c.visibility.mode=q.visibility.mode;}else{k(c);}}else if(typeof q.visibility==="boolean"){if(q.visibility===true){c.visibility={};k(c);}else{c.visibility=false;}}else if("visibility"in q){c.visibility=false;}else{j(c);k(c);}if(typeof q.selection==="boolean"){c.selection=q.selection;}else if("selection"in q){c.selection=false;}else{l(c);}}return this._implementation.getViewInfo(c);};
e.prototype.setViewInfo=function(v,c){if(this._implementation){this._implementation.setViewInfo(v,c);}else{L.error("no implementation");}return this;};
e.prototype.getImage=function(w,c,t,m,n){if(this._implementation&&this._implementation.getImage){return this._implementation.getImage(w,c,t,m,n);}return null;};
e.prototype.projectToScreen=function(x,y,z,c){if(this._implementation&&this._implementation.projectToScreen){return this._implementation.projectToScreen(x,y,z,c);}return f.projectToScreen(x,y,z,c);};
e.prototype.normalizeRectangle=function(x,y,w,c){if(this._implementation&&this._implementation.normalizeRectangle){return this._implementation.normalizeRectangle(x,y,w,c);}return f.normalizeRectangle(x,y,w,c);};
e.prototype.deNormalizeRectangle=function(x,y,w,c){if(this._implementation&&this._implementation.deNormalizeRectangle){return this._implementation.deNormalizeRectangle(x,y,w,c);}return f.deNormalizeRectangle(x,y,w,c);};
return e;});
sap.ui.predefine('sap/ui/vk/ViewportBase',["sap/ui/core/Control","sap/ui/core/Core","./tools/Tool","./library","./Core","./SelectionMode","./SelectionDisplayMode","./RenderMode","./SafeArea"],function(C,c,T,v,a,S,b,R,d){"use strict";
var V=C.extend("sap.ui.vk.ViewportBase",{
metadata:{library:"sap.ui.vk","abstract":true,properties:{showDebugInfo:{type:"boolean",defaultValue:false},backgroundColorTop:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(50, 50, 50, 1)"},backgroundColorBottom:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 255, 255, 1)"},width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},selectionMode:{type:"sap.ui.vk.SelectionMode",defaultValue:S.Sticky},selectionDisplayMode:{type:"sap.ui.vk.SelectionDisplayMode",defaultValue:b.Highlight},showSelectionBoundingBoxes:{type:"boolean",defaultValue:true},freezeCamera:{type:"boolean",defaultValue:false},renderMode:{type:"sap.ui.vk.RenderMode",defaultValue:R.Default},showSafeArea:{type:"boolean",defaultValue:false},showAllHotspots:{type:"boolean",defaultValue:false},disableHotspotHovering:{type:"boolean",defaultValue:false},hotspotColorABGR:{type:"int",defaultValue:0xc00000ff},hotspotColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 0, 0, 0.7529411764705882)"}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false},tools:{type:"sap.ui.vk.tools.Tool",multiple:true}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true},safeArea:{type:"sap.ui.vk.SafeArea",multiple:false},annotations:{type:"sap.ui.vk.Annotation",multiple:true}},events:{urlClicked:{parameters:{nodeRef:"any",url:"string"},enableEventBubbling:true},nodeClicked:{parameters:{nodeRef:"any",x:"int",y:"int"},enableEventBubbling:true},resize:{parameters:{size:"object"},enableEventBubbling:true},nodesPicked:{parameters:{picked:{type:"any[]"}},enableEventBubbling:true},nodeZoomed:{parameters:{zoomed:{type:"any"},isZoomIn:{type:"boolean"}},enableEventBubbling:true},viewActivated:{parameters:{viewIndex:"int",view:"sap.ui.vk.View",type:{type:"string"}},enableEventBubbling:true},procedureFinished:{enableEventBubbling:true},viewFinished:{parameters:{viewIndex:"int"},enableEventBubbling:true}}},
constructor:function(i,s){C.apply(this,arguments);a.observeAssociations(this);}
});
var e=V.getMetadata().getParent().getClass().prototype;
V.prototype.init=function(){if(e.init){e.init.call(this);}if(this.getSafeArea()==null){this.setSafeArea(new d());}this._camera=null;};
V.prototype.exit=function(){if(this._camera){var f=c.byId(this.getContentConnector());if(f){var g=f.getContentManager();if(g){g.destroyCamera(this._camera);}this._camera=null;}}if(e.exit){e.exit.call(this);}};
V.prototype.onSetContentConnector=function(f){f.attachContentReplaced(this._onContentReplaced,this);this._setContent(f.getContent());};
V.prototype.onUnsetContentConnector=function(f){f.detachContentReplaced(this._onContentReplaced,this);this._setContent(null);this.setCamera(null);};
V.prototype._onContentReplaced=function(f){this._setContent(f.getParameter("newContent"));};
V.prototype._setContent=function(f){return this;};
V.prototype.addTool=function(t){this.addAssociation("tools",t);t=t instanceof T?t:sap.ui.getCore().byId(t);t.setViewport(this);};
V.prototype.getImage=function(w,h){return null;};
V.prototype.stickySelectionHandler=function(n){if(this._viewStateManager==null){return;}if(n.length===0){var f=[];if(this.getSelectionDisplayMode()===b.Outline){this._viewStateManager.enumerateOutlinedNodes(function(j){f.push(j);});if(f.length>0){this._viewStateManager.setOutliningStates([],f);}}else{this._viewStateManager.enumerateSelection(function(j){f.push(j);});if(f.length>0){this._viewStateManager.setSelectionStates([],f);}}}else{var s=[];var g=[];var i,h;if(this.getSelectionDisplayMode()===b.Outline){i=this._viewStateManager.getOutliningState(n);for(h=0;h<i.length;h++){if(i[h]){g.push(n[h]);}else{s.push(n[h]);}}this._viewStateManager.setOutliningStates(s,g);}else{i=this._viewStateManager.getSelectionState(n);for(h=0;h<i.length;h++){if(i[h]){g.push(n[h]);}else{s.push(n[h]);}}this._viewStateManager.setSelectionStates(s,g);}}};
V.prototype.exclusiveSelectionHandler=function(n){if(this._viewStateManager==null){return;}var f=true;if(n.length===1){f=!this._viewStateManager.getSelectionState(n[0]);}else if(n.length>1){var i;if(this.getSelectionDisplayMode()===b.Outline){i=this._viewStateManager.getOutliningState(n);}else{i=this._viewStateManager.getSelectionState(n);}for(var g=0;g<i.length;g++){if(i[g]){f=false;break;}}}var u=[];if(n.length===0||f){if(this.getSelectionDisplayMode()===b.Outline){this._viewStateManager.enumerateOutlinedNodes(function(s){u.push(s);});}else{this._viewStateManager.enumerateSelection(function(s){u.push(s);});}}if(this.getSelectionDisplayMode()===b.Outline){this._viewStateManager.setOutliningStates(n,u);}else{this._viewStateManager.setSelectionStates(n,u);}};
V.prototype.setCamera=function(f){if(f!==this._camera){var g=c.byId(this.getContentConnector());if(this._camera&&g){var h=g.getContentManager();if(h){h.destroyCamera(this._camera);}}}this._camera=f;return this;};
V.prototype.getCamera=function(){return this._camera;};
V.prototype.activateView=function(f,p,n){return this;};
V.prototype.pan=function(f,g){return this;};
V.prototype.rotate=function(f,g){return this;};
V.prototype.zoom=function(f){return this;};
V.prototype.projectToScreen=function(x,y,z,f){return{x:0,y:0,depth:0};};
V.prototype.normalizeRectangle=function(x,y,w,h){return{x:0,y:0,width:0,height:0};};
V.prototype.deNormalizeRectangle=function(x,y,w,h){return{x:0,y:0,width:0,height:0};};
return V;});
sap.ui.predefine('sap/ui/vk/ViewportHandler',["sap/ui/base/EventProvider","sap/base/Log"],function(E,L){"use strict";
var V=E.extend("sap.ui.vk.ViewportHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(a){this._viewport=a;this._rect=null;this._evt={x:0,y:0,z:0,d:0,tdx:0,tdy:0,tdd:0,initd:0};this._gesture=false;this._viewport.attachEvent("resize",this,this._onresize);this._nomenu=false;}
});
V.prototype.destroy=function(){this._viewport=null;this._rect=null;this._evt=null;this._gesture=false;};
V.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
V.prototype._inside=function(e){if(this._rect==null||true){var i=this._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
V.prototype._onresize=function(e){this._gesture=false;this._rect=null;};
V.prototype.hover=function(e){if(this._viewport.hover&&this._inside(e)){this._viewport.queueCommand(function(){this._viewport.hover(e.x-this._rect.x,e.y-this._rect.y);}.bind(this));e.handled=true;}};
V.prototype.beginGesture=function(a){if(this._inside(a)&&!this._gesture){this._gesture=true;var x=a.x-this._rect.x,y=a.y-this._rect.y;this._evt.tdx=0;this._evt.tdy=0;this._evt.tdd=0;this._evt.x=x;this._evt.y=y;this._evt.d=a.d;this._evt.initd=a.d;this._evt.avgd=a.d;this._evt.avgx=0;this._evt.avgy=0;L.debug("Loco: beginGesture: "+x+", "+y);this._viewport.queueCommand(function(){this._viewport.beginGesture(x,y);}.bind(this));a.handled=true;if(document.activeElement){try{document.activeElement.blur();}catch(e){}}var d=document.getElementById(this._viewport.getIdForLabel());d.focus();}this._nomenu=false;};
V.prototype.move=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;var d=x-this._evt.x;var a=y-this._evt.y;var b=e.d-this._evt.d;this._evt.tdx=this._evt.tdx+d;this._evt.tdy=this._evt.tdy+a;this._evt.tdd=this._evt.tdd+b;this._evt.x=x;this._evt.y=y;this._evt.d=e.d;this._evt.avgx=this._evt.avgx*0.99+d*0.01;this._evt.avgy=this._evt.avgy*0.99+a*0.01;var z=1.0;if(this._evt.initd>0){z=1.0+b*(1.0/this._evt.initd);}else if(e.n==2){if(e.points[0].y>e.points[1].y){z=1.0-b*0.005;if(z<0.333){z=0.333;}}else{z=1.0+b*0.005;if(z>3){z=3;}}}if(this._evt.initd>0){var c=Math.sqrt(this._evt.avgx*this._evt.avgx+this._evt.avgy*this._evt.avgy);L.debug("AvgDist: "+c);if((Math.abs(e.d-this._evt.avgd)/this._evt.avgd)<(c/10)){z=1.0;}}this._evt.avgd=this._evt.avgd*0.97+e.d*0.03;this._evt.n=e.n;switch(e.n){case 1:L.debug("Loco: Rotate: "+(d)+", "+(a));this._viewport.queueCommand(function(){this._viewport.rotate(d,a);}.bind(this));break;case 2:L.debug("Loco: Pan: "+(d)+", "+(a));if(z!=0&&z!=1.0){L.debug("Loco: Zoom: "+(z));}this._viewport.queueCommand(function(){if(this._evt.tdx!==0&&this._evt.tdy!==0){this._viewport.pan(d,a);}if((d<10&&a<10&&z!=0&&z!=1.0)&&this._evt.tdd!==0){this._viewport.zoom(z);}}.bind(this));break;default:break;}this._nomenu=true;e.handled=true;}};
V.prototype.endGesture=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;L.debug("Loco: endGesture: "+x+", "+y);this._viewport.queueCommand(function(){this._viewport.endGesture();}.bind(this));this._gesture=false;e.handled=true;}};
V.prototype.click=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;L.debug("Loco: click: "+(x)+", "+(y));this._viewport.queueCommand(function(){this._viewport.tap(x,y,false);}.bind(this));e.handled=true;}};
V.prototype.doubleClick=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;L.debug("Loco: doubleClick: "+(x)+", "+(y));this._viewport.queueCommand(function(){this._viewport.tap(x,y,true);}.bind(this));e.handled=true;}};
V.prototype.contextMenu=function(e){if(this._inside(e)||this._nomenu||e.buttons==5){this._nomenu=false;e.handled=true;}};
V.prototype.keyEventHandler=function(e){};
V.prototype.getViewport=function(){return this._viewport;};
return V;});
sap.ui.predefine('sap/ui/vk/ViewportRenderer',[],function(){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewport");r.writeClasses();if(c._implementation){r.writeAttribute("tabindex",-1);}else{r.writeAttribute("tabindex",0);r.writeAttribute("aria-label","Image");r.writeAttribute("role","figure");}var a=false;var w=c.getWidth();if(w){r.addStyle("width",w);a=true;}var h=c.getHeight();if(h){r.addStyle("height",h);a=true;}if(a){r.writeStyles();}r.write(">");if(c._implementation){r.renderControl(c._implementation);}else if(c.getContent()){var C=c.getContent();for(var i=0,l=C.length;i<l;i++){r.renderControl(C[i]);}}r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/VisibilityMode',[],function(){"use strict";var V={Complete:"complete",Differences:"differences"};return V;},true);
sap.ui.predefine('sap/ui/vk/ZoomTo',[],function(){"use strict";var Z={All:"all",Visible:"visible",Selected:"selected",Node:"node",NodeSetIsolation:"node_setisolation",Restore:"restore",RestoreRemoveIsolation:"restore_removeisolation",ViewLeft:"view_left",ViewRight:"view_right",ViewTop:"view_top",ViewBottom:"view_bottom",ViewBack:"view_back",ViewFront:"view_front"};return Z;},true);
sap.ui.predefine('sap/ui/vk/abgrToColor',[],function(){"use strict";var a=function(b){return{red:b&0xff,green:b>>>8&0xff,blue:b>>>16&0xff,alpha:(b>>>24&0xff)/255};};return a;},true);
sap.ui.predefine('sap/ui/vk/colorToABGR',[],function(){"use strict";var c=function(a){return(a.alpha*255<<24|a.blue<<16|a.green<<8|a.red)>>>0;};return c;},true);
sap.ui.predefine('sap/ui/vk/colorToCSSColor',[],function(){"use strict";var c=function(a){return"rgba("+a.red+","+a.green+","+a.blue+","+a.alpha+")";};return c;},true);
sap.ui.predefine('sap/ui/vk/cssColorToColor',[],function(){"use strict";var c=(function(){var i=false;var d=document.createElement("div");d.id="sap.ui.vk.colorConverter";d.style.setProperty("display","none","important");return function(a){if(!i){if(document.body){document.body.appendChild(d);i=true;}else{return{red:0,green:0,blue:0,alpha:1};}}d.style.setProperty("color","rgba(0, 0, 0, 0)","important");d.style.setProperty("color",a,"important");var e=window.getComputedStyle(d).color;if(e==="transparent"){return{red:0,green:0,blue:0,alpha:0};}else{var b=e.split("(")[1].split(")")[0].split(",");return{red:parseInt(b[0],10),green:parseInt(b[1],10),blue:parseInt(b[2],10),alpha:b.length===4?parseFloat(b[3]):1};}};})();return c;},true);
sap.ui.predefine('sap/ui/vk/dvl/BaseNodeProxy',["../BaseNodeProxy","./getJSONObject"],function(B,g){"use strict";
var a=B.extend("sap.ui.vk.dvl.BaseNodeProxy",{metadata:{}});
a.prototype.init=function(n,b){this._dvl=n?n.getGraphicsCore()._getDvl():null;this._dvlSceneRef=n?n.getSceneRef():null;this._dvlNodeRef=b;};
a.prototype.reset=function(){this._dvlNodeRef=null;this._dvlSceneRef=null;this._dvl=null;};
a.prototype.getNodeRef=function(){return this._dvlNodeRef;};
a.prototype.getNodeId=function(){return this._dvlNodeRef;};
a.prototype.getName=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_NAME)).NodeName;};
a.prototype.getNodeMetadata=function(){return g(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlNodeRef)).metadata;};
a.prototype.getHasChildren=function(){return(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED))===sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN;};
a.prototype.getSceneRef=function(){return this._dvlNodeRef;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/ContentManager',["../ContentManager","../getResourceBundle"],function(C,g){"use strict";
var a=C.extend("sap.ui.vk.dvl.ContentManager",{metadata:{library:"sap.ui.vk"}});
var b=a.getMetadata().getParent().getClass().prototype;
a.prototype.init=function(){if(b.init){b.init.call(this);}this._handleDownloadingProgressProxy=this._handleDownloadingProgress.bind(this);this._graphicsCore=null;this._failedSources=[];};
a.prototype.exit=function(){if(this._graphicsCore){this._graphicsCore.destroy();this._graphicsCore=null;}if(b.exit){b.exit.call(this);}};
var r={},w={antialias:true,alpha:true,premultipliedAlpha:true};
a.getRuntimeSettings=function(){return r;};
a.setRuntimeSettings=function(s){r=s;};
a.getWebGLContextAttributes=function(){return w;};
a.setWebGLContextAttributes=function(c){w=Object.assign(w,c);};
a.prototype._getGraphicsCore=function(){var t=this;return new Promise(function(c,d){if(t._graphicsCore){c(t._graphicsCore);}else{sap.ui.require(["sap/ui/vk/dvl/GraphicsCore"],function(G){G.create(r,w).then(function(e){t._graphicsCore=e;t._graphicsCore.attachSceneLoadingStarted(t._handleDvlSceneLoadingStarted,t);t._graphicsCore.attachSceneLoadingFinished(t._handleDvlSceneLoadingFinished,t);t._graphicsCore.attachSceneLoadingProgress(t._handleDvlSceneLoadingProgress,t);c(t._graphicsCore);});});}});};
a.prototype._handleDownloadingProgress=function(e){var s=e.getParameter("source"),l=e.getParameter("loaded"),t=e.getParameter("total"),v=t?l/t*50:0;this.fireContentChangesProgress({phase:g().getText("PROGRESS_INDICATOR_DOWNLOADING"),source:s,percentage:v});};
a.prototype._handleDvlSceneLoadingProgress=function(e){this.fireContentChangesProgress({phase:g().getText("PROGRESS_INDICATOR_RENDERING"),source:e.getParameter("source"),percentage:50+e.getParameter("percentage")*50});};
a.prototype._handleDvlSceneLoadingStarted=function(e){};
a.prototype._handleDvlSceneLoadingFinished=function(e){};
a.prototype.loadContent=function(c,d){this.fireContentChangesStarted();var t=this;this._getGraphicsCore().then(function(e){e.setDecryptionHandler(t._decryptionHandler);e.setAuthorizationHandler(t._authorizationHandler);e.loadContentResourcesAsync(d,function(s){var f=[];if(s){s.forEach(function(i){f.push({error:i,errorMessage:"Failed to download source '"+((i.source instanceof File)?i.source.name:i.source)+"'."});});}var l=c?c:undefined;e.updateSceneTreeAsync(l,d).then(function(h){var i={content:h.scene};if(h.failureReason){f=f.concat(h.failureReason);}if(f.length>0){i.failureReason=f;}sap.ui.require(["sap/ui/vk/dvl/Viewport","sap/ui/vk/dvl/ViewStateManager"],function(){t.fireContentChangesFinished(i);});}).catch(function(h){if(typeof h==="string"){f.push({error:h,errorMessage:h});}else{f.push({error:h,errorMessage:h.message?h.message:h.errorMessage});}t.fireContentChangesFinished({content:null,failureReason:f});});},t._handleDownloadingProgressProxy);},function(e){t.fireContentChangesFinished({content:null,failureReason:{error:e,errorMessage:"Failed to create DVL graphics core object."}});});return this;};
a.prototype.destroyContent=function(c){if(c){this._graphicsCore.destroyScene(c);}return this;};
a.prototype.collectGarbage=function(){this._graphicsCore.collectGarbage();return this;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/GraphicsCoreApi',[],function(){"use strict";var G={LegacyDvl:"LegacyDvl"};return G;},true);
sap.ui.predefine('sap/ui/vk/dvl/LayerProxy',["../LayerProxy","./getJSONObject"],function(L,g){"use strict";
var a=L.extend("sap.ui.vk.dvl.LayerProxy",{
metadata:{publicMethods:["getDescription","getLayerId","getLayerMetadata","getName","getNodes","getVeIds"]},
constructor:function(n,l){L.call(this);this._dvl=n?n.getGraphicsCore()._getDvl():null;this._dvlSceneRef=n?n.getSceneRef():null;this._dvlLayerId=l;}
});
a.prototype.destroy=function(){this._dvlLayerId=null;this._dvlSceneRef=null;this._dvl=null;L.prototype.destroy.call(this);};
a.prototype.getLayerId=function(){return this._dvlLayerId;};
a.prototype.getVeIds=function(){return g(this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,this._dvlLayerId));};
a.prototype.getName=function(){return g(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).name;};
a.prototype.getDescription=function(){return g(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).description;};
a.prototype.getLayerMetadata=function(){return g(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlLayerId)).metadata;};
a.prototype.getNodes=function(){return g(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).nodes;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/NodeHierarchy',["../NodeHierarchy","../NodeContentType","sap/ui/base/ObjectPool","./BaseNodeProxy","./NodeProxy","./LayerProxy","../Messages","../DvlException","./checkResult","./getJSONObject","../getResourceBundle","sap/base/util/array/uniqueSort","sap/base/Log"],function(N,a,O,B,b,L,M,D,c,g,d,u,f){"use strict";var s={modeDictionary:{equals:function(i){return i?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_EQUAL:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_EQUAL_CASE_INSENSITIVE;},contains:function(i){return i?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_SUBSTRING:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_SUBSTRING_CASE_INSENSITIVE;},startsWith:function(i){return i?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_STARTS_WITH:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_STARTS_WITH_CASE_INSENSITIVE;}}};
var h=N.extend("sap.ui.vk.dvl.NodeHierarchy",{
metadata:{},
_baseNodeProxyPool:new O(B),
constructor:function(e){N.call(this);this._graphicsCore=e.getGraphicsCore();this._scene=e;this._dvlSceneRef=this._scene.getSceneRef();this._dvl=this._graphicsCore._getDvl();this._nodeProxies=[];this._layerProxies=[];}
});
h.prototype.destroy=function(){this._layerProxies.slice().forEach(this.destroyLayerProxy,this);this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._dvl=null;this._dvlSceneRef=null;this._scene=null;this._graphicsCore=null;N.prototype.destroy.call(this);};
h.prototype.getGraphicsCore=function(){return this._graphicsCore;};
h.prototype.getScene=function(){return this._scene;};
h.prototype.getSceneRef=function(){return this._dvlSceneRef;};
h.prototype.enumerateChildren=function(n,e,i,p){if(typeof n==="function"){p=i;i=e;e=n;n=undefined;}var j;if(n){if(i||(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)===0){j=g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN)).ChildNodes;}else{j=[];}}else{j=g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN)).ChildNodes;}if(p){j.forEach(e);}else{var k=this._baseNodeProxyPool.borrowObject();try{j.forEach(function(n){k.init(this,n);e(k);k.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(k);}}return this;};
h.prototype.enumerateAncestors=function(n,e,p){var i=g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_PARENTS)).ParentNodes;if(p){i.forEach(e);}else{var j=this._baseNodeProxyPool.borrowObject();try{i.forEach(function(n){j.init(this,n);e(j);j.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(j);}}return this;};
h.prototype.createNodeProxy=function(n){var e=new b(this,n);this._nodeProxies.push(e);return e;};
h.prototype.destroyNodeProxy=function(n){var i=this._nodeProxies.indexOf(n);if(i>=0){this._nodeProxies.splice(i,1)[0].destroy();}return this;};
h.prototype.getChildren=function(n,e){if(typeof n==="boolean"){e=n;n=undefined;}if(n){if(e||(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)===0){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN)).ChildNodes;}else{return[];}}else{return g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN)).ChildNodes;}};
h.prototype.getAncestors=function(n){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_PARENTS)).ParentNodes;};
h.prototype.findNodesByName=function(q){var e=sap.ve.dvl.DVLFINDNODETYPE.DVLFINDNODETYPE_NODE_NAME,j=[],k,l;if(q===undefined||q===null||jQuery.isEmptyObject(q)){k=s.modeDictionary.contains(false);l=[""];}else{if(q.value===undefined||q.value===null||q.value===""){f.error(d().getText(M.VIT6.summary),M.VIT6.code,"sap.ui.vk.dvl.NodeHierarchy");return[];}var p=q.hasOwnProperty("predicate")?q.predicate:"equals";if(p===undefined||p===null||p===""){f.error(d().getText(M.VIT7.summary),M.VIT7.code,"sap.ui.vk.dvl.NodeHierarchy");return[];}else if(["equals","contains","startsWith"].indexOf(p)===-1){f.error(d().getText(M.VIT8.summary),M.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy");return[];}k=s.modeDictionary[p](q.caseSensitive);l=(typeof q.value==="string")?[q.value]:q.value;}for(var i=0;i<l.length;i++){j=j.concat(g(this._dvl.Scene.FindNodes(this._dvlSceneRef,e,k,l[i])).nodes);}return u(j);};
h.prototype.createLayerProxy=function(l){var e=new L(this,l);this._layerProxies.push(e);return e;};
h.prototype.destroyLayerProxy=function(l){var i=this._layerProxies.indexOf(l);if(i>=0){this._layerProxies.splice(i,1)[0].destroy();}return this;};
h.prototype.getLayers=function(){return g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_LAYERS)).Layers;};
h.prototype.getHotspotNodeIds=function(){var e=g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes);return e.length>0?e:this._getLegacyHotspotNodeIds();};
h.prototype._getLegacyHotspotNodeIds=function(){var e=this.getLayers(),j=[];for(var i=0;i<e.length;i++){var l=this.createLayerProxy(e[i]),k=l.getName();if(k.toLowerCase()==="hotspots"){j=l.getNodes();this.destroyLayerProxy(l);break;}this.destroyLayerProxy(l);}return j;};
h.prototype.createNode=function(p,n,i){var e=this._dvl.Scene.CreateNode(this._dvlSceneRef,p,n,i);this.fireNodeCreated({nodeRef:e,nodeId:e});this.fireChanged();return e;};
h.prototype.createNodeCopy=function(n,p,e,i){var j=this._dvl.Scene.CreateNodeCopy(this._dvlSceneRef,n,p,sap.ve.dvl.DVLCREATENODECOPYFLAG.COPY_CHILDREN,e,i);this.fireNodeCreated({nodeRef:j,nodeId:j});this.fireChanged();return j;};
h.prototype.getNodeContentType=function(n){return a.Regular;};
h.prototype.removeNode=function(n){var i=[].concat(n);i.forEach(function(n){this.fireNodeRemoving({nodeRef:n,nodeId:n});try{c(this._dvl.Scene.DeleteNode(this._dvlSceneRef,n));}catch(e){var m="Failed to delete node with ID = "+n+".";if(e instanceof D){m+=" Error code: "+e.code+". Message: "+e.message+".";}f.error(m);}}.bind(this));this.fireChanged();return this;};
return h;});
sap.ui.predefine('sap/ui/vk/dvl/NodeProxy',["../NodeProxy","./getJSONObject","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","../TransformationMatrix"],function(N,g,c,a,b,d,T){"use strict";
var e=N.extend("sap.ui.vk.dvl.NodeProxy",{
metadata:{},
constructor:function(n,f){N.call(this);this._dvl=n?n.getGraphicsCore()._getDvl():null;this._dvlSceneRef=n?n.getSceneRef():null;this._dvlNodeRef=f;}
});
e.prototype.destroy=function(){this._dvlNodeRef=null;this._dvlSceneRef=null;this._dvl=null;N.prototype.destroy.call(this);};
e.prototype.getNodeRef=function(){return this._dvlNodeRef;};
e.prototype.getNodeId=function(){return this._dvlNodeRef;};
e.prototype.getVeIds=function(){return g(this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,this._dvlNodeRef));};
e.prototype.getName=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_NAME)).NodeName;};
e.prototype.getLocalMatrix=function(){return T.convertTo4x3(g(this._dvl.Scene.GetNodeLocalMatrix(this._dvlSceneRef,this._dvlNodeRef)).matrix);};
e.prototype.setLocalMatrix=function(v){this._dvl.Scene.SetNodeLocalMatrix(this._dvlSceneRef,this._dvlNodeRef,v&&T.convertTo4x4(v));this.setProperty("localMatrix",v,true);return this;};
e.prototype.getWorldMatrix=function(){return T.convertTo4x3(g(this._dvl.Scene.GetNodeWorldMatrix(this._dvlSceneRef,this._dvlNodeRef)).matrix);};
e.prototype.setWorldMatrix=function(v){this._dvl.Scene.SetNodeWorldMatrix(this._dvlSceneRef,this._dvlNodeRef,v&&T.convertTo4x4(v));this.setProperty("worldMatrix",v,true);return this;};
e.prototype.getOpacity=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_OPACITY)).Opacity;};
e.prototype.setOpacity=function(v){this._dvl.Scene.SetNodeOpacity(this._dvlSceneRef,this._dvlNodeRef,v);this.setProperty("opacity",v,true);return this;};
e.prototype.getTintColorABGR=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_HIGHLIGHT_COLOR)).HighlightColor;};
e.prototype.setTintColorABGR=function(v){this._dvl.Scene.SetNodeHighlightColor(this._dvlSceneRef,this._dvlNodeRef,v);this.setProperty("tintColorABGR",v,true);this.setProperty("tintColor",a(b(v)),true);return this;};
e.prototype.getTintColor=function(){return a(b(this.getTintColorABGR()));};
e.prototype.setTintColor=function(v){var f=d(c(v));this._dvl.Scene.SetNodeHighlightColor(this._dvlSceneRef,this._dvlNodeRef,f);this.setProperty("tintColorABGR",f,true);this.setProperty("tintColor",v,true);return this;};
e.prototype.getNodeMetadata=function(){return g(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlNodeRef)).metadata;};
e.prototype.getHasChildren=function(){return(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED))===sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN;};
e.prototype.getClosed=function(){return(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)!==0;};
return e;});
sap.ui.predefine('sap/ui/vk/dvl/Scene',["../Scene","./NodeHierarchy","sap/base/util/uid"],function(S,N,u){"use strict";
var a=S.extend("sap.ui.vk.dvl.Scene",{
metadata:{},
constructor:function(g,d){S.call(this);this._id=u();this._graphicsCore=g;this._dvlSceneRef=d;this._defaultNodeHierarchy=null;}
});
a.prototype.destroy=function(){if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null;}this._dvlSceneRef=null;this._graphicsCore=null;S.prototype.destroy.call(this);};
a.prototype.getId=function(){return this._id;};
a.prototype.getGraphicsCore=function(){return this._graphicsCore;};
a.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new N(this);}return this._defaultNodeHierarchy;};
a.prototype.getSceneRef=function(){return this._dvlSceneRef;};
a.prototype.setDoubleSided=function(v){this.setProperty("doubleSided",v,true);this._graphicsCore._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_SHOW_BACKFACING,v);return this;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/ViewStateManager',["sap/ui/core/Element","../ViewStateManagerBase","./GraphicsCoreApi","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","./Scene","sap/base/util/array/uniqueSort"],function(E,V,G,c,a,b,d,S,u){"use strict";var e;
var f=V.extend("sap.ui.vk.dvl.ViewStateManager",{metadata:{}});
var g=f.getMetadata().getParent().getClass().prototype;
f.prototype.init=function(){if(g.init){g.init.call(this);}this._nodeHierarchy=null;this._dvl=null;this._nodeStates=new Map();this._selectedNodes=new Set();this._visibilityTracker=new e();this._closedNodeProcessed=false;};
f.prototype._setContent=function(i){var j=null;if(i&&i instanceof S){j=i;}this._setScene(j);return this;};
f.prototype._setScene=function(i){if(i){this._setNodeHierarchy(i.getDefaultNodeHierarchy());}else{this._setNodeHierarchy(null);}return this;};
f.prototype._setNodeHierarchy=function(n){var o=this._nodeHierarchy;if(this._nodeHierarchy){this._nodeHierarchy.detachNodeCreated(this._handleNodeCreated,this);this._nodeHierarchy.detachNodeRemoving(this._handleNodeRemoving,this);this._dvl.Client.detachStepEvent(this._handleStepEvent,this);this._nodeHierarchy=null;this._dvl=null;this._nodeStates.clear();this._selectedNodes.clear();this._visibilityTracker.clear();}if(n){var i=n.getScene(),j=i.getSceneRef();this._nodeHierarchy=n;this._dvl=i.getGraphicsCore().getApi(G.LegacyDvl);this._dvl.Client.attachStepEvent(this._handleStepEvent,this);this._nodeHierarchy.attachNodeCreated(this._handleNodeCreated,this);this._nodeHierarchy.attachNodeRemoving(this._handleNodeRemoving,this);this._populateNodeStates(this._dvl.Scene.RetrieveSceneInfo(j,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN|sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes);}if(n!==o){this.fireNodeHierarchyReplaced({oldNodeHierarchy:o,newNodeHierarchy:n});}return this;};
f.prototype._populateNodeStates=function(n){var t=this,v=[],i=[],j=[],k=[],l=this._nodeHierarchy.getScene(),m=l.getSceneRef();n.forEach(function q(o){var p=t._dvl.Scene.RetrieveNodeInfo(m,o,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS|sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN);t._nodeStates.set(o,{flags:p.Flags,visible:p.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE});if(p.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED){t._selectedNodes.add(o);}(p.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE?v:i).push(o);(p.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED?j:k).push(o);p.ChildNodes.forEach(q);});this.fireSelectionChanged({selected:j,unselected:k});this.fireVisibilityChanged({visible:v,hidden:i});return this;};
f.prototype._handleNodeCreated=function(i){this._populateNodeStates([i.getParameter("nodeRef")]);};
f.prototype._handleNodeRemoving=function(i){var n=i.getParameter("nodeRef"),t=this;var r=function(n){t._nodeHierarchy.enumerateChildren(n,r,true,true);t._nodeStates.delete(n);};r(n);};
f.prototype.getNodeHierarchy=function(){return this._nodeHierarchy;};
f.prototype.getVisibilityChanges=function(){return this.getShouldTrackVisibilityChanges()?this._visibilityTracker.getInfo(this.getNodeHierarchy()):null;};
f.prototype.getVisibilityComplete=function(){var n=this.getNodeHierarchy(),i=n.findNodesByName(),v=[],j=[];i.forEach(function(k){var l=n.createNodeProxy(k),m=jQuery.grep(l.getVeIds(),function(m){return m.type==="VE_LOCATOR";});m=Array.isArray(m)&&m.length>0?m[0].fields[0].value:null;n.destroyNodeProxy(l);if(m){if(this.getVisibilityState(k)){v.push(m);}else{j.push(m);}}},this);return{visible:v,hidden:j};};
f.prototype.resetVisibility=function(){this._dvl.Renderer.ResetView(sap.ve.dvl.DVLRESETVIEWFLAG.VISIBILITY,this._scene);return this;};
var h=function(n,i,j){return n.has(j)&&(n.get(j).flags&i)!==0;};
f.prototype._getVisibilityFlagState=function(n){return h(this._nodeStates,sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE,n);};
f.prototype._getSelectionFlagState=function(n){return h(this._nodeStates,sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED,n);};
var s=function(n,i,j,k){if(n.has(k)){var l=n.get(k);l.flags=l.flags&~j|i&j;}else{n.set(k,{flags:i&j});}};
f.prototype._setFlags=function(n,i,j){if(j&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE){this.setVisibilityState(n,(i&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE)!==0,false);}if(j&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED){this.setSelectionState(n,(i&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED)!==0,false);}s(this._nodeStates,i,j&~(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED),n);return this;};
f.prototype._getFlags=function(n,i){var j=this._nodeStates.get(n),k=j&&j.flags;return k!==undefined?k&i:null;};
f.prototype.getVisibilityState=function(n){return Array.isArray(n)?n.map(this._getVisibilityFlagState,this):this._getVisibilityFlagState(n);};
f.prototype.setVisibilityState=function(n,v,r){if(!Array.isArray(n)){n=[n];}var i=u(r?this._collectNodesRecursively(n,true):n).filter(function(k){return k&&this._getVisibilityFlagState(k)!==v;},this);var j=function(k,v){var l=[];this._nodeHierarchy.enumerateChildren(k,function(m){l.push(m);},true,true);l.forEach(function(m){var o=this._nodeStates.get(m);if(v){if(o.visible){o.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE;j(m,v);}}else{o.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE;j(m,v);}},this);}.bind(this);if(i.length>0){i.forEach(function(k){var l=this._nodeStates.get(k);if(l){if(l.flags===undefined){l.flags=0;}if(v){l.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE;}else{l.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE;}}else{l={flags:v?sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE:0};this._nodeStates.set(k,l);}l.visible=v;j(k,v);},this);if(this.getShouldTrackVisibilityChanges()){i.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker);}this.fireVisibilityChanged({visible:v?i:[],hidden:v?[]:i});}return this;};
f.prototype.enumerateSelection=function(i){this._selectedNodes.forEach(i);return this;};
f.prototype.getSelectionState=function(n){return Array.isArray(n)?n.map(this._getSelectionFlagState,this):this._getSelectionFlagState(n);};
f.prototype.setSelectionState=function(n,i,r,j){if(!Array.isArray(n)){n=[n];}var k=u(r||this.getRecursiveSelection()?this._collectNodesRecursively(n):n);if(this.getRecursiveSelection()&&!i){k=this._nodeHierarchy._appendAncestors(k);}k=k.filter(function(l){return l&&this._getSelectionFlagState(l)!==i;},this);if(k.length>0){k.forEach(function(l){var m=this._nodeStates.get(l);if(m){if(m.flags===undefined){m.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),l,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;}if(i){m.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED;}else{m.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED;}}else{var o=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),l,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(l,{flags:o|(i?sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED:0)});}this._selectedNodes[i?"add":"delete"](l);},this);if(!j){this.fireSelectionChanged({selected:i?k:[],unselected:i?[]:k});}}return this;};
f.prototype.setSelectionStates=function(i,j,r,k){if(!Array.isArray(i)){i=[i];}if(!Array.isArray(j)){j=[j];}var l=u(r||this.getRecursiveSelection()?this._collectNodesRecursively(i):i);var m=u(r||this.getRecursiveSelection()?this._collectNodesRecursively(j):j);if(this.getRecursiveSelection()){m=this._nodeHierarchy._appendAncestors(m,l);}l=l.filter(function(n){return n&&this._getSelectionFlagState(n)===false;},this);m=m.filter(function(n){return n&&this._getSelectionFlagState(n)===true;},this);if(l.length>0){l.forEach(function(n){var o=this._nodeStates.get(n);if(o){if(o.flags===undefined){o.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;}o.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED;}else{var p=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(n,{flags:p|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED});}this._selectedNodes["add"](n);},this);}if(m.length>0){m.forEach(function(n){var o=this._nodeStates.get(n);if(o){if(o.flags===undefined){o.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;}o.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED;}else{var p=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(n,{flags:p});}this._selectedNodes["delete"](n);},this);}if(!k){if(l.length>0||m.length>0){this.fireSelectionChanged({selected:l,unselected:m});}}return this;};
f.prototype._handleStepEvent=function(i){if(i.type===sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED){this._visibilityTracker.clear();}};
f.prototype._collectNodesRecursively=function(n,i){var r=[],t=this;if(i===undefined){i=false;}n.forEach(function k(j){r.push(j);t._nodeHierarchy.enumerateChildren(j,k,i,true);});return r;};
f.prototype._getOpacity=function(n){if(this._nodeStates.has(n)){var o=this._nodeStates.get(n).opacity;return o===undefined?null:o;}else{return null;}};
f.prototype.getOpacity=function(n){if(Array.isArray(n)){return n.map(this._getOpacity,this);}else{return this._getOpacity(n);}};
f.prototype.setOpacity=function(n,o,r){if(!Array.isArray(n)){n=[n];}var i=u(r?this._collectNodesRecursively(n,true):n).filter(function(j){return j&&this._getOpacity(j)!==o;},this);if(i.length>0){i.forEach(function(j){var k=this._nodeStates.get(j);if(k){if(o===null){delete k.opacity;}else{k.opacity=o;}}else if(o!==null){this._nodeStates.set(j,{opacity:o});}},this);this.fireOpacityChanged({changed:i,opacity:o});}return this;};
f.prototype._getTintColorABGR=function(n){if(this._nodeStates.has(n)){var t=this._nodeStates.get(n).tintColorABGR;return t===undefined?null:t;}else{return null;}};
f.prototype._getTintColor=function(n){if(this._nodeStates.has(n)){var t=this._nodeStates.get(n).tintColorABGR;return t===undefined?null:a(b(t));}else{return null;}};
f.prototype.getTintColor=function(n,i){var j=i?"_getTintColorABGR":"_getTintColor";if(Array.isArray(n)){return n.map(this[j],this);}else{return this[j](n);}};
f.prototype.setTintColor=function(n,t,r){if(!Array.isArray(n)){n=[n];}var i=null;switch(typeof t){case"number":i=t;break;case"string":if(sap.ui.core.CSSColor.isValid(t)){i=d(c(t));}break;default:t=null;break;}var j=u(r?this._collectNodesRecursively(n,true):n).filter(function(k){return k&&this._getTintColorABGR(k)!==i;},this);if(j.length>0){j.forEach(function(k){var l=this._nodeStates.get(k);if(l){if(i===null){delete l.tintColorABGR;}else{l.tintColorABGR=i;}}else if(i!==null){this._nodeStates.set(k,{tintColorABGR:i});}},this);this.fireTintColorChanged({changed:j,tintColor:t,tintColorABGR:i});}return this;};
e=function(){this._visibilityChanges=new Set();};
e.prototype.getInfo=function(n){var i=function(v){return v.type==="VE_LOCATOR";};var j=[];this._visibilityChanges.forEach(function(k){var l=n.createNodeProxy(k),v=jQuery.grep(l.getVeIds(),i);v=Array.isArray(v)&&v.length>0?v[0].fields[0].value:null;n.destroyNodeProxy(l);if(v){j.push(v);}});return j;};
e.prototype.clear=function(){this._visibilityChanges.clear();};
e.prototype.trackNodeRef=function(n){if(this._visibilityChanges.has(n)){this._visibilityChanges.delete(n);}else{this._visibilityChanges.add(n);}};
return f;});
sap.ui.predefine('sap/ui/vk/dvl/Viewport',["sap/ui/core/ResizeHandler","../abgrToColor","../CameraFOVBindingType","../CameraProjectionType","../colorToABGR","../colorToCSSColor","../Core","../cssColorToColor","../getResourceBundle","../Loco","../Messages","../SelectionMode","../Smart2DHandler","../ViewportBase","../ViewportHandler","../VisibilityMode","../ZoomTo","./getJSONObject","./Scene","./ViewportRenderer","sap/base/Log"],function(R,a,C,b,c,d,v,e,g,L,M,S,h,V,k,l,Z,n,o,p,q){"use strict";var r;var s=function(){if(r){return;}r={encodedProjectionType:{},decodedProjectionType:{},encodedBindingType:{},decodedBindingType:{},decodedZoomTo:{}};r.decodedProjectionType[b.Perspective]=sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE;r.decodedProjectionType[b.Orthographic]=sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC;r.encodedProjectionType[sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE]=b.Perspective;r.encodedProjectionType[sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC]=b.Orthographic;r.decodedBindingType[C.Minimum]=sap.ve.dvl.DVLCAMERAFOVBINDING.MIN;r.decodedBindingType[C.Maximum]=sap.ve.dvl.DVLCAMERAFOVBINDING.Max;r.decodedBindingType[C.Horizontal]=sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ;r.decodedBindingType[C.Vertical]=sap.ve.dvl.DVLCAMERAFOVBINDING.VERT;r.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.MIN]=C.Minimum;r.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.MAX]=C.Maximum;r.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ]=C.Horizontal;r.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.VERT]=C.Vertical;r.decodedZoomTo[Z.All]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_ALL;r.decodedZoomTo[Z.Visible]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_VISIBLE;r.decodedZoomTo[Z.Selected]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_SELECTED;r.decodedZoomTo[Z.Node]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_NODE;r.decodedZoomTo[Z.NodeSetIsolation]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_NODE_SETISOLATION;r.decodedZoomTo[Z.Restore]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_RESTORE;r.decodedZoomTo[Z.RestoreRemoveIsolation]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_RESTORE_REMOVEISOLATION;r.decodedZoomTo[Z.ViewLeft]=sap.ve.dvl.DVLZOOMTO.VIEW_LEFT;r.decodedZoomTo[Z.ViewRight]=sap.ve.dvl.DVLZOOMTO.VIEW_RIGHT;r.decodedZoomTo[Z.ViewTop]=sap.ve.dvl.DVLZOOMTO.VIEW_TOP;r.decodedZoomTo[Z.ViewBottom]=sap.ve.dvl.DVLZOOMTO.VIEW_BOTTOM;r.decodedZoomTo[Z.ViewBack]=sap.ve.dvl.DVLZOOMTO.VIEW_BACK;r.decodedZoomTo[Z.ViewFront]=sap.ve.dvl.DVLZOOMTO.VIEW_FRONT;};
var t=V.extend("sap.ui.vk.dvl.Viewport",{metadata:{library:"sap.ui.vk",properties:{backgroundColorTopABGR:{type:"int",defaultValue:0xff000000},backgroundColorBottomABGR:{type:"int",defaultValue:0xffffffff}},events:{pan:{parameters:{dx:"int",dy:"int"}},zoom:{parameters:{zoomFactor:"float"}},rotate:{parameters:{dx:"int",dy:"int"}},frameRenderingFinished:{}}}});
var u=t.getMetadata().getParent().getClass().prototype;
t.prototype.init=function(){if(u.init){u.init.call(this);}this._eventBus=v.getEventBus();this._graphicsCore=null;this._dvl=null;this._dvlRendererId=null;this._viewStateManager=null;this._canvas=null;this._resizeListenerId=null;this._is2D=false;this._viewportHandler=new k(this);this._loco=new L(this);this._loco.addHandler(this._viewportHandler,-1);this._smart2DHandler=null;this._lastPlayedStep=null;this._contentConnector=null;};
t.prototype.exit=function(){this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this.setViewStateManager(null);this.setScene(null);this.setGraphicsCore(null);if(u.exit){u.exit.call(this);}};
t.prototype.setGraphicsCore=function(f){s();if(f!=this._graphicsCore){if(this._graphicsCore){this._dvl.Client.detachFrameFinished(this._handleFrameFinished,this);this._dvl.Client.detachStepEvent(this._updateLastPlayedStep,this);this._dvl.Renderer.SetViewStateManager(null,this._dvlRendererId);this._graphicsCore._deregisterViewport(this);this._dvl=null;}this._graphicsCore=f;if(this._graphicsCore){this._dvl=this._graphicsCore._getDvl();this._graphicsCore._registerViewport(this);this.setShowDebugInfo(this.getShowDebugInfo());this._dvl.Client.attachStepEvent(this._updateLastPlayedStep,this);this._dvl.Client.attachFrameFinished(this._handleFrameFinished,this);this._dvl.Renderer.SetViewStateManager(this._viewStateManager,this._dvlRendererId);}}return this;};
t.prototype.getGraphicsCore=function(){return this._graphicsCore;};
t.prototype._setCanvas=function(f){var i=this.getDomRef()&&this._canvas!==f;this._canvas=f;if(i){this.invalidate();}return this;};
t.prototype._setRenderer=function(f){this._dvlRendererId=f;return this;};
t.prototype._updateLastPlayedStep=function(f){if(f.type===sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED){this._lastPlayedStep=f.stepId;}};
t.prototype.setScene=function(f){if(this._dvlRendererId){this._dvl.Renderer.AttachScene(f&&f.getSceneRef()||null,this._dvlRendererId);this._dvlSceneRef=f?f.getSceneRef():null;if(f){this._dvl.Client.attachUrlClicked(this._fireUrlClicked,this);var i=this._isSmart2DContent()||this._isSmart2DContentLegacy();if(i){this._dvl.Renderer.SetBackgroundColor(1,1,1,1,1,1,1,1,this._dvlRendererId);}else{var j=this._getDecomposedABGR(this.getBackgroundColorTopABGR());var m=this._getDecomposedABGR(this.getBackgroundColorBottomABGR());this._dvl.Renderer.SetBackgroundColor(j.red,j.green,j.blue,j.alpha,m.red,m.green,m.blue,m.alpha,this._dvlRendererId);}this.fireViewActivated({type:i?"2D":"3D"});}else{this._dvl.Client.detachUrlClicked(this._fireUrlClicked,this);if(this._smart2DHandler){this._loco.removeHandler(this._smart2DHandler);}this.invalidate();}}return this;};
t.prototype._isSmart2DContent=function(){var f=n(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes);return f&&f.length>0;};
t.prototype._isSmart2DContentLegacy=function(){var f=this._dvl.Scene.GetCurrentCamera(this._dvlSceneRef),i=this._dvl.Camera.GetRotation(f),j=this._dvl.Camera.GetProjection(f);return i[0]===90&&i[1]===-90&&i[2]===0&&j===sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC;};
t.prototype._initializeSmart2DHandler=function(){if(this._viewStateManager){if(this._smart2DHandler){this._loco.removeHandler(this._smart2DHandler);}this._smart2DHandler=new h(this,this._viewStateManager);this._loco.addHandler(this._smart2DHandler,0);}if(this.getShowAllHotspots()){var f=this._viewStateManager.getNodeHierarchy(),i=f.getHotspotNodeIds();this.showHotspots(i,true);}};
t.prototype._fireUrlClicked=function(f){this.fireUrlClicked({url:f.url,nodeRef:f.nodeId});};
t.prototype.setHotspotColorABGR=function(f){this.setProperty("hotspotColorABGR",f,true);this.setProperty("hotspotColor",d(a(this.getProperty("hotspotColorABGR"))),true);return this;};
t.prototype.setHotspotColor=function(f){this.setProperty("hotspotColor",f,true);this.setProperty("hotspotColorABGR",c(e(this.getProperty("hotspotColor"))),true);return this;};
t.prototype._getStepAndProcedureIndexes=function(f,m){var x=-1,y=-1,K=false;for(var i=0;i<f.length;i++){if(!K){for(var j=0;j<f[i].steps.length;j++){if(f[i].steps[j].id===m){y=j;x=i;K=true;break;}}}else{break;}}return{stepIndex:y,procedureIndex:x};};
t.prototype._getStepVeIdById=function(f){if(f){var i=this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,f);if(Array.isArray(i)){for(var j=0,m=i.length;j<m;++j){var x=i[j];if(x.source==="SAP"&&x.type==="VE_VIEWPORT"&&Array.isArray(x.fields)){for(var y=0,K=x.fields.length;y<K;++y){var N=x.fields[y];if(N.name==="ID"){return N.value;}}}}}}return null;};
t.prototype._getStepIdByVeId=function(f,i){for(var j=0,m=f.length;j<m;++j){var x=f[j].steps;for(var y=0,K=x.length;y<K;++y){var N=x[y].id;if(this._getStepVeIdById(N)===i){return N;}}}return null;};
var w=function(f){f.camera={};};var z=function(f){if(typeof f.camera==="object"&&f.camera!==null){f.camera.matrices=false;}};var A=function(f){if(typeof f.camera==="object"&&f.camera!==null){f.camera.useTransitionCamera=false;}};var B=function(f){f.animation=true;};var D=function(f){f.visibility=false;};var E=function(f){if(typeof f.visibility==="object"&&f.visibility!==null){f.visibility.mode=l.Complete;}};
t.prototype.getViewInfo=function(f){if(!this._dvlSceneRef){return null;}var i={};if(typeof f!=="object"||f===null){w(i);z(i);A(i);B(i);D(i);E(i);}else{if(typeof f.camera==="object"&&f.camera!==null){i.camera={};if(typeof f.camera.matrices==="boolean"){i.camera.matrices=f.camera.matrices;}else if("matrices"in f.camera){i.camera.matrices=false;}else{z(i);}if(typeof f.camera.useTransitionCamera==="boolean"){i.camera.useTransitionCamera=f.camera.useTransitionCamera;}else if("useTransitionCamera"in f.camera){i.camera.useTransitionCamera=false;}else{A(i);}}else if(typeof f.camera==="boolean"){if(f.camera===true){i.camera={};z(i);A(i);}else{i.camera=false;}}else if("camera"in f){i.camera=false;}else{w(i);z(i);A(i);}if(typeof f.animation==="boolean"){i.animation=f.animation;}else if("animation"in f){i.animation=false;}else{B(i);}if(typeof f.visibility==="object"&&f.visibility!==null){i.visibility={};if(f.visibility.mode===l.Complete||f.visibility.mode===l.Differences){i.visibility.mode=f.visibility.mode;}else{E(i);}}else if(typeof f.visibility==="boolean"){if(f.visibility===true){i.visibility={};E(i);}else{i.visibility=false;}}else if("visibility"in f){i.visibility=false;}else{D(i);E(i);}}var j={};if(i.camera){var m=null;if(i.camera.useTransitionCamera){m=this._dvl.Renderer.GetTransitionCamera(this._dvlRendererId);if(m===sap.ve.dvl.DVLID_INVALID){m=null;}}if(m===null){m=this._dvl.Renderer.GetCurrentCamera(this._dvlRendererId);}var x=this._dvl.Camera.GetRotation(m),y=this._dvl.Camera.GetOrigin(m);j.camera={rotation:{yaw:x[0],pitch:x[1],roll:x[2]},position:{x:y[0],y:y[1],z:y[2]},projectionType:r.encodedProjectionType[this._dvl.Camera.GetProjection(m)],bindingType:r.encodedBindingType[this._dvl.Camera.GetFOVBinding(m)]};if(this._matView){j.viewMatrix=this._matView.slice();}if(this._matProj){j.projectionMatrix=this._matProj.slice();}if(j.camera.projectionType===b.Perspective){j.camera.fieldOfView=this._dvl.Camera.GetFOV(m);}else if(j.camera.projectionType===b.Orthographic){j.camera.zoomFactor=this._dvl.Camera.GetOrthoZoomFactor(m);}if(i.camera.matrices){var K=this._dvl.Renderer.GetCameraMatrices(this._dvlRendererId);j.camera.matrices={view:K.view,projection:K.projection};}}if(i.animation){var N=this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_STEP_INFO),O=N.StepId!==sap.ve.dvl.DVLID_INVALID;var P=O?N.StepId:this._lastPlayedStep,Q=O?N.StepTime:0,T=this._dvl.Scene.RetrieveProcedures(this._dvlSceneRef),U=this._getStepAndProcedureIndexes(T.procedures,P),W=this._getStepVeIdById(P);j.animation={animationTime:Q,stepIndex:U.stepIndex,procedureIndex:U.procedureIndex};if(W){j.animation.stepVeId=W;}}if(i.visibility&&this._viewStateManager){j.visibility={mode:i.visibility.mode};if(i.visibility.mode===l.Complete){var X=this._viewStateManager.getVisibilityComplete();j.visibility.visible=X.visible;j.visibility.hidden=X.hidden;}else if(this._viewStateManager.getShouldTrackVisibilityChanges()){j.visibility.changes=this._viewStateManager.getVisibilityChanges();}else{q.warning(g().getText(M.VIT32.summary),M.VIT32.code,"sap.ui.vk.dvl.Viewport");}}return j;};
t.prototype.setViewInfo=function(f,i){var j=false;if(f.animation){var m=this._dvl.Scene.RetrieveProcedures(this._dvlSceneRef),x=f.animation.procedureIndex,y=f.animation.stepIndex,K=f.animation.stepVeId,N,O=f.animation.animationTime||0;if(K||y>=0&&x>=0){if(K){N=this._getStepIdByVeId(m.procedures,f.animation.stepVeId);}else if(x>=0&&x<m.procedures.length){if(y>=0&&y<m.procedures[x].steps.length){N=m.procedures[x].steps[y].id;}else{q.error(g().getText(M.VIT26.summary),M.VIT26.code,"sap.ui.vk.dvl.Viewport");}}else{q.error(g().getText(M.VIT27.summary),M.VIT27.code,"sap.ui.vk.dvl.Viewport");}if(N){this._dvl.Renderer.ActivateStep(this._dvlRendererId,N,false,false,O);this._dvl.Renderer.PauseCurrentStep(this._dvlRendererId);}}else{j=true;}}if(f.camera){var P;if(f.camera.projectionType===b.Perspective||f.camera.projectionType===b.Orthographic){P=r.decodedProjectionType[f.camera.projectionType];}else{q.error(g().getText(M.VIT19.summary),M.VIT19.code,"sap.ui.vk.dvl.Viewport");P=sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE;}var Q=this._dvl.Scene.CreateCamera(this._dvlSceneRef,P,sap.ve.dvl.DVLID_INVALID);if(P===sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE){this._dvl.Camera.SetFOV(Q,f.camera.fieldOfView);}else if(P===sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC){this._dvl.Camera.SetOrthoZoomFactor(Q,f.camera.zoomFactor);}if(f.camera.position){this._dvl.Camera.SetOrigin(Q,f.camera.position.x,f.camera.position.y,f.camera.position.z);}if(f.camera.rotation){this._dvl.Camera.SetRotation(Q,f.camera.rotation.yaw,f.camera.rotation.pitch,f.camera.rotation.roll);}if(f.camera.bindingType){var T=r.decodedBindingType[f.camera.bindingType]||sap.ve.dvl.DVLCAMERAFOVBINDING.MIN;this._dvl.Camera.SetFOVBinding(Q,T);}i=i||0;this._dvl.Renderer.ActivateCamera(this._dvlRendererId,Q,i);this._dvl.Scene.DeleteNode(this._dvlSceneRef,Q);}if(f.viewMatrix){this._matView=f.viewMatrix.slice();}if(f.projectionMatrix){this._matProj=f.projectionMatrix.slice();}if(f.visibility){var U=this._viewStateManager.getNodeHierarchy(),W=new Map(),X=U.findNodesByName();X.forEach(function(_){var a1=U.createNodeProxy(_),b1=jQuery.grep(a1.getVeIds(),function(b1){return b1.type==="VE_LOCATOR";});b1=Array.isArray(b1)&&b1.length>0?b1[0].fields[0].value:null;U.destroyNodeProxy(a1);if(b1){W.set(b1,_);}});switch(f.visibility.mode){case l.Complete:var Y=f.visibility.visible,$=f.visibility.hidden;Y.forEach(function(_){this._viewStateManager.setVisibilityState(W.get(_),true,false);},this);$.forEach(function(_){this._viewStateManager.setVisibilityState(W.get(_),false,false);},this);break;case l.Differences:if(j){this.resetView({camera:false,visibility:true,transition:false});}f.visibility.changes.forEach(function(_){var a1=W.get(_);if(a1){this._viewStateManager.setVisibilityState(a1,!this._viewStateManager.getVisibilityState(a1),false);}},this);break;default:q.error(g().getText(M.VIT28.summary),M.VIT28.code,"sap.ui.vk.dvl.Viewport");break;}}return this;};
t.prototype.setSelectionRect=function(f){if(!f){this._dvl.Renderer.DrawSelectionRect(0,0,0,0,this._dvlRendererId);}else{this._dvl.Renderer.DrawSelectionRect(f.x1,f.y1,f.x2,f.y2,this._dvlRendererId);}};
t.prototype.getOutputSize=function(){var f=this.getViewInfo().camera.bindingType,i=this.getDomRef().getBoundingClientRect(),j=i.width,m=i.height,x;switch(r.decodedBindingType[f]){case sap.ve.dvl.DVLCAMERAFOVBINDING.MIN:x=Math.min(j,m);break;case sap.ve.dvl.DVLCAMERAFOVBINDING.MAX:x=Math.max(j,m);break;case sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ:x=j;break;case sap.ve.dvl.DVLCAMERAFOVBINDING.VERT:x=m;break;default:break;}return{left:(j-x)/2,top:(m-x)/2,sideLength:x};};
t.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}};
t.prototype.onAfterRendering=function(){var f=this.getDomRef();if(this._canvas){f.appendChild(this._canvas);}this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._handleResize({size:{width:f.clientWidth,height:f.clientHeight}});};
t.prototype._handleResize=function(f){if(this._dvlRendererId&&this._canvas){var i=f.size.width*window.devicePixelRatio;var j=f.size.height*window.devicePixelRatio;if(this._matProj){var m=this._matProj[0];var x=this._matProj[5];var y=Math.max(m,x);if(i>j){m=y*j/i;x=y;}else{m=y;x=y*i/j;}this._matProj[8]*=m/this._matProj[0];this._matProj[9]*=x/this._matProj[5];this._matProj[0]=m;this._matProj[5]=x;}this._dvl.Renderer.SetDimensions(i,j,this._dvlRendererId);this._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_DPI,96*window.devicePixelRatio,this._dvlRendererId);this._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_MIN_VISIBLE_OBJECT_SIZE,1,this._dvlRendererId);this._canvas.width=i;this._canvas.height=j;this._canvas.style.width=f.size.width+"px";this._canvas.style.height=f.size.height+"px";this.fireResize({size:{width:f.size.width,height:f.size.height}});return true;}};
t.prototype._onVisibilityChanged=t.prototype._onSelectionChanged=t.prototype._onOpacityChanged=t.prototype._onTintColorChanged=function(f){if(this._dvlRendererId){this._dvl.Renderer.ForceRenderFrame(this._dvlRendererId);}};
t.prototype.showHotspots=function(f,i,j){var m=sap.ui.vk.dvl.NodeProxy.prototype[typeof j==="string"?"setTintColor":"setTintColorABGR"];var x=function(K,j,Q){var T=K.createNodeProxy(Q);m.call(T,j);K.destroyNodeProxy(T);};if(!Array.isArray(f)){f=[f];}var y=j===undefined?this.getHotspotColorABGR():j;if(!i){y=0;}var K=this._viewStateManager.getNodeHierarchy();if(this._isSmart2DContent()){var N=[];f.forEach(function(Q){var T=n(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,Q,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN).ChildNodes);Array.prototype.push.apply(N,T);}.bind(this));Array.prototype.push.apply(N,f);N.forEach(x.bind(null,K,y));}else{var O=[];var P=function(Q){var N=K.getChildren(Q);Array.prototype.push.apply(O,N);N.forEach(P);};f.forEach(P);Array.prototype.push.apply(O,f);O.forEach(x.bind(null,K,y));}return this;};
t.prototype._getDecomposedABGR=function(i){return{red:(i>>>0&0xff)/255,green:(i>>>8&0xff)/255,blue:(i>>>16&0xff)/255,alpha:(i>>>24&0xff)/255};};
t.prototype._setBackgroundColor=function(){if(this._dvl){var f=this._getDecomposedABGR(this.getBackgroundColorTopABGR()),i=this._getDecomposedABGR(this.getBackgroundColorBottomABGR());this._dvl.Renderer.SetBackgroundColor(f.red,f.green,f.blue,f.alpha,i.red,i.green,i.blue,i.alpha,this._dvlRendererId);}};
t.prototype.setBackgroundColorTopABGR=function(i){this.setProperty("backgroundColorTopABGR",i,true);this._setBackgroundColor();return this;};
t.prototype.setBackgroundColorTop=function(f){this.setProperty("backgroundColorTop",f,true);return this.setBackgroundColorTopABGR(c(e(f)));};
t.prototype.setBackgroundColorBottomABGR=function(i){this.setProperty("backgroundColorBottomABGR",i,true);this._setBackgroundColor();return this;};
t.prototype.setBackgroundColorBottom=function(f){this.setProperty("backgroundColorBottom",f,true);return this.setBackgroundColorBottomABGR(c(e(f)));};
t.prototype.setShouldRenderFrame=function(){if(this._dvlRendererId){this._dvl.Renderer.ForceRenderFrame(this._dvlRendererId);}return this;};
t.prototype.shouldRenderFrame=function(){return this._dvlRendererId&&this._dvl.Renderer.ShouldRenderFrame(this._dvlRendererId);};
t.prototype.renderFrame=function(){if(this._dvlRendererId){if(this._matView&&this._matProj){this.renderFrameEx(this._matView,this._matProj,this._dvlRendererId);}else{this._dvl.Renderer.RenderFrame(this._dvlRendererId);}}return this;};
t.prototype.renderFrameEx=function(f,i){if(this._dvlRendererId){this._dvl.Renderer.RenderFrameEx.apply(this,[].concat(f,i),this._dvlRendererId);}return this;};
t.prototype.resetView=function(f){if(f!==undefined&&!jQuery.isPlainObject(f)){q.error(g().getText(M.VIT31.summary),M.VIT31.code,"sap.ui.vk.dvl.Viewport");}var i={camera:true,transition:true,visibility:false};jQuery.extend(i,f);if(i.camera||i.visibility){var j=(i.camera?sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA:0)|(i.transition?sap.ve.dvl.DVLRESETVIEWFLAG.SMOOTHTRANSITION:0)|(i.visibility?sap.ve.dvl.DVLRESETVIEWFLAG.VISIBILITY:0);if(this._dvlRendererId){this._dvl.Renderer.ResetView(j,this._dvlRendererId);this._lastPlayedStep=null;}}return this;};
t.prototype.canIsolateNode=function(f){if(this._dvlRendererId){return this._dvl.Renderer.CanIsolateNode(f,this._dvlRendererId);}else{return false;}};
t.prototype.setIsolatedNode=function(f){if(this._dvlRendererId){this._dvl.Renderer.SetIsolatedNode(f,this._dvlRendererId);}return this;};
t.prototype.getIsolatedNode=function(){if(this._dvlRendererId){return this._dvl.Renderer.GetIsolatedNode(this._dvlRendererId);}else{return sap.ve.dvl.DVLID_INVALID;}};
t.prototype.hitTest=function(x,y){if(this._dvlRendererId){var f=this._dvl.Renderer.HitTest(x*window.devicePixelRatio,y*window.devicePixelRatio,this._dvlRendererId).id;this.setShouldRenderFrame();return f;}else{return null;}};
t.prototype.setShowDebugInfo=function(f){this.setProperty("showDebugInfo",f,true);if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_SHOW_DEBUG_INFO,f,this._dvlRendererId);}return this;};
t.prototype._handleFrameFinished=function(f){if(f.rendererId===this._dvlRendererId){this.fireFrameRenderingFinished();}};
t.prototype.beginGesture=function(x,y){if(this._dvlRendererId){this._gesturePoint={x:x,y:y};this._dvl.Renderer.BeginGesture(x*window.devicePixelRatio,y*window.devicePixelRatio,this._dvlRendererId);}return this;};
t.prototype.endGesture=function(){if(this._dvlRendererId){this._dvl.Renderer.EndGesture(this._dvlRendererId);}return this;};
t.prototype._activateRedline=function(){this.renderFrame();var m=this._dvl.Renderer.GetCameraMatrices();this._matView=m.view;this._matProj=m.projection;};
t.prototype._deactivateRedline=function(){this._matView=null;this._matProj=null;};
t.prototype.pan=function(f,i){if(this._dvlRendererId&&!this.getFreezeCamera()){if(this._matProj){var j=this.getDomRef();this._matProj[8]-=f*2/j.clientWidth;this._matProj[9]+=i*2/j.clientHeight;this.setShouldRenderFrame();}else{this._dvl.Renderer.Pan(f*window.devicePixelRatio,i*window.devicePixelRatio,this._dvlRendererId);}this.firePan({dx:f,dy:i});}return this;};
t.prototype.rotate=function(f,i){if(this._dvlRendererId&&!this.getFreezeCamera()){this._dvl.Renderer.Rotate(f*window.devicePixelRatio,i*window.devicePixelRatio,this._dvlRendererId);this.fireRotate({dx:f,dy:i});}return this;};
function F(f){var m=f;var i=m[15]===1;var j=2/m[0];var x=2/m[5];var y,K;if(i){y=-m[12]*j;K=-m[13]*x;}else{y=m[8]*j;K=m[9]*x;}var N=(j+y)*0.5;var O=y-N;var P=(x+K)*0.5;var Q=K-P;return{left:O,top:P,right:N,bottom:Q};}
function G(f,i){var m=f;var j=m[15]===1;m[0]=2/(i.right-i.left);m[5]=2/(i.top-i.bottom);if(j){m[12]=-(i.right+i.left)/(i.right-i.left);m[13]=-(i.top+i.bottom)/(i.top-i.bottom);}else{m[8]=(i.right+i.left)/(i.right-i.left);m[9]=(i.top+i.bottom)/(i.top-i.bottom);}}
t.prototype.zoom=function(i){if(this._dvlRendererId&&!this.getFreezeCamera()){if(this._matProj){var j=this.getDomRef();var m=F(this._matProj);var x=m.left+(m.right-m.left)*this._gesturePoint.x/j.clientWidth;var y=m.top+(m.bottom-m.top)*this._gesturePoint.y/j.clientHeight;var f=1/i;m.left=x+(m.left-x)*f;m.right=x+(m.right-x)*f;m.top=y+(m.top-y)*f;m.bottom=y+(m.bottom-y)*f;G(this._matProj,m);this.setShouldRenderFrame();}else{this._dvl.Renderer.Zoom(i,this._dvlRendererId);}this.fireZoom({zoomFactor:i});}return this;};
t.prototype.zoomTo=function(f,j,m,x){if(this._dvlRendererId){var y=0;if(Array.isArray(f)){for(var i in f){y|=r.decodedZoomTo[f[i]];}}else{y=r.decodedZoomTo[f];}this._dvl.Renderer.ZoomTo(y,j,m,x,this._dvlRendererId);}return this;};
t.prototype.tap=function(x,y,i){if(this._dvlRendererId){var f=x*window.devicePixelRatio,j=y*window.devicePixelRatio;if(!i){var m=this.hitTest(x,y);var K={picked:m===sap.ve.dvl.DVLID_INVALID||m==null?[]:[m]};this.fireNodesPicked(K);if(this.getSelectionMode()===S.Exclusive){this.exclusiveSelectionHandler(K.picked);}else if(this.getSelectionMode()===S.Sticky){this.stickySelectionHandler(K.picked);}if(m!==sap.ve.dvl.DVLID_INVALID){this.fireNodeClicked({nodeRef:m,nodeId:m,x:x,y:y},true,true);}this._dvl.Renderer.Tap(f,j,false,false,this._dvlRendererId);}else if(!this.getFreezeCamera()){this._dvl.Renderer.Tap(f,j,true,false,this._dvlRendererId);}}return this;};
t.prototype.rectSelect=function(x,y,f,i){var j=[];if(this._dvlRendererId){var m=n(this._dvl.Renderer.RectSelect(x,y,f,i,this._dvlRendererId));if(m.SelectedNodes){j=m.SelectedNodes;}}return j;};
t.prototype.queueCommand=function(f){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(f,this._dvlRendererId);}return this;};
t.prototype._setContent=function(f){var i=null;if(f&&f instanceof o){i=f;}this._setScene(i);return this;};
t.prototype._setScene=function(f){var i=f&&f.getGraphicsCore();this.setGraphicsCore(i);this.setScene(f);if(f&&(this._isSmart2DContent()||this._isSmart2DContentLegacy())){this._initializeSmart2DHandler();}};
t.prototype.onSetContentConnector=function(f){V.prototype.onSetContentConnector.call(this,f);f.attachContentChangesFinished(this._onContentChangesFinished,this);};
t.prototype.onUnsetContentConnector=function(f){f.detachContentChangesFinished(this._onContentChangesFinished,this);V.prototype.onUnsetContentConnector.call(this,f);};
t.prototype._onContentChangesFinished=function(f){if(f.getSource().getContentResources().length>1){this.zoomTo(Z.Visible,sap.ve.dvl.DVLID_INVALID,0,0);}this.setShouldRenderFrame();};
t.prototype.onSetViewStateManager=function(f){this._viewStateManager=f;f.attachOpacityChanged(this._onOpacityChanged,this);f.attachSelectionChanged(this._onSelectionChanged,this);f.attachTintColorChanged(this._onTintColorChanged,this);f.attachVisibilityChanged(this._onVisibilityChanged,this);if(this._dvl){this._dvl.Renderer.SetViewStateManager(f,this._dvlRendererId);if(this._isSmart2DContent()||this._isSmart2DContentLegacy()){this._initializeSmart2DHandler();}}};
t.prototype.onUnsetViewStateManager=function(f){if(this._dvl){this._dvl.Renderer.SetViewStateManager(null,this._dvlRendererId);}f.detachOpacityChanged(this._onOpacityChanged,this);f.detachSelectionChanged(this._onSelectionChanged,this);f.detachTintColorChanged(this._onTintColorChanged,this);f.detachVisibilityChanged(this._onVisibilityChanged,this);this._viewStateManager=null;};
var H={x:-2,y:-2};var I=2;var J=5;[{key:"left",dx:-I,dy:0},{key:"right",dx:+I,dy:0},{key:"up",dx:0,dy:-I},{key:"down",dx:0,dy:+I}].forEach(function(i){t.prototype["onsap"+i.key]=function(f){this.beginGesture(H.x,H.y);this.rotate(i.dx,i.dy);this.endGesture();this.setShouldRenderFrame();f.preventDefault();f.stopPropagation();};});[{key:"left",dx:-J,dy:0},{key:"right",dx:+J,dy:0},{key:"up",dx:0,dy:-J},{key:"down",dx:0,dy:+J}].forEach(function(i){t.prototype["onsap"+i.key+"modifiers"]=function(f){if(f.shiftKey&&!(f.ctrlKey||f.altKey||f.metaKey)){this.beginGesture(H.x,H.y);this.pan(i.dx,i.dy);this.endGesture();this.setShouldRenderFrame();f.preventDefault();f.stopPropagation();}};});[{key:"minus",d:0.98},{key:"plus",d:1.02}].forEach(function(i){t.prototype["onsap"+i.key]=function(f){this.beginGesture(this.$().width()/2,this.$().height()/2);this.zoom(i.d);this.endGesture();this.setShouldRenderFrame();f.preventDefault();f.stopPropagation();};});return t;});
sap.ui.predefine('sap/ui/vk/dvl/ViewportRenderer',[],function(){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewport");r.writeClasses();r.writeAttribute("tabindex",0);r.writeAttribute("aria-label","Image");r.writeAttribute("role","figure");var a=false;var w=c.getWidth();if(w){r.addStyle("width",w);a=true;}var h=c.getHeight();if(h){r.addStyle("height",h);a=true;}if(a){r.writeStyles();}r.write(">");var i,l;var t=c.getTools();for(i=0,l=t.length;i<l;i++){var _=sap.ui.getCore().byId(t[i]);var b=_.getGizmoForContainer(c);if(b&&b.render===undefined){r.renderControl(b);}}var C=c.getContent();for(i=0,l=C.length;i<l;i++){r.renderControl(C[i]);}r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/dvl/checkResult',["sap/base/Log","../DvlException"],function(L,D){"use strict";var c=function(r){if(r<0){var m=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(r):"";L.error(m,JSON.stringify({errorCode:r}),"sap.ve.dvl");throw new D(r,m);}return r;};return c;},true);
sap.ui.predefine('sap/ui/vk/dvl/getJSONObject',["sap/base/Log","../DvlException"],function(L,D){"use strict";var g=function(o){if(typeof o==="number"){var r=o;var m=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(r):"";L.error(m,JSON.stringify({errorCode:r}),"sap.ve.dvl");throw new D(r,m);}return o;};return g;},true);
sap.ui.predefine('sap/ui/vk/dvl/getPointer',["sap/base/Log","../DvlException"],function(L,D){"use strict";var g=function(p){if(typeof p==="number"){var r=p;var m=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(r):"";L.error(m,JSON.stringify({errorCode:r}),"sap.ve.dvl");throw new D(r,m);}return p;};return g;},true);
sap.ui.predefine('sap/ui/vk/getResourceBundle',["sap/ui/core/Core","sap/base/util/ObjectPath"],function(c,O){"use strict";var g=function(){var r=c.getLibraryResourceBundle("sap.ui.vk.i18n");O.get("sap.ui.vk").getResourceBundle=function(){return r;};return r;};return g;},true);
sap.ui.predefine('sap/ui/vk/glMatrix',["./thirdparty/gl-matrix"],function(g){"use strict";g.glMatrix.setMatrixArrayType(Float64Array);return g;});
sap.ui.predefine('sap/ui/vk/helpers/RotateOrbitHelperDvl',["sap/ui/base/EventProvider"],function(E){"use strict";
var R=E.extend("sap.ui.vk.helpers.RotateOrbitHelperDvl",{
metadata:{publicMethods:["rotate"]},
constructor:function(a,D){this._tool=a;this._dvl=D;this._dvlRendererId=this._tool._viewport._dvlRendererId;}
});
R.prototype.destroy=function(){this._rotateOrbitTool=null;};
R.prototype.activateOrbitMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,true);}return this;};
R.prototype.deactivateOrbitMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,false);}return this;};
R.prototype.rotate=function(d,a){if(this._dvlRendererId){this._dvl.Renderer.Rotate(d*window.devicePixelRatio,a*window.devicePixelRatio,this._dvlRendererId);this._tool.fireRotate({dx:d,dy:a});}return this;};
return R;});
sap.ui.predefine('sap/ui/vk/helpers/RotateOrbitHelperThree',["sap/ui/base/EventProvider"],function(E){"use strict";
var R=E.extend("sap.ui.vk.helpers.RotateOrbitHelperThree",{
metadata:{publicMethods:["rotate"]},
constructor:function(r){this._tool=r;}
});
R.prototype.destroy=function(){this._tool=null;};
R.prototype.activateOrbitMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=false;return this;};
R.prototype.deactivateOrbitMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=true;return this;};
R.prototype.rotate=function(d,a){this._tool._viewport._viewportGestureHandler._cameraController.rotate(d,a,false);return this;};
return R;});
sap.ui.predefine('sap/ui/vk/helpers/RotateTurntableHelperDvl',["sap/ui/base/EventProvider"],function(E){"use strict";
var R=E.extend("sap.ui.vk.helpers.RotateTurntableHelperDvl",{
metadata:{publicMethods:["rotate"]},
constructor:function(a,D){this._tool=a;this._dvl=D;this._dvlRendererId=this._tool._viewport._dvlRendererId;}
});
R.prototype.destroy=function(){this._rotateOrbitTool=null;};
R.prototype.activateTurntableMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,false);}return this;};
R.prototype.deactivateTurntableMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,true);}return this;};
R.prototype.rotate=function(d,a){if(this._dvlRendererId){this._dvl.Renderer.Rotate(d*window.devicePixelRatio,a*window.devicePixelRatio,this._dvlRendererId);this._tool.fireRotate({dx:d,dy:a});}return this;};
return R;});
sap.ui.predefine('sap/ui/vk/helpers/RotateTurntableHelperThree',["sap/ui/base/EventProvider"],function(E){"use strict";
var R=E.extend("sap.ui.vk.helpers.RotateTurntableHelperThree",{
metadata:{publicMethods:["rotate"]},
constructor:function(r){this._tool=r;}
});
R.prototype.destroy=function(){this._tool=null;};
R.prototype.activateTurntableMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=true;return this;};
R.prototype.deactivateTurntableMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=false;return this;};
R.prototype.rotate=function(d,a){this._tool._viewport._viewportGestureHandler._cameraController.rotate(d,a,true);this._tool.fireRotate({dx:d,dy:a});return this;};
return R;});
sap.ui.predefine('sap/ui/vk/helpers/WorkerScriptLoader',["sap/ui/thirdparty/URI"],function(U){"use strict";var W={};
W.absoluteUri=function(s){var u=new U(sap.ui.require.toUrl(s));if(u.is("relative")){u=u.absoluteTo(new U(document.baseURI));}return u;};
W.loadScript=function(w,a){var u=this.absoluteUri(w);var s=[];if(a&&a.length>0){a.forEach(function(b){s.push("'"+this.absoluteUri(b)+"'");},this);}if(sap.ui.Device.browser.internet_explorer){s.push("'"+this.absoluteUri("sap/ui/thirdparty/es6-promise.js")+"'");s.push("'"+this.absoluteUri("sap/ui/thirdparty/es6-string-methods.js")+"'");s.push("'"+this.absoluteUri("sap/ui/vk/thirdparty/ie-polyfills.js")+"'");}s.push("'"+u.toString()+"'");return new Worker((window.URL||window.webkitURL).createObjectURL(new Blob(["importScripts("+s.join()+");"],{"type":"application/javascript"})));};
return W;});
sap.ui.predefine('sap/ui/vk/matai/MataiLoader',["sap/base/Log","sap/ui/base/ManagedObject","../getResourceBundle","../threejs/SceneBuilder","../svg/SceneBuilder","../helpers/WorkerScriptLoader","../DownloadManager"],function(L,M,g,S,a,W,D){"use strict";var P={FinishedTree:g().getText("SCENE_CONTEXT_FINISHED_TREE"),LoadingGeometries:g().getText("SCENE_CONTEXT_LOADING_GEOMETRIES"),LoadingTextures:g().getText("SCENE_CONTEXT_LOADING_TEXTURES"),LoadingModelViews:g().getText("SCENE_CONTEXT_LOADING_MODEL_VIEWS")};
var b=M.extend("sap.ui.vk.matai.MataiLoader",{metadata:{events:{contentChangesProgress:{parameters:{source:"any",phase:"string",percent:"float"}},contentLoadingFinished:{parameters:{source:"any",node:"any"}}}}});
function u(s,p,d){var e=s._progress;e.phase=p;e.count=d;var f=40+60*(e.totalCount?e.count/e.totalCount:1);s._loader.fireContentChangesProgress({source:s._contentResource.getSource(),phase:p,percentage:Math.min(f,100)});}
var c=(function(){var p;return function(){return p||(p=new Promise(function(r,d){var m="sap/ui/vk/ve/matai.js";if(sap.ui.Device.browser.internet_explorer){m="sap/ui/vk/ve/matai_asm.js";}var w=W.loadScript("sap/ui/vk/matai/MataiLoaderWorker.js",[m]);w.onmessage=function(h){var i=h.data;if(i.ready){r(this);}else{var s=this._sceneBuilders[i.sceneBuilderId];try{s[i.method].apply(s,i.args);}catch(e){L.error("SceneBuilder."+i.method+"()",e);}switch(i.method){case"setScene":var j=i.args[0];s._progress.totalCount=j.meshCount+j.imageCount+j.modelViewCount;u(s,P.FinishedTree,0);break;case"setGeometry":u(s,P.LoadingGeometries,s._progress.count+1);break;case"createImage":u(s,P.LoadingTextures,s._progress.count+1);break;case"createThumbnail":u(s,P.LoadingModelViews,s._progress.count+1);break;default:break;}}};w.onerror=function(e){d(e);};var f=W.absoluteUri("sap/ui/vk/ve").toString()+"/";w.postMessage({method:"createRuntime",scriptDirectory:f});}));};})();
function l(d,e,f,p,h,r,i){c().then(function(w){w.onerror=function(j){L.error("Error in WebWorker",j);i(g().getText("LOADER_ERRORREADINGFILE"));};var s=new(p.isObject3D?S:a)(p,h,r,i);s._loader=d;s._progress={};w._sceneBuilders=w._sceneBuilders||[];s._id=w._sceneBuilders.length;w._sceneBuilders.push(s);w.postMessage({method:"loadSceneFromArrayBuffer",sceneBuilderId:s._id,buffer:e,fileName:f,sourceLocation:"remote"},[e]);},function(j){i(j);});}
b.prototype.load=function(p,d){var t=this;return new Promise(function(r,f){if(typeof d.getSource()==="string"){var h=d.getSource();new D([h]).attachItemSucceeded(function(e){var s=e.getParameter("source");var j=e.getParameter("response");l(t,j,s,p,d,r,f);},this).attachItemFailed(function(e){var j=e.getParameter("statusText");if(j==""){j=g().getText("VIEWER_SOURCE_FAILED_TO_DOWNLOAD_CAUSE");}f(j);},this).start();}else if(d.getSource()instanceof File){var i=new FileReader();i.onload=function(e){l(t,e.target.result,d.getSource().name,p,d,r,f);};i.onerror=function(e){f(e);};i.readAsArrayBuffer(d.getSource());}});};
return b;});
sap.ui.predefine('sap/ui/vk/svg/BaseNodeProxy',["../BaseNodeProxy"],function(B){"use strict";
var a=B.extend("sap.ui.vk.svg.BaseNodeProxy",{metadata:{}});
a.prototype.init=function(n,b){this._element=b;};
a.prototype.reset=function(){this._element=null;};
a.prototype.getNodeRef=function(){return this._element;};
a.prototype.getNodeId=function(){return this._element;};
a.prototype.getName=function(){return this._element.name||("<"+this._element.type+">");};
a.prototype.getNodeMetadata=function(){return this._element.userData.metadata||{};};
a.prototype.getSceneRef=function(){return this._element;};
return a;});
sap.ui.predefine('sap/ui/vk/svg/ContentDeliveryService',["sap/base/Log","sap/ui/base/ManagedObject","../totara/TotaraLoader","../svg/SceneBuilder","../getResourceBundle","../ObjectType"],function(L,M,T,S,g,O){"use strict";
var C=M.extend("sap.ui.vk.svg.ContentDeliveryService",{
metadata:{properties:{authorizationHandler:"any",maxActiveRequests:{type:"int",defaultValue:4},maxUrlLength:{type:"int",defaultValue:2048},meshesBatchSize:{type:"int",defaultValue:128},materialsBatchSize:{type:"int",defaultValue:128},geometriesBatchSize:{type:"int",defaultValue:128},geometriesMaxBatchDataSize:{type:"int",defaultValue:1048576},geomMeshesBatchSize:{type:"int",defaultValue:128},geomMeshesMaxBatchDataSize:{type:"int",defaultValue:1048576},annotationsBatchSize:{type:"int",defaultValue:128},tracksBatchSize:{type:"int",defaultValue:128},sequencesBatchSize:{type:"int",defaultValue:128},voxelThreshold:{type:"number",defaultValue:0.0},skipLowLODRendering:{type:"boolean",defaultValue:false}},events:{cameraChanged:{parameters:{sceneId:{type:"string"},camera:{type:"any"}},enableEventBubbling:true},sceneUpdated:{parameters:{},enableEventBubbling:true},viewGroupUpdated:{parameters:{currentViewGroupId:"string"},enableEventBubbling:true},sceneCompleted:{parameters:{sceneId:{type:"string"}},enableEventBubbling:true},loadingFinished:{parameters:{currentViewId:"string",currentViewGroupId:"string"},enableEventBubbling:true},contentChangesProgress:{parameters:{percent:"float"}},errorReported:{parameters:{error:{type:"any"}}},initialViewCompleted:{parameters:{sceneId:{type:"string"}},enableEventBubbling:true}}},
constructor:function(i,s){this._loader=new T();this._loader.setSceneBuilder(new S());M.apply(this,arguments);this._transientSceneMap=new Map();this._currentNodeHierarchy=null;}
});
C.prototype.getMaxActiveRequests=function(){return this._loader.getMaxActiveRequests();};
C.prototype.setMaxActiveRequests=function(m){this._loader.setMaxActiveRequests(m);return this;};
C.prototype.getMaxUrlLength=function(){return this._loader.getMaxUrlLength();};
C.prototype.setMaxUrlLength=function(m){this._loader.setMaxUrlLength(m);return this;};
C.prototype.getMeshesBatchSize=function(){return this._loader.getMeshesBatchSize();};
C.prototype.setMeshesBatchSize=function(m){this._loader.setMeshesBatchSize(m);return this;};
C.prototype.getMaterialsBatchSize=function(){return this._loader.getMaterialsBatchSize();};
C.prototype.setMaterialsBatchSize=function(m){this._loader.setMaterialsBatchSize(m);return this;};
C.prototype.getGeometriesBatchSize=function(){return this._loader.getGeometriesBatchSize();};
C.prototype.setGeometriesBatchSize=function(a){this._loader.setGeometriesBatchSize(a);return this;};
C.prototype.getGeometriesMaxBatchDataSize=function(){return this._loader.getGeometriesMaxBatchDataSize();};
C.prototype.setGeometriesMaxBatchDataSize=function(a){this._loader.setGeometriesMaxBatchDataSize(a);return this;};
C.prototype.getGeomMeshesBatchSize=function(){return this._loader.getGeomMeshesBatchSize();};
C.prototype.setGeomMeshesBatchSize=function(a){this._loader.setGeomMeshesBatchSize(a);return this;};
C.prototype.getGeomMeshesMaxBatchDataSize=function(){return this._loader.getGeomMeshesMaxBatchDataSize();};
C.prototype.setGeomMeshesMaxBatchDataSize=function(a){this._loader.setGeomMeshesMaxBatchDataSize(a);return this;};
C.prototype.getAnnotationsBatchSize=function(){return this._loader.getAnnotationsBatchSize();};
C.prototype.setAnnotationsBatchSize=function(a){this._loader.setAnnotationsBatchSize(a);return this;};
C.prototype.getTracksBatchSize=function(){return this._loader.getTracksBatchSize();};
C.prototype.setTracksBatchSize=function(t){this._loader.setTracksBatchSize(t);return this;};
C.prototype.getSequencesBatchSize=function(){return this._loader.getSequencesBatchSize();};
C.prototype.setSequencesBatchSize=function(s){this._loader.setSequencesBatchSize(s);return this;};
C.prototype.getVoxelThreshold=function(){return this._loader.getVoxelThreshold();};
C.prototype.setVoxelThreshold=function(v){this._loader.setVoxelThreshold(v);return this;};
C.prototype.getSkipLowLODRendering=function(){return this._loader.getSkipLowLODRendering();};
C.prototype.setSkipLowLODRendering=function(s){this._loader.setSkipLowLODRendering(s);return this;};
function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:(r&0x3|0x8);return v.toString(16).toLowerCase();});}
C.prototype.initUrl=function(a,k,c){var t=this;function n(){t.fireSceneUpdated({});}function b(){var d;if(t._loader&&t._loader.currentSceneInfo){var e=t._loader.getContext(t._loader.currentSceneInfo.id);if(e){d=e.currentViewGroupId;}}t.fireViewGroupUpdated({currentViewGroupId:d});}if(!this._loader.running()||this._loader.getUrl()!==a){if(this._loader.running()){var s=this._loader.sceneBuilder;this._loader.dispose();this._loader=new T();this._loader.setSceneBuilder(s);}this._loader.onErrorCallbacks.attach(this._reportError.bind(t));this._loader.onMaterialFinishedCallbacks.attach(n);this._loader.onImageFinishedCallbacks.attach(n);this._loader.onSetGeometryCallbacks.attach(n);this._loader.onViewGroupUpdatedCallbacks.attach(b);this._loader.setUrl(a);this._loader.setCorrelationId(c?c:u());return this._loader.run();}else if(!k){this._loader.cleanup();}return Promise.resolve("Loader is ready");};
C.prototype._reportError=function(e){this.fireErrorReported(e);};
C.prototype._createLoadParam=function(r,a,p,c){var t=this;var i;var s=false;var b;if(this._currentNodeHierarchy){b=this._currentNodeHierarchy.getScene();}var d={root:p,includeHidden:c.getIncludeHidden(),includeAnimation:c.getIncludeAnimation(),pushPMI:c.getPushPMI(),includeBackground:c.getIncludeBackground(),includeParametric:c.getIncludeParametric(),metadataFilter:c.getMetadataFilter(),useSecureConnection:c.getUseSecureConnection(),activateView:c.getActivateView(),enableLogger:c.getEnableLogger()===true,pushViewGroups:c.getPushViewGroups(),vkScene:b,onActiveCamera:function(n){var f=false;var h=t._loader.getContext(c.getVeid());if(h&&h.phase<2){i=n;f=true;}if(!f){t.fireCameraChanged({sceneId:c.getVeid(),camera:n});}},onInitialSceneFinished:function(f){s=true;r({node:p,camera:i,contentResource:c,initialView:f,annotations:t.getSceneBuilder()._annotations,loader:t});},onSceneCompleted:function(){t.fireSceneCompleted({sceneId:c.getVeid()});},onLoadingFinished:function(){var f,h;if(t._loader&&t._loader.currentSceneInfo){var j=t._loader.getContext(t._loader.currentSceneInfo.id);if(j){f=j.currentViewId;h=j.currentViewGroupId;}}t.fireLoadingFinished({currentViewId:f,currentViewGroupId:h});},onContentChangesProgress:function(f){t.fireContentChangesProgress({source:f.source,phase:f.phase,percentage:f.percentage});},onInitialViewCompleted:function(){t.fireInitialViewCompleted({sceneId:c.getVeid()});}};var e=function(f){L.warning("Content loading error reported:",JSON.stringify(f.getParameters()));var h;if(f.getParameter("errorText")){h=f.getParameter("errorText");}else if(f.getParameter("error")){h=f.getParameter("error");}else if(f.getParameter("reason")){h=f.getParameter("reason");}else{h="failed to load: unknown reason";}if(s){var j=f.getParameter("error");if(j&&j===4){t.initUrl(this._loader.getUrl(),true);}}else{t.detachErrorReported(e);if(f.getParameter("events")){h=h+"\n"+JSON.stringify(f.getParameter("events"));}a(h);}};t.attachErrorReported(e);return d;};
C.prototype.load=function(p,c,a){var t=this;var n=c.getNodeProxy();if(n){this._currentNodeHierarchy=n.getNodeHierarchy();}return new Promise(function(r,b){if(!c.getSource()||!c.getVeid()){b(g().getText("CONTENTDELIVERYSERVICE_MSG_NOURLORVEID"));return;}t.initUrl(c.getSource(),true);var d=t._createLoadParam(r,b,p,c);if(t._loader){t._loader.request(c.getVeid(),d,a);}});};
C.prototype.getSceneBuilder=function(){if(this._loader){return this._loader.getSceneBuilder();}return null;};
C.prototype.decrementResourceCountersForDeletedTreeNode=function(s){var c=this._loader.getContext(this._loader.currentSceneInfo.id);this._loader.decrementResourceCountersForDeletedTreeNode(c,s);};
C.prototype.loadTransientScene=function(s,p,a){var t=this;return new Promise(function(r,b){if(!s||!p){b(g().getText("CONTENTDELIVERYSERVICE_MSG_INVALIDARGUMENTS"));return;}if(t._transientSceneMap.has(s)){var c=t._transientSceneMap.get(s).clone();p.add(c);r({nodeRef:c});return;}if(!t._loader){b(g().getText("CONTENTDELIVERYSERVICE_MSG_CONTENTDELIVERYSERVICENOTINITIALISED"));return;}var h=function(){t.detachLoadingFinished(h);if(t._transientSceneMap.get(s)){var c=t._transientSceneMap.get(s).clone();p.add(c);r({nodeRef:c});}};if(t._loader.contextMap.has(s)){t.attachLoadingFinished(h);return;}var d={};d.name="transient";d.userData.currentSceneId=t.getSceneBuilder()._currentSceneId;var o=function(){var f=t._loader.getContext(s);f.onSceneCompletedCallbacks.detach(o);d.userData.entityId=f.defaultRootEntityId;t._transientSceneMap.set(s,d);var c=d.clone();p.add(c);r({nodeRef:c});};var e={root:d,onSceneCompleted:o,useSecureConnection:a};t._loader.request(s,e);});};
C.prototype.update=function(s,a,v){var t=this;return new Promise(function(r,b){if(!t._loader){b(g().getText("CONTENTDELIVERYSERVICE_MSG_CONTENTDELIVERYSERVICENOTINITIALISED"));return;}t._loader.update(s,a,v).then(function(c){if(t._currentNodeHierarchy){for(var i=0;i<c.replacedNodeRefs.length;i++){t._currentNodeHierarchy.fireNodeReplaced({ReplacedNodeRef:c.replacedNodeRefs[i],ReplacementNodeRef:c.replacementNodeRefs[i],ReplacedNodeId:c.replacedNodeRefs[i],ReplacementNodeId:c.replacementNodeRefs[i]});}}r({sceneVeId:c.sceneVeId,sids:c.sidArray});}).catch(function(e){return b(e);});});};
C.prototype.exit=function(){if(this._loader){this._loader.dispose();this._loader=null;}this._transientSceneMap=null;};
C.prototype.loadView=function(s,v,t,a){if(typeof t==="undefined"){t="static";}var b=this;return this._loader.requestView(s,t,v,null,a).then(function(c){if(b._currentNodeHierarchy&&c.updatedNodes){for(var i=0;i<c.updatedNodes.length;i++){b._currentNodeHierarchy.fireNodeUpdated({nodeRef:c.updatedNodes[i]});}}b.fireSceneUpdated({});return c;}).catch(function(e){L.error(e);return null;});};
C.prototype.updatePlaybacks=function(s,v,p){var t=this;return this._loader.requestView(s,"static",v,p,true).then(function(a){if(t._currentNodeHierarchy&&a.updatedNodes){for(var i=0;i<a.updatedNodes.length;i++){t._currentNodeHierarchy.fireNodeUpdated({nodeRef:a.updatedNodes[i]});}}t.fireSceneUpdated({});return a;}).catch(function(e){L.error(e);return null;});};
C.prototype.loadViewGroup=function(s,v,i){var t=this;return this._loader.requestViewGroup(s,v,i).then(function(a){t.fireSceneUpdated({});return a;}).catch(function(e){L.error(e);return null;});};
C.prototype.assignMaterialToNodes=function(s,m,n,a){return(Promise.resolve());};
C.prototype.printLogTokens=function(){if(this._loader){this._loader.printLogTokens();return true;}else{return false;}};
return C;});
sap.ui.predefine('sap/ui/vk/svg/ContentManager',["sap/base/Log","../ContentManager","./Scene","./SceneBuilder","./Element","../Messages","../getResourceBundle","./Viewport","./ViewStateManager"],function(L,C,S,a,E,M,g){"use strict";
var b=C.extend("sap.ui.vk.svg.ContentManager",{metadata:{library:"sap.ui.vk",events:{errorReported:{parameters:{error:{type:"any"}}}}}});
var c=b.getMetadata().getParent().getClass().prototype;
b.prototype.init=function(){if(c.init){c.init.call(this);}};
b.prototype.exit=function(){if(this.defaultCdsLoader){this.defaultCdsLoader.destroy();this.defaultCdsLoader=null;}if(c.exit){c.exit.call(this);}};
b.prototype._handleContentChangesProgress=function(e){this.fireContentChangesProgress({phase:e.getParameter("phase"),source:e.getParameter("source"),percentage:e.getParameter("percentage")});};
b.prototype._handleContentLoadingFinished=function(e){this.fireContentLoadingFinished({source:e.getParameter("source"),node:e.getParameter("node")});};
b.prototype.loadContent=function(d,e){var t=this;var l=function(){t.fireContentChangesStarted();var s=new S();t._loadContentResources(s,e).then(function(v){L.info("Content loading resolved",v);if(v&&v.length>0&&v[0].initialView){s.setInitialView(v[0].initialView);}var i;for(i=0;i<v.length;i++){if(v[i].camera){s.camera=v[i].camera;break;}}if(v.length>0){var f=v[0];s.backgroundTopColor=f.backgroundTopColor;s.backgroundBottomColor=f.backgroundBottomColor;}for(i=0;i<v.length;i++){if(v[i].loader){s.loaders=s.loaders||[];s.loaders.push(v[i].loader);}if(v[i].builder){s.builders=s.builders||[];s.builders.push(v[i].builder);}}if(t._totaraLoader){s.setSceneBuilder(t._totaraLoader.getSceneBuilder());}t.fireContentChangesFinished({content:s});},function(r){L.info("Content loading rejected:",r);var f;if(typeof r==="string"){f=r;}else if(r.errorText){f=r.errorText;}else if(r.message){f=r.message;}f=f||g().getText(M.VIT37.summary);L.error(g().getText("CONTENTMANAGER_MSG_CONTENTRESOURCESFAILEDTOLOAD"),f);t.fireContentChangesFinished({content:null,failureReason:[{error:r,errorMessage:f}]});});};l();return this;};
b.prototype._getTotaraLoader=function(){if(this._totaraLoader==null){return new Promise(function(r){var t="sap/ui/vk/totara/TotaraLoader";sap.ui.require([t],function(d){var l=new d();l.setSceneBuilder(new a());r(l);});});}return Promise.resolve(this._totaraLoader);};
b.prototype._getMataiLoader=function(){if(this._mataiLoader==null){var t=this;return new Promise(function(r){var m="sap/ui/vk/matai/MataiLoader";sap.ui.require([m],function(d){r(t._mataiLoader=new d());});});}return Promise.resolve(this._mataiLoader);};
b.prototype._createLoadParam=function(r,d,p,e){var t=this;var i;var s=false;var f={root:p,includeHidden:e.getIncludeHidden(),pushPMI:true,includeBackground:e.getIncludeBackground(),includeParametric:true,includeAnimation:false,metadataFilter:e.getMetadataFilter(),useSecureConnection:e.getUseSecureConnection(),enableLogger:e.getEnableLogger()===true,vkScene:this._currentScene,onActiveCamera:function(n){i=n;},onInitialSceneFinished:function(j){s=true;r({node:p,contentResource:e,initialView:j,camera:i,loader:t._totaraLoader});},onLoadingFinished:function(){t.fireContentLoadingFinished({source:e,node:p});},onContentChangesProgress:function(j){t.fireContentChangesProgress({source:j.source,phase:j.phase,percentage:j.percentage});}};var h=function(j){L.warning("Content loading error reported:",JSON.stringify(j.getParameters()));var k;if(j.getParameter("errorText")){k=j.getParameter("errorText");}else if(j.getParameter("error")){k=j.getParameter("error");}else if(j.getParameter("reason")){k=j.getParameter("reason");}else{k="failed to load: unknown reason";}if(s){var l=j.getParameter("error");if(l&&l===4){t.initUrl(this._loader.getUrl(),true);}}else{t.detachErrorReported(h);if(j.getParameter("events")){k=k+"\n"+JSON.stringify(j.getParameter("events"));}d(k);}};t.attachErrorReported(h);return f;};
b.prototype._reportError=function(e){this.fireErrorReported(e);};
b.prototype._loadStream=function(p,d){var t=this;return new Promise(function(r,e){t._getTotaraLoader().then(function(l){t._totaraLoader=l;var f=t._createLoadParam(r,e,p,d);l.onErrorCallbacks.attach(t._reportError.bind(t));l.setUrl(d.getSource());l.run();l.request(d.getVeid(),f,t._authorizationHandler);});});};
b.prototype._loadVDS4=function(p,d){var t=this;return this._getMataiLoader().then(function(l){if(l){l.attachContentChangesProgress(t._handleContentChangesProgress,t);l.attachContentLoadingFinished(t._handleContentLoadingFinished,t);return l.load(p,d);}else{return Promise.resolve({node:p,contentResource:d});}});};
b.prototype._loadContentResources=function(s,d){this._currentScene=s;this._currentNodeHierarchy=s.getDefaultNodeHierarchy();var p=[];var t=this;d.forEach(function k(e,f){var h=new E();h.name=f.getName();h.sourceId=f.getSourceId();e.add(h);f._shadowContentResource={nodeProxy:this._currentNodeHierarchy.createNodeProxy(h)};var i=f._contentManagerResolver;var l=i&&i.settings?i.settings.loader:null;if(l){if(typeof l==="function"){p.push(l(h,f,t._authorizationHandler));}else if(l&&l.load){this._totaraLoader=l;h.matrix=new Float32Array([1,0,0,-1,0,0]);p.push(l.load(h,f,t._authorizationHandler));l._loader.onLoadingFinishedCallbacks.attach(function(){t.fireContentLoadingFinished({source:f,node:h});});}else{p.push(Promise.resolve({node:h,contentResource:f}));}}else{var j=f.getSourceType();switch(j?j.toLowerCase():null){case"stream2d":{h.matrix=new Float32Array([1,0,0,-1,0,0]);p.push(this._loadStream(h,f));break;}case"vds4-2d":{h.matrix=new Float32Array([1,0,0,-1,0,0]);p.push(this._loadVDS4(h,f));break;}default:break;}}}.bind(this,s.getRootElement()));return Promise.all(p);};
return b;});
sap.ui.predefine('sap/ui/vk/svg/Curve',["./Element"],function(E){"use strict";var C=function(p){p=p||{};E.call(this,p);this.type="Curve";this.points=new Float32Array(p.points||[0,0,100,0,100,100,0,100]);this.closed=p.closed||false;this.setMaterial(p.material);};C.prototype=Object.assign(Object.create(E.prototype),{constructor:C});
C.prototype.tagName=function(){return"path";};
C.prototype._expandBoundingBox=function(b,m){var s=this.strokeWidth*0.5;var p=this.points;for(var i=0,l=p.length-1;i<l;i+=2){this._expandBoundingBoxCE(b,m,p[i],p[i+1],s,s);}};
C.prototype._setSpecificAttributes=function(s){var p=this.points;var d=["M",p[0],p[1]];for(var i=2,l=p.length-5;i<l;i+=6){d.push("C",p[i],p[i+1],p[i+2],p[i+3],p[i+4],p[i+5]);}if(this.closed){d.push("Z");}s("d",d.join(" "));s("stroke-linejoin","round");};
return C;});
sap.ui.predefine('sap/ui/vk/svg/Element',["../abgrToColor","../cssColorToColor","../NodeContentType","sap/base/util/uid"],function(d,e,N,u){"use strict";var E=function(a){a=a||{};this.type="Group";this.uid=u();this.sid=a.sid||undefined;this.name=a.name||undefined;this.vMask=(1|0);this.sMask=(0|0);this.matrix=new Float32Array(a.matrix||[1,0,0,1,0,0]);this.parent=null;this.children=[];this.domRef=null;this.nodeContentType=N.Regular;this.materialId=a.materialID;if(a.lineStyle){this.lineStyle=a.lineStyle;}if(a.fillStyle){this.fillStyle=a.fillStyle;}this.userData=a.subelement?{skipIt:true}:{};};
function h(c,a){if(c){if(typeof c==="string"){c=e(c);return new Float32Array([c.red/255,c.green/255,c.blue/255,c.alpha]);}else if(c.length===4){return new Float32Array(c);}else{return new Float32Array([c[0],c[1],c[2],a]);}}return new Float32Array([0,0,0,a]);}
E.prototype.isFillable=function(){return true;};
E.prototype.defaultFillAlpha=0;
E.prototype.setMaterial=function(m,a){m=m||{};if(this.materialId===m.materialId){var f=this.fillStyle;if(f){this.fill=h(f.colour,1);}else{this.fill=new Float32Array([0,0,0,0]);}var b=this.lineStyle;if(b){this.stroke=h(b.colour,1);this.strokeWidth=b.width||1;this.strokeDashArray=E._convertDashes(b.dashes||[],this.strokeWidth);}else{this.stroke=h(m.lineColor,1);this.strokeWidth=m.lineWidth!==undefined?m.lineWidth:1;this.strokeDashArray=(m.lineStyle&&m.lineStyle.dashPattern)||[];}if(m.lineStyle&&m.lineStyle.widthCoordinateSpace!==undefined){this.widthCoordinateSpace=m.lineStyle.widthCoordinateSpace;}}for(var i=0,l=this.children.length;i<l;i++){this.children[i].setMaterial(m);}if(a){this.invalidate();}};
E._convertDashes=function(a,s){var b=[];for(var i=0;i<a.length;i++){var n=a[i]*10;if(n>0){b.push(n);b.push(0);}else if(n<0){b.push(0);b.push(-n);}else{b.push(s);b.push(s);}}return b;};
E.prototype.add=function(a){if(a.parent!==null){a.parent.remove(a);}a.parent=this;this.children.push(a);a.sMask=this.sMask;if(this.highlightColor){a.highlightColor=this.highlightColor;}return this;};
E.prototype.remove=function(a){var i=this.children.indexOf(a);if(i!==-1){a.parent=null;this.children.splice(i,1);this.invalidate();}return this;};
E.prototype.replace=function(a,n){var i=this.children.indexOf(a);if(i!==-1){a.parent=null;n.parent=this;this.children[i]=n;n.domRef=a.domRef;n.invalidate();}return this;};
E.prototype._vkPersistentId=function(){var a=this;do{if(a.sid){return a.sid;}a=a.parent;}while(a);return null;};
E.prototype._vkGetNodeContentType=function(){return this.nodeContentType;};
E.prototype._initAsHotspot=function(a){function r(c){if(c){c[0]=0;c[1]=0;c[2]=0;c[3]=c[3]>0?1:1e-4;}}if(a!==undefined){this.opacity=a;}this.traverse(function(n){if(n!==this){n.userData.skipIt=true;}r(n.fill);r(n.stroke);}.bind(this));};
E.prototype._vkSetNodeContentType=function(n){this.nodeContentType=n;if(n===N.Hotspot){this._initAsHotspot(0);}};
E.prototype.traverse=function(c){c(this);var a=this.children;for(var i=0,l=a.length;i<l;i++){a[i].traverse(c);}};
E.prototype.traverseAncestors=function(c){var a=this.parent;if(a!==null){c(a);a.traverseAncestors(c);}};
E.prototype.traverseVisible=function(c,m){if(this.isVisible(m)){c(this);var a=this.children;for(var i=0,l=a.length;i<l;i++){a[i].traverseVisible(c,m);}}};
E.prototype.setVisible=function(m,v){if(!this.userData.skipIt){if(v){this.vMask|=m;}else{this.vMask&=~m;}if(this.domRef!==null){if(v){this.domRef.removeAttribute("display");}else{this.domRef.setAttribute("display","none");}}}};
E.prototype.isVisible=function(m){return this.userData.skipIt||(this.vMask&m)!==0;};
E.prototype._updateColor=function(m){if(this.domRef!==null){if(this.fill!==undefined){this.domRef.setAttribute("fill",this._cssColor(this.fill,m));}if(this.stroke!==undefined&&this.stroke[3]>0&&this.strokeWidth){this.domRef.setAttribute("stroke",this._cssColor(this.stroke,m));}}};
E.prototype.setSelected=function(m,s,a){if(s){this.sMask|=m;this.highlightColor=a;}else{this.sMask&=~m;delete this.highlightColor;}this._updateColor(m);if(this.nodeContentType===N.Hotspot){this.setOpacity(m,this.opacity);}};
E.prototype.isSelected=function(m){return(this.sMask&m)!==0;};
E.prototype.setTintColor=function(m,a){this.tintColor=a;this._updateColor(m);};
E.prototype._setOpacity=function(m,a){if(this.domRef!==null){if(a!==undefined){this.domRef.setAttribute("opacity",this.nodeContentType===N.Hotspot&&this.isSelected(m)?(a*0.5+0.5):a);}else{this.domRef.removeAttribute("opacity");}}};
E.prototype._isGeometryNode=function(){return this.type!=="Group";};
E.prototype._getFurthestParentWithOpacity=function(){var a=this.parent;var b;while(a){if(a.opacity){b=a.opacity;}a=a.parent;}return b;};
E.prototype.setOpacity=function(m,a){if(this._isGeometryNode()){return;}var b=[];this.opacity=a;if(this.nodeContentType===N.Hotspot){this._setOpacity(m,a);return;}this.traverse(function(c){if(c._isGeometryNode()){b.push(c);}});b.forEach(function(l){var s=a;if(a===undefined){if(l.opacity){s=l.opacity;}else{s=l._getFurthestParentWithOpacity();}}l._setOpacity(m,s);});};
function j(m){return m[0]===1&&m[1]===0&&m[2]===0&&m[3]===1&&m[4]===0&&m[5]===0;}
E.prototype.setMatrix=function(m){this.matrix=m;if(this.domRef!==null){if(!j(m)){this.domRef.setAttribute("transform","matrix("+this.matrix.join(",")+")");}else{this.domRef.removeAttribute("transform");}}};
E._multiplyMatrices=function(a,b){var c=a[0],f=a[2],g=a[4];var i=a[1],l=a[3],m=a[5];var n=b[0],q=b[2],r=b[4];var s=b[1],v=b[3],w=b[5];return new Float32Array([c*n+f*s,i*n+l*s,c*q+f*v,i*q+l*v,c*r+f*w+g,i*r+l*w+m]);};
E._invertMatrix=function(m){var a=m[0],b=m[1],c=m[2],f=m[3],g=m[4],i=m[5],l=a*f-b*c;if(l===0){return new Float32Array([0,0,0,0,0,0]);}var n=1/l;var q=new Float32Array(6);q[0]=f*n;q[1]=-b*n;q[2]=-c*n;q[3]=a*n;q[4]=(i*c-f*g)*n;q[5]=(b*g-i*a)*n;return q;};
E._decompose=function(m){var a=Math.sqrt(m[0]*m[0]+m[1]*m[1]);var b=Math.sqrt(m[2]*m[2]+m[3]*m[3]);var c=m[0]/a,f=m[1]/a,g=m[2]/b,i=m[3]/b;var q,s;if(c+i+1>0){s=0.5/Math.sqrt(2+c+i);q=[0,0,(f-g)*s,0.25/s];}else{s=2.0*Math.sqrt(2-c-i);q=[0,0,0.25*s,(f-g)/s];}return{position:[m[4],m[5],0],quaternion:q,scale:[a,b,1]};};
E._compose=function(a,q,s){var b=s[0],c=s[1];var f=q[2],g=q[3];var z=f*f*2,w=g*f*2;return new Float32Array([(1-z)*b,w*b,-w*c,(1-z)*c,a[0],a[1]]);};
E._transformPoint=function(a,b,m){return{x:a*m[0]+b*m[2]+m[4],y:a*m[1]+b*m[3]+m[5]};};
E.prototype._matrixWorld=function(m){if(m!==undefined){return E._multiplyMatrices(m,this.matrix);}else{var a=this.parent;var b=this.matrix;while(a!==null){b=E._multiplyMatrices(a.matrix,b);a=a.parent;}return b;}};
function k(b,x,y,a,c){b.min.x=Math.min(b.min.x,x-a);b.min.y=Math.min(b.min.y,y-c);b.max.x=Math.max(b.max.x,x+a);b.max.y=Math.max(b.max.y,y+c);}
function o(a){return a*a;}
E.prototype._expandBoundingBoxCE=function(b,m,c,a,f,g){k(b,c*m[0]+a*m[2]+m[4],c*m[1]+a*m[3]+m[5],Math.abs(f*m[0])+Math.abs(g*m[2]),Math.abs(f*m[1])+Math.abs(g*m[3]));};
E.prototype._expandBoundingBoxCR=function(b,m,c,a,r,f){k(b,c*m[0]+a*m[2]+m[4],c*m[1]+a*m[3]+m[5],Math.sqrt(o(r*m[0])+o(f*m[2])),Math.sqrt(o(r*m[1])+o(f*m[3])));};
E.prototype._expandBoundingBox=function(b,m){};
E.prototype._expandBoundingBoxRecursive=function(b,m,a){if(this.isVisible(m)){var c=this._matrixWorld(a);this._expandBoundingBox(b,c);var f=this.children;for(var i=0,l=f.length;i<l;i++){f[i]._expandBoundingBoxRecursive(b,m,c);}}};
E.prototype._getSceneTreeElement=function(){var a=this;var b=a.parent;while(b){if(b.userData.closed){a=b;}b=b.parent;}while(a.userData.skipIt){a=a.parent;}return a;};
E.prototype._findRectElementsRecursive=function(s,r,m,a){if(this.isVisible(m)){var b=this._matrixWorld(a);var c=this.children;var f={min:{x:Infinity,y:Infinity},max:{x:-Infinity,y:-Infinity}};this._expandBoundingBox(f,b);if(f.min.x<=r.x2&&f.max.x>=r.x1&&f.min.y<=r.y2&&f.max.y>=r.y1){s.add(this._getSceneTreeElement());}for(var i=0,l=c.length;i<l;i++){c[i]._findRectElementsRecursive(s,r,m,b);}}};
E.prototype.tagName=function(){return"g";};
E.prototype._setBaseAttributes=function(s,m){s("id",this.uid);if(this.opacity!==undefined){s("opacity",this.nodeContentType===N.Hotspot&&this.isSelected(m)?(this.opacity*0.5+0.5):this.opacity);}if(!j(this.matrix)){s("transform","matrix("+this.matrix.join(",")+")");}if(!this.isVisible(m)){s("display","none");}if(this.fill!==undefined){s("fill",this._cssColor(this.fill,m));}if(this.stroke!==undefined&&this.stroke[3]>0&&this.strokeWidth){s("stroke",this._cssColor(this.stroke,m));s("stroke-width",this.strokeWidth);s("vector-effect","non-scaling-stroke");if(this.strokeDashArray.length>0){s("stroke-dasharray",this.strokeDashArray.join(" "));}}if(this.nodeContentType===N.Hotspot){s("filter","url(#hotspot-effect)");}};
E.prototype._setSpecificAttributes=function(s){};
E.prototype.render=function(r,m){var a=this.tagName();r.write("<"+a);var s=r.writeAttribute.bind(r);this._setBaseAttributes(s,m);this._setSpecificAttributes(s);r.write(">");if(this._renderContent){this._renderContent(r);}this.children.forEach(function(b){b.render(r,m);});r.write("</"+a+">");};
E.prototype._createDomElement=function(c){var a=document.createElementNS("http://www.w3.org/2000/svg",this.tagName());var s=a.setAttribute.bind(a);this._setBaseAttributes(s,1<<c);this._setSpecificAttributes(s);if(this._createContent){this._createContent(a);}return a;};
E.prototype.invalidate=function(c){if(this.domRef!==null){var a=this.domRef;this.domRef=this._createDomElement(c);a.parentNode.replaceChild(this.domRef,a);for(var i=0,l=this.children.length;i<l;i++){var b=this.children[i].domRef;if(b){this.domRef.appendChild(b);}}}};
E.prototype.rerender=function(c){var a=this.domRef;if(a!==null&&a.parentNode!==null){this.traverse(function(n){n.domRef=n._createDomElement(c);if(n===this){a.parentNode.replaceChild(n.domRef,a);}else{n.parent.domRef.appendChild(n.domRef);}}.bind(this));}};
function p(a,b){var c=a.children;for(var i=0,l=c.length;i<l;i++){if(c[i].id===b){return c[i];}}return null;}
E.prototype._setDomRef=function(a){this.domRef=a;var c=this.children;for(var i=0,l=c.length;i<l;i++){var b=c[i];b._setDomRef(a?p(a,b.uid):null);}};
E.prototype.getElementByProperty=function(n,v){if(this[n]===v){return this;}var c=this.children;for(var i=0,l=c.length;i<l;i++){var a=c[i].getElementByProperty(n,v);if(a!==null){return a;}}return null;};
E.prototype.getElementById=function(i){return this.getElementByProperty("uid",i);};
E.prototype.copy=function(s,r){this.name=s.name;this.matrix=s.matrix.slice();this.nodeContentType=s.nodeContentType;this.materialId=s.materialId;this.lineStyle=s.lineStyle;this.fillStyle=s.fillStyle;if(s.opacity!==undefined){this.opacity=s.opacity;}if(s.tintColor!==undefined){this.tintColor=s.tintColor;}if(s.fill!==undefined){this.fill=s.fill.slice();}if(s.stroke!==undefined){this.stroke=s.stroke.slice();}if(s.strokeWidth!==undefined){this.strokeWidth=s.strokeWidth;}if(s.strokeDashArray!==undefined){this.strokeDashArray=s.strokeDashArray.slice();}if(s.widthCoordinateSpace!==undefined){this.widthCoordinateSpace=s.widthCoordinateSpace;}if(r||r===undefined){for(var i=0,l=s.children.length;i<l;i++){this.add(s.children[i].clone());}}return this;};
E.prototype.clone=function(){return new this.constructor().copy(this);};
function t(a,b,f){return a+(b-a)*f;}
E.prototype._cssColor=function(c,m){var a=c[3];if(a===0){return"none";}var r=c[0]*255;var g=c[1]*255;var b=c[2]*255;var f=this.tintColor;if(f){f=d(f);var i=f.alpha;if(i>0){r=t(r,f.red,i);g=t(g,f.green,i);b=t(b,f.blue,i);}}var l=this.highlightColor;if(l){l=d(l);var n=l.alpha;if(n>0){r=t(r,l.red,n);g=t(g,l.green,n);b=t(b,l.blue,n);a=t(a,n,n);}}var q=((r<<24)|(g<<16)|(b<<8)|(a*255))>>>0;return"#"+("00000000"+q.toString(16)).slice(-8);};
return E;});
sap.ui.predefine('sap/ui/vk/svg/Ellipse',["./Element"],function(E){"use strict";var a=function(p){p=p||{};E.call(this,p);this.type="Ellipse";this.cx=p.cx||0;this.cy=p.cy||0;this.rx=p.major||p.radius||0;this.ry=p.minor||p.radius||0;this.setMaterial(p.material);};a.prototype=Object.assign(Object.create(E.prototype),{constructor:a});
a.prototype.tagName=function(){return"ellipse";};
a.prototype._expandBoundingBox=function(b,m){var s=isNaN(this.strokeWidth)?0:this.strokeWidth*0.5;this._expandBoundingBoxCR(b,m,this.cx,this.cy,this.rx+s,this.ry+s);};
a.prototype._setSpecificAttributes=function(s){s("cx",this.cx);s("cy",this.cy);s("rx",this.rx);s("ry",this.ry);};
a.prototype.copy=function(s,r){E.prototype.copy.call(this,s,r);this.cx=s.cx;this.cy=s.cy;this.rx=s.rx;this.ry=s.ry;return this;};
return a;});
sap.ui.predefine('sap/ui/vk/svg/HotspotHelper',["../NodeContentType","./Element"],function(N,E){"use strict";var H=function(){};
H.prototype.createHotspot=function(s,p,j,n,a){var h=s.getDefaultNodeHierarchy().createNode(p,n,null,N.Hotspot,a);this.updateHotspot(h,j);h.parent.rerender();return h;};
H.prototype.removeHotspot=function(s,h){s.getDefaultNodeHierarchy().removeNode(h);};
H.prototype.updateHotspot=function(h,j,f){while(h.children.length>0){h.remove(h.children[h.children.length-1]);}if(j){h.userData.jointNodes=Array.from(j);}j=h.userData.jointNodes;if(j){var a=E._invertMatrix(h._matrixWorld());j.forEach(function(b){var c=b.clone();c.matrix=E._multiplyMatrices(a,b._matrixWorld());h.add(c);});}h._initAsHotspot(f);};
return H;});
sap.ui.predefine('sap/ui/vk/svg/Line',["./Element"],function(E){"use strict";var L=function(p){p=p||{};E.call(this,p);this.type="Line";this.x1=p.x1||0;this.y1=p.y1||0;this.x2=p.x2!=null?p.x2:100;this.y2=p.y2!=null?p.y2:100;this.setMaterial(p.material);};L.prototype=Object.assign(Object.create(E.prototype),{constructor:L});
L.prototype.tagName=function(){return"line";};
L.prototype.isFillable=function(){return false;};
L.prototype._expandBoundingBox=function(b,m){var s=isNaN(this.strokeWidth)?0:this.strokeWidth*0.5;this._expandBoundingBoxCE(b,m,this.x1,this.y1,s,s);this._expandBoundingBoxCE(b,m,this.x2,this.y2,s,s);};
L.prototype._setSpecificAttributes=function(s){s("x1",this.x1);s("y1",this.y1);s("x2",this.x2);s("y2",this.y2);};
L.prototype.copy=function(s,r){E.prototype.copy.call(this,s,r);this.x1=s.x1;this.y1=s.y1;this.x2=s.x2;this.y2=s.y2;return this;};
return L;});
sap.ui.predefine('sap/ui/vk/svg/NodeHierarchy',["../NodeHierarchy","sap/ui/base/ObjectPool","./Element","./BaseNodeProxy","./NodeProxy","../Messages","../getResourceBundle","../NodeContentType","sap/base/util/uid","sap/base/assert","sap/base/Log"],function(N,O,E,B,a,M,g,b,u,c,L){"use strict";var s={equals:function(e,f){return e===f;},contains:function(e,f){return e.indexOf(f)!==-1;},startsWith:function(e,f){return e.indexOf(f)===0;}};
var d=N.extend("sap.ui.vk.svg.NodeHierarchy",{
metadata:{},
_baseNodeProxyPool:new O(B),
constructor:function(e){N.call(this);this._scene=e;this._nodeProxies=[];}
});
d.prototype.destroy=function(){this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._scene=null;N.prototype.destroy.call(this);};
d.prototype.getScene=function(){return this._scene;};
d.prototype.getSceneRef=function(){return this._scene.getRootElement();};
d.prototype.enumerateChildren=function(n,e,f,p){if(typeof n==="function"){p=f;f=e;e=n;n=undefined;}var h=this.getChildren(n,f);if(p){h.forEach(e);}else{var i=this._baseNodeProxyPool.borrowObject();try{h.forEach(function(n){i.init(this,n);e(i);i.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(i);}}return this;};
d.prototype.enumerateAncestors=function(n,e,p){var f=this.getAncestors(n);if(p){f.forEach(e);}else{var h=this._baseNodeProxyPool.borrowObject();try{f.forEach(function(n){h.init(this,n);e(h);h.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(h);}}return this;};
d.prototype.createNodeProxy=function(n){var e=new a(this,n);this._nodeProxies.push(e);return e;};
d.prototype.destroyNodeProxy=function(n){var i=this._nodeProxies.indexOf(n);if(i>=0){this._nodeProxies.splice(i,1)[0].destroy();}return this;};
d.prototype.getChildren=function(n,e){if(typeof n==="boolean"){e=n;n=undefined;}n=n||this._scene.getRootElement();return e||!n.closed?n.children:[];};
d.prototype.getAncestors=function(n){var e=[];n.traverseAncestors(function(p){e.unshift(p);});if(e.length>0&&e[0]===this._scene.getRootElement()){e.shift();}return e;};
d.prototype.findNodesByName=function(q){var r=[];if(q===undefined||q===null||q===""||jQuery.isEmptyObject(q)){this._scene.getRootElement().children.forEach(function(h){h.traverse(function(j){r.push(j);});});}else{var e=s[q.predicate||"equals"];if(e===undefined){L.error(g().getText(M.VIT8.summary),M.VIT8.code,"sap.ui.vk.svg.NodeHierarchy");}else if(!Array.isArray(q.value)&&typeof q.value!=="string"){L.error(g().getText(M.VIT6.summary),M.VIT6.code,"sap.ui.vk.svg.NodeHierarchy");}else{var f=Array.isArray(q.value)?q.value:[q.value];if(!q.caseSensitive){for(var i in f){f[i]=f[i].toLowerCase();}}this._scene.getRootElement().children.forEach(function(h){h.traverse(function(j){var n=j.name||"";if(!q.caseSensitive){n=n.toLowerCase();}for(var i in f){if(e(n,f[i])){r.push(j);break;}}});});}}return r;};
d.prototype.createLayerProxy=function(l){return null;};
d.prototype.destroyLayerProxy=function(l){return this;};
d.prototype.getLayers=function(){return[];};
d.prototype.getHotspotNodeIds=function(){var n=[];this._scene.getRootElement().traverse(function(e){if(e._vkGetNodeContentType()===b.Hotspot){n.push(e);}});return n;};
d.prototype.attachChanged=function(e,f,l){return this.attachEvent("changed",e,f,l);};
d.prototype.detachChanged=function(e,f,l){return this.detachEvent("changed",e,f,l);};
d.prototype.fireChanged=function(p,e,f){return this.fireEvent("changed",p,e,f);};
d.prototype.attachNodeCreated=function(e,f,l){return this.attachEvent("nodeCreated",e,f,l);};
d.prototype.detachNodeCreated=function(e,f,l){return this.detachEvent("nodeCreated",e,f,l);};
d.prototype.fireNodeCreated=function(p,e,f){return this.fireEvent("nodeCreated",p,e,f);};
d.prototype.attachNodeRemoving=function(e,f,l){return this.attachEvent("nodeRemoving",e,f,l);};
d.prototype.detachNodeRemoving=function(e,f,l){return this.detachEvent("nodeRemoving",e,f,l);};
d.prototype.fireNodeRemoving=function(p,e,f){return this.fireEvent("nodeRemoving",p,e,f);};
d.prototype.attachNodeReplaced=function(e,f,l){return this.attachEvent("nodeReplaced",e,f,l);};
d.prototype.detachNodeReplaced=function(e,f,l){return this.detachEvent("nodeReplaced",e,f,l);};
d.prototype.fireNodeReplaced=function(p,e,f){return this.fireEvent("nodeReplaced",p,e,f);};
d.prototype.attachNodeUpdated=function(e,f,l){return this.attachEvent("nodeUpdated",e,f,l);};
d.prototype.detachNodeUpdated=function(e,f,l){return this.detachEvent("nodeUpdated",e,f,l);};
d.prototype.fireNodeUpdated=function(p,e,f){return this.fireEvent("nodeUpdated",p,e,f);};
d.prototype.createNode=function(p,n,i,e,f){var h=this.getScene().getSceneBuilder();var j=null;if(h){f=f||{};f.name=f.name||n;f.sid=f.sid||u();j=h.createNode(f);if(!p){p=j.parent;}}else{if(!p){p=this._scene.getRootElement();}j=new E();j.name=n;p.add(j);}var k=p.children.indexOf(i);c(p.children[p.children.length-1]===j,g().getText("NODEHIERARCHY_MSG_CREATENODEFAILED"));if(k>=0){p.children.splice(k,0,p.children.pop());}if(e){j._vkSetNodeContentType(e);}else{j._vkSetNodeContentType(b.Regular);}if(f&&h){switch(j._vkGetNodeContentType()){case b.Annotation:f.node=j;f.nodeId=j._vkPersistentId();h.createAnnotation(f);break;default:}}this.fireNodeCreated({nodeRef:j,nodeId:j});this.fireChanged();return j;};
d.prototype.getNodeContentType=function(n){if(n==null){return b.Regular;}var e=null;if(!e){e=b.Regular;}return e;};
d.prototype.createNodeCopy=function(n,p,e,i){if(!p){p=this._scene.getRootElement();}var f=p.children.indexOf(i);var h=n.clone(true);h.name=e;p.add(h);c(p.children[p.children.length-1]===h,g().getText("NODEHIERARCHY_MSG_CREATENODEFAILED"));if(f>=0){p.children.splice(f,0,p.children.pop());}this.fireNodeCreated({nodeRef:h,nodeId:h});this.fireChanged();return h;};
d.prototype.removeNode=function(n){var e=[].concat(n);e.forEach(function(n){if(n&&n.parent){this.fireNodeRemoving({nodeRef:n,nodeId:n});n.parent.remove(n);}}.bind(this));var f=this.getScene().getSceneBuilder();if(f){f.removeNode(n);}this.fireChanged();return this;};
return d;});
sap.ui.predefine('sap/ui/vk/svg/NodeProxy',["../NodeProxy","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","../TransformationMatrix","./Element"],function(N,c,a,b,d,T,E){"use strict";
var e=N.extend("sap.ui.vk.svg.NodeProxy",{
metadata:{},
constructor:function(n,s){N.call(this);this._element=s;this._nodeHierarchy=n;}
});
e.prototype.destroy=function(){this._element=null;N.prototype.destroy.call(this);};
e.prototype.getNodeHierarchy=function(){return this._nodeHierarchy;};
e.prototype.getNodeRef=function(){return this._element;};
e.prototype.getNodeId=function(){return this._element;};
e.prototype.getVeIds=function(){return this._element.userData.veids||[];};
e.prototype.getVeId=function(){return this._element.sid;};
e.prototype.getName=function(){return this._element.name||("<"+this._element.type+">");};
e.prototype.getLocalMatrix=function(){return T.convert3x2To4x3(this._element.matrix);};
e.prototype.setLocalMatrix=function(m){if(m){this._element.matrix=T.convert4x3To3x2(m);}this.setProperty("localMatrix",m,true);return this;};
e.prototype.getWorldMatrix=function(){return T.convert3x2To4x3(this._element._matrixWorld());};
e.prototype.setWorldMatrix=function(m){if(m){var f=T.convert4x3To3x2(m);var g=this._element;if(g.parent){g.matrix=E._multiplyMatrices(E._invertMatrix(g.parent._matrixWorld()),f);}else{g.matrix=f;}}this.setProperty("worldMatrix",m,true);return this;};
e.prototype.getOpacity=function(){return this._element.opacity;};
e.prototype.setOpacity=function(v){this.setProperty("opacity",v,true);return this;};
e.prototype.getTintColorABGR=function(){return this._element.tintColor;};
e.prototype.setTintColorABGR=function(v){this.setProperty("tintColorABGR",v,true);this.setProperty("tintColor",a(b(v)),true);return this;};
e.prototype.getTintColor=function(){return a(b(this._element.tintColor));};
e.prototype.setTintColor=function(v){var f=d(c(v));this.setProperty("tintColorABGR",f,true);this.setProperty("tintColor",v,true);return this;};
e.prototype.getNodeMetadata=function(){return this._element.userData.metadata||{};};
e.prototype.getHasChildren=function(){return this._element.children.length>0;};
e.prototype.getClosed=function(){return!!this._element.closed;};
return e;});
sap.ui.predefine('sap/ui/vk/svg/OrthographicCamera',["../OrthographicCamera"],function(O){"use strict";
var S=O.extend("sap.ui.vk.svg.OrthographicCamera",{metadata:{}});
var b=O.getMetadata().getParent().getClass().prototype;
S.prototype.init=function(){if(b.init){b.init.call(this);}this.zoom=1;this.offsetX=0;this.offsetY=0;this.zoomedObject=null;};
S.prototype.update=function(w,h,o,a){var c=this.zoom;this.zoom*=Math.min(w,h)/Math.min(o,a);this.offsetX=(this.offsetX-o*0.5)*(this.zoom/c)+w*0.5;this.offsetY=(this.offsetY-a*0.5)*(this.zoom/c)+h*0.5;};
S.prototype.reset=function(c,w,h){if(c&&c.viewBox){this._setViewBox(c.viewBox,w,h);}};
S.prototype._setViewBox=function(v,w,h){this.zoom=w/v[2];this.offsetX=-v[0]*this.zoom;this.offsetY=-v[1]*this.zoom;this.update(w,h,w,w*v[3]/v[2]);};
S.prototype._zoomTo=function(a,w,h,m){var z=Math.min(w/(a.max.x-a.min.x),h/(a.max.y-a.min.y))/(1+(m||0));this.zoom=z;this.offsetX=(w-(a.min.x+a.max.x)*z)*0.5;this.offsetY=(h-(a.min.y+a.max.y)*z)*0.5;};
S.prototype._screenToWorld=function(x,y){return{x:(x-this.offsetX)/this.zoom,y:(y-this.offsetY)/this.zoom};};
S.prototype._worldToScreen=function(x,y){return{x:x*this.zoom+this.offsetX,y:y*this.zoom+this.offsetY};};
S.prototype._transformRect=function(r){var p=this._screenToWorld(r.x1,r.y1);var a=this._screenToWorld(r.x2,r.y2);return{x1:Math.min(p.x,a.x),y1:Math.min(p.y,a.y),x2:Math.max(p.x,a.x),y2:Math.max(p.y,a.y)};};
S.prototype.getPosition=function(){return[this.offsetX,this.offsetY,0];};
S.prototype.setPosition=function(v){if(Array.isArray(v)&&v.length>=2){this.offsetX=v[0];this.offsetY=v[1];}};
S.prototype.getZoomFactor=function(){return this.zoom;};
S.prototype.setZoomFactor=function(v){this.zoom=v;};
return S;});
sap.ui.predefine('sap/ui/vk/svg/Path',["sap/base/Log","./Element"],function(L,E){"use strict";var P=function(a){a=a||{};E.call(this,a);this.type="Path";this.segments=a.segments||[];if(a.isTriangleMesh){this.isTriangleMesh=true;}this.setMaterial(a.material);};P.prototype=Object.assign(Object.create(E.prototype),{constructor:P});
P.prototype.tagName=function(){return"path";};
P.prototype.isFillable=function(){return this.isTriangleMesh;};
function p(a,d,r,h,i){var x=a+r*Math.cos(i);var y=d+h*Math.sin(i);return{x:x,y:y};}
P.prototype._expandBoundingBox=function(d,m){if(this.domRef){var h=this.domRef.getBBox();if(h){this._expandBoundingBoxCE(d,m,h.x+h.width*0.5,h.y+h.height*0.5,h.width*0.5,h.height*0.5);return;}}var s=isNaN(this.strokeWidth)?0:this.strokeWidth*0.5;var x=0,y=0;for(var j=0,k=this.segments.length;j<k;j++){var o=this.segments[j];var q=o.points;var r=o.dimension||2,i,l;switch(o.type){case"arc":if(q){if(o.relative){x+=q[0];y+=q[1];}else{x=q[0];y=q[1];}this._expandBoundingBoxCE(d,m,x,y,s,s);}else{for(var a=0,n=6;a<n;a++){var t=p(o.cx,o.cy,o.rx,o.ry,o.start+(o.end-o.start)*a/(n-1));this._expandBoundingBoxCE(d,m,t.x,t.y,s,s);}if(o.closed){this._expandBoundingBoxCE(d,m,o.cx,o.cy,s,s);}}break;case"move":case"polyline":case"mesh":x=q[0];y=q[1];this._expandBoundingBoxCE(d,m,x,y,s,s);for(i=r,l=q.length-1;i<l;i+=r){if(o.relative){x+=q[i];y+=q[i+1];}else{x=q[i];y=q[i+1];}this._expandBoundingBoxCE(d,m,x,y,s,s);}break;case"line":for(i=0,l=q.length-1;i<l;i+=r){if(o.relative){x+=q[i];y+=q[i+1];}else{x=q[i];y=q[i+1];}this._expandBoundingBoxCE(d,m,x,y,s,s);}break;case"bezier":var u=o.degree||2;for(i=0,l=q.length-1;i<l;i+=r){if(o.relative){this._expandBoundingBoxCE(d,m,x+q[i],y+q[i+1],s,s);if((i/r)%u===u-1){x+=q[i];y+=q[i+1];}}else{x=q[i];y=q[i+1];this._expandBoundingBoxCE(d,m,x,y,s,s);}}break;default:break;}}};
function b(d,s){var i,l;var a=s.points;switch(s.degree||2){case 2:for(i=0,l=a.length-3;i<l;i+=4){d.push(s.relative?"q":"Q",a[i],a[i+1],a[i+2],a[i+3]);}break;case 3:if(!s.smooth){for(i=0,l=a.length-5;i<l;i+=6){d.push(s.relative?"c":"C",a[i],a[i+1],a[i+2],a[i+3],a[i+4],a[i+5]);}}else{for(i=0,l=a.length-3;i<l;i+=4){d.push(s.relative?"s":"S",a[i],a[i+1],a[i+2],a[i+3]);}}break;default:L.warning("Unsupported bezier segment degree:",s.type);break;}}
function c(d,s){var a=s.points;d.push("M",a[0],a[1]);var h=s.dimension||2;for(var i=h,l=a.length-1;i<l;i+=h){d.push("L",a[i],a[i+1]);}if(s.closed){d.push("Z");}}
function e(d,s){var a=s.points;var h=s.dimension||2;for(var i=0,l=a.length-1;i<l;i+=h){d.push(s.relative?"l":"L",a[i],a[i+1]);}}
function f(d,s){var a=s.points;for(var i=0,l=a.length-5;i<l;i+=6){d.push("M",a[i],a[i+1],"L",a[i+2],a[i+3],"L",a[i+4],a[i+5],"Z");}}
function g(d,s){var a=s.points;if(a){d.push(s.relative?"a":"A",s.major,s.minor,"0",s.followLargeArc?"1":"0",s.clockwise?"1":"0",a[0],a[1]);}else{var h=p(s.cx,s.cy,s.rx,s.ry,s.start);var i=p(s.cx,s.cy,s.rx,s.ry,s.end);d.push("M",h.x,h.y,"A",s.rx,s.ry,"0",Math.abs(s.end-s.start)<Math.PI?"0":"1",s.end>s.start?"1":"0",i.x,i.y);if(s.closed){d.push("L",s.cx,s.cy,"Z");}}}
P.prototype._setSpecificAttributes=function(s){var d=[];this.segments.forEach(function(a){switch(a.type){case"arc":g(d,a);break;case"line":e(d,a);break;case"close":d.push("Z");break;case"bezier":b(d,a);break;case"move":case"polyline":c(d,a);break;case"mesh":f(d,a);break;default:L.warning("Unsupported path segment type:",a.type,JSON.stringify(a));break;}});if(d.length>0){s("d",d.join(" "));}if(!this.isTriangleMesh){s("stroke-linejoin","round");}};
P.prototype.copy=function(s,r){E.prototype.copy.call(this,s,r);for(var i=0,l=s.segments.length;i<l;i++){var a=s.segments[i];var d={type:a.type};if(a.points!==undefined){d.points=a.points.slice();}if(a.dimension!==undefined){d.dimension=a.dimension;}if(a.degree!==undefined){d.degree=a.degree;}if(a.smooth){d.smooth=true;}if(a.relative){d.relative=true;}if(a.closed){d.closed=true;}if(a.major){d.major=a.major;}if(a.minor){d.minor=a.minor;}if(a.followLargeArc){d.followLargeArc=true;}if(a.clockwise){d.clockwise=true;}if(a.cx!==undefined){d.cx=a.cx;}if(a.cy!==undefined){d.cy=a.cy;}if(a.rx!==undefined){d.rx=a.rx;}if(a.ry!==undefined){d.ry=a.ry;}if(a.start!==undefined){d.start=a.start;}if(a.end!==undefined){d.end=a.end;}this.segments.push(d);}if(s.isTriangleMesh){this.isTriangleMesh=true;}return this;};
return P;});
sap.ui.predefine('sap/ui/vk/svg/Polyline',["./Element"],function(E){"use strict";var P=function(p){p=p||{};E.call(this,p);this.type="Polyline";this.points=new Float32Array(p.points||[0,0,100,100]);this.closed=p.closed||false;this.setMaterial(p.material);};P.prototype=Object.assign(Object.create(E.prototype),{constructor:P});
P.prototype.tagName=function(){return this.closed?"polygon":"polyline";};
P.prototype.isFillable=function(){return this.closed;};
P.prototype._expandBoundingBox=function(b,m){var s=isNaN(this.strokeWidth)?0:this.strokeWidth*0.5;var p=this.points;for(var i=0,l=p.length;i<l;i+=2){this._expandBoundingBoxCE(b,m,p[i],p[i+1],s,s);}};
P.prototype._setSpecificAttributes=function(s){s("points",this.points.join(" "));if(this.stroke!==undefined&&this.stroke[3]>0&&this.strokeWidth){s("stroke-linejoin","round");}};
P.prototype.copy=function(s,r){E.prototype.copy.call(this,s,r);this.points=s.points.slice();this.closed=s.closed;return this;};
return P;});
sap.ui.predefine('sap/ui/vk/svg/Rectangle',["./Element"],function(E){"use strict";var R=function(p){p=p||{};E.call(this,p);this.type="Rectangle";this.x=p.x||0;this.y=p.y||0;this.width=p.width||0;this.height=p.height||p.length||0;this.rx=p.rx||0;this.ry=p.ry||0;this.setMaterial(p.material);};R.prototype=Object.assign(Object.create(E.prototype),{constructor:R});
R.prototype.tagName=function(){return"rect";};
R.prototype._expandBoundingBox=function(b,m){var s=isNaN(this.strokeWidth)?0:this.strokeWidth*0.5;var h=this.width*0.5;var a=this.height*0.5;this._expandBoundingBoxCE(b,m,this.x+h,this.y+a,h+s,a+s);};
R.prototype._setSpecificAttributes=function(s){s("x",this.x);s("y",this.y);s("width",this.width);s("height",this.height);if(this.rx){s("rx",this.rx);}if(this.ry){s("ry",this.ry);}};
R.prototype.copy=function(s,r){E.prototype.copy.call(this,s,r);this.x=s.x;this.y=s.y;this.width=s.width;this.height=s.height;this.rx=s.rx;this.ry=s.ry;return this;};
return R;});
sap.ui.predefine('sap/ui/vk/svg/Scene',["../Scene","./NodeHierarchy","./Element"],function(S,N,E){"use strict";
var a=S.extend("sap.ui.vk.svg.Scene",{
metadata:{},
constructor:function(){S.call(this);this._sceneBuilder=null;this._defaultNodeHierarchy=null;this._currentViewStateManager=null;}
});
a.prototype.init=function(){this._root=new E();this._root.userData.skipIt=true;};
a.prototype.destroy=function(){if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null;}this._sceneBuilder=null;this._root=null;S.prototype.destroy.call(this);};
a.prototype.setViewStateManager=function(v){this._currentViewStateManager=v;return this;};
a.prototype.getViewStateManager=function(){return this._currentViewStateManager;};
a.prototype.getId=function(){return this._root.id;};
a.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new N(this);}return this._defaultNodeHierarchy;};
a.prototype.getRootElement=function(){return this._root;};
a.prototype.setSceneBuilder=function(s){this._sceneBuilder=s;};
a.prototype.getSceneBuilder=function(){return this._sceneBuilder;};
a.prototype.nodeRefToPersistentId=function(n){return Array.isArray(n)?n.map(function(b){return b._vkPersistentId();}):n._vkPersistentId();};
a.prototype.persistentIdToNodeRef=function(p){var s=this._sceneBuilder;if(Array.isArray(p)){return p.map(function(b){return s?s.getNode(b):null;});}else{return s?s.getNode(p):null;}};
a.prototype.setNodePersistentId=function(n,s,b){return this._sceneBuilder?this._sceneBuilder.setNodePersistentId(n,s,b):false;};
a.prototype.getInitialView=function(){return this._initialView;};
a.prototype.setInitialView=function(v){this._initialView=v;};
return a;});
sap.ui.predefine('sap/ui/vk/svg/SceneBuilder',["sap/base/Log","./Element","./Ellipse","./Rectangle","./Line","./Polyline","./Path","./Text","./OrthographicCamera","../View","../NodeContentType","../TransformationMatrix","../getResourceBundle","../totara/TotaraUtils"],function(L,E,a,R,b,P,c,T,O,V,N,d,g,f){"use strict";var S=function(r,e,i,j){this._rootNode=r;this._contentResource=e;this._resolve=i;this._reject=j;this._cameras=new Map();this._sceneIdTreeNodesMap=new Map();this._sceneIdRootNodeMap=new Map();this._materialMap=new Map();this._materialNodesMap=new Map();this._nodes=new Map();this._viewGroups=new Map();this._views=new Map();this._viewThumbnails=new Map();this._geometries=new Map();this._geometryMeshes=new Map();this._meshNodes=new Map();this._meshSubmeshes=new Map();this._images=new Map();this._fillStyles=new Map();this._lineStyles=new Map();this._textStyles=new Map();this._joints=new Map();this._yIndex=1;if(e){var n=e.getNodeProxy();var l=n.getNodeHierarchy();this._vkScene=l.getScene();var s=e.getSource();if(s&&s.name){this._sceneIdTreeNodesMap.set(s.name,this._nodes);this._sceneIdRootNodeMap.set(s.name,r);this._currentSceneId=s.name;}if(this._rootNode){this._rootNode.userData.skipIt=!e.name;}}};
S.prototype.setScene=function(i){if(i.result!==1){var e={status:i.result};switch(i.result){case-1:e.errorText=g().getText("LOADER_FILENOTFOUND");break;case-2:e.errorText=g().getText("LOADER_WRONGFILEFORMAT");break;case-3:e.errorText=g().getText("LOADER_WRONGPASSWORD");break;case-4:e.errorText=g().getText("LOADER_ERRORREADINGFILE");break;case-5:e.errorText=g().getText("LOADER_FILECONTENT");break;default:e.errorText=g().getText("LOADER_UNKNOWNERROR");}this._reject(e);}else{this._yIndex=1;this._rootNode.matrix[3]=i.upAxis===2?-1:1;var j=this._cameras.get(i.cameraId);L.info("setScene",JSON.stringify(i),j);this._resolve({node:this._rootNode,camera:j,backgroundTopColor:i.backgroundTopColor,backgroundBottomColor:i.backgroundBottomColor,contentResource:this._contentResource,builder:this});}};
S.prototype.setRootNode=function(r,n,s,v){this._rootNode=r;r.sid=n;this._nodes.set(n,r);this._viewGroups=new Map();this._views=new Map();if(s){this._sceneIdTreeNodesMap.set(s,this._nodes);this._sceneIdRootNodeMap.set(s,r);this._currentSceneId=s;}if(v){this._vkScene=v;}return this;};
S.prototype.setNodePersistentId=function(n,e,s){this._resetCurrentScene(s);n.sid=e;this._nodes.set(e,n);return true;};
S.prototype.cleanup=function(){this._rootNode=null;this._currentSceneId=null;if(this._nodes){this._nodes.clear();}if(this._viewGroups){this._viewGroups.clear();}if(this._views){this._views.clear();}this._materialMap.clear();this._materialNodesMap.clear();this._sceneIdTreeNodesMap.clear();this._sceneIdRootNodeMap.clear();this._fillStyles.clear();this._lineStyles.clear();this._textStyles.clear();};
S.prototype.getNode=function(n,s){if(s){this._resetCurrentScene(s);if(this._nodes){return this._nodes.get(n);}}else{var e=this._sceneIdTreeNodesMap.values();var i=e.next();while(!i.done){var j=i.value.get(n);if(j){return j;}i=e.next();}}return null;};
S.prototype._resetCurrentScene=function(s){if(s&&s!==this._currentSceneId){var n=this._sceneIdTreeNodesMap.get(s);if(n){this._nodes=n;}else{this._nodes=new Map();}var e=this._sceneIdRootNodeMap.get(s);if(e){this._rootNode=e;}else{this._rootNode=null;}this._currentSceneId=s;}};
S.prototype.createCamera=function(e,s){this._resetCurrentScene(s);var i=new O();i.setPosition(e.origin);i.setZoomFactor(e.zoom);this._cameras.set(e.id,i);return i;};
S.prototype.getCamera=function(e){return this._cameras.get(e);};
S.prototype.hasMesh=function(m){return this._meshSubmeshes.has(m);};
S.prototype.hasImage=function(i){return this._images.has(i);};
function h(l){if(Array.isArray(l)){for(var i=0;i<l.length;i++){if(l[i].type===undefined||l[i].type==="mesh"||l[i].type==="line"){return l[i];}}}return null;}
S.prototype.setMeshNode=function(n,m){this._setMeshNode(this._nodes.get(n),m);};
S.prototype.setModelViewVisibilitySet=function(){};
S.prototype.setAnimationPlaybacks=function(){};
S.prototype.loadingFinished=function(i){L.info("loadingFinished",JSON.stringify(i));this._loader.fireContentLoadingFinished({source:this._contentResource,node:this._rootNode});};
S.prototype.createThumbnail=function(i){var v=this._viewThumbnails.get(i.imageId);if(v){v.thumbnailData="data:image/"+"jpeg"+";base64,"+window.btoa(String.fromCharCode.apply(null,i.data));if(this._fireThumbnailLoaded){this._fireThumbnailLoaded({modelView:v});}}};
S.prototype.insertSubmesh=function(s){if(!s.lods){return false;}var l=h(s.lods);if(!l){return false;}s.boundingBox=l.boundingBox;var e=this._geometries.get(l.id);if(e){var n=this._meshNodes.get(s.meshId);if(n){for(var i=0;i<n.length;i++){this._addGeometryToNode(n[i],e,s);}}}else{f.pushElementIntoMapArray(this._geometryMeshes,l.id,s);}f.pushElementIntoMapArray(this._meshSubmeshes,s.meshId,s);};
S.prototype.getViewGroup=function(v,s){this._resetCurrentScene(s);var e=this._viewGroups.get(v);var i=[];if(e&&e.views){for(var j=0;j<e.views.length;j++){var l=e.views[j].id;var m=this._views.get(l);if(m){i.push(m);}}}return i;};
S.prototype.insertViewGroup=function(i,s){this._resetCurrentScene(s);var v=this._viewGroups.get(i.id);if(!v){v=this._vkScene.createViewGroup({viewGroupId:i.id,name:i.name,description:i.description});this._viewGroups.set(i.id,v);}else{v.setViewGroupId(i.id);v.setName(i.name);v.setDescription(i.description);}v.type=i.type;v.metadata=i.metadata;v.veids=i.veids;v.views=i.views;v.sceneId=i.sceneId;return this;};
S.prototype.insertView=function(v,s){this._resetCurrentScene(s);var e=this._vkScene.createView({viewId:v.viewId,name:v.name,description:v.description?"<pre style=\"white-space: pre-wrap;\">"+v.description+"</pre>":v.description,aspectRatio:v.safeAreaAspectRatio});e.userData={viewInfo:v};if(v.thumbnailId){var i=this._images.get(v.thumbnailId);if(i){e.thumbnailData=i;}else{this._viewThumbnails.set(v.thumbnailId,e);}}if(v.cameraId){e.setCamera(this._cameras.get(v.cameraId));}e.type=v.type;e.flyToTime=v.flyToTime;e.preDelay=v.preDelay;e.postDelay=v.postDelay;e.navigationMode=v.navigationMode;e.topColor=v.topColour;e.bottomColor=v.bottomColour;e.dimension=v.dimension;e.query=v.query;e.metadata=v.metadata;e.veids=v.veids;e.viewGroupId=v.viewGroupId;e.id=v.viewId;this._views.set(v.viewId,e);if(e.viewGroupId){var j=this._viewGroups.get(e.viewGroupId);if(j){j.addView(e);}}return this;};
S.prototype.getView=function(v,s){this._resetCurrentScene(s);return this._views.get(v);};
S.prototype.setViewCamera=function(e,v,s){this._resetCurrentScene(s);var i=this._cameras.get(e);var j=this._views.get(v);if(i&&j){j.setCamera(i);}return this;};
S.prototype.getChildNodeIds=function(n,s,e){this._resetCurrentScene(s);var j=this._nodes.get(n);var l=[];if(!j){return l;}if(j&&j.children){for(var i=0;i<j.children.length;i++){var m=j.children[i];if(m.userData.treeNode&&m.userData.treeNode.sid){l.push(m.userData.treeNode.sid);}else if(e&&m.userData.submeshInfo&&m.userData.submeshInfo.id){l.push(m.userData.submeshInfo.id);}}}return l;};
S.prototype.setViewNodeInfos=function(n,v,s){this._resetCurrentScene(s);var e=this._views.get(v);e.setNodeInfos(n);return this;};
S.prototype.finalizeViewGroups=function(s){this._resetCurrentScene(s);var e=this._viewGroups.entries();var n=e.next();while(!n.done){var v=n.value[1];var i=n.value[0];if(!v||!v.views||!v.views.length){n=e.next();continue;}v.removeViews();for(var j=0;j<v.views.length;j++){var l=v.views[j].id;var m=this._views.get(l);if(m&&m.userData.viewInfo.thumbnailId&&!m.thumbnailData){var p=this._images.get(m.userData.viewInfo.thumbnailId);if(p){m.thumbnailData=p;}}if(m){m.viewGroupId=i;v.addView(m);}}n=e.next();}return this;};
S.prototype.setVoxelThreshold=function(v){return this;};
S.prototype.getVoxelThreshold=function(){return 0.0;};
S.prototype.createNode=function(n,s){this._resetCurrentScene(s);var t=n.transform;var e=new E({sid:n.sid,name:n.name,matrix:d.convertTo3x2(t)});this._nodes.set(n.sid,e);var i=e.userData;if(n.metadata){i.metadata=n.metadata;}if(n.veids){i.veids=n.veids;}if(n.parametricId){i.parametricId=n.parametricId;}else if(n.meshId){this._setMeshNode(e,n.meshId);}i.treeNode=n;e.setVisible(1,n.visible?n.visible:true);if(n.visualisable===false){i.skipIt=true;}if(n.contentType==="HOTSPOT"){e._vkSetNodeContentType(N.Hotspot);}if(n.joints){n.joints.forEach(function(l){var p=this._nodes.get(l.parentSid);if(p){p.userData.jointNodes=p.userData.jointNodes||[];p.userData.jointNodes.push(e);}else{f.pushElementIntoMapArray(this._joints,l.parentSid,e);}},this);}var j=this._joints.get(n.sid);if(j){i.jointNodes=i.jointNodes?i.jointNodes.concat(j):j;}var p=this._nodes.get(n.parentId);(p||this._rootNode).add(e);return e;};
S.prototype.preferMeshes=function(){return false;};
S.prototype.createAnnotation=function(e,s){};
S.prototype.remove=function(n,s){this._resetCurrentScene(s);var t=this;n=[].concat(n);n.forEach(function(e){var j=t._nodes.get(e);if(j){t._nodes.delete(e);for(var i=0;i<j.children.length;i++){var l=j.children[i];if(l.userData&&l.userData.treeNode&&l.userData.treeNode.sid){t.remove(l.userData.treeNode.sid,s);}}}});return this;};
S.prototype._addPolylineSegment=function(s,e,p){var j=e.length;if(j<2){return;}var m=[];var n=e[0]===e[j-1];if(n){j--;}for(var i=0,l=e.length;i<l;i++){var q=e[i]*3;m.push(p[q],p[q+this._yIndex]);}s.push({type:"polyline",points:m,closed:n});};
S.prototype._addGeometryToNode=function(n,e,s){var m=s.materialId;var j=this._getMaterial(m);var p=e.data;var q=p.indices;var r=p.points;var t=new Float32Array([1,0,0,1,0,0]);if(e.isPositionQuantized&&s.boundingBox){}if(s.transform){}var i,v,w,x;var l=q.length;var y=[];if(e.isPolyline){j=Object.assign(Object.assign({},j),{color:[0,0,0,0]});var z=[];for(i=0,v=-1;i<l;i+=2,v=x){w=q[i];x=q[i+1];if(w!==v){this._addPolylineSegment(y,z,r);z.length=0;z.push(w);}z.push(x);}this._addPolylineSegment(y,z,r);}else{j=Object.assign(Object.assign({},j),{lineColor:[0,0,0,0],lineWidth:0});var A=[];for(i=0;i<l;i+=3){v=q[i]*3;w=q[i+1]*3;x=q[i+2]*3;A.push(r[v],r[v+this._yIndex],r[w],r[w+this._yIndex],r[x],r[x+this._yIndex]);}y.push({type:"mesh",points:A});}var B=new c({segments:y,isTriangleMesh:!e.isPolyline,matrix:t,material:j,materialID:m,fillStyle:e.isPolyline?null:{colour:j.color},subelement:true});B.uid+="-g";n.add(B);f.pushElementIntoMapArray(this._materialNodesMap,m,B);n.rerender();};
S.prototype.setGeometry=function(e){this._geometries.set(e.id,e);var i=this._geometryMeshes.get(e.id);if(i){for(var m=0;m<i.length;m++){var s=i[m];var n=this._meshNodes.get(s.meshId);if(n){for(var j=0;j<n.length;j++){this._addGeometryToNode(n[j],e,s);}}}}if(this._fireSceneUpdated){this._fireSceneUpdated();}return this;};
S.prototype._setMeshNode=function(n,m){f.pushElementIntoMapArray(this._meshNodes,m,n);var s=this._meshSubmeshes.get(m);if(s){for(var i=0;i<s.length;i++){var e=s[i];var l=h(e.lods);if(l){var j=this._geometries.get(l.id);if(j){this._addGeometryToNode(n,j,e);}}}}};
function k(s){var m=new Float32Array([1,0,0,1,0,0]);if(s.t){m[4]=s.t[0];m[5]=s.t[1];}if(s.r){var x=s.r[0],y=s.r[1],z=s.r[2],w=s.r[3];var e=x*y;var i=z*z;var j=w*z;m[0]=1-(y*y+i)*2;m[1]=(e+j)*2;m[2]=(e-j)*2;m[3]=1-(x*x+i)*2;}if(s.s){m[0]*=s.s[0];m[1]*=s.s[0];m[2]*=s.s[1];m[3]*=s.s[1];}return m;}
function o(s){var e=[];var m;function j(){if(e.length>0){e.forEach(function(t){var r=t.points;if(r&&r.length>=4&&r[0]===r[r.length-2]&&r[1]===r[r.length-1]){t.closed=true;r.length-=2;}});s.push({type:"path",segments:e,materialID:m});e=[];}}var l;var i=0;while(i<s.length){var n=s[i];if(n.type==="line"){if(m!==n.materialID){j();m=n.materialID;}l=k(n);var x=n.x1*l[0]+n.y1*l[2]+l[4];var y=n.x1*l[1]+n.y1*l[3]+l[5];var p=n.x2*l[0]+n.y2*l[2]+l[4];var q=n.x2*l[1]+n.y2*l[3]+l[5];var r=e.length>0?e[e.length-1].points:null;if(r&&r[r.length-2]===x&&r[r.length-1]===y){r.push(p,q);}else{e.push({type:"polyline",points:[x,y,p,q]});}s.shift();}else{i++;}}j();}
S.prototype.setParametricContent=function(n,p,s){if(p==null){L.warning("Empty parametric content for node "+n);return;}this._resetCurrentScene(s);var e=this._nodes.get(n);e.uid+="-p";var j=p.shapes;if(j){o(j);for(var i=0;i<j.length;i++){var l=this._createObject(j[i]);if(l){e.add(l);}}}else{var m=this._createObject(p);if(m){e.add(m);}}e.rerender();};
S.prototype._createObject=function(p){p.matrix=k(p);p.subelement=true;p.material=this._getMaterial(p.materialID);if(this._lineStyles&&p.stroke_id!==undefined){p.lineStyle=this._lineStyles.get(p.stroke_id);}if(this._fillStyles&&p.fill_id!==undefined){p.fillStyle=this._fillStyles.get(p.fill_id);}if(this._textStyles&&p.style_id!==undefined){p.style=this._textStyles.get(p.style_id);}var s;switch(p.type){case"arc":case"ellipticalArc":p.segments=[{type:"arc",cx:p.cx||0,cy:p.cy||0,rx:p.major||p.radius,ry:p.minor||p.radius,start:p.start>p.end?p.start-Math.PI*2:p.start,end:p.end}];s=new c(p);break;case"rectangle":s=new R(p);break;case"line":s=new b(p);break;case"polyline":s=new P(p);break;case"ellipse":case"circle":s=new a(p);break;case"text":if(this._rootNode.matrix[3]<0){p.matrix[2]*=-1;p.matrix[3]*=-1;}s=new T(p);break;case"path":s=new c(p);break;default:L.warning("Unsupported parametric type",p.type);s=null;break;}if(s){s.userData.po=p;s.uid+="-s";if(p.materialID){f.pushElementIntoMapArray(this._materialNodesMap,p.materialID,s);}}return s;};
S.prototype.removeNode=function(n){this._nodes.delete(n.sid);};
S.prototype.createMaterial=function(m){var e=m.id;var i=this._getMaterial(e);i.lineColor=m.lineColour;i.lineWidth=m.lineWidth||1;i.lineStyle={width:m.lineWidth||1,haloWidth:m.lineHaloWidth||0,endCapStyle:m.lineEndRound?1:0,dashPattern:m.lineDashPattern||[],dashPatternScale:m.lineDashPatternScale,widthCoordinateSpace:m.lineWidthCoordinateSpace};if(m.emissiveColour){i.color=m.emissiveColour;}if(m.opacity!==undefined){i.opacity=m.opacity;}var n=this._materialNodesMap.get(e);if(n){for(var j=0;j<n.length;j++){n[j].setMaterial(i,true);}}return[];};
S.prototype._getMaterial=function(m){return this._materialMap.get(m)||this._createTemporaryMaterial(m);};
S.prototype._createTemporaryMaterial=function(m){var e={materialId:m,lineColor:[0,0,0,1],lineWidth:1};this._materialMap.set(m,e);return e;};
S.prototype.checkMaterialExists=function(m,t){if(!this._materialMap.get(m)){if(t){this._createTemporaryMaterial(m);}return false;}return true;};
S.prototype.updateViewsForReplacedNodes=function(n){};
S.prototype.insertFillStyle=function(e){this._fillStyles.set(e.veid,e);};
S.prototype.insertLineStyle=function(l){this._lineStyles.set(l.veid,l);};
S.prototype.insertTextStyle=function(t){this._textStyles.set(t.veid,t);};
var u=function(i){var j="";try{var C=0x8000;var l=0;var m=i.length;var s;while(l<m){s=i.slice(l,Math.min(l+C,m));j+=String.fromCharCode.apply(null,s);l+=C;}}catch(e){j="";}return j;};
S.prototype.createImage=function(i){if(i.binaryData.length<32){L.warning("SceneBuilder.createImage()","Can't create image from empty data");return this;}var e=new DataView(i.binaryData.buffer);var j=true;if(e.getUint8(0,true)===parseInt("0xFF",16)&&e.getUint8(1,true)===parseInt("0xD8",16)){j=false;}var l=u(i.binaryData);var m="data:image/"+(j?"png":"jpeg")+";base64,"+btoa(l);this._images.set(i.id,m);return this;};
S.prototype.setViewThumbnail=function(i,v,s,t){this._resetCurrentScene(s);var e=this._views.get(v);var j=this._images.get(i);if(e&&j){if(e.userData!==undefined){if(e.userData.viewInfo.thumbnailId===i){e.thumbnailData=j;}}}return this;};
return S;});
sap.ui.predefine('sap/ui/vk/svg/Text',["./Element","./Path"],function(E,P){"use strict";var T=function(p){p=p||{};E.call(this,p);this.type="Text";this.content=p.content||(p.text?[{type:10,text:p.text}]:[]);this.style=p.style||{};this.style.size=this.style.size||1;this.x=(p.textTranslate&&p.textTranslate[0])||p.x||0;this.y=(p.textTranslate&&p.textTranslate[1])||p.y||0;this.fillStyle=p.fillStyle||{colour:[0,0,0,1]};this.lineStyle=p.lineStyle||{colour:[0,0,0,0],width:1};if(this.style.fill){this.fillStyle={colour:this.style.fill};}if(this.style.stroke){if(this.lineStyle==null){this.lineStyle={};}this.lineStyle.colour=this.style.stroke;}this.setMaterial(p.material);};T.prototype=Object.assign(Object.create(E.prototype),{constructor:T});
T.prototype.tagName=function(){return"text";};
T.prototype.defaultFillAlpha=1;var a=document.createElement("canvas");var b=a.getContext("2d");
T.prototype._expandBoundingBox=function(f,m){if(this.domRef){var g=this.domRef.getBBox();if(g){this._expandBoundingBoxCE(f,m,g.x+g.width*0.5,g.y+g.height*0.5,g.width*0.5,g.height*0.5);return;}}function h(p){var t="";for(var i=0,l=p.length;i<l;i++){var c=p[i];switch(c.type){case 10:t+=c.text;break;case 11:case 12:t+=h(c.content);break;default:break;}}return t;}var j=isNaN(this.strokeWidth)?0:this.strokeWidth*0.5;b.font=this.style.size+"px "+(this.style.fontFace||"Arial");var k=b.measureText(h(this.content));var n=k.width*0.5+j;var o=(k.actualBoundingBoxAscent||this.style.size)*0.5+j;this._expandBoundingBoxCE(f,m,this.x+n,this.y-o,n,o);};
function s(c,f){if(c.size){f("font-size",c.size);}if(c.fontFace){f("font-family",c.fontFace);}}
T.prototype._setSpecificAttributes=function(c){c("x",this.x);c("y",this.y);s(this.style,c);};
function r(f,g){for(var i=0,l=f.length;i<l;i++){var c=f[i];switch(c.type){case 10:g.write(c.text);break;case 11:g.write("<tspan");if(c.style){s(c.style,g.writeAttribute.bind(g));}g.write(">");r(c.content,g);g.write("</tspan>");break;case 12:g.write("<textPath");if(c.style){s(c.style,g.writeAttribute.bind(g));}if(!c.path&&c.pathSegments){c.path=new P({segments:c.pathSegments});}var p=c.path;if(p instanceof P){g.writeAttribute("href","#"+p.uid);g.write(">");g.write("<"+p.tagName());g.writeAttribute("id",p.uid);p._setSpecificAttributes(g.writeAttribute.bind(g));g.write("/>");}else{g.write(">");}r(c.content,g);g.write("</textPath>");break;default:break;}}}
T.prototype._renderContent=function(c){r(this.content,c);};
var d="http://www.w3.org/2000/svg";
function e(f,p){var g;for(var i=0,l=f.length;i<l;i++){var c=f[i];switch(c.type){case 10:p.append(c.text);break;case 11:g=document.createElementNS(d,"tspan");if(c.style){s(c.style,g.setAttribute.bind(g));}e(c.content,g);p.append(g);break;case 12:g=document.createElementNS(d,"textPath");if(c.style){s(c.style,g.setAttribute.bind(g));}if(!c.path&&c.pathSegments){c.path=new P({segments:c.pathSegments});}var h=c.path;if(h instanceof P){g.setAttribute("href","#"+h.uid);var j=document.createElementNS(d,h.tagName());j.setAttribute("id",h.uid);h._setSpecificAttributes(j.setAttribute.bind(j));g.append(j);}e(c.content,g);p.append(g);break;default:break;}}}
T.prototype._createContent=function(c){e(this.content,c);};
T.prototype.copy=function(c,f){E.prototype.copy.call(this,c,f);this.content=c.content;this.style=c.style;this.x=c.x;this.y=c.y;return this;};
return T;});
sap.ui.predefine('sap/ui/vk/svg/ViewStateManager',["sap/base/Log","../Core","../ViewStateManagerBase","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","../AnimationTrackType","./Scene","./Element"],function(L,v,V,c,a,b,d,A,S,E){"use strict";var e;
var f=V.extend("sap.ui.vk.svg.ViewStateManager",{metadata:{}});
var g=f.getMetadata().getParent().getClass().prototype;
f.prototype.init=function(){if(g.init){g.init.call(this);}this._mask=(1|0);this._nodeHierarchy=null;this._selectedNodes=new Set();this._visibilityTracker=new e();this.setHighlightColor(0xC00000FF);v.getEventBus().subscribe("sap.ui.vk","activateView",this._onActivateView,this);};
f.prototype.exit=function(){v.getEventBus().unsubscribe("sap.ui.vk","activateView",this._onActivateView,this);};
f.prototype._setContent=function(i){var s=null;if(i&&i instanceof S){s=i;}this._setScene(s);if(s){var k=s.getInitialView();if(k){this._currentView=k;this._resetNodesStatusByCurrenView(this._currentView);}}return this;};
f.prototype._setScene=function(s){this._setNodeHierarchy(s?s.getDefaultNodeHierarchy():null);if(s){s.setViewStateManager(this);}this._scene=s;return this;};
f.prototype._setNodeHierarchy=function(n){var o=this._nodeHierarchy;if(this._nodeHierarchy){this._nodeHierarchy=null;this._selectedNodes.clear();this._visibilityTracker.clear();}if(n){this._nodeHierarchy=n;this._nodeHierarchy.attachNodeReplaced(this._handleNodeReplaced,this);this._nodeHierarchy.attachNodeUpdated(this._handleNodeUpdated,this);this._nodeHierarchy.attachNodeRemoving(this._handleNodeRemoving,this);this._initialState={visible:[],hidden:[]};var t=this;var i=n.findNodesByName();i.forEach(function(k){(k.isVisible(t._mask)?t._initialState.visible:t._initialState.hidden).push(k);});this.fireVisibilityChanged({visible:this._initialState.visible,hidden:this._initialState.hidden});}if(n!==o){this.fireNodeHierarchyReplaced({oldNodeHierarchy:o,newNodeHierarchy:n});}return this;};
f.prototype._handleNodeReplaced=function(i){var r=i.getParameter("ReplacedNodeRef");var k=i.getParameter("ReplacementNodeRef");if(this.getSelectionState(r)){this.setSelectionState(k,true);this.setSelectionState(r,false);}};
f.prototype._handleNodeUpdated=function(i){var n=i.getParameter("nodeRef");if(this.getSelectionState(n)){this.setSelectionState(n,false);this.setSelectionState(n,true);}};
f.prototype._handleNodeRemoving=function(i){var n=i.getParameter("nodeRef");if(this.getSelectionState(n)){this.setSelectionState(n,false,true,true);}};
f.prototype.getNodeHierarchy=function(){return this._nodeHierarchy;};
f.prototype.getVisibilityChanges=function(){return this.getShouldTrackVisibilityChanges()?this._visibilityTracker.getInfo(this.getNodeHierarchy()):null;};
f.prototype.getCurrentView=function(){var i=sap.ui.getCore().byId(this.getViewManager());if(!i){return null;}var k=i.getActiveView();return k;};
f.prototype.getVisibilityComplete=function(){var n=this.getNodeHierarchy(),i=n.findNodesByName(),k=[],l=[];i.forEach(function(m){var o=n.createNodeProxy(m);var p=o.getVeId();n.destroyNodeProxy(o);if(p){if(this.getVisibilityState(m)){k.push(p);}else{l.push(p);}}},this);return{visible:k,hidden:l};};
f.prototype.resetVisibility=function(){this.setVisibilityState(this._initialState.visible,true,false);this.setVisibilityState(this._initialState.hidden,false,false);this._visibilityTracker.clear();};
f.prototype.getVisibilityState=function(n){var m=this._mask;if(Array.isArray(n)){return n.map(function(i){return i?i.isVisible(m):false;});}return n?n.isVisible(m):false;};
f.prototype.setVisibilityState=function(n,i,r){if(!Array.isArray(n)){n=[n];}var k=Array.isArray(i);var l=[];var m=n;if(r){m=[];n.forEach(function(t,w){var x=this._collectNodesRecursively(t);m=m.concat(x);var y=l.length;l.length=y+x.length;l.fill(k?i[w]:i,y);},this);}else if(!k){l.length=m.length;l.fill(i);}else{l=i;}var o=[];var u=new Set();var p=this._mask;var q=m.filter(function(t,w){if(u.has(t)){return false;}u.add(t);var q=t?t.isVisible(p)!=l[w]:false;if(q){o.push(l[w]);}return q;},this);if(q.length>0){var s={visible:[],hidden:[]};q.forEach(function(t,w){if(o[w]){t.setVisible(p,true);s.visible.push(t);}else{t.setVisible(p,false);s.hidden.push(t);}},this);if(this.getShouldTrackVisibilityChanges()){q.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker);}this.fireVisibilityChanged(s);}return this;};
f.prototype.enumerateSelection=function(i){this._selectedNodes.forEach(i);return this;};
f.prototype.getSelectionState=function(n){var s=this._selectedNodes;function i(k){return s.has(k);}return Array.isArray(n)?n.map(i):i(n);};
f.prototype._getSelectionComplete=function(){var n=this.getNodeHierarchy(),s=[];function i(k){var l=n.createNodeProxy(k);var m=l.getVeId();n.destroyNodeProxy(l);return m;}this._selectedNodes.forEach(function(k){var l=i(k);if(l){s.push(l);}});return{selected:s};};
f.prototype._isAncestorSelected=function(n){n=n.parent;while(n){if(this._selectedNodes.has(n)){return true;}n=n.parent;}return false;};
f.prototype._updateHighlightColor=function(n,p){var s=p||this._selectedNodes.has(n);n.setSelected(this._mask,s,this._highlightColorABGR);var k=n.children;for(var i=0,l=k.length;i<l;i++){this._updateHighlightColor(k[i],s);}};
f.prototype.setSelectionState=function(n,s,r,i){if(!Array.isArray(n)){n=[n];}n=(r||this.getRecursiveSelection()?this._collectNodesRecursively(n):n).filter(function(l,m,o){return o.indexOf(l)===m;});if(this.getRecursiveSelection()&&!s){n=this._nodeHierarchy._appendAncestors(n);}var k=n.filter(function(l){return this._selectedNodes.has(l)!==s;},this);if(k.length>0){k.forEach(function(l){if(l){this._selectedNodes[s?"add":"delete"](l);}},this);k.forEach(function(l){if(l){this._updateHighlightColor(l,s||this._isAncestorSelected(l));}},this);if(!i){this.fireSelectionChanged({selected:s?k:[],unselected:s?[]:k});}}return this;};
f.prototype.setSelectionStates=function(s,u,r,i){if(!Array.isArray(s)){s=[s];}if(!Array.isArray(u)){u=[u];}s=(r||this.getRecursiveSelection()?this._collectNodesRecursively(s):s);u=(r||this.getRecursiveSelection()?this._collectNodesRecursively(u):u);if(this.getRecursiveSelection()){u=this._nodeHierarchy._appendAncestors(u,s);}var k=s.filter(function(n){return n&&(this._selectedNodes.has(n)===false);},this);var l=u.filter(function(n){return n&&(this._selectedNodes.has(n)===true);},this);if(k.length>0||l.length>0){k.forEach(function(n){this._selectedNodes.add(n);this._updateHighlightColor(n,true);},this);l.forEach(function(n){this._selectedNodes.delete(n);},this);l.forEach(function(n){this._updateHighlightColor(n,this._isAncestorSelected(n));},this);if(!i){this.fireSelectionChanged({selected:k,unselected:l});}}return this;};
f.prototype._collectNodesRecursively=function(n){var r=[],t=this;if(!Array.isArray(n)){n=[n];}n.forEach(function k(i){r.push(i);t._nodeHierarchy.enumerateChildren(i,k,false,true);});return r;};
f.prototype._getOpacity=function(n){return n.opacity!==undefined?n.opacity:null;};
f.prototype.getOpacity=function(n){if(Array.isArray(n)){return n.map(this._getOpacity,this);}else{return this._getOpacity(n);}};
f.prototype.setTotalOpacity=function(n,t){this.setOpacity(n,t);return{opacity:t,totalOpacity:t};};
f.prototype.setOpacity=function(n,o,r){if(!Array.isArray(n)){n=[n];}var i=Array.isArray(o);if(o===null){o=undefined;}else if(i){o.forEach(function(s,t){if(s===null){o[t]=undefined;}});}var k=[];var l=n;if(!i){k.length=l.length;k.fill(o);}else{k=o;}var m=[];var u=new Set();var p=l.filter(function(s,t){if(u.has(s)){return false;}u.add(s);var p=s?s.opacity!==k[t]:false;if(p){m.push(k[t]);}return p;},this);if(p.length>0){var q=this._mask;p.forEach(function(s,t){s.setOpacity(q,m[t]);},this);this.fireOpacityChanged({changed:p,opacity:i?m:m[0]});}return this;};
f.prototype._getTintColorABGR=function(n){return n.tintColor!==undefined?n.tintColor:null;};
f.prototype._getTintColor=function(n){return n.tintColor!==undefined?a(b(n.tintColor)):null;};
f.prototype.getTintColor=function(n,i){var k=i?"_getTintColorABGR":"_getTintColor";if(Array.isArray(n)){return n.map(this[k],this);}else{return this[k](n);}};
function h(i){switch(typeof i){case"number":return i>>>0;case"string":return sap.ui.core.CSSColor.isValid(i)?d(c(i)):undefined;default:return undefined;}}
f.prototype.setTintColor=function(n,t,r){if(!Array.isArray(n)){n=[n];}var i=Array.isArray(t);var k=[];var l=n;if(r){l=[];n.forEach(function(w,x){var y=this._collectNodesRecursively(w);l=l.concat(y);var z=k.length;k.length=z+y.length;k.fill(i?t[x]:t,z);},this);}else if(!i){k.length=l.length;k.fill(t);}else{k=t;}var m=[];var u=new Set();var o=l.filter(function(w,x){if(u.has(w)){return false;}u.add(w);var o=w?w.tintColor!==h(k[x]):false;if(o){m.push(k[x]);}return o;},this);if(o.length>0){var p=this._mask;var q=[];o.forEach(function(w,x){var y=h(m[x]);w.setTintColor(p,y);q.push(y);},this);var s={changed:o,tintColor:i?m:m[0],tintColorABGR:i?q:q[0]};this.fireTintColorChanged(s);}return this;};
f.prototype.setHighlightColor=function(i){i=h(i);if(i===undefined){return this;}this._highlightColorABGR=i;if(this._selectedNodes.size>0){this._selectedNodes.forEach(function(n){this._updateHighlightColor(n,true);},this);}this.fireHighlightColorChanged({highlightColor:a(b(i)),highlightColorABGR:i});return this;};
f.prototype.getHighlightColor=function(i){return i?this._highlightColorABGR:a(b(this._highlightColorABGR));};
f.prototype.getTransformationWorld=function(n){function i(k){return E._decompose(k._matrixWorld());}if(!Array.isArray(n)){return i(n);}var r=[];n.forEach(function(k){r.push(i(k));});return r;};
f.prototype.getTransformation=function(n){function i(k){var t=E._decompose(k.matrix);return{translation:t.position,quaternion:t.quaternion,scale:t.scale};}if(!Array.isArray(n)){return i(n);}var r=[];n.forEach(function(k){r.push(i(k));});return r;};
function j(i){return new Float32Array([i[0],i[4],i[1],i[5],i[3],i[7]]);}
f.prototype.setTransformation=function(n,t){var i=Array.isArray(n);if(!Array.isArray(n)){n=[n];}var k={changed:[],transformation:[]};var l=function(m){return E._decompose(m.matrix);};if(!t){n.forEach(function(m){if(m.userData.matrix){m.setMatrix(m.userData.matrix);delete m.userData.matrix;}k.changed.push(m);k.transformation.push(l(m));},this);}else{if(!Array.isArray(t)){t=[t];}n.forEach(function(m,o){if(!m.userData.matrix){m.userData.matrix=m.matrix.slice();}var p=t[o];if(p.transform){m.setMatrix(j(p.transform));}else{var q;if(p.quaternion){q=p.quaternion;}else if(p.angleAxis){var r=p.angleAxis;var u=r[3]/2,s=Math.sin(u);q=[r[0]*s,r[1]*s,r[2]*s,Math.cos(u)];}else if(p.euler){L.warning("svg.ViewStateManager.setTransformation: Euler angles are not yet supported");q=[0,0,0,1];}var w=E._compose(p.translation,q,p.scale);m.setMatrix(w);}k.changed.push(m);k.transformation.push(l(m));},this);}if(!i){k.changed=k.changed[0];k.transformation=k.transformation[0];}this.fireTransformationChanged(k);return this;};
f.prototype._resetNodesStatusByCurrenView=function(i){var n=this.getNodeHierarchy();var k=i.getNodeInfos();if(!n||!k){return;}var l=[];var t=[];k.forEach(function(p){if(p.target){if(p.transform){l.push(p.target);t.push({transform:p.transform});}else if(p[A.Translate]&&p[A.Rotate]&&p[A.Scale]){l.push(p.target);t.push({translation:p[A.Translate].slice(),quaternion:p[A.Rotate].slice(),scale:p[A.Scale].slice()});}}});if(i.userData&&i.userData.nodeStartDataByAnimation){i.userData.nodeStartDataByAnimation.forEach(function(p,q){if(p[A.Translate]&&p[A.Rotate]&&p[A.Scale]){l.push(q);t.push({translation:p[A.Translate].slice(),quaternion:p[A.Rotate].slice(),scale:p[A.Scale].slice()});}});}if(l.length){this.setTransformation(l,t);}var m=[];var o=[];k.forEach(function(p){if(!p.target.userData.skipIt){(p.visible?m:o).push(p.target);}});this.setVisibilityState(n.getChildren()[0].children,false,true);this.setVisibilityState(m,true,false);this.setVisibilityState(o,false,false);};
f.prototype._onActivateView=function(i,k,l){var m=this.getViewManager();if(m&&l.source.getId()===m){this.activateView(l.view);}};
f.prototype.activateView=function(i){this.fireViewStateApplying({view:i});this._resetNodesStatusByCurrenView(i);this.fireViewStateApplied({view:i});v.getEventBus().publish("sap.ui.vk","viewStateApplied",{source:this,view:i});return this;};
f.prototype.setJoints=function(i,p){return this;};
f.prototype._propagateOpacityToJointChildren=function(n,o){return this;};
f.prototype._setJointNodeMatrix=function(){return this;};
e=function(){this._visibilityChanges=new Set();};
e.prototype.getInfo=function(n){var i=[];this._visibilityChanges.forEach(function(k){var l=n.createNodeProxy(k);var m=l.getVeId();n.destroyNodeProxy(l);if(m){i.push(m);}else{i.push(n.getScene().nodeRefToPersistentId(k));}});return i;};
e.prototype.clear=function(){this._visibilityChanges.clear();};
e.prototype.trackNodeRef=function(n){if(this._visibilityChanges.has(n)){this._visibilityChanges.delete(n);}else{this._visibilityChanges.add(n);}};
return f;});
sap.ui.predefine('sap/ui/vk/svg/Viewport',["../Core","./ViewportRenderer","../ViewportBase","sap/ui/core/ResizeHandler","sap/ui/events/KeyCodes","../Loco","../ViewStateManager","./ViewStateManager","../ViewportHandler","../VisibilityMode","../ZoomTo","../SelectionMode","../NodeContentType","../getResourceBundle","../Messages","./Scene","./OrthographicCamera","./Element","./Rectangle","./HotspotHelper","../colorToCSSColor","../cssColorToColor","../colorToABGR","../abgrToColor","sap/base/Log"],function(v,V,c,R,K,L,d,e,g,h,Z,S,N,j,M,k,O,E,l,H,m,n,o,p,q){"use strict";
var r=c.extend("sap.ui.vk.svg.Viewport",{metadata:{library:"sap.ui.vk",events:{cameraChanged:{parameters:{offset:"float[]",zoom:"float"},enableEventBubbling:true},hotspotEnter:{parameters:{nodeRef:"any"},enableEventBubbling:true},hotspotLeave:{parameters:{nodeRef:"any"},enableEventBubbling:true}}}});
var s=r.getMetadata().getParent().getClass().prototype;
r.prototype.init=function(){if(s.init){s.init.call(this);}this._resizeListenerId=null;this._animLoopRequestId=0;this._animLoopFunction=this._animLoop.bind(this);this._width=this._height=0;this._camera=new O();this._gestureX=0;this._gestureY=0;this._scene=null;this._selectionRect=new l({material:{lineColor:[0.75,0.75,0,1],lineStyle:{dashPattern:[2,2]}}});this._viewportHandler=new g(this);this._loco=new L(this);this._loco.addHandler(this._viewportHandler,-1);this._hotspotHelper=new H();this._currentViewIndex=0;this._currentView=null;v.getEventBus().subscribe("sap.ui.vk","viewStateApplied",this._onViewStateApplied,this);};
r.prototype.exit=function(){v.getEventBus().unsubscribe("sap.ui.vk","viewStateApplied",this._onViewStateApplied,this);this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this.setScene(null);this._renderer=null;this._loco=null;this._viewportHandler=null;if(s.exit){s.exit.call(this);}};
r.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}};
r.prototype.onAfterRendering=function(){this._resizeListenerId=R.register(this,this._handleResize.bind(this));var a=this.getDomRef();if(this._scene){var b=this._scene.getRootElement();b._setDomRef(document.getElementById(b.uid));this._hotspotEffect=b.domRef?b.domRef.parentNode.getElementById("hotspot-effect"):null;}else{this._hotspotEffect=null;}this._handleResize({size:{width:a.clientWidth,height:a.clientHeight}});};
r.prototype._handleResize=function(a){var b=this._width;var f=this._height;this._width=a.size.width;this._height=a.size.height;if(b===0||f===0){this.zoomTo(Z.All,null,0,0);}else{this._camera.update(this._width,this._height,b,f);this._updateViewBox();this.fireCameraChanged({viewBox:this._getViewBox()});}this.fireResize({size:{width:this._width,height:this._height}});return true;};
r.prototype.setScene=function(a){this._scene=a;this._currentViewIndex=0;this._currentView=null;if(a){var i=a.getInitialView();if(i){this.activateView(i);}this._onContentLoadingFinished();}return this;};
r.prototype.getScene=function(){return this._scene;};
r.prototype.onSetViewStateManager=function(a){this._viewStateManager=a;a.attachOutliningChanged(this._onOutliningOrSelectionChanged,this);a.attachSelectionChanged(this._onOutliningOrSelectionChanged,this);};
r.prototype.onRemoveViewStateManager=function(a){a.detachOutliningChanged(this._onOutliningOrSelectionChanged,this);a.detachSelectionChanged(this._onOutliningOrSelectionChanged,this);this._viewStateManager=null;};
r.prototype._getViewStateManagerSVG=function(){if(this._viewStateManager){if(this._viewStateManager instanceof e){return this._viewStateManager;}if(this._viewStateManager instanceof d&&this._viewStateManager._implementation instanceof e){return this._viewStateManager._implementation;}}return null;};
r.prototype.hitTest=function(x,y){var a=this._getViewStateManagerSVG();if(!a||!this._scene){return null;}var b=this._scene.getRootElement();var f=this.getDomRef().getBoundingClientRect();var i=document.elementFromPoint(x+f.x,y+f.y);var z=i!==null&&i.id?b.getElementById(i.id):null;return z?z._getSceneTreeElement():null;};
r.prototype.tap=function(x,y,i){var a=this.hitTest(x,y);if(!i){this.tapObject(a);if(a!==null){this.fireNodeClicked({nodeRef:a,x:x,y:y},true,true);}}else if(!this.getFreezeCamera()){if(a&&this._camera.zoomedObject!==a){this._camera.zoomedObject=a;this.zoomTo(Z.Node,this._camera.zoomedObject,0.5,0.1);}else{this._camera.zoomedObject=null;this.zoomTo(Z.Visible,null,0.5,0);}}return this;};
r.prototype.tapObject=function(a){var b={picked:a?[a]:[]};this.fireNodesPicked(b);if(this.getSelectionMode()===S.Exclusive){this.exclusiveSelectionHandler(b.picked);}else if(this.getSelectionMode()===S.Sticky){this.stickySelectionHandler(b.picked);}return this;};
var t={x:-2,y:-2};var u=2;var w=5;
r.prototype.onkeydown=function(a){if(!a.isMarked()){switch(a.keyCode){case K.ARROW_LEFT:case K.ARROW_RIGHT:case K.ARROW_UP:case K.ARROW_DOWN:if(a.ctrlKey||a.altKey||a.metaKey){break;}var b={x:0,y:0};switch(a.keyCode){case K.ARROW_LEFT:b.x=-1;break;case K.ARROW_RIGHT:b.x=+1;break;case K.ARROW_UP:b.y=-1;break;case K.ARROW_DOWN:b.y=+1;break;default:break;}this.beginGesture(t.x,t.y);if(a.shiftKey){this.pan(w*b.x,w*b.y);}else{this.rotate(u*b.x,u*b.y,true);}this.endGesture();a.preventDefault();a.stopPropagation();break;case 189:case K.PLUS:case K.NUMPAD_MINUS:case K.NUMPAD_PLUS:this.beginGesture(this._width*0.5,this._height*0.5);this.zoom(a.keyCode===K.PLUS||a.keyCode===K.NUMPAD_PLUS?1.02:0.98);this.endGesture();a.preventDefault();a.stopPropagation();break;default:break;}}};
r.prototype._onOutliningOrSelectionChanged=function(a){var b=this.getTools();for(var i=0;i<b.length;i++){var f=sap.ui.getCore().byId(b[i]);var x=f.getGizmoForContainer(this);if(x&&x.handleSelectionChanged){x.handleSelectionChanged(a);}}};
r.prototype.setSelectionRect=function(a){var b=document.getElementById(this._selectionRect.uid);if(b){if(a){b.removeAttribute("display");a=this._camera._transformRect(a);b.setAttribute("x",a.x1,a.x2);b.setAttribute("y",a.y1,a.y2);b.setAttribute("width",a.x2-a.x1);b.setAttribute("height",a.y2-a.y1);}else{b.setAttribute("display","none");}}};
r.prototype._select=function(a){var b=this._getViewStateManagerSVG();if(b&&this._scene){a=this._camera._transformRect(a);var f=new Set();this._scene.getRootElement()._findRectElementsRecursive(f,a,b._mask);b.setSelectionStates(Array.from(f),[]);return Array.from(f);}return[];};
r.prototype.getImage=function(a,b,f,i,x){return null;};
r.prototype._setContent=function(a){this.setScene(a instanceof k?a:null);var b=new O();b.reset(a&&a.camera,this._width,this._height);this.setCamera(b);if(this.getScene()){var i=this.getScene().getInitialView();if(i&&this._getViewStateManagerSVG()){this.activateView(i,false,true);}}return this;};
r.prototype.onSetContentConnector=function(a){c.prototype.onSetContentConnector.call(this,a);a.attachContentLoadingFinished(this._onContentLoadingFinished,this);};
r.prototype.onUnsetContentConnector=function(a){a.detachContentLoadingFinished(this._onContentLoadingFinished,this);c.prototype.onUnsetContentConnector.call(this,a);};
r.prototype._onContentLoadingFinished=function(a){if(this._scene){var b=this._scene.getDefaultNodeHierarchy();if(b){var f=this.getShowAllHotspots()?1:0;var i=b.getHotspotNodeIds();i.forEach(function(x){this._hotspotHelper.updateHotspot(x,undefined,f);},this);}this.zoomTo(Z.All,null,0,0);this.invalidate();}};
function A(a,b,f){return a+(b-a)*f;}
function B(a,b,x){x=Math.min(Math.max((x-a)/(b-a),0.0),1.0);return x*x*x*(x*(x*6-15)+10);}
r.prototype._animLoop=function(){this._animLoopRequestId=0;var a=this._anim;if(a){var b=a.start;var i=a.end;var x=Date.now();var f=Math.min(B(0,1,(x-b.time)/a.duration),1);this._camera.offsetX=A(b.offsetX,i.offsetX,f);this._camera.offsetY=A(b.offsetY,i.offsetY,f);this._camera.zoom=A(b.zoom,i.zoom,f);this.fireCameraChanged({viewBox:this._getViewBox()});if(this._updateViewBox()&&(x-b.time)<a.duration){this._animLoopRequestId=window.requestAnimationFrame(this._animLoopFunction);}else{delete this._anim;}}};
r.prototype.getCurrentView=function(){return this._currentView;};
r.prototype._onViewStateApplied=function(a,b,f){if(f.source===this._getViewStateManagerSVG()){this.activateView(f.view);}};
r.prototype.activateView=function(a){if(!this._scene){return this;}var b=this._scene.getViewGroups();var f=this;if(b){b.forEach(function(x){x.getViews().forEach(function(y){if(y===a){f._currentViewIndex=x.getViews().indexOf(y);}});});}this.fireViewActivated({viewIndex:this._currentViewIndex,view:a});v.getEventBus().publish("sap.ui.vk","viewActivated",{source:this,view:a,viewIndex:this._currentViewIndex});v.getEventBus().publish("sap.ui.vk","readyForAnimation",{source:this._getViewStateManagerSVG(),view:a,ignoreAnimationPosition:false});this._currentView=a;var i=a.getCamera();if(i){this.setCamera(i);}if(a.topColor!==undefined){this.setBackgroundColorTop(m({red:a.topColor[0]*255,green:a.topColor[1]*255,blue:a.topColor[2]*255,alpha:a.topColor[3]}));}if(a.bottomColor!==undefined){this.setBackgroundColorBottom(m({red:a.bottomColor[0]*255,green:a.bottomColor[1]*255,blue:a.bottomColor[2]*255,alpha:a.bottomColor[3]}));}this.rerender();this.fireViewFinished({viewIndex:this._currentViewIndex});return this;};
r.prototype.resetCurrentView=function(){if(this._currentView){this._getViewStateManagerSVG()._resetNodesStatusByCurrenView(this._currentView);this.rerender();}return this;};
r.prototype.zoomTo=function(a,b,f,i){if(this._width===0||this._height===0||this._scene==null){return this;}var x={min:{x:Infinity,y:Infinity},max:{x:-Infinity,y:-Infinity}};var y=this._getViewStateManagerSVG();(Array.isArray(a)?a:[a]).forEach(function(a){switch(a){case Z.All:this._scene.getRootElement()._expandBoundingBoxRecursive(x,-1>>>0);break;case Z.Visible:if(y){this._scene.getRootElement()._expandBoundingBoxRecursive(x,y._mask);}break;case Z.Selected:if(y){y.enumerateSelection(function(b){b._expandBoundingBoxRecursive(x,-1>>>0);});}break;case Z.Node:if(!b){return this;}if(Array.isArray(b)){b.forEach(function(b){b._expandBoundingBoxRecursive(x,-1>>>0);});}else{b._expandBoundingBoxRecursive(x,-1>>>0);}break;case Z.Restore:q.error(j().getText("VIEWPORT_MSG_RESTORENOTIMPLEMENTED"));return this;case Z.NodeSetIsolation:q.error(j().getText("VIEWPORT_MSG_NODESETISOLATIONNOTIMPLEMENTED"));return this;case Z.RestoreRemoveIsolation:q.error(j().getText("VIEWPORT_MSG_RESTOREREMOVEISOLATIONNOTIMPLEMENTED"));return this;case Z.ViewLeft:case Z.ViewRight:case Z.ViewTop:case Z.ViewBottom:case Z.ViewBack:case Z.ViewFront:return this;default:break;}}.bind(this));if(x.min.x<x.max.x&&x.min.y<x.max.y){var z=new O();z._zoomTo(x,this._width,this._height,i);this._activateCamera(z,f);}return this;};
r.prototype._activateCamera=function(a,f){if(f>0&&!this._animLoopRequestId){this._anim={start:{time:Date.now(),offsetX:this._camera.offsetX,offsetY:this._camera.offsetY,zoom:this._camera.zoom},end:{offsetX:a.offsetX,offsetY:a.offsetY,zoom:a.zoom},duration:f*1e3};this._animLoopRequestId=window.requestAnimationFrame(this._animLoopFunction);}else{this._camera.zoom=a.zoom;this._camera.offsetX=a.offsetX;this._camera.offsetY=a.offsetY;this._updateViewBox();this.fireCameraChanged({viewBox:this._getViewBox()});}};
r.prototype.beginGesture=function(x,y){this._gestureX=(x-this._camera.offsetX)/this._camera.zoom;this._gestureY=(y-this._camera.offsetY)/this._camera.zoom;};
r.prototype.endGesture=function(){this._gestureX=0;this._gestureY=0;};
r.prototype.pan=function(a,b){if(!this.getFreezeCamera()){this._camera.offsetX+=a;this._camera.offsetY+=b;this._updateViewBox();this.fireCameraChanged({viewBox:this._getViewBox()});}};
r.prototype.rotate=function(a,b){this.pan(a,b);};
r.prototype.zoom=function(z){if(!this.getFreezeCamera()){var a=this._camera.zoom;this._camera.zoom*=z;this._camera.offsetX+=this._gestureX*(a-this._camera.zoom);this._camera.offsetY+=this._gestureY*(a-this._camera.zoom);this._updateViewBox();this.fireCameraChanged({viewBox:this._getViewBox()});}};
r.prototype.hover=function(x,y){var a=this._getViewStateManagerSVG();if(!a){return;}var b=this.getDisableHotspotHovering()?null:this.hitTest(x,y);if(this._hotspotElement&&this._hotspotElement!==b){this.fireHotspotLeave({nodeRef:this._hotspotElement});if(!this.getShowAllHotspots()){this._hotspotElement.setOpacity(a._mask,0);}this._hotspotElement=null;}if(b&&b._vkGetNodeContentType()===N.Hotspot){this._hotspotElement=b;if(!this.getShowAllHotspots()){b.setOpacity(a._mask,1);}this.fireHotspotEnter({nodeRef:b});}};
r.prototype._getViewBox=function(){var a=this._camera.zoom>0?1/this._camera.zoom:1;return[-this._camera.offsetX*a,-this._camera.offsetY*a,this._width*a,this._height*a];};
r.prototype._updateViewBox=function(){var a=this._scene?this._scene.getRootElement():null;var b=a?a.domRef:null;if(b){b.parentNode.setAttribute("viewBox",this._getViewBox().join(" "));if(this._hotspotEffect){var f=this._getHotspotEffectScale();var i=f*8;this._hotspotEffect.setAttribute("x",-i+"%");this._hotspotEffect.setAttribute("y",-i+"%");this._hotspotEffect.setAttribute("width",(100+i*2)+"%");this._hotspotEffect.setAttribute("height",(100+i*2)+"%");this._hotspotEffect.children[0].setAttribute("stdDeviation",f);}return true;}return false;};
r.prototype._getHotspotEffectScale=function(){return this._camera&&this._camera.zoom>0?8/this._camera.zoom:0;};
r.prototype.getViewInfo=function(a){var b={};if(a==null){a={};}if(a.camera==null){a.camera=true;}if(a.camera){b.camera={viewBox:this._getViewBox()};}if(a.visibility&&this._viewStateManager){var f=a.visibility.mode==null?h.Complete:a.visibility.mode;b.visibility={mode:f};if(f===h.Complete){var i=this._viewStateManager.getVisibilityComplete();b.visibility.visible=i.visible;b.visibility.hidden=i.hidden;}else if(this._viewStateManager.getShouldTrackVisibilityChanges()){b.visibility.changes=this._viewStateManager.getVisibilityChanges();}else{q.warning(j().getText(M.VIT32.summary),M.VIT32.code,"sap.ui.vk.threejs.Viewport");}}var x=this._getViewStateManagerSVG();if(a.selection&&x){b.selection=x._getSelectionComplete();}return b;};
r.prototype.setViewInfo=function(a,f){var b=a.camera;if(b&&b.viewBox){var i=new O();i._setViewBox(b.viewBox,this._width,this._height);this._activateCamera(i,f);}var x=new Map();if(a.visibility||a.selection){var y=this._viewStateManager.getNodeHierarchy(),z=y.findNodesByName();z.forEach(function(Q){var T=y.createNodeProxy(Q);var U=T.getVeId();y.destroyNodeProxy(T);if(U){x.set(U,Q);}});}if(a.visibility){switch(a.visibility.mode){case h.Complete:var C=a.visibility.visible,D=a.visibility.hidden;C.forEach(function(Q){this._viewStateManager.setVisibilityState(x.get(Q),true,false);},this);D.forEach(function(Q){this._viewStateManager.setVisibilityState(x.get(Q),false,false);},this);break;case h.Differences:this._viewStateManager.resetVisibility();a.visibility.changes.forEach(function(Q){var T=x.get(Q);if(T){this._viewStateManager.setVisibilityState(T,!this._viewStateManager.getVisibilityState(T),false);}},this);break;default:q.error(j().getText(M.VIT28.summary),M.VIT28.code,"sap.ui.vk.threejs.Viewport");break;}}var F=this._getViewStateManagerSVG();var G=a.selection;if(G&&F){var I=F._getSelectionComplete();if(Array.isArray(G.selected)){var J=[];var P=[];G.selected.forEach(function(Q){var T=x.get(Q);if(T){J.push(T);}});I.selected.forEach(function(Q){var T=x.get(Q);if(T&&G.selected.indexOf(Q)<0){P.push(T);}});F.setSelectionStates(J,P,false,false);}}return this;};
r.prototype.queueCommand=function(a){if(this instanceof r){a();}return this;};
r.prototype.getOutputSize=function(){var b=this.getDomRef().getBoundingClientRect();var a=b.width;var f=b.height;var i;i=Math.min(a,f);return{left:(a-i)*0.5,top:(f-i)*0.5,sideLength:i};};
r.prototype.setShouldRenderFrame=function(){};
r.prototype._isPanoramicActivated=function(){return false;};
r.prototype.setShowAllHotspots=function(a){this.setProperty("showAllHotspots",a,true);var b=this._getViewStateManagerSVG();if(b){var f=b.getNodeHierarchy();var i=f.getHotspotNodeIds();var x=this._hotspotElement;i.forEach(function(y){if(y.domRef){if(a){y.setOpacity(b._mask,1);}else if(y!==x){y.setOpacity(b._mask,0);}}});}};
r.prototype.setDisableHotspotHovering=function(a){this.setProperty("disableHotspotHovering",a,true);if(a){this.hover(0,0);}};
r.prototype.setHotspotColorABGR=function(a){this.setProperty("hotspotColorABGR",a,true);this.setProperty("hotspotColor",m(p(a)),true);this.invalidate();return this;};
r.prototype.setHotspotColor=function(a){this.setProperty("hotspotColor",a,true);this.setProperty("hotspotColorABGR",o(n(a)),true);this.invalidate();return this;};
return r;});
sap.ui.predefine('sap/ui/vk/svg/ViewportRenderer',["../abgrToColor"],function(a){"use strict";var V={};
V.render=function(r,v){r.write("<div");r.writeControlData(v);r.addClass("sapVizKitViewport");r.writeClasses();r.writeAttribute("tabindex",0);r.writeAttribute("aria-label","Image");r.writeAttribute("role","figure");r.addStyle("width",v.getWidth());r.addStyle("height",v.getHeight());r.addStyle("background-image","linear-gradient("+v.getBackgroundColorTop()+","+v.getBackgroundColorBottom()+")");r.writeStyles();r.write(">");r.write("<svg xmlns=\"http://www.w3.org/2000/svg\"");r.writeAttribute("width","100%");r.writeAttribute("height","100%");r.writeAttribute("viewBox",v._getViewBox().join(" "));r.addStyle("position","absolute");r.writeStyles();r.write(">");var h=a(v.getHotspotColorABGR());var s=v._getHotspotEffectScale();var e=s*8;r.write("			<defs>				<filter id='hotspot-effect' x='-"+e+"%' y='-"+e+"%' width='"+(100+e*2)+"%' height='"+(100+e*2)+"%'>					<feGaussianBlur in='SourceGraphic' stdDeviation='"+v._getHotspotEffectScale()+"' result='blur'/>					<feColorMatrix in='blur' type='matrix' values='0 0 0 0 "+(h.red/255)+", 0 0 0 0 "+(h.green/255)+", 0 0 0 0 "+(h.blue/255)+", 0 0 0 "+(h.alpha*2)+" 0' result='color-blur'/>					<feComposite operator='out' in='color-blur' in2='SourceGraphic'/>				</filter>			</defs>		");var b=v.getScene();if(b){var c=v._getViewStateManagerSVG();b.getRootElement().render(r,c?c._mask:(-1|0));}v._selectionRect.render(r,0|0);r.write("</svg>");var i,l;var t=v.getTools();for(i=0,l=t.length;i<l;i++){var d=sap.ui.getCore().byId(t[i]);var g=d.getGizmoForContainer(v);if(g&&g.hasDomElement()){r.renderControl(g);}}var f=v.getContent();for(i=0,l=f.length;i<l;i++){r.renderControl(f[i]);}r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/threejs/AnimationHelper',["../thirdparty/three","../View","../AnimationPlayback","../AnimationTrackType","../AnimationTrackValueType","../AnimationTrackValueTypeSize","../AnimationRotateType","../AnimationMath"],function(t,V,A,a,b,c,d,e){"use strict";var f=function(){};
f.prototype._getChildNodesWithMaterial=function(p,g){for(var h=0;p.children&&h<p.children.length;h++){var i=p.children[h];if(i&&i.material&&i.material.color){g.push(i);}this._getChildNodesWithMaterial(i,g);}};
f.prototype._getVkTrackType=function(g){switch(g.type){case"TRANSLATE":return a.Translate;case"ROTATE":return a.Rotate;case"SCALE":return a.Scale;case"OPACITY":return a.Opacity;case"COLOR":return a.Color;default:}};
f.prototype._getVkTrackValueType=function(g,r){switch(g.type){case"TRANSLATE":return b.Vector3;case"ROTATE":if(r===d.Quaternion){return b.Quaternion;}else if(r===d.AngleAxis){return b.AngleAxis;}else{return b.Euler;}break;case"SCALE":return b.Vector3;case"OPACITY":return b.Scalar;case"COLOR":return b.Vector3;default:}};
f.prototype.insertEmptyTrack=function(g,s,n,h){var i=this._getVkTrackValueType(g);var v=h.createTrack(null,{trackValueType:i,isAbsoluteValue:g.isAbsoluteValue});if(s&&n){s.setNodeAnimation(n,this._getVkTrackType(g),v,true);}};
f.prototype.insertTracks=function(g,h,n,s){g.forEach(function(i){var k=h.get(i.id);var v=s.findTrack(i.id.toString());if(Array.isArray(k)&&k.length){if(!v){var l=this._getVkTrackValueType(k[0],i.rotateType);var m=c.get(l);v=s.createTrack(i.id.toString(),{trackValueType:l,cycleForward:i.cyclicInfo.cyclicEnd,cycleBackward:i.cyclicInfo.cyclicStart,infinite:i.infinite,isAbsoluteValue:k[0].isAbsoluteValue});if(i.times){i.times.forEach(function(o,p){var q;if(l===b.Scalar){q=i.values[p];}else{q=[];for(var j=0;j<m;j++){q.push(i.values[p*m+j]);}}v.insertKey(o,q,true);});}}k.forEach(function(j){var o=s.findSequence(j.sequenceId);var p=n.get(j.targetId);if(o&&p){o.setNodeAnimation(p,this._getVkTrackType(j),v,true);}},this);}},this);return this;};
f.prototype.setInitialNodePositionsFromSubsequentViews=function(v,s,o){if(!v||!v.length){return;}var g;var n;var h;var i=new Map();for(var j=v.length-1;j>0;j--){var k=v[j];var l;if(k){l=k.getPlaybacks();}if(l){for(var p=l.length-1;p>=0;p--){var m=l[p];if(m){g=s.findSequence(m.getSequence().getId());if(g){if(o&&!g.hasHighlight()){continue;}if(!m.getReversed()){n=g.getNodesBoundaryValues(true).entries();}else{n=g.getNodesBoundaryValues(false).entries();}h=n.next();while(!h.done){i.set(h.value[0],h.value[1]);h=n.next();}}}}}var q=v[j-1];if(q){if(!q.userData){q.userData={};}if(!q.userData.nodeStartDataByAnimation){q.userData.nodeStartDataByAnimation=new Map();}n=i.entries();h=n.next();while(!h.done){q.userData.nodeStartDataByAnimation.set(h.value[0],h.value[1]);h=n.next();}}}};
f.prototype.setInitialNodePositionsFromPreviousViews=function(v,s,o){if(!v||!v.length){return;}var g;var n;var h;var i=new Map();for(var j=0;j<v.length-1;j++){var p=v[j];var k;if(p){k=p.getPlaybacks();}if(k){for(var l=0;l<k.length;l++){var m=k[l];if(m){g=s.findSequence(m.getSequence().getId());if(g){if(o&&!g.hasHighlight()){continue;}if(!m.getReversed()){n=g.getNodesBoundaryValues(false).entries();}else{n=g.getNodesBoundaryValues(true).entries();}h=n.next();while(!h.done){i.set(h.value[0],h.value[1]);h=n.next();}}}}}var q=v[j+1];if(q){if(!q.userData){q.userData={};}if(!q.userData.nodeStartDataByAnimation){q.userData.nodeStartDataByAnimation=new Map();}n=i.entries();h=n.next();while(!h.done){q.userData.nodeStartDataByAnimation.set(h.value[0],h.value[1]);h=n.next();}}}};
f.prototype.setInitialNodePositionsOnView=function(v,s,o){if(!v){return;}var n;var g;var h=0;var i=null;i=v.getPlaybacks();if(!i||!i.length){return;}if(!v.userData){v.userData={};}if(!v.userData.nodeStartDataByAnimation){v.userData.nodeStartDataByAnimation=new Map();}for(var j=i.length-1;j>=h;j--){var p=i[j];var k=s.findSequence(p.getSequence().getId());if(k){if(o&&!k.hasHighlight()){continue;}if(p.getReversed()){n=k.getNodesBoundaryValues(false).entries();}else{n=k.getNodesBoundaryValues(true).entries();}g=n.next();while(!g.done){v.userData.nodeStartDataByAnimation.set(g.value[0],g.value[1]);g=n.next();}}}};
f.prototype.setInitialNodePositionsFromCurrenetViews=function(v,s,o){if(!v||!v.length){return;}for(var g=0;g<v.length;g++){var h=v[g];if(!h){continue;}this.setInitialNodePositionsOnView(h,s,o);}};
f.prototype.setPlaybackStartTimes=function(v,s){if(!v||!v.length){return;}for(var g=0;g<v.length;g++){var h=v[g];if(!h){continue;}var i=null;if(h){i=h.getPlaybacks();}if(!i||!i.length){continue;}var j=0;for(var k=0;k<i.length;k++){var p=i[k];var l=p.getSequence();if(l){l.resetDuration(true);}p.setStartTime(j);j+=p.getDuration();}}};
f.prototype.prepareViewForAnimation=function(v){var n=v.getNodeInfos();if(!n){return;}if(!v.userData){v.userData={};}if(!v.userData.nodesDataByView){v.userData.nodesDataByView=new Map();}else{return;}function g(l){return new THREE.Matrix4().set(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8],l[9],l[10],l[11],0,0,0,1);}for(var h=0;h<n.length;h++){var i=n[h];if(!i||!i.target){continue;}var j={};if(i.transform){j.position=new THREE.Vector3();j.scale=new THREE.Vector3();j.quaternion=new THREE.Quaternion();var k=g(i.transform);k.decompose(j.position,j.quaternion,j.scale);v.userData.nodesDataByView.set(i.target,j);}}};
f.prototype.getNodePositionByView=function(v,n){var g;if(!v){return g;}if(!v.userData||!v.userData.nodesDataByView){this.prepareViewForAnimation(v);}if(v.userData&&v.userData.nodesDataByView){g=v.userData.nodesDataByView.get(n);}return g;};
f.prototype.getNodePositionFromNearestPlayback=function(s,v,g,n){var h;if(!v||!s){return h;}var p=v.getPlaybacks();if(!p){return h;}var i;var j;var k=0;for(i=0;i<p.length;i++){j=p[i];if(g==j.getSequenceId()){k=j.getStartTime();break;}}var m=0;for(i=0;i<p.length;i++){j=p[i];var l=j.getStartTime();if(k<=l){continue;}if(g==j.getSequenceId()){continue;}var o=s.findSequence(j.getSequenceId());if(o){var q;if(j.getReversed()){q=o.getNodesStartValues();}else{q=o.getNodesEndValues();}var r=q.get(n);if(r&&l>=m){h=r;m=l;}}}return h;};
f.prototype._buildViewInitialState=function(v,g,s){var h=g.indexOf(v);if(h<0){return undefined;}var i;var j;var p;var l=new Map();var m=function(k,o,q){var r=l.get(k);if(!r){r={target:k};l.set(k,r);}r[o]=q;};var n=function(o,u){if(!o){return;}var q=o.getNodeAnimation();if(q){q.forEach(function(r){var w=r.nodeRef;for(var x in a){var y=a[x];var z=r[y];if(z&&z.getKeysCount()){var B=u?0:z.getKeysCount()-1;var C=z.getKey(B);var D=z.getKeysType();var k=0;if(D===b.AngleAxis){k=1;}var E=e.interpolate(D,C,C,k,z);m(w,y,E.value);}}});}};for(i=g.length-1;i>=h;i--){p=g[i].getPlaybacks();if(Array.isArray(p)){for(j=p.length-1;j>=0;j--){n(p[j].getSequence(),true);}}}for(i=0;i<h;i++){p=g[i].getPlaybacks();if(Array.isArray(p)){for(j=0;j<p.length;j++){n(p[j].getSequence(),false);}}}return l;};
f.prototype.buildViewsInitialState=function(v,s){if(!Array.isArray(v)){return;}var g=function(n){var r=[];n.forEach(function(h,i){r.push(h);});return r;};v.forEach(function(h){var n=this._buildViewInitialState(h,v,s);if(n){h.updateNodeInfos(g(n));}},this);};
return f;});
sap.ui.predefine('sap/ui/vk/threejs/BaseNodeProxy',["../BaseNodeProxy"],function(B){"use strict";
var a=B.extend("sap.ui.vk.threejs.BaseNodeProxy",{metadata:{}});
a.prototype.init=function(n,b){this._object3D=b;};
a.prototype.reset=function(){this._object3D=null;};
a.prototype.getNodeRef=function(){return this._object3D;};
a.prototype.getNodeId=function(){return this._object3D;};
a.prototype.getName=function(){return this._object3D.name||("<"+this._object3D.type+">");};
a.prototype.getNodeMetadata=function(){return this._object3D.userData.metadata||{};};
a.prototype.getHasChildren=function(){return this._object3D.children.length>0;};
a.prototype.getSceneRef=function(){return this._object3D;};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/Billboard',["sap/ui/base/ManagedObject","../thirdparty/three","../thirdparty/html2canvas","../BillboardCoordinateSpace","../BillboardTextEncoding","../BillboardStyle","../BillboardBorderLineStyle","../BillboardHorizontalAlignment","./ThreeUtils","../NodeContentType"],function(B,t,h,b,c,d,e,f,T,N){"use strict";
var g=B.extend("sap.ui.vk.threejs.Billboard",{metadata:{properties:{node:{type:"any",defaultValue:new THREE.Group()},text:{type:"string",defaultValue:""},font:{type:"string",defaultValue:""},fontSize:{type:"float",defaultValue:20},fontWeight:{type:"string",defaultValue:"normal"},fontItalic:{type:"boolean",defaultValue:false},textColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},borderColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},borderOpacity:{type:"float",defaultValue:1},backgroundColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},backgroundOpacity:{type:"float",defaultValue:0.5},encoding:{type:"sap.ui.vk.BillboardTextEncoding",defaultValue:c.PlainText},width:{type:"float",defaultValue:100},height:{type:"float",defaultValue:100},style:{type:"sap.ui.vk.BillboardStyle",defaultValue:d.None},borderLineStyle:{type:"sap.ui.vk.BillboardBorderLineStyle",defaultValue:e.Solid},borderWidth:{type:"float",defaultValue:2},horizontalAlignment:{type:"sap.ui.vk.BillboardHorizontalAlignment",defaultValue:f.Left},texture:{type:"any",defaultValue:null},material:{type:"any"},link:{type:"string",defaultValue:""},coordinateSpace:{type:"sap.ui.vk.BillboardCoordinateSpace",defaultValue:b.Viewport},position:{type:"any",defaultValue:new THREE.Vector3(0,0,0)},renderOrder:{type:"int",defaultValue:0}}}});
g.prototype.init=function(){if(B.prototype.init){B.prototype.init.call(this);}var a=new THREE.BufferGeometry();a.setIndex([0,1,2,2,1,3]);a.setAttribute("position",new THREE.Float32BufferAttribute([-0.5,-0.5,0,0.5,-0.5,0,-0.5,0.5,0,0.5,0.5,0],3));a.setAttribute("normal",new THREE.Float32BufferAttribute([0,0,1,0,0,1,0,0,1,0,0,1],3));a.setAttribute("uv",new THREE.Float32BufferAttribute([0,0,1,0,0,1,1,1],2));var i=new THREE.MeshBasicMaterial({depthTest:false,depthWrite:false,transparent:true,alphaTest:0.05,premultipliedAlpha:true,side:THREE.DoubleSide});this.setProperty("material",i,true);this._billboard=new THREE.Mesh(a,i);this._needUpdateTexture=true;};
g.prototype.exit=function(){if(B.prototype.exit){B.prototype.exit.call(this);}if(this._billboard){T.disposeObject(this._billboard);this._billboard=null;}};
g.prototype.setNode=function(n){if(n instanceof THREE.Object3D){this.setProperty("node",n,true);n.add(this._billboard);n.matrixAutoUpdate=false;n.isBillboard=true;n.userData.billboard=this;this._traverse(function(a){a.userData.skipIt=true;});}return this;};
g.prototype._traverse=function(a){a(this._billboard);};
g.prototype.setEncoding=function(v){this.setProperty("encoding",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setText=function(v){this.setProperty("text",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setFont=function(v){this.setProperty("font",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setFontSize=function(v){this.setProperty("fontSize",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setFontWeight=function(v){this.setProperty("fontWeight",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setFontItalic=function(v){this.setProperty("fontItalic",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setStyle=function(v){this.setProperty("style",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setWidth=function(v){this.setProperty("width",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setHeight=function(v){this.setProperty("height",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setTextColor=function(v){this.setProperty("textColor",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setBackgroundColor=function(v){this.setProperty("backgroundColor",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setBackgroundOpacity=function(v){this.setProperty("backgroundOpacity",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setBorderWidth=function(v){this.setProperty("borderWidth",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setBorderLineStyle=function(v){this.setProperty("borderLineStyle",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setBorderColor=function(v){this.setProperty("borderColor",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setBorderOpacity=function(v){this.setProperty("borderOpacity",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setHorizontalAlignment=function(v){this.setProperty("horizontalAlignment",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setLink=function(v){this.setProperty("link",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setTexture=function(v){this.setProperty("texture",v,true);this._billboard.material.map=v;return this;};
g.prototype.setMaterial=function(v){this.setProperty("material",v,true);this._billboard.material=v;return this;};
g.prototype.setRenderOrder=function(v){this.setProperty("renderOrder",v,true);this._traverse(function(a){a.renderOrder=v;});return this;};
g.prototype._renderBackground=function(a,w,i,n){a.fillStyle=this.getBackgroundColor();a.strokeStyle=this.getBorderColor();a.lineWidth=n;switch(this.getBorderLineStyle()){default:a.setLineDash([]);break;case e.Dash:a.setLineDash([n*5,n]);break;case e.Dot:a.setLineDash([n*2,n]);break;case e.DashDot:a.setLineDash([n*5,n,n*2,n]);break;case e.DashDotDot:a.setLineDash([n*5,n,n*2,n,n*2,n]);break;}var o=n/2;if(this.getStyle()===d.RectangularShape){a.globalAlpha=this.getBackgroundOpacity();if(a.globalAlpha>0){a.fillRect(0,0,w,i);}a.globalAlpha=n>0?this.getBorderOpacity():0;if(a.globalAlpha>0){a.strokeRect(o,o,w-n,i-n);}}else if(this.getStyle()===d.CircularShape){var x=w/2;var y=i/2;var r=w/2;a.beginPath();a.arc(x,y,r-o,0,2*Math.PI);a.closePath();a.globalAlpha=this.getBackgroundOpacity();if(a.globalAlpha>0){a.fill();}a.globalAlpha=n>0?this.getBorderOpacity():0;if(a.globalAlpha>0){a.stroke();}}a.globalAlpha=1;a.setLineDash([]);};
g.prototype._getFont=function(a){return(this.getFontItalic()?"italic ":"")+this.getFontWeight()+" "+(this.getFontSize()*a)+"px "+(this.getFont()||"Arial");};
g.prototype._renderPlainText=function(n){var o=document.createElement("canvas");var r=o.getContext("2d");var s=this.getFontSize()*n;var u=this._getFont(n);r.font=u;var v=Math.ceil(s);var w=this.getBorderLineStyle()!==e.None?this.getBorderWidth()*n:0;var z=Math.ceil(s*0.2+w);var A=this.getText().split("\n");var C=0;A.forEach(function(I){C=Math.max(C,r.measureText(I).width);});var D=this.getLink();if(D.length>0){C=Math.max(C,r.measureText(D).width);}C=Math.ceil(C*0.5)*2;var E=A.length+(D.length>0?1:0);var F=Math.ceil(v*E*0.5)*2;var G=C+z*2;var H=F+z*2;if(this.getStyle()===d.CircularShape){G=H=Math.max(G,H);}this._width=G/n;this._height=H/n;o.width=THREE.Math.ceilPowerOfTwo(G);o.height=THREE.Math.ceilPowerOfTwo(H);this._renderBackground(r,G,H,w);r.font=u;r.textAlign=this.getHorizontalAlignment();r.textBaseline="middle";var a=["left","center","right"].indexOf(r.textAlign);var x=(G+C*(a-1))>>1;var y=(H-(E-1)*v)>>1;r.fillStyle=this.getTextColor();r.filter="blur(0px)";for(var i in A){r.fillText(A[i],x,y+v*i);}if(D.length>0){r.fillStyle="#00f";r.textAlign="right";r.textBaseline="bottom";r.fillText(D,G-z,H-z);}this._setBillboardTexture(o,G,H);};
g.prototype._renderHtmlText=function(a){var i=document.createElement("canvas");var n=i.getContext("2d");var o=this.getBorderLineStyle()!==e.None?this.getBorderWidth()*a:0;var r=Math.ceil(o);var w=Math.ceil(this.getWidth()*a)+r*2;var s=Math.ceil(this.getHeight()*a)+r*2;if(this.getStyle()===d.CircularShape){w=s=Math.max(w,s);}this._width=w/a;this._height=s/a;i.width=THREE.Math.ceilPowerOfTwo(w);i.height=THREE.Math.ceilPowerOfTwo(s);this._renderBackground(n,w,s,o);var u=this.getLink();if(u.length>0){n.font=this._getFont(a);n.fillStyle="#00f";n.textAlign="right";n.textBaseline="bottom";n.fillText(u,w-r,s-r);}var v=document.createElement("iframe");v.style.visibility="hidden";v.width=(w-r*2)/a;v.height=(s-r*2)/a;document.body.appendChild(v);var x=v.contentDocument||v.contentWindow.document;x.open();x.close();x.body.innerHTML=this.getText();var y=document.createElement("canvas");y.width=v.width*a;y.height=v.height*a;y.style.width=v.width+"px";y.style.height=v.height+"px";var z=y.getContext("2d");z.scale(a,a);this._billboard.material.visible=false;h(x.body,{canvas:y,backgroundColor:null}).then(function(y){if(y.width>0&&y.height>0){i.getContext("2d").drawImage(y,r,r);}setTimeout(this._setBillboardTexture.bind(this,i,w,s),0);document.body.removeChild(v);}.bind(this));};
g.prototype._setBillboardTexture=function(a,w,i){var u=w/a.width,v=i/a.height;this._billboard.geometry.setAttribute("uv",new THREE.Float32BufferAttribute([0,1-v,u,1-v,0,1,u,1],2));var n=new THREE.CanvasTexture(a);n.magFilter=THREE.NearestFilter;this._billboard.material.map=n;this._billboard.material.needsUpdate=true;this._billboard.material.visible=true;};
var p=new THREE.Vector4(),j=new THREE.Vector3(),k=new THREE.Vector3(),l=new THREE.Vector3(),q=new THREE.Quaternion(),m=new THREE.Vector3();
g.prototype._updateTexture=function(){this._width=this.getWidth();this._height=this.getHeight();if(this.getText()&&!this.getTexture()){switch(this.getEncoding()){default:case c.PlainText:this._renderPlainText(window.devicePixelRatio);break;case c.HtmlText:this._renderHtmlText(window.devicePixelRatio);break;}}};
g.prototype._update=function(r,a,v){var n=this.getNode();if(!n||!n.visible){return;}if(this._needUpdateTexture){this._needUpdateTexture=false;this._updateTexture();}n.matrix.getInverse(n.parent.matrixWorld);n.matrix.decompose(n.position,n.quaternion,n.scale);n.matrixWorld.identity();this._billboard.quaternion.copy(a.quaternion);var s=this.getPosition(),i=this._billboard.position,o=1;if(s){i.copy(s);}else{i.setScalar(0);}var u=this.getCoordinateSpace();if(u===b.Screen){o=THREE.Math.lerp(a.near,a.far,1e-4);i.multiplyScalar(2/a.projectionMatrix.elements[5]);i.z=-1;i.multiplyScalar(o).applyMatrix4(a.matrixWorld);}else if(u===b.Viewport){if(v.x>v.y){i.x*=v.y/v.x;}else{i.y*=v.x/v.y;}i.z=-0.9999;i.unproject(a);p.copy(i).applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix);var w=(p.x/p.w)*0.5*v.x,x=(p.y/p.w)*0.5*v.y;o=p.w*2/(v.x*a.projectionMatrix.elements[0]);j.setFromMatrixColumn(a.matrixWorld,0).multiplyScalar(o*(Math.round(w)-w));k.setFromMatrixColumn(a.matrixWorld,1).multiplyScalar(o*(Math.round(x)-x));i.add(j).add(k);}this._billboard.scale.set(this._width*o,this._height*o,1);this._billboard.updateMatrix();this._billboard.updateMatrixWorld();};
g.prototype._ortho2DUpdate=function(r,a){if(!this.visible){return;}var o=this.userData.originalTransform;var i=a.near*1.0001;if(Math.abs(o.q.w-1)>1e-3){i=Math.min(i+a.near*o.s.length()*0.5,(a.near+a.far)*0.5);}this.position.copy(o.p).multiplyScalar(2/a.projectionMatrix.elements[5]);this.position.z=-1;this.position.multiplyScalar(i).applyMatrix4(a.matrixWorld);q.copy(a.quaternion).multiply(o.q);this.quaternion.copy(q);this.scale.copy(o.s).multiplyScalar(i*0.5);this.scale.z=Math.min(i-a.near,this.scale.z*0.001);this.matrixWorld.compose(this.position,this.quaternion,this.scale);this.matrix.getInverse(this.parent.matrixWorld).multiply(this.matrixWorld);this.matrix.decompose(this.position,this.quaternion,this.scale);this.updateMatrixWorld(true);};
g.prototype._billboardViewUpdate=function(r,a){if(!this.visible){return;}this.parent.matrixWorld.decompose(l,q,m);q.inverse().multiply(a.quaternion);this.quaternion.copy(q);if(a.userData.rotate&&this._vkGetNodeContentType()===N.Symbol){var i=THREE.Math.degToRad(a.fov);var n=a.getWorldDirection(new THREE.Vector3());var o=this.getWorldPosition(new THREE.Vector3());var s=Math.asin(o.distanceTo(n.multiplyScalar(500))/1000);this.baseScale=this.baseScale?this.baseScale:this.scale.clone();this.scale.copy(this.baseScale).multiplyScalar(i*Math.cos(2*s));var u=a.position.z;if(u){var v=(99-u)/99;this.scale.multiplyScalar(v);}}this.updateMatrix();this.updateMatrixWorld();};
g.prototype._lockToViewportUpdate=function(r,a){var i=0;this.children.forEach(function(o){if(o.visible&&Math.abs(o.quaternion.w-1)>1e-3){i=Math.max(i,o.scale.length());}});var n=Math.min(a.near*(1.0001+i*0.5),(a.near+a.far)*0.5);this.position.setFromMatrixColumn(a.matrixWorld,2).multiplyScalar(-n);this.position.add(a.position);this.scale.setScalar(n*2/a.projectionMatrix.elements[5]);this.matrixWorld.compose(this.position,a.quaternion,this.scale);this.matrix.getInverse(this.parent.matrixWorld).multiply(this.matrixWorld);this.matrix.decompose(this.position,this.quaternion,this.scale);this.updateMatrixWorld(true);};
return g;});
sap.ui.predefine('sap/ui/vk/threejs/Callout',["../thirdparty/three","sap/ui/base/ManagedObject","./Billboard","../thirdparty/html2canvas","./PolylineGeometry","./PolylineMaterial","./PolylineMesh","../BillboardStyle","../LeaderLineMarkStyle","./ThreeUtils"],function(a,B,b,c,P,d,e,f,L,T){"use strict";
var C=b.extend("sap.ui.vk.threejs.Callout",{metadata:{properties:{anchorNode:{type:"any",defaultValue:null},depthTest:{type:"boolean",defaultValue:true}}}});
C.prototype.init=function(){if(b.prototype.init){b.prototype.init.call(this);}this._lines=[];this._heads=[];};
C.prototype.exit=function(){if(b.prototype.exit){b.prototype.exit.call(this);}this._lines.forEach(function(l){T.disposeObject(l);});this._lines=null;this._heads.forEach(function(h){T.disposeObject(h);});this._heads=null;};
C.prototype._traverse=function(h){b.prototype._traverse.call(this,h);this._lines.forEach(h);this._heads.forEach(h);};
C.prototype.setDepthTest=function(h){this.setProperty("depthTest",h,true);this._traverse(function(i){i.material.depthTest=h;});return this;};
var g=new THREE.Vector4(),j=new THREE.Vector4(),k=new THREE.Vector4(),m=new THREE.Vector2(),n=new THREE.Vector2(),o=new THREE.Vector2(),q=new THREE.Quaternion(),r=new THREE.Matrix4(),u=new THREE.Vector2(),v=new THREE.Vector3(),w=new THREE.Vector3(),z=new THREE.Vector3(0,0,1),A=new THREE.Matrix4(),D=new THREE.Matrix4();
C.prototype._update=function(h,i,l){var s=this.getNode();if(!s||!s.visible){return;}if(this._needUpdateTexture){this._needUpdateTexture=false;this._updateTexture();}s.matrix.getInverse(s.parent.matrixWorld);s.matrix.decompose(s.position,s.quaternion,s.scale);s.matrixWorld.identity();var x=this.getPosition(),y=this._billboard.position;if(x){y.copy(x);}else{y.setScalar(0);}var E=this.getAnchorNode();if(E){y.applyMatrix4(E.matrixWorld);}this._billboard.quaternion.copy(i.quaternion);A.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse);g.copy(y).applyMatrix4(A);m.copy(g).multiplyScalar(1/g.w).multiply(l);var F=g.w*2/(l.x*i.projectionMatrix.elements[0]);this._billboard.scale.set(F*this._width,F*this._height,1);v.setFromMatrixColumn(i.matrixWorld,0).multiplyScalar(F*(Math.round(m.x*0.5)-m.x*0.5));w.setFromMatrixColumn(i.matrixWorld,1).multiplyScalar(F*(Math.round(m.y*0.5)-m.y*0.5));y.add(v).add(w);this._billboard.updateMatrix();this._billboard.updateMatrixWorld();var G=this.getStyle()===f.CircularShape;var H=i.near;function I(p,t,J){if(p<t){return p-t;}else if(p>J){return p-J;}return 0;}this._lines.forEach(function(p){if(p.userData.targetNode){p.matrix.copy(p.userData.targetNode.matrixWorld);}else{p.matrix.identity();}p.matrixWorld.copy(p.matrix);if(p.isPolylineMesh){p.material.resolution.copy(l);}if(p.isHaloMesh){return;}var J=p.geometry.vertices;var K=J[0];var M=J[J.length-2];var N=J[J.length-1];var O=p.userData.startPointMesh;var Q=false;var R=[0,J.length-1];if(O!==undefined){K.copy(O.userData.targetVertex);}D.multiplyMatrices(A,p.matrixWorld);if(p.userData.extensionLength>0&&J.length>2){R.push(J.length-2);g.copy(J[J.length-3]).applyMatrix4(D);n.copy(g).multiplyScalar(1/g.w).multiply(l);M.set(Math.sign(n.x-m.x)*0.5*(1+p.userData.extensionLength/this._width),0,0);M.applyMatrix4(this._billboard.matrixWorld).applyMatrix4(r.getInverse(p.matrixWorld));}g.copy(M).applyMatrix4(D);n.copy(g).multiplyScalar(1/g.w).multiply(l);if(G){var S=u.copy(n).sub(m).length();Q=S<this._width;u.multiplyScalar(0.5/S);N.set(u.x,u.y,0);}else{var U=I(n.x,m.x-this._width,m.x+this._width),V=I(n.y,m.y-this._height,m.y+this._height);Q=(U===0&&V===0);if(Math.abs(U)>Math.abs(V)){N.set(Math.sign(U)*0.5,0,0);}else{N.set(0,Math.sign(V)*0.5,0);}}if(Q){N.copy(M);}else{N.applyMatrix4(this._billboard.matrixWorld).applyMatrix4(r.getInverse(p.matrixWorld));}p.geometry.verticesNeedUpdate=true;if(O!==undefined){O.position.copy(O.userData.targetVertex).applyMatrix4(p.matrixWorld);g.copy(O.position).applyMatrix4(A);var W=g.w/(l.x*i.projectionMatrix.elements[0]);O.scale.setScalar(W);O.visible=false;var X=false;if(g.w>=H){j.copy(g);k.copy(J[1]).applyMatrix4(D);if(k.w<H){var t=(j.w-H)/(j.w-k.w);k.sub(j).multiplyScalar(t).add(j);}o.copy(j).multiplyScalar(1/j.w);n.copy(k).multiplyScalar(1/k.w);u.copy(n).sub(o).multiply(l);X=u.length()<O.userData.lineOffset;q.setFromAxisAngle(z,Math.atan2(u.y,u.x));O.quaternion.copy(i.quaternion).multiply(q);O.updateMatrix();O.matrixWorld.copy(O.matrix);O.matrixWorldNeedsUpdate=false;o.multiply(l).sub(m);O.visible=G?o.length()>this._width:Math.abs(o.x)>this._width||Math.abs(o.y)>this._height;if(X||!O.visible){K.copy(J[1]);}else{K.set(O.userData.lineOffset,0,0).applyMatrix4(O.matrixWorld).applyMatrix4(r.getInverse(p.matrixWorld));}}}p.geometry._updateVertices(R);p.computeLineDistances(D,l,i instanceof THREE.PerspectiveCamera?H:undefined);if(p.userData.haloMesh){p.userData.haloMesh.material.lineLength=p.material.lineLength;}}.bind(this));};
C.prototype._createMarkMesh=function(p,t,E,F){var G=E===L.Arrow;var H=window.devicePixelRatio;var I=t.width;var J=I*t.haloWidth;F=(Array.isArray(F)||F instanceof Float32Array)&&F.length===2?F:[1,1];var K,M;if(G){K=Math.max(35*F[0],I*5);M=Math.max(15*F[1],I*2);}else{K=M=Math.max(2*F[0],I*2);}K=Math.ceil(K+J*2);M=Math.ceil(M+J*2);var N=document.createElement("canvas");N.width=THREE.Math.ceilPowerOfTwo(K*H);N.height=THREE.Math.ceilPowerOfTwo(M*H);var O=N.getContext("2d");var x=K/2,y=M/2;O.fillStyle="#FFF";O.scale(H,H);if(G){O.beginPath();O.moveTo(0,y);O.lineTo(K,0);O.lineTo(K,M);O.closePath();O.fill();var h=K*y/Math.sqrt(K*K+y*y),s=(h-J)/h;var Q=K-K*s,R=y*(K*s-J)/K;O.fillStyle=p.getStyle();O.beginPath();O.moveTo(Q,y);O.lineTo(K-J,y-R);O.lineTo(K-J,y+R);O.closePath();O.fill();}else{var S=K*0.5,U=S-J;O.beginPath();O.ellipse(x,y,S,S,0,0,Math.PI*2);O.fill();O.fillStyle=p.getStyle();O.beginPath();O.ellipse(x,y,U,U,0,0,Math.PI*2);O.fill();}O.fillRect(K-J,y-I*0.5,J,I);var V=new THREE.MeshBasicMaterial({map:new THREE.CanvasTexture(N),flatShading:true,transparent:true,alphaTest:0.05,premultipliedAlpha:true,side:THREE.DoubleSide,depthTest:this.getDepthTest()});var W=new THREE.PlaneBufferGeometry(K*2,M*2);if(G){W.translate(K,0,0);}var X=new THREE.Mesh(W,V);X.userData.skipIt=true;X.userData.lineOffset=(G?K*2-1:K-J*2);var Y=new THREE.Vector2(K*H/N.width,M*H/N.height);var Z=X.geometry.attributes.uv.array;for(var i=0,l=Z.length;i<l;i+=2){Z[i]*=Y.x;Z[i+1]=1-(1-Z[i+1])*Y.y;}return X;};
C.prototype.addLeaderLine=function(h,t,i,s,l,p,x){var y=this.getNode();if(x>0&&h.length<3){h.push(h[h.length-1].clone());}var E=i.userData.lineStyle||{};E.width=E.width||1;E.haloWidth=E.haloWidth||0;E.endCapStyle=E.endCapStyle||0;var F=E.endCapStyle||h.length>2?1:0;var G=(F&&(s!==L.None||E.endCapStyle===0)?1:0)|(F&&(l!==L.None||E.endCapStyle===0)?2:0);var H=new P();H.setVertices(h);var I;if(E.haloWidth>0){var J=new d({color:0xFFFFFF,lineColor:0xFFFFFF,linewidth:E.width*(E.haloWidth*2+1),dashCapStyle:E.endCapStyle,segmentCapStyle:F,trimStyle:G,transparent:true,depthTest:this.getDepthTest()});I=new e(H,J);I.userData.skipIt=true;I.userData.targetNode=t;I.matrixAutoUpdate=false;I.renderOrder=this.getRenderOrder();I.isHaloMesh=true;y.add(I);this._lines.push(I);}var K=new d({color:0xFFFFFF,lineColor:i.color,linewidth:E.width,dashCapStyle:E.endCapStyle,segmentCapStyle:F,trimStyle:G,dashPattern:E.dashPattern||[],dashScale:E.dashPatternScale||1,transparent:true,depthTest:this.getDepthTest()});var M=new e(H,K);M.userData.skipIt=true;M.userData.targetNode=t;M.userData.extensionLength=x;M.userData.haloMesh=I;M.matrixAutoUpdate=false;M.renderOrder=this.getRenderOrder();y.add(M);this._lines.push(M);if(s!==L.None){var N=this._createMarkMesh(i.color,E,s,p);N.userData.targetVertex=H.vertices[0].clone();N.matrixAutoUpdate=false;N.renderOrder=this.getRenderOrder();M.userData.startPointMesh=N;y.add(N);this._heads.push(N);}return M;};
return C;});
sap.ui.predefine('sap/ui/vk/threejs/ContentDeliveryService',["sap/base/Log","sap/ui/base/ManagedObject","../totara/TotaraLoader","../threejs/SceneBuilder","./Material","../thirdparty/three","../getResourceBundle","../ObjectType"],function(L,M,T,S,a,t,g,O){"use strict";
var C=M.extend("sap.ui.vk.threejs.ContentDeliveryService",{
metadata:{properties:{authorizationHandler:"any",maxActiveRequests:{type:"int",defaultValue:4},maxUrlLength:{type:"int",defaultValue:2048},meshesBatchSize:{type:"int",defaultValue:128},materialsBatchSize:{type:"int",defaultValue:128},geometriesBatchSize:{type:"int",defaultValue:128},geometriesMaxBatchDataSize:{type:"int",defaultValue:1048576},geomMeshesBatchSize:{type:"int",defaultValue:128},geomMeshesMaxBatchDataSize:{type:"int",defaultValue:1048576},annotationsBatchSize:{type:"int",defaultValue:128},tracksBatchSize:{type:"int",defaultValue:128},sequencesBatchSize:{type:"int",defaultValue:128},voxelThreshold:{type:"number",defaultValue:0.0},skipLowLODRendering:{type:"boolean",defaultValue:false}},events:{cameraChanged:{parameters:{sceneId:{type:"string"},camera:{type:"any"}},enableEventBubbling:true},sceneUpdated:{parameters:{},enableEventBubbling:true},viewGroupUpdated:{parameters:{currentViewGroupId:"string"},enableEventBubbling:true},sceneCompleted:{parameters:{sceneId:{type:"string"}},enableEventBubbling:true},loadingFinished:{parameters:{currentViewId:"string",currentViewGroupId:"string"},enableEventBubbling:true},contentChangesProgress:{parameters:{percent:"float"}},errorReported:{parameters:{error:{type:"any"}}},initialViewCompleted:{parameters:{sceneId:{type:"string"}},enableEventBubbling:true}}},
constructor:function(i,s){this._loader=new T();this._loader.setSceneBuilder(new S());M.apply(this,arguments);this._transientSceneMap=new Map();this._currentNodeHierarchy=null;}
});
C.prototype.getMaxActiveRequests=function(){return this._loader.getMaxActiveRequests();};
C.prototype.setMaxActiveRequests=function(m){this._loader.setMaxActiveRequests(m);return this;};
C.prototype.getMaxUrlLength=function(){return this._loader.getMaxUrlLength();};
C.prototype.setMaxUrlLength=function(m){this._loader.setMaxUrlLength(m);return this;};
C.prototype.getMeshesBatchSize=function(){return this._loader.getMeshesBatchSize();};
C.prototype.setMeshesBatchSize=function(m){this._loader.setMeshesBatchSize(m);return this;};
C.prototype.getMaterialsBatchSize=function(){return this._loader.getMaterialsBatchSize();};
C.prototype.setMaterialsBatchSize=function(m){this._loader.setMaterialsBatchSize(m);return this;};
C.prototype.getGeometriesBatchSize=function(){return this._loader.getGeometriesBatchSize();};
C.prototype.setGeometriesBatchSize=function(b){this._loader.setGeometriesBatchSize(b);return this;};
C.prototype.getGeometriesMaxBatchDataSize=function(){return this._loader.getGeometriesMaxBatchDataSize();};
C.prototype.setGeometriesMaxBatchDataSize=function(b){this._loader.setGeometriesMaxBatchDataSize(b);return this;};
C.prototype.getGeomMeshesBatchSize=function(){return this._loader.getGeomMeshesBatchSize();};
C.prototype.setGeomMeshesBatchSize=function(b){this._loader.setGeomMeshesBatchSize(b);return this;};
C.prototype.getGeomMeshesMaxBatchDataSize=function(){return this._loader.getGeomMeshesMaxBatchDataSize();};
C.prototype.setGeomMeshesMaxBatchDataSize=function(b){this._loader.setGeomMeshesMaxBatchDataSize(b);return this;};
C.prototype.getAnnotationsBatchSize=function(){return this._loader.getAnnotationsBatchSize();};
C.prototype.setAnnotationsBatchSize=function(b){this._loader.setAnnotationsBatchSize(b);return this;};
C.prototype.getTracksBatchSize=function(){return this._loader.getTracksBatchSize();};
C.prototype.setTracksBatchSize=function(b){this._loader.setTracksBatchSize(b);return this;};
C.prototype.getSequencesBatchSize=function(){return this._loader.getSequencesBatchSize();};
C.prototype.setSequencesBatchSize=function(s){this._loader.setSequencesBatchSize(s);return this;};
C.prototype.getVoxelThreshold=function(){return this._loader.getVoxelThreshold();};
C.prototype.setVoxelThreshold=function(v){this._loader.setVoxelThreshold(v);return this;};
C.prototype.getSkipLowLODRendering=function(){return this._loader.getSkipLowLODRendering();};
C.prototype.setSkipLowLODRendering=function(s){this._loader.setSkipLowLODRendering(s);return this;};
C.prototype.initUrl=function(u,k,c){var b=this;function n(){b.fireSceneUpdated({});}function d(){var e;if(b._loader&&b._loader.currentSceneInfo){var f=b._loader.getContext(b._loader.currentSceneInfo.id);if(f){e=f.currentViewGroupId;}}b.fireViewGroupUpdated({currentViewGroupId:e});}if(!this._loader.running()||this._loader.getUrl()!==u){if(this._loader.running()){var s=this._loader.sceneBuilder;this._loader.dispose();this._loader=new T();this._loader.setSceneBuilder(s);}this._loader.onErrorCallbacks.attach(this._reportError.bind(b));this._loader.onMaterialFinishedCallbacks.attach(n);this._loader.onImageFinishedCallbacks.attach(n);this._loader.onSetGeometryCallbacks.attach(n);this._loader.onViewGroupUpdatedCallbacks.attach(d);this._loader.setUrl(u);this._loader.setCorrelationId(c?c:THREE.Math.generateUUID().toLowerCase());return this._loader.run();}else if(!k){this._loader.cleanup();}return Promise.resolve("Loader is ready");};
C.prototype._reportError=function(e){this.fireErrorReported(e);};
C.prototype._createLoadParam=function(r,b,p,c){var d=this;var i;var s=false;var e;if(this._currentNodeHierarchy){e=this._currentNodeHierarchy.getScene();}var f={root:p,includeHidden:c.getIncludeHidden(),includeAnimation:c.getIncludeAnimation(),pushPMI:c.getPushPMI(),includeBackground:c.getIncludeBackground(),includeParametric:c.getIncludeParametric(),metadataFilter:c.getMetadataFilter(),useSecureConnection:c.getUseSecureConnection(),activateView:c.getActivateView(),enableLogger:c.getEnableLogger()===true,pushViewGroups:c.getPushViewGroups(),vkScene:e,onActiveCamera:function(n){var j=false;var k=d._loader.getContext(c.getVeid());if(k&&k.phase<2){i=n;j=true;}if(!j){d.fireCameraChanged({sceneId:c.getVeid(),camera:n});}},onInitialSceneFinished:function(j){s=true;r({node:p,camera:i,contentResource:c,initialView:j,annotations:d.getSceneBuilder()._annotations,loader:d});},onSceneCompleted:function(){d.fireSceneCompleted({sceneId:c.getVeid()});},onLoadingFinished:function(){var j,k;if(d._loader&&d._loader.currentSceneInfo){var l=d._loader.getContext(d._loader.currentSceneInfo.id);if(l){j=l.currentViewId;k=l.currentViewGroupId;}}d.fireLoadingFinished({currentViewId:j,currentViewGroupId:k});},onContentChangesProgress:function(j){d.fireContentChangesProgress({source:j.source,phase:j.phase,percentage:j.percentage});},onInitialViewCompleted:function(){d.fireInitialViewCompleted({sceneId:c.getVeid()});}};var h=function(j){L.warning("Content loading error reported:",JSON.stringify(j.getParameters()));var k;if(j.getParameter("errorText")){k=j.getParameter("errorText");}else if(j.getParameter("error")){k=j.getParameter("error");}else if(j.getParameter("reason")){k=j.getParameter("reason");}else{k="failed to load: unknown reason";}if(s){var l=j.getParameter("error");if(l&&l===4){d.initUrl(this._loader.getUrl(),true);}}else{d.detachErrorReported(h);if(j.getParameter("events")){k=k+"\n"+JSON.stringify(j.getParameter("events"));}b(k);}};d.attachErrorReported(h);return f;};
C.prototype.load=function(p,c,b){var d=this;var n=c.getNodeProxy();if(n){this._currentNodeHierarchy=n.getNodeHierarchy();}return new Promise(function(r,e){if(!c.getSource()||!c.getVeid()){e(g().getText("CONTENTDELIVERYSERVICE_MSG_NOURLORVEID"));return;}d.initUrl(c.getSource(),true);var f=d._createLoadParam(r,e,p,c);if(d._loader){d._loader.request(c.getVeid(),f,b);}});};
C.prototype.getSceneBuilder=function(){if(this._loader){return this._loader.getSceneBuilder();}return null;};
C.prototype.decrementResourceCountersForDeletedTreeNode=function(s){var c=this._loader.getContext(this._loader.currentSceneInfo.id);this._loader.decrementResourceCountersForDeletedTreeNode(c,s);};
C.prototype.loadTransientScene=function(s,p,u){var b=this;return new Promise(function(r,c){if(!s||!p){c(g().getText("CONTENTDELIVERYSERVICE_MSG_INVALIDARGUMENTS"));return;}if(b._transientSceneMap.has(s)){var d=b._transientSceneMap.get(s).clone();p.add(d);r({nodeRef:d});return;}if(!b._loader){c(g().getText("CONTENTDELIVERYSERVICE_MSG_CONTENTDELIVERYSERVICENOTINITIALISED"));return;}var h=function(){b.detachLoadingFinished(h);if(b._transientSceneMap.get(s)){var d=b._transientSceneMap.get(s).clone();p.add(d);r({nodeRef:d});}};if(b._loader.contextMap.has(s)){b.attachLoadingFinished(h);return;}var e=new THREE.Object3D();e.name="transient";e.userData.currentSceneId=b.getSceneBuilder()._currentSceneId;var o=function(){var i=b._loader.getContext(s);i.onSceneCompletedCallbacks.detach(o);e.userData.entityId=i.defaultRootEntityId;b._transientSceneMap.set(s,e);var d=e.clone();p.add(d);r({nodeRef:d});};var f={root:e,onSceneCompleted:o,useSecureConnection:u};b._loader.request(s,f);});};
C.prototype.update=function(s,b,v){var c=this;return new Promise(function(r,d){if(!c._loader){d(g().getText("CONTENTDELIVERYSERVICE_MSG_CONTENTDELIVERYSERVICENOTINITIALISED"));return;}c._loader.update(s,b,v).then(function(e){if(c._currentNodeHierarchy){for(var i=0;i<e.replacedNodeRefs.length;i++){c._currentNodeHierarchy.fireNodeReplaced({ReplacedNodeRef:e.replacedNodeRefs[i],ReplacementNodeRef:e.replacementNodeRefs[i],ReplacedNodeId:e.replacedNodeRefs[i],ReplacementNodeId:e.replacementNodeRefs[i]});}}r({sceneVeId:e.sceneVeId,sids:e.sidArray});}).catch(function(e){return d(e);});});};
C.prototype.exit=function(){if(this._loader){this._loader.dispose();this._loader=null;}this._transientSceneMap=null;};
C.prototype.loadView=function(s,v,b,c){if(typeof b==="undefined"){b="static";}var d=this;return this._loader.requestView(s,b,v,null,c).then(function(e){if(d._currentNodeHierarchy&&e.updatedNodes){for(var i=0;i<e.updatedNodes.length;i++){d._currentNodeHierarchy.fireNodeUpdated({nodeRef:e.updatedNodes[i]});}}d.fireSceneUpdated({});return e;}).catch(function(e){L.error(e);return null;});};
C.prototype.updatePlaybacks=function(s,v,p){var b=this;return this._loader.requestView(s,"static",v,p,true).then(function(c){if(b._currentNodeHierarchy&&c.updatedNodes){for(var i=0;i<c.updatedNodes.length;i++){b._currentNodeHierarchy.fireNodeUpdated({nodeRef:c.updatedNodes[i]});}}b.fireSceneUpdated({});return c;}).catch(function(e){L.error(e);return null;});};
C.prototype.loadViewGroup=function(s,v,i){var b=this;return this._loader.requestViewGroup(s,v,i).then(function(c){b.fireSceneUpdated({});return c;}).catch(function(e){L.error(e);return null;});};
C.prototype.assignMaterialToNodes=function(s,m,n,b){var c=this;return this._loader.requestMaterial(s,m).then(function(d){function e(d,k,r){if(!k){return;}if(k.userData.markedForNotAssigningMaterial){delete k.userData.markedForNotAssigningMaterial;return;}if(c._currentNodeHierarchy){var l=c._currentNodeHierarchy.createNodeProxy(k);var o=new a();o.setMaterialRef(d);l.assignMaterial(o);c._currentNodeHierarchy.destroyNodeProxy(l);}if(r){k.children.forEach(function(p){if(!p||p.userData.objectType===O.PMI||p.userData.objectType===O.Hotspot){return;}e(d,p,r);});}}if(!b){for(var i=0;i<n.length;i++){e(d,n[i],true);}}else{for(var j=0;j<n.length;j++){n[j].userData.markedForNotAssigningMaterial=true;}var f=c._loader.getContext(s);var h=f.root;e(d,h,true);}c.fireSceneUpdated({});return true;}).catch(function(e){L.error(e);return false;});};
C.prototype.printLogTokens=function(){if(this._loader){this._loader.printLogTokens();return true;}else{return false;}};
return C;});
sap.ui.predefine('sap/ui/vk/threejs/ContentManager',["sap/base/Log","../thirdparty/three","../ContentManager","./Scene","../TransformationMatrix","./PerspectiveCamera","./OrthographicCamera","../Messages","../getResourceBundle","./ContentDeliveryService","./Viewport","./ViewStateManager"],function(L,t,C,S,T,P,O,M,g,a){"use strict";
var b=C.extend("sap.ui.vk.threejs.ContentManager",{metadata:{library:"sap.ui.vk"}});
var c=b.getMetadata().getParent().getClass().prototype;
b.prototype.init=function(){if(c.init){c.init.call(this);}};
b.prototype.exit=function(){if(this.defaultCdsLoader){this.defaultCdsLoader.destroy();this.defaultCdsLoader=null;}if(this.defaultMataiLoader){this.defaultMataiLoader.destroy();this.defaultMataiLoader=null;}if(c.exit){c.exit.call(this);}};
b.prototype._handleContentChangesProgress=function(d){this.fireContentChangesProgress({phase:d.getParameter("phase"),source:d.getParameter("source"),percentage:d.getParameter("percentage")});};
function s(o){if(o&&o.isMesh){o.castShadow=true;o.receiveShadow=false;}if(o&&o.children){for(var n=0;n<o.children.length;n++){s(o.children[n]);}}}
function e(n,f){if(n){var h=new THREE.Group();n.add(h);h.name="DefaultLights";h.private=true;var i=new THREE.Box3().setFromObject(n);var j=new THREE.Vector3();i.getSize(j);var m=j.length();var p=new THREE.PointLight();p.color.setRGB(0.72,0.72,0.81);i.getCenter(p.position);p.visible=true;p.private=true;h.add(p);var k=[new THREE.Color(0.2,0.2,0.2),new THREE.Color(0.32,0.32,0.36),new THREE.Color(0.36,0.36,0.36)];var o=[new THREE.Vector3(2.0,1.5,0.5),new THREE.Vector3(-2.0,-1.1,2.5),new THREE.Vector3(-0.04,-0.01,-2.0)];for(var l=0,q=k.length;l<q;l++){var r=new THREE.DirectionalLight();r.color.copy(k[l]);r.position.copy(o[l]);r.private=true;h.add(r);}if(f){s(n);var u=new THREE.DirectionalLight();u.color.setRGB(0.5,0.5,0.5);u.position.set(0,1,0);u.castShadow=true;u.shadow.mapSize.width=512;u.shadow.mapSize.height=512;var d=2000;u.shadow.camera.left=-d;u.shadow.camera.right=d;u.shadow.camera.top=d;u.shadow.camera.bottom=-d;u.shadow.camera.far=3500;u.shadow.bias=-0.0001;u.private=true;h.add(u);var v=new THREE.PlaneBufferGeometry(i.getSize().x,i.getSize().z);var w=new THREE.ShadowMaterial();w.opacity=0.2;var x=new THREE.Mesh(v,w);x.rotation.x=-Math.PI/2;x.position.x=i.getCenter().x;x.position.y=i.min.y-m*0.1;x.position.z=i.getCenter().z;n.add(x);x.receiveShadow=true;}}}
b.prototype.loadContent=function(d,f){var h=this;var l=function(){h.fireContentChangesStarted();var j=new THREE.Scene(),k=new S(j);h._loadContentResources(k,f).then(function(v){L.info("Content loading resolved");if(v&&v.length>0&&v[0].initialView){k.setInitialView(v[0].initialView);}for(var n=0;n<v.length;n++){if(v[n].camera){k.camera=v[n].camera;break;}}if(v.length>0){var m=v[0];k.backgroundTopColor=m.backgroundTopColor;k.backgroundBottomColor=m.backgroundBottomColor;k.renderMode=m.renderMode;k.upAxis=m.upAxis;k.annotations=m.annotations;}for(var i=0;i<v.length;i++){if(v[i].loader){k.loaders=k.loaders||[];k.loaders.push(v[i].loader);}if(v[i].builder){k.builders=k.builders||[];k.builders.push(v[i].builder);}}if(k.loaders){h._initSceneWithCDSLoaderIfExists(k,k.loaders);}e(k.getSceneRef(),false);h.fireContentChangesFinished({content:k});},function(r){L.info("Content loading rejected:",r);var i;if(typeof r==="string"){i=r;}else if(r.errorText){i=r.errorText;}else if(r.message){i=r.message;}i=i||g().getText(M.VIT37.summary);L.error(g().getText("CONTENTMANAGER_MSG_CONTENTRESOURCESFAILEDTOLOAD"),i);h.fireContentChangesFinished({content:null,failureReason:[{error:r,errorMessage:i}]});});};l();return this;};
b.prototype._findLoader=function(d){if(d._contentManagerResolver&&d._contentManagerResolver.settings&&d._contentManagerResolver.settings.loader){return Promise.resolve(d._contentManagerResolver.settings.loader);}if(d.getSource()){var f=d.getSourceType().toLowerCase();var h=this;switch(f){case"stream":{if(this.defaultCdsLoader==null){return new Promise(function(r){var i="sap/ui/vk/threejs/ContentDeliveryService";sap.ui.require([i],function(j){r(h.defaultCdsLoader=new j({authorizationHandler:h._authorizationHandler}));});});}return Promise.resolve(this.defaultCdsLoader);}case"vds4":{if(this.defaultMataiLoader==null){return new Promise(function(r){var m="sap/ui/vk/matai/MataiLoader";sap.ui.require([m],function(i){r(h.defaultMataiLoader=new i());});});}return Promise.resolve(this.defaultMataiLoader);}default:break;}}return Promise.resolve(null);};
b.prototype._loadContentResources=function(d,f){var p=[];f.forEach(function k(h,i){var n=new THREE.Group();n.name=i.getName();n.sourceId=i.getSourceId();i._shadowContentResource={nodeProxy:d.getDefaultNodeHierarchy().createNodeProxy(n)};var l=i.getLocalMatrix();if(l){n.applyMatrix4(new THREE.Matrix4().fromArray(T.convertTo4x4(l)));}h.add(n);var j=this;p.push(this._findLoader(i).then(function(m){if(m&&m.attachContentChangesProgress){m.attachContentChangesProgress(j._handleContentChangesProgress,j);}if(typeof m==="function"){return m(n,i,j._authorizationHandler);}else if(m&&m.load){return m.load(n,i,j._authorizationHandler);}else{return Promise.resolve({node:n,contentResource:i});}}));i.getContentResources().forEach(k.bind(this,n));}.bind(this,d.getSceneRef()));return Promise.all(p);};
b.prototype._initSceneWithCDSLoaderIfExists=function(d,l){if(l){var f;for(var i=0;i<l.length;i++){if(l[i]instanceof a){f=l[i].getSceneBuilder();break;}}if(f){d.setSceneBuilder(f);d.getDefaultNodeHierarchy().attachNodeRemoving(function(h){var r=h.getParameter("nodeRef");if(r.userData.treeNode&&r.userData.treeNode.sid){f.decrementResourceCountersForDeletedTreeNode(r.userData.treeNode.sid);}});return true;}}return false;};
b.prototype.destroyContent=function(d){if(d){d.destroy();}if(d.loaders&&Array.isArray(d.loaders)&&d.loaders.length>0&&d.loaders[0]._loader&&d.loaders[0]._loader.sceneBuilder){d.loaders[0]._loader.sceneBuilder.cleanup();}else if(d.builders&&Array.isArray(d.builders)){d.builders.forEach(function(f){if(f){f.cleanup();}});}return this;};
b.prototype.createOrthographicCamera=function(){return new O();};
b.prototype.createPerspectiveCamera=function(){return new P();};
return b;});
sap.ui.predefine('sap/ui/vk/threejs/DetailView',["../thirdparty/three","sap/ui/base/ManagedObject","../thirdparty/html2canvas","../DetailViewType","../DetailViewShape","./OrthographicCamera","./PerspectiveCamera"],function(t,B,c,D,d,O,P){"use strict";
var e=B.extend("sap.ui.vk.threejs.DetailView",{metadata:{properties:{name:{type:"string",defaultValue:""},camera:{type:"any",defaultValue:null},type:{type:"sap.ui.vk.DetailViewType",defaultValue:D.DetailView},shape:{type:"sap.ui.vk.DetailViewShape",defaultValue:d.Box},borderWidth:{type:"float",defaultValue:2},backgroundColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},borderColor:{type:"sap.ui.core.CSSColor",defaultValue:"#000"},origin:{type:"any",defaultValue:new THREE.Vector2(0,0)},size:{type:"any",defaultValue:new THREE.Vector2(0.5,0.5)},attachmentPoint:{type:"any",defaultValue:null},metadata:{type:"any",defaultValue:{}},veId:{type:"any",defaultValue:{}},visibleNodes:{type:"any",defaultValue:null},targetNodes:{type:"any",defaultValue:null}}}});
e.prototype.init=function(){if(B.prototype.init){B.prototype.init.call(this);}this._backgroundColor=new THREE.Color();this._node=new THREE.Group();var b=new THREE.MeshBasicMaterial({depthTest:false});this._line=new THREE.Mesh(new THREE.BufferGeometry(),b);this._line.renderOrder=0;this._node.add(this._line);var a=new THREE.BufferGeometry();a.setIndex([0,1,2]);var f=new THREE.MeshBasicMaterial({color:this._backgroundColor,depthTest:false});this._triangle=new THREE.Mesh(a,f);this._triangle.renderOrder=1;this._node.add(this._triangle);this._billboard=new THREE.Mesh(new THREE.BufferGeometry(),new THREE.MeshBasicMaterial({depthTest:false}));this._billboard.renderOrder=2;this._node.add(this._billboard);this._border=new THREE.Mesh(new THREE.BufferGeometry(),b);this._border.renderOrder=3;this._node.add(this._border);};
e.prototype.setCamera=function(a){if(a instanceof P||a instanceof O){this.setProperty("camera",a,true);}return this;};
e.prototype.setShape=function(a){this.setProperty("shape",a,true);return this;};
e.prototype.setBackgroundColor=function(a){this.setProperty("backgroundColor",a,true);this._backgroundColor.setStyle(a);this._triangle.material.color.copy(this._backgroundColor);return this;};
e.prototype.setBorderColor=function(a){this.setProperty("borderColor",a,true);this._border.material.map=null;return this;};
e.prototype.setBorderWidth=function(a){this.setProperty("borderWidth",a,true);this._border.material.map=null;return this;};
e.prototype.setOrigin=function(a){if(a instanceof THREE.Vector2){this.setProperty("origin",a,true);}return this;};
e.prototype.setSize=function(a){if(a instanceof THREE.Vector2){this.setProperty("size",a,true);}return this;};
var g=-0.5,j=1.5,p=new THREE.Vector4(),k=new THREE.Vector3(),n=new THREE.Vector3(),o=new THREE.Vector3(),q=new THREE.Vector2(),s=new THREE.Vector2(),r=new THREE.Vector2(),v=new THREE.Matrix4();
function z(a,b){return Math.PI*(3*(a+b)-Math.sqrt((3*a+b)*(a+3*b)));}
function A(a,b,h,i,l,m){var u=a[b],w=a[b+1],x=a[l],y=a[l+1],J=a[m],K=a[m+1],L=i-w,M=u-h;var f=((x-u)*L+(y-w)*M)/((x-J)*L+(y-K)*M);a[l]=x+(J-x)*f;a[l+1]=y+(K-y)*f;}
function C(f,a,b,h){q.set(f[b+1]-f[a+1],f[a]-f[b]).normalize().multiplyScalar(h);f[a]+=q.x;f[a+1]+=q.y;f[b]+=q.x;f[b+1]+=q.y;}
function E(a,b){var f=a.length;for(var h=0;h<6;h+=3){var l=h===0?b*g:b*j;var m=a[h],u=a[h+1];for(var i=h;i<f-6;i+=6){var w=a[i],x=a[i+1];a[i]=m;a[i+1]=u;m=a[i+6];u=a[i+7];C(a,i,i+6,l);if(i>h){A(a,i-6,w,x,i,i+6);}}}}
e.prototype._createBoxViewport=function(a,b,f,h){var l=[-a,-b,0,a,-b,0,a,b,0,-a,b,0];var m=this._billboard.geometry;m.setIndex([0,1,2,0,2,3]);m.setAttribute("position",new THREE.Float32BufferAttribute(l,3));m.setAttribute("uv",new THREE.Float32BufferAttribute([0,0,1,0,1,1,0,1],2));if(this._border.visible){var u=[],i;for(i=0;i<l.length;i+=3){var x=l[i],y=l[i+1];u.push(x,y,0,x,y,0);}u.push(u[0],u[1],0,u[0],u[1],0);E(u,this._borderWidth);i=u.length-6;u[0]=u[i];u[i+1]=u[1];u[3]=u[i+3];u[i+4]=u[4];this._createBorderGeometry(this._border.geometry,u);}};
e.prototype._createCircleViewport=function(b,f,h,l){var m=[0,0,0],u=[0.5,0.5],w=[];var x=THREE.Math.clamp(Math.round(z(b,f)/24),32,256);var y=2*Math.PI/x;for(var i=0;i<x;i++){var a=i*y,J=Math.cos(a),K=Math.sin(a);m.push(J*b,K*f,0);u.push(J*0.5+0.5,K*0.5+0.5);w.push(0,i+1,i+1<x?i+2:1);}var L=this._billboard.geometry;L.setIndex(w);L.setAttribute("position",new THREE.Float32BufferAttribute(m,3));L.setAttribute("uv",new THREE.Float32BufferAttribute(u,2));var M=this._borderWidth*j;this._createCircleBorder(m,b,f,h&&q.set(h.x/(b+M),h.y/(f+M)).length()>1?h:null,l);};
e.prototype._createCircleBorder=function(b,f,h,m,u){var w=this._borderWidth,J=[],i,x,y;if(m&&(u!==d.Circle&&u!==d.CircleLine)){J.push(m.x,m.y,0,m.x,m.y,0);var K=Math.PI*0.05;var L=Math.atan2(m.y*f,m.x*h)+K;var M=(b.length/3)-3;K=2*(Math.PI-K)/M;for(i=0;i<=M;i++){var a=L+i*K;x=Math.cos(a)*f;y=Math.sin(a)*h;J.push(x,y,0,x,y,0);}var N=[m.x,m.y,0,J[6],J[7],0,J[J.length-3],J[J.length-2],0];J.push(m.x,m.y,0,m.x,m.y,0);E(J,w);i=J.length-6;var Q=q.set(J[9],J[10]).sub(m).length();var R=q.set(J[9]-J[i-3],J[10]-J[i-2]).length()*0.5;var l=m.length();l=1-w*2*Q/(R*l);J[i+0]=J[0]=m.x*l;J[i+1]=J[1]=m.y*l;J[i+3]=J[3]=m.x;J[i+4]=J[4]=m.y;var S=this._triangle.geometry;l=(1+l)*0.5;N[0]*=l;N[1]*=l;S.setAttribute("position",new THREE.Float32BufferAttribute(N,3));this._triangle.visible=true;this._triangle.material.color.set(u===d.SolidPointer||u===d.SolidArrow?this.getBorderColor():this._backgroundColor);}else{this._line.visible=this._line.visible&&m!==null;for(i=3;i<b.length;i+=3){x=b[i];y=b[i+1];J.push(x,y,0,x,y,0);}J.push(J[0],J[1],0,J[0],J[1],0);E(J,w);i=J.length-6;J[i]=J[0]=b[3]+w*g;J[i+3]=J[3]=b[3]+w*j;J[i+1]=J[1]=b[4];J[i+4]=J[4]=b[4];}this._createBorderGeometry(this._border.geometry,J);};
e.prototype._createBorderGeometry=function(a,b){var i,f=b.length/3;var h=[];for(i=2;i<f;i+=2){h.push(i-1,i,i-2,i+1,i,i-1);}var l=[];var u=this._borderU;for(i=0;i<f;i+=2){l.push(0,0.5,u,0.5);}a.setIndex(h);a.setAttribute("position",new THREE.Float32BufferAttribute(b,3));a.setAttribute("uv",new THREE.Float32BufferAttribute(l,2));};
e.prototype._createLine=function(a){var b=[0,0,0,0,0,0,a.x,a.y,0,a.x,a.y,0];C(b,0,6,-this._borderWidth);C(b,3,9,this._borderWidth);this._createBorderGeometry(this._line.geometry,b);};
e.prototype._updateGeometry=function(s,I,a){var b=this.getShape(),f=this.getAttachmentPoint(),h=this.getOrigin();this._border.visible=b!==d.BoxNoOutline;this._line.visible=b===d.BoxLine||b===d.CircleLine;this._triangle.visible=false;if(f){p.copy(f).applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix);f=p.w>0?f:null;var i=(p.x/p.w)*I.x/I.y,l=p.y/p.w;o.set(i-h.x,l-h.y,0).multiplyScalar(I.y);}switch(b){default:case d.Box:case d.BoxLine:case d.BoxNoOutline:this._createBoxViewport(s.x,s.y,f?o:null,b);break;case d.Circle:case d.CircleLine:case d.CirclePointer:case d.CircleArrow:case d.CircleBubbles:case d.SolidPointer:case d.SolidArrow:this._createCircleViewport(s.x,s.y,f?o:null,b);break;}if(this._line.visible){this._createLine(o);}};
e.prototype._updateBorderTexture=function(a){var b=Math.round(this.getBorderWidth()*a);this._borderWidth=b+2;var f=THREE.Math.ceilPowerOfTwo(this._borderWidth);this._borderU=this._borderWidth/f;this._borderWidth/=a;var h=new ArrayBuffer(f*4);var l=new Uint32Array(h);var m=new THREE.Color(this.getBorderColor());m=(m.r*255)|((m.g*255)<<8)|((m.b*255)<<16)|0xFF000000;l.fill(m&0xFFFFFF);for(var i=1;i<=b;i++){l[i]=m;}var u=new THREE.DataTexture(new Uint8Array(h),f,1,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearFilter);u.needsUpdate=true;this._border.material.map=u;this._border.material.needsUpdate=true;this._line.material=this._border.material;};
function F(a){var m=a.elements;var i=m[15]===1;var b=2/m[0];var f=2/m[5];var h,l;if(i){h=-m[12]*b;l=-m[13]*f;}else{h=m[8]*b;l=m[9]*f;}var u=(b+h)*0.5;var w=h-u;var x=(f+l)*0.5;var y=l-x;return{left:w,top:x,right:u,bottom:y};}
function G(a,b){var m=a.elements;var i=m[15]===1;m[0]=2/(b.right-b.left);m[5]=2/(b.top-b.bottom);if(i){m[12]=-(b.right+b.left)/(b.right-b.left);m[13]=-(b.top+b.bottom)/(b.top-b.bottom);}else{m[8]=(b.right+b.left)/(b.right-b.left);m[9]=(b.top+b.bottom)/(b.top-b.bottom);}}
function H(a,b,s,I){var w=s.x/I.x;var h=s.y/I.y;p.copy(b).applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix);var x=((p.x/p.w)-w)*0.5+0.5;var y=((p.y/p.w)-h)*0.5+0.5;var f=F(a.projectionMatrix);var i={};i.left=THREE.Math.lerp(f.left,f.right,x);i.right=THREE.Math.lerp(f.left,f.right,x+w);i.top=THREE.Math.lerp(f.top,f.bottom,1-y-h);i.bottom=THREE.Math.lerp(f.top,f.bottom,1-y);G(a.projectionMatrix,i);}
var I=new THREE.Vector2();
e.prototype._render=function(a,b,f,h,i){a.getSize(I);var l=a.getPixelRatio(),m=this.getOrigin(),u=this._node,w=u.position;if(!this._border.material.map){this._updateBorderTexture(l);}s.copy(this.getSize()).multiplyScalar(I.y*0.5);s.set(Math.round(s.x)<<1,Math.round(s.y)<<1);w.set(m.x*I.y/I.x,m.y,0).unproject(b);p.copy(w).applyMatrix4(b.matrixWorldInverse).applyMatrix4(b.projectionMatrix);var x=((p.x/p.w)*0.5+0.5)*I.x,y=((p.y/p.w)*0.5+0.5)*I.y;var J=p.w/(I.x*b.projectionMatrix.elements[0]);u.scale.setScalar(J);k.setFromMatrixColumn(b.matrixWorld,0).multiplyScalar(J*2*(Math.round(x)-x));n.setFromMatrixColumn(b.matrixWorld,1).multiplyScalar(J*2*(Math.round(y)-y));w.add(k).add(n);u.quaternion.copy(b.quaternion);u.updateMatrix();u.updateMatrixWorld();this._updateGeometry(s,I,b);r.copy(s).multiplyScalar(l);if(!this._renderTarget||this._renderTarget.width!==r.x||this._renderTarget.height!==r.y){this._renderTarget=new THREE.WebGLRenderTarget(r.x,r.y,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat});this._billboard.material.map=this._renderTarget.texture;this._billboard.material.needsUpdate=true;}var K;if(this.getType()===D.Cutaway){K=b;v.copy(K.projectionMatrix);H(K,w,s,I);}else{K=this.getCamera();K.adjustClipPlanes(h);K.update(s.x,s.y);K=K.getCameraRef();}f.children.forEach(function(N){if(N.userData._vkDynamicObjects){N.userData._vkDynamicObjects.forEach(function(Q){if(Q.parent){if(Q.userData.is2D||Q.isBillboard){Q.visible=false;}else{Q._vkUpdate(a,K,s);}}});}});if(i){i.position.copy(K.position);i.updateMatrix();i.updateMatrixWorld();}var L=this.getTargetNodes();var M=this.getTargetNodes();if(Array.isArray(M)){L.forEach(function(u){u.userData._visible=u.visible;u.visible=true;});}if(Array.isArray(M)){M.forEach(function(u){u.userData._visible=u.visible;u.visible=false;});}a.setClearColor(this._backgroundColor,1);a.setRenderTarget(this._renderTarget);a.clear();a.render(f,K);if(K===b){b.projectionMatrix.copy(v);}if(Array.isArray(L)){L.forEach(function(u){u.visible=u.userData._visible;});}if(Array.isArray(M)){M.forEach(function(u){u.visible=u.userData._visible;});}a.setRenderTarget(null);a.render(this._node,b);f.children.forEach(function(N){if(N.userData._vkDynamicObjects){N.userData._vkDynamicObjects.forEach(function(Q){if(Q.parent&&(Q.userData.is2D||Q.isBillboard)){Q.visible=true;}});}});};
return e;});
sap.ui.predefine('sap/ui/vk/threejs/HighlightPlayer',["sap/ui/base/Object","../thirdparty/three","../HighlightDisplayState"],function(B,t,H){"use strict";
var a=B.extend("sap.ui.vk.threejs.HighlightPlayer",{constructor:function(){this._state=H.stopped;this._startTime=0;this._timeElapsed=0;this._highlightsNodesMap=new Map();}});
a.prototype.reset=function(v,s){this.stop();this._highlightsNodesMap.clear();this._state=H.stopped;if(v&&s){var h=v.getHighlightIdNodesMap();var b=this;h.forEach(function(c,k){var d=s.getHighlight(k);b.addHighlights(d,c);});}return this;};
a.prototype.setViewStateManager=function(v){this._viewStateManager=v;};
a.prototype.addHighlights=function(h,n){if(h&&n&&n.length){this._highlightsNodesMap.set(h,{nodes:n});}};
a.prototype.start=function(b){if(this._state===H.pausing){this._startTime=b-this._timeElapsed;}else{this._startTime=b;this._timeElapsed=0;}this._state=H.playing;var v=this._viewStateManager;this._highlightsNodesMap.forEach(function(n,h){var c=[];n.nodes.forEach(function(d){while(d){if(!d.visible){v.setVisibilityState(d,true,false);c.push(d);}d=d.parent;}});n.hiddenNodes=c.length>0?c:undefined;});};
a.prototype.play=function(b){if(this._state!==H.playing){return false;}this._timeElapsed=b-this._startTime;var c=this;var d=[];this._highlightsNodesMap.forEach(function(n,h){var r=h.getColour(c._timeElapsed/1000.0);var e=n.nodes,f;if(r!==undefined){for(f=0;f<e.length;f++){e[f]._vkSetHighlightColor(r.colour);}}var g=h.getOpacity(c._timeElapsed/1000.0);if(g!==undefined){for(f=0;f<e.length;f++){e[f]._vkSetOpacity(g.opacity);}if(g.isCompleted&&h.isFadeOut()&&n.hiddenNodes!==undefined){c._viewStateManager.setVisibilityState(n.hiddenNodes,false,false);}}if((r===undefined||r.isCompleted)&&(g===undefined||g.isCompleted)){d.push(h);}});d.forEach(function(h){c._highlightsNodesMap.delete(h);});if(this._highlightsNodesMap.size===0){this._state=H.stopped;return false;}return true;};
a.prototype.stop=function(b){this._timeElapsed=0;this._startTime=0;var c=this;this._highlightsNodesMap.forEach(function(n,h){var d=n.nodes;for(var e=0;e<d.length;e++){var f=d[e];f._vkSetHighlightColor(undefined);f._vkSetOpacity(undefined);}if(h.isFadeOut()&&d.hiddenNodes!=undefined){c._viewStateManager.setVisibilityState(d.hiddenNodes,false,false);}});this._state=H.stopped;return this;};
a.prototype.pause=function(b){if(this._state===H.stopped){return this;}this._timeElapsed=b-this._startTime;this._state=H.pausing;return this;};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/Material',["../Material","../thirdparty/three","./Texture","../cssColorToColor","../colorToCSSColor","./ThreeUtils"],function(M,t,T,a,b,d){"use strict";
var e=M.extend("sap.ui.vk.threejs.Material",{
metadata:{},
constructor:function(i){if(i){this._nativeMaterial=new THREE.LineBasicMaterial({color:0xaaaaaa});}else{this._nativeMaterial=new THREE.MeshPhongMaterial({color:0xaaaaaa});}M.call(this);}
});
var f=e.getMetadata().getParent().getClass().prototype;
e.prototype.init=function(){if(f.init){f.init.call(this);}};
e.prototype.exit=function(){if(f.exit){f.exit.call(this);}if(this._nativeMaterial){d.disposeMaterial(this._nativeMaterial);this._nativeMaterial=null;}};
e.prototype.getMaterialRef=function(){return this._nativeMaterial;};
e.prototype.setMaterialRef=function(m){this._nativeMaterial=m;return this;};
e.prototype.getId=function(){if(this._nativeMaterial&&this._nativeMaterial.userData&&this._nativeMaterial.userData.materialId){return this._nativeMaterial.userData.materialId;}};
e.prototype.setId=function(v){this._nativeMaterial.userData.materialId=v;return this;};
e.prototype.getName=function(){if(this._nativeMaterial.userData&&this._nativeMaterial.userData.name){return this._nativeMaterial.userData.name;}};
e.prototype.setName=function(v){this._nativeMaterial.userData.name=v;return this;};
e.prototype.getAmbientColour=function(){};
e.prototype.setAmbientColour=function(v){return this;};
e.prototype.getDiffuseColour=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.color){var c={red:Math.round(this._nativeMaterial.color.r*255),green:Math.round(this._nativeMaterial.color.g*255),blue:Math.round(this._nativeMaterial.color.b*255),alpha:1.0};return b(c);}};
e.prototype.setDiffuseColour=function(v){if(this._nativeMaterial.isMeshPhongMaterial){var c=a(v);this._nativeMaterial.color=new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0);}return this;};
e.prototype.getEmissiveColour=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.emissive){var c={red:Math.round(this._nativeMaterial.emissive.r*255),green:Math.round(this._nativeMaterial.emissive.g*255),blue:Math.round(this._nativeMaterial.emissive.b*255),alpha:1.0};return b(c);}};
e.prototype.setEmissiveColour=function(v){if(this._nativeMaterial.isMeshPhongMaterial){var c=a(v);this._nativeMaterial.emissive=new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0);}return this;};
e.prototype.getSpecularColour=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.specular){var c={red:Math.round(this._nativeMaterial.specular.r*255),green:Math.round(this._nativeMaterial.specular.g*255),blue:Math.round(this._nativeMaterial.specular.b*255),alpha:1.0};return b(c);}};
e.prototype.setSpecularColour=function(v){if(this._nativeMaterial.isMeshPhongMaterial){var c=a(v);this._nativeMaterial.specular=new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0);}return this;};
e.prototype.getOpacity=function(){if(this._nativeMaterial.opacity!==undefined){return this._nativeMaterial.opacity;}};
e.prototype.setOpacity=function(v){if(v>=0.0&&v<=1.0){this._nativeMaterial.opacity=v;this._nativeMaterial.transparent=this._nativeMaterial.opacity<1;}return this;};
e.prototype.getGlossness=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.shininess){return this._nativeMaterial.shininess/100.0;}};
e.prototype.setGlossness=function(v){if(this._nativeMaterial.isMeshPhongMaterial){this._nativeMaterial.shininess=v*100.0;}return this;};
e.prototype.getLineColour=function(){if(this._nativeMaterial.isLineBasicMaterial&&this._nativeMaterial.color){var c={red:Math.round(this._nativeMaterial.color.r*255),green:Math.round(this._nativeMaterial.color.g*255),blue:Math.round(this._nativeMaterial.color.b*255),alpha:1.0};return b(c);}};
e.prototype.setLineColour=function(v){if(this._nativeMaterial.isLineBasicMaterial){var c=a(v);this._nativeMaterial.color=new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0);}return this;};
e.prototype.getLineWidth=function(){if(this._nativeMaterial.isLineBasicMaterial&&this._nativeMaterial.linewidth!==undefined){return this._nativeMaterial.linewidth;}};
e.prototype.setLineWidth=function(v){if(this._nativeMaterial.isLineBasicMaterial){this._nativeMaterial.linewidth=v;}return this;};
e.prototype.getTextureDiffuse=function(){if(this._nativeMaterial.map){var c=new T();c.setTextureRef(this._nativeMaterial.map);return c;}};
e.prototype.setTextureDiffuse=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.map=v.getTextureRef();}return this;};
e.prototype.getTextureBump=function(){if(this._nativeMaterial.bumpMap){var c=new T();c.setTextureRef(this._nativeMaterial.bumpMap);return c;}};
e.prototype.setTextureBump=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.bumpMap=v.getTextureRef();}return this;};
e.prototype.getTextureOpacity=function(){if(this._nativeMaterial.alphaMap){var c=new T();c.setTextureRef(this._nativeMaterial.alphaMap);return c;}};
e.prototype.setTextureOpacity=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.alphaMap=v.getTextureRef();}return this;};
e.prototype.getTextureReflection=function(){if(this._nativeMaterial.envMap){var c=new T();c.setTextureRef(this._nativeMaterial.envMap);return c;}};
e.prototype.setTextureReflection=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.envMap=v.getTextureRef();if(this._nativeMaterial.envMap){this._nativeMaterial.envMap.mapping=THREE.SphericalReflectionMapping;this._nativeMaterial.combine=THREE.AddOperation;}}return this;};
e.prototype.getTextureEmissive=function(){if(this._nativeMaterial.emissiveMap){var c=new T();c.setTextureRef(this._nativeMaterial.emissiveMap);return c;}};
e.prototype.setTextureEmissive=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.emissiveMap=v.getTextureRef();}return this;};
e.prototype.getTextureAmbientOcclusion=function(){if(this._nativeMaterial.aoMap){var c=new T();c.setTextureRef(this._nativeMaterial.aoMap);return c;}};
e.prototype.setTextureAmbientOcclusion=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.aoMap=v.getTextureRef();}return this;};
return e;});
sap.ui.predefine('sap/ui/vk/threejs/NodeHierarchy',["../NodeHierarchy","sap/ui/base/ObjectPool","./BaseNodeProxy","./NodeProxy","../Messages","../getResourceBundle","../NodeContentType","sap/base/util/uid","sap/base/assert","sap/base/Log"],function(N,O,B,a,M,g,b,u,c,L){"use strict";var s={equals:function(e,f){return e===f;},contains:function(e,f){return e.indexOf(f)!==-1;},startsWith:function(e,f){return e.indexOf(f)===0;}};
var d=N.extend("sap.ui.vk.threejs.NodeHierarchy",{
metadata:{},
_baseNodeProxyPool:new O(B),
constructor:function(e){N.call(this);this._scene=e;this._nodeProxies=[];}
});
d.prototype.destroy=function(){this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._scene=null;N.prototype.destroy.call(this);};
d.prototype.getScene=function(){return this._scene;};
d.prototype.getSceneRef=function(){return this._scene.getSceneRef();};
d.prototype.enumerateChildren=function(n,e,f,p){if(typeof n==="function"){p=f;f=e;e=n;n=undefined;}var h=this.getChildren(n,f);if(p){h.forEach(e);}else{var i=this._baseNodeProxyPool.borrowObject();try{h.forEach(function(n){i.init(this,n);e(i);i.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(i);}}return this;};
d.prototype.enumerateAncestors=function(n,e,p){var f=this.getAncestors(n);if(p){f.forEach(e);}else{var h=this._baseNodeProxyPool.borrowObject();try{f.forEach(function(n){h.init(this,n);e(h);h.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(h);}}return this;};
d.prototype.createNodeProxy=function(n){var e=new a(this,n);this._nodeProxies.push(e);return e;};
d.prototype.destroyNodeProxy=function(n){var i=this._nodeProxies.indexOf(n);if(i>=0){this._nodeProxies.splice(i,1)[0].destroy();}return this;};
d.prototype.getChildren=function(n,e){if(typeof n==="boolean"){e=n;n=undefined;}if(!n){n=this._scene.getSceneRef();}var f=[];if(e||!n.userData.closed){n.children.forEach(function(h){if(!h.private&&(h.geometry===undefined||!h.userData.skipIt)){f.push(h);}});}return f;};
d.prototype.getAncestors=function(n){var e=[];n.traverseAncestors(function(p){e.unshift(p);});if(e.length>0&&e[0]===this._scene.getSceneRef()){e.shift();}return e;};
d.prototype.findNodesByName=function(q){var r=[];if(q===undefined||q===null||q===""||jQuery.isEmptyObject(q)){this._scene.getSceneRef().children.forEach(function(h){h.traverse(function(o){if(!o.private&&!o.userData.skipIt){r.push(o);}});});}else{var e=s[q.predicate||"equals"];if(e===undefined){L.error(g().getText(M.VIT8.summary),M.VIT8.code,"sap.ui.vk.threejs.NodeHierarchy");}else if(!Array.isArray(q.value)&&typeof q.value!=="string"){L.error(g().getText(M.VIT6.summary),M.VIT6.code,"sap.ui.vk.threejs.NodeHierarchy");}else{var f=Array.isArray(q.value)?q.value:[q.value];if(!q.caseSensitive){for(var i in f){f[i]=f[i].toLowerCase();}}this._scene.getSceneRef().children.forEach(function(h){h.traverse(function(o){if(!o.private&&!o.userData.skipIt){var n=o.name||"";if(!q.caseSensitive){n=n.toLowerCase();}for(var i in f){if(e(n,f[i])){r.push(o);break;}}}});});}}return r;};
d.prototype.createLayerProxy=function(l){return null;};
d.prototype.destroyLayerProxy=function(l){return this;};
d.prototype.getLayers=function(){return[];};
d.prototype.getHotspotNodeIds=function(){return null;};
d.prototype.attachChanged=function(e,f,l){return this.attachEvent("changed",e,f,l);};
d.prototype.detachChanged=function(e,f,l){return this.detachEvent("changed",e,f,l);};
d.prototype.fireChanged=function(p,e,f){return this.fireEvent("changed",p,e,f);};
d.prototype.attachNodeCreated=function(e,f,l){return this.attachEvent("nodeCreated",e,f,l);};
d.prototype.detachNodeCreated=function(e,f,l){return this.detachEvent("nodeCreated",e,f,l);};
d.prototype.fireNodeCreated=function(p,e,f){return this.fireEvent("nodeCreated",p,e,f);};
d.prototype.attachNodeRemoving=function(e,f,l){return this.attachEvent("nodeRemoving",e,f,l);};
d.prototype.detachNodeRemoving=function(e,f,l){return this.detachEvent("nodeRemoving",e,f,l);};
d.prototype.fireNodeRemoving=function(p,e,f){return this.fireEvent("nodeRemoving",p,e,f);};
d.prototype.attachNodeReplaced=function(e,f,l){return this.attachEvent("nodeReplaced",e,f,l);};
d.prototype.detachNodeReplaced=function(e,f,l){return this.detachEvent("nodeReplaced",e,f,l);};
d.prototype.fireNodeReplaced=function(p,e,f){return this.fireEvent("nodeReplaced",p,e,f);};
d.prototype.attachNodeUpdated=function(e,f,l){return this.attachEvent("nodeUpdated",e,f,l);};
d.prototype.detachNodeUpdated=function(e,f,l){return this.detachEvent("nodeUpdated",e,f,l);};
d.prototype.fireNodeUpdated=function(p,e,f){return this.fireEvent("nodeUpdated",p,e,f);};
d.prototype.createNode=function(p,n,i,e,f){var h=this.getScene().getSceneBuilder();var o=null;if(h){f=f||{};f.name=f.name||n;f.sid=f.sid||u();o=h.createNode(f);if(!p){p=o.parent;}}else{if(!p){p=this._scene.getSceneRef();}o=new THREE.Group();o.name=n;p.add(o);}var j=p.children.indexOf(i);c(p.children[p.children.length-1]===o,g().getText("NODEHIERARCHY_MSG_CREATENODEFAILED"));if(j>=0){p.children.splice(j,0,p.children.pop());}if(e){o._vkSetNodeContentType(e);}else{o._vkSetNodeContentType(b.Regular);}if(f&&h){switch(o._vkGetNodeContentType()){case b.Annotation:f.node=o;f.nodeId=o._vkPersistentId();h.createAnnotation(f);break;case b.Background:h.setParametricContent(f.sid,f.parametricContent);break;default:}}this.fireNodeCreated({nodeRef:o,nodeId:o});this.fireChanged();return o;};
d.prototype.getNodeContentType=function(n){if(n==null){return b.Regular;}var e=n._vkGetNodeContentType();if(!e){e=b.Regular;}return e;};
d.prototype.createNodeCopy=function(n,p,e,i){if(!p){p=this._scene.getSceneRef();}var f=p.children.indexOf(i);var h=n.clone(true);h.name=e;p.add(h);c(p.children[p.children.length-1]===h,g().getText("NODEHIERARCHY_MSG_CREATENODEFAILED"));if(f>=0){p.children.splice(f,0,p.children.pop());}this.fireNodeCreated({nodeRef:h,nodeId:h});this.fireChanged();return h;};
d.prototype.removeNode=function(n){var e=[].concat(n);e.forEach(function(n){if(n&&n.parent){this.fireNodeRemoving({nodeRef:n,nodeId:n});n.parent.remove(n);}}.bind(this));var f=this.getScene().getSceneBuilder();if(f){f.removeNode(n);}this.fireChanged();return this;};
return d;});
sap.ui.predefine('sap/ui/vk/threejs/NodeProxy',["../NodeProxy","./Material","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","../TransformationMatrix","./ThreeExtensions","../ObjectType"],function(N,M,a,b,d,e,T,f,O){"use strict";
var g=N.extend("sap.ui.vk.threejs.NodeProxy",{
metadata:{},
constructor:function(n,o){N.call(this);this._object3D=o;this._nodeHierarchy=n;}
});
g.prototype.destroy=function(){this._object3D=null;N.prototype.destroy.call(this);};
g.prototype.getNodeHierarchy=function(){return this._nodeHierarchy;};
g.prototype.getNodeRef=function(){return this._object3D;};
g.prototype.getNodeId=function(){return this._object3D;};
g.prototype.getVeIds=function(){return this._object3D.userData.veids||[];};
g.prototype.getVeId=function(){return this._object3D.userData.treeNode?this._object3D.userData.treeNode.sid:null;};
g.prototype.getMaterialId=function(){var r=this._object3D;if(this._object3D&&!this._object3D.geometry){if(this._object3D.children.length===1&&this._object3D.children[0].geometry&&(this._object3D.children[0].name===""||this._object3D.children[0].name===undefined)){r=this._object3D.children[0];}}if(r.material!==undefined&&r.material.userData!==undefined&&r.material.userData.materialId!==undefined){return r.material.userData.materialId;}else if(r.userData.originalMaterial!==undefined&&r.userData.originalMaterial.userData!==undefined&&r.userData.originalMaterial.userData.materialId!==undefined){return r.userData.originalMaterial.userData.materialId;}return undefined;};
g.prototype.getName=function(){return this._object3D.name||("<"+this._object3D.type+">");};
g.prototype._updateAncestorsBoundingBox=function(){var p=this._object3D.parent;while(p){if(p.userData.boundingBox!==undefined){p._vkCalculateObjectOrientedBoundingBox();}p=p.parent;}};
g.prototype.getLocalMatrix=function(){return T.convertTo4x3(this._object3D.matrix.elements);};
g.prototype.setLocalMatrix=function(v){if(v){var o=this._object3D;o.matrix.fromArray(T.convertTo4x4(v));o.matrix.decompose(o.position,o.quaternion,o.scale);o.updateMatrixWorld(true);this._updateAncestorsBoundingBox();}this.setProperty("localMatrix",v,true);return this;};
g.prototype.setLocalMatrixNotUpdatingBBox=function(v){if(v){var o=this._object3D;o.matrix.fromArray(T.convertTo4x4(v));o.matrix.decompose(o.position,o.quaternion,o.scale);o.updateMatrixWorld(true);}this.setProperty("localMatrix",v,true);return this;};
g.prototype.getWorldMatrix=function(){return T.convertTo4x3(this._object3D.matrixWorld.elements);};
g.prototype.setWorldMatrix=function(v){if(v){var o=this._object3D;o.matrixWorld.fromArray(T.convertTo4x4(v));if(o.parent){o.matrix.multiplyMatrices(new THREE.Matrix4().getInverse(o.parent.matrixWorld),o.matrixWorld);}else{o.matrix.copy(o.matrixWorld);}o.matrix.decompose(o.position,o.quaternion,o.scale);o.updateMatrixWorld(true);this._updateAncestorsBoundingBox();}this.setProperty("worldMatrix",v,true);return this;};
g.prototype.getOpacity=function(){return this._object3D.userData.opacity;};
g.prototype.setOpacity=function(v){var c=this._nodeHierarchy.getScene().getViewStateManager();if(c){c.setOpacity(this._object3D,v);}else{this._object3D._vkSetOpacity(v);}this.setProperty("opacity",v,true);return this;};
g.prototype.getTintColorABGR=function(){return this._object3D.userData.tintColor;};
g.prototype.setTintColorABGR=function(v){var c=this._nodeHierarchy.getScene().getViewStateManager();if(c){c.setTintColor(this._object3D,v);}else{this._object3D._vkSetTintColor(v);}this.setProperty("tintColorABGR",v,true);this.setProperty("tintColor",b(d(v)),true);return this;};
g.prototype.getTintColor=function(){return b(d(this._object3D.userData.tintColor));};
g.prototype.setTintColor=function(v){var c=e(a(v));var h=this._nodeHierarchy.getScene().getViewStateManager();if(h){h.setTintColor(this._object3D,c);}else{this._object3D._vkSetTintColor(c);}this.setProperty("tintColorABGR",c,true);this.setProperty("tintColor",v,true);return this;};
g.prototype.getNodeMetadata=function(){return this._object3D.userData.metadata||{};};
g.prototype.getHasChildren=function(){return this._object3D.children.length>0;};
g.prototype.getClosed=function(){return!!this._object3D.userData.closed;};
g.prototype.assignMaterial=function(v){var s=function(m,n){var h;if(m.userData){h=m.userData.materialId;n.userData.materialId=h;}if(n.material!==undefined){if(n.userData.highlightColor!==undefined){if(n.userData.originalMaterial.side){m.side=n.userData.originalMaterial.side;}n.userData.originalMaterial=m;m.userData.materialUsed++;n.material=m.clone();var c=d(n.userData.highlightColor);n.material.color.lerp(new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0),c.alpha);if(m.userData.defaultHighlightingEmissive){n.material.emissive.copy(m.userData.defaultHighlightingEmissive);}if(m.userData.defaultHighlightingSpecular){n.material.specular.copy(m.userData.defaultHighlightingSpecular);}}else{if(n.material.side){m.side=n.material.side;}n.material=m;m.userData.materialUsed++;delete n.userData.originalMaterial;}n._vkUpdateMaterialOpacity();}};s(v.getMaterialRef(),this._object3D);if(!this._object3D.children){return this;}this._object3D.children.forEach(function(c){if(!c||c.userData.objectType===O.PMI||c.userData.objectType===O.Hotspot){return;}s(v.getMaterialRef(),c);});return this;};
g.prototype.enumerateMaterials=function(r){var c=function(n,l,r){if(n){if(n.userData.originalMaterial){l.add(n.userData.originalMaterial);}else if(n.material){l.add(n.material);}if(n.children){n.children.forEach(function(o){if(o){if(r){c(o,l,r);}else if(o.userData.originalMaterial){l.add(o.userData.originalMaterial);}else if(o.material){l.add(o.material);}}});}}};var m=new Set();c(this._object3D,m,r);var h=[];m.forEach(function(v){h.push(v);});var j=[];for(var i=0;i<h.length;i++){var k=new M();k.setMaterialRef(h[i]);j.push(k);}return j;};
g.prototype.replaceMaterial=function(m,c){var h=m.getMaterialRef();var i=c.getMaterialRef();if(this._object3D.userData.originalMaterial&&this._object3D.userData.originalMaterial===h){this._object3D.userData.originalMaterial=i;}else if(this._object3D.material&&this._object3D.material===h){this._object3D.material=i;}if(!this._object3D.children){return this;}this._object3D.children.forEach(function(j){if(j&&j.userData.originalMaterial&&j.userData.originalMaterial===h){j.userData.originalMaterial=i;}else if(j&&j.material&&j.material===h){j.material=i;}});return this;};
g.prototype.getLocalTranslate=function(){var o=this._object3D;return[o.position.x,o.position.y,o.position.z];};
g.prototype.getLocalScale=function(){var o=this._object3D;return[o.scale.x,o.scale.y,o.scale.z];};
g.prototype.getLocalRotationInQuaternion=function(){var o=this._object3D;return[o.quaternion.x,o.quaternion.y,o.quaternion.z,o.quaternion.w];};
g.prototype.getLocalRotationInAngleAxis=function(){var o=this._object3D;var q=o.quaternion;if(q.w>1){q.normalise();}var c=2*Math.acos(q.w);var s=Math.sqrt(1-q.w*q.w);var x,y,z;if(s<0.001){x=q.x;y=q.y;z=q.z;}else{x=q.x/s;y=q.y/s;z=q.z/s;}return[x,y,z,c];};
g.prototype.getLocalRotationInEuler=function(){var o=this._object3D;var q=o.quaternion;if(q.w>1){q.normalise();}var c=26;var t=q.x*q.y+q.z*q.w;var h,i,j;if(t>0.499){h=2*Math.atan2(q.x,q.w);i=Math.PI/2;j=0;}if(t<-0.499){h=-2*Math.atan2(q.x,q.w);i=-Math.PI/2;j=0;}else{var s=q.x*q.x;var k=q.y*q.y;var l=q.z*q.z;h=Math.atan2(2*q.y*q.w-2*q.x*q.z,1-2*k-2*l);i=Math.asin(2*t);j=Math.atan2(2*q.x*q.w-2*q.y*q.z,1-2*s-2*l);}return[h,i,j,c];};
return g;});
sap.ui.predefine('sap/ui/vk/threejs/NodesTransitionHelper',["../thirdparty/three","sap/ui/core/Element","../TransformationMatrix"],function(t,E,T){"use strict";
var N=E.extend("sap.ui.vk.threejs.NodesTransitionHelper",{metadata:{properties:{},publicMethods:["setViewStateManager","setNodeForDisplay","setDisappearingNode","setAppearingNode","clear","startDisplay","displayNodesMoving"],events:{displaying:{},displayed:{}}}});
N.prototype.init=function(){this._viewStateManager=null;this._nodeLocalmMatrixMap=new Map();this._nodeLocalMatrixMapForVisibility=new Map();this._timeIntervalForDisplay=500;this._startTimeForDisplay=0;};
N.prototype.destroy=function(){this._viewStateManager=null;this._nodeLocalmMatrixMap=null;this._nodeLocalMatrixMapForVisibility=new Map();if(E.prototype.destroy){E.prototype.destroy.apply(this,arguments);}};
N.prototype.setViewStateManager=function(v){this._viewStateManager=v;};
N.prototype.setNodeForDisplay=function(n,a){this._nodeLocalmMatrixMap.set(n,{oldMatrix:n.getLocalMatrix(),newMatrix:a?T.convertTo4x3(a.elements):null});};
N.prototype.setDisappearingNode=function(n){var o=n.getLocalMatrix();var a=[o[0]*0.0001,o[1],o[2],o[3],o[4]*0.0001,o[5],o[6],o[7],o[8]*0.0001,o[9],o[10],o[11]];this._nodeLocalMatrixMapForVisibility.set(n,{oldMatrix:o,newMatrix:a,visible:false});this._viewport.getViewStateManager().setVisibilityState(n.getNodeRef(),true,false);};
N.prototype.setAppearingNode=function(n){var o=n.getLocalMatrix();var a=[o[0]*0.0001,o[1],o[2],o[3],o[4]*0.0001,o[5],o[6],o[7],o[8]*0.0001,o[9],o[10],o[11]];this._nodeLocalMatrixMapForVisibility.set(n,{oldMatrix:a,newMatrix:o,visible:true});};
N.prototype._interpolateNodePositionForVisibility=function(n,d,i){var a=n.getNodeRef();return(i>=1)?d.visible:a.visible;};
N.prototype._interpolateNodePosition=function(n,o,a,i){var b=new THREE.Matrix4().fromArray(T.convertTo4x4(o));var c=new THREE.Vector3();var d=new THREE.Quaternion();var e=new THREE.Vector3();b.decompose(c,d,e);var f=new THREE.Matrix4().fromArray(T.convertTo4x4(a));var g=new THREE.Vector3();var h=new THREE.Quaternion();var j=new THREE.Vector3();f.decompose(g,h,j);var p=new THREE.Vector3().lerpVectors(c,g,i);var q=new THREE.Quaternion().copy(d).slerp(h,i);var s=new THREE.Vector3().lerpVectors(e,j,i);return{translation:p.toArray(),quaternion:q.toArray(),scale:s.toArray()};};
N.prototype.startDisplay=function(a){if(this._nodeLocalmMatrixMap.size===0){return;}this._timeIntervalForDisplay=a!==undefined?a:500;this._startTimeForDisplay=Date.now();this._nodeLocalmMatrixMap.forEach(function(m,n){if(!m.newMatrix){m.newMatrix=n.getLocalMatrix();}});this.fireDisplaying();};
N.prototype.displayNodesMoving=function(){if(this._startTimeForDisplay===0||this._nodeLocalmMatrixMap===null||this._nodeLocalmMatrixMap.size===0){return;}var i=Math.min((Date.now()-this._startTimeForDisplay)/this._timeIntervalForDisplay,1);i=1-Math.pow(1-i,3);var a={nodeRefs:[],positions:[]};this._nodeLocalmMatrixMap.forEach(function(m,n){if(n&&m.oldMatrix&&m.newMatrix){var b=this._interpolateNodePosition(n,m.oldMatrix,m.newMatrix,i);a.nodeRefs.push(n.getNodeRef());a.positions.push(b);}}.bind(this));if(a.nodeRefs.length){this._viewStateManager.setTransformation(a.nodeRefs,a.positions);}var v={nodeRefs:[],values:[]};this._nodeLocalMatrixMapForVisibility.forEach(function(d,n){if(n&&d){var b=this._interpolateNodePositionForVisibility(n,d,i);v.nodeRefs.push(n.getNodeRef());v.values.push(b);}}.bind(this));this._viewStateManager.setVisibilityState(v.nodeRefs,v.values);if(i===1){this.clear();this.fireDisplayed();}};
N.prototype.clear=function(){this._nodeLocalmMatrixMap.clear();this._nodeLocalMatrixMapForVisibility.clear();this._startTimeForDisplay=0;};
return N;});
sap.ui.predefine('sap/ui/vk/threejs/OrthographicCamera',["../OrthographicCamera","../thirdparty/three"],function(O,t){"use strict";
var T=O.extend("sap.ui.vk.threejs.OrthographicCamera",{metadata:{}});
var b=O.getMetadata().getParent().getClass().prototype;
T.prototype.init=function(){if(b.init){b.init.call(this);}var n=1;var f=200000;this._nativeCamera=new THREE.OrthographicCamera(-1,1,1,-1,n,f);this._nativeCamera.position.set(0,0,10000);this._nativeCamera.zoom=-1;this.setUsingDefaultClipPlanes(true);};
T.prototype.update=function(w,h){var f=1/Math.min(w,h);this.setLeft(w*-f);this.setRight(w*f);this.setTop(h*f);this.setBottom(h*-f);this._nativeCamera.updateProjectionMatrix();};
T.prototype.exit=function(){if(b.exit){b.exit.call(this);}this._nativeCamera=null;};
T.prototype.getLeft=function(){return this._nativeCamera.left;};
T.prototype.setLeft=function(v){this._nativeCamera.left=v;return this;};
T.prototype.getRight=function(){return this._nativeCamera.right;};
T.prototype.setRight=function(v){this._nativeCamera.right=v;return this;};
T.prototype.getTop=function(){return this._nativeCamera.top;};
T.prototype.setTop=function(v){this._nativeCamera.top=v;return this;};
T.prototype.getBottom=function(){return this._nativeCamera.bottom;};
T.prototype.setBottom=function(v){this._nativeCamera.bottom=v;return this;};
T.prototype.getZoomFactor=function(){return this._nativeCamera.zoom;};
T.prototype.setZoomFactor=function(v){this._nativeCamera.zoom=v;return this;};
T.prototype.getCameraRef=function(){return this._nativeCamera;};
T.prototype.setCameraRef=function(c){this._nativeCamera=c;return this;};
T.prototype.getNearClipPlane=function(){return this._nativeCamera.near;};
T.prototype.setNearClipPlane=function(v){this._nativeCamera.near=v;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this;};
T.prototype.getFarClipPlane=function(){return this._nativeCamera.far;};
T.prototype.setFarClipPlane=function(v){this._nativeCamera.far=v;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this;};
T.prototype.getPosition=function(){return this._nativeCamera.position.toArray();};
T.prototype.setPosition=function(v){this._nativeCamera.position.fromArray(v);this._nativeCamera.updateMatrixWorld();return this;};
T.prototype.getUpDirection=function(){return this._nativeCamera.up.toArray();};
T.prototype.setUpDirection=function(v){this._nativeCamera.up.fromArray(v);this._nativeCamera.updateMatrixWorld();return this;};
T.prototype.getTargetDirection=function(){var d=new THREE.Vector3();this._nativeCamera.getWorldDirection(d);return d.toArray();};
T.prototype.setTargetDirection=function(v){var a=new THREE.Vector3().fromArray(v);a.add(this._nativeCamera.position);this._nativeCamera.lookAt(a);return this;};
T.prototype.setUsingDefaultClipPlanes=function(v){this._nativeCamera.userData.usingDefaultClipPlanes=v;return this;};
T.prototype.getUsingDefaultClipPlanes=function(){return this._nativeCamera.userData.usingDefaultClipPlanes;};
T.prototype.adjustClipPlanes=function(a){var c=this._nativeCamera;c.updateMatrixWorld();a=a.clone().applyMatrix4(c.matrixWorldInverse);c.near=-a.max.z;c.far=-a.min.z;var e=Math.max((c.far-c.near)*0.0025,0.001);c.near-=e;c.far+=e;var p=1.0/(c.far-c.near);var z=(c.far+c.near)*p;c.projectionMatrix.elements[10]=-2*p;c.projectionMatrix.elements[14]=-z;c.projectionMatrixInverse.getInverse(c.projectionMatrix);return this;};
T.prototype.adjustZoom=function(a){var c=this._nativeCamera;c.updateMatrixWorld();a=a.clone().applyMatrix4(c.matrixWorldInverse);c.zoom=1/Math.max(a.min.x/c.left,a.max.y/c.top,a.max.x/c.right,a.min.y/c.bottom);c.updateProjectionMatrix();return this;};
return T;});
sap.ui.predefine('sap/ui/vk/threejs/PerspectiveCamera',["../PerspectiveCamera","../thirdparty/three"],function(P,t){"use strict";
var T=P.extend("sap.ui.vk.threejs.PerspectiveCamera",{metadata:{}});
var b=P.getMetadata().getParent().getClass().prototype;
T.prototype.init=function(){if(b.init){b.init.call(this);}var n=1;var f=10000;this._nativeCamera=new THREE.PerspectiveCamera(30,1,n,f);this._nativeCamera.position.set(0,0,100);this.setUsingDefaultClipPlanes(true);};
T.prototype.update=function(w,h){var o=this._nativeCamera.aspect;var a=this._nativeCamera.zoom;this._nativeCamera.aspect=w/h;this._nativeCamera.zoom=Math.min(this._nativeCamera.aspect,1);var v=this._nativeCamera.view;if(v&&v.enabled){var s=w/v.fullWidth;var c=h/v.fullHeight;var d=this._nativeCamera.zoom/a;var e=d*o/this._nativeCamera.aspect;v.offsetX=(v.offsetX*e+(v.fullWidth-v.width)*(1-e)*0.5)*s;v.offsetY=(v.offsetY*d+(v.fullHeight-v.height)*(1-d)*0.5)*c;v.width*=s;v.height*=c;v.fullWidth=w;v.fullHeight=h;}this._nativeCamera.updateProjectionMatrix();};
T.prototype.exit=function(){if(b.exit){b.exit.call(this);}this._nativeCamera=null;};
T.prototype.getFov=function(){return this._nativeCamera.fov;};
T.prototype.setFov=function(v){this._nativeCamera.fov=v;this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this;};
T.prototype.getCameraRef=function(){return this._nativeCamera;};
T.prototype.setCameraRef=function(c){this._nativeCamera=c;return this;};
T.prototype.getNearClipPlane=function(){return this._nativeCamera.near;};
T.prototype.setNearClipPlane=function(v){this._nativeCamera.near=v;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this;};
T.prototype.getFarClipPlane=function(){return this._nativeCamera.far;};
T.prototype.setFarClipPlane=function(v){this._nativeCamera.far=v;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this;};
T.prototype.getPosition=function(){return this._nativeCamera.position.toArray();};
T.prototype.setPosition=function(v){this._nativeCamera.position.fromArray(v);this._nativeCamera.updateMatrixWorld();return this;};
T.prototype.getUpDirection=function(){return this._nativeCamera.up.toArray();};
T.prototype.setUpDirection=function(v){this._nativeCamera.up.fromArray(v);this._nativeCamera.updateMatrixWorld();return this;};
T.prototype.getTargetDirection=function(){return this._nativeCamera.getWorldDirection().toArray();};
T.prototype.setTargetDirection=function(v){var a=new THREE.Vector3().fromArray(v);a.add(this._nativeCamera.position);this._nativeCamera.lookAt(a);return this;};
T.prototype.setUsingDefaultClipPlanes=function(v){this._nativeCamera.userData.usingDefaultClipPlanes=v;return this;};
T.prototype.getUsingDefaultClipPlanes=function(){return this._nativeCamera.userData.usingDefaultClipPlanes;};
T.prototype.adjustClipPlanes=function(a){var e=this._nativeCamera;e.updateMatrixWorld();a=a.clone().applyMatrix4(e.matrixWorldInverse);e.near=-a.max.z;e.far=-a.min.z;var f=Math.max((e.far-e.near)*0.0025,0.001);e.far=Math.max(e.far,0.1);f=Math.max(f,e.far*0.0025);e.near-=f;e.far+=f;e.near=Math.max(e.near,e.far*0.0025);var c=-(e.far+e.near)/(e.far-e.near);var d=-2*e.far*e.near/(e.far-e.near);e.projectionMatrix.elements[10]=c;e.projectionMatrix.elements[14]=d;e.projectionMatrixInverse.getInverse(e.projectionMatrix);return this;};
return T;});
sap.ui.predefine('sap/ui/vk/threejs/PoiHelper',["../NodeContentType","../TransformationMatrix","sap/base/util/uid"],function(N,T,u){"use strict";var P=function(){this._currentSceneId=null;};
P.prototype.createPOI=function(c,p,v,a,b,n){v=v._implementation||v;b=b||{x:1,y:1};n=n||{};n.sid=n.sid||u();if(!n.transform){var d=v.getDomRef().getBoundingClientRect();var s=a.x-d.left;var e=a.y-d.top;var f=this.getBackgroundImageType(v);var g=v.hitTest(s,e).point;var h=f==="2DImage"?0.3:1.0;var i=f==="2DImage"?0.99:0.5;n.transform=[Number(b.x)*h,0,0,0,Number(b.y)*h,0,0,0,h,g.x*i,g.y*i,g.z*i];}else if(n.transform.length===16){n.transform=T.convertTo4x3(n.transform);}n.transformType=n.transformType||"BILLBOARD_VIEW";if(this._currentSceneId){c.getSceneBuilder()._resetCurrentScene(this._currentSceneId);}var l=v._cdsLoader;if(l){var j=l.getSkipLowLODRendering();l.setSkipLowLODRendering(false);var k=c.getDefaultNodeHierarchy();var m=k.createNode(null,"Sample POI",null,N.Symbol,n);var o=v.getCurrentView()||c.getViews()[0];o.updateNodeInfos([{target:m,visible:true}]);return l.loadTransientScene(p,m).then(function(t){l.setSkipLowLODRendering(j);v.setShouldRenderFrame();var q=t.nodeRef;q.traverse(function(w){w.userData.skipIt=true;});this._currentSceneId=q.userData.currentSceneId;Object.assign(q.userData.treeNode,n);var r={transform:T.convertTo4x4(n.transform),veid:n.sid,entityId:q.userData.entityId,name:n.name||"Sample POI",transformType:"view",contentType:"symbol"};return r;}.bind(this));}};
P.prototype.removePOI=function(c,n){var a=c.getDefaultNodeHierarchy();var v=c.getViewStateManager();v.setVisibilityState(n,false,true);a.removeNode(n);};
P.prototype.getPOIList=function(v){var a=v.getViewStateManager();return a?a.getSymbolNodes():[];};
P.prototype.getBackgroundImageType=function(v){return v._viewStateManager.getBackgroundImageType();};
P.prototype.getPoiRect=function(v,n){var c=v._getNativeCamera();var b=new THREE.Box3();b.setFromObject(n);var a=[new THREE.Vector3(b.min.x,b.min.y,b.min.z),new THREE.Vector3(b.max.x,b.max.y,b.max.z),new THREE.Vector3(b.min.x,b.min.y,b.max.z),new THREE.Vector3(b.min.x,b.max.y,b.max.z),new THREE.Vector3(b.max.x,b.min.y,b.max.z),new THREE.Vector3(b.max.x,b.max.y,b.min.z),new THREE.Vector3(b.min.x,b.max.y,b.min.z),new THREE.Vector3(b.max.x,b.min.y,b.min.z)];var f=new THREE.Frustum();f.setFromProjectionMatrix(new THREE.Matrix4().multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse));if(!f.intersectsBox(b)){return false;}var m=new THREE.Vector3(1,1,1);var d=new THREE.Vector3(-1,-1,-1);var e=new THREE.Vector3();for(var i=0;i<a.length;++i){if(!f.containsPoint(a[i])){return false;}var g=e.copy(a[i]);var h=g.project(c);m.min(h);d.max(h);}var j=new THREE.Box2(m,d);var k=v.getDomRef().getBoundingClientRect();var l=new THREE.Vector2(k.width/2,k.height/2);var o=j.min.clone().multiply(l);var p=j.max.clone().multiply(l);var w=p.x-o.x;var q=p.y-o.y;return{width:w,height:q};};
P.prototype.adjustPoi=function(v,p){var b=this.getBackgroundImageType(v);var s=b==="2DImage"?0.3:1.0;if(b!=="2DImage"){var c=p.getWorldPosition(new THREE.Vector3());var r=c.length()/500;if(p.position&&p.baseScale){p.position.multiplyScalar(1/r);p.baseScale.multiplyScalar(1/r);p.updateMatrix();p.updateMatrixWorld();}}p.userData.transform=[s,0,0,0,s,0,0,0,s,p.position.x,p.position.y,p.position.z];};
P.prototype.updateNodeId=function(c,n,a){var v=c.getViewStateManager();var p=v?v.getSymbolNodes(n)[0]:null;if(p){p.userData.nodeId=a;p.userData.treeNode.sid=a;c.setNodePersistentId(p,a);}return p;};
P.prototype.updatePOI=function(v,n,p,a,b){var c=v.getScene();var s=v._viewStateManager.getSymbolNodes(n)[0];b=b||{};var l=v._cdsLoader;if(s&&l){s.name=b.name||s.name;if(a){s.baseScale.set(a.x,a.y);}var d=l.getSkipLowLODRendering();l.setSkipLowLODRendering(false);if(b.transform){if(b.transform.length===16){b.transform=T.convertTo4x3(b.transform);}s.position.set(b.transform[9],b.transform[10],b.transform[11]);}if(p){var e=v._viewStateManager.getNodeHierarchy();s.children.forEach(function(f){e.removeNode(f);});return l.loadTransientScene(p,s).then(function(t){l.setSkipLowLODRendering(d);var f=t.nodeRef;f.traverse(function(g){g.userData.skipIt=true;});c.getSceneBuilder()._resetCurrentScene(f.userData.currentSceneId);f.userData.treeNode.sid=s.userData.treeNode.sid;v.setShouldRenderFrame();return{target:f,entityId:f.userData.entityId};});}else{v.setShouldRenderFrame();var f=s.children[0];return Promise.resolve({target:f,entityId:s.userData.treeNode.entityId||f.userData.entityId});}}};
return P;});
sap.ui.predefine('sap/ui/vk/threejs/PolylineGeometry',["../thirdparty/three"],function(t){"use strict";
function P(){THREE.InstancedBufferGeometry.call(this);this.type="PolylineGeometry";var p=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0];var u=[2,-1,2,1,1,-1,1,1,-1,-1,-1,1,-2,-1,-2,1];var i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i);this.setAttribute("position",new THREE.Float32BufferAttribute(p,3));this.setAttribute("uv",new THREE.Float32BufferAttribute(u,2));}
P.prototype=Object.assign(Object.create(THREE.InstancedBufferGeometry.prototype),{constructor:P,isPolylineGeometry:true,setVertices:function(v){this.vertices=v;var l=v.length-1;var d=new Float32Array(6*l);for(var i=0,c=0;i<l;i++){var a=v[i],b=v[i+1];d[c++]=a.x;d[c++]=a.y;d[c++]=a.z;d[c++]=b.x;d[c++]=b.y;d[c++]=b.z;}var e=new THREE.InstancedInterleavedBuffer(d,6,1);this.setAttribute("instanceStart",new THREE.InterleavedBufferAttribute(e,3,0));this.setAttribute("instanceEnd",new THREE.InterleavedBufferAttribute(e,3,3));var f=new THREE.InstancedInterleavedBuffer(new Float32Array(2*l),2,1);this.setAttribute("instanceDistance",new THREE.InterleavedBufferAttribute(f,2,0));this.computeBoundingBox();this.computeBoundingSphere();return this;},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3();}this.boundingBox.setFromPoints(this.vertices);},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere();}this.boundingSphere.setFromPoints(this.vertices);},_updateVertices:function(a){var b=this.vertices;var d=this.attributes.instanceStart.data;var c=d.array;a.forEach(function(e){var v=b[e];var i=e*6-3;if(i>=0){c[i+0]=v.x;c[i+1]=v.y;c[i+2]=v.z;}if(i+5<c.length){c[i+3]=v.x;c[i+4]=v.y;c[i+5]=v.z;}});d.needsUpdate=true;this.computeBoundingBox();this.computeBoundingSphere();}});return P;});
sap.ui.predefine('sap/ui/vk/threejs/PolylineMaterial',["../thirdparty/three"],function(t){"use strict";var p={lineColor:{value:new THREE.Color(1,1,1)},linewidth:{value:1},resolution:{value:new THREE.Vector2(1,1)},dashScale:{value:1},dashPeriod:{value:new THREE.Vector3(1,1,1)},dashAtlas:{value:null},lineLength:{value:1e5}};var u=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,p]);var v=["#include <common>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","","uniform float linewidth;","uniform vec2 resolution;","","attribute vec3 instanceStart;","attribute vec3 instanceEnd;","","varying vec2 vTC;","","#if defined(USE_DASH) || TRIM_STYLE","attribute vec2 instanceDistance;","varying float vLineDistance;","#endif","","void trimSegment(const in vec4 start, inout vec4 end) {","	// trim end segment so it terminates between the camera plane and the near plane","","	// conservative estimate of the near plane","	float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column","	float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column","	float nearEstimate = -0.5 * b / a;","","	float t = (nearEstimate - start.z) / (end.z - start.z);","","	end.xyz = mix(start.xyz, end.xyz, t);","}","","void main() {","	vTC = uv * linewidth;","","	// camera space","	vec4 start = modelViewMatrix * vec4(instanceStart, 1.0);","	vec4 end = modelViewMatrix * vec4(instanceEnd, 1.0);","","	// special case for perspective projection, and segments that terminate either in, or behind, the camera plane","	// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space","	// but we need to perform ndc-space calculations in the shader, so we must address this issue directly","	// perhaps there is a more elegant solution -- WestLangley","","	bool perspective = (projectionMatrix[ 2 ][ 3 ] == -1.0); // 4th entry in the 3rd column","	if (perspective) {","		if (start.z < 0.0 && end.z >= 0.0) {","			trimSegment(start, end);","		} else if (end.z < 0.0 && start.z >= 0.0) {","			trimSegment(end, start);","		}","	}","","	// clip space","	vec4 clipStart = projectionMatrix * start;","	vec4 clipEnd = projectionMatrix * end;","","	// ndc space","	vec2 ndcStart = clipStart.xy / clipStart.w;","	vec2 ndcEnd = clipEnd.xy / clipEnd.w;","","	// direction","	vec2 dir = (ndcEnd - ndcStart) * resolution;","	float l = length(dir);","	dir = normalize(dir);","","	// perpendicular to dir","	vec2 offset = vec2(dir.y, -dir.x) * position.x;","","#if defined(USE_DASH) || TRIM_STYLE","	vLineDistance = mix(instanceDistance.x, instanceDistance.y, position.y);","#endif","","	// endcaps","	if ( position.y < 0.0 ) {","		offset -= dir;","#if defined(USE_DASH)","		vLineDistance = mix(instanceDistance.x, instanceDistance.y, position.y * linewidth / l);","#endif","	} else if ( position.y > 1.0 ) {","		offset += dir;","#if defined(USE_DASH)","		vLineDistance = mix(instanceDistance.x, instanceDistance.y, 1.0 + (position.y - 1.0) * linewidth / l);","#endif","	}","","	// select end","	vec4 clip = (position.y < 0.5) ? clipStart : clipEnd;","	clip /= clip.w; // remove perspective correction","","	clip.xy += offset * (linewidth / resolution);","","	gl_Position = clip;","","	vec4 mvPosition = (position.y < 0.5) ? start : end; // this is an approximation","","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>","}"].join("\n");var f=["uniform vec3 diffuse;","uniform vec3 lineColor;","uniform float opacity;","uniform float linewidth;","","#ifdef USE_DASH","uniform float dashScale;","uniform vec3 dashPeriod;","uniform sampler2D dashAtlas;","#endif","","#if (TRIM_STYLE & 2)","uniform float lineLength;","#endif","","varying float vLineDistance;","","#include <common>","#include <color_pars_fragment>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>","","varying vec2 vTC;","","void main() {","","#include <clipping_planes_fragment>","","	vec4 diffuseColor = vec4(diffuse * lineColor, opacity);","","	vec2 uv = abs(vTC);","	diffuseColor.a *= clamp(linewidth + 0.5 - uv.y, 0.0, 1.0); // line antialiasing","","#if (TRIM_STYLE & 1)","	if (vLineDistance < 0.0)","		discard;","#endif","","#if (TRIM_STYLE & 2)","	if (vLineDistance > lineLength)","		discard;","#endif","","	if (uv.x > linewidth) { // apply segment cap","#if (SEGMENT_CAP_STYLE == 1) // round cap","		vec2 delta = vec2(uv.y, uv.x - linewidth);","		diffuseColor.a *= clamp(linewidth - length(delta), 0.0, 1.0);","#else","		diffuseColor.a *= clamp(linewidth + 1.0 - uv.x, 0.0, 1.0);","#endif","	}","","#include <logdepthbuf_fragment>","#include <color_fragment>","","#ifdef USE_DASH","	float x = fract(vLineDistance * dashPeriod.y / dashScale);","	vec4 dash = texture2D(dashAtlas, vec2(x * dashPeriod.z, 0.5));","	dash.zw *= 255.0;","	x *= dashPeriod.x;","	dash.zw = vec2(dash.z - x, x - dash.w);","	x = min(dash.z, dash.w) * dashScale;","#if (DASH_CAP_STYLE == 1) // round cap","	vec2 delta = vec2(x * 2.0, uv.y);","	diffuseColor.a *= max(step(x / linewidth, 0.0), clamp(linewidth + 0.5 - length(delta), 0.0, 1.0));","#else // no cap","	diffuseColor.a *= clamp(0.5 - x, 0.0, 1.0);","#endif","#endif","","	gl_FragColor = diffuseColor;","","#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","}"].join("\n");
function P(a){THREE.ShaderMaterial.call(this,{type:"PolylineMaterial",uniforms:THREE.UniformsUtils.clone(u),vertexShader:v,fragmentShader:f});this.defines.DASH_CAP_STYLE=0;this.defines.SEGMENT_CAP_STYLE=0;this.defines.TRIM_STYLE=0;this._dashPattern=[];Object.defineProperties(this,{color:{enumerable:true,get:function(){return this.uniforms.diffuse.value;},set:function(b){this.uniforms.diffuse.value=b;}},lineColor:{enumerable:true,get:function(){return this.uniforms.lineColor.value;},set:function(b){this.uniforms.lineColor.value=b;}},linewidth:{enumerable:true,get:function(){return this.uniforms.linewidth.value;},set:function(b){this.uniforms.linewidth.value=b;}},dashCapStyle:{enumerable:true,get:function(){return this.defines.DASH_CAP_STYLE;},set:function(b){this.defines.DASH_CAP_STYLE=b;}},segmentCapStyle:{enumerable:true,get:function(){return this.defines.SEGMENT_CAP_STYLE;},set:function(b){this.defines.SEGMENT_CAP_STYLE=b;}},trimStyle:{enumerable:true,get:function(){return this.defines.TRIM_STYLE;},set:function(b){this.defines.TRIM_STYLE=b;}},dashScale:{enumerable:true,get:function(){return this.uniforms.dashScale.value;},set:function(b){this.uniforms.dashScale.value=b;}},dashPattern:{enumerable:true,get:function(){return this._dashPattern;},set:function(b){this._dashPattern=b;this._updateDashAtlas();}},resolution:{enumerable:true,get:function(){return this.uniforms.resolution.value;},set:function(b){this.uniforms.resolution.value.copy(b);}},lineLength:{enumerable:true,get:function(){return this.uniforms.lineLength.value;},set:function(b){this.uniforms.lineLength.value=b;}}});this.setValues(a);}
P.prototype=Object.create(THREE.ShaderMaterial.prototype);P.prototype.constructor=P;P.prototype.isLineMaterial=true;
P.prototype._updateDashAtlas=function(){if(!this._dashPattern.length){delete this.defines.USE_DASH;this.uniforms.dashAtlas.value=null;this.needsUpdate=true;return;}var d=Array.from(this._dashPattern);if(d.length&1){d=d.concat(d);}var a=d.reduce(function(l,n){return l+Math.ceil(n);});var b=THREE.Math.ceilPowerOfTwo(a);this.uniforms.dashPeriod.value.set(a,1/a,a/b);var e=new Uint8Array(b*4);for(var i=0,x=0,c=0;i<d.length;i++){var w=d[i];var g=(i&1)?x+w:x;var h=(i&1)?x:x+w;var j=(i&1)?0:255;while(w-->0){e[c++]=j;e[c++]=0;e[c++]=g;e[c++]=h;x++;}}var k=new THREE.DataTexture(e,b,1,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);k.needsUpdate=true;this.defines.USE_DASH="";this.uniforms.dashAtlas.value=k;this.needsUpdate=true;};
P.prototype.copy=function(s){THREE.ShaderMaterial.prototype.copy.call(this,s);this.color.copy(s.color);this.lineColor.copy(s.lineColor);this.linewidth=s.linewidth;this.dashCapStyle=s.dashCapStyle;this.segmentCapStyle=s.segmentCapStyle;this.trimStyle=s.trimStyle;this.dashPattern=s.dashPattern;this.resolution=s.resolution;this.lineLength=s.lineLength;return this;};
return P;});
sap.ui.predefine('sap/ui/vk/threejs/PolylineMesh',["../thirdparty/three","./PolylineGeometry","./PolylineMaterial"],function(c,P,d){"use strict";
function e(g,m){var a=g!==undefined?g:new P();var b=m!==undefined?m:new d();THREE.Mesh.call(this,a,b);this.type="PolylineMesh";}
e.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:e,isPolylineMesh:true,computeLineDistances:(function(){var a=new THREE.Vector4();var b=new THREE.Vector4();var f=new THREE.Vector2();var g=new THREE.Vector2();return function(m,v,n){var h=this.geometry;var k=h.attributes.instanceDistance.data;var o=k.array;var p=h.vertices;var q=0,t;a.copy(p[0]).applyMatrix4(m);for(var i=0,j=0,l=k.count;i<l;i++,j+=2){b.copy(p[i+1]).applyMatrix4(m);if(n!==undefined){if(a.w>=n){f.copy(a).multiplyScalar(1/a.w);if(b.w>=n){g.copy(b).multiplyScalar(1/b.w);}else{t=(a.w-n)/(a.w-b.w);g.copy(b).sub(a).multiplyScalar(t).add(a).multiplyScalar(1/n);}}else if(b.w>=n){g.copy(b).multiplyScalar(1/b.w);t=(b.w-n)/(b.w-a.w);f.copy(a).sub(b).multiplyScalar(t).add(b).multiplyScalar(1/n);}else{f.set(0,0,0);g.set(0,0,0);}}else{f.copy(a);g.copy(b);}o[j]=q;q+=g.sub(f).multiply(v).length()*0.5;o[j+1]=q;a.copy(b);}this.material.lineLength=q;k.needsUpdate=true;return this;};}())});return e;});
sap.ui.predefine('sap/ui/vk/threejs/Scene',["../Scene","./NodeHierarchy","../RenderMode","./ThreeExtensions","./ThreeUtils","sap/base/util/uid"],function(S,N,R,T,c,u){"use strict";
var d=S.extend("sap.ui.vk.threejs.Scene",{
metadata:{},
constructor:function(a){S.call(this);this._id=u();this._scene=a;this._sceneBuilder=null;this._defaultNodeHierarchy=null;this._currentViewStateManager=null;this._animationSequenceMap=new Map();this._initialView=null;this._materialMap=new Map();}
});
d.prototype.init=function(){this._outlineColor=new THREE.Vector4(0,0,0,1);this._outlineMaterial=new THREE.ShaderMaterial({uniforms:{color:{value:this._outlineColor}},vertexShader:["attribute vec3 normal1;","attribute vec3 normal2;","#include <clipping_planes_pars_vertex>","uniform vec4 color;","varying vec4 vColor;","void main() {","	#include <begin_vertex>","	#include <project_vertex>","	#include <clipping_planes_vertex>","	vec3 eyeDirection = mvPosition.xyz;","	vec3 n1 = normalMatrix * normal1;","	vec3 n2 = normalMatrix * normal2;","	vColor = color;","	vColor.a *= step(dot(eyeDirection, n1) * dot(eyeDirection, n2), 0.0);","}"].join("\n"),fragmentShader:["#include <clipping_planes_pars_fragment>","varying vec4 vColor;","void main() {","	#include <clipping_planes_fragment>","	if (vColor.a < ALPHATEST) discard;","	gl_FragColor = vColor;","}"].join("\n"),depthWrite:false,depthFunc:THREE.LessEqualDepth,polygonOffset:true,polygonOffsetFactor:-4,blending:THREE.NormalBlending,alphaTest:0.01,clipping:true});this._solidWhiteMaterial=new THREE.MeshBasicMaterial({color:0xFFFFFF});};
d.prototype.clearThreeScene=function(){if(!this._scene){return;}var a=[];var b=[];c.getAllTHREENodes([this._scene],a,b);var e=new Map();var i=new Map();a.forEach(function(j){if(j instanceof THREE.Mesh){if(!e.has(j.geometry.uuid)){c.disposeGeometry(j);e.set(j.geometry.uuid,true);}if(j.material){if(!i.has(j.material.uuid)){c.disposeMaterial(j.material);i.set(j.material.uuid,true);}}if(j.userData&&j.userData.originalMaterial&&j.userData.originalMaterial.uuid!==j.material.uuid&&!i.has(j.userData.originalMaterial.uuid)){c.disposeMaterial(j.userData.originalMaterial);i.set(j.userData.originalMaterial.uuid,true);}}j.parent.remove(j);});b.forEach(function(j){j.parent.remove(j);});e.clear();i.clear();};
d.prototype.destroy=function(){this.clearThreeScene();if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null;}c.disposeMaterial(this._solidWhiteMaterial);c.disposeMaterial(this._outlineMaterial);this._sceneBuilder=null;if(this._scene){this._scene.dispose();}this._scene=null;this._currentViewStateManager=null;this._animationSequenceMap.clear();this._materialMap.clear();S.prototype.destroy.call(this);};
d.prototype.setDoubleSided=function(v){this.setProperty("doubleSided",v,true);this._scene.traverse(function(a){if(a.material!==undefined){var b=a.userData;var e=THREE.FrontSide;var i;if(b.originalMaterial){if(b.originalMaterial.userData===undefined){b.originalMaterial.userData={};}i=b.originalMaterial.userData;if(i.originalMaterialSide===undefined){i.originalMaterialSide=b.originalMaterial.side;}e=i.originalMaterialSide;}else{if(a.material.userData===undefined){a.material.userData={};}i=a.material.userData;if(i.originalMaterialSide===undefined){i.originalMaterialSide=a.material.side;}e=i.originalMaterialSide;}a.material.side=v?THREE.DoubleSide:e;}});return this;};
d.prototype.setViewStateManager=function(v){this._currentViewStateManager=v;return this;};
d.prototype.getViewStateManager=function(){return this._currentViewStateManager;};
d.prototype.getId=function(){return this._id;};
d.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new N(this);}return this._defaultNodeHierarchy;};
d.prototype._computeBoundingBox=function(v,i,a){var b=new THREE.Box3();if(this._scene){this._scene._expandBoundingBox(b,v,i,a);}return b;};
d.prototype.getSceneRef=function(){return this._scene;};
d.prototype.setSceneBuilder=function(a){this._sceneBuilder=a;};
d.prototype.getSceneBuilder=function(){return this._sceneBuilder;};
d.prototype.nodeRefToPersistentId=function(a){return Array.isArray(a)?a.map(function(b){return b._vkPersistentId();}):a._vkPersistentId();};
d.prototype.persistentIdToNodeRef=function(a){var b=this._sceneBuilder;if(Array.isArray(a)){return a.map(function(e){return b?b.getNode(e):null;});}else{return b?b.getNode(a):null;}};
d.prototype.setNodePersistentId=function(a,b,e){return this._sceneBuilder?this._sceneBuilder.setNodePersistentId(a,b,e):false;};
d.prototype.setAnnotationPersistentId=function(a,b,e){return this._sceneBuilder?this._sceneBuilder.setAnnotationPersistentId(a,b,e):false;};
d.prototype.enumerateMaterials=function(){if(!this._defaultNodeHierarchy){return[];}var t=this._defaultNodeHierarchy.createNodeProxy(this._scene);if(t){return t.enumerateMaterials(true);}else{return[];}};
var f=0;
function g(a,b){var e=a.x-b.x;if(e<-f){return true;}if(e>f){return false;}var i=a.y-b.y;if(i<-f){return true;}if(i>f){return false;}return a.z-b.z<-f;}
function q(a,b,e){if(b<e){var i=p(a,b,e);q(a,b,i-1);q(a,i+1,e);}return a;}
function p(a,b,e){var j=a[e],l=b;for(var i=b;i<e;i++){if(g(a[i],j)){s(a,i,l);l++;}}s(a,e,l);return l;}
function s(a,i,j){if(i!=j){var t=a[i];a[i]=a[j];a[j]=t;}}
var h=new THREE.Vector3();
function m(a){a.computeBoundingBox();a.boundingBox.getSize(h);f=Math.max(h.x,h.y,h.z)*1e-4;var v=a.vertices,b=v.length,e=a.faces.length;if(b===0||e===0){return;}var i,j;for(i=0;i<b;i++){v[i].index=i;}q(v,0,v.length-1);var l=[],t=[];l.push(v[0]);t[v[0].index]=l.length-1;for(i=1;i<b;i++){if(g(l[l.length-1],v[i])){l.push(v[i]);}t[v[i].index]=l.length-1;}a.vertices=l;for(i=0,e=a.faces.length,j=0;i<e;i++){var w=a.faces[i];var x=a.faces[j];x.a=t[w.a];x.b=t[w.b];x.c=t[w.c];if(x.a!==x.b&&x.b!==x.c&&x.c!==x.a){j++;}}a.faces.length=j;}
function O(a,t){THREE.BufferGeometry.call(this);this.type="OutlineGeometry";var b=Math.cos(THREE.Math.DEG2RAD*((t!==undefined)?t:1));var w={},x,y;var z,A=["a","b","c"];var v=new THREE.Vector3();var B;if(a.isBufferGeometry){B=new THREE.Geometry();B.fromBufferGeometry(a);}else{B=a.clone();}m(B);B.computeFaceNormals();var C=B.vertices;var D=B.faces;for(var E=0,l=D.length;E<l;E++){var F=D[E];for(var i=0,j=2;i<3;j=i++){x=F[A[j]];y=F[A[i]];z=Math.min(x,y)+","+Math.max(x,y);if(w[z]===undefined){w[z]={index1:x,index2:y,face1:E,face2:undefined};}else{w[z].face2=E;}}}var G=[];var H=[];var I=[];for(z in w){var e=w[z];if(e.face2===undefined||(D[e.face1].normal.dot(D[e.face2].normal)<=b&&v.copy(C[e.index2]).sub(C[e.index1]).cross(D[e.face1].normal).dot(D[e.face2].normal)>0)){var J=C[e.index1];G.push(J.x,J.y,J.z);J=C[e.index2];G.push(J.x,J.y,J.z);var K=D[e.face1].normal;H.push(K.x,K.y,K.z);H.push(K.x,K.y,K.z);if(e.face2!==undefined){var L=D[e.face2].normal;I.push(L.x,L.y,L.z);I.push(L.x,L.y,L.z);}else{I.push(0,0,0);I.push(0,0,0);}}}this.setAttribute("position",new THREE.Float32BufferAttribute(G,3));this.setAttribute("normal1",new THREE.Float32BufferAttribute(H,3));this.setAttribute("normal2",new THREE.Float32BufferAttribute(I,3));}
O.prototype=Object.create(THREE.BufferGeometry.prototype);O.prototype.constructor=O;
function k(b){return(b===null)||(b.min.x>=b.max.x&&b.min.y>=b.max.y&&b.min.z>=b.max.z);}
function n(a){var b=null;if(a.isMesh&&a.geometry&&!k(a.geometry.boundingBox)&&!a.userData.skipIt){b=a.geometry;if(b.isBufferGeometry){b=new THREE.Geometry().fromBufferGeometry(b);}}for(var i=0,l=a.children.length;i<l;i++){var e=a.children[i];if(e.isMesh&&e.geometry&&!k(e.geometry.boundingBox)&&e.userData.skipIt){if(b===null){b=new THREE.Geometry();}var j=e.geometry;if(j.isBufferGeometry){j=new THREE.Geometry().fromBufferGeometry(j);}b.merge(j,e.matrix);}}return b;}
function o(a,b){var e=a.userData;if(e.defaultMaterial===undefined){e.defaultMaterial=e.originalMaterial||a.material;}a.material=b;e.originalMaterial=null;a._vkUpdateMaterialColor();a._vkUpdateMaterialOpacity();}
function r(a){var b=a.userData;if(b.defaultMaterial){a.material=b.defaultMaterial;delete b.defaultMaterial;b.originalMaterial=null;a._vkUpdateMaterialColor();a._vkUpdateMaterialOpacity();}}
d.prototype._createOutlineGeometry=function(a){if(this._scene){this._scene._vkTraverseMeshNodes(function(b){if(b.isOutline){b.visible=true;}else{if(!b.hasOutline){var e;try{e=n(b);}catch(i){e=null;}if(e!==null){b.hasOutline=true;var j=new O(e);j.boundingBox=new THREE.Box3();var l=new THREE.LineSegments(j,this._outlineMaterial);l.isOutline=true;l.renderOrder=b.renderOrder+0.5;b.add(l);}}if(b.isMesh&&b.material&&!b.material.isLineBasicMaterial&&!b.material.isLineMaterial){switch(a){case R.LineIllustration:o(b,this._solidWhiteMaterial);break;case R.ShadedIllustration:var t=(b.userData.defaultMaterial||b.userData.originalMaterial||b.material).clone();if(t.emissive){t.color.multiplyScalar(0.5);t.emissive.multiplyScalar(0.5).addScalar(0.5);}else{t.color.multiplyScalar(0.5).addScalar(0.5);}o(b,t);break;default:r(b);break;}}}}.bind(this));}};
d.prototype._hideOutlineGeometry=function(){if(this._scene){this._scene._vkTraverseMeshNodes(function(a){if(a.isOutline){a.visible=false;}if(a.isMesh){r(a);}});}};
d.prototype.getInitialView=function(){return this._initialView;};
d.prototype.setInitialView=function(v){this._initialView=v;};
d.prototype.getMaterial=function(a){return this._materialMap.get(a);};
d.prototype.setMaterial=function(a,b){this._materialMap.set(a,b);};
d.prototype.clearMaterials=function(){this._materialMap.forEach(function(v,a){v.destroy();});this._materialMap.clear();};
d.prototype._getNativeMaterial=function(a){var b=a?this._materialMap.get(a):null;return b?b.getMaterialRef():null;};
d.prototype._setNodeMaterial=function(a,b){var e=this._getNativeMaterial(b);a.children.forEach(function(i){if(i.material){if(e){if(i.userData.materialId!==b){this._sceneBuilder._setSubmeshMaterial(i,e,b);}}else{var j=i.userData.initialMaterialId;if(j&&i.userData.materialId!==j){var l=this._getNativeMaterial(j);if(l){this._sceneBuilder._setSubmeshMaterial(i,l,j);}}}}}.bind(this));};
return d;});
sap.ui.predefine('sap/ui/vk/threejs/SceneBuilder',["../thirdparty/three","sap/base/Log","./BBoxSubdivider","./UsageCounter","../totara/TotaraUtils","./OrthographicCamera","./PerspectiveCamera","./DetailView","./AnimationHelper","./Thrustline","../View","./Billboard","./Callout","../BillboardCoordinateSpace","../BillboardTextEncoding","../BillboardStyle","../BillboardBorderLineStyle","../BillboardHorizontalAlignment","../LeaderLineMarkStyle","../DetailViewType","../DetailViewShape","../AnimationPlayback","../AnimationRotateType","../RenderMode","./Material","../ObjectType","../getResourceBundle","./MarchingCubes","./ParametricGenerators","../NodeContentType","./ThreeExtensions","../thirdparty/ie-polyfills","sap/base/util/uid","./ThreeUtils","sap/base/assert"],function(t,L,B,U,T,O,P,D,A,a,V,b,C,d,f,g,h,o,p,q,r,s,u,R,M,v,w,x,y,N,z,E,F,G,H){"use strict";var S=function(c,e,i,j){this._rootNode=c;this._contentResource=e;this._resolve=i;this._reject=j;this._callouts=new Map();this._cameras=new Map();this._images=new Map();this._imageIdsAndTileWidths=new Map();this._imageTextures=new Map();this._geometries=new Map();this._meshNodes=new Map();this._meshSubmeshes=new Map();this._geometryMeshes=new Map();this._materialMeshes=new Map();this._materialClones=new Map();this._joints=[];this._annotations=new Map();if(c){this._nodes=new Map();this._tracks=new Map();this._trackIdSequenceNodeMap=new Map();this._viewGroups=new Map();this._views=new Map();}else{this._nodes=null;this._tracks=null;this._trackIdSequenceNodeMap=null;this._viewGroups=null;this._views=null;}this._currentSceneId=null;this._sceneIdTreeNodesMap=new Map();this._sceneIdRootNodeMap=new Map();this._animationHelper=new A(this);if(e){var n=e.getNodeProxy();var k=n.getNodeHierarchy();this._vkScene=k.getScene();var l=e.getSource();if(l&&l.name){this._sceneIdTreeNodesMap.set(l.name,this._nodes);this._sceneIdRootNodeMap.set(l.name,c);this._currentSceneId=l.name;}if(this._rootNode){this._rootNode.userData.skipIt=!e.name;}}this._viewThumbnails=new Map();this._thrustlines=new Map();this._animations=new Map();this._animationTracks=new Map();this._jointNodesMap=new Map();this._jointParentsMap=new Map();this._voxelThreshold=0.0;};
S.prototype.getVoxelThreshold=function(){return this._voxelThreshold;};
S.prototype.setVoxelThreshold=function(c){this._voxelThreshold=c;return this;};
var I=[R.Default,R.Default,R.Default,R.LineIllustration,R.SolidOutline,R.ShadedIllustration];
S.prototype.setScene=function(i){if(i.result!==1){var e={status:i.result};switch(i.result){case-1:e.errorText=w().getText("LOADER_FILENOTFOUND");break;case-2:e.errorText=w().getText("LOADER_WRONGFILEFORMAT");break;case-3:e.errorText=w().getText("LOADER_WRONGPASSWORD");break;case-4:e.errorText=w().getText("LOADER_ERRORREADINGFILE");break;case-5:e.errorText=w().getText("LOADER_FILECONTENT");break;default:e.errorText=w().getText("LOADER_UNKNOWNERROR");}this._reject(e);}else{this._vkScene.setSceneBuilder(this);var c=this._cameras.get(i.cameraId);this._resolve({node:this._rootNode,camera:c,backgroundTopColor:i.backgroundTopColor,backgroundBottomColor:i.backgroundBottomColor,upAxis:i.upAxis,annotations:this._annotations,contentResource:this._contentResource,builder:this});}};
S.prototype.setRootNode=function(c,n,e,i){this._rootNode=c;this._nodes=new Map();this._nodes.set(n,c);this._tracks=new Map();this._trackIdSequenceNodeMap=new Map();this._sequenceIdToPlaybacks=new Map();this._viewGroups=new Map();this._views=new Map();if(e){this._sceneIdTreeNodesMap.set(e,this._nodes);this._sceneIdRootNodeMap.set(e,c);this._currentSceneId=e;}if(i){this._vkScene=i;}return this;};
S.prototype._resetCurrentScene=function(c){if(c&&c!==this._currentSceneId){var n=this._sceneIdTreeNodesMap.get(c);if(n){this._nodes=n;}else{this._nodes=null;}var e=this._sceneIdRootNodeMap.get(c);if(e){this._rootNode=e;}else{this._rootNode=null;}this._currentSceneId=c;}};
S.prototype.getNode=function(n,c){if(c){this._resetCurrentScene(c);if(this._nodes){return this._nodes.get(n);}}else{var e=this._sceneIdTreeNodesMap.values();var i=e.next();while(!i.done){var j=i.value.get(n);if(j){return j;}i=e.next();}}return null;};
S.prototype.hasMesh=function(m){return this._meshSubmeshes.has(m);};
S.prototype.hasImage=function(i){return this._images.has(i);};
S.prototype.setNodePersistentId=function(n,c,e){if(!n.userData.treeNode){n.userData.treeNode={};}var i=null;if(n.userData.treeNode.sid){i=n.userData.treeNode.sid;delete(n.userData.treeNode.sid);}this._resetCurrentScene(e);n.userData.treeNode.sid=c;if(this._nodes){if(i){this._nodes.delete(i);}this._nodes.set(c,n);return true;}return false;};
S.prototype.setAnnotationPersistentId=function(c,e,i){this._resetCurrentScene(i);if(this._annotations){var j=this._annotations.get(c.id);if(j){this._annotations.delete(c.id);j.annotation.id=e;this._annotations.set(e,j);return true;}}return false;};
var J=function(c){var m=new THREE.Matrix4();if(c.length===3){m.setPosition(new THREE.Vector3().fromArray(c));}else if(c.length===12){m.set(c[0],c[3],c[6],c[9],c[1],c[4],c[7],c[10],c[2],c[5],c[8],c[11],0.0,0.0,0.0,1.0);}else if(c.length===16){m.set(c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13],c[2],c[6],c[10],c[14],c[3],c[7],c[11],c[15]);}else{throw"Invalid matrix format";}return m;};var K={r:0.0235,g:0.0235,b:0.0235};var Q={r:0.0602,g:0.0602,b:0.0602};
S.prototype._createTemporaryMaterial=function(m){var c=new M();var e=c.getMaterialRef();e.userData.defaultHighlightingEmissive=K;e.userData.defaultHighlightingSpecular=Q;e.userData.materialUsed=0;e.userData.materialId=m;e.userData.toBeUpdated=true;this._vkScene.setMaterial(m,c);return e;};
S.prototype._getMaterialRef=function(m){var c=this._vkScene.getMaterial(m);return c?c.getMaterialRef():null;};
S.prototype.checkMaterialExists=function(m,c){if(this._getMaterialRef(m)===null){if(c){this._createTemporaryMaterial(m);}return false;}return true;};
S.prototype._attachMaterialClone=function(m,c){T.pushElementIntoMapArray(this._materialClones,m,c);};
S.prototype._addDynamicObject=function(n,c,i){var e=this._rootNode.userData;if(!e._vkDynamicObjects){e._vkDynamicObjects=[];}if(e._vkDynamicObjects.indexOf(n)<0){e._vkDynamicObjects.push(n);}n._vkUpdate=c;if(i){n.userData.is2D=true;}};
S.prototype.createNode=function(n,c){this._resetCurrentScene(c);var e=new THREE.Group();this._nodes.set(n.sid,e);var i;var j=this._jointNodesMap.get(n.sid);if(j&&j.length){for(i=0;i<j.length;i++){j[i].node=e;}}var k=this._jointParentsMap.get(n.sid);if(k&&k.length){for(i=0;i<k.length;i++){k[i].parent=e;}}var l=this._nodes.get(n.parentId);(l||this._rootNode).add(e);var m=e.userData;m.treeNode=n;if(n.closed){m.closed=true;}if(n.selectable===false){m.selectable=false;}if(n.visualisable===false&&n.contentType!=="SYMBOL"){m.skipIt=true;}if(n.metadata){m.metadata=n.metadata;}if(n.veids){m.veids=n.veids;}if(n.sid){m.nodeId=n.sid;}if(n.name){e.name=n.name;}if(n.visible!==undefined){e.visible=!!n.visible;}if(l){var p1;if(m.skipIt||(l.name&&e.name===l.name+" offset geometry")){m.skipIt=true;}else{p1=l;while(p1){if(p1.userData.closed){m.skipIt=true;}p1=p1.parent;}}if(l.userData.symbolContent){m.skipIt=true;m.symbolContent=true;}if(e.visible&&!m.skipIt&&this._contentResource){p1=l;while(p1){p1.visible=true;p1=p1.parent;}}}if(n.renderOrder){e.renderOrder=n.renderOrder;}m.opacity=n.opacity;if(n.transform){e.applyMatrix4(J(n.transform));if(!isFinite(e.quaternion.x)||!isFinite(e.quaternion.y)||!isFinite(e.quaternion.z)||!isFinite(e.quaternion.w)){e.quaternion.set(0,0,0,1);}}e.updateMatrixWorld(true);if(n.transformType){m.transformType=n.transformType;switch(n.transformType){case"ORTHO2D":m.originalTransform={p:e.position.clone(),q:e.quaternion.clone(),s:e.scale.clone()};this._addDynamicObject(e,b.prototype._ortho2DUpdate,true);break;case"BILLBOARD_VIEW":this._addDynamicObject(e,b.prototype._billboardViewUpdate,false);break;case"LOCK_TOVIEWPORT":this._addDynamicObject(e,b.prototype._lockToViewportUpdate,true);break;default:break;}}if(n.materialId){m.materialId=n.materialId;}if(n.geometryType){m.geometryType=n.geometryType;}if(n.meshId){this.setMeshNode(n.sid,n.meshId);}if(n.parametricId){this.setParametricNode(n.sid,n.parametricId,n.visible);}if(e.parent.userData.objectType===v.Hotspot){m.objectType=v.Hotspot;}else if(e.parent.userData.objectType===v.PMI){m.objectType=v.PMI;}else if(n.contentType==="HOTSPOT"){m.objectType=v.Hotspot;}else if(n.contentType==="PMI"){m.objectType=v.PMI;}if(n.contentType==="REFERENCE"){e._vkSetNodeContentType(N.Reference);}else if(n.contentType==="ANNOTATION"){e._vkSetNodeContentType(N.Annotation);}else if(n.contentType==="BACKGROUND"){e._vkSetNodeContentType(N.Background);}else if(n.contentType==="SYMBOL"){e._vkSetNodeContentType(N.Symbol);m.symbolContent=true;}return e;};
S.prototype.removeNode=function(n){this._nodes.delete(n._vkPersistentId());this._annotations.forEach(function(c){if(c.node===n){this._annotations.delete(c.annotation.id);}}.bind(this));};
S.prototype.hasNode=function(n){return this._nodes.has(n._vkPersistentId());};
function W(c,m,l){var e;if(c.isPolyline){var i=new THREE.LineBasicMaterial({color:0xff0000,linewidth:1});if(m){i.color.copy(m.color);}e=new THREE.LineSegments(c,i);}else{e=new THREE.Mesh(c,m);}if(c.isPositionQuantized){Z(e,l.boundingBox);}U.increaseGeometryUsed(c);return e;}
S.prototype.getChildNodeIds=function(n,c,e){this._resetCurrentScene(c);var j=this._nodes.get(n);var k=[];if(!j){return k;}if(j&&j.children){for(var i=0;i<j.children.length;i++){var l=j.children[i];if(l.userData.treeNode&&l.userData.treeNode.sid){k.push(l.userData.treeNode.sid);}else if(e&&l.userData.submeshInfo&&l.userData.submeshInfo.id){k.push(l.userData.submeshInfo.id);}}}return k;};
function X(l){for(var i=0;i<l.length;i++){if(l[i].type==="box"&&l[i].data){return l[i];}}return null;}
function Y(l){if(Array.isArray(l)){for(var i=0;i<l.length;i++){if(l[i].type===undefined||l[i].type==="mesh"||l[i].type==="line"){return l[i];}}}return null;}
function Z(m,c){if(c&&c.length===6){m.position.set((c[3]+c[0])*0.5,(c[4]+c[1])*0.5,(c[5]+c[2])*0.5);m.scale.set(Math.max(c[3]-c[0],Number.EPSILON),Math.max(c[4]-c[1],Number.EPSILON),Math.max(c[5]-c[2],Number.EPSILON));m.updateMatrix();}}
S.prototype.insertSubmesh=function(c,e){var m=this._getMaterialRef(c.materialId)||this._createTemporaryMaterial(c.materialId);var i,j;if(c.lods){var l=Y(c.lods);if(!l){return false;}j=this._geometries.get(l.id);if(j){i=W(j,m,l);if(j.userData&&j.userData.noNormal&&c.materialId){this.updateMaterialForGeometryWithoutNormal(c.materialId);}}else{var k=true;var n=l.boundingBox;if(n&&e){var p1=(n[3]-n[0])/(e[3]-e[0]);var s1=(n[4]-n[1])/(e[4]-e[1]);var t1=(n[5]-n[2])/(e[5]-e[2]);k=p1>this._voxelThreshold||s1>this._voxelThreshold||t1>this._voxelThreshold;}var u1;var v1=k&&X(c.lods);if(v1&&v1.data){var w1=T.base64ToUint8Array(v1.data);var x1=B.unpackSubDividedBoundingBox(w1);u1=x.march(x1);}i=new THREE.Mesh(u1?u1:new THREE.BoxBufferGeometry(1,1,1),m);if(n&&n.length===6){var y1=new THREE.Matrix4();y1.scale(new THREE.Vector3(Math.max(n[3]-n[0],Number.EPSILON),Math.max(n[4]-n[1],Number.EPSILON),Math.max(n[5]-n[2],Number.EPSILON)));y1.setPosition(new THREE.Vector3((n[3]+n[0])*0.5,(n[4]+n[1])*0.5,(n[5]+n[2])*0.5));i.geometry.applyMatrix4(y1);}i.userData.geometryId=l.id;i.userData.lodInfo=l;T.pushElementIntoMapArray(this._geometryMeshes,l.id,c.meshId);}}else{return false;}if(c.transform){i.applyMatrix4(J(c.transform));}i.updateMatrixWorld(true);i.userData.submeshId=c.id;i.userData.initialMaterialId=c.materialId;i.userData.meshId=c.meshId;i.userData.materialId=c.materialId;i.userData.submeshInfo=c;T.pushElementIntoMapArray(this._materialMeshes,c.materialId,c.meshId);T.pushElementIntoMapArray(this._meshSubmeshes,c.meshId,i);var z1=this._meshNodes.get(c.meshId);if(z1){z1.forEach(function(A1){var B1=(i instanceof THREE.Mesh?i._vkClone():i.clone());if(A1.userData.transformType==="ORTHO2D"){B1.position.setScalar(0);B1.scale.setScalar(1);}B1.userData.skipIt=true;B1.renderOrder=A1.renderOrder;if(A1.userData.materialId){G.disposeMaterial(B1.material);B1.material=this._getMaterialRef(A1.userData.materialId)||i.material;B1.userData.materialId=A1.userData.materialId;}if(B1.material&&A1.userData&&A1.userData.geometryType&&(A1.userData.geometryType==="PLANE"||A1.userData.geometryType==="SURFACE")){B1.material.side=THREE.DoubleSide;}A1.add(B1);B1.updateMatrixWorld(true);_(A1,c.materialId,this._materialClones);}.bind(this));}return true;};
function $(c,e,j,m){for(var i=0;i<c.length;i++){var k=c[i];if(e&&k.userData.geometryId===e&&k.geometry!==j){if(k.type==="Mesh"&&!j.isPolyline){if(k.geometry){G.disposeGeometry(k);}k.geometry=j;if(j.isPositionQuantized&&!(k.parent&&k.parent.userData.transformType==="ORTHO2D")){Z(k,k.userData.lodInfo.boundingBox);}k.updateMatrixWorld(true);U.increaseGeometryUsed(j);}else{var n=W(j,k.material,k.userData.lodInfo);n.position.copy(k.position);n.quaternion.copy(k.quaternion);n.scale.copy(k.scale);n.matrix.copy(k.matrix);n.updateMatrixWorld(true);n.userData=k.userData;n.renderOrder=k.renderOrder;n.parent=k.parent;c[i]=n;k.parent=null;}}}}
S.prototype._setSubmeshMaterial=function(c,m,e){U.increaseMaterialUsed(m);c.material=m;c.userData.materialId=e;delete c.userData.originalMaterial;c._vkUpdateMaterialOpacity();if(c.material!==m){T.pushElementIntoMapArray(this._materialClones,e,c.material);}};
S.prototype._updateMaterial=function(n,m,c){n.children.forEach(function(e){if(e.material&&e.userData.materialId===m){this._setSubmeshMaterial(e,c,m);}}.bind(this));};
function _(n,m,c){n.children.forEach(function(e){if(e.material&&(!m||m===e.material.userData.materialId)){var i=e.material;e._vkUpdateMaterialOpacity();if(e.material!==i){T.pushElementIntoMapArray(c,e.material.userData.materialId,e.material);}}});}
function a1(c,e){var n=new Float32Array(c.length);var l=new THREE.Vector3();var m=new THREE.Vector3();var p2=new THREE.Vector3();var p1=new THREE.Vector3();var i,s1;for(i=0,s1=e.length;i<s1;i+=3){var pi=[e[i]*3,e[i+1]*3,e[i+2]*3];l.fromArray(c,pi[0]);m.fromArray(c,pi[1]).sub(l);p2.fromArray(c,pi[2]).sub(l);p1.crossVectors(m,p2).normalize();for(var j=0;j<3;j++){var k=pi[j];n[k]+=p1.x;n[k+1]+=p1.y;n[k+2]+=p1.z;}}for(i=0,s1=n.length;i<s1;i+=3){p1.fromArray(n,i).normalize().toArray(n,i);}return n;}
S.prototype.setGeometry=function(c){var e=new THREE.BufferGeometry();var i=c.data;var j=new THREE.BufferAttribute(new Uint16Array(i.indices),1);var k=new THREE.BufferAttribute(new Float32Array(i.points),3);e.setIndex(j);e.setAttribute("position",k);if(!c.isPolyline){if(!i.normals||i.normals.length!==k.array){i.normals=a1(k.array,j.array);}var n=new THREE.BufferAttribute(new Float32Array(i.normals),3);e.setAttribute("normal",n);if(i.uvs&&i.uvs.length*3===i.points.length*2){e.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(c.data.uvs),2));}}else{e.isPolyline=true;}e.computeBoundingBox();e.computeBoundingSphere();e.isPositionQuantized=c.isPositionQuantized;e.userData.geometryId=c.id;e.userData.geometryUsed=0;this._geometries.set(c.id,e);var m=this._geometryMeshes.get(c.id);if(m){for(var l=0;l<m.length;l++){var p1=m[l];var s1=this._meshNodes.get(p1);if(s1){for(var ni=0;ni<s1.length;ni++){$(s1[ni].children,c.id,e);}}var u1=this._meshSubmeshes.get(p1);if(u1){$(u1,c.id,e);}}}if(this._fireSceneUpdated){this._fireSceneUpdated();}return this;};
S.prototype.setMeshNode=function(n,m){var c=this._nodes.get(n);if(c){T.pushElementIntoMapArray(this._meshNodes,m,c);var e=this._meshSubmeshes.get(m);if(e){e.forEach(function(i){var j=(i instanceof THREE.Mesh?i._vkClone():i.clone());if(c.userData.transformType==="ORTHO2D"){j.position.setScalar(0);j.scale.setScalar(1);}j.userData.skipIt=true;j.renderOrder=c.renderOrder;if(c.userData.materialId){G.disposeMaterial(j.material);j.material=this._getMaterialRef(c.userData.materialId)||i.material;j.userData.materialId=c.userData.materialId;}c.add(j);}.bind(this));_(c,null,this._materialClones);}}};
S.prototype.setParametricNode=function(n,c,e){var i=this._nodes.get(n);if(i){i.userData.parametricVisible=e!==undefined?e:true;}};
S.prototype.progress=function(c){L.log("reading progress:",c);};
S.prototype.loadingFinished=function(i){if(this._fireLoadingFinished){this._fireLoadingFinished(i);}};
S.prototype.getGeometry=function(c){return this._geometries.get(c);};
var b1={rect:g.RectangularShape,circle:g.CircularShape,none:g.None,textGlow:g.TextGlow};var c1={none:h.None,solid:h.Solid,dash:h.Dash,dot:h.Dot,dashdot:h.DashDot,dashdotdot:h.DashDotDot};var d1={left:o.Left,center:o.Center,right:o.Right};var e1={none:p.None,point:p.Point,arrow:p.Arrow};var f1=new THREE.Color();
function g1(c){var m=new THREE.Matrix4();var e=new THREE.Matrix4();var n=c;while(n&&n.userData.originalTransform){H(n.userData.transformType==="ORTHO2D");var i=n.userData.originalTransform;m.compose(i.p,i.q,i.s);e.premultiply(m);n=n.parent;}e.decompose(c.position,c.quaternion,c.scale);}
S.prototype.createAnnotation=function(c,e){this._resetCurrentScene(e);var n=this._nodes.get(c.nodeId);if(!n){L.warning("Annotation node not found",c);return;}if(n.userData.originalTransform){g1(n);}var i=c.type;if(i===undefined){this.createLegacyAnnotation(c,n);return;}if(i==="html"){c.id=c.id||F();var j=[];if(c.leaderLines){c.leaderLines.forEach(function(x1){if(x1.start&&x1.start.sid){j.push(this._nodes.get(x1.start.sid));}},this);}this._annotations.set(c.id,{annotation:c,node:n,attachment:(c.attachment&&c.attachment.sid)?this._nodes.get(c.attachment.sid):null,targetNodes:j});return;}var l=c.label||{};var k=c.text||{};var m=l.colour||[1,1,1,1];var p1=l.borderColour||[0,0,0,1];var s1={node:n,renderOrder:n.renderOrder||0,style:b1[l.shape]||g.RectangularShape,width:l.width||64,height:l.height||64,backgroundColor:f1.fromArray(m).getStyle(),backgroundOpacity:m[3],borderColor:f1.fromArray(p1).getStyle(),borderOpacity:p1[3],borderWidth:l.borderColour?(l.borderWidth||0):0,borderLineStyle:c1[l.borderLineStyle]||h.Solid,horizontalAlignment:d1[k.align]};if(k.html){s1.encoding=f.HtmlText;s1.text=k.html;}else{s1.encoding=f.PlainText;s1.text=k.text;s1.font=k.fontFace||"Arial";s1.fontSize=Math.abs(k.fontSize)||16;s1.fontWeight=Math.min(k.fontWeight,900);s1.fontItalic=k.fontItalic;s1.textColor=f1.fromArray(k.colour||[0,0,0]).getStyle();}if(i==="text"){var t1=n.position;s1.position=new THREE.Vector3(t1.x*2,t1.y*2,t1.z);var u1=new b(s1);u1.setText(s1.text);this._addDynamicObject(n,u1._update.bind(u1),true);}else if(i==="note"){var v1=c.attachment||{};s1.position=new THREE.Vector3().fromArray(v1.position||[0,0,0]);s1.anchorNode=this._nodes.get(v1.sid)||this._rootNode;s1.depthTest=false;var w1=new C(s1);w1.setText(s1.text);this._callouts.set(c.id,w1);this._addDynamicObject(n,w1._update.bind(w1),false);}else{L.warning("Unsupported annotation type",c);}};
var h1=[g.RectangularShape,g.CircularShape,g.None,g.TextGlow];var i1=[d.Viewport,d.Screen,d.World];var j1=[h.None,h.Solid,h.Dash,h.Dot,h.DashDot,h.DashDotDot];var k1=[p.None,p.Point,p.Arrow];var l1=[o.Left,o.Center,o.Right];
function m1(c){var e=c.toString(16);if(c.length>=3){e=(((c[0]*255)<<16)|((c[1]*255)<<8)|(c[2]*255)).toString(16);}return"#"+"000000".substring(e.length)+e;}
function n1(c){if(!c){return false;}for(var i=0,l=c.length;i<l;i++){if(!isFinite(c[i])){return false;}}return true;}
S.prototype.createLegacyAnnotation=function(c,n){var e=c.position;if(!n1(e)){L.warning("Incorrect annotation position",c);return;}c.coordinateSpace|=0;var i=c.backgroundOpacity;if(!i){i=c.backgroundColour?c.backgroundColour[3]:0;}var j=c.borderOpacity;if(!j){j=c.borderColour?c.borderColour[3]:0;}var k={node:n,coordinateSpace:i1[c.coordinateSpace],style:h1[c.shape||0],width:c.width,height:c.height,backgroundColor:c.backgroundColour?m1(c.backgroundColour):"#fff",backgroundOpacity:i,borderColor:c.borderColour?m1(c.borderColour):"#000",borderOpacity:j,borderWidth:c.borderWidth,borderLineStyle:j1[c.borderLineStyle]};if(c.encoding!==undefined){k.encoding=c.encoding?f.HtmlText:f.PlainText;k.font=c.font;k.fontSize=c.fontSize;k.fontWeight=Math.min(c.fontWeight,900);k.fontItalic=c.fontItalic;k.textColor=m1(c.textColor);k.link=c.link;k.horizontalAlignment=l1[c.textHorizontalAlignment];k.position=new THREE.Vector3().fromArray(e);}else if(c.fontFace){k.encoding=f.PlainText;k.font=c.fontFace;k.fontSize=Math.abs(c.fontSize);k.fontWeight=Math.min(c.fontWeight,900);k.textColor=m1(c.textColour);}else{k.encoding=f.HtmlText;}if(c.coordinateSpace<2){if(!k.positions){k.position=new THREE.Vector3(e[0]*2-1,e[1]*-2+1,e[2]);}k.renderOrder=(c.order|0)+1000;var l=new b(k);l.setText(c.text);this._addDynamicObject(n,l._update.bind(l),true);}else{k.anchorNode=this._nodes.get(c.sid)||this._rootNode;if(!k.postion){k.position=new THREE.Vector3().fromArray(e);}k.depthTest=false;k.renderOrder=c.order|0;if(c.alwaysOnTop){k.renderOrder=1;}var m=new C(k);m.setText(c.text);this._callouts.set(c.id,m);this._addDynamicObject(n,m._update.bind(m),false);}};
S.prototype.createImageNote=function(c,e){this._resetCurrentScene(e);var n=this._nodes.get(c.nodeId);if(!n){L.warning("Image annotation node not found",c);return;}if(n.userData.originalTransform){g1(n);}if(c.type==="image"){var l=c.label||{};var m=this._getMaterialRef(l.materialId);if(!m){L.warning("Image annotation material not found",c);return;}var i=new b({node:n,renderOrder:n.renderOrder||0,coordinateSpace:d.Screen,position:new THREE.Vector3(n.position.x,n.position.y,0),width:(l.width||200)*n.scale.x*0.5,height:(l.height||200)*n.scale.y*0.5});i.setMaterial(m);if(n.userData.transformType!=="BILLBOARD_VIEW"){n.position.setScalar(0);n.scale.setScalar(1);this._addDynamicObject(n,i._update.bind(i),true);}}else{this.createLegacyImageNote(c,n);}};
S.prototype.createLegacyImageNote=function(c,n){var e=new THREE.Vector3().fromArray(c.position);var i=c.width;var j=c.height;if(!c.properlyAligned){e.x+=c.width*0.5;e.y+=c.height*0.5;e.applyMatrix4(n.matrix);i=c.width*0.5*n.matrix.elements[0];j=c.height*0.5*n.matrix.elements[5];}var k=new b({node:n,coordinateSpace:d.Screen,renderOrder:(c.order|0)+1000,position:e,width:i,height:j});var m=this._getMaterialRef(c.labelMaterialId);k.setMaterial(m);this._addDynamicObject(n,k._update.bind(k),true);};
S.prototype.insertLeaderLine=function(c,e){this._resetCurrentScene(e);var j=this._callouts.get(c.annotationId);if(j){var m=this._getMaterialRef(c.materialId);if(!m){L.warning("Leader line material not found",c);return;}var k=[];var n=c.points;for(var i=0,l=n.length;i<l;i++){k.push(new THREE.Vector3().fromArray(n[i]));}var p1;if(c.start){var s1=c.start||{};var t1=c.end||{};var u1=c.extension||{};p1=this._nodes.get(c.start.sid)||this._rootNode;j.addLeaderLine(k,p1,m,e1[s1.style]||p.None,e1[t1.style]||p.None,s1.size,u1.length||0);}else{p1=this._nodes.get(c.startPointSid)||this._rootNode;j.addLeaderLine(k,p1,m,k1[c.startPointHeadStyle],k1[c.endPointHeadStyle],c.pointHeadConstant,c.extensionLength);}}};
S.prototype._findDetailViewNodes=function(n){var c=[];if(n){n.forEach(function(e){var i=this._nodes.get(e);if(i){c.push(i);}else{L.warning("Unknown detailView node reference",e);}}.bind(this));}return c;};
S.prototype.createDetailView=function(i,c){this._resetCurrentScene(c);var n=this._nodes.get(i.nodeId);if(!n){L.warning("Detail view node not found",i);return;}var l=i.label;if(!l){this.createLegacyDetailView(i,n);return;}var e=i.attachment;var j={name:i.name,camera:l.camera?this.createCamera(l.camera):null,type:i.cutaway?q.Cutaway:q.DetailView,borderWidth:l.borderWidth||0,backgroundColor:f1.fromArray(l.colour||[1,1,1]).getStyle(),borderColor:f1.fromArray(l.borderColour||[1,1,1]).getStyle(),origin:new THREE.Vector2(n.position.x*2-1+n.scale.x,n.position.y*-2+1-n.scale.x),size:new THREE.Vector2(n.scale.x,n.scale.y),attachmentPoint:new THREE.Vector3().fromArray(e.position||[0,0,0]),veId:i.veid,visibleNodes:this._findDetailViewNodes(i.visibleNodes),targetNodes:this._findDetailViewNodes(i.targetNodes)};if(l.shape==="rect"){j.shape=!l.leaderStyle||l.leaderStyle==="none"?r.Box:r.BoxLine;}else{j.shape={none:r.Circle,line:r.CircleLine,pointer:r.CirclePointer,arrow:r.CircleArrow,bubbles:r.CircleBubbles}[l.leaderStyle]||r.Circle;}var k=new D(j);if(!this._rootNode.userData._vkDetailViews){this._rootNode.userData._vkDetailViews=[];}this._rootNode.userData._vkDetailViews.push({detailView:k,node:n,renderOrder:i.renderOrder||n.renderOrder||0});};
S.prototype.createLegacyDetailView=function(i,n){if(!i.properlyAligned){if(!i.shape){i.shape=i.leaderStyle?r.BoxLine:r.Box;}else{i.shape=[r.Circle,r.CircleLine,r.CirclePointer,r.CircleArrow,r.CircleBubbles][i.leaderStyle||0];}i.type=i.cutaway?q.Cutaway:q.DetailView;i.camera=i.camera?this.createCamera(i.camera):null;i.origin=new THREE.Vector2(n.position.x*2-1+n.scale.x,n.position.y*-2+1-n.scale.x);i.size=new THREE.Vector2(n.scale.x,n.scale.y);i.renderOrder=n.renderOrder;}else{i.type=[q.DetailView,q.Cutaway][i.type];i.shape=[r.Box,r.Circle,r.CircleLine,r.CirclePointer,r.CircleArrow,r.CircleBubbles,r.BoxLine,r.BoxNoOutline,r.SolidPointer,r.SolidArrow][i.shape];i.camera=this._cameras.get(i.cameraId);i.origin=new THREE.Vector2().fromArray(i.origin);i.size=new THREE.Vector2().fromArray(i.size);}var c=new D({name:i.name,camera:i.camera,type:i.type,shape:i.shape,borderWidth:i.borderWidth||0,backgroundColor:i.backgroundColour?m1(i.backgroundColour):"#fff",borderColor:i.borderColour?m1(i.borderColour):"#000",origin:i.origin,size:i.size,attachmentPoint:new THREE.Vector3().fromArray(i.attachment),metadata:i.metadata,veId:i.veid,visibleNodes:this._findDetailViewNodes(i.visibleNodes),targetNodes:this._findDetailViewNodes(i.targetNodes)});if(!this._rootNode.userData._vkDetailViews){this._rootNode.userData._vkDetailViews=[];}this._rootNode.userData._vkDetailViews.push({detailView:c,node:n,renderOrder:i.renderOrder||0});};
S.prototype.insertThrustline=function(i){var n=this._nodes.get(i.thrustlineId);if(n&&!this._thrustlines.get(i.thrustlineId)){var c=new a({node:n,principleAxis:new THREE.Vector3().fromArray(i.principleAxis),material:this._getMaterialRef(i.materialId)});var e=[];var j=0;var k=0;var l=0;for(var m=0;m<i.itemCount;m++){var p1={};p1.target=this._nodes.get(i.targets[m]);p1.majorAxisIndex=i.itemMajorAxisesIndices[m];var bi;p1.basisAxises=[];l=j+i.itemBasisAxisesCounts[m];for(bi=j;bi<l;bi++){var s1={};s1.x=i.itemBasisAxisesCoordinates[bi*3];s1.y=i.itemBasisAxisesCoordinates[bi*3+1];s1.z=i.itemBasisAxisesCoordinates[bi*3+2];p1.basisAxises.push(s1);}j=l;p1.dimension={};p1.dimension.x=i.itemDimensionsCoordinates[m*3];p1.dimension.y=i.itemDimensionsCoordinates[m*3+1];p1.dimension.z=i.itemDimensionsCoordinates[m*3+2];p1.center={};p1.center.x=i.itemCentersCoordinates[m*3];p1.center.y=i.itemCentersCoordinates[m*3+1];p1.center.z=i.itemCentersCoordinates[m*3+2];p1.boundPoints=[];l=k+i.itemBoundPointsCounts[m];for(bi=k;bi<l;bi++){var t1={};t1.x=i.itemBoundPointsCoordinates[bi*3];t1.y=i.itemBoundPointsCoordinates[bi*3+1];t1.z=i.itemBoundPointsCoordinates[bi*3+2];p1.boundPoints.push(t1);}k=l;e.push(p1);}c.setItems(e);var u1=0;var v1=[];for(var si=0;si<i.segmentCount;si++){var x1={};x1.startItemIndex=i.segmentsStartItemIndices[si];x1.endItemIndex=i.segmentsEndItemIndices[si];x1.startBoundIndex=i.segmentsStartBoundIndices[si];x1.endBoundIndex=i.segmentsEndBoundIndices[si];x1.ratios=[];l=u1+i.segmentRatioCounts[si];for(var ri=0;ri<l;ri++){var z1={};z1.x=i.segmentRatiosCoordinates[ri*2];z1.y=i.segmentRatiosCoordinates[ri*2+1];x1.ratios.push(z1);}u1=l;v1.push(x1);}c.setSegments(v1);this._thrustlines.set(i.thrustlineId,c);this._addDynamicObject(n,c._update.bind(c),false);}};
S.prototype.updateViewsForReplacedNodes=function(n){var c=new Map();n.forEach(function(j){var k=this._nodes.get(j.sid);if(k){c.set(j.sid,k);}},this);function e(j,c){var n=j.getNodeInfos();n.forEach(function(k){var l=k.target;if(l&&l.userData&&l.userData.treeNode&&l.userData.treeNode.sid){var m=c.get(l.userData.treeNode.sid);if(m){k.target=m;m.updateMatrixWorld();}}});}function i(j,c){var k;var l=j.getPlaybacks();for(var m=0;m<l.length;m++){var p1=l[m];var s1=p1.getSequence();if(s1){var t1=false;var u1=s1.getNodeAnimation();for(var ni=0;ni<u1.length;ni++){var w1=u1[ni];var x1=w1.nodeRef;if(x1&&x1.userData&&x1.userData.treeNode&&x1.userData.treeNode.sid){k=c.get(x1.userData.treeNode.sid);if(k){s1.removeNodeAnimation(x1,null,true);for(var y1 in w1){if(y1==="nodeRef"){continue;}s1.setNodeAnimation(k,y1,w1[y1],true);}t1=true;}}}var z1=s1.getJoint();for(var ji=0;z1&&ji<z1.length;ji++){var B1=z1[ji];if(B1.parentSid){k=c.get(B1.parentSid);if(k){B1.parent=k;t1=true;}}if(B1.nodeSid){k=c.get(B1.nodeSid);if(k){B1.node=k;t1=true;}}}if(t1){s1._fireSequenceChanged();}}}n.forEach(function(v1){var A1=v1.target;if(A1&&A1.userData&&A1.userData.treeNode&&A1.userData.treeNode.sid){var k=c.get(A1.userData.treeNode.sid);if(k){v1.target=k;k.updateMatrixWorld();}}});}this._views.forEach(function(j,k){e(j,c);i(j,c);});};
S.prototype._decrementResourceCounters=function(c){c.traverse(function(e){if(e.isMesh){U.decreaseMaterialUsed(e.material);U.decreaseGeometryUsed(e.geometry);}});};
S.prototype.decrementResourceCountersForDeletedTreeNode=function(n,c){this._resetCurrentScene(c);var e=this;n=[].concat(n);n.forEach(function(i){var j=e._nodes.get(i);if(j){e._decrementResourceCounters(j);e._nodes.delete(i);}});return this;};
S.prototype.remove=function(n,c){this._resetCurrentScene(c);var e=this;n=[].concat(n);n.forEach(function(j){var k=e._nodes.get(j);if(k){e._decrementResourceCounters(k);if(k.parent){k.parent.remove(k);}e._nodes.delete(j);for(var i=0;i<k.children.length;i++){var l=k.children[i];if(l.userData&&l.userData.treeNode&&l.userData.treeNode.sid){e.remove(l.userData.treeNode.sid,c);}}}});return this;};
S.prototype.resourcesCleanUp=function(){var c=this._geometries;c.forEach(function(e){var i=e.userData.geometryUsed;if(i<=0){e.dispose();}});return this;};
S.prototype.createCamera=function(c,e){this._resetCurrentScene(e);var n=c.near||1;var i=c.far||200000;if(c.origin.length===3&&c.origin[0]===0&&c.origin[1]===0&&c.origin[2]===0){c.ortho=false;c.rotate=true;}var j;if(c.ortho){j=new THREE.OrthographicCamera(-1,1,1,-1,n,i);j.zoom=c.zoom||-1;}else{j=new THREE.PerspectiveCamera(THREE.Math.radToDeg(c.fov),1,n,i);}if(c.origin){j.position.fromArray(c.origin);}if(c.up){j.up.fromArray(c.up);if(c.notUseDirectionVector){j.up.sub(j.position);}j.up.normalize();}if(c.rotate){j.userData.rotate=c.rotate;j.up.set(0,1,0);}if(c.target){var k=new THREE.Vector3().fromArray(c.target);if(!c.notUseDirectionVector){k.add(j.position);}j.lookAt(k);}this._rootNode.userData.camera=j;var l=null;if(j.isOrthographicCamera){l=new O();}else if(j.isPerspectiveCamera){l=new P();}l.setCameraRef(j);l.setUsingDefaultClipPlanes(true);var m=c.id;if(m){this._cameras.set(m,l);}this._rootNode.userData.camera=l;return l;};
S.prototype.insertCamera=function(n,c,e){this._resetCurrentScene(e);var i=this._nodes.get(n);var j=this._cameras.get(c);if(i&&j){(i||this._rootNode).add(j.parent?j.clone():j);}return this;};
S.prototype.getCamera=function(c){return this._cameras.get(c);};
S.prototype.updateMaterialForGeometryWithoutNormal=function(m){var c=this._getMaterialRef(m);if(c&&c.emissive){c.emissive.copy(c.color);c.side=THREE.DoubleSide;}return this;};
S.prototype.createMaterial=function(m){var c=[];var e=m.id;var i=this._getMaterialRef(e);if(m.lineWidth>0){if(!i||!i.isLineBasicMaterial){var j=new M(true);i=j.getMaterialRef();this._vkScene.setMaterial(e,j);}i.color=new THREE.Color(m.lineColour[0],m.lineColour[1],m.lineColour[2]);i.linewidth=m.lineWidth;i.userData.lineStyle={width:m.lineWidth,haloWidth:m.lineHaloWidth||0,endCapStyle:m.lineEndRound?1:0,dashPattern:m.lineDashPattern||[],dashPatternScale:m.lineDashPatternScale,widthCoordinateSpace:m.lineWidthCoordinateSpace};i.userData.materialInfo=m;i.userData.materialId=e;return c;}if(!i){i=this._createTemporaryMaterial(e);}delete i.userData.toBeUpdated;i.userData.materialInfo=m;if(m.diffuseColour){i.color.fromArray(m.diffuseColour);}if(m.specularColour){i.specular.fromArray(m.specularColour);}var k=true;if(m.emissiveColour){i.emissive.fromArray(m.emissiveColour);if(i.emissive.r!==0||i.emissive.g!==0||i.emissive.b!==0){k=false;i.depthFunc=THREE.LessDepth;}}if(k&&m.ambientColour){i.emissive.fromArray(m.ambientColour);i.emissive.multiplyScalar(0.2);}if(i.opacity!==undefined){i.opacity=m.opacity;i.transparent=m.opacity<0.99;if(i.transparent){i.side=THREE.DoubleSide;}}var l=i.glossiness?i.glossiness:0;var n=i.specularLevel?i.specularLevel:0;i.shininess=l*2+n*3;i.userData.defaultHighlightingEmissive=K;i.userData.defaultHighlightingSpecular=Q;c=this.updateTextureMaps(e);if(c.length>0){i.userData.imageIdsToLoad=new Set();for(var ti=0;ti<c.length;ti++){var p1=c[ti];T.pushElementIntoMapArray(this._imageTextures,p1.imageId,{textureType:p1.textureType,materialId:e});i.userData.imageIdsToLoad.add(p1.imageId);}}var s1=this._materialMeshes.get(e);if(s1){for(var mi=0;mi<s1.length;mi++){var u1=s1[mi];var v1=this._meshNodes.get(u1);if(v1){for(var ni=0;ni<v1.length;ni++){this._updateMaterial(v1[ni],e,i);}}}}return c;};
S.prototype.getMaterial=function(m){return this._getMaterialRef(m);};
var o1=function(c){var i="";try{var j=0x8000;var k=0;var l=c.length;var m;while(k<l){m=c.slice(k,Math.min(k+j,l));i+=String.fromCharCode.apply(null,m);k+=j;}}catch(e){i="";}return i;};
S.prototype.createImage=function(c){if(c.binaryData.length<32){L.warning("SceneBuilder.createImage()","Can't create image from empty data");return this;}var e=new DataView(c.binaryData.buffer);var j=true;if(e.getUint8(0,true)===parseInt("0xFF",16)&&e.getUint8(1,true)===parseInt("0xD8",16)){j=false;}var k=o1(c.binaryData);var l="data:image/"+(j?"png":"jpeg")+";base64,"+btoa(k);this._images.set(c.id,l);var m=this._imageTextures.get(c.id);if(m){this._imageTextures.delete(c.id);for(var i=0;i<m.length;i++){var n=m[i];this.updateTextureMap(n.materialId,n.textureType);}}return this;};
var q1=new THREE.TextureLoader();var r1={Diffuse:0,Bump:1,Opacity:2,Reflection:3,Refraction:4,Specular:5,Ambient:6,Emissive:7,SpecularLevel:8,Glosiness:9,AmbientOcclusion:10,Decal:11};
S.prototype.updateTextureMaps=function(m){var c=[];var e=this._getMaterialRef(m);if(!e){return c;}var i=e.userData.materialInfo;if(!i){return c;}if(i.textureDiffuse){var j=this.updateTextureMap(m,r1.Diffuse);if(j.imageId){c.push(j);}}else if(i.textureDecal){var k=this.updateTextureMap(m,r1.Decal);if(k.imageId){c.push(k);}}if(i.textureBump){var l=this.updateTextureMap(m,r1.Bump);if(l.imageId){c.push(l);}}if(i.textureOpacity){var n=this.updateTextureMap(m,r1.Opacity);if(n.imageId){c.push(n);}}if(i.textureEmissive){var p1=this.updateTextureMap(m,r1.Emissive);if(p1.imageId){e.emissive.setRGB(1,1,1);c.push(p1);}}if(i.textureAmbientOcclusion){var s1=this.updateTextureMap(m,r1.AmbientOcclusion);if(s1.imageId){c.push(s1);}}if(i.textureReflection){var t1=this.updateTextureMap(m,r1.Reflection);if(t1.imageId){c.push(t1);}}return c;};
S.prototype.updateTextureMap=function(c,e){var i={textureType:e,imageId:null};var j=this._getMaterialRef(c);if(!j){return i;}var k=j.userData.materialInfo;if(!k){return i;}var l=null;switch(e){case r1.Diffuse:l=k.textureDiffuse;break;case r1.Decal:l=k.textureDecal;break;case r1.Bump:l=k.textureBump;break;case r1.Opacity:l=k.textureOpacity;break;case r1.Reflection:l=k.textureReflection;break;case r1.Emissive:l=k.textureEmissive;break;case r1.AmbientOcclusion:l=k.textureAmbientOcclusion;break;default:break;}if(!l){return i;}var n=l[0]||l;var p1=this._images.get(n.imageId);if(!p1){i.imageId=n.imageId;return i;}if(j.userData.imageIdsToLoad){j.userData.imageIdsToLoad.delete(n.imageId);if(j.userData.imageIdsToLoad.size===0){delete j.userData.imageIdsToLoad;}}if(j.userData.parametricType==="sphere"){n.uvHorizontalScale=-1;}var s1=n.influence!==undefined?n.influence:0;function t1(m,u1){switch(e){case r1.Diffuse:case r1.Decal:m.map=u1;m.transparent|=p1.startsWith("data:image/png");break;case r1.Bump:m.bumpMap=u1;m.bumpScale=s1;break;case r1.Opacity:m.alphaMap=u1;break;case r1.Reflection:u1.mapping=THREE.EquirectangularReflectionMapping;m.envMap=u1;m.combine=THREE.AddOperation;m.reflectivity=s1;break;case r1.Emissive:m.emissiveMap=u1;break;case r1.AmbientOcclusion:m.aoMap=u1;break;default:}m.needsUpdate=true;}q1.load(p1,function(m){m.wrapS=n.uvHorizontalTilingEnabled?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;m.wrapT=n.uvVerticalTilingEnabled?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;m.magFilter=n.filterMode===1?THREE.NearestFilter:THREE.LinearFilter;m.minFilter=n.filterMode===1?THREE.NearestFilter:THREE.LinearMipMapLinearFilter;m.anisotropy=4;var u1=n.uvHorizontalOffset||0;var v1=n.uvVerticalOffset||0;m.repeat.set(n.uvHorizontalScale||1,n.uvVerticalScale||1);m.center.set(-u1,-v1);m.offset.set(u1,v1);m.rotation=-n.uvRotationAngle;t1(j,m);var w1=this._materialClones.get(c);if(w1){w1.forEach(function(x1){t1(x1,m);});}if(this._fireSceneUpdated){this._fireSceneUpdated();}}.bind(this));return i;};
S.prototype.insertPlayback=function(c,e,i){this._resetCurrentScene(i);var j=this._vkScene.findSequence(c.sequenceId);var k=new s(c.id,{sequence:j,timeScale:c.speed?1.0/c.speed:1,preDelay:c.preDelay?c.preDelay:0,postDelay:c.postDelay?c.postDelay:0,repeats:c.repeat?Math.abs(c.repeat):0,reversed:c.reversed?true:false,startTime:c.start?c.start:0});var l=this._views.get(e);if(l){l.addPlayback(k);}if(!j){T.pushElementIntoMapArray(this._sequenceIdToPlaybacks,c.sequenceId,k);}return this;};
S.prototype.insertSequence=function(i,c){var e=this._vkScene.findSequence(i.id);if(e){return this;}var j;if(i.endTime){if(i.startTime){j=i.endTime-i.startTime;}else{j=i.endTime;}}else{j=1.0;}e=this._vkScene.createSequence(i.id,{name:i.name,duration:j});if(Array.isArray(i.joints)){i.joints.forEach(function(p1){var s1=this._joints[p1];if(s1){e.setJoint(s1,true);}}.bind(this));}if(i.nodes&&i.nodes.length>0){for(var n=0;n<i.nodes.length;n++){var k=i.nodes[n];if(k.empty){k.type=k.binding;var l=this._nodes.get(k.sid);this._animationHelper.insertEmptyTrack(k,e,l,this._vkScene);continue;}T.pushElementIntoMapArray(this._trackIdSequenceNodeMap,k.trackId,{sequenceId:i.id,targetId:k.sid,type:k.binding,pivot:k.pivot,isAbsoluteValue:k.isAbsoluteValue});}}var m=this._sequenceIdToPlaybacks.get(i.id);if(m){m.forEach(function(p1){p1.setSequence(e);});}return this;};
S.prototype.insertTracks=function(c){this._animationHelper.insertTracks(c,this._trackIdSequenceNodeMap,this._nodes,this._vkScene);return this;};
S.prototype.insertJoints=function(j,c){this._resetCurrentScene(c);this._joints=[];j.forEach(function(e){var n=this._nodes.get(e.childSid);var i=this._nodes.get(e.parentSid);var k={id:e.id,node:n,parent:i,translation:new Float32Array(e.t?e.t:[0,0,0]),quaternion:new Float32Array(e.q?e.q:[0,0,0,1]),scale:new Float32Array(e.s?e.s:[1,1,1])};if(!n){var l=this._jointNodesMap.get(e.childSid);if(!l){l=[];}l.push(k);this._jointNodesMap.set(e.childSid,l);}if(!i){var m=this._jointParentsMap.get(e.parentSid);if(!m){m=[];}m.push(k);this._jointParentsMap.set(e.parentSid,m);}this._joints.push(k);}.bind(this));return this;};
S.prototype.finalizeAnimation=function(){var c=this._rootNode;if(c){while(c.parent){c=c.parent;}c.userData.tracks=this._tracks;}return this;};
S.prototype.finalizePlaybacks=function(){var c=this._rootNode;if(c){while(c.parent){c=c.parent;}}else{return this;}if(!c.userData.animationNodeOriginalData){c.userData.animationNodeOriginalData=new Map();}var e;var i=this._viewGroups.entries();var n=i.next();while(!n.done){e=n.value[1];n=i.next();var j=[];for(var k=0;k<e.getViews().length;k++){if(e.getViews()[k].id){var l=this._views.get(e.getViews()[k].id);if(l){j.push(l);}}}}return this;};
S.prototype.finalizeViewGroups=function(c){this._resetCurrentScene(c);var e=this._viewGroups.entries();var n=e.next();while(!n.done){var i=n.value[1];var j=n.value[0];if(!i||!i.views||!i.views.length){n=e.next();continue;}i.removeViews();for(var k=0;k<i.views.length;k++){var l=i.views[k].id;var m=this._views.get(l);if(m&&m.userData.viewInfo.thumbnailId&&!m.thumbnailData){var p1=this._images.get(m.userData.viewInfo.thumbnailId);if(p1){m.thumbnailData=p1;}}if(m){m.viewGroupId=j;i.addView(m);}}n=e.next();}return this;};
S.prototype.insertViewGroup=function(i,c){this._resetCurrentScene(c);var e=this._viewGroups.get(i.id);if(!e){e=this._vkScene.createViewGroup({viewGroupId:i.id,name:i.name,description:i.description});this._viewGroups.set(i.id,e);}else{e.setViewGroupId(i.id);e.setName(i.name);e.setDescription(i.description);}e.type=i.type;e.metadata=i.metadata;e.veids=i.veids;e.views=i.views;e.sceneId=i.sceneId;return this;};
S.prototype.getViewGroup=function(c,e){this._resetCurrentScene(e);var i=this._viewGroups.get(c);var j=[];if(i&&i.views){for(var k=0;k<i.views.length;k++){var l=i.views[k].id;var m=this._views.get(l);if(m){j.push(m);}}}return j;};
S.prototype.insertView=function(c,e){this._resetCurrentScene(e);if(c.description){var i=new RegExp("^<[^>]*?>");if(i.test(c.description)){var j=new RegExp("(^(<[^>]*?>\s*)+)|((<[^>]*?>\s*)+$)","g");var k=c.description.replace(j,"");if(!k){c.description=k;}}}var l=this._vkScene.createView({viewId:c.viewId,name:c.name,description:c.description?"<pre style=\"white-space: pre-wrap;\">"+c.description+"</pre>":c.description,aspectRatio:c.safeAreaAspectRatio});l.userData={};l.userData.viewInfo=c;if(c.thumbnailId){var m=this._images.get(c.thumbnailId);if(m){l.thumbnailData=m;}else{this._viewThumbnails.set(c.thumbnailId,l);}}if(c.animatedThumbnailId){var n=this._images.get(c.animatedThumbnailId);if(n){l.animatedThumbnailData=n;l.tileWidth=this._imageIdsAndTileWidths.get(c.animatedThumbnailId);}}if(c.cameraId){l.setCamera(this._cameras.get(c.cameraId));}l.type=c.type;l.flyToTime=c.flyToTime;l.preDelay=c.preDelay;l.postDelay=c.postDelay;l.navigationMode=c.navigationMode;l.topColor=c.topColour;l.bottomColor=c.bottomColour;l.renderMode=I[c.renderMethod];l.dimension=c.dimension;l.query=c.query;l.metadata=c.metadata;l.veids=c.veids;l.viewGroupId=c.viewGroupId;l.id=c.viewId;this._views.set(c.viewId,l);if(l.viewGroupId){var p1=this._viewGroups.get(l.viewGroupId);if(p1){p1.addView(l);}}return this;};
S.prototype.setModelViewVisibilitySet=function(i){var c=this._views.get(i.viewId);var e=new Set();var j=[];i.visibleNodes.forEach(function(n){var k=this._nodes.get(n);if(k){e.add(k);j.push({target:k,visible:true});}else{L.warning("Unknown modelView visible node reference",n);}}.bind(this));Array.from(e).forEach(function(n){n=n.parent;while(n&&!e.has(n)){e.add(n);j.push({target:n,visible:true});n=n.parent;}});c.updateNodeInfos(j);};
S.prototype.recordHighlightedNodeInView=function(c,n,e,i){this._resetCurrentScene(i);var j=this._views.get(e);if(!j){return this;}var k=this._nodes.get(n);if(!k){return this;}j.addHighlightedNodes(c,k);return this;};
S.prototype.insertHighlightStyle=function(i){var c=this._vkScene.getHighlight(i.id);if(c){return this;}if(i.duration>0){if(i.colours&&i.colours.length===1&&(!i.opacities||i.opacities.length===1)){var e=i.colours[0];i.colours.push([e[0],e[1],e[2],0]);}else if(!i.colours&&i.opacities&&i.opacities.length===1){i.opacities.push(0);}}this._vkScene.createHighlight(i.id,i);return this;};
S.prototype.insertModelViewHighlight=function(i){var c=this._views.get(i.viewId);if(c){var e=[];i.highlightNodes.forEach(function(n){var m=this._nodes.get(n);if(m){e.push(m);}else{}}.bind(this));var j={duration:i.duration,cycles:i.cycles};if(!i.id){i.id=THREE.Math.generateUUID().toLowerCase();}var k=new THREE.Color(i.color1).toArray();var l=new THREE.Color(i.color2).toArray();k[3]=((i.color1>>>24)&255)/255;l[3]=((i.color2>>>24)&255)/255;j.colours=[k,l];j.opacities=[i.opacity1,i.opacity2];this._vkScene.createHighlight(i.id,j);c.addHighlightedNodes(i.id,e);}};
S.prototype.createThumbnail=function(i){var c=this._viewThumbnails.get(i.imageId);if(c){c.thumbnailData="data:image/"+"jpeg"+";base64,"+window.btoa(String.fromCharCode.apply(null,i.data));if(this._fireThumbnailLoaded){this._fireThumbnailLoaded({modelView:c});}}};
S.prototype.highlightStyleExists=function(i){var c=this._vkScene.getHighlight(i);return c!==undefined;};
S.prototype.getView=function(c,e){this._resetCurrentScene(e);return this._views.get(c);};
S.prototype.getSequence=function(c){return this._vkScene.findSequence(c);};
S.prototype.setViewCamera=function(c,e,i){this._resetCurrentScene(i);var j=this._cameras.get(c);var k=this._views.get(e);if(j&&k){k.setCamera(j);}return this;};
S.prototype.setViewNodeInfos=function(n,c,e){this._resetCurrentScene(e);var i=this._views.get(c);i.setNodeInfos(n);return this;};
S.prototype.setViewThumbnail=function(i,c,e,j){this._resetCurrentScene(e);var k=this._views.get(c);var l=this._images.get(i);if(j){this._imageIdsAndTileWidths.set(i,j);}if(k&&l){if(k.userData!==undefined){if(k.userData.viewInfo.thumbnailId===i){k.thumbnailData=l;}else if(k.userData.viewInfo.animatedThumbnailId===i){k.animatedThumbnailData=l;k.tileWidth=j;}}}return this;};
S.prototype.cleanup=function(){this._rootNode=null;if(this._vkScene){this._vkScene.clearMaterials();}this._callouts.forEach(function(c){c.destroy();});this._callouts.clear();this._cameras.forEach(function(c){if(!c instanceof THREE.Camera){c.destroy();}});this._cameras.clear();this._images.clear();this._imageIdsAndTileWidths.clear();this._imageTextures.clear();this._geometries.clear();this._meshNodes.clear();this._meshSubmeshes.clear();this._geometryMeshes.clear();this._materialMeshes.clear();this._materialClones.clear();this._currentSceneId=null;if(this._nodes){this._nodes.clear();}if(this._tracks){this._tracks.clear();}if(this._trackIdSequenceNodeMap){this._trackIdSequenceNodeMap.clear();}if(this._viewGroups){this._viewGroups.clear();}if(this._views){this._views.clear();}this._sceneIdTreeNodesMap.clear();this._sceneIdRootNodeMap.clear();};
S.prototype.insertAnimationGroup=function(i){var c=this._vkScene.findSequence(i.animationGroupRef.toString());if(!c){var e;if(i.endTime){e=i.endTime-i.startTime;if(!i.startTime){i.startTime=0;}}c=this._vkScene.createSequence(i.animationGroupRef.toString(),{name:i.name,duration:e});if(!c.userData){c.userData={};}c.userData.animations=[];}if(i.modelViewRef){var m=this._views.get(i.modelViewRef);if(m){var j=this._vkScene.findSequence(i.animationGroupRef.toString());var k=new s({sequence:j,timeScale:i.playbackSpeed?1.0/i.playbackSpeed:1,preDelay:i.playbackPreDelay?i.playbackPreDelay:0,postDelay:i.playbackPostDelay?i.playbackPostDelay:0,repeat:i.playbackRepeat?Math.abs(i.playbackRepeat):0,reversed:i.playbackReversed?true:false,startTime:0});m.addPlayback(k);}}};
S.prototype.insertAnimation=function(i){var c=this._animations.get(i.animationRef);if(!c){c={};c.type=i.animationType;c.targetRefs=[];c.targetPivots=[];c.sequenceId=i.animationGroupRef.toString();c.trackIds=new Set();c.tracks=[];this._animations.set(i.animationRef,c);}if(i.animationGroupRef){var e=this._vkScene.findSequence(i.animationGroupRef.toString());if(!e.userData.animations.includes(i.animationRef)){e.userData.animations.push(i.animationRef);}}};
S.prototype.insertAnimationTarget=function(i){var c=this._animations.get(i.animationRef);if(c){if(!c.targetRefs.includes(i.targetRef)){c.targetRefs.push(i.targetRef);c.targetPivots.push({x:i.targetPivotX,y:i.targetPivotY,z:i.targetPivotZ});}}};
S.prototype.insertAnimationTrack=function(i){var c=this._animationTracks.get(i.animationTrackRef);var e=i.animationRef;if(!c){delete i.animationRef;c=i;this._animationTracks.set(i.animationTrackRef,c);}if(!e){return;}var j=this._animations.get(e);if(!j||!j.sequenceId){return;}if(j.trackIds.has(c.animationTrackRef)){return;}j.trackIds.add(c.animationTrackRef);for(var k=0;j.targetRefs&&k<j.targetRefs.length;k++){var l=j.targetRefs[k];var m=j.targetPivots[k];var n=this._nodes.get(l);if(!n){continue;}var p1;if(m.x!==0||m.y!==0||m.z!==0){p1=[m.x,m.y,m.z];}var s1=["OPACITY","COLOUR","TRANSLATE","SCALE","ROTATE"][c.type]||"";T.pushElementIntoMapArray(this._trackIdSequenceNodeMap,i.animationTrackRef,{sequenceId:j.sequenceId,targetId:l,type:s1,pivot:p1,isAbsoluteValue:true});var t1={};t1.times=Array.prototype.slice.call(c.times);t1.values=Array.prototype.slice.call(c.values);t1.id=i.animationTrackRef;t1.cyclicInfo={};t1.cyclicInfo.cyclicStart=c.cyclicStart;t1.cyclicInfo.cyclicEnd=c.cyclicEnd;var ki;if(j.type===0){if(c.dataType===0){if(c.values.length!==c.keyCount||c.times.length!==c.keyCount){continue;}if(c.type===3){t1.values=[];for(ki=0;ki<c.keyCount;ki++){t1.values.push(c.values[ki]);t1.values.push(c.values[ki]);t1.values.push(c.values[ki]);}}}else if(c.dataType===1||c.dataType===3){if(c.values.length!==3*c.keyCount||c.times.length!==c.keyCount){continue;}}else if(c.dataType===4||c.dataType===5||c.dataType===6){if(c.values.length!==4*c.keyCount||c.times.length!==c.keyCount){continue;}if(c.dataType===4){t1.rotateType=u.AngleAxis;}else if(c.dataType===6){t1.rotateType=u.Euler;}else{t1.rotateType=u.Quaternion;for(var vi=3;vi<t1.values.length;vi=vi+4){t1.values[vi]=-t1.values[vi];}}}}j.tracks.push(t1);}};
S.prototype.setAnimationTracks=function(c){var e=this._animations.get(c);if(e){this._animationHelper.insertTracks(e.tracks,this._trackIdSequenceNodeMap,this._nodes,this._vkScene);}};
S.prototype.setAnimationPlaybacks=function(i){var c=this._viewGroups.get(i.viewGroupId);this._animationHelper.setInitialNodePositionsFromSubsequentViews(c.getViews(),this._vkScene);this._animationHelper.setInitialNodePositionsFromPreviousViews(c.getViews(),this._vkScene);this._animationHelper.setInitialNodePositionsFromCurrenetViews(c.getViews(),this._vkScene);this._animationHelper.setPlaybackStartTimes(c.getViews(),this._vkScene);this._animationHelper.buildViewsInitialState(c.getViews(),this._vkScene);};
S.prototype.getSphere=function(n,c,m){var e=y.generateSphere(c,m);if(n.userData&&n.userData.nodeContentType){e.userData.nodeContentType=n.userData.nodeContentType;}e.userData.skipIt=true;e.renderOrder=n.renderOrder;n.add(e);};
S.prototype.getPlane=function(n,c,m){var e=y.generatePlane(c,m);if(n.userData&&n.userData.nodeContentType){e.userData.nodeContentType=n.userData.nodeContentType;}e.userData.skipIt=true;e.renderOrder=n.renderOrder;n.add(e);};
S.prototype.preferMeshes=function(){return true;};
S.prototype.setParametricContent=function(n,c,e){this._resetCurrentScene(e);var i={"sphere":this.getSphere.bind(this),"plane":this.getPlane.bind(this)};if(c.type in i===false){L.warning("Attempt to load unkown parameteric type: "+c.type);return;}var j=c.type;var k=this.getNode(n,this.sceneId);var m=c.materialID;var l=null;if(m){l=this._getMaterialRef(m)||this._createTemporaryMaterial(m);if(k.userData.parametricVisible){l.userData.parametricType=j;}}i[j](k,c,l);};
S.prototype.insertFillStyle=function(c){};
S.prototype.insertLineStyle=function(l){};
S.prototype.insertTextStyle=function(c){};
return S;});
sap.ui.predefine('sap/ui/vk/threejs/Texture',["../Texture","../thirdparty/three"],function(T,t){"use strict";
var a=T.extend("sap.ui.vk.threejs.Texture",{
metadata:{},
constructor:function(i){if(i){var c=new THREE.TextureLoader();this._nativeTexture=c.load(i);if(!this._nativeTexture.userData){this._nativeTexture.userData={};}}}
});
var b=a.getMetadata().getParent().getClass().prototype;
a.prototype.init=function(){if(b.init){b.init.call(this);}};
a.prototype.load=function(i){var c=new THREE.TextureLoader();this._nativeTexture=c.load(i);if(!this._nativeTexture.userData){this._nativeTexture.userData={};}return this;};
a.prototype.getTextureRef=function(){return this._nativeTexture;};
a.prototype.setTextureRef=function(c){this._nativeTexture=c;if(!this._nativeTexture.userData){this._nativeTexture.userData={};}return this;};
a.prototype.getId=function(){if(this._nativeTexture&&this._nativeTexture.userData&&this._nativeTexture.userData.id){return this._nativeTexture.userData.id;}};
a.prototype.setId=function(v){if(this._nativeTexture){if(!this._nativeTexture.userData){this._nativeTexture.userData={};}this._nativeTexture.userData.id=v;}return this;};
a.prototype.getFilterMode=function(){if(this._nativeTexture){return this._nativeTexture.magFilter===THREE.NearestFilter?1:0;}};
a.prototype.setFilterMode=function(v){if(this._nativeTexture){this._nativeTexture.magFilter=v===1?THREE.NearestFilter:THREE.LinearFilter;}};
a.prototype.getUvRotationAngle=function(){if(this._nativeTexture){return this._nativeTexture.rotation;}};
a.prototype.setUvRotationAngle=function(v){if(this._nativeTexture){this._nativeTexture.rotation=v;}};
a.prototype.getUvHorizontalOffset=function(){if(this._nativeTexture){return this._nativeTexture.offset.x;}};
a.prototype.setUvHorizontalOffset=function(v){if(this._nativeTexture){this._nativeTexture.offset.x=v;}};
a.prototype.getUvVerticalOffset=function(){if(this._nativeTexture){return this._nativeTexture.offset.y;}};
a.prototype.setUvVerticalOffset=function(v){if(this._nativeTexture){this._nativeTexture.offset.y=v;}};
a.prototype.getUvHorizontalScale=function(){if(this._nativeTexture){return this._nativeTexture.repeat.x;}};
a.prototype.setUvHorizontalScale=function(v){if(this._nativeTexture){this._nativeTexture.repeat.x=v;}};
a.prototype.getUvVerticalScale=function(){if(this._nativeTexture){return this._nativeTexture.repeat.y;}};
a.prototype.setUvVerticalScale=function(v){if(this._nativeTexture){this._nativeTexture.repeat.y=v;}};
a.prototype.getUvHorizontalTilingEnabled=function(){if(this._nativeTexture){return this._nativeTexture.wrapS===THREE.RepeatWrapping;}};
a.prototype.setUvHorizontalTilingEnabled=function(v){if(this._nativeTexture){this._nativeTexture.wrapS=v?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;}};
a.prototype.getUvVerticalTilingEnabled=function(){if(this._nativeTexture){return this._nativeTexture.wrapT===THREE.RepeatWrapping;}};
a.prototype.setUvVerticalTilingEnabled=function(v){if(this._nativeTexture){this._nativeTexture.wrapT=v?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;}};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/ThreeExtensions',["../abgrToColor","../ObjectType","../thirdparty/three","../NodeContentType","./ThreeUtils"],function(a,O,t,N,T){"use strict";THREE.Object3D.prototype.defaultEmissive={r:0.0235,g:0.0235,b:0.0235};THREE.Object3D.prototype.defaultSpecular={r:0.0602,g:0.0602,b:0.0602};
THREE.Box3.prototype._setFromObjectExcludingHotSpotAndPMI=function(o){this.makeEmpty();var v=new THREE.Vector3();var c=this;o.updateMatrixWorld(true);o.traverse(function(n){if(n.userData.objectType===O.Hotspot||n.userData.objectType===O.PMI){return;}var i,l;var g=n.geometry;if(g!==undefined){if(g.isGeometry){var d=g.vertices;for(i=0,l=d.length;i<l;i++){v.copy(d[i]);v.applyMatrix4(n.matrixWorld);c.expandByPoint(v);}}else if(g.isBufferGeometry){var e=g.attributes.position;if(e!==undefined){for(i=0,l=e.count;i<l;i++){v.fromBufferAttribute(e,i).applyMatrix4(n.matrixWorld);c.expandByPoint(v);}}}}});return this;};
THREE.Object3D.prototype._vkCalculateObjectOrientedBoundingBox=function(){var p=this.parent,m=this.matrix.clone(),c=this.matrixAutoUpdate;this.parent=null;this.matrix.identity();this.matrixAutoUpdate=false;this.userData.boundingBox._setFromObjectExcludingHotSpotAndPMI(this);this.matrixAutoUpdate=c;this.matrix.copy(m);this.parent=p;this.updateMatrixWorld(true);};
THREE.Object3D.prototype._vkTraverseNodeGeometry=function(c){c(this);for(var i=0,l=this.children.length;i<l;i++){var d=this.children[i];if(d.geometry!==undefined&&d.userData.skipIt){if(d.children){d._vkTraverseNodeGeometry(c);}else{c(d);}}else if(d.children){d._vkTraverseNodeGeometry(c);}}};
THREE.Object3D.prototype._vkSetHighlightColor=function(c){this._vkTraverseNodeGeometry(function(n){n.userData.highlightingColor=c;n._vkUpdateMaterialColor();});};
THREE.Object3D.prototype._vkSetTintColor=function(c){this._vkTraverseNodeGeometry(function(n){n.userData.tintColor=c;n._vkUpdateMaterialColor();});};
THREE.Object3D.prototype._vkSetOpacity=function(o,j){this.userData.opacity=o;var n;var p;if(j){n=new Map();p=new Map();j.forEach(function(c){if(!c.node||!c.parent){return;}n.set(c.node,c);if(c.parent){var d=p.get(c.parent);if(!d){d=[];}d.push(c);p.set(c.parent,d);}});}this._vkTraverseNodes(function(c){c._vkUpdateMaterialOpacity(n);},n,p);};
THREE.Object3D.prototype._vkUpdateMaterialColor=function(){if(!this.material||!this.material.color){return;}var u=this.userData;if(u.originalMaterial){if(u.originalMaterial.color.r===undefined){u.originalMaterial=null;}else{this.material.color.copy(u.originalMaterial.color);if(this.material.emissive!==undefined){this.material.emissive.copy(u.originalMaterial.emissive);}if(this.material.specular!==undefined){this.material.specular.copy(u.originalMaterial.specular);}}}if(u.highlightColor!==undefined||u.tintColor!==undefined||u.highlightingColor!==undefined){if(!u.originalMaterial){u.originalMaterial=this.material;this.material=this.material.clone();}if(u.highlightingColor!==undefined){var d=new THREE.Color();d.fromArray(u.highlightingColor).lerp(u.originalMaterial.color,1-u.highlightingColor[3]);this.material.color.copy(d);}var c;if(u.tintColor!==undefined){c=a(u.tintColor);this.material.color.lerp(new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0),c.alpha);if(this.material.emissive!==undefined){if(this.material.userData.defaultHighlightingEmissive){this.material.emissive.copy(this.material.userData.defaultHighlightingEmissive);}else{this.material.emissive.copy(THREE.Object3D.prototype.defaultEmissive);}}if(this.material.specular!==undefined){if(this.material.userData.defaultHighlightingSpecular){this.material.specular.copy(this.material.userData.defaultHighlightingSpecular);}else{this.material.specular.copy(THREE.Object3D.prototype.defaultSpecular);}}}if(u.highlightColor!==undefined){c=a(u.highlightColor);this.material.color.lerp(new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0),c.alpha);if(this.material.emissive!==undefined){if(this.material.userData.defaultHighlightingEmissive){this.material.emissive.copy(this.material.userData.defaultHighlightingEmissive);}else{this.material.emissive.copy(THREE.Object3D.prototype.defaultEmissive);}}if(this.material.specular!==undefined){if(this.material.userData.defaultHighlightingSpecular){this.material.specular.copy(this.material.userData.defaultHighlightingSpecular);}else{this.material.specular.copy(THREE.Object3D.prototype.defaultSpecular);}}}}this._vkUpdateMaterialOpacity();};
THREE.Object3D.prototype._vkUpdateMaterialOpacity=function(n){if(!this.material){return;}var u=this.userData;if(u.originalMaterial){this.material.opacity=u.originalMaterial.opacity;this.material.transparent=u.originalMaterial.transparent;}var o=1.0;var h=false;var c=this;do{var d=null,j=null;if(n){j=n.get(c);}if(j&&j.opacity!=null){d=j.opacity;}else if(c.userData&&c.userData.opacity!==undefined){d=c.userData.opacity;}var e=1;if(j&&j.opacity!=null&&c.userData&&c.userData.offsetOpacity!=null){e=c.userData.offsetOpacity;}if(d!=null){o*=d;o*=e;h=true;}if(j&&j.parent){c=j.parent;continue;}c=c.parent;}while(c);if(h||this.renderOrder>0){if(!u.originalMaterial){u.originalMaterial=this.material;this.material=this.material.clone();}if(this.renderOrder>0){this.material.depthTest=false;this.material.transparent=true;}if(this.material.opacity){this.material.opacity*=o;this.material.transparent=u.originalMaterial.transparent||this.material.opacity<0.99;}}};
THREE.Object3D.prototype._vkGetTotalOpacity=function(j){var n;if(j){n=new Map();j.forEach(function(e){if(!e.node||!e.parent){return;}n.set(e.node,e);});}var o=1.0;var c=this;do{var d=null,e=null;if(n){e=n.get(c);}if(e&&e.opacity!=null){d=e.opacity;}else if(c.userData&&c.userData.opacity!==undefined){d=c.userData.opacity;}var f=1;if(e&&e.opacity!=null&&c.userData&&c.userData.offsetOpacity!=null){f=c.userData.offsetOpacity;}if(d!=null){o*=d;o*=f;}if(e&&e.parent){c=e.parent;continue;}c=c.parent;}while(c);return o;};
THREE.Object3D.prototype._vkTraverseMeshNodes=function(c){if(this._vkUpdate!==undefined||this.isDetailView){return;}c(this);var d=this.children;for(var i=0,l=d.length;i<l;i++){d[i]._vkTraverseMeshNodes(c);}};
THREE.Object3D.prototype._vkTraverseNodes=function(c,n,p){c(this);var d;if(p){d=p.get(this);}var j;if(d){for(j=0;j<d.length;j++){d[j].node._vkTraverseNodes(c,n,p);}}var e=this.children;if(e){for(j=0;j<e.length;j++){var f=e[j];if(n){var g=n.get(f);if(g){continue;}}f._vkTraverseNodes(c,n,p);}}};
function b(c,d){var e=c.min,f=c.max,m=d.elements,g=(e.x+f.x)*0.5,h=(e.y+f.y)*0.5,i=(e.z+f.z)*0.5,j=f.x-g,k=f.y-h,l=f.z-i;var n=m[0]*g+m[4]*h+m[8]*i+m[12];var o=m[1]*g+m[5]*h+m[9]*i+m[13];var p=m[2]*g+m[6]*h+m[10]*i+m[14];var q=Math.abs(m[0]*j)+Math.abs(m[4]*k)+Math.abs(m[8]*l);var r=Math.abs(m[1]*j)+Math.abs(m[5]*k)+Math.abs(m[9]*l);var s=Math.abs(m[2]*j)+Math.abs(m[6]*k)+Math.abs(m[10]*l);e.set(n-q,o-r,p-s);f.set(n+q,o+r,p+s);}
THREE.Object3D.prototype._expandBoundingBox=function(c,v,d,e){var n=new THREE.Box3();function f(h){var i=h.geometry;if(i!==undefined){if(!i.boundingBox){i.computeBoundingBox();}if(!i.boundingBox.isEmpty()){n.copy(i.boundingBox);b(n,h.matrixWorld);if(isFinite(n.min.x)&&isFinite(n.min.y)&&isFinite(n.min.z)&&isFinite(n.max.x)&&isFinite(n.max.y)&&isFinite(n.max.z)){c.min.min(n.min);c.max.max(n.max);}}}var s=h.userData.boundingBox;if(s!==undefined&&s.min&&s.max&&!s.isEmpty()&&!v){n.copy(s);b(n,h.matrixWorld);c.min.min(n.min);c.max.max(n.max);}}function g(h){if(h._vkUpdate!==undefined&&(d||(e&&h.userData.is2D))){return;}if(!v||h.visible){f(h);}var j=h.children;for(var i=0,l=j.length;i<l;i++){g(j[i]);}}g(this);return c;};
THREE.Object3D.prototype._vkPersistentId=function(){var o=this;do{if(o.userData.treeNode&&o.userData.treeNode.sid){return o.userData.treeNode.sid;}o=o.parent;}while(o);return null;};
THREE.Object3D.prototype._vkSetNodeContentType=function(n){this.userData.nodeContentType=n;if(n===N.Reference){this.visible=false;this.userData.skipIt=true;}};
THREE.Object3D.prototype._vkGetNodeContentType=function(){return this.userData.nodeContentType;};
THREE.Camera.prototype._vkZoomTo=function(c,m){m=m||0;var s=new THREE.Vector3();c.getSize(s);if(s.lengthSq()===0){return this;}var d=new THREE.Vector3();c.getCenter(d);var e=new THREE.Vector3();this.getWorldDirection(e);e.multiplyScalar(s.length());var f=c.min,g=c.max;var h=[new THREE.Vector3(f.x,f.y,f.z),new THREE.Vector3(g.x,g.y,g.z),new THREE.Vector3(f.x,f.y,g.z),new THREE.Vector3(f.x,g.y,g.z),new THREE.Vector3(g.x,f.y,g.z),new THREE.Vector3(g.x,g.y,f.z),new THREE.Vector3(f.x,g.y,f.z),new THREE.Vector3(g.x,f.y,f.z)];var j=new THREE.Matrix4(),p=new THREE.Vector3();function k(r){j.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse);for(var i in h){p.copy(h[i]).applyMatrix4(j);if(p.x<-1.0||p.x>1.0||p.y<-1.0||p.y>1.0){return false;}}return true;}this.position.copy(d).sub(e);this.updateMatrixWorld(true);if(this.isPerspectiveCamera){while(!k(this)){this.position.sub(e);this.updateMatrixWorld(true);}var l=10;var P=this.position.clone();var v=d.clone();for(var n=0;n<l;n++){this.position.copy(P).add(v).multiplyScalar(0.5);this.updateMatrixWorld(true);if(k(this)){P.copy(this.position);}else{v.copy(this.position);}}this.position.copy(P).sub(d).multiplyScalar(m).add(P);this.updateMatrixWorld(true);}else if(this.isOrthographicCamera){var o=new THREE.Box2();h.forEach(function(i){p=i.project(this);o.expandByPoint(new THREE.Vector2(p.x,p.y));}.bind(this));var q=new THREE.Vector2();o.getSize(q);this.zoom/=Math.max(q.x,q.y)*0.5*(1+m);this.updateProjectionMatrix();}return this;};
THREE.Mesh.prototype._vkClone=function(){var c=new THREE.Mesh();T.disposeMaterial(c.material);c.copy(this);return c;};
});
sap.ui.predefine('sap/ui/vk/threejs/ThreeUtils',["../thirdparty/three","sap/base/Log"],function(t,L){"use strict";var T={};
T._disposeMaterial=function(m){if(m.map){m.map.dispose();}if(m.lightMap){m.lightMap.dispose();}if(m.bumpMap){m.bumpMap.dispose();}if(m.normalMap){m.normalMap.dispose();}if(m.specularMap){m.specularMap.dispose();}if(m.envMap){m.envMap.dispose();}m.dispose();};
T.disposeMaterial=function(M){if(M){if(M instanceof THREE.MeshFaceMaterial){M.materials.forEach(function(m){T._disposeMaterial(m);});}else{T._disposeMaterial(M);}}};
T.disposeObject=function(o){if(o instanceof THREE.Mesh||o instanceof THREE.Line||o instanceof THREE.Box3Helper){if(o.geometry){o.geometry.dispose();}if(o.material){T._disposeMaterial(o.material);}}};
T.disposeGeometry=function(o){if(o instanceof THREE.Mesh||o instanceof THREE.Line||o instanceof THREE.Box3Helper){if(o.geometry){o.geometry.dispose();}}};
T.getAllTHREENodes=function(a,b,c){if(!a){return;}if(!b||!c){L.error("getAllTHREENodes input parameters - all3DNodes and/or allGroupNodes are undefined.");return;}a.forEach(function(n){if(n instanceof THREE.Mesh){b.push(n);}else if(n instanceof THREE.Light){b.push(n);}else if(n instanceof THREE.Camera){b.push(n);}else if(n instanceof THREE.Box3Helper){b.push(n);}else if(n instanceof THREE.Group){c.push(n);}if(n.children&&n.children.length>0){T.getAllTHREENodes(n.children,b,c);}});};
return T;});
sap.ui.predefine('sap/ui/vk/threejs/Thrustline',["../thirdparty/three","sap/ui/base/ManagedObject","./PolylineGeometry","./PolylineMaterial","./PolylineMesh","../LeaderLineMarkStyle"],function(t,B,P,a,b,L){"use strict";
var T=B.extend("sap.ui.vk.threejs.Thrustline",{metadata:{properties:{node:{type:"object"},renderOrder:{type:"int",defaultValue:0},depthTest:{type:"boolean",defaultValue:true},principleAxis:{type:"object",defaultValue:new THREE.Vector3(0,0,0)},material:{type:"object"},items:{type:"object[]"},segments:{type:"object[]"}}}});
T.prototype.init=function(){if(B.prototype.init){B.prototype.init.call(this);}this._needUpdateMeshes=false;};
T.prototype.setNode=function(n){if(n instanceof THREE.Object3D){this.setProperty("node",n,true);this._needUpdateMeshes=true;}return this;};
T.prototype.setRenderOrder=function(v){this.setProperty("renderOrder",v,true);this._needUpdateMeshes=true;return this;};
T.prototype.setDepthTest=function(v){this.setProperty("depthTest",v,true);this._needUpdateMeshes=true;return this;};
T.prototype.setMaterial=function(h){if(h instanceof THREE.Material){this.setProperty("material",h,true);this._needUpdateMeshes=true;}return this;};
T.prototype.setItems=function(v){this.setProperty("items",v,true);this._needUpdateMeshes=true;return this;};
T.prototype.setSegments=function(v){this.setProperty("segments",v,true);this._needUpdateMeshes=true;return this;};
T.prototype._updateMeshes=function(v){var n=this.getNode();var h=this.getMaterial();var j=this.getDepthTest();var r=this.getRenderOrder();var k=h&&h.userData.lineStyle?h.userData.lineStyle:{};var o=k.width;var p=k.dashPatternScale;if(k.widthCoordinateSpace===3){o=o?o*v.y:1;p=p?p*v.y:1;}o=o||1;k.haloWidth=k.haloWidth||0;k.endCapStyle=k.endCapStyle||0;this.getSegments().forEach(function(s){if(s.polylineMesh){n.remove(s.polylineMesh);s.polylineMesh=null;}if(s.haloMesh){n.remove(s.haloMesh);s.haloMesh=null;}var q=[];for(var i=0,l=s.ratios.length;i<l;i++){q.push(new THREE.Vector3());}var u=new P();u.setVertices(q);var w=k.endCapStyle||q.length>2?1:0;var x=(w&&k.endCapStyle===0?1:0)|(w&&k.endCapStyle===0?2:0);if(k.haloWidth>0){var y=new a({color:0xFFFFFF,lineColor:0xFFFFFF,linewidth:o*(k.haloWidth*2+1),dashCapStyle:k.endCapStyle,segmentCapStyle:w,trimStyle:x,transparent:true,depthTest:j});var z=new b(u,y);z.matrixAutoUpdate=false;z.renderOrder=r;z.userData.skipIt=true;s.haloMesh=z;n.add(z);}var A=new a({color:0xFFFFFF,lineColor:h.color,linewidth:o,dashCapStyle:k.endCapStyle,segmentCapStyle:w,trimStyle:x,dashPattern:k.dashPattern||[],dashScale:p||1,transparent:true,depthTest:j,polygonOffset:true,polygonOffsetFactor:-4});var C=new b(u,A);C.matrixAutoUpdate=false;C.renderOrder=r;C.userData.skipIt=true;s.polylineMesh=C;n.add(C);});};
var m=new THREE.Matrix4(),c=new THREE.Matrix4(),d=new THREE.Vector3(),e=new THREE.Vector3(),f=new THREE.Vector3(),g=new THREE.Vector3();
T.prototype._update=function(r,h,v){var n=this.getNode();if(!n||!n.visible){return;}if(this._needUpdateMeshes){this._needUpdateMeshes=false;this._updateMeshes(v);}m.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse);c.copy(m);var j=h instanceof THREE.PerspectiveCamera?h.near:undefined;var k=this.getItems();d.copy(this.getPrincipleAxis()).normalize();this.getSegments().forEach(function(s){var p=s.polylineMesh;if(p){var o=p.geometry;var q=k[s.startItemIndex];var u=new THREE.Vector3().copy(q.boundPoints[s.startBoundIndex]).applyMatrix4(q.target.matrixWorld);var w=k[s.endItemIndex];var x=new THREE.Vector3().copy(w.boundPoints[s.endBoundIndex]).applyMatrix4(w.target.matrixWorld);e.copy(x).sub(u);f.copy(d).multiplyScalar(e.dot(d));g.copy(e).sub(f);var y=o.vertices;var z=[];for(var i=0,l=s.ratios.length;i<l;i++){z.push(i);var A=s.ratios[i];var C=y[i];C.copy(u);e.copy(f).multiplyScalar(A.x);C.add(e);e.copy(g).multiplyScalar(A.y);C.add(e);}o._updateVertices(z);p.material.resolution.copy(v);p.computeLineDistances(c,v,j);}var D=s.haloMesh;if(D){D.material.resolution.copy(v);D.computeLineDistances(c,v,j);}});};
return T;});
sap.ui.predefine('sap/ui/vk/threejs/ViewStateManager',["../Core","../ViewStateManagerBase","../thirdparty/three","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","./Scene","../ObjectType","../RotationType","./NodesTransitionHelper","./OutlineRenderer","./HighlightPlayer","../HighlightDisplayState","../Highlight","../AnimationTrackType","../AnimationTrackValueType","../AnimationMath","../NodeContentType","./ThreeUtils"],function(a,V,t,b,d,e,f,S,O,R,N,g,H,h,m,A,n,o,p,T){"use strict";var q;
var r=V.extend("sap.ui.vk.threejs.ViewStateManager",{metadata:{}});
var u=r.getMetadata().getParent().getClass().prototype;
r.prototype.init=function(){if(u.init){u.init.call(this);}this._nodeHierarchy=null;this._nodeStates=new Map();this._selectedNodes=new Set();this._outlineRenderer=new g(1.0);this._outlinedNodes=new Set();this.setOutlineColor("rgba(255, 0, 255, 1.0)");this.setOutlineWidth(1.0);this._visibilityTracker=new q();this._showSelectionBoundingBox=true;this._boundingBoxesScene=new THREE.Scene();this._selectionColor=new THREE.Color(0xC0C000);this.setHighlightColor("rgba(255, 0, 0, 1.0)");this._joints=[];this._nodesTransitionHelper=new N();this._nodesTransitionHelper.setViewStateManager(this);this._highlightPlayer=new H();this._highlightPlayer.setViewStateManager(this);this._transitionPlayer=new H();this._transitionPlayer.setViewStateManager(this);a.getEventBus().subscribe("sap.ui.vk","activateView",this._onActivateView,this);};
r.prototype._clearBoundingBoxScene=function(){var c=[];var i=[];T.getAllTHREENodes([this._boundingBoxesScene],c,i);c.forEach(function(j){T.disposeObject(j);j.parent.remove(j);});i.forEach(function(j){j.parent.remove(j);});};
r.prototype.exit=function(){a.getEventBus().unsubscribe("sap.ui.vk","activateView",this._onActivateView,this);if(this._nodesTransitionHelper){this._nodesTransitionHelper.destroy();}if(this._outlineRenderer){this._outlineRenderer.dispose();this._outlineRenderer=null;}if(this._boundingBoxesScene){this._clearBoundingBoxScene();this._boundingBoxesScene.dispose();this._boundingBoxesScene=null;}};
r.prototype._setContent=function(c){var s=null;if(c&&c instanceof S){s=c;}this._setScene(s);if(s){var i=s.getInitialView();if(i){this._currentView=i;this._resetNodesMaterialAndOpacityByCurrenView(this._currentView);}}return this;};
r.prototype._setScene=function(s){if(this._boundingBoxesScene){this._clearBoundingBoxScene();}this._boundingBoxesScene=new THREE.Scene();this._setNodeHierarchy(s?s.getDefaultNodeHierarchy():null);if(s){s.setViewStateManager(this);}this._scene=s;if(this._scene){var i=this._scene.getInitialView();if(i){this.activateView(i);}}return this;};
r.prototype._setNodeHierarchy=function(c){var i=this._nodeHierarchy;if(this._nodeHierarchy){this._nodeHierarchy=null;this._nodeStates.clear();this._selectedNodes.clear();this._outlinedNodes.clear();this._visibilityTracker.clear();}if(c){this._nodeHierarchy=c;this._nodeHierarchy.attachNodeReplaced(this._handleNodeReplaced,this);this._nodeHierarchy.attachNodeUpdated(this._handleNodeUpdated,this);this._nodeHierarchy.attachNodeRemoving(this._handleNodeRemoving,this);this._initialState={visible:[],hidden:[]};var j=this;var k=c.findNodesByName();k.forEach(function(l){j._initialState[l.visible?"visible":"hidden"].push(l);});this.fireVisibilityChanged({visible:this._initialState.visible,hidden:this._initialState.hidden});}if(c!==i){this.fireNodeHierarchyReplaced({oldNodeHierarchy:i,newNodeHierarchy:c});}return this;};
r.prototype._getJointByChildNode=function(c){var j;if(this._jointCollection){for(var i=0;i<this._jointCollection.length;i++){if(this._jointCollection[i].node===c){j=this._jointCollection[i];break;}}}return j;};
r.prototype._handleNodeReplaced=function(c){var i=c.getParameter("ReplacedNodeRef");var j=c.getParameter("ReplacementNodeRef");if(this.getSelectionState(i)){this.setSelectionState(j,true);this.setSelectionState(i,false);}};
r.prototype._handleNodeUpdated=function(c){var i=c.getParameter("nodeRef");if(this.getSelectionState(i)){this.setSelectionState(i,false);this.setSelectionState(i,true);}};
r.prototype._handleNodeRemoving=function(c){var j=c.getParameter("nodeRef");if(this._jointCollection){for(var i=0;i<this._jointCollection.length;i++){if(this._jointCollection[i].node===j){this._jointCollection[i].node=null;break;}if(this._jointCollection[i].parent===j){this._jointCollection[i].parent=null;break;}}}if(this.getSelectionState(j)){this.setSelectionState(j,false,true,true);}};
r.prototype._renderOutline=function(i,s,j){var c=e(this._outlineColorABGR);var k=new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0);this._outlineRenderer.render(i,s,j,Array.from(this._outlinedNodes),k,this._jointCollection);};
r.prototype.getNodeHierarchy=function(){return this._nodeHierarchy;};
r.prototype.getVisibilityChanges=function(){return this.getShouldTrackVisibilityChanges()?this._visibilityTracker.getInfo(this.getNodeHierarchy()):null;};
r.prototype.getCurrentView=function(){var v=sap.ui.getCore().byId(this.getViewManager());if(!v){return null;}var c=v.getActiveView();return c;};
r.prototype.resetNodeProperty=function(c,i){var j=this.getCurrentView();if(!j){return;}var k=j.getNodeInfos();if(k){var l=[];l.push(c);if(this._jointCollection&&this._jointCollection.length>0){for(var s=0;s<this._jointCollection.length;s++){var v=this._jointCollection[s];if(!v.node||!v.parent){continue;}var x=v.parent;if(x!==c){break;}l.push(v.node);}}k.forEach(function(y){if(!l.includes(y.target)){return;}if(!i||i!==A.Opacity){var z={nodeRefs:[],positions:[]};var C;var D;var E;if(y.transform){var F=new THREE.Vector3();var G=new THREE.Quaternion();var I=new THREE.Vector3();var J=B(y.transform);J.decompose(F,G,I);C=F.toArray();D=G.toArray();E=I.toArray();}else if(y[A.Scale]&&y[A.Rotate]&&y[A.Translate]){C=y[A.Translate].slice();D=y[A.Rotate].slice();E=y[A.Scale].slice();}if(C){z.nodeRefs.push(y.target);z.positions.push({translation:C,quaternion:D,scale:E});this.setTransformation(z.nodeRefs,z.positions);}}else{c._vkSetOpacity(y.opacity,this._jointCollection);var K={changed:c,opacity:k.opacity};this.fireOpacityChanged(K);}}.bind(this));}};
r.prototype.getVisibilityComplete=function(){var c=this.getNodeHierarchy(),i=c.findNodesByName(),v=[],j=[];i.forEach(function(k){var l=c.createNodeProxy(k);var s=l.getVeId();c.destroyNodeProxy(l);if(s){if(this.getVisibilityState(k)){v.push(s);}else{j.push(s);}}},this);return{visible:v,hidden:j};};
r.prototype.resetVisibility=function(){this.setVisibilityState(this._initialState.visible,true,false);this.setVisibilityState(this._initialState.hidden,false,false);this._visibilityTracker.clear();};
r.prototype.getVisibilityState=function(c){if(Array.isArray(c)){return c.map(function(i){return i?i.visible:false;});}return c?c.visible:false;};
r.prototype.setVisibilityState=function(c,v,i){if(!Array.isArray(c)){c=[c];}var j=Array.isArray(v);var k=[];var l=c;if(i){l=[];c.forEach(function(C,D){var E=this._collectNodesRecursively(C);l=l.concat(E);var F=k.length;k.length=F+E.length;k.fill(j?v[D]:v,F);},this);}else if(!j){k.length=l.length;k.fill(v);}else{k=v;}var s=[];var x=new Set();var y=l.filter(function(C,D){if(C==null||(C.userData.skipIt&&C.visible)||x.has(C)){return false;}x.add(C);var y=C?C.visible!=k[D]:false;if(y){s.push(k[D]);}return y;},this);if(y.length>0){var z={visible:[],hidden:[]};y.forEach(function(C,D){C.visible=s[D];z[C.visible?"visible":"hidden"].push(C);},this);if(this.getShouldTrackVisibilityChanges()){y.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker);}this.fireVisibilityChanged(z);}return this;};
r.prototype._getEffectiveVisibility=function(c){var i=this.getVisibilityState(c);var j=c.parent;while(i&&j){i=i&&this.getVisibilityState(j);j=j.parent;}return i;};
r.prototype.enumerateSelection=function(c){this._selectedNodes.forEach(c);return this;};
r.prototype.enumerateOutlinedNodes=function(c){this._outlinedNodes.forEach(c);return this;};
r.prototype.getSelectionState=function(c){var s=this._selectedNodes;function i(j){return s.has(j);}return Array.isArray(c)?c.map(i):i(c);};
r.prototype._getSelectionComplete=function(){var c=this.getNodeHierarchy(),s=[],i=[];function j(k){var l=c.createNodeProxy(k);var v=l.getVeId();c.destroyNodeProxy(l);return v;}this._selectedNodes.forEach(function(k){var v=j(k);if(v){s.push(v);}});this._outlinedNodes.forEach(function(k){var v=j(k);if(v){i.push(v);}});return{selected:s,outlined:i};};
r.prototype._isAChild=function(c,i){var j=c.parent;while(j){if(i.has(j)){return true;}j=j.parent;}return false;};
r.prototype._AddBoundingBox=function(c){if(c.userData.boundingBox===undefined){c.userData.boundingBox=new THREE.Box3();c._vkCalculateObjectOrientedBoundingBox();}if(!c.userData.boundingBox.isEmpty()&&this._boundingBoxesScene&&c.userData.boxHelper===undefined){var i=new THREE.Box3Helper(c.userData.boundingBox,0xffff00);i.material.color=this._selectionColor;this._boundingBoxesScene.add(i);i.parent=c;c.userData.boxHelper=i;}};
r.prototype._RemoveBoundingBox=function(c){if(c.userData.boundingBox!==undefined){delete c.userData.boundingBox;}if(c.userData.boxHelper!==undefined){this._boundingBoxesScene.remove(c.userData.boxHelper);T.disposeObject(c.userData.boxHelper);delete c.userData.boxHelper;}};
r.prototype._updateBoundingBoxesIfNeeded=function(){var c=new Set();this._selectedNodes.forEach(function(i){var j=i.parent;while(j){if(this._selectedNodes.has(j)){c.add(j);}j=j.parent;}}.bind(this));c.forEach(function(i){i._vkCalculateObjectOrientedBoundingBox();});};
r.prototype._updateBoundingBoxes=function(){this._selectedNodes.forEach(function(c){if(c.userData.boundingBox){c._vkCalculateObjectOrientedBoundingBox();}});};
r.prototype.setShowSelectionBoundingBox=function(v){this._showSelectionBoundingBox=v;if(this._showSelectionBoundingBox){this._selectedNodes.forEach(function(c){this._AddBoundingBox(c);}.bind(this));}else{this._selectedNodes.forEach(function(c){this._RemoveBoundingBox(c);}.bind(this));}this.fireSelectionChanged({selected:this._selectedNodes,unselected:[]});};
r.prototype.getShowSelectionBoundingBox=function(){return this._showSelectionBoundingBox;};
r.prototype._isAncestorSelected=function(c){c=c.parent;while(c){if(this._selectedNodes.has(c)){return true;}c=c.parent;}return false;};
r.prototype._updateHighlightColor=function(c,j){var s=j||this._selectedNodes.has(c);var k=c._vkGetNodeContentType();if(k===p.Background||k===p.Symbol){return;}else{c.userData.highlightColor=s?this._highlightColorABGR:undefined;c._vkUpdateMaterialColor();var v=c.children;for(var i=0,l=v.length;i<l;i++){var x=v[i].userData;if(x&&x.objectType===O.Hotspot){continue;}this._updateHighlightColor(v[i],s);}}};
r.prototype.setSelectionState=function(c,s,i,j){if(!Array.isArray(c)){c=[c];}c=(i||this.getRecursiveSelection()?this._collectNodesRecursively(c):c).filter(function(v,l,x){return x.indexOf(v)===l;});if(this.getRecursiveSelection()&&!s){c=this._nodeHierarchy._appendAncestors(c);}var k=c.filter(function(l){return this._selectedNodes.has(l)!==s;},this);if(k.length>0){k.forEach(function(l){if(l){this._selectedNodes[s?"add":"delete"](l);if(this._showSelectionBoundingBox){this[s?"_AddBoundingBox":"_RemoveBoundingBox"](l);}}},this);k.forEach(function(l){if(l){this._updateHighlightColor(l,s||this._isAncestorSelected(l));}},this);if(!j){this.fireSelectionChanged({selected:s?k:[],unselected:s?[]:k});}}return this;};
r.prototype.setSelectionStates=function(s,c,i,j){if(!Array.isArray(s)){s=[s];}if(!Array.isArray(c)){c=[c];}s=(i||this.getRecursiveSelection()?this._collectNodesRecursively(s):s);c=(i||this.getRecursiveSelection()?this._collectNodesRecursively(c):c);if(this.getRecursiveSelection()){c=this._nodeHierarchy._appendAncestors(c,s);}var k=s.filter(function(v){return this._selectedNodes.has(v)===false;},this);var l=c.filter(function(v){return this._selectedNodes.has(v)===true;},this);if(k.length>0||l.length>0){k.forEach(function(v){this._selectedNodes.add(v);this._updateHighlightColor(v,true);if(this._showSelectionBoundingBox){this._AddBoundingBox(v);}},this);l.forEach(function(v){this._selectedNodes.delete(v);if(this._showSelectionBoundingBox){this._RemoveBoundingBox(v);}},this);l.forEach(function(v){this._updateHighlightColor(v,this._isAncestorSelected(v));},this);if(!j){this.fireSelectionChanged({selected:k,unselected:l});}}return this;};
r.prototype.setOutlineColor=function(c){switch(typeof c){case"number":this._outlineColorABGR=c;break;case"string":if(sap.ui.core.CSSColor.isValid(c)){this._outlineColorABGR=f(b(c));}break;default:return this;}this.fireOutlineColorChanged({outlineColor:d(e(this._outlineColorABGR)),outlineColorABGR:this._outlineColorABGR});return this;};
r.prototype.getOutlineColor=function(i){return i?this._outlineColorABGR:d(e(this._outlineColorABGR));};
r.prototype.getOutliningState=function(c){var i=this._outlinedNodes;function j(k){return i.has(k);}return Array.isArray(c)?c.map(j):j(c);};
r.prototype.setOutliningStates=function(c,i,j,k){if(!Array.isArray(c)){c=[c];}if(!Array.isArray(i)){i=[i];}c=(j||this.getRecursiveOutlining()?this._collectNodesRecursively(c):c);i=(j||this.getRecursiveOutlining()?this._collectNodesRecursively(i):i);if(this.getRecursiveOutlining()){i=this._nodeHierarchy._appendAncestors(i,c);}var l=c.filter(function(v){return this._outlinedNodes.has(v)===false;},this);var s=i.filter(function(v){return this._outlinedNodes.has(v)===true;},this);if(l.length>0||s.length>0){l.forEach(function(v){this._outlinedNodes.add(v);},this);s.forEach(function(v){this._outlinedNodes.delete(v);},this);if(!k){this.fireOutliningChanged({outlined:l,unoutlined:s});}}return this;};
r.prototype.setOutlineWidth=function(c){this._outlineWidth=c;this._outlineRenderer.setOutlineWidth(c);this.fireOutlineWidthChanged({width:c});return this;};
r.prototype.getOutlineWidth=function(){return this._outlineWidth;};
r.prototype._collectNodesRecursively=function(c){var i=[],j=this;(Array.isArray(c)?c:[c]).forEach(function l(k){i.push(k);j._nodeHierarchy.enumerateChildren(k,l,false,true);});return i;};
r.prototype._getOpacity=function(c){return c.userData.opacity!==undefined?c.userData.opacity:null;};
r.prototype.getOpacity=function(c){if(Array.isArray(c)){return c.map(this._getOpacity,this);}else{return this._getOpacity(c);}};
r.prototype.setOpacity=function(c,i,j){if(!Array.isArray(c)){c=[c];}var k=Array.isArray(i);if(i==null){i=undefined;}else if(k){i.forEach(function(C,D){if(C==null){i[D]=undefined;}});}var l=[];var s=c;if(!k){l.length=s.length;l.fill(i);}else{l=i;}var v=[];var x=new Set();var y=s.filter(function(C,D){if(x.has(C)){return false;}x.add(C);var y=C?C.userData.opacity!==l[D]:false;if(y){v.push(l[D]);}return y;},this);if(y.length>0){y.forEach(function(C,D){C._vkSetOpacity(v[D],this._jointCollection);},this);var z={changed:y,opacity:k?v:v[0]};this.fireOpacityChanged(z);}return this;};
r.prototype._getTintColorABGR=function(c){return c.userData.tintColor!==undefined?c.userData.tintColor:null;};
r.prototype._getTintColor=function(c){return c.userData.tintColor!==undefined?d(e(c.userData.tintColor)):null;};
r.prototype.getTintColor=function(c,i){var j=i?"_getTintColorABGR":"_getTintColor";if(Array.isArray(c)){return c.map(this[j],this);}else{return this[j](c);}};
r.prototype.setTintColor=function(c,i,j){if(!Array.isArray(c)){c=[c];}var k=function(E){var F=null;switch(typeof E){case"number":F=E;break;case"string":if(sap.ui.core.CSSColor.isValid(E)){F=f(b(E));}break;default:F=undefined;break;}return F;};var l=Array.isArray(i);var s=[];var v=c;if(j){v=[];c.forEach(function(E,F){var G=this._collectNodesRecursively(E);v=v.concat(G);var I=s.length;s.length=I+G.length;s.fill(l?i[F]:i,I);},this);}else if(!l){s.length=v.length;s.fill(i);}else{s=i;}var x=[];var y=new Set();var z=v.filter(function(E,F){if(y.has(E)){return false;}y.add(E);var z=E?E.userData.tintColor!==k(s[F]):false;if(z){x.push(s[F]);}return z;},this);if(z.length>0){var C=[];z.forEach(function(E,F){var G=k(x[F]);E._vkSetTintColor(G);C.push(G);},this);var D={changed:z,tintColor:l?x:x[0],tintColorABGR:l?C:C[0]};this.fireTintColorChanged(D);}return this;};
r.prototype.setHighlightColor=function(c){switch(typeof c){case"number":this._highlightColorABGR=c;break;case"string":if(sap.ui.core.CSSColor.isValid(c)){this._highlightColorABGR=f(b(c));}break;default:return this;}if(this._selectedNodes.size>0){this._selectedNodes.forEach(function(i){this._updateHighlightColor(i,true);},this);}this.fireHighlightColorChanged({highlightColor:d(e(this._highlightColorABGR)),highlightColorABGR:this._highlightColorABGR});return this;};
r.prototype.getHighlightColor=function(i){return i?this._highlightColorABGR:d(e(this._highlightColorABGR));};
r.prototype.getRestTransformationUsingJoint=function(c){var j=this._getJointByChildNode(c);if(j&&j.translation&&j.scale&&j.quaternion){return j;}else{return this.getRestTransformation(c);}};
r.prototype.getRelativeTransformation=function(c){var i=function(k){var l=this.getRestTransformation(k);var s=[k.position.x-l.translation[0],k.position.y-l.translation[1],k.position.z-l.translation[2]];var v=new THREE.Quaternion().fromArray(l.quaternion).inverse().premultiply(k.quaternion).toArray();var x=[k.scale.x/l.scale[0],k.scale.y/l.scale[1],k.scale.z/l.scale[2]];return{translation:s,quaternion:v,scale:x};}.bind(this);if(!Array.isArray(c)){return i(c);}var j=[];c.forEach(function(k){j.push(i(k));});return j;};
r.prototype.getTransformationWorld=function(c){var i=function(k){var l=new THREE.Vector3();var s=new THREE.Vector3();var v=new THREE.Quaternion();k.updateMatrixWorld();k.matrixWorld.decompose(l,v,s);return{translation:l.toArray(),quaternion:v.toArray(),scale:s.toArray()};};if(!Array.isArray(c)){return i(c);}var j=[];c.forEach(function(k){j.push(i(k));});return j;};
r.prototype.getTransformation=function(c){var i=function(k){return{translation:this.getTranslation(k),quaternion:this.getRotation(k,R.Quaternion),scale:this.getScale(k)};}.bind(this);if(!Array.isArray(c)){return i(c);}var j=[];c.forEach(function(k){j.push(i(k));});return j;};
r.prototype.getTranslation=function(c){var i=function(k){return k.position.toArray();};if(!Array.isArray(c)){return i(c);}var j=[];c.forEach(function(k){j.push(i(k));});return j;};
r.prototype.getScale=function(c){var i=function(k){return k.scale.toArray();};if(!Array.isArray(c)){return i(c);}var j=[];c.forEach(function(k){j.push(i(k));});return j;};
r.prototype._convertQuaternionToAngleAxis=function(c){if(c.w>1){c.normalize();}if(c.w>0.9999&&c.x<0.0001&&c.y<0.0001&&c.z<0.0001){c.w=1;c.x=0;c.y=0;c.z=0;}var i=2*Math.acos(c.w);var x;var y;var z;var s=Math.sqrt(1-c.w*c.w);if(s<0.0001){x=1;y=0;z=0;}else{x=c.x/s;y=c.y/s;z=c.z/s;}return[x,y,z,i];};
r.prototype.getRotation=function(c,i){var j=function(l){var s=l.quaternion;var k;switch(i){case R.AngleAxis:k=this._convertQuaternionToAngleAxis(s);break;case R.Euler:var v=new THREE.Euler();v.setFromQuaternion(s);k=v.toArray();break;default:k=s.toArray();}return k;};if(!Array.isArray(c)){return j(c);}var k=[];c.forEach(function(l){k.push(j(l));});return k;};
r.prototype.setTransformation=function(c,i){var j=Array.isArray(c);if(!Array.isArray(c)){c=[c];}var k={changed:[],transformation:[]};var l=function(s){return{position:s.position.toArray(),quaternion:s.quaternion.toArray(),scale:s.scale.toArray()};};if(!i){c.forEach(function(s){if(s.userData.position&&s.userData.quaternion&&s.userData.scale){s.position=s.userData.position;s.quaternion=s.userData.quaternion;s.scale=s.userData.scale;s.updateMatrix();delete s.userData.position;delete s.userData.quaternion;delete s.userData.scale;}k.changed.push(s);k.transformation.push(l(s));},this);}else{if(!Array.isArray(i)){i=[i];}c.forEach(function(s,v){var x=s.userData;if(!x){return;}if(!x.position){x.position=s.position.clone();}if(!x.quaternion){x.quaternion=s.quaternion.clone();}if(!x.scale){x.scale=s.scale.clone();}var y=i[v];if(y.transform){var z=B(y.transform);z.decompose(s.position,s.quaternion,s.scale);}else{s.position.fromArray(y.translation);s.scale.fromArray(y.scale);if(y.quaternion){s.quaternion.fromArray(y.quaternion);}else if(y.angleAxis){var C=new THREE.Vector3(y.angleAxis[0],y.angleAxis[1],y.angleAxis[2]);s.quaternion.setFromAxisAngle(C,y.angleAxis[3]);}else if(y.euler){var D=new THREE.Euler();D.fromArray(y.euler[0],y.euler[1],y.euler[2],y.euler[3]);s.quaternion.setFromEuler(D);}}s.updateMatrix();k.changed.push(s);k.transformation.push(l(s));},this);}if(!j){k.changed=k.changed[0];k.transformation=k.transformation[0];}this.fireTransformationChanged(k);return this;};
r.prototype.getJoints=function(){return this._jointCollection;};
r.prototype.setJoints=function(j,c){this._jointCollection=[];this._playbackAssociatedWithJoints=null;if(!j){return this;}var i=new Set();var k=new Map();j.forEach(function(s){if(!s.node||!s.parent){return;}i.add(s.node);k.set(s.node,s);});while(i.size>0){var l=i.values().next().value;i.delete(l);var s=k.get(l);var v=[s];var x=[];var y=s.parent;while(y){s=k.get(y);if(s!==undefined){if(i.delete(y)){v.push(s);}if(x.length>0){s.nodesToUpdate=s.nodesToUpdate||[];while(x.length>0){var z=x.pop();if(s.nodesToUpdate.indexOf(z)>=0){break;}s.nodesToUpdate.push(z);}}x.length=0;y=s.parent;}else{x.push(y);y=y.parent;}}while(v.length>0){this._jointCollection.push(v.pop());}}if(this._jointCollection&&this._jointCollection.length>0){this._playbackAssociatedWithJoints=c;this._jointCollection.forEach(function(s){if(!s.node||!s.parent){return;}s.translation=null;s.scale=null;s.quaternion=null;s.opacity=null;if(s.node.userData){s.node.userData.offsetTranslation=null;s.node.userData.offsetQuaternion=null;s.node.userData.offsetScale=null;s.node.userData.originalRotationType=null;s.node.userData.offsetOpacity=null;}});this._jointCollection.forEach(function(s){this._updateJointNode(s,this._playbackAssociatedWithJoints);}.bind(this));}return this;};
r.prototype._updateJointNode=function(j,c){if(!j.node||!j.parent){return;}if(j.translation&&j.quaternion&&j.scale&&j.opacity){return;}var i=new Map();if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(j){if(!j.node||!j.parent){return;}i.set(j.node,j);});}var k,s,l,v,x,y;var z=j.node;var C=new THREE.Matrix4();var D,E=1;while(z){y=this.getRestOpacity(z);x=this.getRestTransformation(z);if(!x){z=z.parent;continue;}k=new THREE.Vector3(x.translation[0],x.translation[1],x.translation[2]);s=new THREE.Vector3(x.scale[0],x.scale[1],x.scale[2]);l=new THREE.Quaternion(x.quaternion[0],x.quaternion[1],x.quaternion[2],x.quaternion[3]);D=y;if(c){var F=this._getEndPropertyInPreviousPlayback(z,A.Translate,c,true);if(F){k.x+=F[0];k.y+=F[1];k.z+=F[2];}var G=this._getEndPropertyInPreviousPlayback(z,A.Scale,c,true);if(G){s.x*=G[0];s.y*=G[1];s.z*=G[2];}var I=this._getEndPropertyInPreviousPlayback(z,A.Rotate,c,true);if(I){var J=new THREE.Quaternion(I[0],I[1],I[2],I[3]);l=J.multiply(l);}var K=this._getEndPropertyInPreviousPlayback(z,A.Opacity,c,true);if(K!=null){D*=K;}}v=new THREE.Matrix4().compose(k,l,s);C.premultiply(v);E*=D;z=z.parent;}var L=j.parent;var P=new THREE.Matrix4();var M=1;while(L){var Q=i.get(L);if(Q){if(!Q.translation){this._updateJointNode(Q);}k=new THREE.Vector3(Q.translation[0],Q.translation[1],Q.translation[2]);s=new THREE.Vector3(Q.scale[0],Q.scale[1],Q.scale[2]);l=new THREE.Quaternion(Q.quaternion[0],Q.quaternion[1],Q.quaternion[2],Q.quaternion[3]);D=Q.opacity;L=Q.parent;}else{y=this.getRestOpacity(L);x=this.getRestTransformation(L);if(!x){L=L.parent;continue;}k=new THREE.Vector3(x.translation[0],x.translation[1],x.translation[2]);s=new THREE.Vector3(x.scale[0],x.scale[1],x.scale[2]);l=new THREE.Quaternion(x.quaternion[0],x.quaternion[1],x.quaternion[2],x.quaternion[3]);D=y;if(c){var U=this._getEndPropertyInPreviousPlayback(L,A.Translate,c,true);if(U){k.x+=U[0];k.y+=U[1];k.z+=U[2];}var W=this._getEndPropertyInPreviousPlayback(L,A.Scale,c,true);if(W){s.x*=W[0];s.y*=W[1];s.z*=W[2];}var X=this._getEndPropertyInPreviousPlayback(L,A.Rotate,c,true);if(X){var Y=new THREE.Quaternion(X[0],X[1],X[2],X[3]);l=Y.multiply(l);}var Z=this._getEndPropertyInPreviousPlayback(L,A.Opacity,c,true);if(Z!=null){D*=Z;}}L=L.parent;}v=new THREE.Matrix4().compose(k,l,s);P.premultiply(v);M*=D;}var $=P.getInverse(P).multiply(C);$.decompose(k,l,s);j.translation=k.toArray();j.quaternion=l.toArray();j.scale=s.toArray();var _=function(a1,b1){if(a1===b1){return 1;}else if(Math.abs(b1)<0.0001){return 1;}return a1/b1;};j.opacity=_(E,M);};
r.prototype._propagateOpacityToJointChildren=function(c,i){if(!c||!i||c.length!==i.length){return this;}if(!this._jointCollection||!this._jointCollection.length){return this;}var j=new Map();this._jointCollection.forEach(function(l){var s=j.get(l.parent);if(!s){s=[];j.set(l.parent,s);}s.push(l);});var k=function(l,s){if(l.opacity!=null&&l.node&&l.node.userData){l.node.userData.opacity=l.opacity*s;if(l.node.userData.offsetOpacity!=null){l.node.userData.opacity*=l.node.userData.offsetOpacity;}}};c.forEach(function(l,s){var v=j.get(l);if(v){v.forEach(function(x){k(x,i[s]);});}});return this;};
r.prototype._updateMaterialInNode=function(c){var j=c.target;for(var i=0,l=j.children.length;i<l;i++){var k=j.children[i];if(k.userData.animatedColor){k._vkUpdateMaterialColor();}}var s=c.materialId;if(j.userData.materialId!==s){j.userData.materialId=s;this._scene._setNodeMaterial(j,s);}};
r.prototype.getSymbolNodes=function(c){var v=this.getCurrentView()||this._scene.getViews()[0];var s=v?v.getNodeInfos().reduce(function(i,j){if(j.target._vkGetNodeContentType()===p.Symbol&&j.target.parent){if(!c||c===j.target.userData.treeNode.sid){i.push(j.target);}}return i;},[]):[];return s;};
var w={"sphere":"360Image","plane":"2DImage"};
r.prototype._getBackgroundNodeInfos=function(){var c=null,j=[];function k(s){if(s.visible){if(s._vkGetNodeContentType()===p.Background&&w[s.name]){c=s;return;}var v=s.children;for(var i=0,l=v.length;i<l&&c===null;i++){k(v[i]);}}}k(this._scene.getSceneRef());if(c){j=c.parent.children.filter(function(i){return i._vkGetNodeContentType()===p.Background;});}return{current:c,all:j};};
r.prototype.getBackgroundImageType=function(){var c=this._getBackgroundNodeInfos().current;return c?w[c.name]:null;};
r.prototype.setBackgroundImageType=function(i){var c={"sphere":"360Image","plane":"2DImage"};var j=this._getBackgroundNodeInfos();var k=j.all.find(function(l){return i===c[l.name];});if(k&&!this.getVisibilityState(k)){if(j.current){j.current.visible=false;}k.visible=true;this.setVisibilityState(j.all,false,false);this.setVisibilityState(k,true,false);}return k;};
function B(c){return new THREE.Matrix4().set(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],0,0,0,1);}
r.prototype._resetNodesStatusByCurrenView=function(v,s,c){var i=this.getNodeHierarchy();if(i){var j;if(v){j=v.getPlaybacks();}var k=v.getNodeInfos();if(k){this._nodesTransitionHelper.clear();var l={nodeRefs:[],positions:[]};var x=new THREE.Vector3();var y=new THREE.Quaternion();var z=new THREE.Vector3();k.forEach(function(E){if(E.target===null){return;}if(E.transform){var F=B(E.transform);if(!o.equalMatrices(F,E.target.matrix,1e-6)){if((!j||!j.length)&&c){var G=i.createNodeProxy(E.target);this._nodesTransitionHelper.setNodeForDisplay(G,F);}else{F.decompose(x,y,z);l.nodeRefs.push(E.target);l.positions.push({translation:x.toArray(),quaternion:y.toArray(),scale:z.toArray()});}}}else if(E[A.Scale]&&E[A.Rotate]&&E[A.Translate]){l.nodeRefs.push(E.target);l.positions.push({translation:E[A.Translate].slice(),quaternion:E[A.Rotate].slice(),scale:E[A.Scale].slice()});}}.bind(this));if(v.userData&&v.userData.nodeStartDataByAnimation){v.userData.nodeStartDataByAnimation.forEach(function(E,F){if(E[A.Translate]&&E[A.Rotate]&&E[A.Scale]){l.nodeRefs.push(F);l.positions.push({translation:E[A.Translate].slice(),quaternion:E[A.Rotate].slice(),scale:E[A.Scale].slice()});}},this);}if(l.nodeRefs.length){this.setTransformation(l.nodeRefs,l.positions);}if(s){var C=[];var D=[];k.forEach(function(E){if(!E.target.userData.skipIt){(E.visible?C:D).push(E.target);}});this.setVisibilityState(i.getChildren()[0].children,false,true);if(this.getSymbolNodes().length){this.getSymbolNodes().forEach(function(E){E.traverse(function(F){F.visible=true;});});}this.setVisibilityState(C,true,false);this.setVisibilityState(D,false,false);this._startViewChangeNodeTransition();}}}};
r.prototype._startViewChangeNodeTransition=function(){this._nodesTransitionHelper.startDisplay(500);var c=true;this._nodesTransitionHelper.attachEventOnce("displayed",function(){c=false;});var i=function(){if(c){this._nodesTransitionHelper.displayNodesMoving();window.requestAnimationFrame(i);}}.bind(this);window.requestAnimationFrame(i);};
r.prototype._resetNodesMaterialAndOpacityByCurrenView=function(v){if(!v){return;}var c=v.getNodeInfos();if(c){c.forEach(function(j){if(!j.target){return;}this._updateMaterialInNode(j);}.bind(this));c.forEach(function(j){if(!j.target||!j.target.userData){return;}j.target.userData.opacity=j.opacity;});var i=this._scene.getSceneRef();i._vkSetOpacity(undefined,this._jointCollection);}this._selectedNodes.forEach(function(j){this._updateHighlightColor(j);}.bind(this));};
r.prototype._onActivateView=function(c,i,j){var v=this.getViewManager();if(!v||j.source.getId()!==v){return;}this.activateView(j.view,false,j.playViewGroup,j.notAnimateCameraChange);};
r.prototype.activateView=function(v,i,c,j){this.fireViewStateApplying({view:v});this.setJoints(undefined);this._resetNodesMaterialAndOpacityByCurrenView(v);this._prepareTransition(v);this._resetNodesStatusByCurrenView(v,true,true);this._highlightPlayer.reset(v,this._scene);this.fireViewStateApplied({view:v,ignoreAnimationPosition:i,notAnimateCameraChange:j,playViewGroup:c});a.getEventBus().publish("sap.ui.vk","viewStateApplied",{source:this,view:v,ignoreAnimationPosition:i,notAnimateCameraChange:j,playViewGroup:c});return this;};
r.prototype.setHighlightDisplayState=function(s){if(s===h.playing){this._highlightPlayer.start(Date.now());}else if(s===h.stopped){this._highlightPlayer.stop();}else if(s===h.pausing){this._highlightPlayer.pause(Date.now());}this.fireHighlightColorChanged({highlightColor:d(e(this._highlightColorABGR)),highlightColorABGR:this._highlightColorABGR});return this;};
r.prototype._startHighlight=function(){this._highlightPlayer.start(Date.now());return this;};
r.prototype._playHighlight=function(){return this._highlightPlayer.play(Date.now());};
r.prototype._prepareTransition=function(v){this._transitionPlayer.reset();this._transitionPlayer.fadeInNodes=[];this._transitionPlayer.fadeOutNodes=[];this._fadeInBackground=null;this._fadeOutBackground=null;var c=v.getNodeInfos();if(!c){return;}var i=new Set();var j=new Set();c.forEach(function(y){(y.visible?i:j).add(y.target);});var k=this._transitionPlayer.fadeInNodes;var l=this._transitionPlayer.fadeOutNodes;var s=this._nodeHierarchy;var x=function(y,z,C){if(!y.userData.skipIt){z=z&&i.has(y);C=C&&y.visible;}if(y.geometry&&z!==C){if(y.parent&&y.parent.userData.symbolContent){y.renderOrder=2;}(z?k:l).push(y);}if(y._vkGetNodeContentType()===p.Background){if(z){this._fadeInBackground=y;}else if(C){this._fadeOutBackground=y;}}y.children.forEach(function(D){x(D,z,C);});}.bind(this);s.getChildren()[0].children.forEach(function(y){x(y,true,true);});if(this._fadeInBackground){this._fadeInBackground.traverse(function(y){if(y.material){y.renderOrder=-2;}});}if(this._fadeOutBackground){this._fadeOutBackground.traverse(function(y){if(y.material){y.renderOrder=1;}});}};
r.prototype._startTransition=function(c){var i=this._transitionPlayer.fadeInNodes;var j=this._transitionPlayer.fadeOutNodes;if(i&&i.length){var k=new m("FadeIn",{duration:c/500.0,opacities:[0.0,1.0],cycles:1});this._transitionPlayer.addHighlights(k,i);}if(j&&j.length){var l=new m("FadeOut",{duration:c/500.0,opacities:[1.0,0.0],cycles:1,fadeOut:true});this._transitionPlayer.addHighlights(l,j);}if((i&&i.length)||(j&&j.length)){this._transitionPlayer.start(Date.now());this._transitionPlayer.play(Date.now());return c;}return 0;};
r.prototype._playTransition=function(){return this._transitionPlayer.play(Date.now());};
r.prototype.updateRestTransformation=function(c){var i=this.getCurrentView();if(!i){return this;}var j=i.getNodeInfos();if(j){j.forEach(function(k){if(k.target!==c){return;}c.updateMatrix();var l=c.matrix.elements;var v=[l[0],l[4],l[8],l[12],l[1],l[5],l[9],l[13],l[2],l[6],l[10],l[14]];k.transform=v;});}if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(k){if(!k.node||!k.parent){return;}if(k.parent===c||k.node===c){k.translation=null;k.scale=null;k.quaternion=null;if(k.node.userData){k.node.userData.offsetTranslation=null;k.node.userData.offsetQuaternion=null;k.node.userData.offsetScale=null;k.node.userData.originalRotationType=null;}}});this._jointCollection.forEach(function(k){if(!k.node||!k.parent){return;}if(k.parent===c){this._updateJointNode(k,this._playbackAssociatedWithJoints);this.restoreRestTransformation(k.node);}}.bind(this));this._jointCollection.forEach(function(k){if(!k.node||!k.parent){return;}if(k.node===c){this._updateJointNode(k,this._playbackAssociatedWithJoints);}},this);if(this._playbackAssociatedWithJoints){var s=this._playbackAssociatedWithJoints.getSequence();if(s){s._fireSequenceChanged();}}}return this;};
r.prototype.restoreRestTransformation=function(c){var i=this.getCurrentView();if(!i){return this;}var j=i.getNodeInfos();if(j){j.forEach(function(l){if(l.target!==c){return;}if(l.transform){var s=B(l.transform);s.decompose(c.position,c.quaternion,c.scale);}else if(l[A.Scale]&&l[A.Rotate]&&l[A.Translate]){c.position.set(l[A.Translate][0],l[A.Translate][1],l[A.Translate][2]);c.quaternion.set(l[A.Rotate][0],l[A.Rotate][1],l[A.Rotate][2],l[A.Rotate][3]);c.scale.set(l[A.Scale][0],l[A.Scale][1],l[A.Scale][2]);}c.updateMatrix();});}var k={changed:[c],transformation:[{position:c.position.toArray(),quaternion:c.quaternion.toArray(),scale:c.scale.toArray()}]};this.fireTransformationChanged(k);return this;};
r.prototype.setRestTransformation=function(c,i,j,s){var k=this.getCurrentView();if(!k){return this;}var l=k.getNodeInfos();if(l){l.forEach(function(x){if(x.target!==c){return;}if(!i||!j||!s){if(x.transform){var y=new THREE.Vector3();var z=new THREE.Quaternion();var C=new THREE.Vector3();var D=B(x.transform);D.decompose(y,z,C);if(!i){i=[y.x,y.y,y.z];}if(!s){s=[C.x,C.y,C.z];}if(!j){j=[z.x,z.y,z.z,z.w];}}else if(x[A.Scale]&&x[A.Rotate]&&x[A.Translate]){if(!i){i=x[A.Translate].slice();}if(!s){s=x[A.Scale].slice();}if(!j){j=x[A.Rotate].slice();}}}var E=new THREE.Vector3(i[0],i[1],i[2]);var F=new THREE.Quaternion(j[0],j[1],j[2],j[3]);var G=new THREE.Vector3(s[0],s[1],s[2]);var I=new THREE.Matrix4();I.compose(E,F,G);var J=I.elements;x.transform=[J[0],J[4],J[8],J[12],J[1],J[5],J[9],J[13],J[2],J[6],J[10],J[14]];});}if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(x){if(!x.node||!x.parent){return;}if(x.parent===c||x.node===c){x.translation=null;x.scale=null;x.quaternion=null;if(x.node.userData){x.node.userData.offsetTranslation=null;x.node.userData.offsetQuaternion=null;x.node.userData.offsetScale=null;x.node.userData.originalRotationType=null;}}});this._jointCollection.forEach(function(x){if(!x.node||!x.parent){return;}if(x.parent===c){this._updateJointNode(x,this._playbackAssociatedWithJoints);this.restoreRestTransformation(x.node);}},this);this._jointCollection.forEach(function(x){if(!x.node||!x.parent){return;}if(x.node===c){this._updateJointNode(x,this._playbackAssociatedWithJoints);}},this);if(this._playbackAssociatedWithJoints){var v=this._playbackAssociatedWithJoints.getSequence();if(v){v._fireSequenceChanged();}}}return this;};
r.prototype.getRestOpacity=function(c){var j;var k=this.getCurrentView();if(k){j=k.getNodeInfos();}var l=1;if(j&&j.length){for(var i=0;i<j.length;i++){var s=j[i];if(s.target!==c){continue;}if(s.opacity!==undefined&&s.opacity!==null){l=s.opacity;}break;}}return l;};
r.prototype.setRestOpacity=function(c,i){var j;var k=this.getCurrentView();if(k){j=k.getNodeInfos();}if(j){j.forEach(function(l){if(l.target!==c){return;}l.opacity=i;});}return this;};
r.prototype.restoreRestOpacity=function(c){var i;var j=this.getCurrentView();if(j){i=j.getNodeInfos();}if(i){i.forEach(function(k){if(k.target!==c){return;}var l=1;if(k.opacity!==undefined){l=k.opacity;}this.setOpacity(c,l);}.bind(this));}if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(k){if(!k.node||!k.parent){return;}if(k.parent===c||k.node===c){k.opacity=null;if(k.node.userData){k.node.userData.offsetOpacity=null;}}});this._jointCollection.forEach(function(k){if(!k.node||!k.parent){return;}if(k.parent===c){this._updateJointNode(k,this._playbackAssociatedWithJoints);this.restoreRestOpacity(k.node);}},this);this._jointCollection.forEach(function(k){if(!k.node||!k.parent){return;}if(k.node===c){this._updateJointNode(k,this._playbackAssociatedWithJoints);}},this);if(this._playbackAssociatedWithJoints){var s=this._playbackAssociatedWithJoints.getSequence();if(s){s._fireSequenceChanged();}}}return this;};
r.prototype.updateRestOpacity=function(c){var i;var j=this.getCurrentView();if(j){i=j.getNodeInfos();}if(i){i.forEach(function(k){if(k.target!==c){return;}if(c.userData&&c.userData.opacity!==undefined&&c.userData.opacity!==null){k.opacity=c.userData.opacity;}else{delete k.opacity;}});}if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(k){if(!k.node||!k.parent){return;}if(k.parent===c||k.node===c){k.opacity=null;if(k.node.userData){k.node.userData.offsetOpacity=null;}}});this._jointCollection.forEach(function(k){if(!k.node||!k.parent){return;}if(k.node===c){this._updateJointNode(k,this._playbackAssociatedWithJoints);}},this);if(this._playbackAssociatedWithJoints){var s=this._playbackAssociatedWithJoints.getSequence();if(s){s._fireSequenceChanged();}}}return this;};
r.prototype.getRestTransformationWorld=function(c){var j;var k=this.getCurrentView();if(k){j=k.getNodeInfos();}var l;if(j){var s=new THREE.Matrix4();while(c){for(var i=0;i<j.length;i++){var v=j[i];if(v.target!==c){continue;}var x;if(v.transform){x=B(v.transform);}else if(v[A.Scale]&&v[A.Rotate]&&v[A.Translate]){var y=new THREE.Vector3(v[A.Translate][0],v[A.Translate][1],v[A.Translate][2]);var z=new THREE.Quaternion(v[A.Rotate][0],v[A.Rotate][1],v[A.Rotate][2],v[A.Rotate][3]);var C=new THREE.Vector3(v[A.Scale][0],v[A.Scale][1],v[A.Scale][2]);x=new THREE.Matrix4().compose(y,z,C);}if(x){s.premultiply(x);}break;}c=c.parent;}var D=new THREE.Vector3();var E=new THREE.Quaternion();var F=new THREE.Vector3();s.decompose(D,E,F);l={};l.translation=D.toArray();l.quaternion=E.toArray();l.scale=F.toArray();}if(!l){l=this.getTransformationWorld(c);}return l;};
r.prototype.getRestTransformation=function(c){var i;var j=this.getCurrentView();if(j){i=j.getNodeInfos();}var k;if(i){i.forEach(function(l){if(l.target!==c){return;}if(l.transform){var s=new THREE.Vector3();var v=new THREE.Quaternion();var x=new THREE.Vector3();var y=B(l.transform);y.decompose(s,v,x);k={};k.translation=s.toArray();k.quaternion=v.toArray();k.scale=x.toArray();}else if(l[A.Scale]&&l[A.Rotate]&&l[A.Translate]){k={};k.translation=l[A.Translate].slice();k.quaternion=l[A.Rotate].slice();k.scale=l[A.Scale].slice();}});}if(!k&&c){k={};k.translation=c.userData.position?c.userData.position.toArray():c.position.toArray();k.quaternion=c.userData.quaternion?c.userData.quaternion.toArray():c.quaternion.toArray();k.scale=c.userData.scale?c.userData.scale.toArray():c.scale.toArray();k.matrix=c.matrix.clone();}return k;};
r.prototype._addToTransformation=function(c,j,k,s,l,v){var x={};var i;if(j){x.translation=[];for(i=0;i<3;i++){x.translation.push(j[i]+c.translation[i]);}}else{x.translation=c.translation;}if(s){x.scale=[];for(i=0;i<3;i++){x.scale.push(s[i]*c.scale[i]);}}else{x.scale=c.scale;}if(k){var y=new THREE.Quaternion(c.quaternion[0],c.quaternion[1],c.quaternion[2],c.quaternion[3]);var z=new THREE.Quaternion(k[0],k[1],k[2],k[3]);if(l===R.Euler){var C=v?v[3]:6;var D=o.threeQuatToNeutralEuler(y,C);var E=v?v:o.threeQuatToNeutralEuler(z,C);D[0]+=E[0];D[1]+=E[1];D[2]+=E[2];x.quaternion=o.glMatrixQuatToNeutral(o.neutralEulerToGlMatrixQuat(D));}else{var F=new THREE.Matrix4().makeRotationFromQuaternion(y);var G=new THREE.Matrix4().makeRotationFromQuaternion(z);F.premultiply(G);y.setFromRotationMatrix(F);x.quaternion=[y.x,y.y,y.z,y.w];}}else{x.quaternion=c.quaternion;}return x;};
r.prototype.setInterpolatedRelativeValues=function(c,v){if(!c.userData){c.userData={};}if(v.rtranslate){c.userData.offsetTranslation=v.rtranslate;}else{c.userData.offsetTranslation=null;}if(v.rscale){c.userData.offsetScale=v.rscale;}else{c.userData.offsetScale=null;}if(v.rrotate){c.userData.offsetQuaternion=v.rrotate;c.userData.originalRotationType=v.originalRotationType;}else{c.userData.offsetQuaternion=null;c.userData.originalRotationType=null;}if(v.Euler){c.userData.Euler=v.Euler;}else{c.userData.Euler=null;}if(v.ropacity!=null){c.userData.offsetOpacity=v.ropacity;}else{c.userData.offsetOpacity=null;}return this;};
r.prototype._setJointNodeMatrix=function(){if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(j){if(!j.node||!j.parent){return;}var c=j.node;if(c.userData.skipUpdateJointNode){return;}var i={};i.translation=j.translation.slice();i.scale=j.scale.slice();i.quaternion=j.quaternion.slice();var k=this._addToTransformation(i,c.userData.offsetTranslation,c.userData.offsetQuaternion,c.userData.offsetScale,c.userData.originalRotationType,c.userData.Euler);c.position.fromArray(k.translation);c.scale.fromArray(k.scale);c.quaternion.fromArray(k.quaternion);c.updateMatrix();var l=c.quaternion.clone();var s=new THREE.Matrix4();if(j.parent){j.parent.updateMatrixWorld();s=j.parent.matrixWorld.clone();c.matrixWorld.multiplyMatrices(j.parent.matrixWorld,c.matrix);}else{c.matrixWorld.copy(c.matrix);}var v=new THREE.Matrix4();if(c.parent){v=c.parent.matrixWorld.clone();c.matrix.getInverse(c.parent.matrixWorld).multiply(c.matrixWorld);}else{c.matrix.copy(c.matrixWorld);}c.matrix.decompose(c.position,c.quaternion,c.scale);var x=[c.scale.x,c.scale.y,c.scale.z];this._adjustQuaternionAndScale(s,v,l,c.quaternion,k.scale,x);c.scale.x=x[0];c.scale.y=x[1];c.scale.z=x[2];if(j.nodesToUpdate){j.nodesToUpdate.forEach(function(y){if(y.matrixAutoUpdate){y.updateMatrix();}y.matrixWorld.multiplyMatrices(y.parent.matrixWorld,y.matrix);});}}.bind(this));}};
r.prototype._getEndPropertyInLastPlayback=function(c,i){var j;var l=this.getCurrentView();if(!l){return j;}var s=l.getPlaybacks();if(!s||!s.length){return j;}for(var k=s.length-1;k>=0;k--){var v=s[k];var x=v.getSequence();if(x._convertedFromAbsolute){return j;}j=v.getNodeBoundaryProperty(c,i,true);if(j){break;}}return j;};
r.prototype._getEndPropertyInPreviousPlayback=function(c,k,l,s){var v;var x=this._getJointByChildNode(c);if(x&&!s){return v;}var y=l.getSequence();if(y&&y._convertedFromAbsolute){return v;}var z=this.getCurrentView();if(!z){return v;}var C=z.getPlaybacks();for(var i=1;i<C.length;i++){var D=C[i];if(D!==l){continue;}for(var j=i-1;j>=0;j--){var E=C[j];v=E.getNodeBoundaryProperty(c,k,true);if(v){break;}}}return v;};
r.prototype._convertTracksToRelative=function(s,c){if((c&&s._convertionDoneForReversed)||(!c&&s._convertionDone)){return this;}s._convertedFromAbsolute=false;var l=this.getCurrentView();if(!l){return this;}var v=s.getNodeAnimation();if(!v||!v.length){return this;}var x=l.getNodeInfos();if(x){x.forEach(function(y){var z;for(var i=0;i<v.length;i++){if(y.target===v[i].nodeRef){z=v[i];break;}}if(!z){return;}var C=[0,0,0];var D=[1,1,1];var E=new THREE.Quaternion();var F=new THREE.Vector3();var G=new THREE.Vector3();if(y.transform){var I=B(y.transform);I.decompose(F,E,G);C=F.toArray();D=G.toArray();}else if(y[A.Scale]&&y[A.Rotate]&&y[A.Translate]){C=y[A.Translate].slice();E=new THREE.Quaternion(y[A.Rotate][0],y[A.Rotate][1],y[A.Rotate][2],y[A.Rotate][3]);D=y[A.Scale].slice();}else{y.target.matrix.decompose(F,E,G);C=F.toArray();D=G.toArray();}var j,J,K,L;var M=z[A.Translate];if(M&&M.getIsAbsoluteValue()){J=M.getKeysCount();for(j=0;j<J;j++){K=M.getKey(j);L=[K.value[0]-C[0],K.value[1]-C[1],K.value[2]-C[2]];M.updateKey(j,L,true);}M.setIsAbsoluteValue(false);s._convertedFromAbsolute=true;}var P=z[A.Scale];if(P&&P.getIsAbsoluteValue()){J=P.getKeysCount();for(j=0;j<J;j++){K=P.getKey(j);L=[K.value[0]/D[0],K.value[1]/D[1],K.value[2]/D[2]];P.updateKey(j,L,true);}P.setIsAbsoluteValue(false);s._convertedFromAbsolute=true;}var Q=z[A.Opacity];if(Q&&Q.getIsAbsoluteValue()){var U=this.getRestOpacity(y.target);if(!U){U=1.0;}J=Q.getKeysCount();for(j=0;j<J;j++){K=Q.getKey(j);L=K.value/U;Q.updateKey(j,L,true);}Q.setIsAbsoluteValue(false);s._convertedFromAbsolute=true;}var W=z[A.Rotate];if(W&&W.getIsAbsoluteValue()){var X;var Y=new THREE.Matrix4().makeRotationFromQuaternion(E);var Z=new THREE.Matrix4().getInverse(Y);var $=new THREE.Matrix4();var _=new THREE.Matrix4();J=W.getKeysCount();var a1=W.getKeysType();for(j=0;j<J;j++){K=W.getKey(j);if(a1===n.Quaternion){X=new THREE.Quaternion(K.value[0],K.value[1],K.value[2],K.value[3]);$.makeRotationFromQuaternion(X);_.multiplyMatrices($,Z);X.setFromRotationMatrix(_);L=X.toArray();W.updateKey(j,L,true);}else if(a1===n.Euler){var k=K.value;var e0=o.threeQuatToNeutralEuler(E,k[3]);L=[k[0]-e0[0]+o.getModulatedAngularValue(k[0]),k[1]-e0[1]+o.getModulatedAngularValue(k[1]),k[2]-e0[2]+o.getModulatedAngularValue(k[2]),k[3]];W.updateKey(j,L,true);}else if(j===0){var c1=new THREE.Vector3(K.value[0],K.value[1],K.value[2]);$.makeRotationAxis(c1,K.value[3]);_.multiplyMatrices($,Z);X=new THREE.Quaternion().setFromRotationMatrix(_);L=this._convertQuaternionToAngleAxis(X);W.updateKey(j,L,true);break;}}W.setIsAbsoluteValue(false);s._convertedFromAbsolute=true;}}.bind(this));}if(!c){s._convertionDone=true;s._convertionDoneForReversed=false;}else{s._convertionDone=false;s._convertionDoneForReversed=true;}return this;};
r.prototype._getTrackKeys=function(c){var k=[];var i=c.getKeysCount();for(var j=0;j<i;j++){var l=c.getKey(j);var v;if(Array.isArray(l.value)){v=l.value.slice();}else{v=l.value;}k.push({time:l.time,value:v});}return k;};
r.prototype._setJointNodeOffsets=function(c,i){var j=this._getJointByChildNode(c);if(j){var k=new THREE.Matrix4();if(c.parent){k=c.parent.matrixWorld.clone();}var l=new THREE.Matrix4();c.updateMatrixWorld();var s=new THREE.Matrix4();if(j.parent){j.parent.updateMatrixWorld();s=j.parent.matrixWorld.clone();l.getInverse(j.parent.matrixWorld).multiply(c.matrixWorld);}else{l.copy(c.matrixWorld);}var v=new THREE.Vector3();var x=new THREE.Vector3();var y=new THREE.Quaternion();l.decompose(v,y,x);if(i===A.Translate){var z=v.toArray();c.userData.offsetTranslation=[z[0]-j.translation[0],z[1]-j.translation[1],z[2]-j.translation[2]];}else if(i===A.Scale){var C=x.toArray();this._adjustQuaternionAndScale(k,s,c.quaternion,y,c.scale.toArray(),C);c.userData.offsetScale=[C[0]/j.scale[0],C[1]/j.scale[1],C[2]/j.scale[2]];}else{this._adjustQuaternionAndScale(k,s,c.quaternion,y,c.scale.toArray(),x.toArray());var D=new THREE.Quaternion(j.quaternion[0],j.quaternion[1],j.quaternion[2],j.quaternion[3]);var E=new THREE.Matrix4().makeRotationFromQuaternion(D);var F=new THREE.Matrix4().getInverse(E);var M=new THREE.Matrix4().makeRotationFromQuaternion(y);var G=new THREE.Matrix4().multiplyMatrices(M,F);var I=new THREE.Quaternion().setFromRotationMatrix(G);c.userData.offsetQuaternion=I.toArray();}}return this;};
r.prototype.setTranslationKey=function(c,i,j,k){var s=j.getSequence();if(!s){return null;}var l;var v=new THREE.Vector3();c.matrix.decompose(v,new THREE.Quaternion(),new THREE.Vector3());var x=this._getJointByChildNode(c);if(x){l=x.translation.slice();c.updateMatrixWorld();var y=new THREE.Matrix4();if(x.parent){x.parent.updateMatrixWorld();y.getInverse(x.parent.matrixWorld).multiply(c.matrixWorld);}else{y.matrix.copy(c.matrixWorld);}y.decompose(v,new THREE.Quaternion(),new THREE.Vector3());}else{var z=this.getRestTransformation(c);l=z.translation;}var C=v.toArray();var D=[C[0]-l[0],C[1]-l[1],C[2]-l[2]];var E=this._getEndPropertyInPreviousPlayback(c,A.Translate,j);if(E){D[0]-=E[0];D[1]-=E[1];D[2]-=E[2];}var F=s.getNodeAnimation(c,A.Translate);var G;if(!F){F=this._scene.createTrack(null,{trackValueType:n.Vector3,isAbsoluteValue:false});s.setNodeAnimation(c,A.Translate,F,true);}else{G=this._getTrackKeys(F);}F.insertKey(i,D,k);var I=this._getTrackKeys(F);return{KeyValue:D,absoluteValue:C,offset:E,PreviousTrack:G,CurrentTrack:I};};
r.prototype._adjustQuaternionAndScale=function(c,j,k,l,s,x){function y(v,U,W,X){var Y=Math.abs(v.dot(U));var Z=Math.abs(v.dot(W));var $=Math.abs(v.dot(X));if(Y>=Z&&Y>=$){return 0;}else if(Z>=Y&&Z>=$){return 1;}else{return 2;}}if(s[0]>0&&s[1]>0&&s[2]>0){return;}var z=c.clone().multiply(new THREE.Matrix4().makeRotationFromQuaternion(k));var C=new THREE.Matrix4().makeRotationFromQuaternion(l);var D=j.clone().multiply(C);var E=new THREE.Vector3();var F=new THREE.Vector3();var G=new THREE.Vector3();z.extractBasis(E,F,G);var I=[E,F,G];var J=new THREE.Vector3();var K=new THREE.Vector3();var L=new THREE.Vector3();D.extractBasis(J,K,L);var M=[1,1,1];for(var i=0;i<3;i++){var P=y(I[i],J,K,L);if(s[i]*x[P]<0){M[P]=-1;x[P]=-x[P];}}C.scale(new THREE.Vector3(M[0],M[1],M[2]));var Q=new THREE.Quaternion().setFromRotationMatrix(C);l.x=Q.x;l.y=Q.y;l.z=Q.z;l.w=Q.w;};
r.prototype.setScaleKey=function(c,i,j,k){var s=j.getSequence();if(!s){return null;}var l;var v=c.scale.toArray();var x=c.quaternion.clone();var y=this._getJointByChildNode(c);if(y){var z=new THREE.Matrix4();if(c.parent){z=c.parent.matrixWorld.clone();}l=y.scale.slice();c.updateMatrixWorld();var C=new THREE.Matrix4();var D=new THREE.Matrix4();if(y.parent){y.parent.updateMatrixWorld();D=y.parent.matrixWorld.clone();C.getInverse(y.parent.matrixWorld).multiply(c.matrixWorld);}else{C.copy(c.matrixWorld);}var E=new THREE.Quaternion();var F=new THREE.Vector3();C.decompose(new THREE.Vector3(),E,F);var G=F.toArray();this._adjustQuaternionAndScale(z,D,x,E,v,G);v=G;}else{var I=this.getRestTransformation(c);l=I.scale;}var J=[v[0]/l[0],v[1]/l[1],v[2]/l[2]];var K=this._getEndPropertyInPreviousPlayback(c,A.Scale,j);if(K){J[0]/=K[0];J[1]/=K[1];J[2]/=K[2];}var L=s.getNodeAnimation(c,A.Scale);var M;if(!L){L=this._scene.createTrack(null,{trackValueType:n.Vector3,isAbsoluteValue:false});s.setNodeAnimation(c,A.Scale,L,true);}else{M=this._getTrackKeys(L);}L.insertKey(i,J,k);var P=this._getTrackKeys(L);return{KeyValue:J,absoluteValue:v,offset:K,PreviousTrack:M,CurrentTrack:P};};
r.prototype.setRotationKey=function(c,i,j,k,l){var s=k.getSequence();if(!s){return null;}var v=36;var x=[j[0],j[1],j[2],v];var y=s.getNodeAnimation(c,A.Rotate);if(y&&y.getKeysType()!==n.Euler){return null;}var z;if(!y){y=this._scene.createTrack(null,{trackValueType:n.Euler,isAbsoluteValue:false});s.setNodeAnimation(c,A.Rotate,y,true);}else{z=this._getTrackKeys(y);}y.insertKey(i,x,l);var C=this._getTrackKeys(y);var D=new THREE.Quaternion();var E=new THREE.Euler(j[0],j[1],j[2]);D.setFromEuler(E);var F=this._getEndPropertyInPreviousPlayback(c,A.Rotate,k);if(F){var G=new THREE.Quaternion(F[0],F[1],F[2],F[3]);D.multiply(G);}var I=this._getJointByChildNode(c);var J=new THREE.Quaternion();if(I){J.fromArray(I.quaternion);}else{var K=this.getRestTransformation(c);J.fromArray(K.quaternion);}D.multiply(J);return{KeyValue:x,absoluteValue:D.toArray(),offset:F,PreviousTrack:z,CurrentTrack:C};};
r.prototype.setAxisAngleRotationKey=function(c,i,j,k,l){var s=k.getSequence();if(!s){return null;}var v=s.getNodeAnimation(c,A.Rotate);if(v&&v.getKeysType()!==n.AngleAxis){if(!v.setKeysType(n.AngleAxis)){return null;}}var x=[j[0],j[1],j[2],j[3]];var y;if(!v){v=this._scene.createTrack(null,{trackValueType:n.AngleAxis,isAbsoluteValue:false});s.setNodeAnimation(c,A.Rotate,v,true);}else{y=this._getTrackKeys(v);}v.insertKey(i,x,l);var z=this._getTrackKeys(v);return{KeyValue:x,PreviousTrack:y,CurrentTrack:z};};
r.prototype.getTotalOpacity=function(c){return c._vkGetTotalOpacity(this._jointCollection);};
r.prototype.setTotalOpacity=function(c,i){var j=1;var k=this._getJointByChildNode(c);if(k&&k.parent){j=k.parent._vkGetTotalOpacity(this._jointCollection);}else if(c.parent){j=c.parent._vkGetTotalOpacity(this._jointCollection);}if(!c.userData){c.userData={};}var l=this.getOpacity(c);if(j!==0.0){l=i/j;}else{i=0.0;}c._vkSetOpacity(l,this._jointCollection);var s={changed:c,opacity:l};this.fireOpacityChanged(s);return{opacity:l,totalOpacity:i};};
r.prototype.setOpacityKey=function(c,i,j,k){var s=j.getSequence();if(!s){return null;}var v=1;if(c.userData&&c.userData.opacity!==undefined&&c.userData.opacity!==null){v=c.userData.opacity;}var l=this.getRestOpacity(c);if(!l&&s._convertedFromAbsolute){l=1;}v/=l;var x=this._getEndPropertyInPreviousPlayback(c,A.Opacity,j);if(x){v/=x;}var y=s.getNodeAnimation(c,A.Opacity);var z;if(!y){y=this._scene.createTrack(null,{trackValueType:n.Opacity});s.setNodeAnimation(c,A.Opacity,y,true);}else{z=this._getTrackKeys(y);}y.insertKey(i,v,k);var C=this._getTrackKeys(y);return{KeyValue:v,totalOpacity:this.getTotalOpacity(c),PreviousTrack:z,CurrentTrack:C};};
q=function(){this._visibilityChanges=new Set();};
q.prototype.getInfo=function(c){var i=[];this._visibilityChanges.forEach(function(j){var k=c.createNodeProxy(j);var v=k.getVeId();c.destroyNodeProxy(k);if(v){i.push(v);}else{i.push(c.getScene().nodeRefToPersistentId(j));}});return i;};
q.prototype.clear=function(){this._visibilityChanges.clear();};
q.prototype.trackNodeRef=function(c){if(this._visibilityChanges.has(c)){this._visibilityChanges.delete(c);}else{this._visibilityChanges.add(c);}};
return r;});
sap.ui.predefine('sap/ui/vk/threejs/Viewport',["../Core","../ViewportBase","sap/ui/core/ResizeHandler","sap/ui/events/KeyCodes","../Loco","../thirdparty/three","../ViewStateManager","./ViewportGestureHandler","./OrthographicCamera","./PerspectiveCamera","./NodesTransitionHelper","../Messages","sap/ui/base/ManagedObjectObserver","./ViewportRenderer","../CameraProjectionType","../CameraFOVBindingType","../VisibilityMode","../ZoomTo","../SelectionMode","../RenderMode","../getResourceBundle","../cssColorToColor","../ViewStateManager","./ViewStateManager","./HitTester","./Scene","./ContentDeliveryService","../SafeArea","../Annotation","../NodeContentType","sap/base/Log"],function(v,V,R,K,L,t,c,d,O,P,N,M,e,f,C,g,h,Z,S,j,k,m,o,T,H,p,q,r,A,s,u){"use strict";
var w=V.extend("sap.ui.vk.threejs.Viewport",{metadata:{library:"sap.ui.vk",events:{cameraChanged:{parameters:{position:"float[]",quaternion:"float[]",zoom:"float"},enableEventBubbling:true},frameRenderingFinished:{}}}});
var B=w.getMetadata().getParent().getClass().prototype;THREE.PropertyBinding.prototype.GetterByBindingType[0]=function(b,a){b[a]=this.targetObject[this.propertyName];};
w.prototype.init=function(){if(B.init){B.init.call(this);}this._resizeListenerId=null;this._renderLoopRequestId=0;this._renderLoopFunction=this._renderLoop.bind(this);this._shouldRenderFrame=true;this._clippingPlanes=[];this._renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});this._renderer.setPixelRatio(window.devicePixelRatio);this._renderer.setSize(1,1);this._renderer.shadowMap.enabled=true;this._hitTester=new H();this._scene=null;this._camera=new P();this._upAxis=2;var b=new THREE.Vector4();var a=new THREE.Vector4();this._updateColor(b,this.getBackgroundColorTop());this._updateColor(a,this.getBackgroundColorBottom());this._checkBackgroundColor();this._backgroundMaterial=new THREE.ShaderMaterial({uniforms:{topColor:{value:b},bottomColor:{value:a}},vertexShader:["varying float vPos;","void main() {","	gl_Position = vec4(position, 1.0);","	vPos = position.y * -0.5 + 0.5;","}"].join("\n"),fragmentShader:["uniform vec4 topColor;","uniform vec4 bottomColor;","varying float vPos;","void main() {","	gl_FragColor = mix(topColor, bottomColor, vPos);","}"].join("\n"),side:THREE.DoubleSide,depthTest:false,depthWrite:false,blending:THREE.NoBlending});var i=new THREE.Geometry();i.vertices.push(new THREE.Vector3(-1,1,0),new THREE.Vector3(1,1,0),new THREE.Vector3(-1,-1,0),new THREE.Vector3(1,-1,0));i.faces.push(new THREE.Face3(0,2,1),new THREE.Face3(1,2,3));this._backgroundCamera=new THREE.Camera();this._backgroundScene=new THREE.Scene();this._backgroundScene.add(new THREE.Mesh(i,this._backgroundMaterial));this._xrayColor1=new THREE.Vector4(0,0.75,1,0.45);this._xrayColor2=new THREE.Vector4(0,0,1,0);this._xrayMaterial=new THREE.ShaderMaterial({uniforms:{color1:{value:this._xrayColor1},color2:{value:this._xrayColor2}},vertexShader:["#include <clipping_planes_pars_vertex>","varying vec3 vNormal;","void main() {","#include <begin_vertex>","#include <project_vertex>","#include <clipping_planes_vertex>","#include <beginnormal_vertex>","#include <defaultnormal_vertex>","	vNormal = normalize( transformedNormal );","}"].join("\n"),fragmentShader:["#include <clipping_planes_pars_fragment>","uniform vec4 color1;","uniform vec4 color2;","varying vec3 vNormal;","void main() {","#include <clipping_planes_fragment>","	gl_FragColor = mix(color1, color2, abs(normalize(vNormal).z));","}"].join("\n"),side:THREE.DoubleSide,depthWrite:false,depthFunc:THREE.LessDepth,blending:THREE.NormalBlending,clipping:true,transparent:true});this._viewportGestureHandler=new d(this);this._loco=new L(this);this._loco.addHandler(this._viewportGestureHandler,-1);this._zoomedObject=null;this._cdsLoader=null;this.attachCameraChanged(function(l){this.setShouldRenderFrame();});this._sceneObserver=new e(this.setShouldRenderFrame.bind(this));this._currentViewIndex=0;this._currentView=null;v.getEventBus().subscribe("sap.ui.vk","viewStateApplied",this._onViewStateApplied,this);};
w.prototype.cameraUpdateCompleted=function(a){this.fireViewFinished({viewIndex:this._currentViewIndex});};
w.prototype.exit=function(){v.getEventBus().unsubscribe("sap.ui.vk","viewStateApplied",this._onViewStateApplied,this);this._loco.removeHandler(this._viewportGestureHandler);this._viewportGestureHandler.destroy();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this._stopRenderLoop();this.setScene(null);this.setCamera(null);this._renderer.renderLists.dispose();this._renderer.dispose();this._renderer=null;this._backgroundCamera=null;this._backgroundMaterial=null;this._backgroundScene=null;this._loco=null;this._viewportGestureHandler=null;this._eyePointLight=null;this._hitTester=null;if(this._cdsLoader){this._cdsLoader.detachSceneUpdated(this._handleCdsSceneUpdate,this);}if(B.exit){B.exit.call(this);}};
w.prototype.onSetViewStateManager=function(a){this._viewStateManager=a;a.attachVisibilityChanged(this.setShouldRenderFrame,this);a.attachOpacityChanged(this.setShouldRenderFrame,this);a.attachTintColorChanged(this.setShouldRenderFrame,this);a.attachHighlightColorChanged(this.setShouldRenderFrame,this);a.attachTransformationChanged(this.setShouldRenderFrame,this);a.attachOutlineColorChanged(this.setShouldRenderFrame,this);a.attachOutlineWidthChanged(this.setShouldRenderFrame,this);a.attachOutliningChanged(this._onOutliningOrSelectionChanged,this);a.attachSelectionChanged(this._onOutliningOrSelectionChanged,this);};
w.prototype.onRemoveViewStateManager=function(a){a.detachOutliningChanged(this._onOutliningOrSelectionChanged,this);a.detachSelectionChanged(this._onOutliningOrSelectionChanged,this);a.detachVisibilityChanged(this.setShouldRenderFrame,this);a.detachOpacityChanged(this.setShouldRenderFrame,this);a.detachTintColorChanged(this.setShouldRenderFrame,this);a.detachHighlightColorChanged(this.setShouldRenderFrame,this);a.detachTransformationChanged(this.setShouldRenderFrame,this);a.detachOutlineColorChanged(this.setShouldRenderFrame,this);a.detachOutlineWidthChanged(this.setShouldRenderFrame,this);this._viewStateManager=null;};
w.prototype._startRenderLoop=function(){if(!this._renderLoopRequestId){this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);}return this;};
w.prototype._stopRenderLoop=function(){if(this._renderLoopRequestId){window.cancelAnimationFrame(this._renderLoopRequestId);this._renderLoopRequestId=0;}return this;};
w.prototype.setBackgroundColorTop=function(a){B.setBackgroundColorTop.call(this,a);if(this._backgroundMaterial!==null){this._updateColor(this._backgroundMaterial.uniforms.topColor.value,a);this._checkBackgroundColor();}return this;};
w.prototype.setBackgroundColorBottom=function(a){B.setBackgroundColorBottom.call(this,a);if(this._backgroundMaterial!==null){this._updateColor(this._backgroundMaterial.uniforms.bottomColor.value,a);this._checkBackgroundColor();}return this;};
w.prototype.setClippingPlanes=function(a){this._clippingPlanes=a;return this;};
w.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this._stopRenderLoop();};
w.prototype.onAfterRendering=function(){var a=this.getDomRef();a.appendChild(this._renderer.domElement);this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._handleResize({size:{width:a.clientWidth,height:a.clientHeight}});this._startRenderLoop();};
w.prototype._handleResize=function(a){if(!this._camera||!this._renderer){return false;}this.getSafeArea().resize();var b=a.size.width;var i=a.size.height;if(this._camera){this._camera.update(b,i);}this._renderer.setSize(b,i);this.fireResize({size:{width:b,height:i}});this.setShouldRenderFrame();return true;};
w.prototype.setScene=function(a){if(this._scene){var n=this._scene.getDefaultNodeHierarchy();n.detachChanged(this._clearAnnotations,this);n.detachNodeCreated(this._nodeCreatedHandler,this);}this._scene=a;this._homeCamera=null;this._currentViewIndex=0;this._currentView=null;this._sceneObserver.disconnect();var b=this._getNativeScene();if(b){this._sceneObserver.observe(this._scene,{properties:["doubleSided"]});var l;for(var i=0;i<b.children.length;i++){l=b.children[i];if(l.private&&l.name==="DefaultLights"&&l.children.length){if(l.children[0]instanceof THREE.PointLight){this._eyePointLight=l.children[0];}}}}if(this._scene){this._scene.getDefaultNodeHierarchy().attachChanged(this._clearAnnotations,this);this._scene.getDefaultNodeHierarchy().attachNodeCreated(this._nodeCreatedHandler,this);}if(this._scene){var x=this._scene.getInitialView();if(x&&this._getViewStateManagerThreeJS()){this.activateView(x,false,true);}}this._clearAnnotations(true);this.setShouldRenderFrame();return this;};
w.prototype.getScene=function(){return this._scene;};
w.prototype._getNativeScene=function(){return this._scene?this._scene.getSceneRef():null;};
w.prototype._getNativeCamera=function(){return this._camera?this._camera.getCameraRef():null;};
w.prototype._clearAnnotations=function(a){if(a){this.destroyAnnotations();}else{this.getAnnotations().forEach(function(b){if(b.autoGenerated){this.removeAnnotation(b);}},this);}this._annotationsLoaded=false;};
w.prototype._nodeCreatedHandler=function(a){var n=a.getParameter("nodeRef");if(n._vkGetNodeContentType()==s.Annotation){var b=this.getCurrentView();if(b){b.getNodeInfos().push({target:n,visible:true});}}};
var D=new THREE.Vector2();
w.prototype.setCamera=function(a){if(B.setCamera){B.setCamera.call(this,a);}var b=this.getCamera();if(b&&this._renderer){this._renderer.getSize(D);b.update(D.x,D.y);if(!this._homeCamera&&b.getCameraRef()){this._homeCamera=b.getCameraRef().clone();}}this.setShouldRenderFrame();return this;};
w.prototype.getRenderer=function(){return this._renderer;};
w.prototype._getViewStateManagerThreeJS=function(){if(this._viewStateManager){if(this._viewStateManager instanceof T){return this._viewStateManager;}if(this._viewStateManager instanceof o&&this._viewStateManager._implementation instanceof T){return this._viewStateManager._implementation;}}return null;};
w.prototype._updateBoundingBoxesIfNeeded=function(){var a=this._getViewStateManagerThreeJS();if(a){a._updateBoundingBoxesIfNeeded();}};
w.prototype._updateColor=function(a,b){var i=m(b);a.color=new THREE.Color(i.red/255,i.green/255,i.blue/255);a.alpha=i.alpha;a.x=a.color.r*a.alpha;a.y=a.color.g*a.alpha;a.z=a.color.b*a.alpha;a.w=a.alpha;};
w.prototype._checkBackgroundColor=function(){var a=this.getBackgroundColorTop();if(a===this.getBackgroundColorBottom()){if(this._backgroundColor===null){this._backgroundColor=new THREE.Vector4();}this._updateColor(this._backgroundColor,a);}else{this._backgroundColor=null;}this.setShouldRenderFrame();};
w.prototype._handleCdsSceneUpdate=function(){this.setShouldRenderFrame();};
w.prototype.setShouldRenderFrame=function(){this._shouldRenderFrame=true;return this;};
w.prototype.shouldRenderFrame=function(){return this._shouldRenderFrame;};
w.prototype.setRenderMode=function(a){this.setProperty("renderMode",a,true);if(this._scene){switch(a){case j.LineIllustration:case j.ShadedIllustration:case j.SolidOutline:this._scene._createOutlineGeometry(a);break;default:this._scene._hideOutlineGeometry();break;}}this.setShouldRenderFrame();return this;};
w.prototype.hitTest=function(x,y){var n=this._getNativeScene();var a=this._getNativeCamera();if(!a||!n){return null;}var b=this._renderer.domElement;return this._hitTester.hitTest(x-b.clientLeft,y-b.clientTop,b.clientWidth,b.clientHeight,this._renderer,n,a,this._clippingPlanes);};
w.prototype._isRedlineActivated=function(){var n=this._getNativeCamera();return n?n.userData.isRedlineActivated:false;};
w.prototype._isPanoramicActivated=function(){var b=this._viewStateManager&&this._viewStateManager.getBackgroundImageType();return b==="360Image";};
w.prototype.tap=function(x,y,i){if(!i){if(this._viewStateManager){var a=this.hitTest(x,y);var n=a&&a.object;this.tapObject(n);if(n!==null){this.fireNodeClicked({nodeRef:n,x:x,y:y},true,true);}}}else if(!this.getFreezeCamera()&&!this._isRedlineActivated()){var b=this.hitTest(x,y);if(b&&(this._zoomedObject===null||this._zoomedObject!==b.object)){this._zoomedObject=b.object;this._viewportGestureHandler.zoomObject(this._zoomedObject,true);}else{this._viewportGestureHandler.zoomObject(this._zoomedObject,false);this._zoomedObject=null;}}return this;};
w.prototype.tapObject=function(n){var a={picked:n?[n]:[]};this.fireNodesPicked(a);if(n&&n._vkGetNodeContentType()===s.Background){this.exclusiveSelectionHandler([]);return this;}if(this.getSelectionMode()===S.Exclusive){this.exclusiveSelectionHandler(a.picked);}else if(this.getSelectionMode()===S.Sticky){this.stickySelectionHandler(a.picked);}return this;};
var E={x:-2,y:-2};var F=2;var G=5;
w.prototype.onkeydown=function(a){if(!a.isMarked()){var b;switch(a.keyCode){case K.ARROW_LEFT:case K.ARROW_RIGHT:case K.ARROW_UP:case K.ARROW_DOWN:if(a.ctrlKey||a.altKey||a.metaKey){break;}var i={x:0,y:0};switch(a.keyCode){case K.ARROW_LEFT:i.x=-1;break;case K.ARROW_RIGHT:i.x=+1;break;case K.ARROW_UP:i.y=-1;break;case K.ARROW_DOWN:i.y=+1;break;default:break;}b=this._viewportGestureHandler._cameraController;b.beginGesture(E.x,E.y);if(a.shiftKey){b.pan(G*i.x,G*i.y);}else{b.rotate(F*i.x,F*i.y,true);}b.endGesture();this.setShouldRenderFrame();a.preventDefault();a.stopPropagation();break;case 189:case K.PLUS:case K.NUMPAD_MINUS:case K.NUMPAD_PLUS:b=this._viewportGestureHandler._cameraController;b.beginGesture(this.$().width()/2,this.$().height()/2);b.zoom(a.keyCode===K.PLUS||a.keyCode===K.NUMPAD_PLUS?1.02:0.98);b.endGesture();this.setShouldRenderFrame();a.preventDefault();a.stopPropagation();break;default:break;}}};
w.prototype._onOutliningOrSelectionChanged=function(a){var b=this.getTools();for(var i=0;i<b.length;i++){var l=sap.ui.getCore().byId(b[i]);var n=l.getGizmoForContainer(this);if(n&&n.handleSelectionChanged){n.handleSelectionChanged(a);}}this.setShouldRenderFrame();};
w.prototype.setSelectionRect=function(a){this.setShouldRenderFrame();if(!a){this._selectionRect=null;return;}this._renderer.getSize(D);var x=(a.x1/D.x)*2-1,y=(a.y1/D.y)*-2+1,b=(a.x2/D.x)*2-1,i=(a.y2/D.y)*-2+1;if(!this._selectionRect){var l=new THREE.Geometry();l.vertices.push(new THREE.Vector3(x,i,-1),new THREE.Vector3(b,i,-1),new THREE.Vector3(b,y,-1),new THREE.Vector3(x,y,-1));this._selectionRect=new THREE.LineLoop(l,new THREE.LineBasicMaterial({color:0xC0C000,linewidth:window.devicePixelRatio}));}else{var n=this._selectionRect.geometry.vertices;n[0].set(x,i,-1);n[1].set(b,i,-1);n[2].set(b,y,-1);n[3].set(x,y,-1);this._selectionRect.geometry.verticesNeedUpdate=true;}};
w.prototype._renderLoop=function(){if(!this._renderer||!this.getDomRef()){this._renderLoopRequestId=0;return;}if(this._viewportGestureHandler){this._viewportGestureHandler.animateCameraUpdate();}if(this.getCamera()){if(this.getCamera().getIsModified()){this.getCamera().setIsModified(false);this._shouldRenderFrame=true;}}var a=this._getViewStateManagerThreeJS();if(a){this._shouldRenderFrame|=a._playTransition();this._shouldRenderFrame|=a._playHighlight();}if(this._shouldRenderFrame){this._shouldRenderFrame=false;if(a){a._setJointNodeMatrix();}this.render();var b=this.getAnnotations();if(b){b.forEach(function(i){i.update();});}}this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);};
function _(a,b,i){a.getSize(D);i.children.forEach(function(l){if(l.userData._vkDynamicObjects){l.userData._vkDynamicObjects.forEach(function(n){if(n.parent){n._vkUpdate(a,b,D);}});}});}
function I(i,l,n,x,y){n.children.forEach(function(z){if(z.userData._vkDetailViews){z.userData._vkDetailViews.sort(function(a,b){return a.renderOrder-b.renderOrder;});z.userData._vkDetailViews.forEach(function(a){if(a.node.visible){a.detailView._render(i,l,n,x,y);}});}});}
function J(n,a){n.matrixAutoUpdate=false;if(n.matrixWorldNeedsUpdate||a){if(n.parent===null){n.matrixWorld.copy(n.matrix);}else{n.matrixWorld.multiplyMatrices(n.parent.matrixWorld,n.matrix);}n.matrixWorldNeedsUpdate=true;a=true;}var b=n.children;for(var i=0,l=b.length;i<l;i++){J(b[i],a);}}
w.prototype.render=function(){var a=this._renderer;if(!a){return;}var n=this._getNativeScene();var b=this._getNativeCamera();if(!n||!b){return;}if(this._eyePointLight){this._eyePointLight.position.copy(b.position);this._eyePointLight.updateMatrix();}J(n,false);n.autoUpdate=false;var l=this.getTools();var x=this._getViewStateManagerThreeJS();var i,y,z,Q;if(this._camera.getUsingDefaultClipPlanes()||(b.isOrthographicCamera&&b.zoom<=0)){Q=this._scene._computeBoundingBox(true,false,true);if(x){x._selectedNodes.forEach(function(X){X._expandBoundingBox(Q,false,false,false);});}if(!Q.isEmpty()){if(b.isOrthographicCamera&&b.zoom<=0){this._camera.adjustZoom(Q);}if(this._camera.getUsingDefaultClipPlanes()){for(i=0;i<l.length;i++){y=sap.ui.getCore().byId(l[i]);z=y.getGizmoForContainer(this);if(z&&z.expandBoundingBox){z.expandBoundingBox(Q);}}this._camera.adjustClipPlanes(Q);}}}_(a,b,n);a.clippingPlanes=this._clippingPlanes;switch(this.getRenderMode()){case j.XRay:if(x){var U=n.children[n.children.length-1].clone();x._selectedNodes.forEach(function(X){if(X.visible){X.add(U);a.render(X,b);a.autoClear=false;X.remove(U);}});}n.overrideMaterial=this._xrayMaterial;break;case j.LineIllustration:case j.ShadedIllustration:case j.SolidOutline:this._scene._outlineMaterial.linewidth=this._renderer.getPixelRatio();break;default:break;}a.autoClear=this._backgroundColor!=null;if(a.autoClear){a.setClearColor(this._backgroundColor.color,this._backgroundColor.alpha);}else{a.render(this._backgroundScene,this._backgroundCamera);}if(this.getRenderMode()===j.XRay){a.autoClear=false;}a.render(n,b);a.autoClear=false;a.clippingPlanes=[];n.overrideMaterial=null;I(a,b,n,Q,this._eyePointLight);if(this.getShowSelectionBoundingBoxes()&&x){var W=x._boundingBoxesScene;if(W){x._updateBoundingBoxes();a.render(W,b);}}if(x){x._renderOutline(a,n,b);}for(i=0;i<l.length;i++){y=sap.ui.getCore().byId(l[i]);z=y.getGizmoForContainer(this);if(z&&z.render){z.render(this);}}if(this._selectionRect){a.render(this._selectionRect,this._backgroundCamera);}this.fireFrameRenderingFinished();};
w.prototype.getImage=function(a,b,i,l,n){var x=this._getNativeScene();if(!x){return null;}a=Math.min(a||16,2048);b=Math.min(b||16,2048);this._imageCanvas=this._imageCanvas||document.createElementNS("http://www.w3.org/1999/xhtml","canvas");var y=new THREE.WebGLRenderer({canvas:this._imageCanvas,preserveDrawingBuffer:true,antialias:true,alpha:true});y.setSize(a,b);var z=this.getBackgroundColorTop();var Q=this.getBackgroundColorBottom();if(i&&!l){y.setClearColor(i,1);}else if(!i&&l){y.setClearColor(l,1);}else{if(i&&l){this.setBackgroundColorTop(i);this.setBackgroundColorBottom(l);}y.render(this._backgroundScene,this._backgroundCamera);y.autoClear=false;}document.body.appendChild(y.domElement);var U=this.getCamera();var W=U instanceof P?new P():new O();W.getCameraRef().copy(U.getCameraRef());W.update(a,b);var X=[];var Y=this._getViewStateManagerThreeJS();if(!n){if(Y!==null){Y.enumerateSelection(function(a1){X.push(a1);});Y.setSelectionState(X,false,false,true);}}y.render(x,W.getCameraRef());var $=y.getContext().canvas.toDataURL();if(Y!==null&&X.length>0){Y.setSelectionState(X,true,false,true);}document.body.removeChild(y.domElement);y.dispose();if(Q&&i){this.setBackgroundColorBottom(Q);}if(z&&l){this.setBackgroundColorTop(z);}return $;};
w.prototype.getObjectImage=function(n,a,b,i,l,x,y){a=THREE.Math.clamp(a||256,8,2048);b=THREE.Math.clamp(b||256,8,2048);this._imageCanvas=this._imageCanvas||document.createElementNS("http://www.w3.org/1999/xhtml","canvas");var z=new THREE.WebGLRenderer({canvas:this._imageCanvas,preserveDrawingBuffer:true,antialias:true,alpha:true});z.setSize(a,b);var Q=this.getBackgroundColorTop();var U=this.getBackgroundColorBottom();if(i&&!l){z.setClearColor(i,1);}else if(!i&&l){z.setClearColor(l,1);}else{if(i&&l){this.setBackgroundColorTop(i);this.setBackgroundColorBottom(l);}z.render(this._backgroundScene,this._backgroundCamera);z.autoClear=false;}document.body.appendChild(z.domElement);var W=this.getCamera();var X=W instanceof P?new P():new O();var Y=X.getCameraRef();Y.copy(W.getCameraRef());if(x){Y.quaternion.copy(x);Y.updateMatrixWorld();Y.up.setFromMatrixColumn(Y.matrixWorld,1).normalize();}X.update(a,b);var $=new THREE.Box3();n._expandBoundingBox($,false,false,false);Y._vkZoomTo($,y);X.adjustClipPlanes($);var a1=this._getNativeScene();var b1=a1.children[a1.children.length-1].clone();var c1=b1.children[0];c1.position.copy(Y.position);c1.updateMatrix();c1.updateMatrixWorld(true);n.add(b1);z.render(n,Y);n.remove(b1);var d1=z.getContext().canvas.toDataURL();document.body.removeChild(z.domElement);z.dispose();if(U&&i){this.setBackgroundColorBottom(U);}if(Q&&l){this.setBackgroundColorTop(Q);}return d1;};
w.prototype._setContent=function(a){var b=null;var l;var n;if(a){b=a;if(!(b instanceof p)){b=null;}l=a.camera;if(l instanceof O){n=b._computeBoundingBox(true,true);var x=new THREE.Vector3();n.getCenter(x);var y=l.getTargetDirection();var z=l.getPosition();var Q=[x.x-z[0],x.y-z[1],x.z-z[2]];var U=Q[0]*y[0]+Q[1]*y[1]+Q[2]*y[2];if(U<0){var W=n.getSize().length()/2;W-=U;z[0]-=y[0]*W;z[1]-=y[1]*W;z[2]-=y[2]*W;l.setPosition(z);}}else if(!(l instanceof P)){l=new P();if(a.builders&&a.builders.length>0){n=b._computeBoundingBox(true,true);if(!n.isEmpty()){l.setFov(14.27);var X;if(a.upAxis===4){X=new THREE.Euler(THREE.Math.degToRad(90-30),0,THREE.Math.degToRad(55-90),"ZXY");}else{X=new THREE.Euler(THREE.Math.degToRad(-30),THREE.Math.degToRad(55-90),0,"YXZ");}this.setCamera(l);this._viewportGestureHandler.zoomTo(n,new THREE.Quaternion().setFromEuler(X),0,0,null,false);}}}var i;if(a.loaders){for(i=0;i<a.loaders.length;i++){if(a.loaders[i]instanceof q){this._cdsLoader=a.loaders[i];this._cdsLoader.getSceneBuilder()._fireSceneUpdated=this.setShouldRenderFrame.bind(this);this._cdsLoader.attachSceneUpdated(this._handleCdsSceneUpdate,this);this._cdsLoader.attachLoadingFinished(function(){this._clearAnnotations();this.getAnnotations();this.setShouldRenderFrame();},this);this._cdsLoader.attachInitialViewCompleted(function(){this.setShouldRenderFrame();},this);break;}}}if(a.builders){for(i=0;i<a.builders.length;i++){a.builders[i]._fireSceneUpdated=this.setShouldRenderFrame.bind(this);a.builders[i]._fireLoadingFinished=function(Y){this.setRenderMode(this.getRenderMode());}.bind(this);}}}this.setScene(b);if(l){this.setCamera(l);}if(a){if(a.backgroundTopColor!==undefined){this.setBackgroundColorTop(new THREE.Color(a.backgroundTopColor).getStyle());}if(a.backgroundBottomColor!==undefined){this.setBackgroundColorBottom(new THREE.Color(a.backgroundBottomColor).getStyle());}if(a.renderMode!==undefined){this.setRenderMode(a.renderMode);}this._upAxis=a.upAxis||2;}return this;};
w.prototype.getCurrentView=function(){return this._currentView;};
w.prototype._onViewStateApplied=function(a,b,i){if(i.source!=this._getViewStateManagerThreeJS()||!this._scene){return;}this._ignoreAnimationPosition=i.ignoreAnimationPosition;this.activateView(i.view,i.playViewGroup,i.notAnimateCameraChange);};
w.prototype._activateSingleView=function(a,b,n){var i=this._scene.getViewGroups();var l=this;if(i){i.forEach(function(i1){i1.getViews().forEach(function(j1){if(j1===a){l._currentViewIndex=i1.getViews().indexOf(j1);}});});}this.fireViewActivated({viewIndex:this._currentViewIndex,view:a});v.getEventBus().publish("sap.ui.vk","viewActivated",{source:this,view:a,viewIndex:this._currentViewIndex});this._currentView=a;if(a.topColor!==undefined){this.setBackgroundColorTop(new THREE.Color(a.topColor).getStyle());}if(a.bottomColor!==undefined){this.setBackgroundColorBottom(new THREE.Color(a.bottomColor).getStyle());}if(a.renderMode!==undefined){this.setRenderMode(a.renderMode);}var x=a.getCamera();var y=this._getNativeScene();if(x){var z=x.getCameraRef();if(z.type==="OrthographicCamera"&&y){var Q=x.getPosition();var U=this.getScene();if(U){var W=new THREE.Box3();if(y){y._expandBoundingBox(W,true,true);}var X=new THREE.Vector3();W.getCenter(X);var Y=x.getTargetDirection();var $=[X.x-Q[0],X.y-Q[1],X.z-Q[2]];var a1=$[0]*Y[0]+$[1]*Y[1]+$[2]*Y[2];if(a1<0){var b1=W.getSize().length()/2;b1-=a1;Q[0]-=Y[0]*b1;Q[1]-=Y[1]*b1;Q[2]-=Y[2]*b1;}}x.setPosition(Q);}}var c1=this._getViewStateManagerThreeJS();var d1=a.flyToTime!=null?a.flyToTime:2000;var e1;if(c1&&c1._fadeOutBackground&&c1._fadeInBackground&&c1._fadeOutBackground!==c1._fadeInBackground&&c1._fadeOutBackground.name==="sphere"){e1="zoomIn";x=x||this.getCamera();}var f1=0;if(x){var g1=b&&!a.hasAnimation();f1=this._viewportGestureHandler.activateCamera(x.getCameraRef(),n?0:d1,g1,e1);}else{this.cameraUpdateCompleted();}var h1=0;if(!n){h1=c1._startTransition(f1>0?f1:d1,a);}this.getSafeArea().resize();setTimeout(function(){if(c1){c1.fireReadyForAnimation({view:a,ignoreAnimationPosition:this._ignoreAnimationPosition});v.getEventBus().publish("sap.ui.vk","readyForAnimation",{source:c1,view:a,ignoreAnimationPosition:this._ignoreAnimationPosition});c1._startHighlight();}}.bind(this),Math.max(h1,f1)+100);};
w.prototype.resetCurrentView=function(){if(!this._currentView){return this;}this._getViewStateManagerThreeJS()._resetNodesMaterialAndOpacityByCurrenView(this._currentView);this._getViewStateManagerThreeJS()._resetNodesStatusByCurrenView(this._currentView,true,true);this.setShouldRenderFrame();return this;};
w.prototype.activateView=function(a,b,n){this._clearAnnotations();this._activateSingleView(a,b,n);return this;};
w.prototype.zoomTo=function(a,n,b,i){var l=this._getNativeScene();var x=this._getNativeCamera();if(!x||!l){return this;}i=i||0;var y=new THREE.Box3();var z=null;var Q=null;(Array.isArray(a)?a:[a]).forEach(function(a){switch(a){case Z.All:l._expandBoundingBox(y,false,true);break;case Z.Visible:l._expandBoundingBox(y,true,true);break;case Z.Selected:var U=this._getViewStateManagerThreeJS();if(U){U.enumerateSelection(function(n){n._expandBoundingBox(y,false,true);});}break;case Z.Node:if(!n){return this;}Q=n;if(Array.isArray(n)){n.forEach(function(n){n._expandBoundingBox(y,false,true);});}else{n._expandBoundingBox(y,false,true);}break;case Z.Restore:u.error(k().getText("VIEWPORT_MSG_RESTORENOTIMPLEMENTED"));return this;case Z.NodeSetIsolation:u.error(k().getText("VIEWPORT_MSG_NODESETISOLATIONNOTIMPLEMENTED"));return this;case Z.RestoreRemoveIsolation:u.error(k().getText("VIEWPORT_MSG_RESTOREREMOVEISOLATIONNOTIMPLEMENTED"));return this;case Z.ViewLeft:z=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),-Math.PI/2);break;case Z.ViewRight:z=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2);break;case Z.ViewTop:z=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2);break;case Z.ViewBottom:z=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2);break;case Z.ViewBack:z=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI);break;case Z.ViewFront:z=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),0);break;default:break;}}.bind(this));if(!y.isEmpty()){this._viewportGestureHandler.zoomTo(y,z,i,b*1000,Q,Q!==null);}return this;};
w.prototype.pan=function(a,b){this._viewportGestureHandler._cameraController.pan(a,b);};
w.prototype.rotate=function(a,b){this._viewportGestureHandler._cameraController.rotate(a,b);};
w.prototype.zoom=function(a){this._viewportGestureHandler._cameraController.zoom(a);};
w.prototype.getViewInfo=function(a){var b={};if(a==null){a={};}if(a.camera==null){a.camera=true;}var n=this._getNativeCamera();if(a.camera&&n){var i=n.rotation.clone();i.reorder("YXZ");b.camera={rotation:{yaw:THREE.Math.radToDeg(i.y),pitch:THREE.Math.radToDeg(i.x),roll:THREE.Math.radToDeg(i.z)},position:{x:n.position.x,y:n.position.y,z:n.position.z},projectionType:n.isOrthographicCamera?C.Orthographic:C.Perspective,bindingType:g.Vertical};var l=n.view;if(l&&l.enabled){b.camera.view={fullWidth:l.fullWidth,fullHeight:l.fullHeight,offsetX:l.offsetX,offsetY:l.offsetY,width:l.width,height:l.height};}if(b.camera.projectionType===C.Perspective){b.camera.fieldOfView=n.fov;}else if(b.camera.projectionType===C.Orthographic){b.camera.zoomFactor=n.zoom;}if(a.camera.matrices){b.camera.matrices={view:n.matrixWorldInverse.elements.slice(),projection:n.projectionMatrix.elements.slice()};}}if(a.visibility&&this._viewStateManager){var x=a.visibility.mode==null?h.Complete:a.visibility.mode;b.visibility={mode:x};if(x===h.Complete){var y=this._viewStateManager.getVisibilityComplete();b.visibility.visible=y.visible;b.visibility.hidden=y.hidden;}else if(this._viewStateManager.getShouldTrackVisibilityChanges()){b.visibility.changes=this._viewStateManager.getVisibilityChanges();}else{u.warning(k().getText(M.VIT32.summary),M.VIT32.code,"sap.ui.vk.threejs.Viewport");}}var z=this._getViewStateManagerThreeJS();if(a.selection&&z){b.selection=z._getSelectionComplete();}return b;};
w.prototype.setViewInfo=function(a,b){var n=this._getNativeCamera();if(a.camera&&n){var i=a.camera;var l=i.projectionType===C.Orthographic?new THREE.OrthographicCamera():new THREE.PerspectiveCamera();l.userData=n.userData;l.aspect=n.aspect;l.position.copy(i.position);var x=i.rotation;l.quaternion.setFromEuler(new THREE.Euler(THREE.Math.degToRad(x.pitch),THREE.Math.degToRad(x.yaw),THREE.Math.degToRad(x.roll),"YXZ"));l.fov=i.fieldOfView||l.fov;l.zoom=i.zoomFactor||l.zoom;if(n.view&&n.view.enabled){var y=i.view||n.view;l.setViewOffset(y.fullWidth,y.fullHeight,y.offsetX,y.offsetY,y.width,y.height);l.aspect=y.fullWidth/y.fullHeight;l.zoom=Math.min(l.aspect,1);}this._viewportGestureHandler.activateCamera(l,(b||0)*1000);}var z=new Map();if(a.visibility||a.selection){var Q=this._viewStateManager.getNodeHierarchy(),U=Q.findNodesByName();U.forEach(function(f1){var g1=Q.createNodeProxy(f1);var h1=g1.getVeId();Q.destroyNodeProxy(g1);if(h1){z.set(h1,f1);}});}if(a.visibility){switch(a.visibility.mode){case h.Complete:var W=a.visibility.visible,X=a.visibility.hidden;W.forEach(function(f1){this._viewStateManager.setVisibilityState(z.get(f1),true,false);},this);X.forEach(function(f1){this._viewStateManager.setVisibilityState(z.get(f1),false,false);},this);break;case h.Differences:this._viewStateManager.resetVisibility();a.visibility.changes.forEach(function(f1){var g1=z.get(f1);if(g1){this._viewStateManager.setVisibilityState(g1,!this._viewStateManager.getVisibilityState(g1),false);}},this);break;default:u.error(k().getText(M.VIT28.summary),M.VIT28.code,"sap.ui.vk.threejs.Viewport");break;}}var Y=this._getViewStateManagerThreeJS();var $=a.selection;if($&&Y){var a1=Y._getSelectionComplete();if(Array.isArray($.selected)){var b1=[];var c1=[];$.selected.forEach(function(f1){var g1=z.get(f1);if(g1){b1.push(g1);}});a1.selected.forEach(function(f1){var g1=z.get(f1);if(g1&&$.selected.indexOf(f1)<0){c1.push(g1);}});Y.setSelectionStates(b1,c1,false,false);}if(Array.isArray($.outlined)){this._viewStateManager.setSelectionState();var d1=[];var e1=[];$.outlined.forEach(function(f1){var g1=z.get(f1);if(g1){d1.push(g1);}});a1.outlined.forEach(function(f1){var g1=z.get(f1);if(g1&&$.outlined.indexOf(f1)<0){e1.push(g1);}});Y.setOutliningStates(d1,e1,false,false);}}this.setShouldRenderFrame();return this;};
w.prototype.queueCommand=function(a){if(this instanceof w){a();}return this;};
w.prototype.getOutputSize=function(){var b=this.getDomRef().getBoundingClientRect();var a=b.width;var i=b.height;var l;l=Math.min(a,i);return{left:(a-l)/2,top:(i-l)/2,sideLength:l};};
w.prototype.projectToScreen=function(x,y,z,a){var b=this.getDomRef().getBoundingClientRect();var i=b.width/2;var l=b.height/2;var n=new THREE.Vector3(x,y,z).project(a.getCameraRef());return{x:n.x*i+i,y:n.y*l+l,depth:n.z};};
w.prototype.getAnnotations=function(){if(this.getScene()==null||this._annotationsLoaded){return this.getAggregation("annotations")||[];}if(this.getScene().annotations){var a=[];var b=this.getCurrentView();if(b){b.getNodeInfos().forEach(function(n){if(n.target._vkGetNodeContentType()===s.Annotation){a.push(n);}});}this.getScene().annotations.forEach(function(x){var y=null;if(b){for(var n=0;n<a.length;n++){var z=a[n];if(z.target._vkPersistentId()===x.node._vkPersistentId()){y=A.createAnnotation(x,this);y.autoGenerated=true;this.addAnnotation(y);break;}}}else{y=A.createAnnotation(x,this);y.autoGenerated=true;this.addAnnotation(y);}if(y){var Q=this._viewStateManager.getVisibilityState(x.node);y.setVisible(Q);}}.bind(this));var i=this.getAggregation("annotations")||[];var l=0;i.forEach(function(n){if(n.getAnimate()&&n.getAnimationDelay()===-1){n.setAnimationDelay(l++);}});}this._annotationsLoaded=true;return this.getAggregation("annotations")||[];};
w.prototype.setBackgroundNode=function(a){var n=this._viewStateManager.getNodeHierarchy();var b;var i=n.findNodesByName().reduce(function(U,W){if(W._vkGetNodeContentType()===s.Background){if(this._viewStateManager.getVisibilityState(W)){b=W;}U.push(W);}return U;}.bind(this),[]);if(!a){this._viewStateManager.setVisibilityState(i,true,false);this._viewStateManager.setVisibilityState(b,false,false);this._viewportGestureHandler.setView(null,1000);}else{var l=a.parametricContent;var x=l.materialId;var y=a.sceneId;var z=n.createNode(b&&b.parent,l.type,null,s.Background,{parametricContent:l});this._viewStateManager.setVisibilityState(i,false,false);i.push(z);if(this._cdsLoader){this._cdsLoader.assignMaterialToNodes(y,x,z.children);}var Q=l.type==="plane"?(new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),0)):null;this._viewportGestureHandler.setView(Q,1000);}return i;};
V.prototype.normalizeRectangle=function(x,y,a,b){var i=window.getComputedStyle(this.getSafeArea().getDomRef());var l=parseFloat(i.width);var n=parseFloat(i.left);var z=(((x-n))/l)-0.5;var Q=parseFloat(i.height);var U=parseFloat(i.top);var W=(((y-U))/Q)-0.5;return{x:z,y:W,width:a/l,height:b/Q};};
w.prototype.deNormalizeRectangle=function(x,y,a,b){var i=window.getComputedStyle(this.getSafeArea().getDomRef());var l=parseFloat(i.width);var n=parseFloat(i.left);var z=l/2;var Q=n+z;var U=Math.abs(x)*2;if(x<0){U=1-U;U*=z;U+=n;}else if(x>0){U*=z;U+=Q;}else{U=Q;}var W=Math.abs(a)*2*z;var X=parseFloat(i.height);var Y=parseFloat(i.top);var $=X/2;var a1=Y+$;var b1=Math.abs(y)*2;if(y<0){b1=1-b1;b1*=$;b1+=Y;}else if(y>0){b1*=$;b1+=a1;}else{b1=a1;}var c1=Math.abs(b)*2*$;return{x:U,y:b1,width:W,height:c1};};
return w;});
sap.ui.predefine('sap/ui/vk/threejs/ViewportGestureHandler',["sap/base/Log","sap/ui/base/EventProvider","./PerspectiveCamera","./OrthographicCamera","../thirdparty/three","../getResourceBundle","../NodeContentType"],function(L,E,P,O,t,g,N){"use strict";
var V=E.extend("sap.ui.vk.threejs.ViewportGestureHandler",{
metadata:{},
constructor:function(v){this._matProj=null;this._viewport=v;this._rect=null;this._evt={x:0,y:0,z:0,d:0,initd:0};this._gesture=false;this._viewport.attachEvent("resize",this,this._onresize);this._nomenu=false;var T=function(a){var v=a;var b=new THREE.Vector3();var z=new THREE.Vector2();var A=0.001;var M=-Math.PI/2+A;var c=Math.PI/2-A;this.isTurnTableMode=true;this._timeIntervalForCameraAnimation=500;this._startTimeForCameraAnimation=0;this._newCamera=null;this._oldCamera=null;this._animationType=null;this._zoomedNodeRef=null;this._isZoomIn=true;this.beginGesture=function(x,y){var s=v.getScene();if(s==null){return;}var d=s.getSceneRef();var e=v.getCamera().getCameraRef();var f=v.getRenderer().getSize(new THREE.Vector2());z.x=x/f.width*2-1;z.y=y/f.height*-2+1;v._gesturePoint={x:x,y:y};var h=e.userData.isRedlineActivated?null:v.hitTest(x,y,d,e);if(h){b.copy(h.point);}else{var i=new THREE.Box3();d._expandBoundingBox(i,true,true);if(!i.isEmpty()){i.getCenter(b);}else{b.setScalar(0);}}};this.endGesture=function(){};this.pan=function(d,e){if(v.getFreezeCamera()||v.getCamera()===null||(d===0&&e===0)){return;}if(v._isPanoramicActivated()){this.rotate(d,e);return;}var f=v.getCamera().getCameraRef();var s=v.getRenderer().getSize(new THREE.Vector2());if(f.view&&f.view.enabled){f.view.offsetX-=d*f.zoom*f.view.width/f.view.fullWidth;f.view.offsetY-=e*f.zoom*f.view.height/f.view.fullHeight;f.updateProjectionMatrix();}else{var o=b.clone().project(f);o.x-=d*2/s.width;o.y+=e*2/s.height;o.unproject(f).sub(b);f.position.add(o);f.updateMatrixWorld();}v.fireCameraChanged({position:f.position.toArray()});};var u=[new THREE.Vector3(+1,0,0),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,+1,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,+1),new THREE.Vector3(0,0,-1)];this.rotate=function(d,e,i){if(v.getFreezeCamera()||v.getCamera()===null||(d===0&&e===0)){return;}if(i!==undefined){this.isTurnTableMode=i;}var f=v.getCamera().getCameraRef();var s=-0.01;if(v._isPanoramicActivated()){var h=v.getRenderer().getSize(new THREE.Vector2());s=2/(h.x*f.projectionMatrix.elements[0]);b.copy(f.position);}var j=d*s,k=e*s;var o=f.position.clone().sub(b);var l=new THREE.Vector3(),m=new THREE.Vector3().setFromMatrixColumn(f.matrixWorld,1).normalize(),r=new THREE.Vector3().setFromMatrixColumn(f.matrixWorld,0).normalize();f.getWorldDirection(l);l.normalize();var n=new THREE.Quaternion(),p=new THREE.Quaternion();if(this.isTurnTableMode){var q=u[v._upAxis]||u[2];r.crossVectors(l,q).normalize();m.crossVectors(r,l);var w=Math.atan2(l.y,Math.sqrt(l.x*l.x+l.z*l.z));n.setFromAxisAngle(q,j);p.setFromAxisAngle(r,THREE.Math.clamp(k,M-w,c-w));}else{n.setFromAxisAngle(m,j);p.setFromAxisAngle(r,k);}n.multiply(p);o.applyQuaternion(n);l.applyQuaternion(n);m.applyQuaternion(n);o.add(b);if(!f.userData.rotate){f.position.copy(o);}f.up.copy(m);f.lookAt(o.add(l));f.updateMatrixWorld();v.fireCameraChanged({position:f.position.toArray(),quaternion:f.quaternion.toArray()});};this.zoom=function(d){if(d===0||d===1||v.getFreezeCamera()||v.getCamera()===null||v.getScene()===null){return;}var e=v.getCamera().getCameraRef();var h=new THREE.Vector3();if(!e.userData.isRedlineActivated){var i=100;var j=new THREE.Box3();var k=new THREE.Vector3();var l=v._viewStateManager&&v._viewStateManager.getBackgroundImageType();var m=l?false:true;v.getScene().getSceneRef()._expandBoundingBox(j,true,m);j.applyMatrix4(e.matrixWorldInverse);j.min.z=Math.max(j.min.z,e.near);j.max.z=Math.max(j.max.z,e.near);j.applyMatrix4(e.projectionMatrix);j.getSize(k);var n=v.getRenderer().getSize(new THREE.Vector2());var s=k.x*n.width*0.5;var o=k.y*n.height*0.5;if(s<i&&o<i&&d<1){return;}}if(e.isPerspectiveCamera){if(v._isPanoramicActivated()){var p=d>1?e.fov-1:e.fov+1;e.fov=Math.min(Math.max(5,p),90);}else if(e.view&&e.view.enabled){var q=v.getDomRef();var x=v._gesturePoint.x/q.clientWidth;var y=v._gesturePoint.y/q.clientHeight;var f=1/d;e.view.offsetX+=x*e.view.width;e.view.offsetY+=y*e.view.height;e.view.width*=f;e.view.height*=f;e.view.offsetX-=x*e.view.width;e.view.offsetY-=y*e.view.height;}else{h.set(z.x,z.y,1).unproject(e);h.sub(new THREE.Vector3(z.x,z.y,-1).unproject(e));var r=b.clone().sub(e.position).length()*(1-1/d);h.setLength(r);e.position.add(h);}}else if(e.isOrthographicCamera){h.set(z.x,z.y,1).unproject(e);h.sub(new THREE.Vector3(0,0,1).unproject(e));h.multiplyScalar(1-1/d);e.zoom*=d;e.position.add(h);}else{L.error(g().getText("VIEWPORTGESTUREHANDLER_MSG_UNSUPPORTEDCAMERATYPE"));}e.updateProjectionMatrix();e.updateMatrixWorld();var w={position:e.position.toArray()};if(e.isOrthographicCamera){w.zoom=e.zoom;}v.fireCameraChanged(w);};this.animateCameraUpdate=function(){if(this._newCamera===null||this._oldCamera===null){return;}if(v.getCamera()==null){this._newCamera=null;this._oldCamera=null;return;}function s(j,k,x){x=THREE.Math.clamp((x-j)/(k-j),0.0,1.0);return x*x*x*(x*(x*6-15)+10);}var i=Math.min((Date.now()-this._startTimeForCameraAnimation)/this._timeIntervalForCameraAnimation,1);i=s(0,1,i);var d=v.getCamera().getCameraRef();if(d.isOrthographicCamera&&this._newCamera.isOrthographicCamera&&this._oldCamera.isOrthographicCamera){d.left=THREE.Math.lerp(this._oldCamera.left,this._newCamera.left,i);d.right=THREE.Math.lerp(this._oldCamera.right,this._newCamera.right,i);d.top=THREE.Math.lerp(this._oldCamera.top,this._newCamera.top,i);d.bottom=THREE.Math.lerp(this._oldCamera.bottom,this._newCamera.bottom,i);if(this._transitionEffect==="zoomIn"){var e=Math.max(this._oldCamera.zoom,this._newCamera.zoom)*5;d.zoom=i<0.5?THREE.Math.lerp(this._oldCamera.zoom,e,i*2):THREE.Math.lerp(e,this._newCamera.zoom,(i-0.5)*2);}else{d.zoom=THREE.Math.lerp(this._oldCamera.zoom,this._newCamera.zoom,i);}}if(d.isPerspectiveCamera&&this._newCamera.isPerspectiveCamera&&this._oldCamera.isPerspectiveCamera){if(this._transitionEffect==="zoomIn"){var f=Math.min(this._oldCamera.fov,this._newCamera.fov)*0.1;d.fov=i<0.5?THREE.Math.lerp(this._oldCamera.fov,f,i*2):THREE.Math.lerp(f,this._newCamera.fov,(i-0.5)*2);}else{d.fov=THREE.Math.lerp(this._oldCamera.fov,this._newCamera.fov,i);}}d.far=THREE.Math.lerp(this._oldCamera.far,this._newCamera.far,i);d.near=THREE.Math.lerp(this._oldCamera.near,this._newCamera.near,i);d.updateProjectionMatrix();d.position.lerpVectors(this._oldCamera.position,this._newCamera.position,i);d.scale.lerpVectors(this._oldCamera.scale,this._newCamera.scale,i);d.up.lerpVectors(this._oldCamera.up,this._newCamera.up,i);var o=this._oldCamera.getWorldDirection(new THREE.Vector3());var n=this._newCamera.getWorldDirection(new THREE.Vector3());var h=new THREE.Vector3().lerpVectors(o,n,i);d.lookAt(h.add(d.position));if(i===1){this._newCamera=null;this._oldCamera=null;if(this._animationType==="zooming"&&this._zoomedNodeRef){v.fireNodeZoomed({zoomed:this._zoomedNodeRef,isZoomIn:this._isZoomIn});}v.cameraUpdateCompleted({position:d.position.toArray(),quaternion:d.quaternion.toArray()});}v.fireCameraChanged({position:d.position.toArray(),quaternion:d.quaternion.toArray()});};this.startCameraAnimation=function(d,e){this._startTimeForCameraAnimation=Date.now();this._timeIntervalForCameraAnimation=d!==undefined?d:500;this._transitionEffect=e;};this.lookAtObject=function(n,d){if(n._vkGetNodeContentType()!==N.Background){this.prepareForCameraUpdateAnimation();var e=v.getCamera().getCameraRef();this._newCamera=e.clone();this._newCamera.lookAt(n.getWorldPosition(new THREE.Vector3()));this._newCamera.up.set(0,1,0);this._newCamera.updateMatrixWorld();this.startCameraAnimation(d);}};this.zoomObject=function(n,i,d){if(v.getScene()==null){return;}var e=new THREE.Box3();(i&&n?n:v.getScene().getSceneRef())._expandBoundingBox(e,true,true);if(n&&(n._vkGetNodeContentType()===N.Background||n._vkGetNodeContentType()===N.Symbol)){e.setFromObject(n);}var m=(n&&n._vkGetNodeContentType()===N.Symbol)?10:0;this.zoomBox(e,m,d,n,i);};this.zoomBox=function(d,m,e,n,i){this._zoomedNodeRef=n;this._isZoomIn=i;this._animationType="zooming";this._newCamera=v.getCamera().getCameraRef().clone();this._newCamera._vkZoomTo(d,m);this.startCameraAnimation(e);};this.prepareForCameraUpdateAnimation=function(){this._oldCamera=v.getCamera().getCameraRef().clone();};this.startAnimatingCameraUpdate=function(d,p,e){var f=v.getCamera().getCameraRef();if(!this._oldCamera){return 0;}var n=!!e;var h=0.0001;if(f.isOrthographicCamera&&this._oldCamera.isOrthographicCamera){if(Math.abs(f.left-this._oldCamera.left)>h||Math.abs(f.right-this._oldCamera.right)>h||Math.abs(f.top-this._oldCamera.top)>h||Math.abs(f.bottom-this._oldCamera.bottom)>h||Math.abs(f.zoom-this._oldCamera.zoom)>h){n=true;}}else if(f.isPerspectiveCamera&&this._oldCamera.isPerspectiveCamera){if(Math.abs(f.fov-this._oldCamera.fov)>h||Math.abs(f.aspect-this._oldCamera.aspect)>h){n=true;}}if(!n){if(Math.abs(f.position.x-this._oldCamera.position.x)>h||Math.abs(f.position.y-this._oldCamera.position.y)>h||Math.abs(f.position.z-this._oldCamera.position.z)>h||Math.abs(f.scale.x-this._oldCamera.scale.x)>h||Math.abs(f.scale.y-this._oldCamera.scale.y)>h||Math.abs(f.scale.z-this._oldCamera.scale.z)>h||Math.abs(f.quaternion.x-this._oldCamera.quaternion.x)>h||Math.abs(f.quaternion.y-this._oldCamera.quaternion.y)>h||Math.abs(f.quaternion.z-this._oldCamera.quaternion.z)>h||Math.abs(f.quaternion.w-this._oldCamera.quaternion.w)>h){n=true;}}if(!n){if(!p){v.cameraUpdateCompleted({position:f.position.toArray(),quaternion:f.quaternion.toArray()});return 0;}else{d=500;}}this._newCamera=v.getCamera().getCameraRef().clone();this.startCameraAnimation(d,e);return d;};};this._cameraController=new T(v);}
});
V.prototype._activateRedline=function(){var c=this._viewport.getCamera().getCameraRef();c.userData.isRedlineActivated=true;if(c.isPerspectiveCamera){var d=this._viewport.getDomRef();c.setViewOffset(d.clientWidth,d.clientHeight,0,0,d.clientWidth,d.clientHeight);}};
V.prototype._deactivateRedline=function(){var c=this._viewport.getCamera().getCameraRef();c.userData.isRedlineActivated=false;c.clearViewOffset();};
V.prototype.destroy=function(){this._viewport=null;this._rect=null;this._evt=null;this._gesture=false;};
V.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
V.prototype._inside=function(e){if(this._rect===null||true){var i=this._viewport.getIdForLabel();var d=document.getElementById(i);if(!d){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
V.prototype._onresize=function(e){this._gesture=false;this._rect=null;};
V.prototype.beginGesture=function(a){if(this._inside(a)&&!this._gesture){this._gesture=true;var x=a.x-this._rect.x,y=a.y-this._rect.y;this._evt.x=x;this._evt.y=y;this._evt.d=a.d;this._evt.initd=a.d;this._evt.avgd=a.d;this._evt.avgx=0;this._evt.avgy=0;L.debug("Loco: beginGesture: "+x+", "+y);this._cameraController.beginGesture(x,y);a.handled=true;if(document.activeElement){try{document.activeElement.blur();}catch(e){}}var d=document.getElementById(this._viewport.getIdForLabel());d.focus();}this._nomenu=false;};
V.prototype.move=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;var d=x-this._evt.x;var a=y-this._evt.y;var b=e.d-this._evt.d;this._evt.x=x;this._evt.y=y;this._evt.d=e.d;this._evt.avgx=this._evt.avgx*0.99+d*0.01;this._evt.avgy=this._evt.avgy*0.99+a*0.01;var z=1.0;if(this._evt.initd>0){z=1.0+b*(1.0/this._evt.initd);}else if(e.n===2){if(e.points[0].y>e.points[1].y){z=1.0-b*0.005;if(z<0.333){z=0.333;}}else{z=1.0+b*0.005;if(z>3){z=3;}}}if(this._evt.initd>0){var c=Math.sqrt(this._evt.avgx*this._evt.avgx+this._evt.avgy*this._evt.avgy);L.debug("AvgDist: "+c);if((Math.abs(e.d-this._evt.avgd)/this._evt.avgd)<(c/10)){z=1.0;}}z=THREE.Math.clamp(z,0.88,1.12);this._evt.avgd=this._evt.avgd*0.97+e.d*0.03;switch(e.n){case 1:L.debug("Loco: Rotate: "+(d)+", "+(a));this._cameraController.rotate(d,a);break;case 2:L.debug("Loco: Pan: "+(d)+", "+(a));if(z!=0&&z!=1.0){L.debug("Loco: Zoom: "+(z));}this._cameraController.pan(d,a);if(d<10&&a<10&&z!=0&&z!=1.0){this._cameraController.zoom(z);}break;default:break;}this._nomenu=true;e.handled=true;}};
V.prototype.endGesture=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;L.debug("Loco: endGesture: "+x+", "+y);this._cameraController.endGesture();this._gesture=false;e.handled=true;}};
V.prototype.click=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;L.debug("Loco: click: "+(x)+", "+(y));if(this._viewport){this._viewport.tap(x,y,false);}e.handled=true;}};
V.prototype.doubleClick=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;L.debug("Loco: doubleClick: "+(x)+", "+(y));if(this._viewport){this._viewport.tap(x,y,true);}e.handled=true;}};
V.prototype.contextMenu=function(e){if(this._inside(e)||this._nomenu||e.buttons===5){this._nomenu=false;e.handled=true;}};
V.prototype.keyEventHandler=function(e){};
V.prototype.getViewport=function(){return this._viewport;};
V.prototype.activateCamera=function(c,a,p,b){var r=0;this._cameraController.prepareForCameraUpdateAnimation();if(this._viewport.getCamera().getCameraRef().isPerspectiveCamera!=c.isPerspectiveCamera){var v=c.isPerspectiveCamera?new P():new O();v.getCameraRef().copy(c);this._viewport.setCamera(v);}else{this._viewport.getCamera().getCameraRef().copy(c);}var s=this._viewport.getRenderer().getSize(new THREE.Vector2());this._viewport.getCamera().update(s.width,s.height);if(a>0){r=this._cameraController.startAnimatingCameraUpdate(a,p,b);}else{this._viewport.cameraUpdateCompleted({position:c.position.toArray(),quaternion:c.quaternion.toArray()});}return r;};
V.prototype.setView=function(q,a){var c=this._viewport.getCamera().getCameraRef();if(c.userData.isRedlineActivated){L.error("setView() method is disabled when Redlining is activated");return this;}this._cameraController.prepareForCameraUpdateAnimation();if(q){c.quaternion.copy(q);c.updateMatrixWorld();c.up.setFromMatrixColumn(c.matrixWorld,1).normalize();this._cameraController.zoomObject(null,false,a);}else{c.copy(this._viewport._homeCamera?this._viewport._homeCamera:new P().getCameraRef());var s=this._viewport.getRenderer().getSize(new THREE.Vector2());this._viewport.getCamera().update(s.width,s.height);this._cameraController.startAnimatingCameraUpdate(a);}return this;};
V.prototype.zoomTo=function(b,q,m,a,n,i){var c=this._viewport.getCamera().getCameraRef();if(c.userData.isRedlineActivated){L.error("zoomTo() method is disabled when Redlining is activated");return this;}this._cameraController.prepareForCameraUpdateAnimation();if(q){c.quaternion.copy(q);c.updateMatrixWorld();c.up.setFromMatrixColumn(c.matrixWorld,1).normalize();}this._cameraController.zoomBox(b,m,a,n,i);return this;};
V.prototype.zoomObject=function(n,i,a){var c=this._viewport.getCamera().getCameraRef();if(c.userData.isRedlineActivated){L.error("zoomObject() method is disabled when Redlining is activated");return this;}if(this._viewport._isPanoramicActivated()){this._cameraController.lookAtObject(n,a);}else{this._cameraController.prepareForCameraUpdateAnimation();this._cameraController.zoomObject(n,i,a);}return this;};
V.prototype.animateCameraUpdate=function(){this._cameraController.animateCameraUpdate();};
V.prototype.prepareForCameraUpdateAnimation=function(){this._cameraController.prepareForCameraUpdateAnimation();};
V.prototype.startAnimatingCameraUpdate=function(a){this._cameraController.startAnimatingCameraUpdate(a);};
return V;});
sap.ui.predefine('sap/ui/vk/threejs/ViewportRenderer',[],function(){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewport");r.writeClasses();r.writeAttribute("tabindex",0);r.writeAttribute("aria-label","Image");r.writeAttribute("role","figure");r.addStyle("width",c.getWidth());r.addStyle("height",c.getHeight());r.writeStyles();r.write(">");if(c.getSafeArea()){r.renderControl(c.getSafeArea());}var i,l;var t=c.getTools();for(i=0,l=t.length;i<l;i++){var _=sap.ui.getCore().byId(t[i]);var a=_.getGizmoForContainer(c);if(a&&a.hasDomElement()){r.renderControl(a);}}var C=c.getContent();for(i=0,l=C.length;i<l;i++){r.renderControl(C[i]);}var A=c.getAnnotations();if(A&&A.length>0){r.write("<div");r.addClass("sapUiVizKitAnnotationContainer");r.writeClasses();r.write(">");A.forEach(function(o){r.renderControl(o);});r.write("</div>");}r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/tools/AnchorPointTool',["../thirdparty/three","./Tool","./AnchorPointToolHandler","./AnchorPointToolGizmo","./AnchorPointToolOperation"],function(t,T,A,a,b){"use strict";
var c=T.extend("sap.ui.vk.tools.AnchorPointTool",{
metadata:{properties:{enableStepping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},allowOperation:{type:"sap.ui.vk.tools.AnchorPointToolOperation",defaultValue:b.All},allowContextMenu:{type:"boolean",defaultValue:true},position:{type:"any",defaultValue:null},quaternion:{type:"any",defaultValue:null}},events:{moving:{parameters:{x:"float",y:"float",z:"float"}},moved:{parameters:{x:"float",y:"float",z:"float"}},rotating:{parameters:{x:"float",y:"float",z:"float"}},rotated:{parameters:{x:"float",y:"float",z:"float"}}}},
constructor:function(i,s){T.apply(this,arguments);this._viewport=null;this._handler=new A(this);this._gizmo=null;}
});
c.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);var g=new a();this.setAggregation("gizmo",g);this.setProperty("position",g._gizmo.position);this.setProperty("quaternion",g._gizmo.quaternion);};
c.prototype.setViewport=function(v){if(this._viewport!==v){this._deactivateScreenAlignment();}T.prototype.setViewport.call(this,v);if(v){this.getGizmo()._initAnchorPoint(v);}};
c.prototype.setActive=function(v,d,g){T.prototype.setActive.call(this,v,d,g);if(this._viewport){if(v){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._addLocoHandler();this._deactivateScreenAlignment();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
c.prototype.queueCommand=function(d){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){d();}}return this;};
c.prototype.setShowEditingUI=function(v){this.setProperty("showEditingUI",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.setAllowOperation=function(v){this.setProperty("allowOperation",v,true);if(this._gizmo){this._gizmo._updateHandlesVisibility();}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.move=function(x,y,z){if(this._gizmo){this._gizmo.move(x,y,z);}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.rotate=function(x,y,z){if(this._gizmo){this._gizmo.rotate(x,y,z);}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.moveTo=function(d,u){var n=Array.isArray(d)?d:[d];var p=new THREE.Vector3();if(u){var e=0;var f=new THREE.Vector3();n.forEach(function(h){h.updateWorldMatrix(false,false);p.add(f.setFromMatrixPosition(h.matrixWorld));e++;});p.multiplyScalar(1/e);}else{var g=new THREE.Box3();n.forEach(function(h){g.expandByObject(h);});g.getCenter(p);}this.getGizmo().setPosition(p);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.alignTo=function(n){this._deactivateScreenAlignment();var q=new THREE.Quaternion();if(n){n.updateWorldMatrix(false,false);n.matrixWorld.decompose(new THREE.Vector3(),q,new THREE.Vector3());}this.getGizmo().setQuaternion(q);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.alignToWorld=function(){this._deactivateScreenAlignment();this.getGizmo().setQuaternion(new THREE.Quaternion());if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.alignToScreen=function(){if(this._viewport){this._activateScreenAlignment();this.alignToScreenCallback();this._viewport.setShouldRenderFrame();}return this;};
c.prototype._activateScreenAlignment=function(){if(!this.alignToScreenCallback){this.alignToScreenCallback=function(){var d=this._viewport.getCamera().getCameraRef();this.getGizmo().setQuaternion(d.quaternion);}.bind(this);this._viewport.attachCameraChanged(this.alignToScreenCallback);}};
c.prototype._deactivateScreenAlignment=function(){if(this.alignToScreenCallback&&this._viewport){this._viewport.detachCameraChanged(this.alignToScreenCallback);this.alignToScreenCallback=null;}};
c.prototype.setPosition=function(){throw new Error("The AnchorPointTool position is read-only");};
c.prototype.setQuaternion=function(){throw new Error("The AnchorPointTool quaternion is read-only");};
return c;});
sap.ui.predefine('sap/ui/vk/tools/AnchorPointToolGizmo',["../getResourceBundle","../thirdparty/three","./Gizmo","./AnchorPointToolGizmoRenderer","./CoordinateSystem","./AxisColours","./AnchorPointToolOperation","sap/base/assert"],function(g,t,G,A,C,c,d,e){"use strict";
var f=G.extend("sap.ui.vk.tools.AnchorPointToolGizmo",{metadata:{library:"sap.ui.vk"}});
f.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._createEditingForm(null,84);this._gizmoIndex=-1;this._handleIndex=-1;this._viewport=null;this._tool=null;this._sceneGizmo=new THREE.Scene();var l=new THREE.DirectionalLight(0xFFFFFF,0.5);l.position.set(1,3,2);this._sceneGizmo.add(l);this._sceneGizmo.add(new THREE.AmbientLight(0xFFFFFF,0.5));this._touchAreas=new THREE.Group();this._gizmo=new THREE.Group();this._sceneGizmo.add(this._gizmo);this._matViewProj=new THREE.Matrix4();this._gizmoSize=96;this._moveDelta=new THREE.Vector3();this._rotationDelta=new THREE.Vector3();function j(a,b,r){var s=96,u=1,v=24,w=4,x=48;a.multiplyScalar(1/s);var y=new THREE.CylinderBufferGeometry(u,u,s-v,4);var m=new THREE.Matrix4().makeBasis(new THREE.Vector3(a.y,a.z,a.x),a,new THREE.Vector3(a.z,a.x,a.y));m.setPosition(a.clone().multiplyScalar((s-v)*0.5));y.applyMatrix4(m);var z=new THREE.MeshLambertMaterial({color:b,transparent:true});var B=new THREE.Mesh(y,z);B.matrixAutoUpdate=false;B.userData.color=b;var D=new THREE.CylinderBufferGeometry(0,w,v,12,1);m.setPosition(a.clone().multiplyScalar(s-v*0.5));D.applyMatrix4(m);var E=new THREE.Mesh(D,z);E.matrixAutoUpdate=false;B.add(E);var F=new THREE.CylinderGeometry(x*0.5,x*0.5,x,12,1);F.applyMatrix4(m);var H=new THREE.CylinderGeometry(x*0.5,x*0.2,x,12,1);m.setPosition(a.clone().multiplyScalar(s*0.5));F.merge(H,m);r.add(new THREE.Mesh(F,z));return B;}function k(a,b,m){var r=new Float32Array(9);r[a]=r[b+6]=1;r[a+3]=r[b+3]=0.5;var v=new THREE.Vector3().setComponent(a,0.333);var s=new THREE.Vector3().setComponent(b,0.333);var q=new THREE.Geometry();q.vertices.push(new THREE.Vector3(),v,s,v.clone().add(s));q.faces.push(new THREE.Face3(0,2,1),new THREE.Face3(1,2,3));var u=new THREE.MeshBasicMaterial({color:0xFFFF00,opacity:0.5,transparent:true,visible:false,side:THREE.DoubleSide});var w=new THREE.Mesh(q,u);w.matrixAutoUpdate=false;w.userData.colors=r;var x=new THREE.BufferGeometry();var y=new Float32Array(9);y[a]=y[a+3]=y[b+3]=y[b+6]=0.333;x.setAttribute("position",new THREE.Float32BufferAttribute(y,3));x.setAttribute("color",new THREE.Float32BufferAttribute(r,3));var z=new THREE.Line(x,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,transparent:true,linewidth:window.devicePixelRatio}));z.matrixAutoUpdate=false;w.add(z);var B=new THREE.Geometry();B.vertices.push(new THREE.Vector3(),v,s,v.clone().add(s));B.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(2,1,3));m.add(new THREE.Mesh(B,new THREE.MeshBasicMaterial({side:THREE.DoubleSide})));return w;}function n(a,b,r,s){var q=new THREE.TorusBufferGeometry(r,1/96,4,s,Math.PI/2);if(a===0){q.rotateY(Math.PI/-2);}else if(a===1){q.rotateX(Math.PI/2);}var m=new THREE.Mesh(q,new THREE.MeshBasicMaterial({color:b,transparent:true}));m.matrixAutoUpdate=false;m.userData.color=b;return m;}function o(a,r,s){var q=new THREE.TorusBufferGeometry(r,16/96,4,s,Math.PI/2);if(a===0){q.rotateY(Math.PI/-2);}else if(a===1){q.rotateX(Math.PI/2);}return new THREE.Mesh(q,new THREE.MeshBasicMaterial({opacity:0.2,transparent:true}));}this._gizmo.add(j(new THREE.Vector3(1,0,0),c.x,this._touchAreas));this._gizmo.add(j(new THREE.Vector3(0,1,0),c.y,this._touchAreas));this._gizmo.add(j(new THREE.Vector3(0,0,1),c.z,this._touchAreas));this._gizmo.add(k(1,2,this._touchAreas));this._gizmo.add(k(2,0,this._touchAreas));this._gizmo.add(k(0,1,this._touchAreas));for(var i=0;i<3;i++){this._gizmo.add(n(i,c[["x","y","z"][i]],1,32));this._touchAreas.add(o(i,1,24));}var p=new THREE.MeshBasicMaterial({color:0x0080FF,opacity:0.5,transparent:true,side:THREE.DoubleSide});this._arcMesh=new THREE.Mesh(new THREE.Geometry(),p);this._arcMesh.visible=false;this._gizmo.add(this._arcMesh);this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);var q=new THREE.Geometry();q.vertices.push(new THREE.Vector3(),new THREE.Vector3());this._line=new THREE.LineSegments(q,new THREE.LineBasicMaterial());this._line.frustumCulled=false;this._line.visible=false;this._gizmo.add(this._line);};
f.prototype.hasDomElement=function(){return true;};
f.prototype._updateHandlesVisibility=function(){var a=this._tool.getAllowOperation();var b=a!==d.Rotate;var j=a!==d.Move;var i;for(i=0;i<3;i++){this._touchAreas.children[i].visible=b;}for(i=3;i<6;i++){this._gizmo.children[i].visible=this._touchAreas.children[i].visible=b;}for(i=6;i<9;i++){this._gizmo.children[i].visible=this._touchAreas.children[i].visible=j;}};
f.prototype._initAnchorPoint=function(v){v._anchorPoint=this._gizmo;};
f.prototype.show=function(v,a){this._viewport=v;this._tool=a;this._updateHandlesVisibility();this._initAnchorPoint(v);};
f.prototype.hide=function(){this._viewport=null;this._tool=null;};
f.prototype.setPosition=function(p){this._gizmo.position.copy(p);this._gizmo.updateMatrixWorld();};
f.prototype.setQuaternion=function(q){this._gizmo.quaternion.copy(q);this._gizmo.updateMatrixWorld();};
f.prototype.getGizmoCount=function(){return 1;};
f.prototype.getTouchObject=function(i){this._touchAreas.position.copy(this._gizmo.position);this._touchAreas.quaternion.copy(this._gizmo.quaternion);this._touchAreas.scale.copy(this._gizmo.scale);this._touchAreas.updateMatrixWorld(true);return this._touchAreas;};
var h=[1,2,4,6,5,3,1,2,4];
f.prototype.highlightHandle=function(a,b){var i;for(i=0;i<3;i++){var j=this._gizmo.children[i];var k=h[a]&(1<<i);var l=k?0xFFFF00:j.userData.color;j.material.color.setHex(l);j.children[0].material.color.setHex(l);this._axisTitles.children[i].material.color.setHex(l);}for(i=3;i<6;i++){var p=this._gizmo.children[i];p.material.visible=i===a;var m=p.children[0].geometry.attributes.color;m.copyArray(i===a?[1,1,0,1,1,0,1,1,0]:p.userData.colors);m.needsUpdate=true;p.children[0].material.opacity=(i===a||(b&&a===-1))?1:0.35;p.children[0].visible=(i===a||b);}for(i=6;i<9;i++){var n=this._gizmo.children[i];n.visible=this._tool.getAllowOperation()!==d.Move&&(i===a||b);n.material.color.setHex(i===a?0xFFFF00:n.userData.color);n.material.opacity=(i===a||(b&&a===-1))?1:0.35;}};
f.prototype.selectHandle=function(i){this._handleIndex=i;if(i>=0&&i<3){this._units.setText(g().getText("TOOL_UNITS_MM"));}else if(i>=6&&i<9){this._units.setText(String.fromCharCode(176));}this._editingForm.rerender();this._viewport.setShouldRenderFrame();};
f.prototype.beginGesture=function(){this._isMoved=false;this._isRotated=false;this._originPosition=new THREE.Vector3().setFromMatrixPosition(this._gizmo.matrixWorld);this._originQuaternion=this._gizmo.quaternion.clone();};
f.prototype.endGesture=function(){if(this._isMoved){this._tool.fireMoved({x:this._moveDelta.x,y:this._moveDelta.y,z:this._moveDelta.z});}if(this._isRotated){this._tool.fireRotated({x:this._rotationDelta.x,y:this._rotationDelta.y,z:this._rotationDelta.z});}this._line.visible=false;this._arcMesh.visible=false;};
f.prototype._setOffset=function(o,a){if(this._tool.fireEvent("moving",{x:o.x,y:o.y,z:o.z},true)){this._move(o);var m=new THREE.Matrix4().getInverse(this._gizmo.matrixWorld);var s=new THREE.Vector3().setFromMatrixScale(this._gizmo.matrixWorld);var n=this._gizmo.position.clone().applyMatrix4(m);o.copy(this._originPosition).applyMatrix4(m).sub(n).multiply(s);this._line.geometry.vertices[0].copy(o);this._line.geometry.verticesNeedUpdate=true;this._line.geometry.computeBoundingBox();o.set(Math.abs(o.x),Math.abs(o.y),Math.abs(o.z));o.multiplyScalar(1/Math.max(o.x,o.y,o.z));this._line.material.color.setRGB(o.x,o.y,o.z);this._line.visible=true;}};
f.prototype._move=function(o){if(this._tool.getAllowOperation()===d.Rotate){return this;}this._isMoved=true;this._moveDelta.copy(o);this._gizmo.position.copy(this._originPosition).add(o);this._viewport.setShouldRenderFrame();};
f.prototype.move=function(x,y,z){this.beginGesture();this._move(new THREE.Vector3(x,y,z||0));};
f.prototype._setRotationAxisAngle=function(b,j,k){var l=(k-j)%(Math.PI*2);var m=[0,0,0];m[b]=l;m=new THREE.Euler().fromArray(m);if(this._tool.fireEvent("rotating",{x:THREE.Math.radToDeg(m.x),y:THREE.Math.radToDeg(m.y),z:THREE.Math.radToDeg(m.z)},true)){this._rotate(m);var v=[0,0,0];var o=new THREE.Vector3();var p=(b+1)%3,q=(b+2)%3;var i,n=Math.max(Math.ceil(Math.abs(l)*64/Math.PI),1);for(i=0;i<=n;i++){var a=j-l*(i/n);o.set(0,0,0).setComponent(p,Math.cos(a)).setComponent(q,Math.sin(a));v.push(o.x,o.y,o.z);}var r=[];for(i=0;i<n;i++){r.push(0,i+1,i+2);}var s=new THREE.BufferGeometry();s.setIndex(r);s.setAttribute("position",new THREE.Float32BufferAttribute(v,3));this._arcMesh.geometry=s;this._arcMesh.visible=true;}};
f.prototype._rotate=function(a){if(this._tool.getAllowOperation()===d.Move){return this;}this._tool._deactivateScreenAlignment();this._isRotated=true;this._rotationDelta.set(THREE.Math.radToDeg(a.x),THREE.Math.radToDeg(a.y),THREE.Math.radToDeg(a.z));var q=new THREE.Quaternion().setFromEuler(a);this._gizmo.quaternion.copy(this._originQuaternion).multiply(q);this._viewport.setShouldRenderFrame();};
f.prototype.rotate=function(x,y,z){this.beginGesture();this._rotate(new THREE.Euler(THREE.Math.degToRad(x||0),THREE.Math.degToRad(y||0),THREE.Math.degToRad(z||0)));};
f.prototype._getValueLocaleOptions=function(){return(this._handleIndex>=0&&this._handleIndex<3)?{useGrouping:false}:{useGrouping:false,minimumFractionDigits:1,maximumFractionDigits:2};};
f.prototype.getValue=function(){if(this._handleIndex>=0&&this._handleIndex<3){var a=new THREE.Vector3().setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return a.dot(this._gizmo.position);}if(this._handleIndex>=6&&this._handleIndex<9){return THREE.Math.radToDeg(this._gizmo.rotation.reorder("YXZ")[["x","y","z"][this._handleIndex-6]]);}return 0;};
f.prototype.setValue=function(v){if(this._handleIndex>=0&&this._handleIndex<3){var o=new THREE.Vector3().setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize().multiplyScalar(v-this.getValue());this.beginGesture();this._move(o);this.endGesture();}else if(this._handleIndex>=6&&this._handleIndex<9){var a=this._gizmo.rotation.clone();a[["x","y","z"][this._handleIndex-6]]=THREE.Math.degToRad(v);var q=new THREE.Quaternion().setFromEuler(a);var b=this._gizmo.quaternion.clone().inverse().multiply(q);a.setFromQuaternion(b);this.beginGesture();this._rotate(a);this.endGesture();}};
f.prototype.expandBoundingBox=function(b){if(this._viewport){this._expandBoundingBox(b,this._viewport.getCamera().getCameraRef(),true);}};
f.prototype._updateGizmoTransformation=function(i,a){this._matViewProj.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);var s=this._getGizmoScale(this._gizmo.position);this._gizmo.scale.setScalar(this._gizmoSize*s);this._gizmo.updateMatrixWorld(true);this._updateAxisTitles(this._axisTitles,this._gizmo,a,this._gizmoSize+18,s);this._line.scale.setScalar(1/(this._gizmoSize*s));};
f.prototype._getEditingFormPosition=function(){var s=this._getGizmoScale(this._gizmo.position);var a=new THREE.Vector3();if(this._handleIndex>=0&&this._handleIndex<3){a.setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();}else if(this._handleIndex>=6&&this._handleIndex<9){var i=this._handleIndex%3;var b=this._extractBasis(this._gizmo.matrixWorld);a.copy(b[(i+1)%3]).add(b[(i+2)%3]).normalize();}return a.clone().multiplyScalar((this._gizmoSize+18)*s).add(this._gizmo.position).applyMatrix4(this._matViewProj);};
f.prototype.render=function(){e(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");var r=this._viewport.getRenderer(),a=this._viewport.getCamera().getCameraRef();r.clearDepth();this._updateGizmoTransformation(0,a);r.render(this._sceneGizmo,a);this._updateEditingForm((this._handleIndex>=0&&this._handleIndex<3)||(this._handleIndex>=6&&this._handleIndex<9),this._handleIndex%3);};
return f;});
sap.ui.predefine('sap/ui/vk/tools/AnchorPointToolGizmoRenderer',[],function(){"use strict";var A={};
A.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkTransformationToolEdit");r.writeClasses();r.write(">");r.renderControl(c._editingForm);r.write("</div>");};
return A;},true);
sap.ui.predefine('sap/ui/vk/tools/AnchorPointToolOperation',[],function(){"use strict";var A={All:"All",Rotate:"Rotate",Move:"Move"};return A;},true);
sap.ui.predefine('sap/ui/vk/tools/AxisAngleRotationTool',["./Tool","../thirdparty/three","./AxisAngleRotationToolHandler","./AxisAngleRotationToolGizmo","./Detector","./ToolNodeSet"],function(T,a,A,b,D,c){"use strict";
var d=T.extend("sap.ui.vk.tools.AxisAngleRotationTool",{
metadata:{properties:{enableStepping:{type:"boolean",defaultValue:false},enableSnapping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},allowContextMenu:{type:"boolean",defaultValue:true},nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:c.Highlight}},events:{rotating:{parameters:{nodesProperties:"object[]"}},rotated:{parameters:{nodesProperties:"object[]"}}}},
constructor:function(i,s){T.apply(this,arguments);this._viewport=null;this._handler=new A(this);this._gizmo=null;this._detector=new D();}
});
d.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new b());};
d.prototype.setActive=function(v,e,g){T.prototype.setActive.call(this,v,e,g);if(this._viewport){if(v){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
d.prototype.queueCommand=function(e){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){e();}}return this;};
d.prototype.setShowEditingUI=function(v){this.setProperty("showEditingUI",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
d.prototype.setEnableSnapping=function(v){this.setProperty("enableSnapping",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
d.prototype.resetValues=function(){this.getGizmo().resetValues();if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
d.prototype.getDetector=function(){return this._detector;};
d.prototype.setNodeSet=function(v){this.setProperty("nodeSet",v,true);if(this._gizmo){this._gizmo.handleSelectionChanged();}};
d.prototype.rotateBy=function(e){this.getGizmo().rotateBy(e);return this;};
d.prototype.setAxis=function(e){this.getGizmo().setAxis(e);return this;};
d.prototype.getValues=function(){return this.getGizmo().getValues();};
d.prototype.setValues=function(v){this.getGizmo().setValues(v);return this;};
return d;});
sap.ui.predefine('sap/ui/vk/tools/AxisAngleRotationToolGizmo',["sap/base/Log","../thirdparty/three","./Gizmo","./AxisAngleRotationToolGizmoRenderer","./AxisColours","../AnimationTrackType","sap/base/assert"],function(L,t,G,A,b,d,e){"use strict";
var g=G.extend("sap.ui.vk.tools.AxisAngleRotationToolGizmo",{metadata:{library:"sap.ui.vk"}});
var j=[0xFF0080,b.y,b.z];var k=Math.PI*2,o=Math.PI/2,p=13;var q=THREE.Math.degToRad,s=THREE.Math.radToDeg;
g.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._createEditingForm(String.fromCharCode(176),84);this._gizmoIndex=-1;this._handleIndex=-1;this._value=new THREE.Vector3();this._rotationDelta=new THREE.Vector3();this._viewport=null;this._tool=null;this._sceneGizmo=new THREE.Scene();var l=new THREE.DirectionalLight(0xFFFFFF,0.5);l.position.set(1,3,2);this._sceneGizmo.add(l);this._sceneGizmo.add(new THREE.AmbientLight(0xFFFFFF,0.5));this._gizmo=new THREE.Group();this._sceneGizmo.add(this._gizmo);this._touchAreas=new THREE.Group();this._nodes=[];this._matViewProj=new THREE.Matrix4();this._gizmoSize=96;function c(f,r,h){var m=new THREE.TorusBufferGeometry(r,16/96,4,h,f===2?Math.PI:k);if(f===0){m.rotateY(o);}else if(f===1){m.rotateX(o);}else{m.rotateZ(-o);}return new THREE.Mesh(m,new THREE.MeshBasicMaterial({opacity:0.2,transparent:true}));}var i;for(i=0;i<3;i++){this._touchAreas.add(c(i,1,24));}for(i=0;i<3;i++){var a=new THREE.Mesh(new THREE.IcosahedronBufferGeometry(0.25,0),new THREE.MeshBasicMaterial({opacity:0.2,transparent:true}));a.position.setComponent(i,1.6);this._touchAreas.add(a);}};
g.prototype._createGizmoObject=function(){var a=new THREE.Group();var c=a.userData;function f(m,y,z,J){var K=new THREE.TorusBufferGeometry(z,1/96,4,J,m===2?Math.PI:k);if(m===0){K.rotateY(o);}else if(m===1){K.rotateX(o);}else{K.rotateZ(-o);}var M=new THREE.Mesh(K,new THREE.MeshBasicMaterial({color:y,transparent:true}));M.matrixAutoUpdate=false;M.userData.color=y;return M;}function h(y,z){var J=96*3,K=2,M=12*3,N=2*3;y.multiplyScalar(1/J);var O=new THREE.MeshLambertMaterial({color:z});var l=new THREE.CylinderBufferGeometry(K,K,J-M,4);var m=new THREE.Matrix4().makeBasis(new THREE.Vector3(y.y,y.z,y.x),y,new THREE.Vector3(y.z,y.x,y.y));m.setPosition(y.clone().multiplyScalar((J-M)*0.5));l.applyMatrix4(m);var P=new THREE.Mesh(l,O);P.matrixAutoUpdate=false;P.userData.color=z;var Q=new THREE.CylinderBufferGeometry(0,N,M,12,1);m.setPosition(y.clone().multiplyScalar(J-M*0.5));Q.applyMatrix4(m);var R=new THREE.Mesh(Q,O);R.matrixAutoUpdate=false;P.add(R);return P;}var i;for(i=0;i<3;i++){a.add(f(i,j[i],1,128));}c.axisArrow=h(new THREE.Vector3(3,0,0),j[0]);a.add(c.axisArrow);var l=new THREE.BufferGeometry();l.setAttribute("position",new THREE.Float32BufferAttribute(new Float32Array([0,0,0,3,0,0]),3));c.arrowProjection=new THREE.Line(l,new THREE.LineDashedMaterial({color:j[0],transparent:true,scale:10,dashSize:1,gapSize:1}));c.arrowProjection.computeLineDistances();a.add(c.arrowProjection);a.add(new THREE.AxesHelper(1.5));c.arcMeshes=[];for(i=0;i<3;i++){var n=new THREE.Mesh(new THREE.Geometry(),new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors,opacity:0.5,transparent:true,side:THREE.DoubleSide,depthWrite:false}));n.visible=false;c.arcMeshes.push(n);a.add(n);}c.valueLabels=[];for(i=0;i<3;i++){var r=this._createTextMesh("",64,32,p,0xFFFFFF,false);r.renderOrder=10;r.material.depthTest=false;r.visible=false;c.valueLabels.push(r);a.add(r);}var w=c.axisTitles=this._createAxisTitles();w.scale.setScalar(1/this._gizmoSize);var x=this._gizmoSize*1.6;w.children[0].position.x=x;w.children[1].position.y=x;w.children[2].position.z=x;a.add(w);return a;};
g.prototype.hasDomElement=function(){return true;};
g.prototype.resetValues=function(){this._value.setScalar(0);};
g.prototype.show=function(a,c){this._viewport=a;this._tool=c;this.handleSelectionChanged();this._tool.fireEvent("rotating",{x:0,y:0,z:0,nodesProperties:this._getNodesProperties()},true);};
g.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._updateEditingForm(false);};
g.prototype.getGizmoCount=function(){return this._nodes.length;};
g.prototype.getTouchObject=function(i){if(this._nodes.length===0){return null;}var a=this._gizmo.children[i];u(this._touchAreas.children[2],a.children[2]);u(this._touchAreas.children[0],a.children[0]);this._updateGizmoObjectTransformation(this._touchAreas,i);return this._touchAreas;};
g.prototype.highlightHandle=function(a,c,h){for(var f=0,l=this._gizmo.children.length;f<l;f++){var m=this._gizmo.children[f];var n=m.userData;for(var i=0;i<3;i++){var r=m.children[i];var w=(i===a)&&(f===c)?0xFFFF00:r.userData.color;r.material.color.setHex(w);r.material.opacity=a===-1||i===a?1:0.35;r.material.visible=h||i===a;var x=n.axisTitles.children[i];x.material.color.setHex((f===c)&&(i===a-3)?0xFFFF00:r.userData.color);x.material.opacity=h?1:0.35;n.arcMeshes[i].material.visible=h||i===a||(i===2&&a===1);}}};
g.prototype._snapToAxis=function(i){var a=-this._value.y,c=-this._value.z;switch(i){case 0:a+=90;break;case 1:c+=90;break;default:break;}this.beginGesture();this._rotate(new THREE.Euler(0,q(a),q(c)));this.endGesture();};
g.prototype.selectHandle=function(i,a){this._gizmoIndex=a;this._handleIndex=i;if(i>=3&&i<6){this._snapToAxis(i-3);}this._updateEditValue();this._viewport.setShouldRenderFrame();};
function u(a,c){a.quaternion.copy(c.quaternion);a.position.copy(c.position);a.updateMatrix();a.updateMatrixWorld(true);}
function v(a){return s(Math.atan2(a[0],a[2]));}
function B(a){return s(Math.atan2(a[1],Math.sqrt(a[0]*a[0]+a[2]*a[2])));}
function C(a,c){a=q(a);c=q(c);var f=Math.sin(a),h=Math.cos(a);var i=Math.sin(c),l=Math.cos(c);return[f*l,i,h*l];}
function D(h,l,m,w){if(h.userData.angle1===m&&h.userData.angle2===w){return;}h.userData.angle1=m;h.userData.angle2=w;var c=new THREE.Color().setHex(j[l]);var x=[0,0,0];var y=[c.r,c.g,c.b];var z=new THREE.Vector3();var J=(l+1)%3,K=(l+2)%3;var M=w-m;var i,n=Math.min(Math.max(Math.ceil(Math.abs(M)*64/Math.PI),1),10000);var N=Math.min(k/Math.abs(M),1);var O=THREE.Math.lerp;for(i=0;i<=n;i++){var f=1-(i/n);var a=m+M*f;var r=O(N,1,f);z.set(0,0,0).setComponent(J,Math.cos(a)*r).setComponent(K,Math.sin(a)*r);x.push(z.x,z.y,z.z);var P=O(1,0.5,f);y.push(c.r*P,c.g*P,c.b*P);}var Q=[];for(i=0;i<n;i++){Q.push(0,i+1,i+2);}var R=new THREE.BufferGeometry();R.setIndex(Q);R.setAttribute("position",new THREE.Float32BufferAttribute(x,3));h.geometry=R;h.geometry.setAttribute("color",new THREE.Float32BufferAttribute(y,3));h.visible=M!==0;}
g.prototype._updateGizmoObject=function(i,a,c,f){var h=this._gizmo.children[i];var l=new THREE.Euler(0,q(c-90),0,"YZX");var m=h.children[2];m.quaternion.setFromEuler(l);m.updateMatrix();l.z=q(f);var n=h.children[0];n.quaternion.setFromEuler(l);n.updateMatrix();n.position.setFromMatrixColumn(n.matrix,0).multiplyScalar(2);n.updateMatrix();var r=h.userData;var w=r.axisArrow;w.quaternion.copy(n.quaternion);w.updateMatrix();var x=r.arrowProjection;var y=Math.cos(l.z);x.quaternion.copy(m.quaternion);x.scale.setScalar(y);x.updateMatrix();x.material.scale=y*10;var z=r.arcMeshes;D(z[0],0,0,q(a));u(z[0],h.children[0]);D(z[1],1,0,q(c));u(z[1],h.children[1]);D(z[2],2,0,q(f));u(z[2],h.children[2]);var J=r.valueLabels;F(J[0],a);F(J[1],c);F(J[2],f);};
g.prototype.beginGesture=function(){this._rotationDelta.setScalar(0);this._nodes.forEach(function(n){n.beginAngle=n.angle;n.beginAzimuth=n.azimuth;n.beginElevation=n.elevation;});};
g.prototype._getNodesProperties=function(){return this.getValues();};
g.prototype.endGesture=function(){this._nodes.forEach(function(a){delete a.beginAngle;delete a.beginAzimuth;delete a.beginElevation;});var n=this._getNodesProperties();this._tool.fireRotated({x:this._rotationDelta.x,y:this._rotationDelta.y,z:this._rotationDelta.z,nodesProperties:n});};
function E(c,a){var f=window.devicePixelRatio;var w=c.width;var h=c.height;var i=w*0.5;var l=h*0.5;var r=Math.min(p*0.85*f,i-1);var m=c.getContext("2d");m.font="Bold "+p*f+"px Arial";var n=m.measureText(a);var x=Math.min(n.width*0.5-r*0.5,i-r-1);m.clearRect(0,0,w,h);m.beginPath();m.arc(i-x,l,r,o,o*3,false);m.lineTo(i+x,l-r);m.arc(i+x,l,r,-o,o,false);m.lineTo(i-x,l+r);m.closePath();m.globalAlpha=0.75;m.fillStyle="#fff";m.fill();m.globalAlpha=1;m.lineWidth=f;m.strokeStyle="#000";m.stroke();m.fillStyle="#000";m.textAlign="center";if(sap.ui.Device.browser.chrome||sap.ui.Device.browser.firefox){m.textBaseline="top";m.fillText(a,i,l-n.actualBoundingBoxDescent*0.5);}else{m.textBaseline="middle";m.fillText(a,i,l);}}
function F(a,c){a.visible=c!==0;if(a.visible&&a.userData.value!==c){a.userData.value=c;var f=c.toLocaleString("fullwide",{useGrouping:false,minimumFractionDigits:1,maximumFractionDigits:1})+"°";var h=a.material.map;E(h.image,f);h.needsUpdate=true;}}
g.prototype._updateEditValue=function(){var n=this._nodes[this._gizmoIndex];if(n){this._value.set(n.angle,n.azimuth,n.elevation);}};
var _=new THREE.Vector3();var H=new THREE.Quaternion();
g.prototype._updateNodeRotation=function(n){_.fromArray(C(n.azimuth,n.elevation));H.setFromAxisAngle(_,q(n.angle));n.node.quaternion.multiplyQuaternions(H,n.quaternion);n.node.updateMatrix();if(n.node.userData){delete n.node.userData.skipUpdateJointNode;}this._viewport._viewStateManager._setJointNodeOffsets(n.node,d.Rotate);};
g.prototype._rotate=function(a){this._rotationDelta.set(s(a.x),s(a.y),s(a.z));this._nodes.forEach(function(n){n.angle=n.beginAngle+this._rotationDelta.x;n.azimuth=(n.beginAzimuth+this._rotationDelta.y)%360;n.elevation=THREE.Math.clamp(n.beginElevation+this._rotationDelta.z,-90,90);if(n.azimuth>180){n.azimuth-=360;}if(n.azimuth<-180){n.azimuth+=360;}this._updateNodeRotation(n);},this);this._updateEditValue();this._viewport.setShouldRenderFrame();};
g.prototype._setRotationAxisAngle=function(a,c,f){var h=f-c;if(a!==0){h%=k;}var i=new THREE.Euler();i[["x","y","z"][a]]=h;var n=this._getNodesProperties();if(this._tool.fireEvent("rotating",{x:s(i.x),y:s(i.y),z:s(i.z),nodesProperties:n},true)){this._rotate(i);}};
g.prototype.rotate=function(x,y,z){this.beginGesture();this._rotate(new THREE.Euler(q(x||0),q(y||0),q(z||0)));};
g.prototype._getValueLocaleOptions=function(){return{useGrouping:false,minimumFractionDigits:1,maximumFractionDigits:2};};
g.prototype.getValue=function(){return(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3)?this._value.getComponent(this._handleIndex):0;};
g.prototype.setValue=function(a){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){var c=new THREE.Euler();c[["x","y","z"][this._handleIndex]]=q(a-this._value.getComponent(this._handleIndex));this.beginGesture();this._rotate(c);this.endGesture();}};
g.prototype.rotateBy=function(a){this.beginGesture();this._rotate(new THREE.Euler(q(a),0,0));this.endGesture();};
g.prototype.setAxis=function(a){this.beginGesture();var c=0;var f=0;if(Array.isArray(a)){c=v(a);f=B(a);}else{if("azimuth"in a){c=a.azimuth;}if("elevation"in a){f=a.elevation;}}this._nodes.forEach(function(n){n.azimuth=c;n.elevation=f;this._updateNodeRotation(n);},this);this._updateEditValue();this._viewport.setShouldRenderFrame();this.endGesture();};
g.prototype.getValues=function(){var a=[];this._nodes.forEach(function(n){a.push({node:n.node,angle:n.angle,azimuth:n.azimuth,elevation:n.elevation,axis:C(n.azimuth,n.elevation)});});return a;};
g.prototype._getNodeInfoByNode=function(n){var a=this._nodes;for(var i=0,l=a.length;i<l;i++){if(a[i].node===n){return a[i];}}return null;};
g.prototype.setValues=function(a){a.forEach(function(c){var n=this._getNodeInfoByNode(c.node);if(n){n.angle=c.angle;if(c.axis){n.azimuth=v(c.axis);n.elevation=B(c.axis);}else{n.azimuth=c.azimuth;n.elevation=c.elevation;}n.quaternion=n.node.quaternion.clone();_.fromArray(C(n.azimuth,n.elevation));H.setFromAxisAngle(_,-q(n.angle));n.quaternion.premultiply(H);this._updateNodeRotation(n);}},this);this._updateEditValue();this._viewport.setShouldRenderFrame();};
g.prototype.expandBoundingBox=function(a){if(this._viewport){this._expandBoundingBox(a,this._viewport.getCamera().getCameraRef(),true);}};
g.prototype.handleSelectionChanged=function(a){this._nodes.length=0;this._gizmoIndex=this._handleIndex=-1;if(this._viewport){if(this._tool.getEnableSnapping()){this._tool.getDetector().setSource(this._viewport._viewStateManager);}this._updateSelection(this._viewport._viewStateManager);this._tool.fireEvent("rotating",{x:0,y:0,z:0,nodesProperties:this._getNodesProperties()},true);this._nodes.forEach(function(n){n.quaternion=n.node.quaternion.clone();n.angle=0;n.azimuth=0;n.elevation=0;});var c=this._nodes.length;var f=this._gizmo;while(f.children.length>c){f.remove(f.children[f.children.length-1]);}while(f.children.length<c){f.add(this._createGizmoObject());}}};
g.prototype._getObjectSize=function(a){var c=new THREE.Box3();this._nodes[a].node._expandBoundingBox(c,true,false);if(c.isEmpty()){return 0;}var f=new THREE.Vector3();c.getSize(f);return f.length();};
g.prototype._updateGizmoObjectTransformation=function(a,i){var n=this._nodes[i].node;var c=this._getEffectiveParent(n);a.position.setFromMatrixPosition(n.matrixWorld);if(c){a.quaternion.setFromRotationMatrix(c.matrixWorld);}else{a.quaternion.set(0,0,0,1);}var f=this._getGizmoScale(a.position);a.scale.setScalar(this._gizmoSize*f);a.updateMatrix();a.updateMatrixWorld(true);return f;};
g.prototype._getValuePosition=function(a,c,f,h){f=q(f);h=q(h);var i=new THREE.Euler(0,0,0,"YZX");if(c===0){i.set(0,f,h);}else if(c===1){i.set(0,f*0.5,0);}else{i.set(0,f,h*0.5);}i.y-=o;a.set(c===0?3.25:1.25,0,0).applyEuler(i);};
var I=new THREE.Vector3();
g.prototype._updateGizmoTransformation=function(i,c){var a=this._gizmo.children[i];var n=this._nodes[i];var f=this._updateGizmoObjectTransformation(a,i);a.userData.axisTitles.children.forEach(function(m){m.quaternion.copy(a.quaternion).inverse().multiply(c.quaternion);});for(var h=0;h<3;h++){var l=a.userData.valueLabels[h];this._getValuePosition(l.position,h,n.azimuth,n.elevation);l.quaternion.copy(a.quaternion).inverse().multiply(c.quaternion);I.copy(l.position).applyMatrix4(a.matrixWorld);l.scale.setScalar(this._getGizmoScale(I)/(f*this._gizmoSize));}};
g.prototype._getEditingFormPosition=function(){var a=this._gizmo.children[this._gizmoIndex];var n=this._nodes[this._gizmoIndex];this._updateGizmoObjectTransformation(a,this._gizmoIndex);this._getValuePosition(I,this._handleIndex,n.azimuth,n.elevation);return I.applyMatrix4(a.matrixWorld).applyMatrix4(this._matViewProj);};
g.prototype.render=function(){e(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");if(this._nodes.length>0){var r=this._viewport.getRenderer(),c=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);r.clearDepth();for(var i=0,l=this.getGizmoCount();i<l;i++){var n=this._nodes[i];this._updateGizmoObject(i,n.angle,n.azimuth,n.elevation);this._updateGizmoTransformation(i,c);}r.render(this._sceneGizmo,c);this._updateEditValue();}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex,["δ","γ","α"][this._handleIndex]);};
g.prototype._getOffsetForRestTransformation=function(n){};
return g;});
sap.ui.predefine('sap/ui/vk/tools/AxisAngleRotationToolGizmoRenderer',[],function(){"use strict";var A={};
A.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkTransformationToolEdit");r.writeClasses();r.write(">");r.renderControl(c._editingForm);r.write("</div>");};
return A;},true);
sap.ui.predefine('sap/ui/vk/tools/AxisColours',[],function(){"use strict";var A={x:0xFF2222,y:0x00A745,z:0x488AF7};return A;},true);
sap.ui.predefine('sap/ui/vk/tools/CoordinateSystem',[],function(){"use strict";var C={Local:"Local",World:"World",Screen:"Screen",Parent:"Parent",Custom:"Custom"};return C;},true);
sap.ui.predefine('sap/ui/vk/tools/CreateEllipseTool',["sap/base/Log","../library","./Tool","./CreateEllipseToolHandler","./CreateEllipseToolGizmo","../svg/Ellipse"],function(L,v,T,C,a,E){"use strict";
var b=T.extend("sap.ui.vk.tools.CreateEllipseTool",{
metadata:{properties:{parentNode:{type:"any",defaultValue:null},uniformMode:{type:"boolean",defaultValue:false}},events:{completed:{parameters:{node:{type:"any"},parametric:{type:"any"}}}}},
constructor:function(i,s){if(b._instance){return b._instance;}T.apply(this,arguments);this._viewport=null;this._handler=new C(this);b._instance=this;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.svg.Viewport"]);this.setAggregation("gizmo",new a());};
b.prototype.setActive=function(c,d,g){T.prototype.setActive.call(this,c,d,g);var e=this._viewport;if(e){if(c){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(e,this);}this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
b.prototype.setMaterial=function(m,l,f){this._material=m;this._lineStyle=l;this._fillStyle=f;};
b.prototype.queueCommand=function(c){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.svg.Viewport")){c();}}return this;};
b.prototype.setParentNode=function(c){if(c===this.getParentNode()){return this;}this.setProperty("parentNode",c,true);if(this._gizmo){this._gizmo.updateParentNode();}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/CreateEllipseToolGizmo',["./Gizmo","../svg/Ellipse"],function(G,E){"use strict";
var C=G.extend("sap.ui.vk.tools.CreateEllipseToolGizmo",{metadata:{library:"sap.ui.vk"}});
C.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._activeElement=null;};
C.prototype.hasDomElement=function(){return false;};
C.prototype.updateParentNode=function(){if(!this._tool||!this._viewport){return;}var r=this._tool.getParentNode();if(!r){r=this._viewport._scene.getRootElement();while(r.userData.skipIt&&r.children.length>0){r=r.children[0];}}this._root=r;};
C.prototype.show=function(v,t){this._viewport=v;this._tool=t;this.updateParentNode();};
C.prototype.hide=function(){this._viewport=null;this._tool=null;this._root=null;};
C.prototype._startAdding=function(p){this._startPos=p;var m=this._viewport._camera._transformRect({x1:0,y1:0,x2:1,y2:1});this._minRX=(m.x2-m.x1)*0.5;this._minRY=(m.y2-m.y1)*0.5;this._activeElement=new E({major:this._minRX,minor:this._minRY,matrix:[1,0,0,1,p.x,p.y],material:this._tool._material,lineStyle:this._tool._lineStyle,fillStyle:this._tool._fillStyle});this._root.add(this._activeElement);this._root.rerender();};
C.prototype._update=function(p){var a=this._startPos;var b=this._activeElement;if(b){var r=Math.abs(a.x-p.x);var c=Math.abs(a.y-p.y);if(this._tool.getUniformMode()){r=c=Math.max(r,c);}b.rx=Math.max(r,this._minRX);b.ry=Math.max(c,this._minRY);b.invalidate();}};
C.prototype._stopAdding=function(p){var n=this._activeElement;this._tool.fireCompleted({node:n,parametric:{type:"ellipse",major:n.rx,minor:n.ry}});this._activeElement=null;this._tool.setActive(false);};
return C;});
sap.ui.predefine('sap/ui/vk/tools/CreateEllipseToolHandler',["sap/ui/base/EventProvider","../svg/Element"],function(E,a){"use strict";
var C=E.extend("sap.ui.vk.tools.CreateEllipseToolHandler",{
metadata:{},
constructor:function(t){this._priority=30;this._tool=t;this._rect=null;}
});
C.prototype._getPosition=function(e){var p=this._tool._viewport._camera._screenToWorld(e.x-this._rect.x,e.y-this._rect.y);var m=a._invertMatrix(this._tool.getGizmo()._root._matrixWorld());return a._transformPoint(p.x,p.y,m);};
C.prototype.hover=function(e){};
C.prototype.beginGesture=function(e){var g=this._tool.getGizmo();if(g&&this._inside(e)){this._gesture=true;e.handled=true;g._startAdding(this._getPosition(e));}};
C.prototype.move=function(e){if(this._gesture){e.handled=true;this._tool.getGizmo()._update(this._getPosition(e));}};
C.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._tool.getGizmo()._stopAdding(this._getPosition(e));}};
C.prototype.click=function(e){};
C.prototype.doubleClick=function(e){};
C.prototype.contextMenu=function(e){};
C.prototype.getViewport=function(){return this._tool._viewport;};
C.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
C.prototype._inside=function(e){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return C;});
sap.ui.predefine('sap/ui/vk/tools/CreateRectangleTool',["sap/base/Log","../library","./Tool","./CreateRectangleToolHandler","./CreateRectangleToolGizmo","../svg/Rectangle"],function(L,v,T,C,a,R){"use strict";
var b=T.extend("sap.ui.vk.tools.CreateRectangleTool",{
metadata:{properties:{parentNode:{type:"any",defaultValue:null},uniformMode:{type:"boolean",defaultValue:false}},events:{completed:{parameters:{node:{type:"any"},parametric:{type:"any"}}}}},
constructor:function(i,s){if(b._instance){return b._instance;}T.apply(this,arguments);this._viewport=null;this._handler=new C(this);b._instance=this;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.svg.Viewport"]);this.setAggregation("gizmo",new a());};
b.prototype.setActive=function(c,d,g){T.prototype.setActive.call(this,c,d,g);var e=this._viewport;if(e){if(c){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(e,this);}this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
b.prototype.setMaterial=function(m,l,f){this._material=m;this._lineStyle=l;this._fillStyle=f;};
b.prototype.queueCommand=function(c){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.svg.Viewport")){c();}}return this;};
b.prototype.setParentNode=function(c){if(c===this.getParentNode()){return this;}this.setProperty("parentNode",c,true);if(this._gizmo){this._gizmo.updateParentNode();}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/CreateRectangleToolGizmo',["./Gizmo","../svg/Rectangle"],function(G,R){"use strict";
var C=G.extend("sap.ui.vk.tools.CreateRectangleToolGizmo",{metadata:{library:"sap.ui.vk"}});
C.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._activeElement=null;};
C.prototype.hasDomElement=function(){return false;};
C.prototype.updateParentNode=function(){if(!this._tool||!this._viewport){return;}var r=this._tool.getParentNode();if(!r){r=this._viewport._scene.getRootElement();while(r.userData.skipIt&&r.children.length>0){r=r.children[0];}}this._root=r;};
C.prototype.show=function(v,t){this._viewport=v;this._tool=t;this.updateParentNode();};
C.prototype.hide=function(){this._viewport=null;this._tool=null;this._root=null;};
C.prototype._startAdding=function(p){this._startPos=p;var m=this._viewport._camera._transformRect({x1:0,y1:0,x2:1,y2:1});this._minWidth=m.x2-m.x1;this._minHeight=m.y2-m.y1;this._activeElement=new R({matrix:[1,0,0,1,p.x,p.y],width:this._minWidth,height:this._minHeight,material:this._tool._material,lineStyle:this._tool._lineStyle,fillStyle:this._tool._fillStyle});this._root.add(this._activeElement);this._root.rerender();};
C.prototype._update=function(p){var a=this._startPos;var b=this._activeElement;if(b){var m=Math.min(a.x,p.x);var c=Math.min(a.y,p.y);var w=Math.max(Math.abs(a.x-p.x),this._minWidth);var h=Math.max(Math.abs(a.y-p.y),this._minHeight);if(this._tool.getUniformMode()){if(w<h){w=h;if(p.x<a.x){m=a.x-w;}}else{h=w;if(p.y<a.y){c=a.y-h;}}}b.matrix[4]=m;b.matrix[5]=c;b.width=w;b.height=h;b.invalidate();}};
C.prototype._stopAdding=function(p){var n=this._activeElement;this._tool.fireCompleted({node:n,parametric:{type:"rectangle",width:n.width,height:n.height,rx:n.rx,ry:n.ry}});this._activeElement=null;this._tool.setActive(false);};
return C;});
sap.ui.predefine('sap/ui/vk/tools/CreateRectangleToolHandler',["sap/ui/base/EventProvider","../svg/Element"],function(E,a){"use strict";
var C=E.extend("sap.ui.vk.tools.CreateRectangleToolHandler",{
metadata:{},
constructor:function(t){this._priority=30;this._tool=t;this._rect=null;}
});
C.prototype._getPosition=function(e){var p=this._tool._viewport._camera._screenToWorld(e.x-this._rect.x,e.y-this._rect.y);var m=a._invertMatrix(this._tool.getGizmo()._root._matrixWorld());return a._transformPoint(p.x,p.y,m);};
C.prototype.hover=function(e){};
C.prototype.beginGesture=function(e){var g=this._tool.getGizmo();if(g&&this._inside(e)){this._gesture=true;e.handled=true;g._startAdding(this._getPosition(e));}};
C.prototype.move=function(e){if(this._gesture){e.handled=true;this._tool.getGizmo()._update(this._getPosition(e));}};
C.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._tool.getGizmo()._stopAdding(this._getPosition(e));}};
C.prototype.click=function(e){};
C.prototype.doubleClick=function(e){};
C.prototype.contextMenu=function(e){};
C.prototype.getViewport=function(){return this._tool._viewport;};
C.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
C.prototype._inside=function(e){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return C;});
sap.ui.predefine('sap/ui/vk/tools/CrossSectionTool',["./Tool","./CrossSectionToolHandler","./CrossSectionToolGizmo"],function(T,C,a){"use strict";
var b=T.extend("sap.ui.vk.tools.CrossSectionTool",{
metadata:{properties:{showEditingUI:{type:"boolean",defaultValue:false}}},
constructor:function(i,s){if(b._instance){return b._instance;}T.apply(this,arguments);this._viewport=null;this._handler=new C(this);this._gizmo=null;b._instance=this;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new a());};
b.prototype.setActive=function(v,c,g){T.prototype.setActive.call(this,v,c,g);if(this._viewport){if(v){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
b.prototype.setAxis=function(i){if(this._gizmo){this._gizmo.setAxis(i);}return this;};
b.prototype.setFlip=function(f){if(this._gizmo){this._gizmo.setFlip(f);}return this;};
b.prototype.getFlip=function(){return this._gizmo?this._gizmo._flip:undefined;};
b.prototype.setShowEditingUI=function(v){this.setProperty("showEditingUI",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
b.prototype.queueCommand=function(c){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){c();}}return this;};
b.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;delete b._instance;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/CrossSectionToolGizmo',["../getResourceBundle","../thirdparty/three","./Gizmo","./AxisColours","../threejs/ThreeUtils","sap/base/assert"],function(g,t,G,A,T,a){"use strict";
var C=G.extend("sap.ui.vk.tools.CrossSectionToolGizmo",{metadata:{library:"sap.ui.vk"}});
C.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._createEditingForm(g().getText("TOOL_UNITS_MM"),84);this._handleIndex=-1;this._viewport=null;this._tool=null;this._position=new THREE.Vector3(0,0,0);this._plane=new THREE.Plane(new THREE.Vector3(0,0,1),0);this._flip=false;this._matViewProj=new THREE.Matrix4();this._gizmoSize=144;this._firstShowPress=true;this.setAxis(0);};
C.prototype.hasDomElement=function(){return true;};
C.prototype.show=function(v,b){this._viewport=v;this._tool=b;if(this._firstShowPress){var c=v._scene?v._scene._computeBoundingBox(true,true):new THREE.Box3();c.getCenter(this._position);this._firstShowPress=false;}this._plane.constant=-this._plane.normal.dot(this._position);v.setClippingPlanes([this._plane]);};
C.prototype.hide=function(){if(this._viewport){this._viewport.setClippingPlanes([]);this._viewport=null;}this._handleIndex=-1;this._tool=null;this._updateEditingForm(false,-1);};
C.prototype._getOffset=function(){return this._position.getComponent(this._axis);};
C.prototype.getAxis=function(){return this._axis;};
C.prototype.setAxis=function(i){this._handleIndex=-1;this._axis=i;var d=new THREE.Vector3().setComponent(i,1);this._plane.normal.set(0,0,0).setComponent(i,this._flip?-1:1);this._plane.constant=-this._plane.normal.dot(this._position);var b=new THREE.BufferGeometry();var v=new Array(15);var c=new THREE.Vector3(d.y,d.z,d.x),e=new THREE.Vector3(d.z,d.x,d.y),p=new THREE.Vector3();p.sub(c).sub(e).multiplyScalar(0.5).toArray(v,0);p.toArray(v,12);p.add(c).toArray(v,3);p.add(e).toArray(v,6);p.sub(c).toArray(v,9);b.setAttribute("position",new THREE.Float32BufferAttribute(v,3));this._gizmoPlane=new THREE.Line(b,new THREE.LineBasicMaterial({color:0x404040,transparent:true,linewidth:window.devicePixelRatio}));var f=144,l=window.devicePixelRatio*0.5,h=32,j=6,k=48;d=this._plane.normal.clone().multiplyScalar(1/f);var n=0;switch(i){case 0:n=A.x;break;case 1:n=A.y;break;case 2:n=A.z;break;default:break;}var o=new THREE.CylinderBufferGeometry(l,l,f-h,4);var m=new THREE.Matrix4().makeBasis(new THREE.Vector3(d.y,d.z,d.x),d,new THREE.Vector3(d.z,d.x,d.y));m.setPosition(d.clone().multiplyScalar((f-h)*0.5));o.applyMatrix4(m);this._gizmoArrow=new THREE.Mesh(o,new THREE.MeshBasicMaterial({color:n}));this._gizmoArrow.userData.color=n;var q=new THREE.CylinderBufferGeometry(0,j,h,12,1);m.setPosition(d.clone().multiplyScalar(f-h*0.5));q.applyMatrix4(m);var r=new THREE.Mesh(q,new THREE.MeshBasicMaterial({color:n}));r.matrixAutoUpdate=false;this._gizmoArrow.add(r);var u=new THREE.CylinderGeometry(k*0.5,k*0.5,f,12,1);m.setPosition(d.clone().multiplyScalar(f*0.5));u.applyMatrix4(m);this._touchMesh=new THREE.Mesh(u,new THREE.MeshBasicMaterial({visible:false,side:THREE.DoubleSide}));this._gizmoArrow.add(this._touchMesh);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
C.prototype.setFlip=function(f){this._flip=!!f;var h=this._handleIndex;this.setAxis(this._axis);this._handleIndex=h;return this;};
C.prototype.getTouchObject=function(){return this._touchMesh;};
var s=new THREE.Vector3();
C.prototype._getDelta=function(){var b=this._viewport._scene._computeBoundingBox(true,true);b.getSize(s);return Math.max(s.x,s.y,s.z);};
C.prototype._setOffset=function(o){var b=this._viewport._scene._computeBoundingBox(true,true);o=THREE.Math.clamp(o,b.min.getComponent(this._axis),b.max.getComponent(this._axis));this._position.setComponent(this._axis,o);this._plane.constant=-this._plane.normal.dot(this._position);this._viewport.setShouldRenderFrame();};
C.prototype.getValue=function(){return this._position.getComponent(this._handleIndex);};
C.prototype.setValue=function(v){if(this._handleIndex>=0){this._position.setComponent(this._handleIndex,v);this._plane.constant=v;this._viewport.setShouldRenderFrame();}};
C.prototype.highlightArrowHandle=function(h){var c=h?0xFFFF00:this._gizmoArrow.userData.color;this._gizmoArrow.material.color.setHex(c);this._gizmoArrow.children[0].material.color.setHex(c);};
C.prototype.selectHandle=function(i){this._handleIndex=i;this._viewport.setShouldRenderFrame();};
C.prototype._adjustBoundingBox=function(b){b.getSize(s);var d=Math.max(s.x,s.y,s.z)*0.2;b.expandByScalar(d);};
C.prototype._updateGizmo=function(b){var i=this._axis;var o=THREE.Math.clamp(this._position.getComponent(i),b.min.getComponent(i),b.max.getComponent(i));this._position.setComponent(i,o);this._plane.constant=-this._plane.normal.dot(this._position);this._adjustBoundingBox(b);b.getCenter(this._gizmoPlane.position);this._gizmoPlane.position.setComponent(i,o);b.getSize(this._gizmoPlane.scale);this._gizmoPlane.updateMatrixWorld(true);var c=this._viewport.getCamera().getCameraRef();this._gizmoArrow.position.copy(this._gizmoPlane.position);this._matViewProj.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);this._gizmoArrow.scale.setScalar(this._gizmoSize*this._getGizmoScale(this._gizmoArrow.position));this._gizmoArrow.updateMatrixWorld(true);};
C.prototype.expandBoundingBox=function(b){if(this._viewport){var c=this._viewport._scene._computeBoundingBox(true,true);this._updateGizmo(c);b.min.min(c.min);b.max.max(c.max);b.expandByPoint(this._plane.normal.clone().multiply(this._gizmoArrow.scale).add(this._gizmoArrow.position));}};
C.prototype._getEditingFormPosition=function(){return this._plane.normal.clone().applyMatrix4(this._gizmoArrow.matrixWorld).applyMatrix4(this._matViewProj);};
C.prototype.render=function(){a(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");var b=this._viewport._scene._computeBoundingBox(true,true);this._updateGizmo(b);var r=this._viewport.getRenderer(),c=this._viewport.getCamera().getCameraRef();r.render(this._gizmoPlane,c);r.clearDepth();r.render(this._gizmoArrow,c);this._gizmo=this._gizmoArrow;this._updateEditingForm(this._handleIndex>=0,this._handleIndex);};
C.prototype.exit=function(){if(this._gizmoArrow){T.disposeObject(this._gizmoArrow);this._gizmoArrow=null;}if(this._gizmoPlane){T.disposeObject(this._gizmoPlane);this._gizmoPlane=null;}if(this._touchMesh){T.disposeObject(this._touchMesh);this._touchMesh=null;}G.prototype.exit.call(this);};
return C;});
sap.ui.predefine('sap/ui/vk/tools/CrossSectionToolGizmoRenderer',[],function(){"use strict";var C={};
C.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkTransformationToolEdit");r.writeClasses();r.write(">");r.renderControl(c._editingForm);r.write("</div>");};
return C;},true);
sap.ui.predefine('sap/ui/vk/tools/CrossSectionToolHandler',["sap/ui/base/EventProvider"],function(E){"use strict";
var C=E.extend("sap.ui.vk.tools.CrossSectionToolHandler",{
metadata:{},
constructor:function(t){this._priority=20;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._mouse=new THREE.Vector2();this._rayCaster=new THREE.Raycaster();this._rayCaster.linePrecision=0;this._gizmoAxis=new THREE.Vector3();this._dragOrigin=new THREE.Vector2();this._dragOffset=0;this._dragDelta=0;}
});
C.prototype._updateRayCaster=function(e){var s=this.getViewport().getRenderer().getSize(new THREE.Vector2());this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
C.prototype._updateArrowHandle=function(e){var t=this._gizmo.getTouchObject();var a=-1;if(e.n===1){this._updateRayCaster(e);var i=this._rayCaster.intersectObject(t,true);a=i.length>0?this._gizmo.getAxis():-1;}if(a!==this._axisIndex){this._axisIndex=a;this._gizmo.highlightArrowHandle(a>=0);if(a>=0){this._gizmoAxis.setScalar(0).setComponent(this._axisIndex,1);}this.getViewport().setShouldRenderFrame();}};
C.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateArrowHandle(e);e.handled|=this._axisIndex>=0;}};
C.prototype.click=function(e){if(this._inside(e)&&!this._gesture){this._updateArrowHandle(e);this._gizmo.selectHandle(this._axisIndex);e.handled|=this._axisIndex>=0;}};
C.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateArrowHandle(e);this._gizmo.selectHandle(this._axisIndex);if(this._axisIndex>=0){this._gesture=true;e.handled=true;this._dragOrigin.set(e.x,e.y);this._dragOffset=this._gizmo._getOffset();this._dragDelta=this._gizmo._getDelta()/500;}}};
C.prototype.move=function(e){if(this._gesture){e.handled=true;this._updateRayCaster(e);var d=this._gizmoAxis.clone().applyQuaternion(this.getViewport().getCamera().getCameraRef().quaternion.clone().inverse());d.z=0;d.normalize();if(d.x===0&&d.y===0){d.y=1;}this._gizmo._setOffset(this._dragOffset+((e.x-this._dragOrigin.x)*d.x-(e.y-this._dragOrigin.y)*d.y)*this._dragDelta);}};
C.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateArrowHandle(e);}};
C.prototype.getViewport=function(){return this._tool._viewport;};
C.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
C.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d===null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return C;});
sap.ui.predefine('sap/ui/vk/tools/Detector',[],function(){"use strict";var D=function(){this._verticesMap=new Map();this._objArr=[];this._collidedUuids=new Set();this._sourceObjects=null;this._targetObjects=[];this._srcBoxHelper=null;this._sourceBox=new THREE.Box3();this._originPos=new THREE.Vector3();this._targetBoxHelper=[];this._targetBoxes=[];this._detectDistance=20.0;this._direction=new THREE.Vector3();this._isReady=false;this._finalDistance=null;this._finalSnaps=[];this._intersectDistance=Number.NEGATIVE_INFINITY;this._collidedUuid=null;this._isMoved=false;this._detectType={"move":this.detectMove.bind(this),"scale":this.detectScale.bind(this),"rotate":this.detectRotate.bind(this)};};
D.prototype.isReady=function(){if(this._isReady&&this._sourceObjects){return true;}else{return false;}};
D.prototype.setDetectDistance=function(v){this._detectDistance=parseFloat(v)||20.0;};
D.prototype.setMoved=function(v){this._isMoved=v;this._intersectDistance=Number.NEGATIVE_INFINITY;};
D.prototype.getObjArray=function(){return this._objArr;};
D.prototype.addObjFromScene=function(v){var s=v._scene.getSceneRef();var a=v._viewStateManager;this._objArr.length=0;this._verticesMap.clear();s.traverse(function(c){if(c.isMesh){if(!this._objArr.find(function(o){return o.uuid===c.uuid;})){this._objArr.push(c);var A=this.getVertices(c.geometry);this._verticesMap.set(c.uuid,A);}}}.bind(this));this.setSource(a);this._isReady=true;};
D.prototype.setSource=function(v){var s=[];v.enumerateSelection(function(n){s.push(n);});if(s.length>0){var o=s.pop();if(this._isReady){v.setSelectionStates(o,s,false,true);}if(o.children.length===0){this._isGroup=false;this._sourceObjects=o;}else{this._isGroup=true;this._sourceObjects=o.children.filter(function(c){return c.type==="Mesh";})[0];}this._srcBoxHelper=new THREE.BoxHelper(this._sourceObjects);this._srcBoxHelper.update();this._sourceBox.setFromObject(this._srcBoxHelper);}else{this._isReady=false;this._sourceObjects=null;this._sourceBox=new THREE.Box3();}this.setTarget();};
D.prototype.setTarget=function(){this._intersectDistance=Number.NEGATIVE_INFINITY;this._collidedUuid=null;this._collidedUuids.clear();this._isMoved=false;if(this._sourceObjects){this._sourceObjects.geometry.computeBoundingSphere();this._originPos=new THREE.Vector3();this._targetObjects=this._objArr.filter(function(o){return o.uuid!==this._sourceObjects.uuid;}.bind(this));this._targetBoxes.length=0;this._targetBoxHelper.length=0;this._targetObjects.forEach(function(t){var a=new THREE.BoxHelper(t);this._targetBoxHelper.push(a);a.update();var c=new THREE.Box3();c.setFromObject(t);this._targetBoxes.push(c);}.bind(this));}else{this._targetObjects.length=0;this._targetBoxes.length=0;this._targetBoxHelper.length=0;}};
D.prototype.updateTargetBox=function(){this._targetBoxHelper.forEach(function(t,i){t.update();this._targetBoxes[i].setFromObject(t);}.bind(this));};
D.prototype.getVertices=function(g){var i,l,a=[];if(g.isGeometry){a=g.vertices;}else if(g.isBufferGeometry){var c=g.attributes.position;if(c!==undefined){var v=new THREE.Vector3();a=[];var o={};var s="";for(i=0,l=c.count;i<l;i++){v.fromBufferAttribute(c,i);s=JSON.stringify(v);if(!o[s]){a.push(v.clone());o[s]=true;}}}}return a;};
D.prototype.findClosestVertex=function(p,r,o){var v=this._verticesMap.get(o.uuid);if(v.length===0){return null;}var d,a=null,l=o.worldToLocal(p.clone());for(var i=0,c=v.length;i<c;i++){d=v[i].distanceTo(l);if(d>r){continue;}r=d;a=v[i];}if(a===null){return null;}return o.localToWorld(a.clone());};
D.prototype.findClosestSnap=function(p,r,t){var i=2;var s;while(!s){s=this.findClosestVertex(p,r,t);r*=i;}return s;};
D.prototype.intersectDetect=function(i){var s=new Map();var a=this._sourceBox.clone().expandByScalar(this._detectDistance);i.forEach(function(o){var c=this._targetObjects.findIndex(function(t){return t.uuid===o.object.uuid;});if(!this._collidedUuids.has(o.object.uuid)&&c!==-1&&this._targetBoxes&&this._targetBoxes[c].intersectsBox(a)){var d=this.findClosestSnap(this._originPos,this._detectDistance,this._targetObjects[c]);s.set(d,this._targetObjects[c]);if(this._targetBoxes[c].intersectsBox(this._sourceBox)&&this._intersectDistance<this._finalDistance){if(this.detectCollisionGJK(this._sourceObjects,this._targetObjects[c])){this._collidedUuid=o.object.uuid;this._intersectDistance=this._finalDistance;}}}}.bind(this));return s;};
D.prototype.getFinalSnaps=function(a){var f=[];if(a.length>0){var s=this.intersectDetect(a);if(s.size!==0){var c=Array.from(s.keys());var m=c[0];var l=m.distanceTo(this._originPos);for(var i=1;i<c.length;++i){var q=c[i];var d=q.distanceTo(this._originPos);if(d<l){m=q;l=d;}}var o=s.get(m);var e=this._originPos.distanceTo(m);var g,n;g=this.findClosestSnap(m,e,this._sourceObjects);var h=g.distanceTo(m);n=this.findClosestSnap(g,h,o);f=[g,n];}}return f;};
D.prototype.snapMove=function(){var o=this._op;if(this._finalSnaps.length===2&&this._sourceObjects&&Math.abs(this._finalDistance-this._intersectDistance)>0.1){if(!this._collidedUuid&&this._finalDistance>=this._intersectDistance){o.gizmo._tool._handler._gesture=false;o.gizmo._moveDelta.add(this._direction.clone().multiplyScalar(0.1));o.gizmo._move(o.gizmo._moveDelta);}else{this._intersectDistance=Number.NEGATIVE_INFINITY;this._collidedUuid=null;this._isMoved=false;o.viewport.setShouldRenderFrame();}this.detect();}};
D.prototype.snapScale=function(){var o=this._op;if(!o.gizmo._scaleDelta.equals(new THREE.Vector3(1,1,1))&&this._finalSnaps.length===2&&this._sourceObjects&&Math.abs(this._finalDistance-this._intersectDistance)>0.1){if(!this._collidedUuid&&this._finalDistance>=this._intersectDistance){o.gizmo._tool._handler._gesture=false;var g=o.gizmo._scaleDelta.toArray();g.forEach(function(s,i){if(s>1){o.gizmo._scaleDelta.setComponent(i,s*1.01);}});o.gizmo._scale(o.gizmo._scaleDelta);}else{this._intersectDistance=Number.NEGATIVE_INFINITY;this._collidedUuid=null;this._isMoved=false;o.viewport.setShouldRenderFrame();}this.detect();}else if(Math.abs(this._finalDistance-this._intersectDistance)<=0.1){this._collidedUuids.add(this._collidedUuid);}};
D.prototype.snapRotate=function(){var o=this._op;if(this._finalSnaps.length===2&&this._sourceObjects&&Math.abs(this._finalDistance-this._intersectDistance)>0.1){if(!this._collidedUuid&&this._finalDistance>=this._intersectDistance){o.gizmo._tool._handler._gesture=false;o.angle2+=0.02*(o.angle2-o.angle1)/Math.abs(o.angle2-o.angle1);o.gizmo._setRotationAxisAngle(o.handleIndex,o.angle1,o.angle2);}else{this._intersectDistance=Number.NEGATIVE_INFINITY;this._collidedUuid=null;this._isMoved=false;o.viewport.setShouldRenderFrame();}this.detect();}};
D.prototype.detectMove=function(){this._direction.copy(this._op.gizmo._moveDelta).normalize();var r=new THREE.Raycaster(this._originPos,this._direction,0,this._detectDistance);this._snapAction=b(this.snapMove,1000/60).bind(this);return r.intersectObjects(this._targetObjects,false);};
D.prototype.detectScale=function(){if(this._op.gizmo._scaleDelta.toArray().find(function(s){return s<=1;})){this._op.gizmo._tool._handler._gesture=true;this._collidedUuids.forEach(function(e){var f=this._targetObjects.find(function(t){return t.uuid===e;});if(f&&!this.detectCollisionGJK(this._sourceObjects,f)){this._collidedUuids.delete(e);}}.bind(this));}this._gizmoPos=new THREE.Vector3();this._op.gizmo._gizmo.getWorldPosition(this._gizmoPos);var a=new THREE.Vector3();this._sourceObjects.getWorldPosition(a);var S=0.0,c=0.0;c=this._sourceObjects.geometry.boundingSphere.clone().applyMatrix4(this._sourceObjects.matrixWorld).radius;S=new THREE.Sphere(a,c+this._detectDistance);var d=[];this._targetBoxes.forEach(function(t,i){if(t.intersectsSphere(S)){d.push({object:this._targetObjects[i]});}}.bind(this));this._snapAction=b(this.snapScale,1000/60).bind(this);return d;};
D.prototype.detectRotate=function(){this._gizmoPos=new THREE.Vector3();this._op.gizmo._gizmo.getWorldPosition(this._gizmoPos);var p=new THREE.Vector3();var s=new THREE.Vector3();var r=new THREE.Raycaster(this._originPos,this._direction,0,this._detectDistance);this._sourceObjects.getWorldPosition(s);this._radius=this._gizmoPos.distanceTo(s);var a=this._op.handleIndex;this._axis=new THREE.Vector3().setFromMatrixColumn(this._op.gizmo._matOrigin,a).normalize();this._axis.transformDirection(this._op.gizmo._gizmo.matrixWorld);if(this._radius>0.01){p.subVectors(s,this._gizmoPos).normalize();this._detectDistance=this._radius;this._direction.crossVectors(p,this._axis).normalize();}else if(this._finalSnaps.length===2){p.subVectors(this._finalSnaps[0],this._gizmoPos).normalize();this._direction.crossVectors(p,this._axis).normalize();}if(this._op.gizmo._rotationDelta.getComponent(a)>0){this._direction.negate();}var c=new THREE.Plane(this._axis);var d=[],t=[];var S=0.0,e=0.0;if(this._radius<0.01){e=this._sourceObjects.geometry.boundingSphere.clone().applyMatrix4(this._sourceObjects.matrixWorld).radius;S=new THREE.Sphere(this._gizmoPos,e);this._targetBoxes.forEach(function(f,i){if(f.intersectsSphere(S)&&f.intersectsPlane(c)){d.push({object:this._targetObjects[i]});}}.bind(this));}else{S=new THREE.Sphere(this._gizmoPos,this._radius);this._targetBoxes.forEach(function(f,i){if(f.intersectsSphere(S)&&f.intersectsPlane(c)){t.push(this._targetObjects[i]);}}.bind(this));d=r.intersectObjects(t,false);}this._snapAction=b(this.snapRotate,1000/60).bind(this);return d;};
D.prototype.detect=function(d){var o=this._op=d||this._op;if(!this.isReady()||!this._verticesMap.has(this._sourceObjects.uuid)){this.addObjFromScene(o.viewport);}else{this._srcBoxHelper.update();this._sourceBox.setFromObject(this._sourceObjects);this._sourceBox.getCenter(this._originPos);this.updateTargetBox();var i=this._detectType[o.detectType]();this._finalSnaps=this.getFinalSnaps(i);if(this._finalSnaps.length===2){var f=new THREE.Vector3();f.subVectors(this._finalSnaps[1],this._finalSnaps[0]);this._finalDistance=f.length();if(this._finalDistance){this._snapAction();}}}};
function b(f,w){var t;return function(){var a=this,c=arguments;clearTimeout(t);t=setTimeout(function(){t=null;f.apply(a,c);},w);};}
D.prototype.detectCollisionGJK=function(o,t){var M=64;var c=this;function G(f,g){var h=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];var n=2;var d=c._direction;h[1]=v(f,g,d);if(h[1].dot(d)<0){return false;}d=h[1].clone().negate();h[0]=v(f,g,d);if(h[0].dot(d)<0){return false;}var j=h[1].clone().sub(h[0]);var k=h[0].clone().negate();d=j.clone().cross(k).cross(j);var m=function(a,O,x,y,z,A,E){if(x.clone().cross(A).dot(O)>0){h[1]=h[0];h[0]=a.clone();d=x.clone().cross(O).cross(x);n=2;}else{h[2]=h[1];h[1]=h[0];h[0]=a.clone();d=A.clone();}};var r=function(a,O,x,y,z,A,E){if(A.clone().cross(y).dot(O)>0){h[0]=a.clone();d=y.clone().cross(O).cross(y);n=2;}else{m(a,O,x,y,z,A,E);}};var u=function(a,O,x,y,z,A,E){if(A.clone().cross(y).dot(O)>0){h[0]=h[1];h[1]=h[2].clone();x=y;y=z.clone();A=E.clone();r(a,O,x,y,z,A,E);}else{m(a,O,x,y,z,A,E);}};function v(f,g,d){var l=d.clone().normalize();var p=w(f,l);var q=w(g,l.negate());return p.clone().sub(q);}function w(L,d){var N=c._verticesMap.get(L.uuid);var p=L.localToWorld(N[0].clone());var l=p.dot(d);for(var i=1;i<N.length;++i){var q=L.localToWorld(N[i].clone());var P=q.dot(d);if(P>l){p=q;l=P;}}return p;}for(var i=0;i<M;++i){var a=v(f,g,d);if(a.dot(d)<0){return false;}var O,x,y,z,A;if(n===2){O=a.clone().negate();x=h[0].clone().sub(a);y=h[1].clone().sub(a);A=x.clone().cross(y);var B=x.clone().cross(A);if(B.dot(O)>0){h[1]=h[0];h[0]=a.clone();d=x.clone().cross(O).cross(x);continue;}var C=A.clone().cross(y);if(C.dot(O)>0){h[0]=a.clone();d=y.clone().cross(O).cross(y);continue;}if(A.dot(O)>0){h[2]=h[1];h[1]=h[0];h[0]=a.clone();d=A.clone();}else{h[2]=h[0];h[0]=a.clone();d=A.clone().negate();}n=3;continue;}O=a.clone().negate();x=h[0].clone().sub(a);y=h[1].clone().sub(a);z=h[2].clone().sub(a);A=x.clone().cross(y);var E=y.clone().cross(z);var F=z.clone().cross(x);var H=0x1;var I=0x2;var J=0x4;var K=(A.dot(O)>0?H:0)|(E.dot(O)>0?I:0)|(F.dot(O)>0?J:0);if(K===0){return true;}if(K===H){r(a,O,x,y,z,A,E);}else if(K===I){h[0]=h[1];h[1]=h[2].clone();x=y;y=z.clone();A=E.clone();r(a,O,x,y,z,A,E);}else if(K===J){h[1]=h[0];h[0]=h[2].clone();y=x;x=z.clone();A=F.clone();r(a,O,x,y,z,A,E);}else if(K===H||I){u(a,O,x,y,z,A,E);}else if(K===I||J){j=h[0];h[0]=h[1];h[1]=h[2];h[2]=j;j=x;x=y;y=z;z=j;A=E;E=F.clone();u(a,O,x,y,z,A,E);}else if(K===J||H){j=h[1];h[1]=h[0];h[0]=h[2];h[2]=j;j=y;y=x;x=z;z=j;E=A;A=F.clone();u(a,O,x,y,z,A,E);}else{return true;}}return true;}var s=performance.now();var e=G(o,t);if(e){console.log("Collide (ms): ",performance.now()-s);return true;}else{console.log("Not Collide (ms): ",performance.now()-s);return false;}};
return D;});
sap.ui.predefine('sap/ui/vk/tools/Gizmo',["../library","sap/m/library","sap/m/Input","sap/m/Label","sap/ui/core/library","sap/ui/core/Control","./CoordinateSystem","./AxisColours","./ToolNodeSet","../thirdparty/three","./GizmoPlacementMode","../AnimationTrackType"],function(a,L,I,b,c,C,d,A,T,t,G,e){"use strict";var f=L.InputType;
var g=C.extend("sap.ui.vk.tools.Gizmo",{metadata:{library:"sap.ui.vk"}});
g.prototype.hasDomElement=function(){return true;};
g.prototype._drawText=function(i,j,k,l){var p=window.devicePixelRatio;var w=i.width;var h=i.height;var m=w*0.5;var n=h*0.5;var o=i.getContext("2d");o.clearRect(0,0,w,h);o.font="Bold "+k*p+"px Arial";o.textAlign="center";o.textBaseline="middle";o.fillStyle="#000";o.globalAlpha=0.5;o.filter="blur(3px)";o.fillText(j,m+1,n+1);o.fillStyle="#fff";o.globalAlpha=1;o.filter="blur(0px)";o.fillText(j,m,n);if(l){o.beginPath();o.arc(m,n,m-p,0,2*Math.PI,false);o.closePath();o.lineWidth=p*2;o.strokeStyle="#fff";o.stroke();}};
g.prototype._createTextMesh=function(h,w,i,j,k,l){var p=window.devicePixelRatio;var m=document.createElement("canvas");m.width=w*p;m.height=i*p;this._drawText(m,h,j,l);var n=new THREE.Texture(m);n.needsUpdate=true;var o=new THREE.MeshBasicMaterial({map:n,color:k,transparent:true,alphaTest:0.05,premultipliedAlpha:true,side:THREE.DoubleSide});var q=new THREE.Mesh(new THREE.PlaneGeometry(w,i),o);q.userData.color=k;return q;};
g.prototype._createAxisTitles=function(s,h,i){s=s||32;h=h||20;var j=new THREE.Group();j.add(this._createTextMesh("X",s,s,h,A.x,i));j.add(this._createTextMesh("Y",s,s,h,A.y,i));j.add(this._createTextMesh("Z",s,s,h,A.z,i));return j;};
g.prototype._extractBasis=function(m){var h=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];m.extractBasis(h[0],h[1],h[2]);h[0].normalize();h[1].normalize();h[2].normalize();return h;};
g.prototype._updateAxisTitles=function(o,h,j,k,s){var l=this._extractBasis(h.matrixWorld);o.children.forEach(function(m,i){m.position.copy(l[i]).multiplyScalar(k.constructor===THREE.Vector3?k.getComponent(i):k);m.quaternion.copy(j.quaternion);});o.position.copy(h.position);o.scale.setScalar(s);};
g.prototype._updateSelection=function(h){if(h===null){return false;}var n=[];if(this._tool){if(this._tool.getNodeSet()===T.Highlight){h.enumerateSelection(function(i){n.push({node:i});});}else{h.enumerateOutlinedNodes(function(i){n.push({node:i});});}}if(this._nodes.length===n.length&&this._nodes.every(function(v,i){return n[i].node===v.node;})){return false;}this._cleanTempData();this._nodes=n;n.forEach(function(j){j.ignore=false;var p=j.node.parent;while(p&&!j.ignore){for(var i=0,l=n.length;i<l;i++){if(n[i].node===p){j.ignore=true;break;}}p=p.parent;}this._getOffsetForRestTransformation(j.node);}.bind(this));return true;};
g.prototype.setPlacementMode=function(p){this._placementMode=p;};
g.prototype._getAnchorPoint=function(){return this._viewport?this._viewport._anchorPoint:null;};
g.prototype._getSelectionCenter=function(h){if(this._nodes.length===1){var n=this._nodes[0].node;h.setFromMatrixPosition(n.matrixWorld);var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(n);}if(this._placementMode===G.Rest&&u&&u.offsetWTranslation){h.x+=u.offsetWTranslation[0];h.y+=u.offsetWTranslation[1];h.z+=u.offsetWTranslation[2];}}else{h.setScalar(0);if(this._nodes.length>0){var i=new THREE.Vector3();this._nodes.forEach(function(j){var n=j.node;if(n.userData.boundingBox){n.userData.boundingBox.getCenter(i);h.add(i.applyMatrix4(n.matrixWorld));}else{h.add(i.setFromMatrixPosition(n.matrixWorld));}});h.multiplyScalar(1/this._nodes.length);}}};
g.prototype._getGizmoScale=function(p){var r=this._viewport.getRenderer();var h=this._viewport.getCamera().getCameraRef();var i=new THREE.Vector4();i.copy(p).applyMatrix4(this._matViewProj);return i.w*2/(r.getSize(new THREE.Vector2()).x*h.projectionMatrix.elements[0]);};
g.prototype._getEffectiveParent=function(h){if(this._viewport._viewStateManager){var j=this._viewport._viewStateManager.getJoints();if(j){for(var n=0;n<j.length;n++){var i=j[n];if(!i.node||!i.parent){continue;}if(i.node===h){return i.parent;}}}}return h.parent;};
g.prototype._cleanTempData=function(){this._nodes.forEach(function(n){var h=n.node;if(h.userData){delete h.userData.skipUpdateJointNode;}});if(this._nodeUserDataMap){this._nodeUserDataMap.clear();}this._sequence=null;};
g.prototype._prepareForCreatingKey=function(p){this._playback=p;};
g.prototype._getOffsetForRestTransformation=function(n){if(this._viewport._viewStateManager){if(!this._nodeUserDataMap){this._nodeUserDataMap=new Map();}var u=this._nodeUserDataMap.get(n);if(!u){u={};this._nodeUserDataMap.set(n,u);}var h=this._viewport._viewStateManager.getTransformation(n);var r=this._viewport._viewStateManager.getRestTransformation(n);var w=this._viewport._viewStateManager.getRestTransformationWorld(n);var i=this._viewport._viewStateManager.getTransformationWorld(n);if(!r||!w){return;}var p=new THREE.Vector3(r.translation[0],r.translation[1],r.translation[2]);var s=new THREE.Vector3(r.scale[0],r.scale[1],r.scale[2]);u.quatRest=new THREE.Quaternion(r.quaternion[0],r.quaternion[1],r.quaternion[2],r.quaternion[3]);u.matRest=new THREE.Matrix4().compose(p,u.quatRest,s);u.matRestInv=new THREE.Matrix4().getInverse(u.matRest);u.initialTranslation=h.translation.slice();u.initialScale=h.scale.slice();u.initialQuaternion=new THREE.Quaternion(h.quaternion[0],h.quaternion[1],h.quaternion[2],h.quaternion[3]);u.matInitial=n.matrix.clone();u.matInitialInv=new THREE.Matrix4().getInverse(n.matrix);u.quatInitialDiff=u.initialQuaternion.clone().multiply(u.quatRest.clone().inverse());u.quatInitialDiffInv=u.quatInitialDiff.clone().inverse();u.matInitialDiff=n.matrix.clone().multiply(u.matRestInv);u.offsetWTranslation=[w.translation[0]-i.translation[0],w.translation[1]-i.translation[1],w.translation[2]-i.translation[2]];var j=new THREE.Vector3();var k=new THREE.Box3();k.expandByObject(n);k.getCenter(j);u.offsetWTranslationCenter=[w.translation[0]+j.x-2*i.translation[0],w.translation[1]+j.y-2*i.translation[1],w.translation[2]+j.z-2*i.translation[2]];var l=[0,0,0];var m=this._viewport._viewStateManager.getAnimationPlayer();if(m){var o=m.getAnimatedProperty(n,e.Rotate);if(o.offsetToPrevious){l=o.offsetToPrevious;}}u.euler=new THREE.Euler(0,0,0);u.startEuler=new THREE.Euler(0,0,0);u.eulerInParentCoors=new THREE.Euler(l[0],l[1],l[2]);u.startEulerInParentCoors=new THREE.Euler(l[0],l[1],l[2]);}};
g.prototype._updateGizmoObjectTransformation=function(o,i,m){var h=this._viewport.getCamera().getCameraRef();var j=this._getAnchorPoint();var n,p,k;if(j&&this._coordinateSystem===d.Custom){o.position.copy(j.position);o.quaternion.copy(j.quaternion);}else if(this._coordinateSystem===d.Local||this._coordinateSystem===d.Parent){k=this._nodes[i].node;var l=this._getEffectiveParent(k);if(this._coordinateSystem===d.Parent&&l){p=l.matrixWorld;}n=k.matrixWorld.clone();if(p){p.decompose(o.position,o.quaternion,o.scale);o.position.setFromMatrixPosition(n);}else{n.decompose(o.position,o.quaternion,o.scale);}var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(k);}if(this._placementMode===G.Rest&&u&&u.offsetWTranslation){if(m){o.position.x+=u.offsetWTranslationCenter[0];o.position.y+=u.offsetWTranslationCenter[1];o.position.z+=u.offsetWTranslationCenter[2];}else{o.position.x+=u.offsetWTranslation[0];o.position.y+=u.offsetWTranslation[1];o.position.z+=u.offsetWTranslation[2];}n.setPosition(o.position);}}else if(this._nodes.length>0){this._getSelectionCenter(o.position);if(this._coordinateSystem===d.Screen){o.quaternion.copy(h.quaternion);}else{o.quaternion.set(0,0,0,1);}}var s=this._getGizmoScale(o.position);o.scale.setScalar(this._gizmoSize*s);if(n){var q=this._extractBasis(p?p:n);o.matrix.makeBasis(q[0],q[1],q[2]);o.matrix.scale(o.scale);o.matrix.copyPosition(n);o.matrixAutoUpdate=false;}else{o.matrixAutoUpdate=true;}o.updateMatrixWorld(true);return s;};
g.prototype._expandBoundingBox=function(h,j,v){var k=this.getGizmoCount();if(k>0){this._matViewProj.multiplyMatrices(j.projectionMatrix,j.matrixWorldInverse);for(var i=0;i<k;i++){this._updateGizmoTransformation(i,j);this._sceneGizmo._expandBoundingBox(h,v,false);}}};
g.prototype._createEditingForm=function(u,w){this._label=new sap.m.Label({}).addStyleClass("sapUiVkTransformationToolEditLabel");this._units=new sap.m.Label({text:u}).addStyleClass("sapUiVkTransformationToolEditUnits");this._input=new I({width:w+"px",type:f.Number,maxLength:10,textAlign:c.TextAlign.Right,change:function(h){this.setValue(h.getParameter("value"));}.bind(this)});this._editingForm=new sap.m.HBox({items:[this._label,this._input,this._units]}).addStyleClass("sapUiSizeCompact");this._editingForm.onkeydown=this._editingForm.ontap=this._editingForm.ontouchstart=function(h){h.setMarked();};};
g.prototype._getValueLocaleOptions=function(){return{useGrouping:false};};
g.prototype._updateEditingForm=function(h,i,l){var j=this.getDomRef();if(j){if(h&&this._tool&&this._tool.getShowEditingUI()){this._label.setText(l||["X","Y","Z"][i]);this._label.rerender();var k=this._label.getDomRef();if(k){k.style.color=new THREE.Color(A[["x","y","z"][i]]).getStyle();}this._input.setValue(this.getValue().toLocaleString("fullwide",this._getValueLocaleOptions()));var p=this._getEditingFormPosition();var m=this._gizmo.position.clone().applyMatrix4(this._matViewProj).sub(p);var v=this._viewport.getDomRef().getBoundingClientRect();var n=j.getBoundingClientRect();var o=m.x>-0.0001;var q=o?n.width:-n.width;var r=n.height*0.5;var x=THREE.Math.clamp(v.width*(p.x*0.5+0.5)+(o?-20:20),Math.max(q,0),v.width+Math.min(q,0));var y=THREE.Math.clamp(v.height*(p.y*-0.5+0.5),r,v.height-r);j.style.left=Math.round(x)+"px";j.style.top=Math.round(y)+"px";j.style.transform="translate("+(o?"-100%":"0%")+", -50%)";j.style.display="block";}else{j.style.display="none";}}};
return g;});
sap.ui.predefine('sap/ui/vk/tools/GizmoPlacementMode',[],function(){"use strict";var G={Default:"Default",ObjectCenter:"ObjectCenter",OnScreen:"OnScreen",Rest:"Rest"};return G;},true);
sap.ui.predefine('sap/ui/vk/tools/HitTestClickType',[],function(){"use strict";var H={Single:"Single",Double:"Double",Context:"Context"};return H;},true);
sap.ui.predefine('sap/ui/vk/tools/HitTestIdMode',[],function(){"use strict";var H={ThreeJS:"ThreeJS",VEsID:"VEsID",Callback:"Callback"};return H;},true);
sap.ui.predefine('sap/ui/vk/tools/HitTestTool',["./Tool","./HitTestToolHandler","./HitTestIdMode"],function(T,H,a){"use strict";
var b=T.extend("sap.ui.vk.tools.HitTestTool",{
metadata:{properties:{IdMode:{type:"sap.ui.vk.tools.HitTestIdMode",defaultValue:a.ThreeJS}},events:{hit:{parameters:{id:"any",object:"any",point:"any",clickType:"sap.ui.vk.tools.HitTestClickType"}}}},
constructor:function(i,s){if(b._instance){return b._instance;}T.apply(this,arguments);this.setToolid("63150593-75f6-c330-2a7a-c1f85d36b2b9");this._viewport=null;this._handler=new H(this);this._loco=null;b._instance=this;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);};
b.prototype.setActive=function(v,c,g){T.prototype.setActive.call(this,v,c,g);if(this._viewport){if(v){this._prepare();}else{this._removeLocoHandler();}}return this;};
b.prototype._prepare=function(){if(!this._addLocoHandler()){return false;}var o=false;if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){this._dvlRendererId=this._viewport._dvlRendererId;this._dvl=this._viewport._dvl;o=true;}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")&&(this._viewport._scene&&this._viewport._scene.getSceneRef())){o=true;}return o;};
b.prototype.queueCommand=function(c){if(this._prepare()){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(c,this._dvlRendererId);}}return this;};
b.prototype.hitTest=function(x,y,s,c,d){if(this._prepare()){var h=null;if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){return null;}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){if(!s||!c){h=null;}else if(this._viewport._renderer){var e=this._viewport._renderer.domElement;var m=new THREE.Vector2((x-e.offsetLeft)/e.clientWidth*2-1,(e.offsetTop-y)/e.clientHeight*2+1);var r=new THREE.Raycaster();r.setFromCamera(m,c.getCameraRef());var f=r.intersectObjects(s.getSceneRef().children,true);if(f&&f.length){for(var i in f){var g=f[i];var o=g.object;var p=o.parent;while(p){if(p.userData.closed){o=p;}p=p.parent;}while(o.parent&&o.userData.skipIt){o=o.parent;}if(o.visible&&!o.isBillboard&&!o.isDetailView){g.object=o;h=g;break;}}}}}var j=null;if(h){var k;switch(this.getIdMode()){case a.VEsID:k=this._viewport._scene.nodeRefToPersistentId(h.object);break;case a.ThreeJS:k=h.object.id;break;default:k=h.object.id;break;}j={id:k,object:h.object,point:h.point,clickType:d};this.fireHit(j);}return j;}};
return b;});
sap.ui.predefine('sap/ui/vk/tools/HitTestToolHandler',["sap/ui/base/EventProvider","./HitTestClickType"],function(E,H){"use strict";
var a=E.extend("sap.ui.vk.tools.HitTestToolHandler",{
metadata:{},
constructor:function(T){this._priority=0;this._tool=T;this._rect=null;this._gesture=false;this._nomenu=false;}
});
a.prototype.destroy=function(){this._tool=null;this._rect=null;this._gesture=false;};
a.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
a.prototype._inside=function(e){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
a.prototype.beginGesture=function(e){e.handled=false;};
a.prototype.move=function(e){e.handled=false;};
a.prototype.endGesture=function(e){e.handled=false;};
a.prototype._executeHittest=function(e,c){if(this._inside(e)&&!this._gesture){this._gesture=false;var x=e.x-this._rect.x,y=e.y-this._rect.y;this._gizmo=this._tool.getGizmo();if(this._gizmo){this._gizmo.show(this._tool._viewport);this._gizmo.moveGizmo(x,y);}var s=this._tool._viewport.getScene();var b=this._tool._viewport.getCamera();this._tool.hitTest(x,y,s,b,c);if(this._gizmo){this._gizmo.hide();}}};
a.prototype.click=function(e){this._executeHittest(e,H.Single);e.handled=true;};
a.prototype.doubleClick=function(e){this._executeHittest(e,H.Double);e.handled=false;};
a.prototype.contextMenu=function(e){this._executeHittest(e,H.Context);e.handled=false;};
a.prototype.getViewport=function(){return this._tool._viewport;};
return a;});
sap.ui.predefine('sap/ui/vk/tools/MoveTool',["./Tool","./CoordinateSystem","./GizmoPlacementMode","./MoveToolHandler","./MoveToolGizmo","./Detector","./ToolNodeSet"],function(T,C,G,M,a,D,b){"use strict";
var c=T.extend("sap.ui.vk.tools.MoveTool",{
metadata:{properties:{coordinateSystem:{type:"sap.ui.vk.tools.CoordinateSystem",defaultValue:C.World},placementMode:{type:"sap.ui.vk.tools.GizmoPlacementMode",defaultValue:G.Default},enableStepping:{type:"boolean",defaultValue:false},enableSnapping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},autoResetValues:{type:"boolean",defaultValue:true},allowContextMenu:{type:"boolean",defaultValue:true},nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:b.Highlight}},events:{moving:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},moved:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},coordinateSystemChanged:{parameters:{coordinateSystem:"sap.ui.vk.tools.CoordinateSystem"}},placementModeChanged:{parameters:{placementMode:"sap.ui.vk.tools.GizmoPlacementMode"}}}},
constructor:function(i,s){T.apply(this,arguments);this._viewport=null;this._handler=new M(this);this._gizmo=null;this._detector=new D();}
});
c.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new a());};
c.prototype.setActive=function(v,d,g){T.prototype.setActive.call(this,v,d,g);if(this._viewport){if(v){this._gizmo=this.getGizmo();this._gizmo.setCoordinateSystem(this.getCoordinateSystem());this._gizmo.setPlacementMode(this.getPlacementMode());this._gizmo.show(this._viewport,this);this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
c.prototype.queueCommand=function(d){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){d();}}return this;};
c.prototype.setPlacementMode=function(v){var d=this.getPlacementMode();if(d!==v){this.setProperty("placementMode",v,true);this.getGizmo().setPlacementMode(v);if(this._viewport){this._viewport.setShouldRenderFrame();}this.firePlacementModeChanged({placementMode:v});}return this;};
c.prototype.setCoordinateSystem=function(v){var d=this.getCoordinateSystem();if(d!==v){this.setProperty("coordinateSystem",v,true);this.getGizmo().setCoordinateSystem(v);if(this._viewport){this._viewport.setShouldRenderFrame();}this.fireCoordinateSystemChanged({coordinateSystem:v});}return this;};
c.prototype.setShowEditingUI=function(v){this.setProperty("showEditingUI",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.setEnableSnapping=function(v){this.setProperty("enableSnapping",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.resetValues=function(){this.getGizmo().resetValues();if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.setNodeSet=function(v){this.setProperty("nodeSet",v,true);if(this._gizmo){this._gizmo.handleSelectionChanged();}};
c.prototype.getDetector=function(){return this._detector;};
c.prototype.move=function(x,y,z,d){var o;if(d&&d!==this.getCoordinateSystem()){o=this.getCoordinateSystem();this.setCoordinateSystem(d);}if(this._gizmo){this._gizmo.move(x,y,z);}if(o){this.setCoordinateSystem(o);}if(this._gizmo){this._gizmo.endGesture();}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.prepareForCreatingTranslateKey=function(p){if(this._gizmo){this._gizmo._prepareForCreatingKey(p);return this._gizmo._getNodesProperties();}return null;};
return c;});
sap.ui.predefine('sap/ui/vk/tools/MoveToolGizmo',["../getResourceBundle","../thirdparty/three","./Gizmo","./MoveToolGizmoRenderer","./CoordinateSystem","./GizmoPlacementMode","./AxisColours","../AnimationTrackType","sap/base/assert","sap/base/Log"],function(g,t,G,M,C,d,A,e,f,L){"use strict";
var h=G.extend("sap.ui.vk.tools.MoveToolGizmo",{metadata:{library:"sap.ui.vk"}});
h.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._createEditingForm(g().getText("TOOL_UNITS_MM"),84);this._gizmoIndex=-1;this._handleIndex=-1;this._value=new THREE.Vector3();this._moveDelta=new THREE.Vector3();this._viewport=null;this._tool=null;this._sceneGizmo=new THREE.Scene();var l=new THREE.DirectionalLight(0xFFFFFF,0.5);l.position.set(1,3,2);this._sceneGizmo.add(l);this._sceneGizmo.add(new THREE.AmbientLight(0xFFFFFF,0.5));this._gizmo=new THREE.Group();this._touchAreas=new THREE.Group();this._sceneGizmo.add(this._gizmo);this._coordinateSystem=C.World;this._placementMode=d.Default;this._nodes=[];this._matViewProj=new THREE.Matrix4();this._gizmoSize=96;function c(a,b,n){var o=96,p=1,q=24,r=4,s=48;a.multiplyScalar(1/o);var u=new THREE.MeshLambertMaterial({color:b,transparent:true});var v=new THREE.CylinderBufferGeometry(p,p,o-q,4);var m=new THREE.Matrix4().makeBasis(new THREE.Vector3(a.y,a.z,a.x),a,new THREE.Vector3(a.z,a.x,a.y));m.setPosition(a.clone().multiplyScalar((o-q)*0.5));v.applyMatrix4(m);var w=new THREE.Mesh(v,u);w.matrixAutoUpdate=false;w.userData.color=b;var x=new THREE.CylinderBufferGeometry(0,r,q,12,1);m.setPosition(a.clone().multiplyScalar(o-q*0.5));x.applyMatrix4(m);var y=new THREE.Mesh(x,u);y.matrixAutoUpdate=false;w.add(y);var z=new THREE.CylinderGeometry(s*0.5,s*0.5,s,12,1);z.applyMatrix4(m);var B=new THREE.CylinderGeometry(s*0.5,s*0.2,s,12,1);m.setPosition(a.clone().multiplyScalar(o*0.5));z.merge(B,m);n.add(new THREE.Mesh(z,u));return w;}function i(a,b,m){var n=new Float32Array(9);n[a]=n[b+6]=1;n[a+3]=n[b+3]=0.5;var v=new THREE.Vector3().setComponent(a,0.333);var o=new THREE.Vector3().setComponent(b,0.333);var k=new THREE.Geometry();k.vertices.push(new THREE.Vector3(),v,o,v.clone().add(o));k.faces.push(new THREE.Face3(0,2,1),new THREE.Face3(1,2,3));var p=new THREE.MeshBasicMaterial({color:0xFFFF00,opacity:0.5,transparent:true,visible:false,side:THREE.DoubleSide});var q=new THREE.Mesh(k,p);q.matrixAutoUpdate=false;q.userData.colors=n;var r=new THREE.BufferGeometry();var s=new Float32Array(9);s[a]=s[a+3]=s[b+3]=s[b+6]=0.333;r.setAttribute("position",new THREE.Float32BufferAttribute(s,3));r.setAttribute("color",new THREE.Float32BufferAttribute(n,3));var u=new THREE.Line(r,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,transparent:true,linewidth:window.devicePixelRatio}));u.matrixAutoUpdate=false;q.add(u);var w=new THREE.Geometry();w.vertices.push(new THREE.Vector3(),v,o,v.clone().add(o));w.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(2,1,3));m.add(new THREE.Mesh(w,new THREE.MeshBasicMaterial({side:THREE.DoubleSide})));return q;}this._gizmo.add(c(new THREE.Vector3(1,0,0),A.x,this._touchAreas));this._gizmo.add(c(new THREE.Vector3(0,1,0),A.y,this._touchAreas));this._gizmo.add(c(new THREE.Vector3(0,0,1),A.z,this._touchAreas));this._gizmo.add(i(1,2,this._touchAreas));this._gizmo.add(i(2,0,this._touchAreas));this._gizmo.add(i(0,1,this._touchAreas));this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);var k=new THREE.Geometry();k.vertices.push(new THREE.Vector3(),new THREE.Vector3());this._line=new THREE.LineSegments(k,new THREE.LineBasicMaterial());this._line.frustumCulled=false;this._line.visible=false;this._gizmo.add(this._line);};
h.prototype.hasDomElement=function(){return true;};
h.prototype.resetValues=function(){this._value.setScalar(0);};
h.prototype.setCoordinateSystem=function(c){this._coordinateSystem=c;var s=c===C.Screen;var a=this._gizmo.children,b=this._touchAreas.children;a[2].visible=a[3].visible=a[4].visible=!s;b[2].visible=b[3].visible=b[4].visible=!s;this._axisTitles.children[2].visible=!s;this._gizmoIndex=this._handleIndex=-1;};
h.prototype.show=function(v,a){this._viewport=v;this._tool=a;this._nodes.length=0;this._updateSelection(v._viewStateManager);var n=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:n},true);};
h.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._updateEditingForm(false);};
h.prototype.getGizmoCount=function(){if(this._coordinateSystem===C.Local||this._coordinateSystem===C.Parent){return this._nodes.length;}else{return this._nodes.length>0?1:0;}};
h.prototype.getTouchObject=function(i){if(this._nodes.length===0){return null;}this._updateGizmoObjectTransformation(this._touchAreas,i,true);return this._touchAreas;};
var j=[1,2,4,6,5,3];
h.prototype.highlightHandle=function(a,b){var i;for(i=0;i<3;i++){var c=this._gizmo.children[i];var k=j[a]&(1<<i);var l=k?0xFFFF00:c.userData.color;c.material.color.setHex(l);c.material.opacity=(k||b)?1:0.35;c.children[0].material.color.setHex(l);c.children[0].material.opacity=(k||b)?1:0.35;var m=this._axisTitles.children[i];m.material.color.setHex(l);m.material.opacity=k||b?1:0.35;}for(i=3;i<6;i++){var p=this._gizmo.children[i];p.material.visible=i===a;var n=p.children[0].geometry.attributes.color;n.copyArray(i===a?[1,1,0,1,1,0,1,1,0]:p.userData.colors);n.needsUpdate=true;p.children[0].material.opacity=(i===a||b)?1:0.35;}};
h.prototype.selectHandle=function(i,a){this._gizmoIndex=a;this._handleIndex=i;if(this._tool.getAutoResetValues()){this.resetValues();}this._viewport.setShouldRenderFrame();};
h.prototype.beginGesture=function(){this._beginValue=this._value.clone();this._moveDelta.setScalar(0);this._matOrigin=this._gizmo.matrixWorld.clone();this._nodes.forEach(function(n){var a=n.node;n.matOrigin=a.matrixWorld.clone();n.originLocal=a.position.clone();n.origin=new THREE.Vector3().setFromMatrixPosition(a.matrixWorld);if(a.parent){n.matParentInv=new THREE.Matrix4().getInverse(a.parent.matrixWorld);}else{n.matParentInv=new THREE.Matrix4();}});};
h.prototype._printEventInfo=function(a,x,y,z,n){L.debug(a+" is fired:"+" x = "+x+"; y = "+y+"; z = "+z);n.forEach(function(p){L.debug("Node: "+p.node.name);if(p.offsetToRest){L.debug("offsetToRest: [ "+p.offsetToRest[0]+", "+p.offsetToRest[1]+", "+p.offsetToRest[2]+" ] ");}else{L.debug("offsetToRest: null");}if(p.offsetToPrevious){L.debug("offsetToPrevious: [ "+p.offsetToPrevious[0]+", "+p.offsetToPrevious[1]+", "+p.offsetToPrevious[2]+" ] ");}else{L.debug("offsetToPrevious: null");}if(p.absolute){L.debug("absolute: [ "+p.absolute[0]+", "+p.absolute[1]+", "+p.absolute[2]+" ] ");}else{L.debug("absolute: null");}if(p.world){L.debug("world: [ "+p.world[0]+", "+p.world[1]+", "+p.world[2]+" ] ");}else{L.debug("world: null");}if(p.restDifference){L.debug("restDifference: [ "+p.restDifference[0]+", "+p.restDifference[1]+", "+p.restDifference[2]+" ] ");}else{L.debug("restDifference: null");}if(p.restDifferenceInCoordinates){L.debug("restDifferenceInCoordinates: [ "+p.restDifferenceInCoordinates[0]+", "+p.restDifferenceInCoordinates[1]+", "+p.restDifferenceInCoordinates[2]+" ] ");}else{L.debug("restDifferenceInCoordinates: null");}});};
h.prototype._getOffsetToRestInCooridnateSystem=function(n,o,c){if(c===C.World){return o.toArray();}else if(c===C.Custom){var a=new THREE.Matrix4().extractRotation(this._gizmo.matrixWorld);var b=new THREE.Matrix4().getInverse(a);return o.clone().applyMatrix4(b).toArray();}else if(c===C.Local){var i=new THREE.Matrix4().extractRotation(n.matrixWorld);var k=new THREE.Matrix4().getInverse(i);return o.clone().applyMatrix4(k).toArray();}else if(c===C.Screen){var s=this._viewport.getRenderer().getSize(new THREE.Vector2());var l=this._viewport.getCamera().getCameraRef();var m=new THREE.Vector4().copy(this._gizmo.position).applyMatrix4(this._matViewProj);var p=new THREE.Matrix3().setFromMatrix4(l.matrixWorld);var q=new THREE.Matrix3().getInverse(p);var r=o.clone().applyMatrix3(q);var u=2*m.w/(l.projectionMatrix.elements[0]*s.width);var v=2*m.w/(l.projectionMatrix.elements[5]*s.height);return[r.x/u,r.y/v,0.0];}};
h.prototype._getNodesProperties=function(){var n=[];this._nodes.forEach(function(a){var b=a.node;var p={};p.node=b;var c=this._getEffectiveParent(b);var i=new THREE.Matrix4();if(c===b.parent){var r=this._viewport._viewStateManager.getRelativeTransformation(b);p.offsetToRestInParent=r.translation.slice();if(b.parent){i=new THREE.Matrix4().extractRotation(b.parent.matrixWorld);}p.offsetToPreviousInParent=p.offsetToRestInParent.slice();var s;if(this._playback){s=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(b,e.Translate,this._playback);if(s){p.offsetToPreviousInParent[0]-=s[0];p.offsetToPreviousInParent[1]-=s[1];p.offsetToPreviousInParent[2]-=s[2];}}var k=this._viewport._viewStateManager.getRestTransformation(b);var l=[k.translation[0],k.translation[1],k.translation[2]];if(s){l[0]+=s[0];l[1]+=s[1];l[2]+=s[2];}var q=new THREE.Quaternion();var m=new THREE.Vector3();var o=new THREE.Vector3();b.matrix.decompose(o,q,m);var u=new THREE.Matrix4().makeTranslation(-l[0],-l[1],-l[2]);var v=new THREE.Matrix4().makeTranslation(-k.translation[0],-k.translation[1],-k.translation[2]);if(m.x===0.0||m.y===0.0||m.z===0.0){m.x=1;m.y=1;m.z=1;}var w=new THREE.Matrix4().makeScale(1/m.x,1/m.y,1/m.z);var x=new THREE.Matrix4().makeRotationFromQuaternion(q.inverse());var y=w.clone().multiply(x).multiply(u).multiply(b.matrix);y.decompose(o,q,m);p.offsetToPrevious=o.toArray();var z=w.multiply(x).multiply(v).multiply(b.matrix);z.decompose(o,q,m);p.offsetToRest=o.toArray();}else{if(b.userData.skipUpdateJointNode){this._viewport._viewStateManager._setJointNodeOffsets(b,e.Translate);}if(b.userData&&b.userData.offsetTranslation){p.offsetToRestInParent=b.userData.offsetTranslation.slice();}else{p.offsetToRestInParent=[0,0,0];}p.offsetToPreviousInParent=p.offsetToRestInParent.slice();if(b.userData.skipUpdateJointNode){b.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();b.userData.skipUpdateJointNode=true;}var B=this._viewport._viewStateManager.getRestTransformationUsingJoint(b);var D=new THREE.Vector3();var E=new THREE.Vector3(B.scale[0],B.scale[1],B.scale[2]);var F=new THREE.Quaternion(B.quaternion[0],B.quaternion[1],B.quaternion[2],B.quaternion[3]);if(b.userData.offsetScale){E.x*=b.userData.offsetScale[0];E.y*=b.userData.offsetScale[1];E.z*=b.userData.offsetScale[2];}if(b.userData.offsetQuaternion){var H=new THREE.Quaternion(b.userData.offsetQuaternion[0],b.userData.offsetQuaternion[1],b.userData.offsetQuaternion[2],b.userData.offsetQuaternion[3]);F.multiply(H);}var I=new THREE.Matrix4().makeRotationFromQuaternion(F);var J=new THREE.Matrix4().makeTranslation(B.translation[0],B.translation[1],B.translation[2]);var K=c.matrixWorld.clone().multiply(J).multiply(I).scale(E);var N=new THREE.Matrix4().getInverse(K).multiply(b.matrixWorld);N.decompose(D,F,E);p.offsetToPrevious=D.toArray();p.offsetToRest=D.toArray();}var O=this._viewport._viewStateManager.getTransformation(b);p.absolute=[O.translation[0],O.translation[1],O.translation[2]];var P=this._viewport._viewStateManager.getTransformationWorld(b);p.world=P.translation;var Q;if(this._nodeUserDataMap){Q=this._nodeUserDataMap.get(b);}if(Q&&Q.initialTranslation){p.restDifference=[O.translation[0]-Q.initialTranslation[0],O.translation[1]-Q.initialTranslation[1],O.translation[2]-Q.initialTranslation[2]];if(this._coordinateSystem===C.Parent){p.restDifferenceInCoordinates=p.restDifference.slice();}else{var R=new THREE.Vector3(p.restDifference[0],p.restDifference[1],p.restDifference[2]).applyMatrix4(i);p.restDifferenceInCoordinates=this._getOffsetToRestInCooridnateSystem(b,R,this._coordinateSystem);}}n.push(p);}.bind(this));return n;};
h.prototype.endGesture=function(){this._line.visible=false;var n=this._getNodesProperties();var o=this._moveDelta.clone();if(this._coordinateSystem===C.Custom){var a=new THREE.Matrix4().extractRotation(this._gizmo.matrixWorld);var b=new THREE.Matrix4().getInverse(a);o.applyMatrix4(b);}delete this._beginValue;this._nodes.forEach(function(c){var i=c.node;if(i.userData){delete i.userData.skipUpdateJointNode;}this._viewport._viewStateManager._setJointNodeOffsets(i,e.Translate);}.bind(this));this._tool.fireMoved({x:o.x,y:o.y,z:o.z,nodesProperties:n});this._printEventInfo("Event 'moved'",o.x,o.y,o.z,n);};
h.prototype._setOffset=function(o,a){if(this._coordinateSystem===C.Local||this._coordinateSystem===C.Parent){var n=this._nodes[a];var b=n.node;var c=this._getEffectiveParent(b);if(this._coordinateSystem===C.Parent&&c){b=c;}var m=new THREE.Matrix4().getInverse(b.matrixWorld);var s=new THREE.Vector3().setFromMatrixScale(b.matrixWorld);var i=n.origin.clone().applyMatrix4(m);o=n.origin.clone().add(o).applyMatrix4(m).sub(i).multiply(s);}else if(this._coordinateSystem===C.Screen){var k=this._viewport.getRenderer().getSize(new THREE.Vector2());var p=this._gizmo.position.clone().applyMatrix4(this._matViewProj);var l=this._gizmo.position.clone().add(o).applyMatrix4(this._matViewProj);o.set(Math.round((l.x-p.x)*0.5*k.width),Math.round((l.y-p.y)*0.5*k.height),0);}var q=this._getNodesProperties();var r=o.clone();if(this._coordinateSystem===C.Custom){var u=new THREE.Matrix4().extractRotation(this._gizmo.matrixWorld);var v=new THREE.Matrix4().getInverse(u);r.applyMatrix4(v);}if(this._tool.fireEvent("moving",{x:r.x,y:r.y,z:r.z,nodesProperties:q},true)){this._printEventInfo("Event 'moving'",r.x,r.y,r.z,q);this._move(o);if(this._coordinateSystem===C.Screen){o.set(new THREE.Vector3().setFromMatrixColumn(this._matOrigin,0).normalize().dot(o),new THREE.Vector3().setFromMatrixColumn(this._matOrigin,1).normalize().dot(o),0);}else if(this._coordinateSystem===C.Custom){var w=this._getAnchorPoint();if(w){var x=new THREE.Matrix4().getInverse(w.matrixWorld);var y=new THREE.Vector3().setFromMatrixScale(w.matrixWorld);var z=w.position.clone().applyMatrix4(x);o.copy(w.position.clone().add(o).applyMatrix4(x).sub(z).multiply(y));}}this._line.geometry.vertices[0].setScalar(0).sub(o);this._line.geometry.verticesNeedUpdate=true;this._line.geometry.computeBoundingBox();o.set(Math.abs(o.x),Math.abs(o.y),Math.abs(o.z));o.multiplyScalar(1/Math.max(o.x,o.y,o.z));this._line.material.color.setRGB(o.x,o.y,o.z);this._line.visible=true;}};
h.prototype._move=function(o){this._value.addVectors(this._beginValue,o);this._moveDelta.copy(o);this._nodes.forEach(function(n){var l=n.node;if(!l.userData){l.userData={};}l.userData.skipUpdateJointNode=true;});if(this._coordinateSystem===C.Local||this._coordinateSystem===C.Parent){this._nodes.forEach(function(n){var l=n.node;var m=this._getEffectiveParent(l);var p=null;if(this._coordinateSystem===C.Parent&&m){p=this._extractBasis(m.matrixWorld);}else{p=this._extractBasis(l.matrixWorld);}var q=n.origin.clone();q.add(p[0].multiplyScalar(o.x)).add(p[1].multiplyScalar(o.y)).add(p[2].multiplyScalar(o.z));l.matrixWorld.setPosition(q);l.matrix.multiplyMatrices(n.matParentInv,l.matrixWorld);l.position.setFromMatrixPosition(l.matrix);l.matrixWorldNeedsUpdate=true;}.bind(this));}else{if(this._coordinateSystem===C.Screen){var s=this._viewport.getRenderer().getSize(new THREE.Vector2());var c=this._viewport.getCamera().getCameraRef();var a=new THREE.Vector4().copy(this._gizmo.position).applyMatrix4(this._matViewProj);var b=o.x*2*a.w/(c.projectionMatrix.elements[0]*s.width);var i=o.y*2*a.w/(c.projectionMatrix.elements[5]*s.height);o.setFromMatrixColumn(c.matrixWorld,0).multiplyScalar(b);o.add(new THREE.Vector3().setFromMatrixColumn(c.matrixWorld,1).multiplyScalar(i));}this._gizmo.position.setFromMatrixPosition(this._matOrigin).add(o);if(this._coordinateSystem===C.Custom){var k=this._getAnchorPoint();if(k){k.position.copy(this._gizmo.position);}}this._nodes.forEach(function(n){if(!n.ignore){var l=n.node;l.matrixWorld.setPosition(n.origin.clone().add(o));l.matrix.multiplyMatrices(n.matParentInv,l.matrixWorld);l.position.setFromMatrixPosition(l.matrix);l.matrixWorldNeedsUpdate=true;}});}this._viewport.setShouldRenderFrame();};
h.prototype.move=function(x,y,z){this.beginGesture();if(this._coordinateSystem===C.Custom){var o=new THREE.Vector3(x,y,z);var a=new THREE.Matrix4().extractRotation(this._gizmo.matrixWorld);o.applyMatrix4(a);x=o.x;y=o.y;z=o.z;}this._move(new THREE.Vector3(x,y,z||0));};
h.prototype.getValue=function(){return(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3)?this._value.getComponent(this._handleIndex):0;};
h.prototype.setValue=function(v){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){this.beginGesture();this._move(new THREE.Vector3().setComponent(this._handleIndex,v-this._value.getComponent(this._handleIndex)));this.endGesture();}};
h.prototype.expandBoundingBox=function(b){if(this._viewport){this._expandBoundingBox(b,this._viewport.getCamera().getCameraRef(),true);}};
h.prototype.handleSelectionChanged=function(a){if(this._viewport){if(this._tool.getEnableSnapping()){this._tool.getDetector().setSource(this._viewport._viewStateManager);}this._updateSelection(this._viewport._viewStateManager);var n=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:n},true);this._gizmoIndex=this._handleIndex=-1;}};
h.prototype._getSelectionCenter=function(a){G.prototype._getSelectionCenter.apply(this,arguments);var b=this;function i(c,n,w,m){var u=(w/2);var x=(m/2);c.project(n);c.x=(c.x*u)+u;c.y=-(c.y*x)+x;return c;}function k(c,n,w,m){var u=(w/2);var x=(m/2);c.x=(c.x-u)/u;c.y=-(c.y-x)/x;c.unproject(n);return c;}function l(n,w,m){var c=new THREE.Vector3(b._gizmoSize,b._gizmoSize,0);var u=new THREE.Vector3(w-b._gizmoSize,b._gizmoSize,0);var x=new THREE.Vector3(w-b._gizmoSize,m-b._gizmoSize,0);var y=new THREE.Vector3(b._gizmoSize,m-b._gizmoSize,0);var z=[k(c,n,w,m),k(u,n,w,m),k(x,n,w,m),k(y,n,w,m)];return z[0].add(z[1]).add(z[2]).add(z[3]).multiplyScalar(0.25);}if(this._placementMode===d.OnScreen){var v=this._viewport.getDomRef().getBoundingClientRect();var w=v.width;var m=v.height;var n=this._viewport.getCamera().getCameraRef();var p=i(a.clone(),n,w,m);var o=p.clone();var q=[o.x<this._gizmoSize&&o.setX(b._gizmoSize)||o.x>w-this._gizmoSize&&o.setX(w-b._gizmoSize),o.y<this._gizmoSize&&o.setY(b._gizmoSize)||o.y>m-this._gizmoSize&&o.setY(m-b._gizmoSize)].some(function(c){return c!==false;})&&a.copy(k(o,n,w,m));return p.z>1.0&&a.copy(l(n,w,m))||q||a;}else if(this._placementMode===d.ObjectCenter&&this._nodes.length===1){var r=new THREE.Vector3();if(this._nodes[0].node.userData.boundingBox){this._nodes[0].node.userData.boundingBox.getCenter(r);}else{var s=new THREE.Box3();s.expandByObject(this._nodes[0].node);s.getCenter(r);}a.copy(r.applyMatrix4(this._nodes[0].node.matrixWorld));}};
h.prototype._updateGizmoTransformation=function(i,c){var s=this._updateGizmoObjectTransformation(this._gizmo,i,true);this._updateAxisTitles(this._axisTitles,this._gizmo,c,this._gizmoSize+18,s);this._line.scale.setScalar(1/(this._gizmoSize*s));};
h.prototype._getEditingFormPosition=function(){var s=this._updateGizmoObjectTransformation(this._gizmo,this._gizmoIndex,true);var a=new THREE.Vector3().setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return a.clone().multiplyScalar((this._gizmoSize+18)*s).add(this._gizmo.position).applyMatrix4(this._matViewProj);};
h.prototype.render=function(){f(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");if(this._nodes.length>0){var r=this._viewport.getRenderer(),c=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);r.clearDepth();for(var i=0,l=this.getGizmoCount();i<l;i++){this._updateGizmoTransformation(i,c);r.render(this._sceneGizmo,c);}}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex);};
return h;});
sap.ui.predefine('sap/ui/vk/tools/MoveToolGizmoRenderer',[],function(){"use strict";var M={};
M.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkTransformationToolEdit");r.writeClasses();r.write(">");r.renderControl(c._editingForm);r.write("</div>");};
return M;},true);
sap.ui.predefine('sap/ui/vk/tools/PoiManipulationTool',["./Tool","../thirdparty/three","./PoiToolHandler","./PoiToolGizmo","../threejs/PoiHelper","./ToolNodeSet"],function(T,t,P,a,b,c){"use strict";
var d=T.extend("sap.ui.vk.tools.PoiManipulationTool",{
metadata:{properties:{nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:c.Highlight}},aggregations:{buttons:{type:"sap.m.Button",multiple:true}},events:{editing:{parameters:{nodeRef:"any"}},removing:{parameters:{nodeRef:"any"}},moving:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},moved:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}}}},
constructor:function(i,s){T.apply(this,arguments);this._viewport=null;this._poiHelper=new b();this.setAggregation("gizmo",new a());this._handler=new P(this);this._buttonPosition=new THREE.Vector2();this._selectedPoi=new Set();}
});
d.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this._editButton=new sap.m.Button({icon:"sap-icon://edit",type:sap.m.ButtonType.Neutral,press:function(e){this.fireEditing({nodeRef:this._selectedPoi.values().next().value});}.bind(this)}).addStyleClass("sapUiVizKitPoiButtonEdit");this._deleteButton=new sap.m.Button({icon:"sap-icon://delete",type:sap.m.ButtonType.Neutral,press:function(e){this.fireRemoving({nodeRef:this._selectedPoi.values().next().value});}.bind(this)}).addStyleClass("sapUiVizKitPoiButtonDelete");this.addAggregation("buttons",this._editButton);this.addAggregation("buttons",this._deleteButton);this.setButtonsVisibility(false);this.attachMoved(function(e){var n=e.getParameter("nodesProperties");for(var i=0;i<n.length;++i){var f=n[i].node;this._poiHelper.adjustPoi(this._viewport,f);}});this.setFootprint(["sap.ui.vk.threejs.Viewport"]);};
d.prototype.getSelectedPois=function(){var p=[];if(this._viewport){var v=this._viewport._viewStateManager;v.getSymbolNodes().forEach(function(e){if(v.getSelectionState(e)){p.push(e);}});}return p;};
d.prototype._updateSelectedPoi=function(){if(this._viewport){var v=this._viewport._viewStateManager;var s=v.getSymbolNodes();this._selectedPoi.forEach(function(p){if(!s.includes(p)){this._selectedPoi.delete(p);}}.bind(this));s.forEach(function(p){if(v.getSelectionState(p)){this._selectedPoi.add(p);}else{this._selectedPoi.delete(p);}}.bind(this));}return this;};
d.prototype._updateButtonPosition=function(n){var v=this._viewport.getDomRef().getBoundingClientRect();var e=this._poiHelper.getPoiRect(this._viewport,n);if(e){var f=new THREE.Box3();f.expandByObject(n);var g=new THREE.Vector3();f.getCenter(g);var h=this._viewport.projectToScreen(g.x,g.y,g.z,this._viewport.getCamera());var i=h.x+e.width/2;var j=v.height-h.y-e.height/2;this._buttonPosition.set(i,j);return true;}return false;};
d.prototype.handlePoiSelectionChange=function(){this._updateSelectedPoi();};
d.prototype.setActive=function(v,e){T.prototype.setActive.call(this,v,e);if(this._viewport){this.updateButtons();if(v){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._gizmo.rerender();this._addLocoHandler();this._viewport._viewStateManager.attachSelectionChanged(this.handlePoiSelectionChange,this);}else{this._removeLocoHandler();this._viewport._viewStateManager.detachSelectionChanged(this.handlePoiSelectionChange,this);if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
d.prototype.updateButtons=function(){this._updateSelectedPoi();var e=this.getButtons();var f;e.forEach(function(g){if(g.getVisible()){g.rerender();if(g.getDomRef()){f=g.getDomRef().parentElement;}}});if(f){if(this._selectedPoi.size&&this._updateButtonPosition(this._selectedPoi.values().next().value)){f.style.display="block";f.style.left=this._buttonPosition.x+"px";f.style.top=this._buttonPosition.y+"px";}else{f.style.display="none";}}};
d.prototype.setButtonsVisibility=function(v){this.getButtons().forEach(function(e){if(e.getVisible()!==v){e.setVisible(v);}});};
d.prototype.addButtons=function(e){if(!Array.isArray(e)){e=[e];}e.forEach(function(f){this.addAggregation("buttons",f);},this);};
return d;});
sap.ui.predefine('sap/ui/vk/tools/PoiToolGizmo',["../thirdparty/three","./Gizmo","./PoiToolGizmoRenderer","./GizmoPlacementMode","sap/base/assert"],function(t,G,P,a,b){"use strict";
var c=G.extend("sap.ui.vk.tools.PoiToolGizmo",{metadata:{library:"sap.ui.vk"}});
c.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._viewport=null;this._tool=null;this._placementMode=a.ObjectCenter;this._nodes=[];this._poiIndex=-1;this._moveDelta=new THREE.Vector3();};
c.prototype.hasDomElement=function(){return true;};
c.prototype.show=function(v,d){this._viewport=v;this._tool=d;this._nodes.length=0;this._updateSelection(v._viewStateManager);var n=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:n},true);};
c.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._poiIndex=-1;};
c.prototype.getPOICount=function(){return this._nodes.length;};
c.prototype.getPOI=function(i){return i<this._nodes.length?this._nodes[i].node:null;};
c.prototype.selectPOI=function(p){this._poiIndex=p;this._viewport.setShouldRenderFrame();};
c.prototype.beginGesture=function(){this._moveDelta.setScalar(0);this._nodes.forEach(function(n){var d=n.node;n.origin=new THREE.Vector3().setFromMatrixPosition(d.matrixWorld);n.matParentInv=new THREE.Matrix4();if(d.parent){n.matParentInv.getInverse(d.parent.matrixWorld);}});};
c.prototype._getNodesProperties=function(){var n=[];this._nodes.forEach(function(d){n.push({node:d.node});});return n;};
c.prototype.endGesture=function(){this._tool.fireMoved({x:this._moveDelta.x,y:this._moveDelta.y,z:this._moveDelta.z,nodesProperties:this._getNodesProperties()});};
c.prototype._setOffset=function(o){if(this._tool.fireEvent("moving",{x:o.x,y:o.y,z:o.z,nodesProperties:this._getNodesProperties()},true)){this._move(o);}};
c.prototype._move=function(o){this._moveDelta.copy(o);var i=this._viewport._isPanoramicActivated();var d=new THREE.Vector3().setFromMatrixPosition(this._viewport.getCamera().getCameraRef().matrixWorld);this._nodes.forEach(function(n){var e=n.node;if(!n.origin){n.origin=new THREE.Vector3().setFromMatrixPosition(e.matrixWorld);}var p=n.origin.clone();if(i){var f=p.distanceTo(d);p.add(o).sub(d).setLength(f).add(d);}else{p.add(o);}e.matrixWorld.setPosition(p);e.matrix.multiplyMatrices(n.matParentInv,e.matrixWorld);e.position.setFromMatrixPosition(e.matrix);e.matrixWorldNeedsUpdate=true;});this._viewport.setShouldRenderFrame();};
c.prototype.move=function(x,y,z){this.beginGesture();this._move(new THREE.Vector3(x,y,z||0));};
c.prototype.handleSelectionChanged=function(e){if(this._viewport){this._updateSelection(this._viewport._viewStateManager);var n=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:n},true);this._poiIndex=-1;}};
c.prototype._getSelectionCenter=function(d){G.prototype._getSelectionCenter.apply(this,arguments);var e=new THREE.Vector3();if(this._nodes[0].node.userData.boundingBox){this._nodes[0].node.userData.boundingBox.getCenter(e);}else{var f=new THREE.Box3();f.expandByObject(this._nodes[0].node);f.getCenter(e);}d.copy(e.applyMatrix4(this._nodes[0].node.matrixWorld));};
c.prototype._updatePoiButtons=function(){this._tool.updateButtons();};
c.prototype.render=function(){b(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");this._updatePoiButtons();};
return c;});
sap.ui.predefine('sap/ui/vk/tools/PoiToolGizmoRenderer',[],function(){"use strict";var P={};
P.render=function(r,c){r.write("<div");r.writeControlData(c);r.write(">");var t=c._tool;var p=t&&t.getButtons&&t.getButtons();if(p&&p.length){r.write("<div");r.addClass("sapUiVizKitPoiButtonsContainer");r.writeClasses();r.write(">");for(var j=0;j<p.length;++j){r.renderControl(p[j]);}r.write("</div>");}r.write("</div>");};
return P;},true);
sap.ui.predefine('sap/ui/vk/tools/PredefinedView',[],function(){"use strict";var P={Initial:"Initial",Front:"Front",Back:"Back",Left:"Left",Right:"Right",Top:"Top",Bottom:"Bottom"};return P;},true);
sap.ui.predefine('sap/ui/vk/tools/RectSelectTool',["./Tool","./RectSelectToolHandler","../SelectionDisplayMode","../Loco"],function(T,R,S,L){"use strict";
var a=T.extend("sap.ui.vk.tools.RectSelectTool",{
metadata:{properties:{subtractMode:{type:"boolean",defaultValue:false}}},
constructor:function(i,s){if(a._instance){return a._instance;}T.apply(this,arguments);this._viewport=null;this._handler=new R(this);this._loco=null;a._instance=this;}
});
a.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"]);};
a.prototype.setActive=function(v,b,g){T.prototype.setActive.call(this,v,b,g);if(this._viewport){if(v){if(this._prepare()){this._handler.activate(this._viewport);}}else{this._handler.deactivate();}}return this;};
a.prototype._prepare=function(){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){return true;}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")&&this._viewport._scene&&this._viewport._scene.getSceneRef()){return true;}else if(this.isViewportType("sap.ui.vk.svg.Viewport")&&this._viewport._scene){return true;}else{return false;}};
a.prototype.queueCommand=function(b){if(this._prepare()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")||this.isViewportType("sap.ui.vk.svg.Viewport")){b();}}return this;};
function c(b,d,v){var m=b.elements;var i=m[15]===1;var r=2/m[0];var t=2/m[5];var e,f;if(i){e=-m[12]*r;f=-m[13]*t;}else{e=m[8]*r;f=m[9]*t;}var g=(r+e)*0.5;var l=e-g;var h=(t+f)*0.5;var j=f-h;var k=THREE.Math.lerp(l,g,Math.min(d.x1,d.x2)/v.width);var n=THREE.Math.lerp(l,g,Math.max(d.x1,d.x2)/v.width);var o=THREE.Math.lerp(h,j,Math.min(d.y1,d.y2)/v.height);var p=THREE.Math.lerp(h,j,Math.max(d.y1,d.y2)/v.height);m[0]=2/(n-k);m[5]=2/(o-p);if(i){m[12]=-(n+k)/(n-k);m[13]=-(o+p)/(o-p);}else{m[8]=(n+k)/(n-k);m[9]=(o+p)/(o-p);}}
a.prototype.select=function(x,y,b,d,s,e){if(!this._prepare()){return[];}return this._select(x,y,b,d,this._viewport,s,e);};
a.prototype._select=function(x,y,b,d,v,s,e){var n=[];var f=v.getMetadata().getName();if(f==="sap.ui.vk.svg.Viewport"){return v._select({x1:x,y1:y,x2:b,y2:d});}if(f==="sap.ui.vk.dvl.Viewport"){n=v.rectSelect(x,y,b,d);if(n.length>0){var p={picked:n};v.fireNodesPicked(p);if(v.getSelectionDisplayMode()===S.Outline){if(this.getSubtractMode()){v._viewStateManager.setOutliningStates([],n);}else{v._viewStateManager.setOutliningStates(n,[]);}}else if(this.getSubtractMode()){v._viewStateManager.setSelectionStates([],n);}else{v._viewStateManager.setSelectionStates(n,[]);}}return n;}var g=s?s.getSceneRef():undefined;var h=e?e.getCameraRef():undefined;var j=v._getViewStateManagerThreeJS();if(!h||!g||!j||x===b||y===d){return n;}var r={x1:x,y1:y,x2:b,y2:d};var m=h.projectionMatrix.clone();c(m,r,v._renderer.getSize(new THREE.Vector2()));var k=new THREE.Matrix4().multiplyMatrices(m,h.matrixWorldInverse);var o=new THREE.Frustum().setFromProjectionMatrix(k);var q=new THREE.Vector3();function t(z){var A=z.geometry;if(A!==undefined&&o.intersectsObject(z)){var i,l=0;if(A.isGeometry){var B=A.vertices;for(i=0,l=B.length;i<l;i++){q.copy(B[i]).applyMatrix4(z.matrixWorld);if(!o.containsPoint(q)){break;}}}else if(A.isBufferGeometry){var C=A.attributes.position;if(C!==undefined){for(i=0,l=C.count;i<l;i++){q.fromBufferAttribute(C,i).applyMatrix4(z.matrixWorld);if(!o.containsPoint(q)){break;}}}}return l>0&&i===l;}return false;}function u(l){if(!l.visible){return;}var z=0,A=0;if(l.geometry!==undefined){z++;if(t(l)){A++;}}var B=l.children;if(B.length>0){for(var i=0;i<B.length;i++){var C=B[i];if(C.geometry!==undefined&&!C.name&&C.children.length===0){if(C.visible){z++;if(t(C)){A++;}}}else{u(C);}}}if(A>0&&z===A){n.push(l);}}u(g);if(n.length>0){var w={picked:n};v.fireNodesPicked(w);if(v.getSelectionDisplayMode()===S.Outline){if(this.getSubtractMode()){j.setOutliningStates([],n);}else{j.setOutliningStates(n,[]);}}else if(this.getSubtractMode()){j.setSelectionStates([],n);}else{j.setSelectionStates(n,[]);}}return n;};
return a;});
sap.ui.predefine('sap/ui/vk/tools/RedlineTool',["sap/base/Log","../library","./Tool","./RedlineToolHandler","./RedlineToolGizmo","../Redline","../RedlineElementRectangle","../RedlineElementEllipse","../RedlineElementFreehand","../RedlineElementLine","../RedlineElementText"],function(L,v,T,R,a,b,c,d,e,f,g){"use strict";
var h=T.extend("sap.ui.vk.tools.RedlineTool",{
metadata:{events:{elementCreated:{parameters:{element:"object"}},elementClicked:{parameters:{elementId:"string"}}},aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement",multiple:true,forwarding:{getter:"getGizmo",aggregation:"redlineElements",forwardBinding:true}}}},
constructor:function(i,s){if(h._instance){return h._instance;}T.apply(this,arguments);this._viewport=null;this._handler=new R(this);h._instance=this;}
});
h.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.svg.Viewport","sap.ui.vk.threejs.Viewport","sap.ui.vk.dvl.Viewport","sap.ui.vk.NativeViewport"]);this.setAggregation("gizmo",new a());};
h.prototype.setActive=function(i,j,k){T.prototype.setActive.call(this,i,j,k);var l=this._viewport;if(l){if(i){if(l instanceof v.threejs.Viewport){l._viewportGestureHandler._activateRedline();}else if(l instanceof v.dvl.Viewport){l._activateRedline();}this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show();}this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}if(l instanceof v.dvl.Viewport){l._deactivateRedline();}else if(l instanceof v.threejs.Viewport){l._viewportGestureHandler._deactivateRedline();}}}return this;};
var J={rectangle:c,ellipse:d,freehand:e,line:f,text:g};var S={rect:c,ellipse:d,path:e,line:f,text:g};
h.prototype.startAdding=function(i){this.getGizmo()._startAdding(i);return this;};
h.prototype.stopAdding=function(){this.getGizmo()._stopAdding();return this;};
h.prototype.exportJSON=function(){return this.getGizmo().getRedlineElements().map(function(i){return i.exportJSON();});};
h.prototype.importJSON=function(j){var i=this.getGizmo();j=Array.isArray(j)?j:[j];j.forEach(function(k){var E=J[k.type];if(E){i.addRedlineElement(new E().importJSON(k));}else{L.warning("Unsupported JSON element type "+k.type);}});i.rerender();return this;};
h.prototype.exportSVG=function(){var s=document.createElementNS(b.svgNamespace,"svg");this.getGizmo().getRedlineElements().map(function(i){s.appendChild(i.exportSVG());});return s;};
h.prototype.importSVG=function(s){var i=this.getGizmo();s.childNodes.forEach(function(t){if(t.getAttribute){var E=S[t.tagName];if(E){i.addRedlineElement(new E().importSVG(t));}else{L.warning("Unsupported SVG element type "+E);}}});i.rerender();return this;};
h.prototype.queueCommand=function(i){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){i();}}return this;};
h.prototype.onElementClicked=function(i){this.fireElementClicked({elementId:i.getParameter("elementId")});};
return h;});
sap.ui.predefine('sap/ui/vk/tools/RedlineToolGizmo',["./Gizmo","./RedlineToolGizmoRenderer"],function(G,R){"use strict";
var a=G.extend("sap.ui.vk.tools.RedlineToolGizmo",{metadata:{library:"sap.ui.vk",aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement"},activeElement:{type:"sap.ui.vk.RedlineElement",multiple:false,visibility:"hidden"}}}});
a.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._activeElement=null;this._virtualLeft=0;this._virtualTop=0;this._virtualSideLength=1;};
a.prototype.show=function(){this.getParent()._viewport.attachEvent("resize",null,this._onResize,this);this.addStyleClass("sapUiVizkitRedlineInteractionMode");};
a.prototype.hide=function(){this.getParent()._viewport.detachEvent("resize",this._onResize,this);this.removeStyleClass("sapUiVizkitRedlineDesignMode");this.removeStyleClass("sapUiVizkitRedlineInteractionMode");};
a.prototype._startAdding=function(e){this._activeElement=e;this._activeElement.attachElementClicked(this.getParent().onElementClicked,this.getParent());this.setAggregation("activeElement",this._activeElement);this.removeStyleClass("sapUiVizkitRedlineInteractionMode");this.addStyleClass("sapUiVizkitRedlineDesignMode");};
a.prototype.removeRedlineElement=function(b){var e;var c=this.getRedlineElements();switch(typeof b){case"string":for(var i=0;i<c.length;i++){if(c[i].getId()==b){e=c[i];break;}}break;case"object":for(var j=0;j<c.length;j++){if(c[j]==b){e=c[j];break;}}break;case"number":e=c[b];break;default:break;}e.detachElementClicked(this.getParent().onElementClicked,this.getParent());this.removeAggregation("redlineElements",e);};
a.prototype.removeAllRedlineElements=function(){};
a.prototype._stopAdding=function(){this.setAggregation("activeElement",null);this._activeElement=null;this.removeStyleClass("sapUiVizkitRedlineDesignMode");this.addStyleClass("sapUiVizkitRedlineInteractionMode");};
a.prototype._toVirtualSpace=function(x,y){if(arguments.length===1){return x/this._virtualSideLength;}else{return{x:(x-this._virtualLeft)/this._virtualSideLength,y:(y-this._virtualTop)/this._virtualSideLength};}};
a.prototype._toPixelSpace=function(x,y){if(arguments.length===1){return x*this._virtualSideLength;}else{return{x:x*this._virtualSideLength+this._virtualLeft,y:y*this._virtualSideLength+this._virtualTop};}};
a.prototype._onResize=function(){if(this.getDomRef()){this.rerender();}};
a.prototype._getPanningRatio=function(){var c=this.getDomRef().getBoundingClientRect(),h=c.height,w=c.width;if(this._virtualLeft===0&&(h<w&&this._virtualTop<0||(h>w&&this._virtualTop>0))){return h/w;}return 1;};
a.prototype.onBeforeRendering=function(){var v=this.getParent()._viewport;if(v&&v.getDomRef()){var b=v.getOutputSize();this._virtualLeft=b.left;this._virtualTop=b.top;this._virtualSideLength=b.sideLength;}};
return a;});
sap.ui.predefine('sap/ui/vk/tools/RedlineToolGizmoRenderer',[],function(){"use strict";var R={};
R.render=function(r,c){r.write("<svg");r.writeControlData(c);r.addClass("sapUiVizkitRedlineTool");r.writeClasses();r.write(">");r.write("			<defs>				<filter id='halo' filterUnits='userSpaceOnUse' >					<feGaussianBlur in='SourceAlpha' stdDeviation='3' result='blur' />					<feMerge>						<feMergeNode in='blur' />						<feMergeNode in='SourceGraphic' />					</feMerge>				</filter>			</defs>		");c.getRedlineElements().forEach(function(e){e.render(r);});if(c._activeElement){c._activeElement.render(r);}r.write("</svg>");};
return R;},true);
sap.ui.predefine('sap/ui/vk/tools/RedlineToolHandler',["sap/ui/base/EventProvider"],function(E){"use strict";
var R=E.extend("sap.ui.vk.tools.RedlineToolHandler",{
metadata:{},
constructor:function(t){this._priority=0;this._tool=t;this._rect=null;this._x=0;this._y=0;this._d=0;this._zoomFactor=1;}
});
R.prototype.destroy=function(){this._tool=null;this._rect=null;};
R.prototype.hover=function(e){};
R.prototype.beginGesture=function(e){var g=this._tool.getGizmo();if(g&&this._inside(e)){this._gesture=true;e.handled=true;if(g._activeElement){var b=g.getDomRef().getBoundingClientRect(),p=g._toVirtualSpace(e.x-b.left-window.pageXOffset,e.y-b.top-window.pageYOffset);g._activeElement.setOriginX(p.x);g._activeElement.setOriginY(p.y);g.rerender();}else{this._x=e.x;this._y=e.y;this._d=e.d;this._initd=e.d;}}};
var T="sap.ui.vk.threejs.Viewport";var N="sap.ui.vk.NativeViewport";
R.prototype._pan=function(e){var v=this.getViewport(),g=this._tool.getGizmo(),d=e.x-this._x,a=e.y-this._y;if(d||a){this._x=e.x;this._y=e.y;g.getRedlineElements().forEach(function(c){c.setOriginX(c.getOriginX()+g._toVirtualSpace(d));c.setOriginY(c.getOriginY()+g._toVirtualSpace(a));});g.rerender();var p=g._getPanningRatio();var b=v.getMetadata().getName()===T?v._viewportGestureHandler._cameraController:v;b.beginGesture(0,0);b.pan(d*p,a*p);b.endGesture();}};
R.prototype._zoom=function(e){var v=this.getViewport(),g=this._tool.getGizmo(),z=1;var d=e.d-this._d;this._d=e.d;if(this._initd>0){z=1+d*(1/this._initd);}else if(e.n===2){if(e.points[0].y>e.points[1].y){z=Math.max(1-d*0.005,0.333);}else{z=Math.min(1+d*0.005,3);}}z=Math.min(Math.max(z,0.88),1.12);var a=v.getMetadata().getName();var b=32;var c=1/8;if(a===N){b=v._getZoomInLimit();c=v._getZoomOutLimit();this._zoomFactor=v._getZoomFactor();}z=Math.min(Math.max(this._zoomFactor*z,c),b)/this._zoomFactor;this._zoomFactor*=z;var o=this._getOffset(g.getDomRef());var s=1-z,p=g._toVirtualSpace(e.x-o.x,e.y-o.y);g.getRedlineElements().forEach(function(h){h.applyZoom(z);var i=h.getOriginX(),j=h.getOriginY();i+=(p.x-i)*s;j+=(p.y-j)*s;h.setOriginX(i);h.setOriginY(j);});g.rerender();var f=a===T?v._viewportGestureHandler._cameraController:v;f.beginGesture(e.x-o.x,e.y-o.y);f.zoom(z);f.endGesture();};
R.prototype.move=function(e){var g=this._tool.getGizmo();if(g&&this._gesture){e.handled=true;if(g._activeElement){var b=g.getDomRef().getBoundingClientRect(),x=e.x-b.left-window.pageXOffset,y=e.y-b.top-window.pageYOffset;g._activeElement.edit(x,y);}else{if(e.n===1||e.n===2){this._pan(e);}if(e.n===2&&!e.buttons){this._zoom(e);}}}};
R.prototype.endGesture=function(e){var g=this._tool.getGizmo();if(g&&this._inside(e)){this._gesture=false;e.handled=true;if(g._activeElement){g.addRedlineElement(g._activeElement);this._tool.fireElementCreated({element:g._activeElement});this._tool.stopAdding();}}};
R.prototype.click=function(e){};
R.prototype.doubleClick=function(e){};
R.prototype.contextMenu=function(e){};
R.prototype.getViewport=function(){return this._tool._viewport;};
R.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
R.prototype._inside=function(e){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return R;});
sap.ui.predefine('sap/ui/vk/tools/RotatableAxis',[],function(){"use strict";var R={All:"All",X:"X",Y:"Y",Z:"Z"};return R;},true);
sap.ui.predefine('sap/ui/vk/tools/RotateOrbitTool',["./Tool","../helpers/RotateOrbitHelperDvl","../helpers/RotateOrbitHelperThree"],function(T,R,a){"use strict";
var b=T.extend("sap.ui.vk.tools.RotateOrbitTool",{
metadata:{events:{rotate:{parameters:{dx:"int",dy:"int"}}}},
constructor:function(i,s){if(b._instance){return b._instance;}T.apply(this,arguments);this.setToolid("1a1fced1-9b42-d7f3-5fdf-8d338b3591a6");this._viewport=null;this._rotateOrbitHelper=null;b._instance=this;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport"]);};
b.prototype.setActive=function(v,c,g){T.prototype.setActive.call(this,v,c,g);if(this._viewport){if(v){if(this._prepare()){this._rotateOrbitHelper.activateOrbitMode();}}else if(this._rotateOrbitHelper){this._rotateOrbitHelper.deactivateOrbitMode();this._rotateOrbitHelper=null;}}return this;};
b.prototype._prepare=function(){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){if(this._rotateOrbitHelper==null){this._dvlRendererId=this._viewport._dvlRendererId;this._dvl=this._viewport._dvl;this._rotateOrbitHelper=new R(this,this._dvl);}}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){if(this._rotateOrbitHelper==null){this._rotateOrbitHelper=new a(this);}}else{return false;}return true;};
b.prototype.rotate=function(d,c){if(this._prepare()){this._rotateOrbitHelper.rotate(d,c);}};
b.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;this._rotateOrbitHelper=null;delete b._instance;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/RotateTool',["./Tool","../thirdparty/three","./RotatableAxis","./CoordinateSystem","./RotateToolHandler","./RotateToolGizmo","./GizmoPlacementMode","./Detector","./ToolNodeSet"],function(T,a,R,C,b,c,G,D,d){"use strict";
var e=T.extend("sap.ui.vk.tools.RotateTool",{
metadata:{properties:{coordinateSystem:{type:"sap.ui.vk.tools.CoordinateSystem",defaultValue:C.World},axis:{type:"sap.ui.vk.tools.RotatableAxis",defaultValue:R.All},enableStepping:{type:"boolean",defaultValue:false},enableSnapping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},autoResetValues:{type:"boolean",defaultValue:true},allowContextMenu:{type:"boolean",defaultValue:true},nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:d.Highlight},placementMode:{type:"sap.ui.vk.tools.GizmoPlacementMode",defaultValue:G.Default}},events:{rotating:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},rotated:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},axisChanged:{parameters:{axis:"sap.ui.vk.tools.RotatableAxis"}},coordinateSystemChanged:{parameters:{coordinateSystem:"sap.ui.vk.tools.CoordinateSystem"}},placementModeChanged:{parameters:{placementMode:"sap.ui.vk.tools.GizmoPlacementMode"}}}},
constructor:function(i,s){T.apply(this,arguments);this._viewport=null;this._handler=new b(this);this._gizmo=null;this._detector=new D();}
});
e.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new c());};
e.prototype.setActive=function(v,f,g){T.prototype.setActive.call(this,v,f,g);if(this._viewport){if(v){this._gizmo=this.getGizmo();this._gizmo.setAxis(this.getAxis());this._gizmo.setCoordinateSystem(this.getCoordinateSystem());this._gizmo.show(this._viewport,this);this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
e.prototype.setPlacementMode=function(v){var f=this.getPlacementMode();if(f!==v){this.setProperty("placementMode",v,true);this.getGizmo().setPlacementMode(v);if(this._viewport){this._viewport.setShouldRenderFrame();}this.firePlacementModeChanged({placementMode:v});}return this;};
e.prototype.queueCommand=function(f){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){f();}}return this;};
e.prototype.setAxis=function(v){var f=this.getAxis();if(f!==v){this.setProperty("axis",v,true);this.getGizmo().setAxis(v);if(this._viewport){this._viewport.setShouldRenderFrame();}this.fireAxisChanged({axis:v});}return this;};
e.prototype.setCoordinateSystem=function(v){var f=this.getCoordinateSystem();if(f!==v){this.setProperty("coordinateSystem",v,true);this.getGizmo().setCoordinateSystem(v);if(this._viewport){this._viewport.setShouldRenderFrame();}this.fireCoordinateSystemChanged({coordinateSystem:v});}return this;};
e.prototype.setShowEditingUI=function(v){this.setProperty("showEditingUI",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
e.prototype.setEnableSnapping=function(v){this.setProperty("enableSnapping",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
e.prototype.resetValues=function(){this.getGizmo().resetValues();if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
e.prototype.getDetector=function(){return this._detector;};
e.prototype.setNodeSet=function(v){this.setProperty("nodeSet",v,true);if(this._gizmo){this._gizmo.handleSelectionChanged();}};
e.prototype.rotate=function(x,y,z,f){var o;if(f&&f!==this.getCoordinateSystem()){o=this.getCoordinateSystem();this.setCoordinateSystem(f);}if(this._gizmo){this._gizmo.rotate(x,y,z);}if(o){this.setCoordinateSystem(o);}if(this._gizmo){this._gizmo.endGesture();}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
e.prototype.prepareForCreatingRotationKey=function(f,t,p){if(this._gizmo){this._gizmo._prepareForCreatingRotationKey(f,t,p);return this._gizmo._getNodesProperties();}return null;};
e.prototype.rotateRestPosition=function(x,y,z){if(this._gizmo){this._gizmo.rotateRestPosition(x,y,z);}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
e.prototype.rotateFromRestPosition=function(x,y,z){if(this._gizmo){this._gizmo.rotateFromRestPosition(x,y,z);}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
return e;});
sap.ui.predefine('sap/ui/vk/tools/RotateToolGizmo',["../thirdparty/three","./Gizmo","./RotateToolGizmoRenderer","./RotatableAxis","./CoordinateSystem","./AxisColours","../AnimationTrackType","../AnimationTrackValueType","./GizmoPlacementMode","sap/base/assert","sap/base/Log"],function(t,G,R,b,C,A,c,d,e,f,L){"use strict";
var g=G.extend("sap.ui.vk.tools.RotateToolGizmo",{metadata:{library:"sap.ui.vk"}});
g.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._createEditingForm(String.fromCharCode(176),84);this._gizmoIndex=-1;this._handleIndex=-1;this._value=new THREE.Vector3();this._rotationDelta=new THREE.Vector3();this._viewport=null;this._tool=null;this._sceneGizmo=new THREE.Scene();this._gizmo=new THREE.Group();this._touchAreas=new THREE.Group();this._sceneGizmo.add(this._gizmo);this._axis=b.All;this._coordinateSystem=C.World;this._nodes=[];this._matViewProj=new THREE.Matrix4();this._gizmoSize=96;function a(l,m,r,s){var n=new THREE.TorusBufferGeometry(r,1/96,4,s);if(l===0){n.rotateY(Math.PI/2);}else if(l===1){n.rotateX(Math.PI/2);}var o=new THREE.Mesh(n,new THREE.MeshBasicMaterial({color:m,transparent:true}));o.matrixAutoUpdate=false;o.userData.color=m;return o;}function j(l,r,s){var m=new THREE.TorusBufferGeometry(r,16/96,4,s);if(l===0){m.rotateY(Math.PI/2);}else if(l===1){m.rotateX(Math.PI/2);}return new THREE.Mesh(m,new THREE.MeshBasicMaterial({opacity:0.2,transparent:true}));}for(var i=0;i<3;i++){this._gizmo.add(a(i,A[["x","y","z"][i]],1,128));this._touchAreas.add(j(i,1,24));}this._gizmo.add(new THREE.AxesHelper(0.75));var k=new THREE.MeshBasicMaterial({color:0x0080FF,opacity:0.5,transparent:true,side:THREE.DoubleSide});this._arcMesh=new THREE.Mesh(new THREE.Geometry(),k);this._arcMesh.visible=false;this._gizmo.add(this._arcMesh);this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);};
g.prototype.hasDomElement=function(){return true;};
g.prototype.setAxis=function(v){this._axis=v;var a=[b.All,b.X,b.Y,b.Z];if(this._coordinateSystem!==C.Screen){for(var i=0;i<3;i++){if(v!==b.All&&a[i+1]!==v){this._gizmo.children[i].visible=this._touchAreas.children[i].visible=false;}else{this._gizmo.children[i].visible=this._touchAreas.children[i].visible=true;}}}};
g.prototype.resetValues=function(){this._value.setScalar(0);};
g.prototype.setCoordinateSystem=function(a){this._coordinateSystem=a;var s=a===C.Screen;if(s){this._gizmo.children[0].visible=this._gizmo.children[1].visible=false;this._touchAreas.children[0].visible=this._touchAreas.children[1].visible=false;this._gizmo.children[2].visible=this._touchAreas.children[2].visible=true;}else{this._gizmo.children[0].visible=this._touchAreas.children[0].visible=this._axis===b.All||this._axis===b.X;this._gizmo.children[1].visible=this._touchAreas.children[1].visible=this._axis===b.All||this._axis===b.Y;this._gizmo.children[2].visible=this._touchAreas.children[2].visible=this._axis===b.All||this._axis===b.Z;}this._axisTitles.visible=!s;this._gizmoIndex=this._handleIndex=-1;};
g.prototype.show=function(v,a){this._viewport=v;this._tool=a;this._nodes.length=0;this._updateSelection(v._viewStateManager);var n=this._getNodesProperties();this._tool.fireEvent("rotating",{x:0,y:0,z:0,nodesProperties:n},true);};
g.prototype._prepareForCreatingRotationKey=function(a,i,p){this._nodes.forEach(function(n){var k=n.node;var l=[0,0,0];a.setTime(i,p);var m=a.getAnimatedProperty(k,c.Rotate);if(m.offsetToPrevious){l=m.offsetToPrevious;}if(!this._nodeUserDataMap){this._nodeUserDataMap=new Map();}var u=this._nodeUserDataMap.get(k);if(!u){u={};this._nodeUserDataMap.set(k,u);}u.eulerInParentCoors=new THREE.Euler(l[0],l[1],l[2]);u.startEulerInParentCoors=new THREE.Euler(l[0],l[1],l[2]);}.bind(this));var j=a.getCurrentPlayback();if(j){this._prepareForCreatingKey(j);}};
g.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._updateEditingForm(false);};
g.prototype.getGizmoCount=function(){if(this._coordinateSystem===C.Local||this._coordinateSystem===C.Parent){return this._nodes.length;}else{return this._nodes.length>0?1:0;}};
g.prototype.getTouchObject=function(i){if(this._nodes.length===0){return null;}this._updateGizmoObjectTransformation(this._touchAreas,i);return this._touchAreas;};
g.prototype.highlightHandle=function(a,j){for(var i=0;i<3;i++){var k=this._gizmo.children[i];var l=i===a?0xFFFF00:k.userData.color;k.material.color.setHex(l);k.material.opacity=a===-1||i===a?1:0.35;k.material.visible=j||i===a;var m=this._axisTitles.children[i];m.material.color.setHex(l);m.material.opacity=a===-1||i===a?1:0.35;m.material.visible=j||i===a;}};
g.prototype.selectHandle=function(i,a){this._gizmoIndex=a;this._handleIndex=i;if(this._tool.getAutoResetValues()){this.resetValues();}this._viewport.setShouldRenderFrame();};
g.prototype.beginGesture=function(){this._beginValue=this._value.clone();this._rotationDelta.setScalar(0);this._matOrigin=this._gizmo.matrixWorld.clone();this._nodes.forEach(function(n){n.node.parent.updateMatrixWorld(true);n.matOrigin=n.node.matrixWorld.clone();n.matLocalOrigin=n.node.matrix.clone();if(n.node.parent){n.matParentInv=new THREE.Matrix4().getInverse(n.node.parent.matrixWorld);}else{n.matParentInv=new THREE.Matrix4();}n.quaternion=n.node.quaternion.clone();});};
g.prototype._printEventInfo=function(a,x,y,z,n){L.debug(a+" is fired:"+" x = "+x+"; y = "+y+"; z = "+z);n.forEach(function(p){L.debug("Node: "+p.node.name);if(p.offsetToRest){L.debug("offsetToRest: [ "+p.offsetToRest[0]+", "+p.offsetToRest[1]+", "+p.offsetToRest[2]+", "+p.offsetToRest[3]+" ] ");}else{L.debug("offsetToRest: null");}if(p.offsetToRestInCoordinates){L.debug("offsetToRestInCoordinates: [ "+p.offsetToRestInCoordinates[0]+", "+p.offsetToRestInCoordinates[1]+", "+p.offsetToRestInCoordinates[2]+" ] ");}else{L.debug("offsetToRestInCoordinates: null");}if(p.offsetToPrevious){L.debug("offsetToPrevious: [ "+p.offsetToPrevious[0]+", "+p.offsetToPrevious[1]+", "+p.offsetToPrevious[2]+" ] ");}else{L.debug("offsetToPrevious: null");}if(p.absolute){L.debug("absolute: [ "+p.absolute[0]+", "+p.absolute[1]+", "+p.absolute[2]+", "+p.absolute[3]+" ] ");}else{L.debug("absolute: null");}if(p.world){L.debug("world: [ "+p.world[0]+", "+p.world[1]+", "+p.world[2]+", "+p.world[3]+" ] ");}else{L.debug("world: null");}if(p.restDifference){L.debug("restDifference: [ "+p.restDifference[0]+", "+p.restDifference[1]+", "+p.restDifference[2]+", "+p.restDifference[3]+" ] ");}else{L.debug("restDifference: null");}if(p.restDifferenceInCoordinates){L.debug("restDifference: [ "+p.restDifferenceInCoordinates[0]+", "+p.restDifferenceInCoordinates[1]+", "+p.restDifferenceInCoordinates[2]+", "+p.restDifferenceInCoordinates[3]+" ] ");}else{L.debug("restDifference: null");}});};
g.prototype._getNodesProperties=function(){var n=[];this._nodes.forEach(function(a){var i=a.node;var p={};p.node=i;var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(i);}if(u&&u.eulerInParentCoors){var o=new THREE.Euler(u.eulerInParentCoors.x,u.eulerInParentCoors.y,u.eulerInParentCoors.z);var j=new THREE.Quaternion().setFromEuler(o);if(this._playback){var s=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(i,c.Rotate,this._playback);if(s){var k=new THREE.Quaternion(s[0],s[1],s[2],s[3]);j.multiply(k);}}p.offsetToRest=[j.x,j.y,j.z,j.w];p.offsetToPrevious=[u.eulerInParentCoors.x,u.eulerInParentCoors.y,u.eulerInParentCoors.z];}else{p.offsetToRest=null;p.offsetToPrevious=null;}var l=this._viewport._viewStateManager.getTransformation(i);p.absolute=[l.quaternion[0],l.quaternion[1],l.quaternion[2],l.quaternion[3]];var w=this._viewport._viewStateManager.getTransformationWorld(i);var m=new THREE.Quaternion(w.quaternion[0],w.quaternion[1],w.quaternion[2],w.quaternion[3]);var q=new THREE.Euler().setFromQuaternion(m);p.world=[q.x,q.y,q.z];if(u&&u.quatInitialDiffInv){var r=new THREE.Quaternion(l.quaternion[0],l.quaternion[1],l.quaternion[2],l.quaternion[3]);r.multiply(u.quatInitialDiffInv);p.restDifference=[r.x,r.y,r.z,r.w];}else{p.restDifference=null;}if(u.euler){p.restDifferenceInCoordinates=[u.euler.x,u.euler.y,u.euler.z];}else{p.restDifferenceInCoordinates=null;}p.offsetToRestInCoordinates=null;n.push(p);}.bind(this));return n;};
g.prototype.endGesture=function(){this._arcMesh.visible=false;var n=this._getNodesProperties();delete this._beginValue;this._nodes.forEach(function(a){var i=a.node;var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(i);}if(u&&u.euler){u.startEuler.x=u.euler.x;u.startEuler.y=u.euler.y;u.startEuler.z=u.euler.z;u.startEulerInParentCoors.x=u.eulerInParentCoors.x;u.startEulerInParentCoors.y=u.eulerInParentCoors.y;u.startEulerInParentCoors.z=u.eulerInParentCoors.z;}if(this._coordinateSystem!==C.Custom){delete i.userData.skipUpdateJointNode;}this._viewport._viewStateManager._setJointNodeOffsets(i,c.Rotate);}.bind(this));this._tool.fireRotated({x:this._rotationDelta.x,y:this._rotationDelta.y,z:this._rotationDelta.z,nodesProperties:n});this._printEventInfo("Event 'rotated'",this._rotationDelta.x,this._rotationDelta.y,this._rotationDelta.z,n);};
var h=function(o,a){if(Math.abs(o-a)<0.000001){return o;}if(o>a){while(o>a){a+=2*Math.PI;}if(a-o<=Math.PI){return a;}else{return a-2*Math.PI;}}else{while(o<a){a-=2*Math.PI;}if(o-a<=Math.PI){return a;}else{return a+2*Math.PI;}}};
g.prototype.rotateFromRestPosition=function(x,y,z){if(this._coordinateSystem!==C.Parent){return;}this.beginGesture();this._nodes.forEach(function(i){var j=i.node;if(!j.userData){j.userData={};}j.userData.skipUpdateJointNode=true;});x=THREE.Math.degToRad(x);y=THREE.Math.degToRad(y);z=THREE.Math.degToRad(z);for(var n=0,a=this._nodes.length;n<a;n++){var i=this._nodes[n];if(!i.ignore){var j=i.node;var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(j);}if(u&&u.euler&&u.eulerInParentCoors){this._rotationDelta.set(THREE.Math.radToDeg(x-u.eulerInParentCoors.x),THREE.Math.radToDeg(y-u.eulerInParentCoors.y),THREE.Math.radToDeg(z-u.eulerInParentCoors.z));u.eulerInParentCoors.x=x;u.eulerInParentCoors.y=y;u.eulerInParentCoors.z=z;var o=new THREE.Euler(u.eulerInParentCoors.x,u.eulerInParentCoors.y,u.eulerInParentCoors.z);var k=new THREE.Quaternion().setFromEuler(o);var r=this._viewport._viewStateManager.getRestTransformationUsingJoint(j);var l=new THREE.Quaternion(r.quaternion[0],r.quaternion[1],r.quaternion[2],r.quaternion[3]);if(this._playback){var s=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(j,c.Rotate,this._playback);if(s){var m=new THREE.Quaternion(s[0],s[1],s[2],s[3]);k.multiply(m);}}var p=this._getEffectiveParent(j);if(p!==j.parent){this._viewport._viewStateManager._setJointNodeOffsets(j,c.Rotate);j.userData.offsetQuaternion=[k.x,k.y,k.z,k.w];j.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();j.userData.skipUpdateJointNode=true;}else{j.quaternion.copy(k.multiply(l));}j.updateMatrix();u.euler.x=u.eulerInParentCoors.x-u.startEulerInParentCoors.x+u.startEuler.x;u.euler.y=u.eulerInParentCoors.y-u.startEulerInParentCoors.y+u.startEuler.y;u.euler.z=u.eulerInParentCoors.z-u.startEulerInParentCoors.z+u.startEuler.z;}}}this.endGesture();};
g.prototype.rotateRestPosition=function(x,y,z){this.beginGesture();this._nodes.forEach(function(i){var j=i.node;if(!j.userData){j.userData={};}j.userData.skipUpdateJointNode=true;});x=THREE.Math.degToRad(x);y=THREE.Math.degToRad(y);z=THREE.Math.degToRad(z);for(var n=0,a=this._nodes.length;n<a;n++){var i=this._nodes[n];if(!i.ignore){var j=i.node;var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(j);}if(u&&u.euler&&u.eulerInParentCoors){this._rotationDelta.set(THREE.Math.radToDeg(x-u.euler.x),THREE.Math.radToDeg(y-u.euler.y),THREE.Math.radToDeg(z-u.euler.z));u.euler.x=x;u.euler.y=y;u.euler.z=z;var o=new THREE.Euler(u.euler.x,u.euler.y,u.euler.z);var k=new THREE.Quaternion().setFromEuler(o);var l=new THREE.Matrix4();var m=new THREE.Matrix4();if(this._coordinateSystem===C.Local){l=j.parent.matrixWorld.clone().multiply(u.matRest);m=u.matRestInv.clone().multiply(i.matParentInv);}else if(this._gizmo&&this._coordinateSystem!==C.Parent){l=this._gizmo.matrixWorld.clone();m=m.getInverse(l);}var p=new THREE.Matrix4().makeRotationFromQuaternion(k);var q=p;if(this._coordinateSystem!==C.Parent){q=i.matParentInv.clone().multiply(l).multiply(p).multiply(m).multiply(j.parent.matrixWorld);}var r=new THREE.Matrix4().makeRotationFromQuaternion(u.quatInitialDiff).multiply(q);var s=new THREE.Euler().setFromRotationMatrix(r);if(Math.abs(s.x)<0.000001){s.x=0;}if(Math.abs(s.y)<0.000001){s.y=0;}if(Math.abs(s.z)<0.000001){s.z=0;}u.eulerInParentCoors.x=h(u.eulerInParentCoors.x,s.x);u.eulerInParentCoors.y=h(u.eulerInParentCoors.y,s.y);u.eulerInParentCoors.z=h(u.eulerInParentCoors.z,s.z);j.matrix=u.matInitialDiff.clone().multiply(q.multiply(u.matRest));j.matrix.decompose(j.position,j.quaternion,j.scale);j.updateMatrix();}}}this.endGesture();};
g.prototype._updateEulerForCreatingAnimationKey=function(a){for(var n=0,i=this._nodes.length;n<i;n++){var j=this._nodes[n];if(!j.ignore){var k=j.node;var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(k);}if(u&&u.euler){u.euler.x=u.startEuler.x+a[0];u.euler.y=u.startEuler.y+a[1];u.euler.z=u.startEuler.z+a[2];var l=false;if((Math.abs(u.euler.x)<0.000001&&(Math.abs(u.euler.y)<0.000001||Math.abs(u.euler.z)<0.000001))||(Math.abs(u.euler.y)<0.000001&&Math.abs(u.euler.z)<0.000001)){l=true;}if(l&&this._coordinateSystem===C.Parent){u.eulerInParentCoors.x=u.startEulerInParentCoors.x+a[0];u.eulerInParentCoors.y=u.startEulerInParentCoors.y+a[1];u.eulerInParentCoors.z=u.startEulerInParentCoors.z+a[2];continue;}var r=this._viewport._viewStateManager.getRelativeTransformation(k);var o;var p=this._getEffectiveParent(k);if(p!==k.parent&&this._coordinateSystem!==C.Custom){this._viewport._viewStateManager._setJointNodeOffsets(k,c.Rotate);o=new THREE.Quaternion(k.userData.offsetQuaternion[0],k.userData.offsetQuaternion[1],k.userData.offsetQuaternion[2],k.userData.offsetQuaternion[3]);k.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();k.userData.skipUpdateJointNode=true;}else{o=new THREE.Quaternion(r.quaternion[0],r.quaternion[1],r.quaternion[2],r.quaternion[3]);}var m=new THREE.Matrix4().makeRotationFromQuaternion(o);if(this._playback){var s=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(k,c.Rotate,this._playback);if(s){var q=new THREE.Quaternion(s[0],s[1],s[2],s[3]);var v=new THREE.Matrix4().makeRotationFromQuaternion(q);m.multiply(new THREE.Matrix4().getInverse(v));}}var w=new THREE.Euler().setFromRotationMatrix(m);if(Math.abs(w.x)<0.00001){w.x=0;}if(Math.abs(w.y)<0.00001){w.y=0;}if(Math.abs(w.z)<0.00001){w.z=0;}u.eulerInParentCoors.x=h(u.eulerInParentCoors.x,w.x);u.eulerInParentCoors.y=h(u.eulerInParentCoors.y,w.y);u.eulerInParentCoors.z=h(u.eulerInParentCoors.z,w.z);if(l){continue;}var x=new THREE.Matrix4();var y=new THREE.Matrix4();if(this._coordinateSystem===C.Local){x=k.parent.matrixWorld.clone().multiply(u.matRest);y=u.matRestInv.clone().multiply(j.matParentInv);}else if(this._gizmo&&this._coordinateSystem!==C.Parent){x=this._gizmo.matrixWorld.clone();y=y.getInverse(x);}var z=new THREE.Quaternion(r.quaternion[0],r.quaternion[1],r.quaternion[2],r.quaternion[3]);z.multiply(u.quatInitialDiffInv);var B=new THREE.Matrix4().makeRotationFromQuaternion(z);var D=B;if(this._coordinateSystem!==C.Parent){D=y.clone().multiply(k.parent.matrixWorld).multiply(B).multiply(j.matParentInv).multiply(x);}w=new THREE.Euler().setFromRotationMatrix(D);if(Math.abs(w.x)<0.000001){w.x=0;}if(Math.abs(w.y)<0.000001){w.y=0;}if(Math.abs(w.z)<0.000001){w.z=0;}u.euler.x=h(u.euler.x,w.x);u.euler.y=h(u.euler.y,w.y);u.euler.z=h(u.euler.z,w.z);}}}};
g.prototype._rotate=function(a){this._rotationDelta.set(THREE.Math.radToDeg(a.x),THREE.Math.radToDeg(a.y),THREE.Math.radToDeg(a.z));this._value.addVectors(this._beginValue,this._rotationDelta);this._nodes.forEach(function(r){var s=r.node;if(!s.userData){s.userData={};}s.userData.skipUpdateJointNode=true;});var q=new THREE.Quaternion();if(this._coordinateSystem===C.Local){q.setFromEuler(a);this._nodes.forEach(function(r){var s=r.node;s.quaternion.copy(r.quaternion).multiply(q);s.updateMatrix();});a=a.toArray();this._updateEulerForCreatingAnimationKey(a);}else{a=a.toArray();for(var i=0;i<3;i++){var j=a[i];if(j){var k=a[3].charCodeAt(i)-88;if(k>=0&&k<3){var l=new THREE.Vector3().setFromMatrixColumn(this._matOrigin,k).normalize();var m=new THREE.Matrix4().makeRotationAxis(l,j);var p=new THREE.Vector3().setFromMatrixPosition(this._matOrigin);m.setPosition(p.sub(p.clone().applyMatrix4(m)));for(var n=0,o=this._nodes.length;n<o;n++){var r=this._nodes[n];if(!r.ignore){var s=r.node;if(this._coordinateSystem!==C.Parent){s.position.setFromMatrixPosition(r.matOrigin).applyMatrix4(m).applyMatrix4(r.matParentInv);}var u=new THREE.Vector3().setFromMatrixScale(r.matOrigin);var v=l.clone().transformDirection(new THREE.Matrix4().getInverse(r.matOrigin)).multiply(u).normalize();q.setFromAxisAngle(v,j);s.quaternion.copy(r.quaternion).multiply(q);s.updateMatrix();}}}}}this._updateEulerForCreatingAnimationKey(a);}this._viewport.setShouldRenderFrame();};
g.prototype._setRotationAxisAngle=function(j,k,l){var m=(l-k)%(Math.PI*2);var o=new THREE.Euler();o[["x","y","z"][j]]=m;var p=this._getNodesProperties();if(this._tool.fireEvent("rotating",{x:THREE.Math.radToDeg(o.x),y:THREE.Math.radToDeg(o.y),z:THREE.Math.radToDeg(o.z),nodesProperties:p},true)){this._printEventInfo("Event 'rotating'",THREE.Math.radToDeg(o.x),THREE.Math.radToDeg(o.y),THREE.Math.radToDeg(o.z),p);this._rotate(o);var v=[0,0,0];var q=new THREE.Vector3();var r=(j+1)%3,s=(j+2)%3;var i,n=Math.max(Math.ceil(Math.abs(m)*64/Math.PI),1);m*=this._coordinateSystem===C.Local?-1:1;for(i=0;i<=n;i++){var a=k+m*(i/n);q.set(0,0,0).setComponent(r,Math.cos(a)).setComponent(s,Math.sin(a));v.push(q.x,q.y,q.z);}var u=[];for(i=0;i<n;i++){u.push(0,i+1,i+2);}var w=new THREE.BufferGeometry();w.setIndex(u);w.setAttribute("position",new THREE.Float32BufferAttribute(v,3));this._arcMesh.geometry=w;this._arcMesh.visible=true;}};
g.prototype.rotate=function(x,y,z){this.beginGesture();this._rotate(new THREE.Euler(THREE.Math.degToRad(x||0),THREE.Math.degToRad(y||0),THREE.Math.degToRad(z||0)));};
g.prototype._getValueLocaleOptions=function(){return{useGrouping:false,minimumFractionDigits:1,maximumFractionDigits:2};};
g.prototype.getValue=function(){return(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3)?this._value.getComponent(this._handleIndex):0;};
g.prototype.setValue=function(v){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){var a=new THREE.Euler();a[["x","y","z"][this._handleIndex]]=THREE.Math.degToRad(v-this._value.getComponent(this._handleIndex));this.beginGesture();this._rotate(a);this.endGesture();}};
g.prototype.expandBoundingBox=function(a){if(this._viewport){this._expandBoundingBox(a,this._viewport.getCamera().getCameraRef(),true);}};
g.prototype.handleSelectionChanged=function(a){if(this._viewport){if(this._tool.getEnableSnapping()){this._tool.getDetector().setSource(this._viewport._viewStateManager);}this._updateSelection(this._viewport._viewStateManager);var n=this._getNodesProperties();this._tool.fireEvent("rotating",{x:0,y:0,z:0,nodesProperties:n},true);this._gizmoIndex=this._handleIndex=-1;}};
g.prototype._getLevelingQuaternion=function(q,o){q.set(0,0,0,1);switch(this._coordinateSystem){case C.Local:q.setFromRotationMatrix(this._nodes[o].node.parent.matrixWorld);break;case C.Screen:q.copy(this._viewport.getCamera().getCameraRef().quaternion);break;case C.Custom:var a=this._getAnchorPoint();if(a){q.copy(a.quaternion);}break;default:break;}};
g.prototype._getObjectSize=function(o){var a=new THREE.Box3();if(this._nodes.length===1){this._nodes[0].node._expandBoundingBox(a,true,false);}else if(this._coordinateSystem===C.Local){this._nodes[0].node._expandBoundingBox(a,true,false);}if(a.isEmpty()){return 0;}var s=new THREE.Vector3();a.getSize(s);return s.length();};
g.prototype._updateGizmoTransformation=function(i,a){var s=this._updateGizmoObjectTransformation(this._gizmo,i);this._updateAxisTitles(this._axisTitles,this._gizmo,a,this._gizmoSize-12,s);};
g.prototype._getEditingFormPosition=function(){var s=this._updateGizmoObjectTransformation(this._gizmo,this._gizmoIndex);var a=new THREE.Vector3().setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return a.clone().multiplyScalar((this._gizmoSize-12)*s).add(this._gizmo.position).applyMatrix4(this._matViewProj);};
g.prototype.render=function(){f(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");if(this._nodes.length>0){var r=this._viewport.getRenderer(),a=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);r.clearDepth();for(var i=0,l=this.getGizmoCount();i<l;i++){this._updateGizmoTransformation(i,a);r.render(this._sceneGizmo,a);}}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex);};
return g;});
sap.ui.predefine('sap/ui/vk/tools/RotateToolGizmoRenderer',[],function(){"use strict";var R={};
R.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkTransformationToolEdit");r.writeClasses();r.write(">");r.renderControl(c._editingForm);r.write("</div>");};
return R;},true);
sap.ui.predefine('sap/ui/vk/tools/RotateTurntableTool',["./Tool","../helpers/RotateTurntableHelperDvl","../helpers/RotateTurntableHelperThree"],function(T,R,a){"use strict";
var b=T.extend("sap.ui.vk.tools.RotateTurntableTool",{
metadata:{events:{rotate:{parameters:{dx:"int",dy:"int"}}}},
constructor:function(i,s){if(b._instance){return b._instance;}T.apply(this,arguments);this.setToolid("f271c082-676c-adc6-167f-0d5ce602aa45");this._viewport=null;this._rotateTurntableHelper=null;b._instance=this;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport"]);};
b.prototype.setActive=function(v,c,g){T.prototype.setActive.call(this,v,c,g);if(this._viewport){if(v){if(this._prepare()){this._rotateTurntableHelper.activateTurntableMode();}}else if(this._rotateTurntableHelper){this._rotateTurntableHelper.deactivateTurntableMode();this._rotateTurntableHelper=null;}}return this;};
b.prototype._prepare=function(){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){if(this._rotateTurntableHelper==null){this._dvlRendererId=this._viewport._dvlRendererId;this._dvl=this._viewport._dvl;this._rotateTurntableHelper=new R(this,this._dvl);}}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){if(this._rotateTurntableHelper==null){this._rotateTurntableHelper=new a(this);}}else{return false;}return true;};
b.prototype.rotate=function(d,c){if(this._prepare()){this._rotateTurntableHelper.rotate(d,c);}};
b.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;this._rotateTurntableHelper=null;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/ScaleTool',["./Tool","./CoordinateSystem","./ScaleToolHandler","./ScaleToolGizmo","./Detector","./ToolNodeSet","./GizmoPlacementMode"],function(T,C,S,a,D,b,G){"use strict";
var c=T.extend("sap.ui.vk.tools.ScaleTool",{
metadata:{properties:{coordinateSystem:{type:"sap.ui.vk.tools.CoordinateSystem",defaultValue:C.World},nonUniformScaleEnabled:{type:"boolean",defaultValue:false},enableStepping:{type:"boolean",defaultValue:false},enableSnapping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},autoResetValues:{type:"boolean",defaultValue:true},allowContextMenu:{type:"boolean",defaultValue:true},nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:b.Highlight},placementMode:{type:"sap.ui.vk.tools.GizmoPlacementMode",defaultValue:G.Default}},events:{scaling:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},scaled:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},coordinateSystemChanged:{parameters:{coordinateSystem:"sap.ui.vk.tools.CoordinateSystem"}},placementModeChanged:{parameters:{placementMode:"sap.ui.vk.tools.GizmoPlacementMode"}}}},
constructor:function(i,s){T.apply(this,arguments);this._viewport=null;this._handler=new S(this);this._gizmo=null;this._detector=new D();}
});
c.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new a());};
c.prototype.setActive=function(v,d,g){T.prototype.setActive.call(this,v,d,g);if(this._viewport){if(v){this._gizmo=this.getGizmo();this._gizmo.setCoordinateSystem(this.getCoordinateSystem());this._gizmo.setNonUniformScaleEnabled(this.getNonUniformScaleEnabled());this._gizmo.show(this._viewport,this);this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
c.prototype.setPlacementMode=function(v){var d=this.getPlacementMode();if(d!==v){this.setProperty("placementMode",v,true);this.getGizmo().setPlacementMode(v);if(this._viewport){this._viewport.setShouldRenderFrame();}this.firePlacementModeChanged({placementMode:v});}return this;};
c.prototype.queueCommand=function(d){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){d();}}return this;};
c.prototype.setCoordinateSystem=function(v){var d=this.getCoordinateSystem();if(d!==v){this.setProperty("coordinateSystem",v,true);this.getGizmo().setCoordinateSystem(v);if(this._viewport){this._viewport.setShouldRenderFrame();}this.fireCoordinateSystemChanged({coordinateSystem:v});}return this;};
c.prototype.setNonUniformScaleEnabled=function(v){this.setProperty("nonUniformScaleEnabled",v,true);this.getGizmo().setNonUniformScaleEnabled(v);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.setShowEditingUI=function(v){this.setProperty("showEditingUI",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.setEnableSnapping=function(v){this.setProperty("enableSnapping",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.resetValues=function(){this.getGizmo().resetValues();if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.getDetector=function(){return this._detector;};
c.prototype.setNodeSet=function(v){this.setProperty("nodeSet",v,true);if(this._gizmo){this._gizmo.handleSelectionChanged();}};
c.prototype.scale=function(x,y,z,d){var o;if(d&&d!==this.getCoordinateSystem()){o=this.getCoordinateSystem();this.setCoordinateSystem(d);}if(this._gizmo){this._gizmo.scale(x,y,z);}if(o){this.setCoordinateSystem(o);}if(this._gizmo){this._gizmo.endGesture();}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.prepareForCreatingScaleKey=function(p){if(this._gizmo){this._gizmo._prepareForCreatingKey(p);return this._gizmo._getNodesProperties();}return null;};
return c;});
sap.ui.predefine('sap/ui/vk/tools/ScaleToolGizmo',["../thirdparty/three","./Gizmo","./ScaleToolGizmoRenderer","./CoordinateSystem","./AxisColours","../AnimationTrackType","sap/base/assert","sap/base/Log"],function(t,G,S,C,A,c,d,L){"use strict";
var e=G.extend("sap.ui.vk.tools.ScaleToolGizmo",{metadata:{library:"sap.ui.vk"}});
e.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._createEditingForm(null,64);this._gizmoIndex=-1;this._handleIndex=-1;this._value=new THREE.Vector3().setScalar(1);this._scaleDelta=new THREE.Vector3().setScalar(1);this._viewport=null;this._tool=null;this._nonUniformScaleEnabled=false;this._sceneGizmo=new THREE.Scene();var l=new THREE.DirectionalLight(0xFFFFFF,0.5);l.position.set(1,3,2);this._sceneGizmo.add(l);this._sceneGizmo.add(new THREE.AmbientLight(0xFFFFFF,0.5));this._gizmo=new THREE.Group();this._touchAreas=new THREE.Group();this._sceneGizmo.add(this._gizmo);this._coordinateSystem=C.World;this._nodes=[];this._matViewProj=new THREE.Matrix4();this._gizmoSize=96;var g=96,h=16/g,i=48/g;function j(a,b,o){var m=new THREE.Matrix4().makeBasis(new THREE.Vector3(a.y,a.z,a.x),a,new THREE.Vector3(a.z,a.x,a.y));var p=new THREE.BoxBufferGeometry(h,h,h);p.applyMatrix4(m);var q=new THREE.MeshLambertMaterial({color:b,transparent:true});var r=new THREE.Mesh(p,q);r.userData.color=b;if(a){r.position.copy(a);var s=1/g;var u=new THREE.CylinderBufferGeometry(s,s,1,4);m.setPosition(a.clone().multiplyScalar(-0.5));u.applyMatrix4(m);var v=new THREE.Mesh(u,q);v.renderOrder=1;r.add(v);m.setPosition(a);}var w=new THREE.BoxBufferGeometry(i,i,i);w.applyMatrix4(m);o.add(new THREE.Mesh(w,q));return r;}function k(a,b,m){var o=new THREE.BufferGeometry();var v=new Float32Array(6);v[a]=v[b+3]=0.7;o.setAttribute("position",new THREE.Float32BufferAttribute(v,3));var p=new Float32Array(6);p[a]=p[b+3]=1;o.setAttribute("color",new THREE.Float32BufferAttribute(p,3));var q=new THREE.Line(o,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,transparent:true,linewidth:window.devicePixelRatio}));q.userData.colors=p;var r=new THREE.Geometry();var s=new THREE.Vector3().setComponent(a,0.7);var u=new THREE.Vector3().setComponent(b,0.7);r.vertices.push(new THREE.Vector3(),s,u);r.faces.push(new THREE.Face3(0,1,2));var w=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:0xFFFF00,opacity:0.5,transparent:true,side:THREE.DoubleSide,visible:false}));w.renderOrder=1;q.add(w);m.add(w.clone());return q;}this._gizmo.add(j(new THREE.Vector3(1,0,0),A.x,this._touchAreas));this._gizmo.add(j(new THREE.Vector3(0,1,0),A.y,this._touchAreas));this._gizmo.add(j(new THREE.Vector3(0,0,1),A.z,this._touchAreas));this._gizmo.add(k(1,2,this._touchAreas));this._gizmo.add(k(2,0,this._touchAreas));this._gizmo.add(k(0,1,this._touchAreas));h-=0.1/g;var n=new THREE.MeshLambertMaterial({color:0xC0C0C0,transparent:true});this._gizmo.add(new THREE.Mesh(new THREE.BoxBufferGeometry(h,h,h),n));this._touchAreas.add(new THREE.Mesh(new THREE.BoxBufferGeometry(i,i,i),new THREE.MeshBasicMaterial()));this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);this._updateGizmoPartVisibility();};
e.prototype.hasDomElement=function(){return true;};
e.prototype._updateGizmoPartVisibility=function(){var s=this._coordinateSystem===C.Screen;var g=this._gizmo.children,a=this._touchAreas.children;g[2].visible=a[2].visible=!s;g[3].visible=g[4].visible=a[3].visible=a[4].visible=!s&&this._nonUniformScaleEnabled;g[5].visible=a[5].visible=this._nonUniformScaleEnabled;this._axisTitles.children[2].visible=!s;};
e.prototype.resetValues=function(){this._value.setScalar(1);};
e.prototype.setCoordinateSystem=function(a){this._coordinateSystem=a;this._gizmoIndex=this._handleIndex=-1;this._updateGizmoPartVisibility();};
e.prototype.setNonUniformScaleEnabled=function(v){this._nonUniformScaleEnabled=!!v;this._updateGizmoPartVisibility();};
e.prototype.show=function(v,a){this._viewport=v;this._tool=a;this._nodes.length=0;this._sequence=null;this._updateSelection(v._viewStateManager);var n=this._getNodesProperties();this._tool.fireEvent("scaling",{x:0,y:0,z:0,nodesProperties:n},true);};
e.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._sequence=null;this._updateEditingForm(false);};
e.prototype.getGizmoCount=function(){if(this._coordinateSystem===C.Local||this._coordinateSystem===C.Parent){return this._nodes.length;}else{return this._nodes.length>0?1:0;}};
e.prototype.getTouchObject=function(i){if(this._nodes.length===0){return null;}this._updateGizmoObjectTransformation(this._touchAreas,i);return this._touchAreas;};
var f=[1,2,4,6,5,3];
e.prototype.highlightHandle=function(a,h){var b=(a===6)||(a>=0&&!this._nonUniformScaleEnabled);var i,o;for(i=0;i<3;i++){o=this._gizmo.children[i];var g=b||(f[a]&(1<<i));var j=g?0xFFFF00:o.userData.color;o.material.color.setHex(j);o.children[0].material.color.setHex(j);o.children[0].material.opacity=o.material.opacity=g||h?1:0.35;var k=this._axisTitles.children[i];k.material.color.setHex(j);k.material.opacity=g||h?1:0.35;}for(i=3;i<6;i++){o=this._gizmo.children[i];var l=o.geometry.attributes.color;l.copyArray(b||i===a?[1,1,0,1,1,0]:o.userData.colors);l.needsUpdate=true;o.material.opacity=h||i===a?1:0.35;o.children[0].material.visible=i===a;}o=this._gizmo.children[6];o.material.color.setHex(b?0xFFFF00:0xC0C0C0);o.material.opacity=b||h?1:0.35;};
e.prototype.selectHandle=function(i,g){this._gizmoIndex=g;this._handleIndex=i;if(this._tool.getAutoResetValues()){this.resetValues();}this._viewport.setShouldRenderFrame();};
e.prototype.beginGesture=function(){this._beginValue=this._value.clone();this._scaleDelta.setScalar(1);this._matOrigin=this._gizmo.matrixWorld.clone();this._nodes.forEach(function(n){n.scaleOrigin=n.node.scale.clone();n.matOrigin=n.node.matrixWorld.clone();if(n.node.parent){n.matParentInv=new THREE.Matrix4().getInverse(n.node.parent.matrixWorld);}else{n.matParentInv=new THREE.Matrix4();}});};
e.prototype._prepareForCreatingScaleKey=function(s){this._sequence=s;};
e.prototype._printEventInfo=function(a,x,y,z,n){L.debug(a+" is fired:"+" x = "+x+"; y = "+y+"; z = "+z);n.forEach(function(p){L.debug("Node: "+p.node.name);if(p.offsetToRest){L.debug("offsetToRest: [ "+p.offsetToRest[0]+", "+p.offsetToRest[1]+", "+p.offsetToRest[2]+" ] ");}else{L.debug("offsetToRest: null");}if(p.offsetToPrevious){L.debug("offsetToPrevious: [ "+p.offsetToPrevious[0]+", "+p.offsetToPrevious[1]+", "+p.offsetToPrevious[2]+" ] ");}else{L.debug("offsetToPrevious: null");}if(p.absolute){L.debug("absolute: [ "+p.absolute[0]+", "+p.absolute[1]+", "+p.absolute[2]+" ] ");}else{L.debug("absolute: null");}if(p.world){L.debug("world: [ "+p.world[0]+", "+p.world[1]+", "+p.world[2]+" ] ");}else{L.debug("world: null");}if(p.restDifference){L.debug("restDifference: [ "+p.restDifference[0]+", "+p.restDifference[1]+", "+p.restDifference[2]+" ] ");}else{L.debug("restDifference: null");}if(p.restDifferenceInCoordinates){L.debug("restDifferenceInCoordinates: [ "+p.restDifferenceInCoordinates[0]+", "+p.restDifferenceInCoordinates[1]+", "+p.restDifferenceInCoordinates[2]+" ] ");}else{L.debug("restDifferenceInCoordinates: null");}});};
e.prototype._getNodesProperties=function(){var n=[];this._nodes.forEach(function(a){var b=a.node;var p={};p.node=b;var r=this._viewport._viewStateManager.getRelativeTransformation(b);p.offsetToRest=[r.scale[0],r.scale[1],r.scale[2]];p.offsetToPrevious=p.offsetToRest.slice();var g=this._getEffectiveParent(b);if(g!==b.parent){if(b.userData.skipUpdateJointNode){this._viewport._viewStateManager._setJointNodeOffsets(b,c.Scale);}if(b.userData&&b.userData.offsetScale){p.offsetToRest=b.userData.offsetScale.slice();}else{p.offsetToRest=[1,1,1];}p.offsetToPrevious=p.offsetToRest.slice();if(b.userData.skipUpdateJointNode){b.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();b.userData.skipUpdateJointNode=true;}}if(this._playback){var s=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(b,c.Scale,this._playback);if(s){p.offsetToPrevious[0]/=s[0];p.offsetToPrevious[1]/=s[1];p.offsetToPrevious[2]/=s[2];}}var h=this._viewport._viewStateManager.getTransformation(b);p.absolute=[h.scale[0],h.scale[1],h.scale[2]];var w=this._viewport._viewStateManager.getTransformationWorld(b);p.world=w.scale;var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(b);}if(!a.matParentInv){a.matParentInv=new THREE.Matrix4().getInverse(b.parent.matrixWorld);}var j=new THREE.Matrix4();if(this._gizmo){j=this._gizmo.matrixWorld.clone();}var k=new THREE.Vector3();var l,m,o;if(u&&u.initialScale){p.restDifference=[h.scale[0]/u.initialScale[0],h.scale[1]/u.initialScale[1],h.scale[2]/u.initialScale[2]];o=new THREE.Vector3(p.restDifference[0],p.restDifference[1],p.restDifference[2]);var q=new THREE.Quaternion(h.quaternion[0],h.quaternion[1],h.quaternion[2],h.quaternion[3]);var v=new THREE.Matrix4().makeRotationFromQuaternion(q);var x=new THREE.Matrix4().makeRotationFromQuaternion(u.initialQuaternion);var y=new THREE.Vector3();var z=new THREE.Vector3();var B=new THREE.Vector3();v.extractBasis(y,z,B);var D=new THREE.Vector3();var E=new THREE.Vector3();var F=new THREE.Vector3();x.extractBasis(D,E,F);if(y.dot(D)<0){p.restDifference[0]=-p.restDifference[0];}if(z.dot(E)<0){p.restDifference[1]=-p.restDifference[1];}if(B.dot(F)<0){p.restDifference[2]=-p.restDifference[2];}l=b.parent.matrixWorld.clone().scale(o).multiply(a.matParentInv);l.decompose(new THREE.Vector3(),new THREE.Quaternion(),k);if(this._coordinateSystem===C.World){p.restDifferenceInCoordinates=[k.x,k.y,k.z];}else{m=new THREE.Matrix4().getInverse(j).multiply(l).multiply(j);m.decompose(new THREE.Vector3(),new THREE.Quaternion(),k);p.restDifferenceInCoordinates=[k.x,k.y,k.z];}var H=this._alignAxesBetweenGizmoAndNodeCoordinates(b);for(var i=0;i<3;i++){if(p.restDifference[i]>0){p.restDifferenceInCoordinates[H[i]]=Math.abs(p.restDifferenceInCoordinates[H[i]]);}else{p.restDifferenceInCoordinates[H[i]]=-Math.abs(p.restDifferenceInCoordinates[H[i]]);}}}n.push(p);}.bind(this));return n;};
e.prototype.endGesture=function(){var n=this._getNodesProperties();delete this._beginValue;this._nodes.forEach(function(a){var b=a.node;if(b.userData){delete b.userData.skipUpdateJointNode;}this._viewport._viewStateManager._setJointNodeOffsets(b,c.Scale);}.bind(this));this._tool.fireScaled({x:this._scaleDelta.x,y:this._scaleDelta.y,z:this._scaleDelta.z,nodesProperties:n});this._printEventInfo("Event 'scaled'",this._scaleDelta.x,this._scaleDelta.y,this._scaleDelta.z,n);};
e.prototype._alignAxesBetweenGizmoAndNodeCoordinates=function(n,w){function g(v,q,r,s){var u=Math.abs(v.dot(q));var x=Math.abs(v.dot(r));var y=Math.abs(v.dot(s));if(u>=x&&u>=y){return 0;}else if(x>=u&&x>=y){return 1;}else{return 2;}}var a=n.parent.matrixWorld.clone().multiply(new THREE.Matrix4().makeRotationFromQuaternion(n.quaternion.clone()));var b=new THREE.Vector3();var h=new THREE.Vector3();var i=new THREE.Vector3();a.extractBasis(b,h,i);b.normalize();h.normalize();i.normalize();var j=new THREE.Matrix4();if(this._gizmo){j=this._gizmo.matrixWorld.clone();}var k=new THREE.Vector3();var l=new THREE.Vector3();var m=new THREE.Vector3();j.extractBasis(k,l,m);k.normalize();l.normalize();m.normalize();var o=[];var p;if(w){p=g(k,b,h,i);o.push(p);p=g(l,b,h,i);o.push(p);p=g(m,b,h,i);o.push(p);}else{p=g(b,k,l,m);o.push(p);p=g(h,k,l,m);o.push(p);p=g(i,k,l,m);o.push(p);}return o;};
e.prototype._scale=function(s){function a(b,i,g,h){if(i===0){if((h&&g.x>0)||(!h&&g.x<0)){b.x=Math.abs(b.x);}else{b.x=-Math.abs(b.x);}}else if(i===1){if((h&&g.y>0)||(!h&&g.y<0)){b.y=Math.abs(b.y);}else{b.y=-Math.abs(b.y);}}else if(i===2){if((h&&g.z>0)||(!h&&g.z<0)){b.z=Math.abs(b.z);}else{b.z=-Math.abs(b.z);}}}if(!this._beginValue){this._beginValue=this._value.clone();}this._value.multiplyVectors(this._beginValue,s);this._scaleDelta.copy(s);this._nodes.forEach(function(n){var b=n.node;if(!b.userData){b.userData={};}b.userData.skipUpdateJointNode=true;});if(this._coordinateSystem===C.Local){this._nodes.forEach(function(n){n.node.scale.copy(n.scaleOrigin).multiply(s);n.node.updateMatrix();});}else{var m=this._matOrigin.clone().scale(s).multiply(new THREE.Matrix4().getInverse(this._matOrigin));this._nodes.forEach(function(n){if(!n.ignore){var b=n.node;b.matrixWorld.multiplyMatrices(m,n.matOrigin);b.matrix.multiplyMatrices(n.matParentInv,b.matrixWorld);if(this._coordinateSystem===C.Parent){var g=b.matrix.clone();g.elements[12]=0;g.elements[13]=0;g.elements[14]=0;var h=new THREE.Matrix4().makeRotationFromQuaternion(b.quaternion.clone().inverse()).multiply(b.matrix);var i=h.elements;b.scale.x=i[0];b.scale.y=i[5];b.scale.z=i[10];b.updateMatrix();}else{b.matrix.decompose(b.position,new THREE.Quaternion(),b.scale);var j=this._alignAxesBetweenGizmoAndNodeCoordinates(b,true);a(b.scale,j[0],n.scaleOrigin,s.x>0);a(b.scale,j[1],n.scaleOrigin,s.y>0);a(b.scale,j[2],n.scaleOrigin,s.z>0);b.updateMatrix();}}}.bind(this));}this._viewport.setShouldRenderFrame();};
e.prototype.scale=function(x,y,z){this.beginGesture();this._scale(new THREE.Vector3(x,y,z));};
e.prototype._setScale=function(s){var n=this._getNodesProperties();if(this._tool.fireEvent("scaling",{x:s.x,y:s.y,z:s.z,nodesProperties:n},true)){this._printEventInfo("Event 'scaling'",s.x,s.y,s.z,n);this._scale(s);}};
e.prototype.getValue=function(){return(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3)?this._value.getComponent(this._handleIndex):1;};
e.prototype.setValue=function(v){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){var a=v/this._value.getComponent(this._handleIndex);var s=new THREE.Vector3(1,1,1);if(this._nonUniformScaleEnabled){s.setComponent(this._handleIndex,a);}else{s.setScalar(a);}this.beginGesture();this._scale(s);this.endGesture();}};
e.prototype.expandBoundingBox=function(b){if(this._viewport){this._expandBoundingBox(b,this._viewport.getCamera().getCameraRef(),true);}};
e.prototype.handleSelectionChanged=function(a){this._sequence=null;if(this._viewport){if(this._tool.getEnableSnapping()){this._tool.getDetector().setSource(this._viewport._viewStateManager);}this._updateSelection(this._viewport._viewStateManager);this._gizmoIndex=this._handleIndex=-1;var n=this._getNodesProperties();this._tool.fireEvent("scaling",{x:0,y:0,z:0,nodesProperties:n},true);}};
e.prototype._getObjectScale=function(o){if(this._nodes.length===1){return this._nodes[0].node.scale;}else if(this._coordinateSystem===C.Local){return this._nodes[o].node.scale;}return new THREE.Vector3(1,1,1);};
e.prototype._getObjectSize=function(o){var b=new THREE.Box3();if(this._nodes.length===1){this._nodes[0].node._expandBoundingBox(b,true,false);}else if(this._coordinateSystem===C.Local){this._nodes[0].node._expandBoundingBox(b,true,false);}if(b.isEmpty()){return 0;}var s=new THREE.Vector3();b.getSize(s);return s.length();};
e.prototype._updateGizmoTransformation=function(g,a){var s=this._updateGizmoObjectTransformation(this._gizmo,g);this._updateAxisTitles(this._axisTitles,this._gizmo,a,this._gizmoSize+30,s);};
e.prototype._getEditingFormPosition=function(){var s=this._updateGizmoObjectTransformation(this._gizmo,this._gizmoIndex);var a=new THREE.Vector3().setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return a.clone().multiplyScalar((this._gizmoSize+18)*s).add(this._gizmo.position).applyMatrix4(this._matViewProj);};
e.prototype.render=function(){d(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");if(this._nodes.length>0){var r=this._viewport.getRenderer(),a=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);r.clearDepth();for(var i=0,l=this.getGizmoCount();i<l;i++){this._updateGizmoTransformation(i,a);r.render(this._sceneGizmo,a);}}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex);};
return e;});
sap.ui.predefine('sap/ui/vk/tools/ScaleToolGizmoRenderer',[],function(){"use strict";var M={};
M.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkTransformationToolEdit");r.writeClasses();r.write(">");r.renderControl(c._editingForm);r.write("</div>");};
return M;},true);
sap.ui.predefine('sap/ui/vk/tools/SceneOrientationTool',["./Tool","./SceneOrientationToolGizmo"],function(T,S){"use strict";
var a=T.extend("sap.ui.vk.tools.SceneOrientationTool",{
metadata:{properties:{enablePredefinedViews:{type:"boolean",defaultValue:true},enableInitialView:{type:"boolean",defaultValue:true}}},
constructor:function(i,s){if(a._instance){return a._instance;}T.apply(this,arguments);this._viewport=null;this._menu=null;a._instance=this;}
});
a.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new S());};
a.prototype.setActive=function(v,b,g){T.prototype.setActive.call(this,v,b,g);this.getGizmo()._viewport=this._viewport;return this;};
a.prototype.setView=function(v,m){this.getGizmo().setView(v,m);return this;};
a.prototype.setEnableInitialView=function(v){this.setProperty("enableInitialView",v);this.getGizmo().setEnableInitialView(v);};
a.prototype.queueCommand=function(c){if(this.isViewportType("sap.ui.vk.dvl.Viewport")){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(c,this._dvlRendererId);}}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){c();}return this;};
a.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;delete a._instance;};
return a;});
sap.ui.predefine('sap/ui/vk/tools/SceneOrientationToolGizmo',["./Gizmo","sap/m/MenuButton","sap/m/Menu","sap/m/MenuItem","../thirdparty/three","./SceneOrientationToolGizmoRenderer","../getResourceBundle","./PredefinedView","./AxisColours"],function(G,M,a,b,t,S,g,P,A){"use strict";sap.ui.require("sap.m.Menu");
var c=G.extend("sap.ui.vk.tools.SceneOrientationToolGizmo",{metadata:{library:"sap.ui.vk"}});
function d(e,f){var h=64,l=0.5,i=15,j=3,k=29,n=30;e.multiplyScalar(1/80);var o=new THREE.Vector3(e.y,e.z,e.x),p=new THREE.Vector3(e.z,e.x,e.y);var q=new THREE.MeshLambertMaterial({color:f}),r=new THREE.MeshBasicMaterial({color:0xFFFFFF,transparent:true,opacity:0.8}),s=new THREE.MeshBasicMaterial({color:0x000000,transparent:true,opacity:0.8});var u=new THREE.CylinderBufferGeometry(l,l,h-i,4);var m=new THREE.Matrix4().makeBasis(o,e,p).setPosition(e.clone().multiplyScalar((h-i)*0.5));u.applyMatrix4(m);var v=new THREE.Mesh(u,q);var w=new THREE.CylinderBufferGeometry(0,j,i,12,1);m.setPosition(e.clone().multiplyScalar(h-i*0.5));w.applyMatrix4(m);v.add(new THREE.Mesh(w,q));var x=new THREE.CylinderBufferGeometry(l,l,k,4);m.makeBasis(e,p,o).setPosition(p.clone().multiplyScalar(0.5).add(e).multiplyScalar(k));x.applyMatrix4(m);v.add(new THREE.Mesh(x,r));x=new THREE.CylinderBufferGeometry(l,l,k,4);m.setPosition(p.clone().multiplyScalar(0.5).add(e).add(o).multiplyScalar(k));x.applyMatrix4(m);v.add(new THREE.Mesh(x,r));x=new THREE.CylinderBufferGeometry(l,l,k,4);m.makeBasis(p,o,e).setPosition(o.clone().multiplyScalar(0.5).add(e).multiplyScalar(k));x.applyMatrix4(m);v.add(new THREE.Mesh(x,r));x=new THREE.CylinderBufferGeometry(l,l,n,4);m.makeBasis(e,p,o).setPosition(p.clone().multiplyScalar(0.5).add(e).multiplyScalar(n));x.applyMatrix4(m);v.add(new THREE.Mesh(x,s));x=new THREE.CylinderBufferGeometry(l,l,n,4);m.setPosition(p.clone().multiplyScalar(0.5).add(e).add(o).multiplyScalar(n));x.applyMatrix4(m);v.add(new THREE.Mesh(x,s));x=new THREE.CylinderBufferGeometry(l,l,n,4);m.makeBasis(p,o,e).setPosition(o.clone().multiplyScalar(0.5).add(e).multiplyScalar(n));x.applyMatrix4(m);v.add(new THREE.Mesh(x,s));return v;}
c.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._enableInitialView=true;this._viewport=null;this._renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});this._renderer.setPixelRatio(window.devicePixelRatio);this._renderer.setSize(1,1);this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0.1,100);this._scene=new THREE.Scene();var l=new THREE.DirectionalLight(0xFFFFFF,0.5);l.position.set(1,3,2);this._scene.add(l);this._scene.add(new THREE.AmbientLight(0xFFFFFF,0.5));this._scene.add(d(new THREE.Vector3(1,0,0),A.x));this._scene.add(d(new THREE.Vector3(0,1,0),A.y));this._scene.add(d(new THREE.Vector3(0,0,1),A.z));this._scene.traverse(function(o){o.matrixAutoUpdate=false;});this._axisTitles=this._createAxisTitles(32,16);this._scene.add(this._axisTitles);var v=[P.Initial,P.Front,P.Back,P.Left,P.Right,P.Top,P.Bottom];this._menu=new a({items:[new b({text:g().getText("PREDEFINED_VIEW_INITIAL")}),new b({text:g().getText("PREDEFINED_VIEW_FRONT")}),new b({text:g().getText("PREDEFINED_VIEW_BACK")}),new b({text:g().getText("PREDEFINED_VIEW_LEFT")}),new b({text:g().getText("PREDEFINED_VIEW_RIGHT")}),new b({text:g().getText("PREDEFINED_VIEW_TOP")}),new b({text:g().getText("PREDEFINED_VIEW_BOTTOM")})]}).attachItemSelected(function(e){var i=e.getParameters("item").item;var f=e.getSource().indexOfItem(i);this.setView(v[f],1000);},this);this._button=new M({icon:"sap-icon://vk-icons/predefined-views",tooltip:g().getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),menu:this._menu}).addStyleClass("sapUiVizKitSceneOrientationGizmoButton").addStyleClass("sapUiSizeCompact");};
c.prototype.setView=function(v,m){var q;switch(v){case P.Initial:q=null;break;case P.Front:q=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),0);break;case P.Back:q=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI);break;case P.Left:q=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),-Math.PI/2);break;case P.Right:q=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2);break;case P.Top:q=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2);break;case P.Bottom:q=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2);break;default:return this;}this._viewport._viewportGestureHandler.setView(q,m||0);return this;};
c.prototype.setEnableInitialView=function(v){this._enableInitialView=v;var i=this._menu.getItems();i[0].setVisible(v);i[1].setStartsSection(v);};
c.prototype.render=function(v){this._viewport=v;this._camera.quaternion.copy(v.getCamera().getCameraRef().quaternion);this._camera.position.set(0,0,1).applyQuaternion(this._camera.quaternion);var w=this._renderer.getSize(new THREE.Vector2()).x;this._updateAxisTitles(this._axisTitles,this._scene,this._camera,w*0.45,2/w);this._renderer.render(this._scene,this._camera);};
c.prototype.onBeforeRendering=function(){};
c.prototype.onAfterRendering=function(){var e=this.getDomRef();this._renderer.setSize(e.clientWidth,e.clientHeight);e.appendChild(this._renderer.domElement);};
c.prototype.exit=function(){if(this._axisTitles){if(this._scene){this._scene.remove(this._axisTitles);}this._axisTitles=null;}if(this._camera){if(this._scene){this._scene.remove(this._camera);}this._camera=null;}if(this._scene){this._scene.dispose();this._scene=null;}G.prototype.exit.call(this);};
return c;});
sap.ui.predefine('sap/ui/vk/tools/SceneOrientationToolGizmoRenderer',[],function(){"use strict";var S={};
S.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVizKitSceneOrientationGizmo");r.writeClasses();r.write(">");if(c.getParent().getEnablePredefinedViews()){r.renderControl(c._button);}r.write("</div>");};
return S;},true);
sap.ui.predefine('sap/ui/vk/tools/Tool',["sap/ui/core/Element","sap/base/Log"],function(E,L){"use strict";
var T=E.extend("sap.ui.vk.tools.Tool",{
metadata:{properties:{targetViewportType:"any",toolid:"string",active:{type:"boolean",defaultValue:false},footprint:{type:"string[]"}},associations:{gizmoContainer:{type:"sap.ui.core.Control",cardinality:"0..1"}},aggregations:{gizmo:{type:"sap.ui.vk.tools.Gizmo",multiple:false}},events:{enabled:{parameters:{enabled:"boolean",reason:"string"}}}},
constructor:function(i,s){E.apply(this,arguments);this._viewport=null;this._handler=null;}
});
T.prototype.init=function(){if(E.prototype.init){E.prototype.init.call(this);}};
T.prototype.setViewport=function(v){var t=v&&v.getMetadata().getName();this._viewport=this.getFootprint().indexOf(t)>=0?v:null;};
T.prototype.isViewportType=function(t){if(this._viewport&&this._viewport.getMetadata().getName()===t){return true;}return false;};
T.prototype.getViewportImplementation=function(v){var r=v;if(v&&typeof v.getImplementation==="function"){r=v.getImplementation()||v;}return r;};
T.prototype.setActive=function(v,a,g){var b=this.getViewportImplementation(a)||this._viewport;var t=b&&b.getMetadata().getName();var r;if(this.getFootprint().indexOf(t)>=0){this._viewport=b;this.setProperty("active",v,true);if(this.getGizmo()){g=g||b;this.setAssociation("gizmoContainer",g);if(g.getDomRef()){g.invalidate();}}this._viewport.setShouldRenderFrame();r=v?"":"Disabled by application logic";}else{this._viewport=null;this.setProperty("active",false,true);r="Tool does not support Viewport type: "+t;L.warning(r);}this.fireEnabled({enabled:this.getActive(),reason:r});};
T.prototype.getGizmoForContainer=function(r){var _=this.getGizmo();if((r.getId()===this.getGizmoContainer())&&_&&this.getActive()){return _;}};
T.prototype.destroy=function(){E.prototype.destroy.call(this);this._viewport=null;this._handler=null;};
T.prototype._addLocoHandler=function(){if(!this._viewport||!this._viewport._loco){return false;}this._viewport._loco.addHandler(this._handler,this._handler._priority);return true;};
T.prototype._removeLocoHandler=function(p){if(this._viewport&&this._viewport._loco){this._viewport._loco.removeHandler(this._handler);}};
return T;});
sap.ui.predefine('sap/ui/vk/tools/ToolNodeSet',[],function(){"use strict";var T={Highlight:"Highlight",Outline:"Outline"};return T;},true);
sap.ui.predefine('sap/ui/vk/tools/TooltipTool',["./Tool","./TooltipToolHandler","./TooltipToolGizmo"],function(T,a,b){"use strict";
var c=T.extend("sap.ui.vk.tools.TooltipTool",{
metadata:{properties:{followCursor:{type:"boolean",defaultValue:true},animate:{type:"boolean",defaultValue:false},offsetX:{type:"float",defaultValue:10},offsetY:{type:"float",defaultValue:15}},events:{hover:{parameters:{x:"int",y:"int",nodeRef:"any"}}}},
constructor:function(i,s){if(c._instance){return c._instance;}T.apply(this,arguments);this._viewport=null;this._handler=new a(this);c._instance=this;}
});
c.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"]);this.setAggregation("gizmo",new b());};
c.prototype.setAnimate=function(v){this.setProperty("animate",v);var g=this.getGizmo();g.rerender();};
c.prototype.setActive=function(v,d,g){T.prototype.setActive.call(this,v,d,g);if(this._viewport){if(v){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(this._viewport,this);}this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
c.prototype.setTitle=function(t){if(this._gizmo){this._gizmo.setTitle(t);}return this;};
c.prototype.queueCommand=function(d){if(this._addLocoHandler()){var f=this.getFootprint();for(var n=0;n<f.length;n++){if(this.isViewportType(f[n])){d();break;}}}return this;};
return c;});
sap.ui.predefine('sap/ui/vk/tools/TooltipToolGizmo',["./Gizmo","./TooltipToolGizmoRenderer"],function(G,T){"use strict";
var a=G.extend("sap.ui.vk.tools.TooltipToolGizmo",{metadata:{library:"sap.ui.vk"}});
a.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._viewport=null;this._tool=null;this._previousNodeRef=null;};
a.prototype.show=function(v,t){this._viewport=v;this._tool=t;var b=this.getDomRef();if(b){b.style.display="none";}};
a.prototype.hide=function(){this._tool=null;var t=this.getDomRef();if(t){t.style.display="none";}};
a.prototype.setTitle=function(t){var b=this.getDomRef();if(b){b.style.display=t?"block":"none";b.innerText=t;}};
a.prototype.update=function(x,y,b,c,n){if(!this._tool.getFollowCursor()){if(n===this._previousNodeRef){return;}else{this._previousNodeRef=n;}}if(this._tool.fireEvent("hover",{x:x,y:y,nodeRef:n},true)){var t=this.getDomRef();if(t){var o=t.offsetParent;while(o){b-=o.offsetLeft||0;c-=o.offsetTop||0;o=o.offsetParent;}b+=this._tool.getOffsetX();c+=this._tool.getOffsetY();t.style.left=Math.round(b)+"px";t.style.top=Math.round(c)+"px";var v=this._viewport.getDomRef().getBoundingClientRect();var d=t.getBoundingClientRect();if(d.right>v.right){t.style.left=Math.round(b+v.right-d.right)+"px";}if(d.bottom>v.bottom){t.style.top=Math.round(c+v.bottom-d.bottom)+"px";}}}};
a.prototype.onBeforeRendering=function(){};
a.prototype.onAfterRendering=function(){};
return a;});
sap.ui.predefine('sap/ui/vk/tools/TooltipToolGizmoRenderer',[],function(){"use strict";var T={};
T.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVizKitTooltip");if(c.getParent().getAnimate()){r.addClass("sapUiVizKitTooltipAnimation");}r.writeClasses();r.write(">");r.write("</div>");};
return T;},true);
sap.ui.predefine('sap/ui/vk/tools/TooltipToolHandler',["sap/ui/base/EventProvider"],function(E){"use strict";
var T=E.extend("sap.ui.vk.tools.TooltipToolHandler",{
metadata:{},
constructor:function(t){this._priority=0;this._tool=t;this._rect=null;}
});
T.prototype.destroy=function(){this._tool=null;this._rect=null;};
T.prototype.hover=function(e){var g=this._tool.getGizmo();if(g&&this._inside(e)&&this.getViewport().getScene()){var h=this._tool._viewport.hitTest(e.x-this._rect.x,e.y-this._rect.y);if(h&&h.object){h=h.object;}g.update(e.x-this._rect.x,e.y-this._rect.y,e.x,e.y,h);e.handled=h!=null;}};
T.prototype.beginGesture=function(e){};
T.prototype.move=function(e){};
T.prototype.endGesture=function(e){};
T.prototype.click=function(e){};
T.prototype.doubleClick=function(e){};
T.prototype.contextMenu=function(e){};
T.prototype.getViewport=function(){return this._tool._viewport;};
T.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
T.prototype._inside=function(e){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return T;});
sap.ui.predefine('sap/ui/vk/tools/TransformSvgElementTool',["sap/base/Log","../library","./Tool","./TransformSvgElementToolHandler","./TransformSvgElementToolGizmo","./ToolNodeSet","../svg/Rectangle"],function(L,v,T,a,b,c,R){"use strict";
var d=T.extend("sap.ui.vk.tools.TransformSvgElementTool",{
metadata:{properties:{nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:c.Highlight},uniformScaleEnabled:{type:"boolean",defaultValue:false}},events:{moving:{parameters:{x:"float",y:"float",nodesProperties:{type:"any[]"}}},moved:{parameters:{x:"float",y:"float",nodesProperties:{type:"any[]"}}},rotating:{parameters:{angle:"float",nodesProperties:{type:"any[]"}}},rotated:{parameters:{angle:"float",nodesProperties:{type:"any[]"}}},scaling:{parameters:{x:"float",y:"float",nodesProperties:{type:"any[]"}}},scaled:{parameters:{x:"float",y:"float",nodesProperties:{type:"any[]"}}}}},
constructor:function(i,s){if(d._instance){return d._instance;}T.apply(this,arguments);this._viewport=null;this._handler=new a(this);d._instance=this;}
});
d.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.svg.Viewport"]);this.setAggregation("gizmo",new b());};
d.prototype.setActive=function(e,f,g){T.prototype.setActive.call(this,e,f,g);var h=this._viewport;if(h){if(e){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(h,this);}this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
d.prototype.setNodeSet=function(e){this.setProperty("nodeSet",e,true);if(this._gizmo){this._gizmo.handleSelectionChanged();}};
d.prototype.queueCommand=function(e){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.svg.Viewport")){e();}}return this;};
return d;});
sap.ui.predefine('sap/ui/vk/tools/TransformSvgElementToolGizmo',["./Gizmo","./TransformSvgElementToolGizmoRenderer","../svg/Element","../svg/Rectangle","./ToolNodeSet"],function(G,a,E,R,T){"use strict";
var b=G.extend("sap.ui.vk.tools.TransformSvgElementToolGizmo",{metadata:{library:"sap.ui.vk"}});
b.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}};
b.prototype.show=function(v,t){this._viewport=v;this._tool=t;this._nodes=[];this._cursor=null;this.handleSelectionChanged();v.attachCameraChanged(this._handleChanged,this);v._viewStateManager.attachTransformationChanged(this._handleChanged,this);};
b.prototype.hide=function(){if(this._cursor){this._viewport.removeStyleClass(this._cursor);this._cursor=null;}this._viewport._viewStateManager.detachTransformationChanged(this._handleChanged,this);this._viewport.detachCameraChanged(this._handleChanged,this);this._viewport=null;this._tool=null;this._nodes=[];};
b.prototype._handleChanged=function(){if(this.getDomRef()){this.rerender();}};
b.prototype._getHandleLocalPositions=function(i,m){var j=i.bbox;var x=j.x;var k=j.x+j.width;var l=(x+k)*0.5;var y=j.y+j.height*0.5;var o=j.height*0.5*i.ySign;var p=y-o;var q=y+o;var r=p-48*i.ySign/(this._viewport._camera.zoom*Math.sqrt(m[2]*m[2]+m[3]*m[3]));return[l,p,k,p,k,y,k,q,l,q,x,q,x,y,x,p,l,r,l,y];};
b.prototype._selectHandle=function(i,j){this._gizmoIndex=i;this._handleIndex=j;var k=null;if(i>=0){if(j>=0){if(j<8){var l=this._nodes[i];var m=l.node._matrixWorld();var o=Math.round(Math.atan2(m[2],m[3])*4/Math.PI);k=["NSResize","NESWResize","EWResize","NWSEResize"][(16-o+j*l.xSign*l.ySign)%4];}else{k="Rotate";}}else{k="Move";}k="sapUiVkTransformationToolCursor"+k;}if(this._cursor!=k){if(this._cursor){this._viewport.removeStyleClass(this._cursor);}if(k){this._viewport.addStyleClass(k);}this._cursor=k;}};
function g(m){return{x:m[4],y:m[5]};}
function c(m){return{x:Math.sqrt(m[0]*m[0]+m[1]*m[1]),y:Math.sqrt(m[2]*m[2]+m[3]*m[3])};}
function d(m){return Math.atan2(m[0],m[1]);}
function n(i){if(i<-Math.PI){return i+Math.PI*2;}else if(i>Math.PI){return i-Math.PI*2;}return i;}
function e(i){var r=null;while(i.parent){r=i;i=i.parent;}return r&&r.matrix[3]<0?-1:1;}
function f(v,i,j,k){return v*j+i*k;}
function h(m){return m[0]*m[3]-m[1]*m[2];}
b.prototype.handleSelectionChanged=function(j){var k=this._viewport?this._viewport._viewStateManager:null;if(k===null){return;}var l=[];if(this._tool){k[this._tool.getNodeSet()===T.Highlight?"enumerateSelection":"enumerateOutlinedNodes"](function(i){var m=i._matrixWorld();var x=h(m)<0?-1:1;if(i.parent){m=E._multiplyMatrices(E._invertMatrix(i.parent._matrixWorld()),m);}l.push({node:i,bbox:i.domRef?i.domRef.getBBox():{x:0,y:0,width:0,height:0},position:g(m),scale:c(m),angle:d(m),xSign:x,ySign:e(i)});});}if(this._nodes.length===l.length&&this._nodes.every(function(v,i){return l[i].node===v.node;})){return;}this._nodes=l;if(this.getDomRef()){this.rerender();}};
b.prototype.beginGesture=function(){this._nodes.forEach(function(i){var j=i.node;i.beginWorldMatrix=j._matrixWorld();i.bbox=j.domRef?j.domRef.getBBox():null;});this._eventParameters=null;};
b.prototype._update=function(i,j){var k=this._handleIndex;var o=k>=0&&k<8?(k+4)%8:9;var s=1,l=1,p=1,q=0;var r=[];var t;var u={nodesProperties:r};if(k<0){t="moving";u.x=i;u.y=j;}else{var v=this._nodes[this._gizmoIndex];var m=v.beginWorldMatrix;var w=this._getHandleLocalPositions(v,m);if(k<8){t="scaling";var x=w[o*2];var y=w[o*2+1];var z=w[k*2];var A=w[k*2+1];var B=f(z-x,A-y,m[0],m[2]);var C=f(z-x,A-y,m[1],m[3]);s=k===0||k===4?1:f(m[0],m[1],B+i,C+j)/f(m[0],m[1],B,C);l=k===2||k===6?1:f(m[2],m[3],B+i,C+j)/f(m[2],m[3],B,C);if(this._tool.getUniformScaleEnabled()){if(k===0||k===4){s=l;}else if(k===2||k===6){l=s;}else{s=l=Math.max(s,l);}}u.x=s;u.y=l;}else{t="rotating";var D=E._transformPoint(w[18],w[19],m);var F=E._transformPoint(w[16],w[17],m);var H=Math.atan2(F.x-D.x,F.y-D.y);var I=Math.atan2(F.x-D.x+i,F.y-D.y+j);var J=n(I-H);u.angle=J;p=Math.cos(J);q=Math.sin(J);}}this._nodes.forEach(function(K){var L=K.node;var M=K.beginWorldMatrix.slice();var N={node:L};if(k<0){M[4]+=i;M[5]+=j;}else{var w=this._getHandleLocalPositions(K,M);if(k<8){var O=w[o*2];var P=w[o*2+1];M[4]+=(O*M[0]+P*M[2]);M[5]+=(O*M[1]+P*M[3]);M[0]*=s;M[1]*=s;M[2]*=l;M[3]*=l;M[4]-=(O*M[0]+P*M[2]);M[5]-=(O*M[1]+P*M[3]);}else{var D=E._transformPoint(w[18],w[19],M);var Q=new Float32Array([p,-q,q,p,D.x-(D.x*p+D.y*q),D.y-(D.x*-q+D.y*p)]);M=E._multiplyMatrices(Q,M);}}K.xSign=h(M)<0?-1:1;if(L.parent){M=E._multiplyMatrices(E._invertMatrix(L.parent._matrixWorld()),M);}if(k<0){var S=g(M);N.x=S.x-K.position.x;N.y=S.y-K.position.y;}else if(k<8){var U=c(M);N.x=U.x/K.scale.x;N.y=U.y/K.scale.y;}else{N.angle=n(d(M)-K.angle);}L.setMatrix(M);r.push(N);}.bind(this));this.rerender();this._eventParameters=u;this._tool.fireEvent(t,u,true);};
b.prototype.endGesture=function(){if(this._eventParameters){var i=this._handleIndex;var j;if(i<0){j="moved";}else if(i<8){j="scaled";}else{j="rotated";}this._tool.fireEvent(j,this._eventParameters,true);}};
b.prototype.onBeforeRendering=function(){};
b.prototype.onAfterRendering=function(){};
return b;});
sap.ui.predefine('sap/ui/vk/tools/TransformSvgElementToolGizmoRenderer',[],function(){"use strict";var T={};
T.render=function(r,c){if(!c._viewport){return;}var v=c._viewport._getViewBox();r.write("<svg xmlns=\"http://www.w3.org/2000/svg\"");r.writeControlData(c);r.writeClasses();r.writeAttribute("width","100%");r.writeAttribute("height","100%");r.writeAttribute("viewBox",v.join(" "));r.addStyle("position","absolute");r.addStyle("pointer-events","none");r.writeStyles();r.write(">");r.write("<defs><filter id='shadow-effect'><feDropShadow dx='0' dy='0' stdDeviation='2' flood-color='#000'/></filter></defs>");var s=1/c._viewport._camera.zoom;function a(x,y,b,d){r.write("<rect");r.writeAttribute("fill","#fff");r.writeAttribute("stroke","#000");r.writeAttribute("stroke-width",1);r.writeAttribute("vector-effect","non-scaling-stroke");r.writeAttribute("filter","url(#shadow-effect)");var w=Math.abs(8*b);var h=Math.abs(8*d);r.writeAttribute("x",x-w*0.5);r.writeAttribute("y",y-h*0.5);r.writeAttribute("width",w);r.writeAttribute("height",h);r.write("/>");}c._nodes.forEach(function(n){var b=n.node;var d=n.bbox;if(d){var m=b._matrixWorld();var h=c._getHandleLocalPositions(n,m);var e=s*n.xSign*n.ySign/Math.sqrt(m[0]*m[0]+m[1]*m[1]);var f=s*n.ySign/Math.sqrt(m[2]*m[2]+m[3]*m[3]);r.write("<g");r.writeAttribute("transform","matrix("+m.join(",")+")");r.write(">");r.write("<rect");r.writeAttribute("fill","none");r.writeAttribute("stroke","#fff");r.writeAttribute("vector-effect","non-scaling-stroke");r.writeAttribute("x",d.x);r.writeAttribute("y",d.y);r.writeAttribute("width",d.width);r.writeAttribute("height",d.height);r.write("/>");r.write("<rect");r.writeAttribute("fill","none");r.writeAttribute("stroke","#000");r.writeAttribute("stroke-dasharray","5 5");r.writeAttribute("vector-effect","non-scaling-stroke");r.writeAttribute("x",d.x);r.writeAttribute("y",d.y);r.writeAttribute("width",d.width);r.writeAttribute("height",d.height);r.write("/>");r.write("<line");r.writeAttribute("stroke","#fff");r.writeAttribute("vector-effect","non-scaling-stroke");r.writeAttribute("x1",h[0]);r.writeAttribute("y1",h[1]);r.writeAttribute("x2",h[16]);r.writeAttribute("y2",h[17]);r.write("/>");r.write("<line");r.writeAttribute("stroke","#000");r.writeAttribute("stroke-dasharray","5 5");r.writeAttribute("vector-effect","non-scaling-stroke");r.writeAttribute("x1",h[0]);r.writeAttribute("y1",h[1]);r.writeAttribute("x2",h[16]);r.writeAttribute("y2",h[17]);r.write("/>");r.write("<g");r.writeAttribute("transform","matrix("+e+",0,0,"+f+","+(h[16]-8*e)+","+(h[17]-8*f)+")");r.write(">");r.write("<circle fill='#fff' stroke='#000' cx='8' cy='8' r='7.5'/><path fill='#000' d='M8,12.94A4.84,4.84,0,1,1,8,3.27h2.84v1H8a3.84,3.84,0,1,0,3.84,3.84h1A4.84,4.84,0,0,1,8,12.94Z'/><path fill='#000' d='M9.89,5.59a.5.5,0,0,1-.34-.88l1.09-1L9.56,2.83a.51.51,0,0,1-.05-.71.49.49,0,0,1,.7-.05l1.51,1.31a.48.48,0,0,1,.17.37.49.49,0,0,1-.16.38L10.22,5.46A.5.5,0,0,1,9.89,5.59Z'/><circle fill='#000' cx='8' cy='8' r='0.83'/>");r.write("</g>");for(var i=0;i<8;i++){a(h[i*2],h[i*2+1],e,f);}r.write("</g>");}});r.write("</svg>");};
return T;},true);
sap.ui.predefine('sap/ui/vk/tools/TransformSvgElementToolHandler',["sap/ui/base/EventProvider","../svg/Element"],function(E,a){"use strict";
var T=E.extend("sap.ui.vk.tools.TransformSvgElementToolHandler",{
metadata:{},
constructor:function(t){this._priority=10;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;}
});
T.prototype._getPosition=function(e){return this._tool._viewport._camera._screenToWorld(e.x-this._rect.x,e.y-this._rect.y);};
T.prototype.getGizmoHandle=function(e){var v=this._tool._viewport;if(!v||!this._gizmo||!this._inside(e)){return null;}var c=v._camera;var n=this._gizmo._nodes;if(!c||!n||n.length===0){return null;}var m=e.x-this._rect.x;var b=e.y-this._rect.y;var w=this._getPosition(e);var s=12;var g=-1;for(var d=0;d<n.length;d++){var f=n[d];var h=f.node;var i=h.domRef?h.domRef.getBBox():null;if(!i){continue;}var j=h._matrixWorld();var k=this._gizmo._getHandleLocalPositions(f,j);for(var l=0;l<9;l++){var o=a._transformPoint(k[l*2],k[l*2+1],j);var p=c._worldToScreen(o.x,o.y);if(m>=p.x-s&&m<=p.x+s&&b>=p.y-s&&b<=p.y+s){return{gizmoIndex:d,handleIndex:l,angle:Math.atan2(j[2],j[3])};}}if(g<0){var q=a._transformPoint(w.x,w.y,a._invertMatrix(j));if(q.x>=i.x&&q.x<=i.x+i.width&&q.y>=i.y&&q.y<=i.y+i.height){g=d;}}}return g<0?null:{gizmoIndex:g,handleIndex:-1};};
T.prototype.hover=function(e){if(this._gizmo){var h=this.getGizmoHandle(e);if(h){this._gizmo._selectHandle(h.gizmoIndex,h.handleIndex);}else{this._gizmo._selectHandle(-1,-1);}}};
T.prototype.beginGesture=function(e){this._handle=this.getGizmoHandle(e);if(this._handle){e.handled=true;this._gizmo._selectHandle(this._handle.gizmoIndex,this._handle.handleIndex);this._startPos=this._getPosition(e);this._gizmo.beginGesture();}};
T.prototype.move=function(e){if(this._handle){e.handled=true;var p=this._getPosition(e);this._gizmo._update(p.x-this._startPos.x,p.y-this._startPos.y);}};
T.prototype.endGesture=function(e){if(this._handle){this._handle=null;e.handled=true;this._gizmo.endGesture();}};
T.prototype.click=function(e){};
T.prototype.doubleClick=function(e){};
T.prototype.contextMenu=function(e){};
T.prototype.getViewport=function(){return this._tool._viewport;};
T.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
T.prototype._inside=function(e){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return T;});
sap.ui.predefine('sap/ui/vk/totara/Command',[],function(){"use strict";var C={addClientLog:"addClientLog",getAnnotation:"getAnnotation",getDynamicView:"getDynamicView",getGeometry:"getGeometry",getHighlightStyle:"getHighlightStyle",getImage:"getImage",getMaterial:"getMaterial",getMesh:"getMesh",getParametric:"getParametric",getGeomMesh:"getGeomMesh",getScene:"getScene",getSequence:"getSequence",getTrack:"getTrack",getTree:"getTree",getView:"getView",getViewGroups:"getViewGroups",notifyError:"notifyError",notifyFinishedTree:"notifyFinishedTree",notifyFinishedView:"notifyFinishedView",requestScene:"requestScene",setAnnotation:"setAnnotation",setCamera:"setCamera",setGeometry:"setGeometry",setHighlightStyle:"setHighlightStyle",setImage:"setImage",setMaterial:"setMaterial",setMesh:"setMesh",setLineStyle:"setLineStyle",setFillStyle:"setFillStyle",setTextStyle:"setTextStyle",setParametric:"setParametric",setScene:"setScene",setPlayback:"setPlayback",setSequence:"setSequence",setStreamingToken:"setStreamingToken",setTrack:"setTrack",setTree:"setTree",setTreeNode:"setTreeNode",setView:"setView",setViewGroup:"setViewGroup",setViewNode:"setViewNode",timestamp:"timestamp",performanceTiming:"performanceTiming",suppressSendRequests:"suppressSendRequests",unsuppressSendRequests:"unsuppressSendRequests",setMaxActiveRequests:"setMaxActiveRequests"};return C;});
sap.ui.predefine('sap/ui/vk/utf8ArrayBufferToString',[],function(){"use strict";var u=function(a){return decodeURIComponent(escape(String.fromCharCode.apply(null,new Uint8Array(a))));};return u;},true);
sap.ui.require.preload({
	"sap/ui/vk/manifest.json":'{"_version":"1.21.0","sap.app":{"id":"sap.ui.vk","type":"library","embeds":[],"applicationVersion":{"version":"1.88.0"},"title":"SAPUI5 Visualization Toolkit.","description":"SAPUI5 Visualization Toolkit.","ach":"CA-UI5-VTK","resources":"resources.json","offline":true},"sap.ui":{"technology":"UI5","supportedThemes":["base","sap_belize","sap_belize_hcb","sap_belize_hcw","sap_belize_plus","sap_bluecrystal","sap_fiori_3","sap_fiori_3_dark","sap_fiori_3_hcb","sap_fiori_3_hcw","sap_hcb"]},"sap.ui5":{"dependencies":{"minUI5Version":"1.88","libs":{"sap.ui.core":{"minVersion":"1.88.0"},"sap.ui.unified":{"minVersion":"1.88.0","lazy":true},"sap.m":{"minVersion":"1.88.0","lazy":true},"sap.ui.layout":{"minVersion":"1.88.0","lazy":true},"sap.ui.vbm":{"minVersion":"1.88.0","lazy":true},"sap.ui.richtexteditor":{"minVersion":"1.88.0","lazy":true}}},"library":{"i18n":false,"content":{"controls":["sap.ui.vk.AnimationTimeSlider","sap.ui.vk.ContainerBase","sap.ui.vk.ContainerContent","sap.ui.vk.DrawerToolbar","sap.ui.vk.FlexibleControl","sap.ui.vk.LegendItem","sap.ui.vk.ListPanel","sap.ui.vk.ListPanelStack","sap.ui.vk.MapContainer","sap.ui.vk.NativeViewport","sap.ui.vk.Notifications","sap.ui.vk.Overlay","sap.ui.vk.ProgressIndicator","sap.ui.vk.RedlineDesign","sap.ui.vk.RedlineSurface","sap.ui.vk.SceneTree","sap.ui.vk.StepNavigation","sap.ui.vk.Toolbar","sap.ui.vk.Viewer","sap.ui.vk.ViewGallery","sap.ui.vk.Viewport","sap.ui.vk.ViewportBase","sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport","sap.ui.vk.tools.AnchorPointToolGizmo","sap.ui.vk.tools.CrossSectionToolGizmo","sap.ui.vk.tools.Gizmo","sap.ui.vk.tools.MoveToolGizmo","sap.ui.vk.tools.RotateToolGizmo","sap.ui.vk.tools.ScaleToolGizmo","sap.ui.vk.tools.SceneOrientationToolGizmo","sap.ui.vk.tools.TooltipToolGizmo"],"elements":["sap.ui.vk.ContentConnector","sap.ui.vk.FlexibleControlLayoutData","sap.ui.vk.OverlayArea","sap.ui.vk.RedlineElement","sap.ui.vk.RedlineElementEllipse","sap.ui.vk.RedlineElementFreehand","sap.ui.vk.RedlineElementLine","sap.ui.vk.RedlineElementRectangle","sap.ui.vk.RedlineElementText","sap.ui.vk.ViewStateManager","sap.ui.vk.ViewStateManagerBase","sap.ui.vk.dvl.ViewStateManager","sap.ui.vk.threejs.NodesTransitionHelper","sap.ui.vk.threejs.ViewStateManager","sap.ui.vk.svg.ViewStateManager","sap.ui.vk.tools.AnchorPointTool","sap.ui.vk.tools.CrossSectionTool","sap.ui.vk.tools.HitTestTool","sap.ui.vk.tools.MoveTool","sap.ui.vk.tools.RectSelectTool","sap.ui.vk.tools.RotateOrbitTool","sap.ui.vk.tools.RotateTool","sap.ui.vk.tools.RotateTurntableTool","sap.ui.vk.tools.ScaleTool","sap.ui.vk.tools.SceneOrientationTool","sap.ui.vk.tools.Tool","sap.ui.vk.tools.TooltipTool","sap.ui.vk.tools.PoiManipulationTool"],"types":[],"interfaces":["sap.ui.vk.AuthorizationHandler","sap.ui.vk.DecryptionHandler","sap.ui.vk.IPlaybackCollection"]}}}}',
	"sap/ui/vk/matai/MataiLoaderWorker.js":function(){
/* the subsequent text seems not to contain a copyright or license statement */
(function(){"use strict";console.log("MataiLoaderWorker started.");
function S(s){this.sceneBuilderId=s;}
S.prototype.setScene=function(i){i.cameraId=i.cameraRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setScene",args:[i]});};
function p(v){var r=[];for(var a in v){var i=a.indexOf("/");if(i>=0){var f=[];var s=v[a];if(s){for(var n in s){f.push({name:n,value:s[n]});}}r.push({source:a.substr(0,i),type:a.substr(i+1),fields:f});}}return r;}
S.prototype.createNode=function(i){i.parentId=i.parentRef;if(i.transformType===1){i.transformType="BILLBOARD_VIEW";}else if(i.transformType===257){i.transformType="LOCK_TOVIEWPORT";}i.transform=i.matrix;i.sid=i.nodeRef;if(i.veids){i.veids=p(i.veids);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createNode",args:[i]},[i.transform.buffer]);};
S.prototype.createMesh=function(i){var t=[i.boundingBox.buffer];if(i.transform){t.push(i.matrix.buffer);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertSubmesh",args:[{meshId:i.meshRef,materialId:i.materialRef,transform:i.matrix,lods:[{id:i.meshRef,boundingBox:i.boundingBox}]}]},t);};
S.prototype.setMeshGeometry=function(i){var t=[i.data.index.buffer,i.data.position.buffer];if(i.data.normal){t.push(i.data.normal.buffer);}if(i.data.uv){t.push(i.data.uv.buffer);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setGeometry",args:[{id:i.meshRef,isPolyline:(i.flags&1)>0,data:{indices:i.data.index,points:i.data.position,normals:i.data.normal,uvs:i.data.uv}}]},t);};
S.prototype.insertMesh=function(n,m){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setMeshNode",args:[n,m]});};
S.prototype.createTextAnnotation=function(i){i.coordinateSpace=0;i.nodeId=i.nodeRef;i.fontFace=i.font;i.shape=i.style;i.backgroundColour=i.backgroundColor;i.borderColour=i.borderColor;i.textColour=i.textColor;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createAnnotation",args:[i]});};
S.prototype.createTextNote=function(i){i.coordinateSpace=2;i.nodeId=i.nodeRef;i.id=i.nodeRef;i.sid=i.targetNodeRef;i.fontFace=i.font;i.shape=i.style;i.backgroundColour=i.backgroundColor;i.backgroundColour=i.backgroundColor;i.borderColour=i.borderColor;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createAnnotation",args:[i]});};
S.prototype.createImageNote=function(i){i.properlyAligned=true;i.nodeId=i.nodeRef;i.labelMaterialId=i.materialRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createImageNote",args:[i]});};
S.prototype.insertLeaderLine=function(a){var b=[];for(var i=0;i<a.points.length;i+=3){var c=[a.points[i],a.points[i+1],a.points[i+2]];b.push(c);}a.points=b;a.annotationId=a.nodeRef;a.nodeId=a.nodeRef;a.startPointSid=a.targetNodeRef;a.materialId=a.materialRef;a.startPointHeadStyle=a.startPointStyle;a.endPointHeadStyle=a.endPointStyle;a.pointHeadConstant=a.styleConstant;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertLeaderLine",args:[a]});};
S.prototype.setParametricContent=function(n,i){var t=[];if(i.t){t.push(i.t.buffer);}if(i.r){t.push(i.r.buffer);}if(i.s){t.push(i.s.buffer);}if(i.segments){i.segments.forEach(function(s){if(s.points){t.push(s.points.buffer);}});}var l=i.lineStyle;if(l){l.colour=l.color;}var f=i.fillStyle;if(f){if(f.stops.length===1){f.colour=f.stops[0].color;}}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setParametricContent",args:[n,i]},t);};
S.prototype.createCamera=function(i){i.ortho=i.projection==="orthographic";i.near=i.nearClip;i.far=i.farClip;i.fov=i.fov*Math.PI/180;i.zoom=i.orthoZoomFactor;i.id=i.cameraRef;var t=[i.origin.buffer,i.up.buffer,i.target.buffer];if(i.matrix){t.push(i.matrix.buffer);}i.notUseDirectionVector=true;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createCamera",args:[i]},t);};
S.prototype.insertCamera=function(n,c){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertCamera",args:[n,c]});};
S.prototype.createViewportGroup=function(i){i.id=i.viewportGroupRef;if(i.veids){i.veids=p(i.veids);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertViewGroup",args:[i]});};
S.prototype.finalizePlaybacks=function(i){i.viewGroupId=i.viewportGroupRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setAnimationPlaybacks",args:[i]});};
S.prototype.insertModelView=function(i){i.viewGroupId=i.viewportGroupRef;i.viewId=i.modelViewRef;i.thumbnailId=i.thumbnail;i.cameraId=i.cameraRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertView",args:[i]});};
S.prototype.setModelViewVisibilitySet=function(i){i.viewId=i.modelViewRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setModelViewVisibilitySet",args:[i]});};
S.prototype.insertModelViewHighlight=function(i){i.viewId=i.modelViewRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertModelViewHighlight",args:[i]});};
S.prototype.createThumbnail=function(i){i.imageId=i.imageRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createThumbnail",args:[i]});};
S.prototype.createDetailView=function(i){i.nodeId=i.nodeRef;i.detailViewId=i.detailViewRef;i.cameraId=i.cameraRef;i.backgroundColour=i.backgroundColor;i.borderColour=i.borderColor;i.attachment=i.attachmentPoint;var t=[i.origin.buffer,i.size.buffer];if(i.attachment){t.push(i.attachment.buffer);}if(i.visibleNodes){t.push(i.visibleNodes.buffer);}if(i.targetNodes){t.push(i.targetNodes.buffer);}i.properlyAligned=true;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createDetailView",args:[i]},t);};
S.prototype.createMaterial=function(i){i.ambientColour=i.ambient;i.diffuseColour=i.diffuse;i.specularColour=i.specular;i.emissiveColour=i.emissive;if(i.linestyle){i.lineWidth=i.linestyle.width;i.lineHaloWidth=i.linestyle.haloWidth;i.lineColour=i.linestyle.color;i.lineEndRound=i.linestyle.endCapStyle;i.lineDashPatternScale=i.linestyle.dashPatternScale;i.lineDashPattern=i.linestyle.dashPattern;i.lineWidthCoordinateSpace=i.linestyle.widthCoordinateSpace;}i.id=i.materialRef;var t=[i.ambientColour.buffer,i.diffuseColour.buffer,i.specularColour.buffer,i.emissiveColour.buffer];if(i.lineColour&&i.lineDashPattern){t.push(i.lineColour.buffer,i.lineDashPattern.buffer);}if(i.textures){for(var a=0;a<i.textures.length;a++){var b=i.textures[a];var c="texture"+b.type.charAt(0).toUpperCase()+b.type.slice(1);i[c]={imageId:b.imageRef,matrix:b.matrix,uvHorizontalScale:b.scaleX,uvVerticalScale:b.scaleY,uvHorizontalOffset:b.offsetX,uvVerticalOffset:b.offsetY,uvRotationAngle:b.angle,influence:b.amount,filterMode:b.filterMode,uvHorizontalTilingEnabled:b.repeatX,uvVerticalTilingEnabled:b.repeatY,uvClampToBordersEnabled:b.clampToBorder,inverted:b.invert,modulate:b.modulate};}}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createMaterial",args:[i]},t);};
S.prototype.createImage=function(i){i.id=i.imageRef;i.binaryData=i.data;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createImage",args:[i]},[i.binaryData.buffer]);};
S.prototype.progress=function(a){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"progress",args:[a]});};
S.prototype.insertThrustline=function(i){i.thrustlineId=i.thrustlineRef;i.materialId=i.material;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertThrustline",args:[i]});};
S.prototype.insertAnimationGroup=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationGroup",args:[i]});};
S.prototype.insertAnimation=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimation",args:[i]});};
S.prototype.insertAnimationTarget=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationTarget",args:[i]});};
S.prototype.insertAnimationTrack=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationTrack",args:[i]});};
S.prototype.finalizeAnimation=function(a){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setAnimationTracks",args:[a]});};
self.onmessage=function(e){var d=e.data;switch(d.method){case"createRuntime":console.log("MataiLoaderWorker starting runtime.");sap.ve.matai.createRuntime({prefixURL:d.scriptDirectory}).then(function(m){console.log("MataiLoaderWorker runtime created.");self.matai=m;self.postMessage({ready:true});});break;case"loadSceneFromArrayBuffer":var a=new S(d.sceneBuilderId);var r=self.matai.loadSceneFromArrayBuffer(a,d.buffer,d.fileName,null,d.sourceLocation);this.postMessage({sceneBuilderId:d.sceneBuilderId,method:"loadingFinished",args:[{result:r}]});break;default:break;}};
console.log("MataiLoaderWorker initialized.");})();
},
	"sap/ui/vk/thirdparty/ie-polyfills.js":function(){if(!Uint8Array.prototype.slice){Object.defineProperty(Uint8Array.prototype,"slice",{value:function(b,e){return new Uint8Array(Array.prototype.slice.call(this,b,e));}});}if(!Uint8Array.prototype.indexOf){Object.defineProperty(Uint8Array.prototype,"indexOf",{value:function(o,s){for(var i=(s||0),j=this.length;i<j;i++){if(this[i]===o){return i;}}return-1;}});}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{enumerable:false,value:function(o){var n=this.filter(function(e){return e==o;});return n.length>0;}});}if(!Uint32Array.prototype.forEach){Object.defineProperty(Uint32Array.prototype,"forEach",{value:function(c,t){for(var i=0;i<this.length;i++){c.call(t,this[i],i,this);}}});}if(!Uint32Array.prototype.fill){Object.defineProperty(Uint32Array.prototype,'fill',{value:function(v){if(this==null){throw new TypeError('this is null or not defined');}var O=Object(this);var l=O.length>>>0;var s=arguments[1];var r=s>>0;var k=r<0?Math.max(l+r,0):Math.min(r,l);var e=arguments[2];var a=e===undefined?l:e>>0;var f=a<0?Math.max(l+a,0):Math.min(a,l);while(k<f){O[k]=v;k++;}return O;}});}
},
	"sap/ui/vk/totara/TotaraLoaderWorker.js":function(){(function(){"use strict";var m={};["getVersion","initializeConnection","getScene","getMesh","getParametric","getGeomMesh","getAnnotation","getMaterial","getGeometry","getImage","getSequence","getTrack","getView","getHighlightStyle"].reverse().forEach(function(n,i){m[n]=i;});var t=new Map();
function H(){this._url=null;this._url2=null;this._correlationId=null;this._authorizationToken=null;this._tenantUuidToken=null;this._onResponse=null;this._onError=null;this._requestQueue=[];this._maxActiveRequests=4;this._activeRequestCount=0;}
H.prototype.init=function(s,a,b){this._url=s;this._correlationId=b;var e=this;return new Promise(function(i,k){if(a){a(s).then(function(n){e._authorizationToken=n?n.token_type+" "+n.access_token:null;e._tenantUuidToken=n?n.tenant_uuid:null;i({});}).catch(function(n){return k(n);});}else{i({});}});};
H.prototype.close=function(){};
H.prototype.getURL=function(){return this._url;};
H.prototype.setCachingURL=function(a){this._url2=a;};
H.prototype.getCachingURL=function(){return this._url2;};
H.prototype.setMaxActiveRequests=function(a){this._maxActiveRequests=a;};
H.prototype.send=function(a,b,o){if(!a){return;}this._requestQueue.push({message:(o?this._url2:this._url)+a,context:b,priority:m[b&&b.method]||0,onResponse:o||this._onResponse});if(this._activeRequestCount<this._maxActiveRequests){this._processNextRequest();}};
H.prototype._processNextRequest=function(){if(!this._requestQueue.length){return;}this._requestQueue.sort(function(a,b){return a.priority-b.priority;});var e=this._requestQueue.pop();this._activeRequestCount++;var i=this;this._makeRequestPromise(encodeURI(e.message)).then(function(a){if(e.onResponse){e.onResponse(a);}i._activeRequestCount--;i._processNextRequest();}).catch(function(a){if(i._onError){i._onError({errorText:"Could not connect to server: "+i._url,error:a.status,reason:a.message?a.message:a,context:e.context});}i._activeRequestCount--;i._processNextRequest();});};
H.prototype._makeRequestPromise=function(a){var b=this;var p=new Promise(function(e,i){var x=new XMLHttpRequest();x.onload=function(){if(this.status>=200&&this.status<300){if(this.getAllResponseHeaders().includes("tile-width")){var k=this.getResponseHeader("tile-width");var n=new RegExp("[^\/]+$");var o=this.responseURL.match(n);t.set(o[0],k);}e(this.response);}else{i({status:this.status,statusText:this.statusText});}};x.onerror=function(){i({status:this.status,statusText:this.statusText});};x.open("GET",a,true);if(b._authorizationToken){x.setRequestHeader("Authorization",b._authorizationToken);}if(b._tenantUuidToken){x.setRequestHeader("X-TenantUuid",b._tenantUuidToken);}x.setRequestHeader("X-CorrelationID",b._correlationId);x.responseType="arraybuffer";x.send();});return p;};
function W(){this._url=null;this._webSocket=null;this._onResponse=null;this._onError=null;this._isInitialised=false;this._timerId=0;}
W.prototype.init=function(s,a){this._url=s;var b=this;return new Promise(function(i,k){var w=b._webSocket=new WebSocket(s);w.binaryType="arraybuffer";w.onopen=function(){b._isInitialised=true;if(a!=null){a(s).then(function(e){if(e!=null){var n={"token":e.access_token};if(e.tenant_uuid){n.tenantUuid=e.tenant_uuid;}var o=JSON.stringify(n);var p="setStreamingToken"+("["+o.length+"]")+o;w.send(p);}b._keepAlive();i({});}).catch(function(e){return k(e);});}else{b._keepAlive();i({});}};w.onclose=function(){b._cancelKeepAlive();};w.onmessage=function(e){var n=e.data;if(b._onResponse){b._onResponse(n);}};w.onerror=function(e){if(!b._isInitialised){k("error connecting to "+s);}else if(b._onError){b._onError({errorText:e});}};});};
W.prototype.getURL=function(){return this._url;};
W.prototype.close=function(){if(this._webSocket){this._webSocket.close();this._webSocket=null;}};
W.prototype._keepAlive=function(){var a=60000;if(this._webSocket===null){this._cancelKeepAlive();return;}if(this._webSocket.readyState===1){this._webSocket.send("");}this._timerId=setTimeout(this._keepAlive,a);};
W.prototype._cancelKeepAlive=function(){if(this._timerId){clearTimeout(this._timerId);this._timerId=0;}};
W.prototype.send=function(a,b){if(!a){return;}if(this._webSocket&&this._webSocket.readyState===1){try{this._webSocket.send(a);}catch(e){if(this._onError){this._onError({errorText:e,context:b});}}}else if(this._onError){this._onError({errorText:"websocket connection lost",context:b,error:4});}};
function g(a){var b=a.split(",");if(b.length<0||b.length>2){throw"invalid content length";}var i=0;var k=0;try{i=parseInt(b[0],10);if(b.length===2){k=parseInt(b[1],10);}}catch(e){throw"invalid content length";}return{jsonContentLength:i,binaryContentLength:k};}
function c(a,i){var b="[".charCodeAt(0);var e="]".charCodeAt(0);var k=[];var s=0;var n=0;var o;var p;var q;var v=new Uint8Array(a);while(n<a.byteLength){n=v.indexOf(b,s);if(n===-1){break;}var w=d(a,s,n).replace(/\n|\r|\s/g,"");s=n+1;n=v.indexOf(e,s);if(n===-1){throw"No matching [] for command length. abort";}o=g(d(a,s,n));s=n+1;n=s+o.jsonContentLength;p=d(a,s,n);if(o.binaryContentLength){s=n;n=s+o.binaryContentLength;q=new Uint8Array(a,s,o.binaryContentLength);}else{q=undefined;}s=n;var x={name:w,jsonString:p,isInitial:i};if(q){x.binaryContent=q;}k.push(x);}return k;}
var u;
function d(a,s,b){if(TextDecoder){if(!u){u=new TextDecoder();}return u.decode(new DataView(a,s,b-s));}var i="";var M=1000;try{while(s<b){var k=Math.min(M,b-s);var n=new Uint8Array(a,s,k);i+=String.fromCharCode.apply(null,n);s+=k;}}catch(e){return"";}return decodeURIComponent(escape(i));}
function L(){this.resolveFunctions=[];this.rejectFunctions=[];this.init=function(e,i,k){this._connection=e;this._connectionHTTP=i;this._sceneBuilderId=k;if(!e){throw"no connection provided for loader!";}this._connection._onResponse=function(n){var o=c(n,(this.context?this.context.isInitial:false));p(o);};this._connection.send("getVersion[2]{}",{method:"getVersion"});};var a=this;function b(v){a.protocolVersion=v.split(".").map(function(s){return parseInt(s,10);});}function p(e){var k;var s=-1;var v,i;var n=false;var o=false;var q=false;var w;for(i=0;i<e.length;i++){k=e[i];if(k.name==="setView"){if(!w){w=JSON.parse(k.jsonString).sceneId;}if(!n){if(!JSON.parse(k.jsonString).viewId){n=true;}}o=true;}else if(k.name==="setViewNode"){if(v===undefined){v=JSON.parse(k.jsonString).viewId;}}else if(k.name==="setSequence"&&o){q=true;}}if(v&&n){for(i=0;i<e.length;i++){k=e[i];if(k.name==="setView"){k.jsonContent={viewId:v};break;}}}if(w){self.postMessage({name:"suppressSendRequests",jsonContent:{sceneId:w}});}var x=function(k){if(k.binaryContent){self.postMessage({name:k.name,jsonString:k.jsonString,jsonContent:k.jsonContent,binaryContent:k.binaryContent,isInitial:k.isInitial},[k.binaryContent.buffer]);}else{self.postMessage({name:k.name,jsonString:k.jsonString,jsonContent:k.jsonContent,isInitial:k.isInitial});}};for(i=0;i<e.length;i++){k=e[i];if(k.name==="protocol"){b(JSON.parse(k.jsonString).version);}if(k.name==="setPlayback"&&q){s=i;continue;}if(k.name==="setImage"){var y=k.jsonContent.id;var z=y?t.get(y):null;if(z){k.jsonContent.tileWidth=z;}}if(k.name==="setScene"&&e.length>1){continue;}x(k);}if(s!==-1){k=e[s];x(k);}if(w){self.postMessage({name:"unsuppressSendRequests",jsonContent:{sceneId:w}});}}this.getConnection=function(){return this._connection;};this.getConnectionHTTP=function(){return this._connectionHTTP;};this._sendGetImage=function(e){var i;if(this.protocolVersion&&(this.protocolVersion[0]>1||this.protocolVersion[1]>0)){if(e.materialId){i="scenes/"+e.sceneId+"/materials/"+e.materialId+"/images/"+e.imageId;}else if(e.viewId){i="scenes/"+e.sceneId+"/views/"+e.viewId+"/images/"+e.imageId;}}i=i||("images/"+e.imageId);this._connectionHTTP.send(i,e,function(k){p([{name:"setImage",jsonContent:{sceneId:e.sceneId,id:e.imageId,isInitial:e.isInitial},binaryContent:new Uint8Array(k)}]);});};this._sendGetGeometries=function(e){var k=e.geometryIds;var n="geometry?";for(var i=0;i<k.length;i++){n+=(i>0?"&id=":"id=")+k[i];}this._connectionHTTP.send(n,e,function(o){var q=new DataView(o);var s=q.getUint16(2,true),v=0;var w=[];while(s-->0){var x={sceneId:e.sceneId,id:q.getUint32(v+4,true).toString(),box:[q.getFloat32(v+14,true),q.getFloat32(v+18,true),q.getFloat32(v+22,true),q.getFloat32(v+26,true),q.getFloat32(v+30,true),q.getFloat32(v+34,true)]};var y=q.getUint16(v+12,true);v+=38;if(y!==3){x.flags=q.getUint16(v,true);x.quality=q.getFloat32(v+4,true);x.pointCount=q.getUint16(v+8,true);x.elementCount=q.getUint16(v+10,true);v+=14;}var z=q.getUint32(v,true);var A=new Uint8Array(o,v+4,z);v+=z;w.push({name:"setGeometry",jsonContent:x,binaryContent:A.slice()});}p(w);});};this._sendGetGeomMeshes=function(e){var k="scenes/"+e.sceneId+"/meshes?ids=";var n=e.meshIds;for(var i=0;i<n.length;i++){k+=(i>0?",":"")+n[i];}this._connectionHTTP.send(k,e,function(o){var q=c(o);q.forEach(function(s){s.jsonContent={sceneId:e.sceneId};});p(q);});};this.send=function(e){if(this._connectionHTTP){switch(e.method){case"getImage":this._sendGetImage(e);return;case"getGeometry":this._sendGetGeometries(e);return;case"getGeomMesh":if(e.meshIds){this._sendGetGeomMeshes(e);return;}break;default:break;}}if(this._connection){this._connection.send(e.command,{method:e.method,isInitial:e.isInitialView});}};this.setSceneBuilderId=function(i){this._sceneBuilderId=i;};this.getSceneBuilderId=function(){return this._sceneBuilderId;};this.authorizationHandler=function(e){var a=this;return new Promise(function(i,k){var n={name:"getAuthorization",jsonContent:{url:e},sceneId:a.sceneId};a.resolveFunctions.push(i);a.rejectFunctions.push(k);self.postMessage(n);});}.bind(this);}
var l=new L();var r=function(e){self.postMessage({name:"notifyError",jsonContent:e});};var f=function(a,b,e,s,i,k){var n;var o;switch(a){case"getGeometry":n="?id=";if(!e){o=Number.MAX_SAFE_INTEGER;}else{o=k-(e+"geometry"+n).length;}break;case"getGeomMesh":n="?ids=";if(!e){o=Number.MAX_SAFE_INTEGER;}else{o=k-(e+"scenes/"+s+"/meshes"+n).length;}break;default:n="?request="+encodeURI(a+"["+k+"]"+JSON.stringify({sceneId:s,ids:[],token:i}));if(b.indexOf("ws")===0){o=Number.MAX_SAFE_INTEGER;}else{o=k-(b+n).length;}break;}return o;};var h=function(a){switch(a){case"getGeometry":return"&id=".length;default:return",".length;}};var j=function(a,b,s,e,i){a=a.indexOf("?")===-1?a:a.substring(0,a.indexOf("?"));var k=["getMesh","getAnnotation","getMaterial","getGeometry","getGeomMesh","getSequence","getTrack"];var n={};k.forEach(function(o){n[o]={maxBatchStringLength:f(o,a,b,s,e,i),separatorLength:h(o)};});return n;};
self.onmessage=function(e){var a=e.data;switch(a.method){case"initializeConnection":{if(!a.url){break;}if(a.sceneId){l.sceneId=a.sceneId;}var b="";if(a.url[a.url.length-1]!=="/"){a.url+="/";}if(a.url.toLowerCase().startsWith("ws")){b=a.url+"streaming?";}else if(a.url.toLowerCase().startsWith("http")){b=a.url+"streaming-http?request=";}else{b=(a.useSecureConnection?"wss://":"ws://")+a.url+"streaming?";}var i=a.cid;var k=l.getConnection();var n,o;if(!k||k._url!==b){if(k){k.close();}var p;var q=null;if(a.url.toLowerCase().startsWith("ws")){p=new W();}else if(a.url.toLowerCase().startsWith("http")){p=new H();p.setCachingURL(a.url);p.setMaxActiveRequests(a.maxActiveRequests);}else{p=new W();q=(a.useSecureConnection?"https://":"http://")+a.url;}p._onError=r;p.init(b,l.authorizationHandler,i).then(function(){var w=function(p,x){l.init(p,x,a.sceneBuilderId);n=p.getURL();o=x?x.getCachingURL():p.getCachingURL();self.postMessage({name:"batchSizeInfo",jsonContent:{sceneId:a.sceneId,batchSizeInfo:j(n,o,a.sceneId,a.cid,a.maxUrlLength)}});if(a.command){l.send(a);}};if(q){var x=new H();x.setCachingURL(q);x.init(q,l.authorizationHandler,i).then(function(){w(p,x);}).catch(function(y){r(y);});}else{w(p,p instanceof H?p:null);}}).catch(function(w){r(w);});}else{n=l.getConnection().getURL();o=l.getConnectionHTTP()?l.getConnectionHTTP().getCachingURL():l.getConnection().getCachingURL();self.postMessage({name:"batchSizeInfo",jsonContent:{sceneId:a.sceneId,batchSizeInfo:j(n,o,a.sceneId,a.cid,a.maxUrlLength)}});if(a.command){l.send(a);}}break;}case"setMaxActiveRequests":{if(l.getConnection()instanceof H){l.getConnection().setMaxActiveRequests(a.maxActiveRequests);}break;}case"setAuthorization":{var s=l.resolveFunctions.shift();var v=l.rejectFunctions.shift();if(a.error==null){s(a.authorizationToken);}else{v(a.error);}break;}case"close":{self.close();break;}default:{if(a.command){l.send(a);}break;}}};
self.postMessage({ready:true});})();
},
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
	"sap/ui/vk/dvl/GraphicsCore.js":'/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n\n        (c) Copyright 2009-2015 SAP SE. All rights reserved\n    \n */\nvar dvlLib="../ve/dvl";if(sap.ui.Device.browser.internet_explorer){dvlLib="../ve/dvl_asm";}sap.ui.define(["sap/ui/base/EventProvider","../thirdparty/html2canvas",dvlLib,"./Scene","../ContentResource","../DownloadManager","./ViewStateManager","../DvlException","../Messages","sap/ui/thirdparty/URI","./GraphicsCoreApi","./checkResult","./getPointer","./getJSONObject","../getResourceBundle","../utf8ArrayBufferToString","sap/base/assert","sap/base/util/uid","sap/base/Log"],function(E,H,D,S,C,a,V,b,M,U,G,c,d,f,h,u,j,k,L){"use strict";\nfunction l(e){return e instanceof File?"local":"remote";}\nfunction n(e){return e instanceof File?e.name:e;}\nvar o=function(e){Object.defineProperties(this,{source:{value:e,writable:false,enumerable:true},_refCount:{value:0,writable:true,enumerable:false}});};\no.prototype.isInUse=function(){return this._refCount>0;};\no.prototype.addRef=function(){++this._refCount;return this;};\no.prototype.release=function(){--this._refCount;j(this._refCount>=0,"Too many calls to SourceDatum.release().");return this;};\no.prototype.destroy=function(){};\nvar p=function(e,g,i){o.call(this,e);Object.defineProperties(this,{content:{value:i,writable:false,enumerable:true},vdsSourceDatum:{value:g,writable:false,enumerable:true}});};p.prototype=Object.create(o.prototype);p.prototype.constructor=p;\np.prototype.destroy=function(){j(this.vdsSourceDatum,"VDSL source without VDS reference");if(this.vdsSourceDatum){this.vdsSourceDatum.release();}o.prototype.destroy.call(this);};\nvar q=function(e,g,i){Object.defineProperties(this,{dvlSceneId:{value:e,writable:false,enumerable:true},sourceDatum:{value:g,writable:false,enumerable:true},root:{value:!!i,writable:false,enumerable:true},_refCount:{value:0,writable:true,enumerable:false}});};\nq.prototype.isInUse=function(){return this._refCount>0;};\nq.prototype.addRef=function(){++this._refCount;return this;};\nq.prototype.release=function(){--this._refCount;j(this._refCount>=0,"Too many calls to DvlSceneDatum.release().");return this;};\nq.prototype.destroy=function(){if(this.sourceDatum){this.sourceDatum.release();}};\nvar r=function(e,g){Object.defineProperties(this,{source:{value:e.getSource()},sourceType:{value:e.getSourceType()},sourceId:{value:e.getSourceId(),writable:true},name:{value:e.getName()},localMatrix:{value:e.getLocalMatrix(),writable:true},password:{value:e.getPassword()},children:{value:e.getContentResources().map(function(e){return new r(e);})},dvlSceneDatum:{value:null,writable:true},nodeProxy:{value:null,writable:true},fake:{value:!!g},sourceProperties:{value:null,writable:true}});e._shadowContentResource=this;};\nr.prototype.destroy=function(){if(this.dvlSceneDatum){this.dvlSceneDatum.release();}};\nvar s=function(e,g){Object.defineProperties(this,{vkScene:{value:e},shadowContentResource:{value:g}});};\nvar t=E.extend("sap.ui.vk.dvl.GraphicsCore",{\nmetadata:{publicMethods:["attachSceneLoadingFinished","attachSceneLoadingProgress","attachSceneLoadingStarted","buildSceneTree","buildSceneTreeAsync","createViewStateManager","destroyScene","destroyViewStateManager","detachSceneLoadingFinished","detachSceneLoadingProgress","detachSceneLoadingStarted","getApi","loadContentResourcesAsync","showDebugInfo","updateSceneTree","updateSceneTreeAsync"]},\nconstructor:function(e,g){E.apply(this);var i=jQuery.extend({},e,{filePackagePrefixURL:sap.ui.require.toUrl("sap/ui/vk/ve")+"/"});this._dvlClientId=k();var m=this;this._initialized=new Promise(function(z){m._initResolve=z;});sap.ve.dvl.createRuntime(i).then(function(z){m._dvl=z;m._dvl.CreateCoreInstance(m._dvlClientId);c(m._dvl.Core.Init(m._DVLMajorVersion,m._DVLMinorVersion));var A=sap.ui.getCore();A.attachLocalizationChanged(m._onlocalizationChanged,m);c(m._dvl.Core.SetLocale(A.getConfiguration().getLanguageTag()));m._canvas=m._createRenderingCanvasAndContext(g);m._rendererId=d(m._dvl.Core.CreateRenderer());m._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_DPI,96*window.devicePixelRatio,m._rendererId);m._initResolve();});this._sourceData=[];this._dvlSceneData=[];this._vkSceneData=[];this._viewports=[];this._renderLoopRequestId=null;this._renderLoopFunction=this._renderLoop.bind(this);this._viewStateManagers=[];},\n_DVLMajorVersion:7,\n_DVLMinorVersion:4\n});\nt.create=function(e,i){return new Promise(function(m,z){try{var g=new t(e,i);g._initialized.then(function(){m(g);});}catch(A){z(A);}});};\nt.prototype.destroy=function(){sap.ui.getCore().detachLocalizationChanged(this._onlocalizationChanged,this);var e=this._viewports.slice();e.reverse();e.forEach(function(g){g.control.setGraphicsCore(null);});this._viewports=null;this._cleanupVkSceneData();this._vkSceneData=null;this._cleanupDvlSceneData();j(this._dvlSceneData.length===0,"Not all DVL scenes are destroyed when sap.ui.vk.dvl.Scene objects are destroyed.");this._dvlSceneData=null;this._cleanupSourceData();j(this._sourceData.length===0,"Not all sources are deleted.");this._sourceData=null;this._viewStateManagers.slice().forEach(this.destroyViewStateManager.bind(this));this._viewStateManagers=null;this._webGLContext=null;this._canvas=null;this._dvl.Core.DeleteRenderer(this._rendererId);this._rendererId=null;this._dvl.Core.Release();this._dvl=null;E.prototype.destroy.apply(this);};\nt.prototype._createRenderingCanvasAndContext=function(e){var g=document.createElement("canvas");g.id=k();this._webGLContext=this._dvl.Core.CreateWebGLContext(g,e);return g;};\nt.prototype._getCanvas=function(){return this._canvas;};\nt.prototype._getWebGLContext=function(){return this._webGLContext;};\nt.prototype._getDvl=function(){return this._dvl;};\nt.prototype._getDvlClientId=function(){return this._dvlClientId;};\nt.prototype._findSourceData=function(e){var g=Object.getOwnPropertyNames(e);return this._sourceData.filter(function(i){return g.every(function(m){return e[m]===i[m];});});};\nt.prototype._destroySourceDatum=function(e){if(!(e instanceof p)){this._dvl.Core.DeleteFileByUrl(n(e.source),l(e.source));}e.destroy();return this;};\nt.prototype._cleanupSourceData=function(){var e=false;for(var i=this._sourceData.length-1;i>=0;--i){var g=this._sourceData[i];if(!g.isInUse()){var m=g instanceof p?g.vdsSourceDatum:null;this._sourceData.splice(i,1);this._destroySourceDatum(g);if(m&&!m.isInUse()){e=true;}}}if(e){this._cleanupSourceData();}return this;};\nt.prototype._findDvlSceneData=function(e){var g=Object.getOwnPropertyNames(e);return this._dvlSceneData.filter(function(i){return g.every(function(m){return e[m]===i[m];});});};\nt.prototype._destroyDvlSceneDatum=function(e){this._dvl.Scene.Release(e.dvlSceneId);e.destroy();return this;};\nt.prototype._cleanupDvlSceneData=function(){for(var i=this._dvlSceneData.length-1;i>=0;--i){var e=this._dvlSceneData[i];if(!e.isInUse()){this._dvlSceneData.splice(i,1);this._destroyDvlSceneDatum(e);}}};\nt.prototype._findVkSceneData=function(e){var g=Object.getOwnPropertyNames(e);return this._vkSceneData.filter(function(i){return g.every(function(m){return e[m]===i[m];});});};\nt.prototype._cleanupVkSceneData=function(){for(var i=this._vkSceneData.length-1;i>=0;--i){this.destroyScene(this._vkSceneData[i].vkScene);}};\nt.prototype._destroyShadowContentResource=function(g,i){if(i.children){i.children.forEach(this._destroyShadowContentResource.bind(this,g));}if(i.nodeProxy){var m=g.getDefaultNodeHierarchy();try{m.removeNode(i.nodeProxy.getNodeRef());}catch(e){var z="Failed to delete node with ID = "+i.nodeProxy.getNodeRef()+".";if(e instanceof b){z+=" Error code: "+e.code+". Message: "+e.message+".";}L.error(z);}m.destroyNodeProxy(i.nodeProxy);}i.destroy();};\nt.prototype._filterContentResources=function(e,g){var i=[];e.forEach(function z(m){if(g(m)){i.push(m);}m.getContentResources().forEach(z);});return i;};\nt.prototype._getContentResourcesWithMissingPasswords=function(g){var i=this._dvl.Library;return this._filterContentResources(g,function(m){var z=m.getSource();try{return z&&(f(i.RetrieveInfo(n(z),l(z))).flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED)&&!m.getPassword();}catch(e){L.warning("Failed to get information from Emscripten virtual file system about file \'"+n(z)+"\'");return false;}});};\nt.prototype._getContentResourcesWithEncryptedVds3=function(g){var i=this._dvl.Library;return this._filterContentResources(g,function(m){var z=m.getSource();if(z){try{var A=f(i.RetrieveInfo(n(z),l(z)));return A.major<=3&&(A.flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED);}catch(e){L.warning("Failed to get information from Emscripten virtual file system about file \'"+n(z)+"\'");return false;}}else{return false;}});};\nt.prototype._collectAndCheckSourceProperties=function(g){var i=g.dvlSceneDatum.sourceDatum;if(!i){return this;}try{if(i instanceof p){i=i.vdsSourceDatum;}var m=f(this._dvl.Library.RetrieveInfo(n(i.source),l(i.source)));g.sourceProperties={version:{major:m.major,minor:m.minor}};if(m.flags&(sap.ve.dvl.DVLFILEFLAG.PAGESCOMPRESSED|sap.ve.dvl.DVLFILEFLAG.WHOLEFILECOMPRESSED)){g.sourceProperties.compressed=true;}if(m.flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED){g.sourceProperties.encrypted=true;}}catch(e){L.warning("Failed to get information from Emscripten virtual file system about file \'"+n(g.source)+"\'");}return this;};\nt.prototype.loadContentResourcesAsync=function(e,g,i){var z=this,A=[],B=new Map();e.forEach(function P(m){var K=m.getSource();if(K&&A.indexOf(K)<0&&z._findSourceData({source:K}).length===0){A.push(K);var N=m.getSource();var O;if(N instanceof Object){O=N.name;}else{O=N;}if(m.getSourceType()==="vdsl"||m.getSourceType()==="vds"&&O.split(".").pop()==="vdsl"){B.set(K,{});}}m.getContentResources().forEach(P);});var F=[];if(A.length>0){var I;var J=new a(A,null,this._authorizationHandler).attachItemSucceeded(function(K){var N=K.getParameter("source");var O=K.getParameter("response");if(B.has(N)){var P=u(O);if(P.trim().length===0){I=I||[];I.push({source:N,status:M.VIT22.code,statusText:h().getText(M.VIT22.summary)});L.error(h().getText(M.VIT22.summary),M.VIT22.code,"sap.ui.vk.dvl.GraphicsCore");return;}else{var Q=P.split(/\\n|\\r\\n/);var m=Q[0].match(/^file=(.+)$/);if(!m){I=I||[];I.push({source:N,status:M.VIT23.code,statusText:h().getText(M.VIT23.summary)});L.error(h().getText(M.VIT23.summary),M.VIT23.code,"sap.ui.vk.dvl.GraphicsCore");return;}else{var R=B.get(N);R.content=Q;var T=m[1];var W=T;var X=new U(W);if(X.is("relative")){if(N instanceof File){I=I||[];I.push({source:N,status:M.VIT24.code,statusText:h().getText(M.VIT24.summary)});L.error(h().getText(M.VIT24.summary),M.VIT24.code,"sap.ui.vk.dvl.GraphicsCore");return;}else{var Y=new U(N);T=X.absoluteTo(Y).href();}}R.referencedSource=T;R.content[0]=R.content[0].replace(W,this._dvl.Core.GetFilename(R.referencedSource,"remote"));if(A.indexOf(R.referencedSource)<0&&this._findSourceData({source:R.referencedSource}).length===0){A.push(R.referencedSource);J.queue(R.referencedSource);}}}}else{var Z=N instanceof File;var $=Z?N.name:N;var _=l(N);this._dvl.Core.CreateFileFromArrayBuffer(O,$,_);F.push(new o(N));}},this).attachAllItemsCompleted(function(m){Array.prototype.push.apply(this._sourceData,F);B.forEach(function(K,N){var O=this._findSourceData({source:K.referencedSource})[0];if(O){var P=new p(N,O,K.content.join("\\n"));this._sourceData.push(P);O.addRef();}}.bind(this));if(g){g(I);}},this).attachItemFailed(function(m){I=I||[];I.push({source:m.getParameter("source"),status:m.getParameter("status"),statusText:m.getParameter("statusText")});},this);if(i){J.attachItemProgress(i,this);}J.start();}else if(g){g();}return this;};\nt.prototype._buildPlaceholders=function(e,g,i,m){var z=[];m.forEach(function F(g,i,A){var B=e.createNode(g,A.name,i);A.nodeProxy=e.createNodeProxy(B);if(A.localMatrix){A.nodeProxy.setLocalMatrix(A.localMatrix);}if(A.source){z.push(A);}A.children.forEach(F.bind(this,B,null));}.bind(this,g,i));return z;};\nt.prototype._updatePlaceholders=function(e,g,m){var z=this,A=e.getDefaultNodeHierarchy(),B=[];(function O(F,m,I){function J(P,Q){if(!P&&!Q){return true;}else if(!!P^!!Q){return false;}else{return P.source===Q.getSource()&&P.sourceType===Q.getSourceType()&&P.name===Q.getName()&&P.password===Q.getPassword();}}function K(P,Q){Q._shadowContentResource=P;P.sourceId=Q.getSourceId();P.localMatrix=Q.getLocalMatrix();if(P.nodeProxy){P.nodeProxy.setLocalMatrix(P.localMatrix);}}var i=0;var N=jQuery.sap.arrayDiff(F,m,J,true);N.forEach(function(P){for(;i<P.index;++i){O(F[i].children,m[i].getContentResources(),F[i].nodeProxy.getNodeRef());K(F[i],m[i]);}if(P.type==="delete"){z._destroyShadowContentResource(e,F[P.index]);F.splice(P.index,1);}else if(P.type==="insert"){var Q;if(i<F.length&&F[i].nodeProxy){Q=F[i].nodeProxy.getNodeRef();}var R=new r(m[P.index]);B=B.concat(z._buildPlaceholders(A,I,Q,[R]));F.splice(P.index,0,R);++i;}});for(;i<F.length;++i){O(F[i].children,m[i].getContentResources(),F[i].nodeProxy&&F[i].nodeProxy.getNodeRef());K(F[i],m[i]);}})(g.fake?g.children:[g],m,null);return B;};\nt.prototype._loadAndMergeContentResource=function(g,i){if(i.source){var m=this._findSourceData({source:i.source})[0];if(!m){L.warning("Failed to load content resource with sourceId \'"+i.sourceId+"\' due to failed downloading from URL \'"+n(i.source)+"\'.");}else{var z=i.nodeProxy.getNodeRef();var A=this._findDvlSceneData({sourceDatum:m,root:false})[0];if(!A){try{A=new q(d(m instanceof p?this._dvl.Core.LoadSceneFromVDSL(m.content,i.password):this._dvl.Core.LoadSceneByUrl(n(i.source),i.password,l(i.source))),m,false);}catch(e){L.error(h().getText(M.VIT34.summary)+": "+n(i.source),M.VIT34.code,"sap.ui.vk.dvl.GraphicsCore");return;}this._dvlSceneData.push(A);m.addRef();}i.dvlSceneDatum=A;A.addRef();this._collectAndCheckSourceProperties(i);this._dvl.Renderer.ResetView(sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA,this._rendererId);this._dvl.Scene.Merge(g._dvlSceneRef,A.dvlSceneId,z);}}};\nt.prototype.buildSceneTree=function(g){if(g.length===0){return null;}var i;var m;var z=g.map(function(I){return new r(I);});if(z.length===1&&z[0].name==null){m=z[0];if(m.source){var A=this._findSourceData({source:m.source})[0];try{i=new q(d(A instanceof p?this._dvl.Core.LoadSceneFromVDSL(A.content,m.password):this._dvl.Core.LoadSceneByUrl(n(m.source),m.password,l(m.source))),A,true);}catch(e){L.error(h().getText(M.VIT34.summary)+": "+n(m.source),M.VIT34.code,"sap.ui.vk.dvl.GraphicsCore");return null;}A.addRef();}else{i=new q(this._dvl.Core.CreateEmptyScene(),null,true);}}else{var B=new C({sourceType:"vds",sourceId:k()});m=new r(B,true);B.destroy();B=null;Array.prototype.push.apply(m.children,z);z=[m];i=new q(this._dvl.Core.CreateEmptyScene(),null,true);}this._dvlSceneData.push(i);m.dvlSceneDatum=i;i.addRef();this._collectAndCheckSourceProperties(m);var F=new S(this,i.dvlSceneId);this._vkSceneData.push(new s(F,m));this._buildPlaceholders(F.getDefaultNodeHierarchy(),null,null,m.children).forEach(this._loadAndMergeContentResource.bind(this,F.getDefaultNodeHierarchy()));return F;};\nt.prototype.updateSceneTree=function(e,g,i){if(g.length===0){return null;}var m;var z=this._getContentResourcesWithEncryptedVds3(g);if(z.length>0){L.error(h().getText(M.VIT25.summary),M.VIT25.code,"sap.ui.vk.dvl.GraphicsCore");m=m||{};m.contentResourcesWithEncryptedVds3=z;}var A=this._getContentResourcesWithMissingPasswords(g);if(A.length>0){L.error(h().getText(M.VIT21.summary),M.VIT21.code,"sap.ui.vk.dvl.GraphicsCore");m=m||{};m.contentResourcesWithMissingPasswords=A;}if(m&&i){i(m);}if(!e){return this.buildSceneTree(g);}var B=this._findVkSceneData({vkScene:e})[0].shadowContentResource;var F=!!B.source;var I=g.length===1&&!!g[0].getSource();if(!(F&&I&&B.source===g[0].getSource()||!F&&!I&&B.fake===g.length>1)||!B.fake&&g.length===1&&B.name!==g[0].getName()){return this.buildSceneTree(g);}this._updatePlaceholders(e,B,g).forEach(this._loadAndMergeContentResource.bind(this,e.getDefaultNodeHierarchy()));e.getDefaultNodeHierarchy().fireChanged();return e;};\nt.prototype._loadDvlSceneAsync=function(g,i){return new Promise(function(m,z){var A;var B=function(J){A();this.fireSceneLoadingFinished({source:g.source,sceneId:J.sceneId});m(J.sceneId);};var F=function(J){A();var K=J.errorMessage;if(K==null){K=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(J.errorCode):"";}var N={source:g.source,errorCode:J.errorCode,errorMessage:K};this.fireSceneLoadingFinished(N);z(N);};var I=function(J,K){this.fireSceneLoadingProgress({source:n(g.source),percentage:K});return true;}.bind(this);A=function(){this._dvl.Client.NotifyFileLoadProgress=null;this._dvl.Client.detachSceneFailed(F,this);this._dvl.Client.detachSceneLoaded(B,this);}.bind(this);this._dvl.Client.attachSceneLoaded(B,this);this._dvl.Client.attachSceneFailed(F,this);this._dvl.Client.NotifyFileLoadProgress=I;this.fireSceneLoadingStarted({source:n(g.source)});try{c(g instanceof p?this._dvl.Core.LoadSceneFromVDSLAsync(g.content,i):this._dvl.Core.LoadSceneByUrlAsync(n(g.source),i,l(g.source)));}catch(e){A();F.call(this,{errorCode:e instanceof b?e.code:sap.ve.dvl.DVLRESULT.FAIL,errorMessage:e instanceof b?null:e});}}.bind(this));};\nvar v=function(e,g){return new Promise(function(i){(function z(m){if(m>=e.length){i();}else{g(e[m]).catch(function(){}).then(function(){z(m+1);});}})(0);});};\nt.prototype._loadAndMergeContentResourcesAsync=function(e,g){var i,m=this;return v(g,function(z){if(z.source){var A=m._findSourceData({source:z.source})[0];if(!A){var B="Failed to load content resource with sourceId \'"+z.sourceId+"\' due to failed downloading from URL \'"+n(z.source)+"\'.";L.warning(B);i=i||[];i.push({errorMessage:B,source:z.source});return Promise.reject();}return(function(){var F=m._findDvlSceneData({sourceDatum:A,root:false})[0];if(F){return Promise.resolve(F);}else{return m._loadDvlSceneAsync(A,z.password).then(function(I){F=new q(I,A,false);m._dvlSceneData.push(F);A.addRef();return Promise.resolve(F);},function(I){i=i||[];i.push(I);return Promise.reject();});}})().then(function(F){z.dvlSceneDatum=F;F.addRef();m._collectAndCheckSourceProperties(z);var I=z.nodeProxy.getNodeRef();m._dvl.Renderer.ResetView(sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA,m._rendererId);m._dvl.Scene.Merge(e._dvlSceneRef,F.dvlSceneId,I);return Promise.resolve();});}return Promise.resolve();}).then(function(){return Promise.resolve(i);});};\nt.prototype.buildSceneTreeAsync=function(e){if(e.length===0){return Promise.resolve(null);}var g=e.map(function(i){return new r(i);});return function(){var i;if(g.length===1&&g[0].name==null){i=g[0];if(i.source){var m=this._findSourceData({source:i.source})[0];if(m){return this._loadDvlSceneAsync(m,i.password).then(function(A){var B=new q(A,m,true);m.addRef();return Promise.resolve({shadowContentResource:i,dvlSceneDatum:B});});}else{return Promise.reject({errorMessage:"Failed to download the root content resource.",source:i.source});}}return Promise.resolve({shadowContentResource:i,dvlSceneDatum:new q(this._dvl.Core.CreateEmptyScene(),null,true)});}else{var z=new C({sourceType:"vds",sourceId:k()});i=new r(z,true);z.destroy();z=null;Array.prototype.push.apply(i.children,g);g=[i];return Promise.resolve({shadowContentResource:i,dvlSceneDatum:new q(this._dvl.Core.CreateEmptyScene(),null,true)});}}.call(this).then(function(i){this._dvlSceneData.push(i.dvlSceneDatum);i.shadowContentResource.dvlSceneDatum=i.dvlSceneDatum;i.dvlSceneDatum.addRef();this._collectAndCheckSourceProperties(i.shadowContentResource);var m=new S(this,i.dvlSceneDatum.dvlSceneId);this._vkSceneData.push(new s(m,i.shadowContentResource));var z=m.getDefaultNodeHierarchy();return this._loadAndMergeContentResourcesAsync(z,this._buildPlaceholders(m.getDefaultNodeHierarchy(),null,null,i.shadowContentResource.children)).then(function(A){return Promise.resolve({scene:m,failureReason:A});});}.bind(this));};\nt.prototype.updateSceneTreeAsync=function(e,g){if(g.length===0){return Promise.resolve(null);}var i=this._getContentResourcesWithEncryptedVds3(g);if(i.length>0){L.error(h().getText(M.VIT25.summary),M.VIT25.code,"sap.ui.vk.dvl.GraphicsCore");}var m=this._getContentResourcesWithMissingPasswords(g);if(m.length>0){L.error(h().getText(M.VIT21.summary),M.VIT21.code,"sap.ui.vk.dvl.GraphicsCore");}if(!e){return this.buildSceneTreeAsync(g);}var z=this._findVkSceneData({vkScene:e})[0].shadowContentResource;var A=!!z.source;var B=g.length===1&&!!g[0].getSource();if(!(A&&B&&z.source===g[0].getSource()||!A&&!B&&z.fake===g.length>1)||!z.fake&&g.length===1&&z.name!==g[0].getName()){return this.buildSceneTreeAsync(g);}return new Promise(function(F,I){var J=e.getDefaultNodeHierarchy();this._loadAndMergeContentResourcesAsync(J,this._updatePlaceholders(e,z,g)).then(function(K){F({scene:e,failureReason:K});J.fireChanged();});}.bind(this));};\nt.prototype.destroyScene=function(e){var g;for(g=0;g<this._vkSceneData.length;++g){if(this._vkSceneData[g].vkScene===e){break;}}if(g===this._vkSceneData.length){L.warning("Scene with id \'"+e.getId()+"\' is not created by this GraphicsCore.");return this;}var i=this._vkSceneData.splice(g,1)[0];this._destroyShadowContentResource(e,i.shadowContentResource);e.destroy();return this;};\nvar w=function(e,g,m){j(Array.isArray(e),"The first parameter must be an array.");j(typeof g==="function","The second parameter must be a function.");for(var i=0,z=e.length;i<z;++i){if(g.call(m,e[i],i,e)){return i;}}return-1;};var x=function(e,g){return w(e,function(i){return i.control===g;});};var y=function(e,g){return w(e,function(i){return i.rendererId===g;});};\nt.prototype._registerViewport=function(e){j(e,"The viewportControl parameter must not be null.");if(x(this._viewports,e)>=0){return false;}var g={control:e,canvas:null,rendererId:null};if(this._viewports.length===0){g.canvas=this._canvas;g.rendererId=this._rendererId;this._startRenderLoop();}else{if(this._viewports.length===1){var i=this._viewports[0];i.control._setCanvas(i.canvas=document.createElement("canvas"));this._dvl.Client.attachFrameFinished(this._handleFrameFinished,this);}g.canvas=document.createElement("canvas");g.rendererId=this._dvl.Core.CreateRenderer();}e._setCanvas(g.canvas);e._setRenderer(g.rendererId);e.attachResize(this._handleViewportResize,this);this._viewports.push(g);return true;};\nt.prototype._deregisterViewport=function(e){j(e,"The viewportControl parameter must not be null.");var i=x(this._viewports,e);if(i<0){return false;}j(i>0||this._viewports.length===1,"The first registered viewport control must be deregistered last.");var g=this._viewports.splice(i,1)[0];if(this._viewports.length===0){this._stopRenderLoop();}else{if(this._viewports.length===1){this._dvl.Client.detachFrameFinished(this._handleFrameFinished,this);var m=this._viewports[1-i];m.control._setCanvas(m.canvas=this._canvas);}this._dvl.Core.DeleteRenderer(g.rendererId);}e.detachResize(this._handleViewportResize,this);e._setRenderer(null);e._setCanvas(null);return true;};\nt.prototype._getViewportCount=function(){return this._viewports.length;};\nt.prototype._handleViewportResize=function(e){if(this._viewports.length>1){this._canvas.width=Math.max.apply(null,this._viewports.map(function(g){return g.canvas.width;}));this._canvas.height=Math.max.apply(null,this._viewports.map(function(g){return g.canvas.height;}));}};\nt.prototype._startRenderLoop=function(){if(!this._renderLoopRequestId){this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);}return this;};\nt.prototype._stopRenderLoop=function(){if(this._renderLoopRequestId){window.cancelAnimationFrame(this._renderLoopRequestId);this._renderLoopRequestId=null;}return this;};\nt.prototype._renderLoop=(function(){var e;return function(){var m=this._viewports.length>1;this._viewports.forEach(function(g){var i=g.canvas,z=g.rendererId;this._dvl.Renderer._processCommandQueue(z);if(i.width>0&&i.height>0&&this._dvl.Renderer.ShouldRenderFrame(z)){if(m&&e!==z){this._dvl.Renderer.SetDimensions(i.width,i.height,z);}g.control.renderFrame();e=z;}},this);this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);};})();\nt.prototype._handleFrameFinished=function(e){j(this._viewports.length>1,"Method _handleFrameFinished should be only called when there are multiple viewports.");if(this._viewports.length>1){var i=y(this._viewports,e.rendererId);if(i>=0){var g=this._viewports[i].canvas,m=g.getContext("2d"),z=g.width,A=g.height;m.drawImage(this._canvas,0,this._canvas.height-A,z,A,0,0,z,A);}}};\nt.prototype.createViewStateManager=function(e,g){var i=new V();i._setNodeHierarchy(e).setShouldTrackVisibilityChanges(g);this._viewStateManagers.push(i);return i;};\nt.prototype.destroyViewStateManager=function(e){var i=this._viewStateManagers.indexOf(e);if(i>=0){this._viewStateManagers.splice(i,1)[0].destroy();}return this;};\nt.prototype.showDebugInfo=function(e){this._viewports.forEach(function(g){g.control.setShowDebugInfo(e);});return this;};\nt.prototype.getApi=function(e){switch(e){case G.LegacyDvl:return this._dvl;default:return null;}};\nt.prototype.collectGarbage=function(){this._cleanupDvlSceneData();this._cleanupSourceData();return this;};\nt.prototype._onlocalizationChanged=function(e){if(e.getParameter("changes").language){c(this._dvl.Core.SetLocale(sap.ui.getCore().getConfiguration().getLanguageTag()));}};\nt.prototype.setDecryptionHandler=function(e){this._dvl.Client.setDecryptionHandler(e);return this;};\nt.prototype.setAuthorizationHandler=function(e){this._authorizationHandler=e;return this;};\nt.prototype.getDecryptionHandler=function(){return this._dvl.Client.getDecryptionHandler();};\nt.prototype.attachSceneLoadingFinished=function(e,g,i){return this.attachEvent("sceneLoadingFinished",e,g,i);};\nt.prototype.detachSceneLoadingFinished=function(e,g){return this.detachEvent("sceneLoadingFinished",e,g);};\nt.prototype.fireSceneLoadingFinished=function(e,g,i){return this.fireEvent("sceneLoadingFinished",e,g,i);};\nt.prototype.attachSceneLoadingProgress=function(e,g,i){return this.attachEvent("sceneLoadingProgress",e,g,i);};\nt.prototype.detachSceneLoadingProgress=function(e,g){return this.detachEvent("sceneLoadingProgress",e,g);};\nt.prototype.fireSceneLoadingProgress=function(e,g,i){return this.fireEvent("sceneLoadingProgress",e,g,i);};\nt.prototype.attachSceneLoadingStarted=function(e,g,i){return this.attachEvent("sceneLoadingStarted",e,g,i);};\nt.prototype.detachSceneLoadingStarted=function(e,g){return this.detachEvent("sceneLoadingStarted",e,g);};\nt.prototype.fireSceneLoadingStarted=function(e,g,i){return this.fireEvent("sceneLoadingStarted",e,g,i);};\nreturn t;});\n'
},"sap/ui/vk/library-preload"
);
//# sourceMappingURL=library-preload.js.map