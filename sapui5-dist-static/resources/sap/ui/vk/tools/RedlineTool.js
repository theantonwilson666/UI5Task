/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/base/Log","../library","./Tool","./RedlineToolHandler","./RedlineToolGizmo","../Redline","../RedlineElementRectangle","../RedlineElementEllipse","../RedlineElementFreehand","../RedlineElementLine","../RedlineElementText"],function(L,v,T,R,a,b,c,d,e,f,g){"use strict";var h=T.extend("sap.ui.vk.tools.RedlineTool",{metadata:{events:{elementCreated:{parameters:{element:"object"}},elementClicked:{parameters:{elementId:"string"}}},aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement",multiple:true,forwarding:{getter:"getGizmo",aggregation:"redlineElements",forwardBinding:true}}}},constructor:function(i,s){if(h._instance){return h._instance;}T.apply(this,arguments);this._viewport=null;this._handler=new R(this);h._instance=this;}});h.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.svg.Viewport","sap.ui.vk.threejs.Viewport","sap.ui.vk.dvl.Viewport","sap.ui.vk.NativeViewport"]);this.setAggregation("gizmo",new a());};h.prototype.setActive=function(i,j,k){T.prototype.setActive.call(this,i,j,k);var l=this._viewport;if(l){if(i){if(l instanceof v.threejs.Viewport){l._viewportGestureHandler._activateRedline();}else if(l instanceof v.dvl.Viewport){l._activateRedline();}this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show();}this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}if(l instanceof v.dvl.Viewport){l._deactivateRedline();}else if(l instanceof v.threejs.Viewport){l._viewportGestureHandler._deactivateRedline();}}}return this;};var J={rectangle:c,ellipse:d,freehand:e,line:f,text:g};var S={rect:c,ellipse:d,path:e,line:f,text:g};h.prototype.startAdding=function(i){this.getGizmo()._startAdding(i);return this;};h.prototype.stopAdding=function(){this.getGizmo()._stopAdding();return this;};h.prototype.exportJSON=function(){return this.getGizmo().getRedlineElements().map(function(i){return i.exportJSON();});};h.prototype.importJSON=function(j){var i=this.getGizmo();j=Array.isArray(j)?j:[j];j.forEach(function(k){var E=J[k.type];if(E){i.addRedlineElement(new E().importJSON(k));}else{L.warning("Unsupported JSON element type "+k.type);}});i.rerender();return this;};h.prototype.exportSVG=function(){var s=document.createElementNS(b.svgNamespace,"svg");this.getGizmo().getRedlineElements().map(function(i){s.appendChild(i.exportSVG());});return s;};h.prototype.importSVG=function(s){var i=this.getGizmo();s.childNodes.forEach(function(t){if(t.getAttribute){var E=S[t.tagName];if(E){i.addRedlineElement(new E().importSVG(t));}else{L.warning("Unsupported SVG element type "+E);}}});i.rerender();return this;};h.prototype.queueCommand=function(i){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){i();}}return this;};h.prototype.onElementClicked=function(i){this.fireElementClicked({elementId:i.getParameter("elementId")});};return h;});
