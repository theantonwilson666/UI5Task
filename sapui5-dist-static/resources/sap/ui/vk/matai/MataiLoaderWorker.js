(function(){"use strict";console.log("MataiLoaderWorker started.");function S(s){this.sceneBuilderId=s;}S.prototype.setScene=function(i){i.cameraId=i.cameraRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setScene",args:[i]});};function p(v){var r=[];for(var a in v){var i=a.indexOf("/");if(i>=0){var f=[];var s=v[a];if(s){for(var n in s){f.push({name:n,value:s[n]});}}r.push({source:a.substr(0,i),type:a.substr(i+1),fields:f});}}return r;}S.prototype.createNode=function(i){i.parentId=i.parentRef;if(i.transformType===1){i.transformType="BILLBOARD_VIEW";}else if(i.transformType===257){i.transformType="LOCK_TOVIEWPORT";}i.transform=i.matrix;i.sid=i.nodeRef;if(i.veids){i.veids=p(i.veids);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createNode",args:[i]},[i.transform.buffer]);};S.prototype.createMesh=function(i){var t=[i.boundingBox.buffer];if(i.transform){t.push(i.matrix.buffer);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertSubmesh",args:[{meshId:i.meshRef,materialId:i.materialRef,transform:i.matrix,lods:[{id:i.meshRef,boundingBox:i.boundingBox}]}]},t);};S.prototype.setMeshGeometry=function(i){var t=[i.data.index.buffer,i.data.position.buffer];if(i.data.normal){t.push(i.data.normal.buffer);}if(i.data.uv){t.push(i.data.uv.buffer);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setGeometry",args:[{id:i.meshRef,isPolyline:(i.flags&1)>0,data:{indices:i.data.index,points:i.data.position,normals:i.data.normal,uvs:i.data.uv}}]},t);};S.prototype.insertMesh=function(n,m){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setMeshNode",args:[n,m]});};S.prototype.createTextAnnotation=function(i){i.coordinateSpace=0;i.nodeId=i.nodeRef;i.fontFace=i.font;i.shape=i.style;i.backgroundColour=i.backgroundColor;i.borderColour=i.borderColor;i.textColour=i.textColor;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createAnnotation",args:[i]});};S.prototype.createTextNote=function(i){i.coordinateSpace=2;i.nodeId=i.nodeRef;i.id=i.nodeRef;i.sid=i.targetNodeRef;i.fontFace=i.font;i.shape=i.style;i.backgroundColour=i.backgroundColor;i.backgroundColour=i.backgroundColor;i.borderColour=i.borderColor;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createAnnotation",args:[i]});};S.prototype.createImageNote=function(i){i.properlyAligned=true;i.nodeId=i.nodeRef;i.labelMaterialId=i.materialRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createImageNote",args:[i]});};S.prototype.insertLeaderLine=function(a){var b=[];for(var i=0;i<a.points.length;i+=3){var c=[a.points[i],a.points[i+1],a.points[i+2]];b.push(c);}a.points=b;a.annotationId=a.nodeRef;a.nodeId=a.nodeRef;a.startPointSid=a.targetNodeRef;a.materialId=a.materialRef;a.startPointHeadStyle=a.startPointStyle;a.endPointHeadStyle=a.endPointStyle;a.pointHeadConstant=a.styleConstant;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertLeaderLine",args:[a]});};S.prototype.setParametricContent=function(n,i){var t=[];if(i.t){t.push(i.t.buffer);}if(i.r){t.push(i.r.buffer);}if(i.s){t.push(i.s.buffer);}if(i.segments){i.segments.forEach(function(s){if(s.points){t.push(s.points.buffer);}});}var l=i.lineStyle;if(l){l.colour=l.color;}var f=i.fillStyle;if(f){if(f.stops.length===1){f.colour=f.stops[0].color;}}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setParametricContent",args:[n,i]},t);};S.prototype.createCamera=function(i){i.ortho=i.projection==="orthographic";i.near=i.nearClip;i.far=i.farClip;i.fov=i.fov*Math.PI/180;i.zoom=i.orthoZoomFactor;i.id=i.cameraRef;var t=[i.origin.buffer,i.up.buffer,i.target.buffer];if(i.matrix){t.push(i.matrix.buffer);}i.notUseDirectionVector=true;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createCamera",args:[i]},t);};S.prototype.insertCamera=function(n,c){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertCamera",args:[n,c]});};S.prototype.createViewportGroup=function(i){i.id=i.viewportGroupRef;if(i.veids){i.veids=p(i.veids);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertViewGroup",args:[i]});};S.prototype.finalizePlaybacks=function(i){i.viewGroupId=i.viewportGroupRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setAnimationPlaybacks",args:[i]});};S.prototype.insertModelView=function(i){i.viewGroupId=i.viewportGroupRef;i.viewId=i.modelViewRef;i.thumbnailId=i.thumbnail;i.cameraId=i.cameraRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertView",args:[i]});};S.prototype.setModelViewVisibilitySet=function(i){i.viewId=i.modelViewRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setModelViewVisibilitySet",args:[i]});};S.prototype.insertModelViewHighlight=function(i){i.viewId=i.modelViewRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertModelViewHighlight",args:[i]});};S.prototype.createThumbnail=function(i){i.imageId=i.imageRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createThumbnail",args:[i]});};S.prototype.createDetailView=function(i){i.nodeId=i.nodeRef;i.detailViewId=i.detailViewRef;i.cameraId=i.cameraRef;i.backgroundColour=i.backgroundColor;i.borderColour=i.borderColor;i.attachment=i.attachmentPoint;var t=[i.origin.buffer,i.size.buffer];if(i.attachment){t.push(i.attachment.buffer);}if(i.visibleNodes){t.push(i.visibleNodes.buffer);}if(i.targetNodes){t.push(i.targetNodes.buffer);}i.properlyAligned=true;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createDetailView",args:[i]},t);};S.prototype.createMaterial=function(i){i.ambientColour=i.ambient;i.diffuseColour=i.diffuse;i.specularColour=i.specular;i.emissiveColour=i.emissive;if(i.linestyle){i.lineWidth=i.linestyle.width;i.lineHaloWidth=i.linestyle.haloWidth;i.lineColour=i.linestyle.color;i.lineEndRound=i.linestyle.endCapStyle;i.lineDashPatternScale=i.linestyle.dashPatternScale;i.lineDashPattern=i.linestyle.dashPattern;i.lineWidthCoordinateSpace=i.linestyle.widthCoordinateSpace;}i.id=i.materialRef;var t=[i.ambientColour.buffer,i.diffuseColour.buffer,i.specularColour.buffer,i.emissiveColour.buffer];if(i.lineColour&&i.lineDashPattern){t.push(i.lineColour.buffer,i.lineDashPattern.buffer);}if(i.textures){for(var a=0;a<i.textures.length;a++){var b=i.textures[a];var c="texture"+b.type.charAt(0).toUpperCase()+b.type.slice(1);i[c]={imageId:b.imageRef,matrix:b.matrix,uvHorizontalScale:b.scaleX,uvVerticalScale:b.scaleY,uvHorizontalOffset:b.offsetX,uvVerticalOffset:b.offsetY,uvRotationAngle:b.angle,influence:b.amount,filterMode:b.filterMode,uvHorizontalTilingEnabled:b.repeatX,uvVerticalTilingEnabled:b.repeatY,uvClampToBordersEnabled:b.clampToBorder,inverted:b.invert,modulate:b.modulate};}}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createMaterial",args:[i]},t);};S.prototype.createImage=function(i){i.id=i.imageRef;i.binaryData=i.data;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createImage",args:[i]},[i.binaryData.buffer]);};S.prototype.progress=function(a){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"progress",args:[a]});};S.prototype.insertThrustline=function(i){i.thrustlineId=i.thrustlineRef;i.materialId=i.material;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertThrustline",args:[i]});};S.prototype.insertAnimationGroup=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationGroup",args:[i]});};S.prototype.insertAnimation=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimation",args:[i]});};S.prototype.insertAnimationTarget=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationTarget",args:[i]});};S.prototype.insertAnimationTrack=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationTrack",args:[i]});};S.prototype.finalizeAnimation=function(a){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setAnimationTracks",args:[a]});};self.onmessage=function(e){var d=e.data;switch(d.method){case"createRuntime":console.log("MataiLoaderWorker starting runtime.");sap.ve.matai.createRuntime({prefixURL:d.scriptDirectory}).then(function(m){console.log("MataiLoaderWorker runtime created.");self.matai=m;self.postMessage({ready:true});});break;case"loadSceneFromArrayBuffer":var a=new S(d.sceneBuilderId);var r=self.matai.loadSceneFromArrayBuffer(a,d.buffer,d.fileName,null,d.sourceLocation);this.postMessage({sceneBuilderId:d.sceneBuilderId,method:"loadingFinished",args:[{result:r}]});break;default:break;}};console.log("MataiLoaderWorker initialized.");})();
