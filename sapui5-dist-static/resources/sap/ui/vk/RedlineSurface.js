/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./library","sap/ui/core/Control","./Loco","./RedlineGesturesHandler","./RedlineSurfaceRenderer","./Redline","sap/base/Log"],function(v,C,L,R,a,b,c){"use strict";var d=C.extend("sap.ui.vk.RedlineSurface",{metadata:{library:"sap.ui.vk",aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement"}},properties:{virtualLeft:{type:"float"},virtualTop:{type:"float"},virtualSideLength:{type:"float"},panningRatio:{type:"float",defaultValue:1}},events:{pan:{parameters:{deltaX:"float",deltaY:"float"}},zoom:{parameters:{originX:"float",originY:"float",zoomFactor:"float"}}}}});d.prototype.init=function(){};d.prototype.onAfterRendering=function(){};d.prototype.exportJSON=function(){return this.getRedlineElements().map(function(e){return e.exportJSON();});};d.prototype.importJSON=function(j){if(!jQuery.isArray(j)){j=[j];}j.forEach(function(e){var E;switch(e.type){case b.ElementType.Rectangle:E=sap.ui.vk.RedlineElementRectangle;break;case b.ElementType.Ellipse:E=sap.ui.vk.RedlineElementEllipse;break;case b.ElementType.Freehand:E=sap.ui.vk.RedlineElementFreehand;break;case b.ElementType.Line:E=sap.ui.vk.RedlineElementLine;break;case b.ElementType.Text:E=sap.ui.vk.RedlineElementText;break;default:c.warning("Unsupported JSON element type "+e.type);}if(E!=null){this.addRedlineElement(new E().importJSON(e));}}.bind(this));return this;};d.prototype._toVirtualSpace=function(x,y){if(arguments.length===1){return x/this.getVirtualSideLength();}else{return{x:(x-this.getVirtualLeft())/this.getVirtualSideLength(),y:(y-this.getVirtualTop())/this.getVirtualSideLength()};}};d.prototype._toPixelSpace=function(x,y){if(arguments.length===1){return x*this.getVirtualSideLength();}else{return{x:x*this.getVirtualSideLength()+this.getVirtualLeft(),y:y*this.getVirtualSideLength()+this.getVirtualTop()};}};d.prototype.setPanningRatio=function(p){this.setProperty("panningRatio",p,true);};d.prototype.updatePanningRatio=function(){var e=this.getVirtualLeft(),f=this.getVirtualTop(),r=this.getDomRef(),g=r.getBoundingClientRect(),h=g.height,w=g.width,p;if(e===0&&(h<w&&f<0||(h>w&&f>0))){p=h/w;}else{p=1;}this.setPanningRatio(p);return this;};d.prototype.exportSVG=function(){var s=document.createElementNS(b.svgNamespace,"svg");this.getRedlineElements().map(function(e){s.appendChild(e.exportSVG());});return s;};d.prototype.importSVG=function(s){s.childNodes.forEach(function(t){if(t.getAttribute){var E;switch(t.tagName){case"rect":E=sap.ui.vk.RedlineElementRectangle;break;case"ellipse":E=sap.ui.vk.RedlineElementEllipse;break;case"path":E=sap.ui.vk.RedlineElementFreehand;break;case"line":E=sap.ui.vk.RedlineElementLine;break;case"text":E=sap.ui.vk.RedlineElementText;break;default:c.warning("Unsupported SVG element type "+E);}if(E){this.addRedlineElement(new E().importSVG(t));}}}.bind(this));return this;};return d;});
