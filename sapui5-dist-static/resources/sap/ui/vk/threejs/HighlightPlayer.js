/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/Object","../thirdparty/three","../HighlightDisplayState"],function(B,t,H){"use strict";var a=B.extend("sap.ui.vk.threejs.HighlightPlayer",{constructor:function(){this._state=H.stopped;this._startTime=0;this._timeElapsed=0;this._highlightsNodesMap=new Map();}});a.prototype.reset=function(v,s){this.stop();this._highlightsNodesMap.clear();this._state=H.stopped;if(v&&s){var h=v.getHighlightIdNodesMap();var b=this;h.forEach(function(c,k){var d=s.getHighlight(k);b.addHighlights(d,c);});}return this;};a.prototype.setViewStateManager=function(v){this._viewStateManager=v;};a.prototype.addHighlights=function(h,n){if(h&&n&&n.length){this._highlightsNodesMap.set(h,{nodes:n});}};a.prototype.start=function(b){if(this._state===H.pausing){this._startTime=b-this._timeElapsed;}else{this._startTime=b;this._timeElapsed=0;}this._state=H.playing;var v=this._viewStateManager;this._highlightsNodesMap.forEach(function(n,h){var c=[];n.nodes.forEach(function(d){while(d){if(!d.visible){v.setVisibilityState(d,true,false);c.push(d);}d=d.parent;}});n.hiddenNodes=c.length>0?c:undefined;});};a.prototype.play=function(b){if(this._state!==H.playing){return false;}this._timeElapsed=b-this._startTime;var c=this;var d=[];this._highlightsNodesMap.forEach(function(n,h){var r=h.getColour(c._timeElapsed/1000.0);var e=n.nodes,f;if(r!==undefined){for(f=0;f<e.length;f++){e[f]._vkSetHighlightColor(r.colour);}}var g=h.getOpacity(c._timeElapsed/1000.0);if(g!==undefined){for(f=0;f<e.length;f++){e[f]._vkSetOpacity(g.opacity);}if(g.isCompleted&&h.isFadeOut()&&n.hiddenNodes!==undefined){c._viewStateManager.setVisibilityState(n.hiddenNodes,false,false);}}if((r===undefined||r.isCompleted)&&(g===undefined||g.isCompleted)){d.push(h);}});d.forEach(function(h){c._highlightsNodesMap.delete(h);});if(this._highlightsNodesMap.size===0){this._state=H.stopped;return false;}return true;};a.prototype.stop=function(b){this._timeElapsed=0;this._startTime=0;var c=this;this._highlightsNodesMap.forEach(function(n,h){var d=n.nodes;for(var e=0;e<d.length;e++){var f=d[e];f._vkSetHighlightColor(undefined);f._vkSetOpacity(undefined);}if(h.isFadeOut()&&d.hiddenNodes!=undefined){c._viewStateManager.setVisibilityState(d.hiddenNodes,false,false);}});this._state=H.stopped;return this;};a.prototype.pause=function(b){if(this._state===H.stopped){return this;}this._timeElapsed=b-this._startTime;this._state=H.pausing;return this;};return a;});
