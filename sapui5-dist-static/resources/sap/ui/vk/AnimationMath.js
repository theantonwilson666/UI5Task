sap.ui.define(["sap/base/Log","./glMatrix","./AnimationTrackType","./AnimationTrackValueType"],function(L,g,A,a){"use strict";var t="sap.ui.vk.AnimationMath";var b={};b.clamp11=function(v){return Math.max(-1,Math.min(1,v));};b.neutralAngleAxisToGlMatrixQuat=function(v){return g.quat.setAxisAngle(g.quat.create(),g.vec3.fromValues(v[0],v[1],v[2]),v[3]);};b.neutralEulerToGlMatrixQuat=function(v){var m=1,c=1,d=1,e=1;switch(v[3]){case 6:c=-1;e=-1;break;case 18:c=-1;d=-1;break;case 33:m=-1;e=-1;break;case 36:m=-1;d=-1;break;case 24:d=-1;e=-1;break;case 9:m=-1;c=-1;break;default:}var h=v[0];var f=v[1];var i=v[2];var j=Math.cos(h/2);var s=Math.sin(h/2);var k=Math.cos(f/2);var l=Math.sin(f/2);var n=Math.cos(i/2);var o=Math.sin(i/2);var x=s*k*n+m*j*l*o;var y=j*l*n+c*s*k*o;var z=j*k*o+d*s*l*n;var w=j*k*n+e*s*l*o;return g.quat.fromValues(x,y,z,w);};b.threeQuatToNeutralEuler=function(q,o){var r=g.mat4.fromQuat(g.mat4.create(),g.quat.fromValues(q.x,q.y,q.z,q.w));var m=r[0],c=r[4],d=r[8];var e=r[1],f=r[5],h=r[9];var i=r[2],j=r[6],k=r[10];var x=0,y=0,z=0;var l=0.9999999;switch(o){case 6:y=Math.asin(b.clamp11(d));if(Math.abs(d)<l){x=Math.atan2(-h,k);z=Math.atan2(-c,m);}else{x=Math.atan2(j,f);}break;case 18:x=Math.asin(-b.clamp11(h));if(Math.abs(h)<l){y=Math.atan2(d,k);z=Math.atan2(e,f);}else{y=Math.atan2(-i,m);}break;case 33:x=Math.asin(b.clamp11(j));if(Math.abs(j)<l){y=Math.atan2(-i,k);z=Math.atan2(-c,f);}else{z=Math.atan2(e,m);}break;case 36:y=Math.asin(-b.clamp11(i));if(Math.abs(i)<l){x=Math.atan2(j,k);z=Math.atan2(e,m);}else{z=Math.atan2(-c,f);}break;case 24:z=Math.asin(b.clamp11(e));if(Math.abs(e)<l){x=Math.atan2(-h,f);y=Math.atan2(-i,m);}else{y=Math.atan2(d,k);}break;case 9:z=Math.asin(-b.clamp11(c));if(Math.abs(c)<l){x=Math.atan2(j,f);y=Math.atan2(d,m);}else{x=Math.atan2(-h,k);}break;default:}var v=[x,y,z,o];return v;};b.neutralQuatToGlMatrixQuat=function(v){return g.quat.fromValues(v[0],v[1],v[2],v[3]);};b.glMatrixQuatToNeutral=function(v){return[v[0],v[1],v[2],v[3]];};b.getModulatedAngularValue=function(o){return o-o%(2*Math.PI);};b.equalMatrices=function(m,c,e){for(var d=0;d<m.elements.length;d++){if(Math.abs(m.elements[d]-c.elements[d])>e){return false;}}return true;};b.interpolate=(function(){var c=g.quat;var v=g.vec3;var d=c.create();var e=c.create();var f=v.create();return function(h,i,j,k,l,m,n){var o=i.value;var p=j.value;var s={};var u;var w;var q;var x=0.0001;switch(h){case a.Quaternion:u=b.neutralQuatToGlMatrixQuat(o);w=b.neutralQuatToGlMatrixQuat(p);q=g.quat.slerp(g.quat.create(),u,w,k);if(n!=null){q=g.quat.multiply(g.quat.create(),q,g.quat.invert(g.quat.create(),b.neutralQuatToGlMatrixQuat(n)));}s.value=b.glMatrixQuatToNeutral(q);break;case a.Euler:var r=[b.interpolateScalarLinear(o[0],p[0],k),b.interpolateScalarLinear(o[1],p[1],k),b.interpolateScalarLinear(o[2],p[2],k),o[3]];if(n!=null){r[0]-=n[0];r[1]-=n[1];r[2]-=n[2];}s[a.Euler]=r;q=b.neutralEulerToGlMatrixQuat(r);s.value=b.glMatrixQuatToNeutral(q);break;case a.AngleAxis:var y;var z;var B;var C;var D;var E;var F;c.identity(d);if(n===true){for(z=l.getKeysCount()-1;z>=0;z--){y=l.getKey(z);if(y===j){break;}c.setAxisAngle(e,v.copy(f,y.value),-y.value[3]);c.multiply(d,e,d);}C=p[0];D=p[1];E=p[2];F=(k-1)*p[3];}else{for(z=0,B=l.getKeysCount();z<B;z++){y=l.getKey(z);if(y===j){break;}c.setAxisAngle(e,v.copy(f,y.value),y.value[3]);c.multiply(d,e,d);}C=p[0];D=p[1];E=p[2];F=k*p[3];}s[a.AngleAxis]=[C,D,E,F];c.setAxisAngle(e,v.set(f,C,D,E),F);c.multiply(d,e,d);s.value=b.glMatrixQuatToNeutral(d);break;case a.Vector3:s.value=[b.interpolateScalarLinear(o[0],p[0],k),b.interpolateScalarLinear(o[1],p[1],k),b.interpolateScalarLinear(o[2],p[2],k)];if(n!=null){switch(m){case A.Translate:s.value[0]-=n[0];s.value[1]-=n[1];s.value[2]-=n[2];break;case A.Scale:if(Math.abs(n[0])<x||Math.abs(n[1])<x||Math.abs(n[2])<x){L.error("The scale factor for reverse relative animation is too small","["+n[0]+", "+n[1]+", "+n[2]+"]",t);}else{s.value[0]/=n[0];s.value[1]/=n[1];s.value[2]/=n[2];}break;default:break;}}break;default:s.value=b.interpolateScalarLinear(o,p,k);if(n!=null){switch(m){case A.Opacity:if(Math.abs(n)<x){L.warning("The opacity factor for reverse relative animation is too small","["+n+"]",t);}else{s.value/=n;}break;default:break;}}break;}return s;};})();b.interpolateScalarLinear=function(v,c,k){return v+k*(c-v);};b.cartesianToPolar=function(c){var r={azimuth:0,elevation:0,radius:1};if(Array.isArray(c)&&c.length===3){var x=c[0];var y=c[1];var z=c[2];var l=x*x+z*z;if(l>0){r.azimuth=Math.acos(z/Math.sqrt(l))*(x<0?-1:1);}r.radius=Math.sqrt(x*x+y*y+z*z);if(r.radius>0){r.elevation=Math.asin(y/r.radius);}}return r;};b.polarToCartesian=function(p){var r=[0,0,1];var c="radius"in p?p.radius:1.0;r[0]=c*Math.cos(p.elevation)*Math.sin(p.azimuth);r[1]=c*Math.sin(p.elevation);r[2]=c*Math.cos(p.elevation)*Math.cos(p.azimuth);return r;};b.cartesianToPolar=function(c){var r={azimuth:0,elevation:0,radius:1};if(Array.isArray(c)&&c.length===3){var x=c[0];var y=c[1];var z=c[2];var l=x*x+z*z;if(l>0){r.azimuth=Math.acos(z/Math.sqrt(l))*(x<0?-1:1);}r.radius=Math.sqrt(x*x+y*y+z*z);if(r.radius>0){r.elevation=Math.asin(y/r.radius);}}return r;};b.polarToCartesian=function(p){var r=[0,0,1];var c="radius"in p?p.radius:1.0;r[0]=c*Math.cos(p.elevation)*Math.sin(p.azimuth);r[1]=c*Math.sin(p.elevation);r[2]=c*Math.cos(p.elevation)*Math.cos(p.azimuth);return r;};return b;});
