/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/Element","./Core","./Scene"],function(E,v,S){"use strict";var V=E.extend("sap.ui.vk.ViewManager",{metadata:{interfaces:["sap.ui.vk.IViewManager"],properties:{autoPlayAnimation:{type:"boolean",defaultValue:true},autoAdvanceViewTimeout:{type:"int",defaultValue:1000}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"},animationPlayer:{type:"sap.ui.vk.AnimationPlayer"}}},constructor:function(i,s){E.apply(this,arguments);v.observeLifetime(this);v.observeAssociations(this);}});V.prototype._setScene=function(s){if(this._scene!==s){this._scene=s;if(this._scene){var i=s.getInitialView();if(i){this.activateView(i);}}}return this;};V.prototype.getScene=function(){return this._scene;};V.prototype.getActiveView=function(){return this._activeView;};V.prototype.getNextView=function(a,b){var s=this.getScene();if(!b){b=s.findViewGroupByView(a);}var c;var i=-1;if(!b){c=s.getViews();i=c.indexOf(a);}else{c=b.getViews();i=b.indexOfView(a);}if(i<0){return undefined;}else if(i>=c.length-1){return undefined;}i++;return c[i];};V.prototype._setContent=function(c){var s=null;if(c&&c instanceof S){s=c;}this._setScene(s);};V.prototype.onSetContentConnector=function(c){c.attachContentReplaced(this._onContentReplaced,this);this._setContent(c.getContent());};V.prototype.onUnsetContentConnector=function(c){this._setContent(null);c.detachContentReplaced(this._onContentReplaced,this);};V.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"));};V.prototype.activateView=function(a,n){return this._activateView(a,null,!this.getAutoPlayAnimation(),false,n);};V.prototype.playViewGroup=function(a,b){this._cancelPlayingViewGroup=false;if(a===this.getActiveView()){var c=sap.ui.getCore().byId(this.getAnimationPlayer());if(c){if(c.getTime()>=c.getTotalDuration()){c.setTime(0);}}return this._autoPlay(a,b,false,true);}this._activateView(a,b,false,true);return this;};V.prototype.stopPlayingViewGroup=function(){this._cancelPlayingViewGroup=true;var a=sap.ui.getCore().byId(this.getAnimationPlayer());if(a){a.stop();}};V.prototype._autoPlay=function(a,b,s,c){var e=v.getEventBus();var d=sap.ui.getCore().byId(this.getAnimationPlayer());var f=function(){if(this._cancelPlayingViewGroup){return;}var n=this.getNextView(a,b);if(n){this._activateView(n,b,s,c);}else{e.publish("sap.ui.vk","procedureFinished");}}.bind(this);var o=function(h,i,j){if(j.source!==d){return;}if(j.stopped){e.unsubscribe("sap.ui.vk","animationPlayStateChanged",o,this);if(j.endOfAnimation){f();}}};var g=function(){if(c){if(d&&a.hasAnimation()){e.subscribe("sap.ui.vk","animationPlayStateChanged",o,this);}else{setTimeout(function(){f();},this.getAutoAdvanceViewTimeout());}}if((!s||c)&&a.hasAnimation()){if(d){d.play();}else{}}}.bind(this);g();};V.prototype._activateView=function(a,b,s,c,n){var d=sap.ui.getCore().byId(this.getAnimationPlayer());if(d){d.stop();}this._cancelPlayingViewGroup=false;var t=this;return new Promise(function(r,e){var f=v.getEventBus();t._activeView=a;var o=function(g,h,i){f.unsubscribe("sap.ui.vk","readyForAnimation",o,t);if(i.view!==a){return;}if(t._cancelPlayingViewGroup){return;}t._autoPlay(a,b,s,c,true);r({view:i.view});return;};f.subscribe("sap.ui.vk","readyForAnimation",o,t);f.publish("sap.ui.vk","activateView",{source:t,view:a,notAnimateCameraChange:n,playViewGroup:c});});};return V;});
