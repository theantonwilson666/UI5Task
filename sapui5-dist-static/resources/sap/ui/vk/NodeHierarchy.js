/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/ManagedObject","./Messages","./getResourceBundle","sap/base/util/array/uniqueSort","sap/base/Log"],function(M,a,g,u,L){"use strict";var N=M.extend("sap.ui.vk.NodeHierarchy",{metadata:{"abstract":true,events:{changed:{},nodeCreated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeRemoving:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeReplaced:{parameters:{ReplacedNodeRef:{type:"any"},ReplacementNodeRef:{type:"any"},ReplacedNodeId:{type:"string"},ReplacementNodeId:{type:"string"}}},nodeUpdated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}}}}});N.prototype.findNodesById=function(q){if(q.fields.some(function(e){return!e.caseSensitive;})){q=jQuery.extend(true,{},q);q.fields.forEach(function(e){if(!e.caseSensitive){e.value=e.value.toLowerCase();}});}var c=function(p,e,v,h){var m;p=p||"equals";h=h||"";var j=e?v:v.toLowerCase();switch(p){case"equals":m=(j===h);break;case"contains":m=(j.indexOf(h)!==-1);break;case"startsWith":m=(j.indexOf(h)===0);break;default:m=false;L.error(g().getText(a.VIT8.summary),a.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy");}return m;};var i=function(l,e){return!l.some(function(v){return e.name===v.name?c(e.predicate,e.caseSensitive,v.value,e.value):false;});};var f=function(q,v){return q.source===v.source&&q.type===v.type&&!q.fields.some(i.bind(undefined,v.fields));};var b=this.findNodesByName();var d=b.filter(function(n){var e=this.createNodeProxy(n);var v=e.getVeIds();this.destroyNodeProxy(e);return v.some(f.bind(undefined,q));}.bind(this));return d;};N.prototype.findNodesByMetadata=function(q){var c=function(m,j,k,v,h,i){if(m&&m.hasOwnProperty(j)){var l=m[j];if(l.hasOwnProperty(k)){var n=l[k];if(!i){n=n.toLowerCase();}return v.some(h.bind(undefined,n));}}return false;};var b=function(m,j){return m&&m.hasOwnProperty(j);};var d=function(e,f,j,k,v,h,i){var n=this._baseNodeProxyPool.borrowObject();var r=e.filter(function(l){n.init(this,l);var m=n.getNodeMetadata();var o=f(m,j,k,v,h,i);n.reset();return o;}.bind(this));this._baseNodeProxyPool.returnObject(n);return r;};var e=this.findNodesByName(),r=[];if(q===undefined||q===null||jQuery.isEmptyObject(q)){r=e;}else if(q.category!==null&&q.category!==undefined&&q.category!==""){var f,v,p,h,i=!!(q&&q.caseSensitive);if(q.key===undefined||q.key===null){f=b;}else{v=q.value;p=q.predicate||"equals";if(v===undefined||v===null){v="";p="contains";}if(!Array.isArray(v)){v=[v];}if(!i){v=v.map(function(j){return j.toLowerCase();});}switch(p){case"equals":h=function(m,j){return m===j;};break;case"contains":h=function(m,j){return m.indexOf(j)!==-1;};break;case"startsWith":h=function(m,j){return m.indexOf(j)===0;};break;default:L.error(g().getText(a.VIT9.summary),a.VIT9.code,"sap.ui.vk.dvl.NodeHierarchy");}f=c;}r=d.bind(this)(e,f,q.category,q.key,v,h,i);}else{L.error(g().getText(a.VIT10.summary),a.VIT10.code,"sap.ui.vk.dvl.NodeHierarchy");}return u(r);};N.prototype._appendAncestors=function(n,s){s=s?new Set(s):null;var b=new Set(n);n.forEach(function(d){var e=this.getAncestors(d);e.forEach(function(f){if(s===null||!s.has(f)){b.add(f);}});},this);var c=[];b.forEach(function(d){c.push(d);});return c;};return N;});
