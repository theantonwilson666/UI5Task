/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/integration/util/DataProvider","jquery.sap.global","sap/base/Log"],function(D,q,L){"use strict";var m=["no-cors","same-origin","cors"];var M=["GET","POST"];var R=D.extend("sap.ui.integration.util.RequestDataProvider",{metadata:{properties:{allowCustomDataType:{type:"boolean",defaultValue:false}}}});R.prototype.getData=function(){var r=this.getSettings().request;if(this._oDestinations){return this._oDestinations.process(r).then(this._fetch.bind(this));}return this._fetch(r);};R.prototype._isValidRequest=function(r){if(!r){return false;}if(m.indexOf(r.mode)===-1){return false;}if(M.indexOf(r.method)===-1){return false;}if(typeof r.url!=="string"){return false;}return true;};R.prototype._fetch=function(r){var s="Invalid request";return new Promise(function(a,b){if(!r||!r.url){L.error(s);b(s);return;}if(!this.getAllowCustomDataType()&&r.dataType){L.error("To specify dataType property in the Request Configuration, first set allowCustomDataType to 'true'.");}var d=r.parameters,c=this.getCardInstance(),u=r.url;if(c&&!u.startsWith("/")){u=c.getRuntimeUrl(r.url);}if(this._hasHeader(r,"Content-Type","application/json")){d=JSON.stringify(r.parameters);}var o={"mode":r.mode||"cors","url":u,"method":(r.method&&r.method.toUpperCase())||"GET","dataType":(this.getAllowCustomDataType()&&r.dataType)||"json","data":d,"headers":r.headers,"timeout":15000,"xhrFields":{"withCredentials":!!r.withCredentials}};if(this._isValidRequest(o)){q.ajax(o).done(function(e){a(e);}).fail(function(j,t,e){b(e);});}else{L.error(s);b(s);}}.bind(this));};R.prototype._hasHeader=function(r,h,v){if(!r.headers){return false;}for(var k in r.headers){if(k.toLowerCase()===h.toLowerCase()&&r.headers[k]===v){return true;}}return false;};return R;});
