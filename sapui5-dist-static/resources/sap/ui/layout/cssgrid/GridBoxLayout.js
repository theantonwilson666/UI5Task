/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/dom/units/Rem","sap/ui/layout/cssgrid/GridLayoutBase","sap/ui/layout/cssgrid/GridSettings","sap/ui/layout/cssgrid/GridBoxLayoutStyleHelper","sap/ui/Device","sap/ui/thirdparty/jquery"],function(R,G,a,b,D,q){"use strict";var S=/^([X][L](?:[1-9]|1[0-2]))? ?([L](?:[1-9]|1[0-2]))? ?([M](?:[1-9]|1[0-2]))? ?([S](?:[1-9]|1[0-2]))?$/i;var c=S.exec("XL7 L6 M4 S2");var s={"Phone":"sapUiLayoutCSSGridBoxLayoutSizeS","Tablet":"sapUiLayoutCSSGridBoxLayoutSizeM","Desktop":"sapUiLayoutCSSGridBoxLayoutSizeL","LargeDesktop":"sapUiLayoutCSSGridBoxLayoutSizeXL"};var d={"XL":"sapUiLayoutCSSGridBoxLayoutSpanXL7","L":"sapUiLayoutCSSGridBoxLayoutSpanL6","M":"sapUiLayoutCSSGridBoxLayoutSpanM4","S":"sapUiLayoutCSSGridBoxLayoutSpanS2"};var e="0.5rem";var f=G.extend("sap.ui.layout.cssgrid.GridBoxLayout",{metadata:{library:"sap.ui.layout",properties:{boxMinWidth:{type:"sap.ui.core.CSSSize",defaultValue:""},boxWidth:{type:"sap.ui.core.CSSSize",defaultValue:""},boxesPerRowConfig:{type:"sap.ui.layout.BoxesPerRowConfig",group:"Behavior",defaultValue:"XL7 L6 M4 S2"}}}});f.prototype.getActiveGridSettings=function(){return new a({gridTemplateColumns:this._getTemplateColumns(),gridGap:e+" "+e});};f.prototype.hasGridPolyfill=function(){return true;};f.prototype.getPolyfillSizes=function(g){var I=g.getItems(),B=I.find(function(o){return!o.isA("sap.m.GroupHeaderListItem");}),h=g.$().width(),j=B.$().outerWidth(),C=Math.floor(h/j),k=[],i=0;while(i<I.length){k.push(I[i].$().outerHeight()+"px");if(I[i].isA("sap.m.GroupHeaderListItem")){i+=1;}else{i+=C;}}return{gap:R.toPx(e),rows:k,columns:new Array(C).fill(j+"px")};};f.prototype._applySingleGridLayout=function(E){if(this.isGridSupportedByBrowser()){G.prototype._applySingleGridLayout.call(this,E);}};f.prototype.renderSingleGridLayout=function(r){this._addSpanClasses(r);if(this.isGridSupportedByBrowser()){r.class("sapUiLayoutCSSGridBoxLayoutContainer");}else{r.class("sapUiLayoutCSSGridBoxLayoutPolyfill");}};f.prototype.onGridAfterRendering=function(g){G.prototype.onGridAfterRendering.call(this,g);if(!this._hasBoxWidth()){this._applySizeClass(g);}if(!this.isGridSupportedByBrowser()){this._calcWidth(g);this._flattenHeight(g);if(!this._hasBoxWidth()){this._applyClassForLastItem(g);}}if(g.isA("sap.f.GridList")&&g.getGrowing()){var C=g._oGrowingDelegate._onAfterPageLoaded;g._oGrowingDelegate._onAfterPageLoaded=function(){C.call(g._oGrowingDelegate);if(!this.isGridSupportedByBrowser()){this._flattenHeight(g);this._calcWidth(g);this._loopOverGridItems(g,function(o){if(!o.classList.contains("sapMGHLI")&&!o.classList.contains("sapUiBlockLayerTabbable")){o.classList.add("sapUiLayoutCSSGridItem");}});if(!this._hasBoxWidth()){this._applyClassForLastItem(g);}}else if(g.isA("sap.f.GridList")&&g.isGrouped()){this._flattenHeight(g);}}.bind(this);}if(!this.isGridSupportedByBrowser()&&!this._dndPolyfillAttached){g.attachEvent("_gridPolyfillAfterDragOver",g,this._polyfillAfterDragOver,this);g.attachEvent("_gridPolyfillAfterDragEnd",g,this._polyfillAfterDragEnd,this);this._dndPolyfillAttached=true;}};f.prototype._setGridLayout=function(E,g){var o=sap.ui.getCore().byId(E.parentElement.id);G.prototype._setGridLayout.call(this,E,g);if(this.isGridSupportedByBrowser()&&(o&&o.isA("sap.f.GridList")&&o.isGrouped())){this._flattenHeight(o);}};f.prototype.isResponsive=function(){return true;};f.prototype.onGridResize=function(E){if(!this.isGridSupportedByBrowser()||(E.control&&E.control.isA("sap.f.GridList")&&E.control.isGrouped())){this._flattenHeight(E.control);}if(!this.isGridSupportedByBrowser()&&!this._hasBoxWidth()){this._applyClassForLastItem(E.control);}if(E){if(!this._hasBoxWidth()){this._applySizeClass(E.control);}}};f.prototype._calcWidth=function(C){var w;if(this._hasBoxWidth()){w=this.getBoxWidth()||this.getBoxMinWidth();}this._loopOverGridItems(C,function(g){if(!g.classList.contains("sapMGHLI")){g.style.width=w;}});};f.prototype._flattenHeight=function(C){var m=0;C.$().removeClass('sapUiLayoutCSSGridBoxLayoutFlattenHeight');this._loopOverGridItems(C,function(g){m=Math.max(q(g).outerHeight(),m);});b.setItemHeight(C.getId(),m);C.$().addClass('sapUiLayoutCSSGridBoxLayoutFlattenHeight');};f.prototype._applyClassForLastItem=function(C){var i=0;var B=this.getBoxesPerRowConfig().split(" ");var r=D.media.getCurrentRange("StdExt",C.$().width());var g=s[r.name].substring("sapUiLayoutCSSGridBoxLayoutSize".length);var m;B.forEach(function(h){if(h.indexOf(g)!=-1){m=parseInt(h.substring(g.length));}});this._loopOverGridItems(C,function(o){if(o.classList.contains("sapUiLayoutCSSGridItem")){i++;if(i==m){o.classList.add("sapUiLayoutCSSGridItemLastOnRow");i=0;}else{o.classList.remove("sapUiLayoutCSSGridItemLastOnRow");}}else if(o.classList.contains("sapMGHLI")){i=0;}});};f.prototype._applySizeClass=function(C){var r=D.media.getCurrentRange("StdExt",C.$().width()),g=s[r.name];C.getGridDomRefs().forEach(function(o){if(!o.classList.contains(g)){Object.keys(s).map(function(h){o.classList.remove(s[h]);});o.classList.add(g);}});};f.prototype._getTemplateColumns=function(){var t="";if(this.getBoxWidth()){t="repeat(auto-fit, "+this.getBoxWidth()+")";}else if(this.getBoxMinWidth()){t="repeat(auto-fit, minmax("+this.getBoxMinWidth()+", 1fr))";}return t;};f.prototype._hasBoxWidth=function(){if(this.getBoxWidth()||this.getBoxMinWidth()){return true;}else{return false;}};f.prototype._addSpanClasses=function(r){var g,h=this.getBoxesPerRowConfig(),j,k,l,m;if(this._hasBoxWidth()){return;}if(!h||!h.length===0){g=c;}else{g=S.exec(h);}if(g){for(var i=1;i<g.length;i++){var n=g[i];if(!n){continue;}n=n.toUpperCase();switch(n.substr(0,1)){case"X":if(n.substr(1,1)==="L"){j=this._getBoxesPerRowClass(n,2);}break;case"L":k=this._getBoxesPerRowClass(n,1);break;case"M":l=this._getBoxesPerRowClass(n,1);break;case"S":m=this._getBoxesPerRowClass(n,1);break;default:break;}}}j=j||d.XL;k=k||d.L;l=l||d.M;m=m||d.S;r.class(j).class(k).class(l).class(m);};f.prototype._getBoxesPerRowClass=function(g,i){var h=parseInt(g.substr(i,g.length));if(h&&h>0&&h<13){return"sapUiLayoutCSSGridBoxLayoutSpan"+g;}};f.prototype._loopOverGridItems=function(C,g){C.getGridDomRefs().forEach(function(o){if(o&&o.children){for(var i=0;i<o.children.length;i++){if(o.children[i].style.display!=="none"&&o.children[i].style.visibility!=="hidden"){g(o.children[i]);}}}});};f.prototype._polyfillAfterDragOver=function(E,g){E.getParameter("indicator").addClass("sapUiLayoutCSSGridItem");this._calcWidth(g);this._flattenHeight(g);this._applyClassForLastItem(g);};f.prototype._polyfillAfterDragEnd=function(E,g){E.getParameter("indicator").removeClass("sapUiLayoutCSSGridItem");this._applyClassForLastItem(g);};return f;});
