/*!
 * SAPUI5

(c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/thirdparty/jquery",'sap/ui/core/Control','./library','sap/ui/core/IconPool','sap/ui/core/Item','sap/ui/core/Core','sap/ui/richtexteditor/RTESplitButton',"sap/base/security/URLListValidator","sap/base/Log","./ToolbarWrapperRenderer"],function(q,C,l,I,a,b,R,U,L){"use strict";var T=C.extend("sap.ui.richtexteditor.ToolbarWrapper",{metadata:{interfaces:["sap.ui.richtexteditor.IToolbar"],library:"sap.ui.richtexteditor",aggregations:{_toolbar:{type:"sap.m.OverflowToolbar",multiple:false,visibility:"hidden"},_customInsertImageDialog:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_customInsertLinkDialog:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_customTextColorDialog:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_customBackgroundColorDialog:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_customInsertTableDialog:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{editor:{type:"sap.ui.richtexteditor.RichTextEditor",multiple:false}}}});T.prototype.init=function(){this._helper=l.RichTextEditorHelper;this._oResourceBundle=b.getLibraryResourceBundle("sap.ui.richtexteditor");this._oAccessibilityTexts={};this._sTextColor=l.EditorCommands.TextColor.defaultValue;this._sBackgroundColor=l.EditorCommands.BackgroundColor.defaultValue;};T.prototype.onBeforeRendering=function(){if(!this.getAggregation("_toolbar")){var t=this._createCustomToolbar(),e=this.getEditor();if(e){t.setEnabled(e.getEditable());}t.addStyleClass("sapUiRTECustomToolbar");this.setAggregation("_toolbar",t);this.setAggregation("_customInsertImageDialog",this._helper.createDialog(this._createInsertImageConfig("InsertImage")));this.setAggregation("_customInsertLinkDialog",this._helper.createDialog(this._createInsertLinkConfig("InsertLink")));this.setAggregation("_customTextColorDialog",this._helper.createColorPalettePopover(this._createColorPalettePopoverConfig("TextColor")));this.setAggregation("_customBackgroundColorDialog",this._helper.createColorPalettePopover(this._createColorPalettePopoverConfig("BackgroundColor")));this.setAggregation("_customInsertTableDialog",this._helper.createDialog(this._createInsertTableConfig("InsertTable")));}};T.prototype.onAfterRendering=function(){var e=this.getEditor();this._initialButtonGroupsState=e&&e.getButtonGroups().map(function(o){return q.extend(true,{},o);});this._syncPopoverOpeningArrows();this._syncColors("TextColor",this._sTextColor);this._syncColors("BackgroundColor",this._sBackgroundColor);};T.prototype.exit=function(){for(var g in this._oAccessibilityTexts){this._destroyAssociatedInvisibleTexts(g);}this._customButtons=null;this._oAccessibilityTexts=null;};T.prototype._syncPopoverOpeningArrows=function(){var f=this._findGroupedControls("font"),t=f[2]&&f[2]._getArrowButton(),B=f[3]&&f[3]._getArrowButton();this.getAggregation("_customTextColorDialog")._ensurePopover().attachAfterOpen(function(){t._activeButton();}).attachAfterClose(function(){t._inactiveButton();});this.getAggregation("_customBackgroundColorDialog")._ensurePopover().attachAfterOpen(function(){B._activeButton();}).attachAfterClose(function(){B._inactiveButton();});};T.prototype._getId=function(e){this._getId.counter=this._getId.counter?this._getId.counter+1:1;var r=this.getEditor()?this.getEditor().getId():"_rte"+this._getId.counter,t=this.getId(),B=[r+t];if(e||e===0){B.push(e);}return B.join("-");};T.prototype.getEditor=function(){var i=this.getAssociation("editor"),e=b.byId(i);return e||null;};T.prototype.modifyRTEToolbarConfig=function(c){var t=this;var s=c.directionality==="rtl"?"JustifyRight":"JustifyLeft";c.toolbar=false;c.setup=function(e){e.on('init',function(){var E=l.EditorCommands;e.execCommand("FormatBlock",false,E["FormatBlock"]["Paragraph"].commandValue,{skip_focus:true});e.execCommand(s,false,null,{skip_focus:true});e.execCommand("FontName",false,E["FontFamily"]["Verdana"].commandValue,{skip_focus:true});e.execCommand("FontSize",false,"10pt",{skip_focus:true});});e.on('NodeChange',function(){t._syncToolbarStates(this);});};return c;};T.prototype._applyColor=function(c,s,d,D){if(D||this._getColor(c).replace(/,\s/g,',')!==d){this.getEditor().getNativeApi().execCommand(s,false,d);}};T.prototype._syncColors=function(c,s){var d=this._findGroupedControls("font"),t;if(!s){return;}switch(c){case"TextColor":d[2]&&d[2].setIconColor(s);break;case"BackgroundColor":t=d[3]&&d[3]._getTextButton().getDomRef("img");t&&b.byId(t.id).setColor(s);break;}};T.prototype._syncToolbarStates=function(n){var e,c,E,o=l.EditorCommands,f=n.formatter,_=function(t,k,c){var A,m;for(A in t){m=I.getIconURI(e[A].icon);if(t.hasOwnProperty(A)&&k.match(t[A].style)&&c.getIcon()!==m){c.setIcon(m);break;}}},d=function(k,F,c){var m,j,p,r=k.getDoc().queryCommandValue("FormatBlock");for(m in F){if(!F.hasOwnProperty(m)){continue;}j=c.getId()+m;p=F[m];if((c.getSelectedItemId()!==j)&&((r===p.commandValue)||(r===p.text))){c.setSelectedItemId(j);break;}}},g=function(k,F,c){var m,s,t,j,p=k.getDoc().queryCommandValue("FontName");for(m in F){if(!F.hasOwnProperty(m)){continue;}j=c.getId()+m;s=F[m].commandValue.match(/\w+/g).join("").toLowerCase();p=p&&p.match(/\w+/g).join("").toLowerCase();t=F[m].text.match(/\w+/g).join("").toLowerCase();if((c.getSelectedItemId()!==j)&&(s===p||p===t)){c.setSelectedItemId(j);break;}}},h=function(k,c){var S=k.selection.getNode(),m=S&&S.tagName.toLowerCase()==="img"||(S.parentElement&&S.parentElement.tagName.toLowerCase()==="img");c.setPressed(!!m);},i=function(k,c,t){var S=k.selection.getNode(),m=S&&S.tagName.toLowerCase()==="a"||(S.parentElement&&S.parentElement.tagName.toLowerCase()==="a");if(t){c.setPressed(!!m);}else{c.setEnabled(!!m);}};for(E in o){if(!o.hasOwnProperty(E)){continue;}e=o[E];c=b.byId(this._getId(E));if(!c){continue;}switch(E){case"TextAlign":_(e,f,c);break;case"FontFamily":g(n,e,c);break;case"FormatBlock":d(n,e,c);break;case"InsertImage":h(n,c);break;case"InsertLink":i(n,c,true);break;case"Unlink":i(n,c,false);break;case"FontSize":var s=n.getDoc().queryCommandValue(E),j=c.getId()+s;if(c.getSelectedItemId()!==j&&s){c.setSelectedItemId(j);}break;default:c.getMetadata().getName()==="sap.m.OverflowToolbarToggleButton"&&c.setPressed(f.match(e.style));}}};T.prototype._createButtonConfig=function(c){var e=l.EditorCommands,o=e[c],r=this.getEditor();return{id:this._getId(c),icon:I.getIconURI(o.icon),tooltip:this._oResourceBundle.getText(o.bundleKey),text:this._oResourceBundle.getText(o.bundleKey),press:function(){if(r){r.getNativeApi().execCommand(o.command);}else{L.warning("Cannot execute native command: "+o.command);}}};};T.prototype._createMenuButtonItems=function(c){var e=this._helper,E=l.EditorCommands,i=[],s,o;for(var d in E[c]){if(d==='bundleKey'){continue;}o=E[c][d];s=this._oResourceBundle.getText(o.bundleKey)||o.text;i.push(e.createMenuItem(this._getId(c+d),s,I.getIconURI(o.icon)));}return i;};T.prototype._findTextAlignCommandByIcon=function(i){var e=l.EditorCommands['TextAlign'],c,s;Object.keys(e).forEach(function(k){c=I.getIconURI(e[k].icon);if(k!=='bundleKey'&&c===i){s=k;}});return s;};T.prototype._createFontStyleSelectItems=function(){var e=l.EditorCommands,f=e["FontFamily"],i=[],o;for(var F in f){o={id:this._getId("FontFamily"+F),text:f[F].text};i.push(new a(o));}return i;};T.prototype._getFontStyleCommand=function(i){var e=l.EditorCommands,f=e["FontFamily"];for(var F in f){if(f.hasOwnProperty(F)&&f[F].text===i){return f[F].commandValue;}}};T.prototype._getFormatBlockCommand=function(i){var e=l.EditorCommands,f=e["FormatBlock"];for(var F in f){if(f.hasOwnProperty(F)&&this._oResourceBundle.getText(f[F].bundleKey)===i){return f[F].commandValue;}}};T.prototype._createFontSizeSelectItems=function(){var i=[],n=1,o,e=l.EditorCommands;e["FontSize"].forEach(function(c){o={id:this._getId("FontSize"+n),text:c+" pt"};i.push(new a(o));n++;},this);return i;};T.prototype._createFormatBlockItems=function(){var e=l.EditorCommands,f=e["FormatBlock"],i=[],o;for(var F in f){o={id:this._getId("FormatBlock"+F),text:this._oResourceBundle.getText(f[F].bundleKey)};i.push(new a(o));}return i;};T.prototype._getColor=function(c){var r=this.getEditor(),o=l.EditorCommands[c].style,n=r.getNativeApi().selection.getNode(),N=r.getNativeApi().dom.getParents(n),i,d,s;for(i=0;i<N.length;i++){d=N[i];s=d.style[o];if(s&&s!=""){return s;}}return l.EditorCommands[c].defaultValue;};T.prototype._createSplitButtonForDialog=function(c){var o=l.EditorCommands[c],t=this,d,r;if(!o){return;}r={id:this._getId(c),tooltip:this._oResourceBundle.getText(o.bundleKey),press:function(){switch(c){case"TextColor":t._applyColor(c,o.command,t._sTextColor);break;case"BackgroundColor":t._applyColor(c,o.command,t._sBackgroundColor);break;}},arrowPress:function(){d=t.getAggregation("_custom"+c+"Dialog");this._getArrowButton()._activeButton();if(!d){return;}d.openBy(this);}};if(c==="BackgroundColor"){r.icon=I.getIconURI(o.icon);}return r;};T.prototype._createButtonForDialog=function(c){var o=l.EditorCommands[c],t=this,d;if(!o){return;}return{id:this._getId(c),icon:I.getIconURI(o.icon),tooltip:this._oResourceBundle.getText(o.bundleKey),text:this._oResourceBundle.getText(o.bundleKey),press:function(){d=t.getAggregation("_custom"+c+"Dialog");if(!d){return;}switch(c){case"InsertImage":this.setPressed(true);t._syncImageDialogData(d);break;case"InsertLink":t._syncLinkDialogData(d);break;case"InsertTable":t._resetDialogContent(d);}d.open();}};};T.prototype._syncImageDialogData=function(d){var s=this.getEditor().getNativeApi().selection,S=s&&s.getNode(),D=d&&d.getContent(),o,h,w,c,u,e,W,H,f;if(!D.length){return;}o=D[6];f=D[5];if(f.getMetadata().getName()==="sap.m.HBox"&&f.getAggregation("items").length){h=f.getAggregation("items")[2];w=f.getAggregation("items")[0];}if(S.tagName.toLowerCase()==='img'){c=S;}else{c=S.parentElement;}if(c.tagName.toLowerCase()!=="img"){this._resetDialogContent(d);return;}if(!o.getEnabled()){o.setEnabled(true);}o.setSelected(c.getAttribute('data-sap-ui-rte-image-ratio')==='true'?true:false);u=c.getAttribute('src');e=c.getAttribute('alt');W=parseFloat(c.width);H=parseFloat(c.height);D[1].setValue(u);D[3].setValue(e);h.setValue(H);w.setValue(W);};T.prototype._syncLinkDialogData=function(d){var D=d&&d.getContent(),s,S,u,c,t,e,o,f,g;if(!(D instanceof Array)||!D.length){return;}s=this.getEditor().getNativeApi().selection;o=s.getNode();S=this._getSelectionAnchor(s);if(!S){S=o.parentElement;}f=s.getContent().length!==0&&S.textContent&&s.getContent().length<S.textContent.length&&S.tagName==="A";g=s.getContent().length!==0;if(!g||f){c=S.text;}else{c=(s.getNode()&&s.getNode().tagName.toLowerCase()==='a')?s.getNode().textContent:s.getContent({format:'text'});}u=S.getAttribute('href');t=S.getAttribute('title');e=S.getAttribute('target')==="true";D[1].setValue(u);D[3].setValue(c&&c.replace(/\uFEFF/g,""));D[5].setValue(t);D[6].getAggregation('items')[1].setSelectedIndex(e);};T.prototype._resetDialogContent=function(d){var c=d.findAggregatedObjects(true),s;c.forEach(function(o){s=o.getMetadata().getName();if(s==="sap.m.Input"){o.resetProperty('value');}else if(s==="sap.m.CheckBox"){o.resetProperty('selected').setEnabled(false);}});};T.prototype._createColorPalettePopoverConfig=function(t){var c=l.EditorCommands[t],s=c.defaultValue,o=this;return{defaultColor:s,colorSelect:function(e){var s=e.getParameters().value;o._applyColor(t,c.command,s,e.getParameter("defaultAction"));switch(t){case"TextColor":o._sTextColor=s;o._syncColors("TextColor",s);break;case"BackgroundColor":o._sBackgroundColor=s;o._syncColors("BackgroundColor",s);break;}}};};T.prototype._generateImageHTML=function(u,t,h,w,r){var s=u?' src="'+u+'"':'',A=t?' alt="'+t+'"':'',H=h?' height="'+h+'px"':'',W=w?' width="'+w+'px"':'',d=H+W,c=(r!==undefined)?' data-sap-ui-rte-image-ratio="'+r+'"':'';return'<img'+s+A+d+c+'>';};T.prototype._createInsertImageConfig=function(){var r,t=this._oResourceBundle.getText(sap.ui.richtexteditor.EditorCommands["InsertImage"].bundleKey),u=this._helper.createInput(),o=this._helper.createLabel({text:this._oResourceBundle.getText("INSERT_IMAGE_URL"),labelFor:u}),c=this._helper.createInput(),d=this._helper.createLabel({text:this._oResourceBundle.getText("INSERT_IMAGE_DESCRIPTION"),labelFor:c}),D=this._helper.createLabel({text:this._oResourceBundle.getText("INSERT_CONTENT_DIMENSIONS")}),e=this._helper.createInput({width:'8rem',fieldWidth:"6rem",description:'px',ariaLabelledBy:D,change:function(){m(false,true);}}),f=this._helper.createText({textAlign:"Center",width:'2rem',text:'x'}),g=this._helper.createInput({fieldWidth:"6rem",width:'8rem',description:'px',ariaLabelledBy:D,change:function(){m(true,false);}}),h=this._helper.createHBox({wrap:"Wrap",alignItems:"Center",justifyContent:"SpaceBetween",items:[e,f,g]}),i=this._helper.createCheckBox({select:function(){m(true,true);}}),j=this._helper.createLabel({text:this._oResourceBundle.getText("INSERT_IMAGE_RATIO"),labelFor:i}),k=this.getEditor(),m=function(p,s){var S=k.getNativeApi().selection,v=S&&S.getNode(),w=parseFloat(e.getValue()),H=parseFloat(g.getValue()),x,y;if(!i.getSelected()){return;}if(v.tagName.toLowerCase()!=='img'&&!(v.parentElement&&v.parentElement.tagName.toLowerCase()==="img")){return;}v=v.tagName.toLowerCase()==="img"?v:v.parentElement;x=parseFloat(v.width);y=parseFloat(v.height);r=x/y;if(p&&(H!==y||H!=g._lastValue)){e.setValue(H*r);}else if(s&&(w!==x||w!=e._lastValue)){g.setValue(w/r);}},n=this,B=[];D.setLabelFor(e);B.push(this._helper.createButton({id:this._getId("InsertImageButton"),text:this._oResourceBundle.getText("DIALOG_OK_BUTTON"),press:function(){k.getNativeApi().insertContent(n._generateImageHTML(u.getValue(),c.getValue(),g.getValue(),e.getValue(),i.getSelected()));n.getAggregation("_customInsertImageDialog").close();n._syncToolbarStates(k.getNativeApi());}}));B.push(this._helper.createButton({id:this._getId("CancelInsertImageButton"),text:this._oResourceBundle.getText("DIALOG_CANCEL_BUTTON"),press:function(){n.getAggregation("_customInsertImageDialog").close();n._syncToolbarStates(k.getNativeApi());}}));return{contentWidth:'320px',title:t,buttons:B,content:[o,u,d,c,D,h,i,j]};};T.prototype._getSelectionAnchor=function(s){var S,A;if(!s){return;}S=s.getNode();if(s.getStart().tagName=='A'){A=s.getStart();}else if(S.tagName=='A'){A=S;}return A;};T.prototype._generateLinkHTML=function(u,t,c,s){var d={href:u&&U.validate(u)?u:'',target:c?c:null,title:t&&U.validate(t)?t:''},n=this.getEditor().getNativeApi(),S=n.selection,e=false,A,f,g;A=this._getSelectionAnchor(S);if(u===""&&!A){return;}if(u===""&&A){n.execCommand("Unlink");return;}if(!A){f=n.dom.select('a[href="'+d.href+'"]');if(s!==""){n.insertContent(n.dom.createHTML('a',d,n.dom.encode(s)));e=true;}else{n.execCommand('mceInsertLink',false,d);e=true;}g=n.dom.select('a[href="'+d.href+'"]');A=g.filter(function(o){return f.indexOf(o)===-1;})[0];}if("innerText"in A){A.innerText=s!==""?s:u;}else{A.textContent=s!==""?s:u;}n.dom.setAttribs(A,d);n.selection.select(A);if(!e){n.fire("change");}};T.prototype._createInsertLinkConfig=function(){var t=this._oResourceBundle.getText(sap.ui.richtexteditor.EditorCommands["InsertLink"].bundleKey),u=this._helper.createInput(),o=this._helper.createLabel({text:this._oResourceBundle.getText("INSERT_LINK_URL"),labelFor:u}),c=this._helper.createInput(),d=this._helper.createLabel({text:this._oResourceBundle.getText("INSERT_LINK_DISPLAY_TEXT"),labelFor:c}),e=this._helper.createInput(),f=this._helper.createLabel({text:this._oResourceBundle.getText("INSERT_LINK_TITLE"),labelFor:e}),g=this._helper.createSelect({id:this._getId("InsertLinkSelect"),items:[new a({id:this._getId("InsertLinkSelectNone"),text:this._oResourceBundle.getText("INSERT_LINK_TARGET_NONE")}),new a({id:this._getId("InsertLinkSelectNewWindow"),text:this._oResourceBundle.getText("INSERT_LINK_TARGET_NEW_WINDOW")})]}),h=this._helper.createLabel({text:this._oResourceBundle.getText("INSERT_LINK_TARGET"),labelFor:g}),i=this._helper.createVBox({direction:"Column",alignItems:"Start",items:[h,g]}),r=this.getEditor(),j=this,B=[];B.push(this._helper.createButton({id:this._getId("InsertLinkButton"),text:this._oResourceBundle.getText("DIALOG_OK_BUTTON"),press:function(){var k=(g.getSelectedItem()===g.getItems()[1]);j._generateLinkHTML(u.getValue(),e.getValue(),k,c.getValue());j.getAggregation("_customInsertLinkDialog").close();j._syncToolbarStates(r.getNativeApi());}}));B.push(this._helper.createButton({id:this._getId("CancelInsertLinkButton"),text:this._oResourceBundle.getText("DIALOG_CANCEL_BUTTON"),press:function(){j.getAggregation("_customInsertLinkDialog").close();j._syncToolbarStates(r.getNativeApi());}}));return{contentWidth:'320px',title:t,buttons:B,content:[o,u,d,c,f,e,i]};};T.prototype._createInsertTableConfig=function(){var t=this._oResourceBundle.getText(sap.ui.richtexteditor.EditorCommands["InsertTable"].bundleKey),r=this._helper.createStepInput({value:2,min:0,width:"50%"}),o=this._helper.createLabel({text:this._oResourceBundle.getText("INSERT_TABLE_ROWS"),labelFor:r}),c=this._helper.createStepInput({value:2,min:0,width:"50%"}),d=this._helper.createLabel({text:this._oResourceBundle.getText("INSERT_TABLE_COLS"),labelFor:c}),D=this._helper.createLabel({text:this._oResourceBundle.getText("INSERT_CONTENT_DIMENSIONS")}),e=this._helper.createInput({width:'8rem',fieldWidth:"6rem",description:'px',ariaLabelledBy:D}),f=this._helper.createText({textAlign:"Center",width:'2rem',text:'x'}),g=this._helper.createInput({fieldWidth:"6rem",width:'8rem',description:'px',ariaLabelledBy:D}),h=this._helper.createHBox({wrap:"Wrap",alignItems:"Center",justifyContent:"SpaceBetween",items:[e,f,g]}),i=this.getEditor(),j=this,B=[];B.push(this._helper.createButton({id:this._getId("InsertTableButton"),text:this._oResourceBundle.getText("DIALOG_OK_BUTTON"),press:function(){var k=i.getNativeApi().plugins.table.insertTable(c.getValue(),r.getValue()),m=i.getNativeApi().dom;m.setStyle(k,'width',g.getValue()+"px");m.setStyle(k,'height',e.getValue()+"px");j.getAggregation("_customInsertTableDialog").close();}}));B.push(this._helper.createButton({id:this._getId("CancelInsertTableButton"),text:this._oResourceBundle.getText("DIALOG_CANCEL_BUTTON"),press:function(){j.getAggregation("_customInsertTableDialog").close();}}));return{title:t,buttons:B,content:this._helper.createVBox({direction:"Column",alignItems:"Start",items:[o,r,d,c,D,h]})};};T.prototype._createCustomToolbar=function(){var e=this._helper,c=[],B=l.ButtonGroups,g=Object.keys(B),G=[],d=this.getEditor()?this.getEditor().getButtonGroups():[];g.forEach(function(n){d.forEach(function(o){if(o.name===n){G.push(o);}});});G=this._sortToolbarContent(G);G.forEach(function(o){c=c.concat(this.addButtonGroup(o.name));}.bind(this));return e.createOverflowToolbar(this._getId(),c);};T.prototype.setToolbarEnabled=function(e,s){var t=this.getAggregation("_toolbar");if(t&&t.getEnabled()!==e){t.setEnabled(e,s);}};T.prototype.setShowGroup=function(g,s){var o=this._findGroupedControls(g),t=this.getAggregation("_toolbar");o.forEach(function(O){O.setVisible(s);});t&&t.rerender();};T.prototype.addButtonGroup=function(g){var r=this.getEditor(),e=this._helper,c=[],B=l.ButtonGroups,o=l.EditorCommands,A=l.Accessibility,v,V,d,f,h,i,j,k,m,t=this;switch(g){case"font-style":f=r?r.getShowGroupFontStyle():false;B["font-style"].forEach(function(z){c.push(e.createOverflowToolbarToggleButton(this._createButtonConfig(z)).setVisible(f));},this);break;case"font":d=r?r.getShowGroupFont():false;var n=e.createInvisibleText({text:this._oResourceBundle.getText(A["FontFamily"])}).toStatic(),p=e.createInvisibleText({text:this._oResourceBundle.getText(A["FontSize"])}).toStatic(),s=e.createInvisibleText({text:this._oResourceBundle.getText(A["FontColor"])}).toStatic(),u=e.createInvisibleText({text:this._oResourceBundle.getText(A["BackgroundColor"])}).toStatic();this._registerAssociatedInvisibleTexts("font",n.getId());this._registerAssociatedInvisibleTexts("font",p.getId());c.push(e.createSelect({id:this._getId("FontFamily"),ariaLabelledBy:n,items:this._createFontStyleSelectItems(),change:function(E){var z;if(r){z=E.getSource().getSelectedItem();r.getNativeApi().execCommand('FontName',false,this._getFontStyleCommand(z.getText()));}else{L.warning("Cannot execute native command: "+'FontName');}}.bind(this)}).setVisible(d));c.push(e.createSelect({id:this._getId("FontSize"),ariaLabelledBy:p,items:this._createFontSizeSelectItems(),change:function(E){var z;if(r){z=E.getSource().getSelectedItem();r.getNativeApi().execCommand('FontSize',false,z.getText().replace(/\s/g,""));}else{L.warning("Cannot execute native command: "+'FontSize');}}}).setVisible(d));var w=new R(this._createSplitButtonForDialog("TextColor")).setVisible(d),x=e.createSplitButton(this._createSplitButtonForDialog("BackgroundColor")).setVisible(d);w._getTextButton().addAriaLabelledBy(s);c.push(w);x._getTextButton().addAriaLabelledBy(u);c.push(x);break;case"text-align":i=r?r.getShowGroupTextAlign():false;var M=this._createMenuButtonItems("TextAlign");c.push(e.createMenuButton(this._getId("TextAlign"),M,function(E){var S,z,D;if(r){S=E.getParameter("item");z=r.getNativeApi();D=S.getIcon();if(D===this.getParent().getIcon()){z.execCommand('JustifyLeft');}else{z.execCommand('Justify'+t._findTextAlignCommandByIcon(D));}}else{L.warning("Cannot execute native command: "+'Justify');}},M[0].getIcon(),this._oResourceBundle.getText(o["TextAlign"].bundleKey)).setVisible(i));break;case"formatselect":j=r?(this._isButtonGroupAdded("styleselect")||this._isButtonGroupAdded("formatselect")):false;if(j){var y=e.createInvisibleText({text:this._oResourceBundle.getText(A["FormatBlock"])}).toStatic();this._registerAssociatedInvisibleTexts("formatselect",y.getId());c.push(e.createSelect({id:this._getId("FormatBlock"),ariaLabelledBy:y,items:this._createFormatBlockItems(),change:function(E){var S;if(r){S=E.getSource().getSelectedItem();if(S){var z=r.getAggregation("_toolbarWrapper")._getFormatBlockCommand(S.getText());r.getNativeApi().execCommand('FormatBlock',false,z);}}else{L.warning("Cannot execute native command: "+'FormatBlock');}}}).setVisible(j));}break;case"structure":V=r?r.getShowGroupStructure():false;B["structure"].forEach(function(z){c.push(e.createOverflowToolbarButton(this._createButtonConfig(z)).setVisible(V));},this);break;case"clipboard":v=r?r.getShowGroupClipboard():false;B["clipboard"].forEach(function(z){c.push(e.createOverflowToolbarButton(this._createButtonConfig(z)).setVisible(v));},this);break;case"undo":h=r?r.getShowGroupUndo():false;B["undo"].forEach(function(z){c.push(e.createOverflowToolbarButton(this._createButtonConfig(z)).setVisible(h));},this);break;case"insert":m=r?r.getShowGroupInsert():false;c.push(e.createOverflowToolbarToggleButton(this._createButtonForDialog("InsertImage")).setVisible(m));break;case"link":k=r?r.getShowGroupLink():false;c.push(e.createOverflowToolbarToggleButton(this._createButtonForDialog("InsertLink")).setVisible(k));c.push(e.createOverflowToolbarButton(this._createButtonConfig("Unlink")).setVisible(k));break;case"table":c.push(e.createOverflowToolbarButton(this._createButtonForDialog("InsertTable")));break;}return c;};T.prototype.addButtonGroupToContent=function(g,f){var G;if(!f&&g.buttons[0]==="table"){G=g.buttons[0];sap.ui.richtexteditor.ButtonGroups.custom[g.name]={name:g.buttons[0],controls:["InsertTable"]};}if(f&&g.name==="table"){G=g.name;sap.ui.richtexteditor.ButtonGroups[g.name]=["InsertTable"];}if(f&&(g.name==="formatselect"||g.name==="styleselect")){G="formatselect";sap.ui.richtexteditor.ButtonGroups[g.name]=["FormatBlock"];}if(!sap.ui.richtexteditor.ButtonGroups[g.name]&&!sap.ui.richtexteditor.ButtonGroups.custom[g.name]){return this;}if(!G){G=g.name;}var t=this.getAggregation("_toolbar"),c=this.addButtonGroup(G),d=c.length,i,s;s=this._findGroupPriorityPosition(g);c.reverse();for(i=0;i<d;i++){t.insertContent(c[i],s);}return this;};T.prototype._sortToolbarContent=function(g){g.sort(function(G,o){return G.customToolbarPriority-o.customToolbarPriority;});return g;};T.prototype._findGroupPriorityPosition=function(g){var G=this.getEditor().getButtonGroups(),c=l.ButtonGroups,s=0;if(!q.isNumeric(g.customToolbarPriority)){g.customToolbarPriority=this._getLastGroupPriority(G)+10;}G=this._sortToolbarContent(G);G.forEach(function(o){if(o.customToolbarPriority<g.customToolbarPriority&&o.name!==g.name){s+=c[o.name]?c[o.name].length:0;}});return s;};T.prototype._getLastGroupPriority=function(g){var p=g.map(function(G){return G.customToolbarPriority||0;});return Math.max.apply(null,p);};T.prototype.removeButtonGroup=function(g){var o=this._findGroupedControls(g);this._destroyAssociatedInvisibleTexts(g);o.forEach(function(O){O.destroy();});};T.prototype._destroyAssociatedInvisibleTexts=function(g){var i=this._oAccessibilityTexts[g]||[];i.forEach(function(s){b.byId(s).destroy();});this._oAccessibilityTexts[g]=[];};T.prototype._registerAssociatedInvisibleTexts=function(g,i){if(!this._oAccessibilityTexts[g]){this._oAccessibilityTexts[g]=[];}this._oAccessibilityTexts[g].push(i);};T.prototype.setButtonGroups=function(n){var t=this.getAggregation("_toolbar"),g=this._getGroupsForUpdate(n);if(!t){return this;}g.aRemovedGroups.forEach(function(G){this.removeButtonGroup(G.name);}.bind(this));g.aAddedGroups=this._sortToolbarContent(g.aAddedGroups);g.aAddedGroups.forEach(function(G){this.addButtonGroupToContent(G,true);}.bind(this));return this;};T.prototype._getJSONStringForGroups=function(g){var s=[];g.forEach(function(o){s.push(JSON.stringify(o,["name","visible","customToolbarPriority","buttons"]));});return s;};T.prototype._getGroupsForUpdate=function(n){var N=this._getJSONStringForGroups(n),o=this._getJSONStringForGroups(this._initialButtonGroupsState),g={aRemovedGroups:[],aAddedGroups:[]};N.forEach(function(G,i){if(o.indexOf(G)===-1){g.aAddedGroups.push(n[i]);}});o.forEach(function(G,i){if(N.indexOf(G)===-1){g.aRemovedGroups.push(this._initialButtonGroupsState[i]);}}.bind(this));return g;};T.prototype._findGroupedControls=function(g){var B=l.ButtonGroups,t=this.getAggregation("_toolbar"),c=[];if(!t){return[];}if(B[g]){c=B[g];}else if(B.custom[g]){c=B.custom[g].controls;}var i=c.map(function(n){return this._getId(n);},this);return t.findAggregatedObjects(false,function(A){return i.indexOf(A.getId())>-1;})||[];};T.prototype.modifyToolbarContent=function(m){var r,c=Array.prototype.slice.call(arguments);c.shift();switch(m){case"add":r=this._proxyToolbarAdd.apply(this,c);break;case"destroy":r=this._proxyToolbarDestroy.apply(this,c);break;case"get":r=this._proxyToolbarGet.apply(this,c);break;case"indexOf":r=this._proxyToolbarIndexOf.apply(this,c);break;case"insert":r=this._proxyToolbarInsert.apply(this,c);break;case"removeAll":r=this._proxyToolbarRemoveAll.apply(this,c);break;case"remove":r=this._proxyToolbarRemove.apply(this,c);break;}return r;};T.prototype._isButtonGroupAdded=function(g){var G=this.getEditor().getButtonGroups(),r=false,i;for(i=0;i<G.length;i++){if(G[i].name===g){r=true;break;}}return r;};T.prototype._updateCustomToolbarRefIds=function(i,c){var d,e;d=this._customButtons||[];e=d.indexOf(i);if(e>-1){d.splice(e,1);}if(c!==-1){c=c>=0&&c<=d.length?c:d.length;d.splice(c,0,i);}this._customButtons=d;};T.prototype._proxyToolbarAdd=function(i){var t=this.getAggregation("_toolbar"),r=t.addContent(i);t.rerender();if(r){this._updateCustomToolbarRefIds(i.getId());}return r;};T.prototype._proxyToolbarGet=function(){var t=this.getAggregation("_toolbar"),c=this._customButtons||[];return t.findAggregatedObjects(false,function(A){return c.indexOf(A.getId())>-1;})||[];};T.prototype._proxyToolbarDestroy=function(){var i=this._proxyToolbarGet();i.forEach(function(o){o.destroy();});this._customButtons=[];};T.prototype._proxyToolbarIndexOf=function(i){var c=this._customButtons||[],s=typeof i==="object"?i.getId():i;return c.indexOf(s);};T.prototype._proxyToolbarInsert=function(i,c){var r,t=this.getAggregation("_toolbar"),d=t.getContent()||[],e=this._customButtons||[],f=d.length-e.length;if(c<0){c=0;}else if(c>e.length){c=e.length;}else if(!c&&c!==0){c=e.length;}f+=c;r=t.insertContent(i,f);t.rerender();if(r){this._updateCustomToolbarRefIds(i.getId(),c);}return r;};T.prototype._proxyToolbarRemoveAll=function(){var i=this._proxyToolbarGet();i.forEach(this._proxyToolbarRemove,this);return i;};T.prototype._proxyToolbarRemove=function(i){var s,r,t=this.getAggregation("_toolbar");switch(typeof i){case"string":s=i;break;case"object":s=i.getId();break;case"number":s=this._customButtons[i];break;}r=t.removeContent(s);if(r&&s){this._updateCustomToolbarRefIds(s,-1);}return r;};return T;});
