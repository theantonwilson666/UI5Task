/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/apply/_internal/flexState/compVariants/CompVariantMerger","sap/ui/fl/apply/_internal/ChangesController","sap/ui/fl/Change","sap/ui/fl/registry/Settings","sap/ui/fl/Utils","sap/ui/fl/LayerUtils"],function(F,M,C,a,b,S,U,L){"use strict";function g(o){return o&&o.getPersistencyKey&&o.getPersistencyKey();}function c(o,v){var r=M.getFlexReferenceForControl(o);var p=g(o);var m=F.getCompVariantsMap(r);return m._getOrCreate(p,v);}function d(p){var r=M.getFlexReferenceForControl(p.control);return F.initialize({reference:r,componentData:{},manifest:U.getAppDescriptor(p.control),componentId:U.getAppComponentForControl(p.control).getId()}).then(c.bind(undefined,p.control));}var e={loadVariants:function(p){return d(p).then(function(m){var P=g(p.control);return C.merge(P,m,p.standardVariant,p.variants);});},getEntityById:function(p){var r=M.getFlexReferenceForControl(p.control);return F.getCompEntitiesByIdMap(r)[p.id];},isApplicationVariant:function(p){var o=p.control;if(U.isApplicationVariant(o)){return true;}var f=U.getComponentForControl(o);if(f&&f.getAppComponent){f=f.getAppComponent();if(f){return true;}}return false;},isVendorLayer:function(){return L.isVendorLayer();},isVariantDownport:function(){return e.isVendorLayer()&&U.isHotfixMode();},getDefaultVariantId:function(p){var o=c(p.control).defaultVariant;return o?o.getContent().defaultVariantName:"";},getExecuteOnSelect:function(p){var o=c(p.control).standardVariant;return o?o.getContent().executeOnSelect:null;},getChangeById:function(p){return e.getEntityById(p);},_getChangeMap:function(o){var r=M.getFlexReferenceForControl(o);var p=g(o);var m=F.getCompEntitiesByIdMap(r);var f={};Object.keys(m).forEach(function(i){if(m[i].getSelector&&m[i].getSelector().persistencyKey===p&&m[i].getFileType()==="change"){f[i]=m[i];}});return f;}};return e;},true);
