/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/Control','sap/ui/base/ManagedObjectObserver','sap/base/util/merge','sap/base/util/deepEqual','sap/ui/mdc/condition/Condition','sap/ui/mdc/condition/FilterOperatorUtil','sap/ui/mdc/condition/Operator','sap/ui/mdc/enum/EditMode','sap/ui/mdc/enum/FieldDisplay','sap/ui/mdc/enum/BaseType','sap/ui/mdc/enum/ConditionValidated','sap/ui/mdc/Field','sap/ui/mdc/field/ListFieldHelp','sap/ui/mdc/field/ListFieldHelpItem','sap/ui/model/base/ManagedObjectModel','sap/ui/model/json/JSONModel','sap/ui/model/resource/ResourceModel','sap/ui/model/type/String','sap/ui/core/library','sap/ui/core/InvisibleText','sap/ui/core/ListItem','sap/ui/layout/Grid','sap/ui/layout/GridData','sap/m/library','sap/m/ScrollContainer','sap/m/Button','sap/m/Panel'],function(C,M,m,d,a,F,O,E,b,B,c,e,L,f,g,J,R,S,h,I,j,G,k,l,n,o,P){"use strict";var p=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");sap.ui.getCore().attachLocalizationChanged(function(){p=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");});var q=l.ButtonType;var V=h.ValueState;var D=C.extend("sap.ui.mdc.field.DefineConditionPanel",{metadata:{library:"sap.ui.mdc",properties:{conditions:{type:"object[]",group:"Data",defaultValue:[],byValue:true},formatOptions:{type:"object",defaultValue:{}},label:{type:"string",defaultValue:""},inputOK:{type:"boolean",defaultValue:true}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},events:{}},_oManagedObjectModel:null,renderer:{apiVersion:2,render:function(i,h1){i.openStart("section",h1);i.class("sapUiMdcDefineConditionPanel");i.openEnd();i.renderControl(h1.getAggregation("_content"));i.close("section");}},init:function(){sap.ui.getCore().getMessageManager().registerObject(this,true);C.prototype.init.apply(this,arguments);this._oManagedObjectModel=new g(this);this._oObserver=new M(_.bind(this));this._oObserver.observe(this,{properties:["conditions","formatOptions"]});Q.call(this);this.setModel(this._oManagedObjectModel,"$this");this.setModel(this._oManagedObjectModel,"$condition");},exit:function(){sap.ui.getCore().getMessageManager().unregisterObject(this,true);this._oObserver.disconnect();this._oObserver=undefined;if(this._sConditionsTimer){clearTimeout(this._sConditionsTimer);this._sConditionsTimer=null;}if(this._oDefaultType){this._oDefaultType.destroy();delete this._oDefaultType;}this._oManagedObjectModel.destroy();delete this._oManagedObjectModel;},byId:function(i){return sap.ui.getCore().byId(this.getId()+"--"+i);},onBeforeRendering:function(){if(!this.getModel("$i18n")){this.setModel(new R({bundleName:"sap/ui/mdc/messagebundle",async:false}),"$i18n");}if(this.getConditions().length===0){this.updateDefineConditions();}},removeCondition:function(i){var h1=i.oSource;var i1=h1.getBindingContext("$this").getObject();var j1=this.getConditions();var k1=F.indexOfCondition(i1,j1);j1.splice(k1,1);this.setProperty("conditions",j1,true);},addCondition:function(i){var h1=this.getConditions();var i1=this.getFormatOptions();var j1=i1.maxConditions;if(j1===-1||h1.length<j1){this.addDummyCondition(h1.length+1);if(this.getConditions().length===j1){this._bFocusLastCondition=true;}}},addDummyCondition:function(i){var h1=w.call(this);var i1=v.call(this);var j1=h1.indexOf(i1.name)>=0?i1.name:h1[0];var k1=F.getOperator(j1);var l1=a.createCondition(j1,k1.valueDefaults?k1.valueDefaults:[],undefined,undefined,c.NotValidated);l1.isInitial=true;F.updateConditionValues(l1);F.checkConditionsEmpty(l1,h1);var m1=this.getConditions();if(i!==undefined){m1.splice(i,0,l1);}else{m1.push(l1);}this.setProperty("conditions",m1,true);},updateDefineConditions:function(){var i=this.getConditions().filter(function(h1){var i1=F.getOperator(h1.operator);return h1.validated!==c.Validated||i1.exclude;});N.call(this,i,true,false);if(i.length===0){this.addDummyCondition();}},onChange:function(i){var h1=w.call(this);var i1=this.getConditions();F.checkConditionsEmpty(i1,h1);F.updateConditionsValues(i1,h1);if(i){i1.forEach(function(j1){if(!j1.isEmpty){delete j1.isInitial;}});}this.setProperty("conditions",i1,true);},onSelectChange:function(i){var h1=i.getSource();var i1=h1.getValue();var j1=h1._sOldKey;var k1=F.getOperator(i1);var l1=j1&&F.getOperator(j1);if(k1&&l1){var m1=false;var n1=h1.getBindingContext("$this").getObject();var o1=this.getConditions();var p1=F.indexOfCondition(n1,o1);if(!d(k1.valueTypes[0],l1.valueTypes[0])&&k1.valueTypes[0]!==O.ValueType.Static){if(p1>=0){n1=o1[p1];n1.values.forEach(function(r1,s1){if(r1!==null){n1.values[s1]=null;m1=true;}});}}if(p1>=0&&k1.valueDefaults){var q1=false;n1=o1[p1];n1.values.forEach(function(r1,s1){if((n1.isInitial&&r1!==k1.valueDefaults[s1])||(r1===null)){n1.values[s1]=k1.valueDefaults[s1];n1.isInitial=true;m1=true;q1=true;}});if(q1){F.checkConditionsEmpty(n1,w.call(this));}}if(!k1.valueTypes[1]&&l1.valueTypes[1]){if(p1>=0){n1=o1[p1];if(n1.values.length>1&&n1.values[1]){n1.values=n1.values.slice(0,1);m1=true;}}}if(m1){this.setProperty("conditions",o1,true);}}delete h1._sOldKey;},onPaste:function(h1){var i1;var j1=h1.srcControl;var k1=this.getFormatOptions();var l1=k1.hasOwnProperty("maxConditions")?k1.maxConditions:-1;var m1=j1.getBindingContext("$condition").getPath();var n1=parseInt(m1.split("/")[2]);if(window.clipboardData){i1=window.clipboardData.getData("Text");}else{i1=h1.originalEvent.clipboardData.getData('text/plain');}var o1=i1.split(/\r\n|\r|\n/g);if(o1&&o1.length>1){setTimeout(function(){var p1=z.call(this);var q1=o1.length;var r1=this.getConditions();for(var i=0;i<q1;i++){if(o1[i]){var s1=o1[i];var t1=s1.split(/\t/g);var u1;if(t1.length==2&&t1[0]&&t1[1]){u1=F.getOperator("BT");}else{t1=[s1.trim()];u1=v.call(this);}s1=u1?u1.format(a.createCondition(u1.name,t1)):t1[0];if(u1){var v1=u1.getCondition(s1,p1,b.Value,true);if(v1){v1.validated=c.NotValidated;if(r1.length>n1){r1.splice(n1,1,v1);}else{r1.push(v1);}n1++;}}}}if(l1>=0&&r1.length>l1){r1.splice(l1,r1.length-l1);}if(j1.setDOMValue){j1.setDOMValue("");}F.checkConditionsEmpty(r1);this.setProperty("conditions",r1,true);}.bind(this),0);}},cleanUp:function(){var h1=this.byId("conditions");var i1=h1.getContent();for(var i=0;i<i1.length;i++){var j1=i1[i];if(j1 instanceof e&&j1.hasOwnProperty("_iValueIndex")){if(j1._bParseError){j1.setValue();}if(j1.getValueState()!==V.None){j1.setValueState(V.None);j1.setValueStateText();}}}this.setProperty("inputOK",true,true);}});function _(i){if(i.name==="value"){r.call(this,i.object,i.current,i.old);}if(i.name==="formatOptions"){var h1=this.getConditions();var i1=i.current&&i.current.operators;var j1=i.old&&i.old.operators;var k1=false;if(!d(i1,j1)){k1=true;y.call(this);}var l1=i.current&&i.current.valueType&&i.current.valueType.getMetadata().getName();var m1=i.old&&i.old.valueType&&i.old.valueType.getMetadata().getName();if(l1!==m1&&h1.length>0){if(!k1){y.call(this);}this._bUpdateType=true;W.call(this);this._bUpdateType=false;N.call(this,h1,true,true);}}if(i.name==="conditions"){if(this._sConditionsTimer){clearTimeout(this._sConditionsTimer);this._sConditionsTimer=null;}this._sConditionsTimer=setTimeout(function(){this._sConditionsTimer=null;this.updateDefineConditions();W.call(this);}.bind(this),0);}}function r(h1,i1,j1){h1._sOldKey=j1;var k1=0;if(i1&&j1){var l1=F.getOperator(i1);var m1=F.getOperator(j1);var n1=h1.getParent();var o1;var p1;k1=n1.indexOfContent(h1);o1=n1.getContent()[k1+2];if(o1&&o1.hasOwnProperty("_iValueIndex")&&o1._iValueIndex===0){if(o1 instanceof e&&!o1._bParseError){o1.setValueState(V.None);o1.setValueStateText();}p1=n1.getContent()[k1+3];if(p1&&p1.hasOwnProperty("_iValueIndex")&&p1._iValueIndex===1){if(p1 instanceof e&&!p1._bParseError){p1.setValueState(V.None);p1.setValueStateText();}}else{p1=undefined;}}else{o1=undefined;}if(l1.createControl||m1.createControl){if(o1){o1.destroy();}if(p1){p1.destroy();}}else{if(o1&&l1.valueTypes[0]!==m1.valueTypes[0]){o1.unbindProperty("value");}if(p1&&l1.valueTypes[1]!==m1.valueTypes[1]&&m1.valueTypes[1]){p1.unbindProperty("value");}}}if(!i1){var q1=h1.getBindingContext("$this").getObject();if(q1){var r1=this.getConditions();k1=F.indexOfCondition(q1,r1);if(k1>=0){q1=r1[k1];q1.operator=j1;this.setProperty("conditions",r1,true);}}}var s1=this.oOperatorModel.getData();var t1;for(var i=0;i<s1.length;i++){var u1=s1[i];if(u1.key===i1){t1=u1.text;break;}}h1.setAdditionalValue(t1);this.onChange();}function s(i,h1,i1,j1){var k1=F.getOperator(i.operator);if(!k1||!k1.valueTypes[h1]){return null;}var l1=t.call(this,k1.name,h1);var m1=this._oManagedObjectModel.getContext(j1.getPath()+"values/"+h1+"/");var n1;if(k1.createControl){n1=k1.createControl(l1,"$this>",h1,i1);}else{n1=new e(i1,{delegate:K.call(this),value:{path:"$this>",type:l1,mode:'TwoWay',targetType:'raw'},editMode:{path:"$condition>operator",formatter:Y},width:"100%"});}if(n1.getMetadata().hasProperty("placeholder")){if(h1===0){n1.bindProperty("placeholder",{path:"$condition>operator",formatter:b1});}else{n1.bindProperty("placeholder",{path:"$condition>operator",formatter:c1});}}n1._iValueIndex=h1;if(n1.attachChange){n1.attachChange(this.onChange.bind(this));}n1.onpaste=this.onPaste.bind(this);n1.setLayoutData(new k({span:{path:"$condition>",formatter:a1.bind(this)}}));n1.setBindingContext(m1,"$this");n1.setBindingContext(j1,"$condition");n1.setFieldGroupIds([j1.getPath()]);return n1;}function t(i,h1){var i1=z.call(this);var j1=F.getOperator(i);if(j1.valueTypes[h1]&&[O.ValueType.Self,O.ValueType.Static].indexOf(j1.valueTypes[h1])===-1){i1=j1._createLocalType(j1.valueTypes[h1],i1);}var k1=false;if(j1.valueTypes[h1]===O.ValueType.Static){k1=true;i1=A.call(this);}var l1=k1?B.String:H.call(this,i1);var m1;switch(l1){case B.Numeric:var n1=i1.getFormatOptions();if(n1&&n1.hasOwnProperty("emptyString")&&n1.emptyString===null){m1=i1;}else{m1=u(i1,{emptyString:null});}break;case B.Date:case B.Time:case B.DateTime:m1=i1;break;default:if(i1.getConstraints()&&i1.getConstraints().hasOwnProperty("nullable")&&i1.getConstraints().nullable===false){m1=u(i1);}else{m1=i1;}break;}return m1;}function u(i,h1,i1){var j1=sap.ui.require(i.getMetadata().getName().replace(/\./g,"/"));var k1=m(i.getFormatOptions(),h1||{});var l1=m(i.getConstraints(),i1||{});if(l1.hasOwnProperty("nullable")&&l1.nullable===false){l1.nullable=true;}return new j1(k1,l1);}function v(){var i;var h1=this.getFormatOptions().defaultOperatorName;if(h1){i=F.getOperator(h1);}else{var i1=z.call(this);var j1=H.call(this,i1);i=F.getDefaultOperator(j1);}return i;}function w(){var i=this.getFormatOptions();var h1=i&&i.operators;if(!h1||h1.length===0){h1=F.getOperatorsForType(B.String);}return h1;}function x(){var h1;var i1=w.call(this);for(var i=0;i<i1.length;i++){var j1=i1[i];var k1=F.getOperator(j1);if(!h1){h1=k1.group.id;}else if(h1!==k1.group.id){return true;}}return false;}function y(){if(!this.oOperatorModel){return;}var h1=z.call(this);var i1=w.call(this);var j1=[];var k1=x.call(this);var l1=this.getId()+"--rowSelect-help";var m1=sap.ui.getCore().byId(l1);var n1;if(k1){n1=new f({key:"{om>key}",text:"{om>text}",additionalText:"{om>additionalText}",groupKey:"{om>groupId}",groupText:"{om>groupText}"});}else{n1=new j({key:"{om>key}",text:"{om>text}",additionalText:"{om>additionalText}"});}m1.bindAggregation("items",{path:'om>/',templateShareable:false,template:n1});for(var i=0;i<i1.length;i++){var o1=i1[i];var p1=F.getOperator(o1);if(!p1||(p1.showInSuggest!==undefined&&p1.showInSuggest==false)){continue;}var q1=p1.textKey||"operators."+p1.name+".longText";var r1=p1.getTypeText(q1,h1.getName().toLowerCase());if(r1===q1){r1=p1.longText;}var s1=p1.additionalInfo;if(s1===undefined){if(s1!==""&&p1.formatRange){s1=p1.formatRange(p1._getRange(undefined,h1),h1);}else if(!k1){s1=p1.group.text;}}j1.push({key:p1.name,text:r1,additionalText:s1,groupId:p1.group.id,groupText:p1.group.text});}this.oOperatorModel.setData(j1);}function z(){var i=this.getFormatOptions();var h1=i&&i.valueType;if(!h1){h1=A.call(this);}return h1;}function A(){if(!this._oDefaultType){this._oDefaultType=new S();}return this._oDefaultType;}function H(i){var h1=i.getMetadata().getName();var i1=i.getFormatOptions();var j1=i.getConstraints();var k1=this.getFormatOptions().delegate;var l1=this.getFormatOptions().payload;var m1=k1?k1.getTypeUtil(l1).getBaseType(h1,i1,j1):B.String;if(m1===B.Unit){m1=B.Numeric;}return m1;}function K(){var i=this.getFormatOptions();var h1=i.delegateName||"sap/ui/mdc/field/FieldBaseDelegate";var i1=i.payload;return{name:h1,payload:i1};}function N(h1,i1,j1){var k1=z.call(this);var l1=[];var i=0;for(i=0;i<h1.length;i++){var m1=h1[i];var n1=F.getOperator(m1.operator);if(n1&&n1.valueTypes[0]===O.ValueType.Static&&(m1.values.length===0||j1)){if(n1.getStaticText){var o1=n1.getStaticText(k1);if(m1.values.length>0){m1.values[0]=o1;}else{m1.values.push(o1);}l1.push(i);}}}if(l1.length>0){this.setProperty("conditions",h1,true);}}function Q(){var i=new I(this.getId()+"--ivtOperator",{text:"{$i18n>valuehelp.DEFINECONDITIONS_OPERATORLABEL}"});var h1=new P({headerText:"{$this>/label}",expanded:true,height:"100%",backgroundDesign:"Transparent"}).addStyleClass("sapMdcDefineconditionPanel");h1.addDependent(new L(this.getId()+"--rowSelect-help",{filterList:false,useFirstMatch:true}));var i1=new G(this.getId()+"--conditions",{width:"100%",hSpacing:0,vSpacing:0,containerQuery:true}).addStyleClass("sapUiMdcDefineConditionGrid");X.call(this,undefined,i1,0,null,0);h1.addContent(i);h1.addContent(i1);var j1=new o(this.getId()+"--addBtn",{press:this.addCondition.bind(this),type:q.Default,text:"{$i18n>valuehelp.DEFINECONDITIONS_ADDCONDITION}",layoutData:new k({span:"XL2 L3 M3 S3",indent:"XL9 L8 M8 S7",linebreak:true,visibleS:{path:"$this>/conditions",formatter:T.bind(this)},visibleM:{path:"$this>/conditions",formatter:T.bind(this)},visibleL:{path:"$this>/conditions",formatter:T.bind(this)},visibleXL:{path:"$this>/conditions",formatter:T.bind(this)}})});i1.addContent(j1);i1.attachValidateFieldGroup(e1,this);this.setAggregation("_content",h1);}function T(i){var h1=this.getFormatOptions();var i1=h1.hasOwnProperty("maxConditions")?h1.maxConditions:-1;return i1===-1||i.length<i1;}function U(i){var h1=this.getFormatOptions();var i1=h1.hasOwnProperty("maxConditions")?h1.maxConditions:-1;return i1!==1;}function W(){var h1=this.getConditions();var i1=this.byId("conditions");var j1;var k1=-1;var l1=0;for(var i=0;i<h1.length;i++){var m1=h1[i];var n1=F.getOperator(m1.operator);if(m1.validated!==c.Validated||n1.exclude){var o1=this._oManagedObjectModel.getContext("/conditions/"+i+"/");k1++;if(!this.oOperatorModel){this.oOperatorModel=new J();this.setModel(this.oOperatorModel,"om");y.call(this);}j1=i1.getContent();if(j1[l1]&&j1[l1].isA("sap.ui.mdc.Field")){l1=d1.call(this,m1,i1,l1,o1,k1);}else{l1=X.call(this,m1,i1,l1,o1,k1);}}}j1=i1.getContent();while(j1[l1]&&j1[l1]!==this.byId("addBtn")){j1[l1].destroy();l1++;}if(this._bFocusLastCondition){j1[0].focus();this._bFocusLastCondition=false;}}function X(h1,i1,j1,k1,l1){var m1=this.getId()+"--"+l1;if(!this._oOperatorFieldType){this._oOperatorFieldType=new S({},{minLength:1});}var n1=new e(m1+"-operator",{value:{path:"$this>operator",type:this._oOperatorFieldType},width:"100%",display:"Description",fieldHelp:this.getId()+"--rowSelect-help",change:this.onSelectChange.bind(this),ariaLabelledBy:this.getId()+"--ivtOperator"}).setLayoutData(new k({span:{path:"$this>/conditions",formatter:$.bind(this)},linebreak:true})).setBindingContext(k1,"$this");if(k1){n1.setFieldGroupIds([k1.getPath()]);}this._oObserver.observe(n1,{properties:["value"]});i1.insertContent(n1,j1);j1++;var o1=new o(m1+"--removeBtnSmall",{press:this.removeCondition.bind(this),type:q.Transparent,icon:"sap-icon://decline",tooltip:"{$i18n>valuehelp.DEFINECONDITIONS_REMOVECONDITION}"}).setLayoutData(new k({span:"XL1 L1 M1 S2",indent:{path:"$this>operator",formatter:Z},visibleS:{path:"$this>/conditions",formatter:U.bind(this)},visibleM:false,visibleL:false,visibleXL:false})).setBindingContext(k1,"$this");if(k1){o1.setFieldGroupIds([k1.getPath()]);}i1.insertContent(o1,j1);j1++;if(h1){for(var i=0;i<h1.values.length;i++){var p1=s.call(this,h1,i,m1+"-values"+i,k1);if(p1){i1.insertContent(p1,j1);j1++;}}}var q1=new o(m1+"--removeBtnLarge",{press:this.removeCondition.bind(this),type:q.Transparent,icon:"sap-icon://decline",tooltip:"{$i18n>valuehelp.DEFINECONDITIONS_REMOVECONDITION}"}).setLayoutData(new k({span:"XL1 L1 M1 S1",indent:{path:"$this>operator",formatter:Z},visibleS:false,visibleM:{path:"$this>/conditions",formatter:U.bind(this)},visibleL:{path:"$this>/conditions",formatter:U.bind(this)},visibleXL:{path:"$this>/conditions",formatter:U.bind(this)}})).setBindingContext(k1,"$this");i1.insertContent(q1,j1);j1++;return j1;}function Y(i){if(!i){return E.Display;}var h1=F.getOperator(i);var i1=false;if(h1&&h1.valueTypes[0]===O.ValueType.Static){i1=true;}return i1?E.Display:E.Editable;}function Z(i){var h1=i&&F.getOperator(i);if(!h1||!h1.valueTypes[0]){return"XL8 L8 M8 S0";}else{return"";}}function $(i){var h1=this.getFormatOptions();var i1=h1.hasOwnProperty("maxConditions")?h1.maxConditions:-1;var j1="XL3 L3 M3 ";if(i1===1){j1+="S12";}else{j1+="S10";}return j1;}function a1(i){var h1=this.getFormatOptions();var i1=h1.hasOwnProperty("maxConditions")?h1.maxConditions:-1;var j1=i&&F.getOperator(i.operator);var k1="";if(j1&&j1.valueTypes[1]){k1="XL4 L4 M4 ";}else{k1="XL8 L8 M8 ";}if(i1===1){k1+="S12";}else{k1+="S10";}return k1;}function b1(i){var h1=i&&F.getOperator(i);if(h1&&h1.aLabels){return h1.aLabels[0];}else if(h1&&h1.valueTypes[1]){return p.getText("valuehelp.DEFINECONDITIONS_FROM");}else{return p.getText("valuehelp.DEFINECONDITIONS_VALUE");}}function c1(i){var h1=i&&F.getOperator(i);if(h1&&h1.aLabels){return h1.aLabels[1];}else if(h1&&h1.valueTypes[1]){return p.getText("valuehelp.DEFINECONDITIONS_TO");}}function d1(h1,i1,j1,k1,l1){var m1=this.getId()+"--"+l1;var n1=i1.getContent();var o1;var p1=n1[j1];p1.setBindingContext(k1,"$this");if(k1){p1.setFieldGroupIds([k1.getPath()]);}j1++;var q1=n1[j1];q1.setBindingContext(k1,"$this");if(k1){q1.setFieldGroupIds([k1.getPath()]);}j1++;var r1;var s1=n1[j1];var t1;if(s1.hasOwnProperty("_iValueIndex")&&s1._iValueIndex===0){var u1=Y(h1.operator);if(h1.values.length>0||u1===E.Display){r1=this._oManagedObjectModel.getContext(k1.getPath()+"values/0/");s1.setBindingContext(r1,"$this");s1.setBindingContext(k1,"$condition");if(s1.getMetadata().hasProperty("value")&&(this._bUpdateType||!s1.getBindingInfo("value"))){o1=t.call(this,h1.operator,0);s1.bindProperty("value",{path:"$this>",type:o1});}j1++;t1=n1[j1];if(t1.hasOwnProperty("_iValueIndex")&&t1._iValueIndex===1){if(h1.values.length>1){r1=this._oManagedObjectModel.getContext(k1.getPath()+"values/1/");t1.setBindingContext(r1,"$this");if(t1.getMetadata().hasProperty("value")&&(this._bUpdateType||!t1.getBindingInfo("value"))){o1=t.call(this,h1.operator,1);t1.bindProperty("value",{path:"$this>",type:o1});}j1++;}else{t1.destroy();}}else if(h1.values.length>1){t1=s.call(this,h1,1,m1+"-values1",k1);if(t1){i1.insertContent(t1,j1);j1++;}}}else{s1.destroy();s1=undefined;t1=n1[j1+1];if(t1&&t1.hasOwnProperty("_iValueIndex")&&t1._iValueIndex===1){t1.destroy();}}}else if(h1.values.length>0){for(var i=0;i<h1.values.length;i++){var v1=s.call(this,h1,i,m1+"-values"+i,k1);if(v1){i1.insertContent(v1,j1);j1++;}}}n1=i1.getContent();var w1=n1[j1];w1.setBindingContext(k1,"$this");j1++;return j1;}function e1(i){var h1=i.getSource();while(!(h1.getParent()instanceof G)){h1=h1.getParent();}f1.call(this,h1);}function f1(i){var h1=i.getParent();var i1=h1.indexOfContent(i);var j1;if(i.getId().endsWith("-operator")){j1=i.getBindingContext("$this");i1=i1+2;i=h1.getContent()[i1];}else{j1=i.getBindingContext("$condition");}var k1;var l1=j1.getObject();var m1=F.getOperator(l1.operator);var n1=false;if(m1.valueTypes.length>0&&m1.valueTypes[0]!==O.ValueType.Static){if(m1.valueTypes.length>1&&m1.valueTypes[1]){if(i.hasOwnProperty("_iValueIndex")&&i._iValueIndex===0){k1=h1.getContent()[i1+1];}else if(i.hasOwnProperty("_iValueIndex")&&i._iValueIndex===1){k1=h1.getContent()[i1-1];}}if(i.getMetadata().getAllProperties().valueState&&!i._bParseError&&(!k1||!k1._bParseError)){var o1=i.getBinding("value").getType();try{m1.validate(l1.values,o1);i.setValueState(V.None);i.setValueStateText();if(k1&&k1.getMetadata().getAllProperties().valueState){k1.setValueState(V.None);k1.setValueStateText();}}catch(p1){n1=true;i.setValueState(V.Error);i.setValueStateText(p1.message);if(k1&&k1.getMetadata().getAllProperties().valueState){k1.setValueState(V.Error);k1.setValueStateText(p1.message);}}}}g1.call(this,n1);}function g1(h1){if(h1!==true){var i1=this.byId("conditions");var j1=i1.getContent();h1=false;for(var i=0;i<j1.length;i++){var k1=j1[i];if(k1 instanceof e&&k1.hasOwnProperty("_iValueIndex")&&k1.getValueState()===V.Error){h1=true;break;}}}this.setProperty("inputOK",!h1,true);}return D;});
