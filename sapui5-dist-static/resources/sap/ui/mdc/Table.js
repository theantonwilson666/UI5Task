/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Control","./ActionToolbar","./table/TableSettings","./table/GridTableType","./table/ResponsiveTableType","./table/PropertyHelper","./mixin/FilterIntegrationMixin","./library","sap/m/Text","sap/m/Title","sap/m/ColumnHeaderPopover","sap/m/ColumnPopoverSortItem","sap/m/OverflowToolbar","sap/m/library","sap/ui/core/Core","sap/ui/core/format/NumberFormat","sap/ui/core/dnd/DragDropInfo","sap/ui/core/Item","sap/ui/core/format/ListFormat","sap/ui/events/KeyCodes","sap/ui/model/Sorter","sap/ui/dom/containsOrEquals","sap/base/strings/capitalize","sap/base/util/deepEqual","sap/ui/core/InvisibleMessage","sap/ui/core/InvisibleText","sap/ui/mdc/p13n/subcontroller/ColumnController","sap/ui/mdc/p13n/subcontroller/SortController","sap/ui/mdc/p13n/subcontroller/FilterController","sap/ui/mdc/p13n/subcontroller/GroupController","sap/ui/mdc/p13n/subcontroller/AggregateController"],function(C,A,T,G,R,P,F,l,a,b,c,d,O,M,e,N,D,I,L,K,S,f,g,h,i,j,k,m,n,o,p){"use strict";var q=l.SelectionMode;var r=l.TableType;var s=l.RowAction;var t=M.ToolbarDesign;var u=M.ToolbarStyle;var v="sap.ui.mdc.IFilter";var w=new window.WeakMap();var x=function(Y){if(!w.has(Y)){w.set(Y,{oFilterInfoBar:null});}return w.get(Y);};function y(Y,Z){sap.ui.require(["sap/m/MessageToast"],function($){var _=e.getLibraryResourceBundle("sap.ui.mdc");$.show(_.getText(Y,Z));});}var z=C.extend("sap.ui.mdc.Table",{metadata:{library:"sap.ui.mdc",designtime:"sap/ui/mdc/designtime/table/Table.designtime",interfaces:["sap.ui.mdc.IFilterSource","sap.ui.mdc.IxState"],defaultAggregation:"columns",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null,invalidate:true},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null,invalidate:true},rowAction:{type:"sap.ui.mdc.RowAction[]",defaultValue:[]},p13nMode:{type:"sap.ui.mdc.TableP13nMode[]",defaultValue:[]},delegate:{type:"object",defaultValue:{name:"sap/ui/mdc/TableDelegate",payload:{}}},headerLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:sap.ui.core.TitleLevel.Auto},autoBindOnInit:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},headerVisible:{type:"boolean",group:"Misc",defaultValue:true},selectionMode:{type:"sap.ui.mdc.SelectionMode",defaultValue:q.None},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},threshold:{type:"int",group:"Appearance",defaultValue:-1},noDataText:{type:"string"},sortConditions:{type:"object"},filterConditions:{type:"object",defaultValue:{}},groupConditions:{type:"object"},aggregateConditions:{type:"object"},enableExport:{type:"boolean",defaultValue:false},busyIndicatorDelay:{type:"int",defaultValue:100}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},type:{type:"sap.ui.mdc.table.TableTypeBase",altTypes:["sap.ui.mdc.TableType"],multiple:false},columns:{type:"sap.ui.mdc.table.Column",multiple:true},creationRow:{type:"sap.ui.mdc.table.CreationRow",multiple:false},actions:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_createToolbar",aggregation:"actions"}},variant:{type:"sap.ui.fl.variants.VariantManagement",multiple:false},quickFilter:{type:"sap.ui.core.Control",multiple:false},rowSettings:{type:"sap.ui.mdc.table.RowSettings",multiple:false}},associations:{filter:{type:v,multiple:false}},events:{rowPress:{parameters:{bindingContext:{type:"sap.ui.model.Context"}}},selectionChange:{parameters:{bindingContext:{type:"sap.ui.model.Context"},selected:{type:"boolean"},selectAll:{type:"boolean"}}},beforeExport:{parameters:{exportSettings:{type:"object"},userExportSettings:{type:"object"}}},paste:{parameters:{data:{type:"string[][]"}}}}},constructor:function(){this._oTableReady=new Promise(this._resolveTable.bind(this));this._pFullInitialize=new Promise(this._resolveFullInitialization.bind(this));C.apply(this,arguments);this.bCreated=true;this._doOneTimeOperations();this._initializeContent();},renderer:{apiVersion:2,render:function(Y,Z){Y.openStart("div",Z);Y.class("sapUiMdcTable");Y.style("height",Z.getHeight());Y.style("width",Z.getWidth());Y.openEnd();Y.renderControl(Z.getAggregation("_content"));Y.close("div");}}});var B=["variant","quickFilter"];F.call(z.prototype);B.forEach(function(Y){var Z=g(Y),$="_o"+Z,_="get"+Z,a1="set"+Z,b1="destroy"+Z;z.prototype[_]=function(){return this[$];};z.prototype[b1]=function(){var c1=this[$];this[a1]();if(c1){c1.destroy();}return this;};z.prototype[a1]=function(c1){this.validateAggregation(Y,c1,false);var d1=this._createToolbar(),e1=c1!==this[$];if(!c1||e1){d1.removeBetween((this[_]()));this[$]=c1;}if(e1&&c1){this._setToolbarBetween(d1);}return this;};});z.prototype.init=function(){C.prototype.init.apply(this,arguments);this.mSkipPropagation={rowSettings:true};};z.prototype.applySettings=function(){C.prototype.applySettings.apply(this,arguments);this.initControlDelegate();};z.prototype._setToolbarBetween=function(Y){[this._oVariant,this._oQuickFilter].forEach(function(Z){if(Z){Y.addBetween(Z);}});};z.prototype.initialized=function(){return this._oTableReady;};z.prototype._resolveTable=function(Y,Z){this._fResolve=Y;this._fReject=Z;};z.prototype._fullyInitialized=function(){return this._pFullInitialize;};z.prototype._resolveFullInitialization=function(Y,Z){this._fnResolveFullInit=Y;this._fnRejectFullInit=Z;};z.prototype._getStringType=function(Y){var Z,$=Z=Y||this.getType();if(!$){Z=r.Table;}else if(typeof $==="object"){if($.isA("sap.ui.mdc.table.ResponsiveTableType")){Z=r.ResponsiveTable;}else{Z=r.Table;}}return Z;};z.prototype._updateTypeSettings=function(){var Y=this.getType();if(Y&&typeof Y==="object"){Y.updateTableSettings();}else{if(Y==="ResponsiveTable"){Y=R;}else{Y=G;}Y.updateDefault(this._oTable);}};z.prototype.scrollToIndex=function(Y){return new Promise(function(Z,$){if(!this._oTable){return $();}if(typeof Y!=="number"){return $("The iIndex parameter has to be a number");}if(this._getStringType()===r.ResponsiveTable){this._oTable.scrollToIndex(Y).then(Z).catch($);}else{if(Y===-1){Y=this.getRowBinding()?this.getRowBinding().getLength():0;}if(this._oTable._setFirstVisibleRowIndex(Y)){this._oTable.attachEventOnce("rowsUpdated",function(){Z();});}else{Z();}}}.bind(this));};z.prototype.focusRow=function(Y,Z){return this.scrollToIndex(Y).then(function(){return this._oTable._setFocus(Y,Z);}.bind(this));};z.prototype.setType=function(Y){var Z=this._getStringType(Y);var $=this._getStringType();this.setAggregation("type",Y,true);if(Z===$&&this._oTable){this._updateTypeSettings();return this;}if(this.bCreated){if(this._oTable){if($==="ResponsiveTable"){this._oTable.setHeaderToolbar();}else{this._oTable.removeExtension(this._oToolbar);}this._oTable.destroy("KeepDom");this._oTable=null;this._bTableExists=false;}else{this._onAfterTableCreated();this._onAfterFullInitialization();}if(this._oTemplate){this._oTemplate.destroy();this._oTemplate=null;}this._oTableReady=new Promise(this._resolveTable.bind(this));this._bFullyInitialized=false;this._pFullInitialize=new Promise(this._resolveFullInitialization.bind(this));this._initializeContent();}return this;};z.prototype.setRowSettings=function(Y){var Z=this._getStringType();this.setAggregation("rowSettings",Y,true);if(this._oTable){if(Z==="ResponsiveTable"){R.updateRowSettings(this._oTemplate,Y);this.checkAndRebind();}else{G.updateRowSettings(this._oTable,Y);}}return this;};z.prototype.setHeaderLevel=function(Y){if(this.getHeaderLevel()===Y){return this;}this.setProperty("headerLevel",Y,true);this._oTitle&&this._oTitle.setLevel(Y);return this;};z.prototype.focus=function(Y){var Z=this.getDomRef();if(this._oTable&&Z&&!f(Z,document.activeElement)){this._oTable.focus();}};z.prototype.setBusy=function(Y){this.setProperty('busy',Y,true);if(this._oTable){this._oTable.setBusy(Y);}return this;};z.prototype.setBusyIndicatorDelay=function(Y){this.setProperty('busyIndicatorDelay',Y,true);if(this._oTable){this._oTable.setBusyIndicatorDelay(Y);}return this;};z.prototype.setSelectionMode=function(Y){var Z=this.getSelectionMode();this.setProperty("selectionMode",Y,true);if(this._oTable&&Z!=this.getSelectionMode()){this._updateSelectionBehavior();}return this;};z.prototype.setRowAction=function(Y){var Z=this.getRowAction();this.setProperty("rowAction",Y,true);if(!h(Z.sort(),this.getRowAction().sort())){this._updateRowAction();}return this;};z.prototype.setCreationRow=function(Y){this.setAggregation("creationRow",Y,true);if(Y){Y.update();}return this;};z.prototype.setP13nMode=function(Y){var Z=this.getP13nMode();this.setProperty("p13nMode",Y,true);this._updateAdaptation(this.getP13nMode());if(!h(Z.sort(),this.getP13nMode().sort())){E(this);}return this;};z.prototype._updateAdaptation=function(Y){var Z={controller:{}};var $={Column:k,Sort:m,Group:o,Filter:n,Aggregate:p};Y.forEach(function(_){var a1=_;Z.controller[a1]=$[_];});this.getEngine().registerAdaptation(this,Z);};function E(Y){if(Y._oToolbar){Y._oToolbar.destroyEnd();Y._getP13nButtons().forEach(function($){Y._oToolbar.addEnd($);});}if(Y._oTable){var Z=Y._oTable.getDragDropConfig()[0];if(Z){Z.setEnabled(Y.getP13nMode().indexOf("Column")>-1);}}if(Y.isFilteringEnabled()){J(Y);}H(Y);}z.prototype.setFilterConditions=function(Y){this.setProperty("filterConditions",Y,true);var Z=this.getInbuiltFilter();if(Z){Z.setFilterConditions(Y);}H(this);return this;};function H(Y){var Z=U(Y);var $=V(Y);var _=W(Y);if(!Z){return;}if(_.length===0||!Y.isFilteringEnabled()){var a1=Z.getDomRef();if(a1&&a1.contains(document.activeElement)){Y.focus();}Z.setVisible(false);return;}Y._fullyInitialized().then(function(){var b1=_.map(function(f1){return Y.getPropertyHelper().getLabel(f1);});var c1=e.getLibraryResourceBundle("sap.ui.mdc");var d1=L.getInstance();var e1=c1.getText("table.FILTER_INFO",d1.format(b1));Z.setVisible(true);$.setText(e1);});}function J(Y){if(!Y._oTable){return;}var Z=U(Y);if(!Z){Z=Q(Y);}if(Y._bMobileTable){if(Y._oTable.getInfoToolbar()!==Z){Y._oTable.setInfoToolbar(Z);Y._oTable.addAriaLabelledBy(V(Y));}}else if(Y._oTable.indexOfExtension(Z)===-1){Y._oTable.insertExtension(Z,1);Y._oTable.addAriaLabelledBy(V(Y));}}function Q(Y){var Z=Y.getId()+"-filterInfoBar";var $=x(Y).oFilterInfoBar;if($&&!$.bIsDestroyed){$.destroy();}$=new O({id:Z,active:true,design:t.Info,visible:false,content:[new a({id:Z+"-text",wrapping:false})],press:function(){T.showPanel(Y,"Filter",$);}});$.focus=function(){if(this.getDomRef()){O.prototype.focus.apply(this,arguments);}else{Y.focus();}};x(Y).oFilterInfoBar=$;H(Y);return $;}function U(Y){var Z=x(Y).oFilterInfoBar;if(Z&&(Z.bIsDestroyed||Z.bIsBeingDestroyed)){return null;}return x(Y).oFilterInfoBar;}function V(Y){var Z=U(Y);return Z?Z.getContent()[0]:null;}z.prototype.setThreshold=function(Y){this.setProperty("threshold",Y,true);if(!this._oTable){return this;}Y=this.getThreshold()>-1?this.getThreshold():undefined;if(this._bMobileTable){this._oTable.setGrowingThreshold(Y);}else{this._oTable.setThreshold(Y);}return this;};z.prototype._onFilterProvided=function(Y){this._updateInnerTableNoDataText();};z.prototype._onFilterRemoved=function(Y){this._updateInnerTableNoDataText();};z.prototype._onFiltersChanged=function(Y){if(this.isTableBound()&&Y.getParameter("conditionsBased")){this._oTable.setShowOverlay(true);}};z.prototype._onFilterSearch=function(Y){this._bIgnoreChange=true;this._bAnnounceTableUpdate=true;};z.prototype.setNoDataText=function(Y){this.setProperty("noDataText",Y,true);this._updateInnerTableNoDataText();return this;};z.prototype._updateInnerTableNoDataText=function(){if(!this._oTable){return;}var Y=this._getNoDataText();if(this._bMobileTable){this._oTable.setNoDataText(Y);}else{this._oTable.setNoData(Y);}};z.prototype._getNoDataText=function(){var Y=this.getNoDataText();if(Y){return Y;}var Z=e.getLibraryResourceBundle("sap.ui.mdc");if(!this.isTableBound()){if(this.getFilter()){return Z.getText("table.NO_DATA_WITH_FILTERBAR");}return Z.getText("table.NO_DATA");}return Z.getText("table.NO_RESULTS");};z.prototype._updateRowAction=function(){if(!this._oTable){return;}var Y=this.getRowAction().indexOf(s.Navigation)>-1;var Z=this._bMobileTable?R:G;Z.updateRowAction(this,Y,this._bMobileTable?undefined:this._onRowActionPress);};z.prototype._initializeContent=function(){var Y,Z=this._getStringType();if(Z==="ResponsiveTable"){Y=R;}else{Y=G;}var $=[this.awaitControlDelegate(),Y.loadTableModules()];if(this.isFilteringEnabled()){$.push(this.retrieveInbuiltFilter());}Promise.all($).then(function(){if(this.bIsDestroyed){return;}var _=this.getControlDelegate();if(_.preInit){this._pDelegatePreInit=_.preInit(this);}if(!this._bTableExists&&Z===this._getStringType()){this._bMobileTable=Z==="ResponsiveTable";this._createContent();this._bTableExists=true;}}.bind(this));};z.prototype._doOneTimeOperations=function(){if(!this.bColumnsOrdered){this.bColumnsOrdered=true;this._orderColumns();}};z.prototype._onAfterTableCreated=function(Y){if(Y&&this._fResolve){this._fResolve(this);}else if(this._fReject){this._fReject(this);}delete this._fResolve;delete this._fReject;};z.prototype._onAfterFullInitialization=function(Y){if(Y&&this._fnResolveFullInit){this._fnResolveFullInit(this);}else if(this._fnRejectFullInit){this._fnRejectFullInit(this);}delete this._fnResolveFullInit;delete this._fnRejectFullInit;};z.prototype._createContent=function(){this._createToolbar();this._createTable();this._updateRowAction();this.getColumns().forEach(this._insertInnerColumn,this);this.setAggregation("_content",this._oTable);this._onAfterTableCreated(true);var Y=this.initialized().then(function(){this.initPropertyHelper(P);var Z=this.getCreationRow();if(Z){Z.update();}if(this.getAutoBindOnInit()){this.checkAndRebind();}return this.awaitPropertyHelper();}.bind(this));Promise.all([Y,this._pDelegatePreInit]).then(function(){delete this._pDelegatePreInit;this._bFullyInitialized=true;this._onAfterFullInitialization(true);}.bind(this));};z.prototype.setHeader=function(Y){this.setProperty("header",Y,true);this._updateHeaderText();this._updateExportState(true);return this;};z.prototype.setHeaderVisible=function(Y){this.setProperty("headerVisible",Y,true);if(this._oTitle){this._oTitle.setWidth(this.getHeaderVisible()?undefined:"0px");}return this;};z.prototype.setEnableExport=function(Y){if(Y!==this.getEnableExport()){this.setProperty("enableExport",Y,true);if(Y&&!this._oExportButton&&this._oToolbar){this._oToolbar.addEnd(this._getExportButton());}else if(this._oExportButton){this._oExportButton.setVisible(Y);}}return this;};z.prototype._createToolbar=function(){if(!this._oToolbar){this._oTitle=new b(this.getId()+"-title",{text:this.getHeader(),width:this.getHeaderVisible()?undefined:"0px",level:this.getHeaderLevel()});this._oToolbar=new A(this.getId()+"-toolbar",{design:t.Transparent,style:this._getStringType()===r.ResponsiveTable?u.Standard:u.Clear,begin:[this._oTitle],end:[this._getP13nButtons(),this._getExportButton()]});}return this._oToolbar;};z.prototype._getVisibleProperties=function(){var Y=[],Z;this.getColumns().forEach(function($,_){Z=$&&$.getDataProperty();if(Z){Y.push({name:Z});}});return Y;};z.prototype.getConditions=function(){return this.getInbuiltFilter()?this.getInbuiltFilter().getConditions():[];};z.prototype._getSortedProperties=function(){return this.getSortConditions()?this.getSortConditions().sorters:[];};z.prototype._getGroupedProperties=function(){return this.getGroupConditions()?this.getGroupConditions().groupLevels:[];};z.prototype._getAggregatedProperties=function(){return this.getAggregateConditions()?this.getAggregateConditions():{};};function W(Y){var Z=Y.getFilterConditions();return Object.keys(Z).filter(function($){return Z[$].length>0;});}z.prototype.getCurrentState=function(){var Y={};var Z=this.getP13nMode();if(Z.indexOf("Column")>-1){Y.items=this._getVisibleProperties();}if(this.isSortingEnabled()){Y.sorters=this._getSortedProperties();}if(this.isFilteringEnabled()){Y.filter=this.getFilterConditions();}if(this.isGroupingEnabled()){Y.groupLevels=this._getGroupedProperties();}if(this.isAggregationEnabled()){Y.aggregations=this._getAggregatedProperties();}return Y;};z.prototype.isFilteringEnabled=function(){return this.getP13nMode().indexOf("Filter")>-1;};z.prototype.isSortingEnabled=function(){return this.getP13nMode().indexOf("Sort")>-1;};z.prototype.isGroupingEnabled=function(){return this.getP13nMode().indexOf("Group")>-1;};z.prototype.isAggregationEnabled=function(){return this.getP13nMode().indexOf("Aggregate")>-1;};z.prototype._getP13nButtons=function(){var Y=this.getP13nMode();var Z=[];if(this.isSortingEnabled()){Z.push(T.createSortButton(this.getId(),[this._showSort,this]));}if(this.isFilteringEnabled()){Z.push(T.createFilterButton(this.getId(),[this._showFilter,this]));}if(Y.indexOf("Column")>-1){Z.push(T.createColumnsButton(this.getId(),[this._showSettings,this]));}if(this.isGroupingEnabled()){Z.push(T.createGroupButton(this.getId(),[this._showGroup,this]));}return Z;};z.prototype._getExportButton=function(){if(!this.getEnableExport()){return null;}var Y={fileName:this.getHeader()};if(!this._cachedExportSettings){this._cachedExportSettings=Y;}if(!this._oExportButton){this._oExportButton=T.createExportButton(this.getId(),{"default":[function(){this._onExport(Y);},this],"exportAs":[this._onExportAs,this]});}this._updateExportState();return this._oExportButton;};z.prototype._updateExportState=function(Y){var Z=this._getRowBinding();if(this._oExportButton){this._oExportButton.setEnabled(!!(Z&&Z.getLength()>0));if(Y&&this._cachedExportSettings){this._cachedExportSettings.fileName=this.getHeader();}}};z.prototype._createExportColumnConfiguration=function(Y){var Z=Y&&Y.splitCells;var $=this.getColumns();return this._fullyInitialized().then(function(){var _=this.getPropertyHelper();var a1=[];$.forEach(function(b1){var c1=_.getColumnExportSettings(b1,Z);a1=a1.concat(c1);},this);return[a1,_];}.bind(this));};z.prototype._onExport=function(Y){return this._createExportColumnConfiguration(Y).then(function(Z){var $=Z[0];var _=Z[1];if(!$||!$.length){sap.ui.require(["sap/m/MessageBox"],function(c1){c1.error(e.getLibraryResourceBundle("sap.ui.mdc").getText("table.NO_COLS_EXPORT"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});}.bind(this));return;}var a1=this._getRowBinding();var b1={workbook:{columns:$},dataSource:a1,fileName:Y?Y.fileName:this.getHeader()};this._loadExportLibrary().then(function(){sap.ui.require(["sap/ui/export/ExportUtils","sap/ui/export/Spreadsheet"],function(c1,d1){var e1=Promise.resolve();if(Y.includeFilterSettings){e1=c1.parseFilterConfiguration(a1,function(f1){return _.getLabel(f1);}).then(function(f1){if(f1){b1.workbook.context={metaSheetName:f1.name,metainfo:[f1]};}});}e1.then(function(){var f1={splitCells:false,includeFilterSettings:false};if(Y){f1.splitCells=Y.splitCells;f1.includeFilterSettings=Y.includeFilterSettings;}var g1=new d1(b1);g1.attachBeforeExport(function(h1){this.fireBeforeExport({exportSettings:h1.getParameter("exportSettings"),userExportSettings:f1});},this);g1.build().finally(function(){g1.destroy();});}.bind(this));}.bind(this));}.bind(this));}.bind(this));};z.prototype._onExportAs=function(){var Y=this;this._loadExportLibrary().then(function(){sap.ui.require(['sap/ui/export/ExportUtils'],function(Z){Z.getExportSettingsViaDialog(Y._cachedExportSettings,Y).then(function($){Y._cachedExportSettings=$;Y._onExport($);});});});};z.prototype._loadExportLibrary=function(){if(!this._oExportLibLoadPromise){this._oExportLibLoadPromise=e.loadLibrary("sap.ui.export",true);}return this._oExportLibLoadPromise;};z.prototype.onkeydown=function(Y){if(Y.isMarked()){return;}if((Y.metaKey||Y.ctrlKey)&&Y.shiftKey&&Y.which===K.E){if(this.getEnableExport()&&this._oExportButton&&this._oExportButton.getEnabled()){this._onExportAs();Y.setMarked();Y.preventDefault();}}if((Y.metaKey||Y.ctrlKey)&&Y.which===K.COMMA){var Z=e.byId(this.getId()+"-settings");if(Z&&Z.getEnabled()&&Z.getVisible()){Z.firePress();Y.setMarked();Y.preventDefault();}}};z.prototype._createTable=function(){var Y=this.getThreshold()>-1?this.getThreshold():undefined;var Z=this.getRowSettings()?this.getRowSettings().getAllSettings():{};if(this._bMobileTable){this._oTable=R.createTable(this.getId()+"-innerTable",{autoPopinMode:true,contextualWidth:"Auto",growing:true,sticky:["ColumnHeaders","HeaderToolbar","InfoToolbar"],itemPress:[this._onItemPress,this],selectionChange:[this._onSelectionChange,this],growingThreshold:Y,noDataText:this._getNoDataText(),headerToolbar:this._oToolbar,ariaLabelledBy:[this._oTitle]});this._oTemplate=R.createTemplate(this.getId()+"-innerTableRow",Z);this._createColumn=z.prototype._createMobileColumn;this._sAggregation="items";this._oTable.bindRows=this._oTable.bindItems;this._oTable.bActiveHeaders=true;this._oTable.attachEvent("columnPress",this._onResponsiveTableColumnPress,this);}else{this._oTable=G.createTable(this.getId()+"-innerTable",{enableBusyIndicator:true,enableColumnReordering:false,threshold:Y,cellClick:[this._onCellClick,this],noData:this._getNoDataText(),extension:[this._oToolbar],ariaLabelledBy:[this._oTitle],plugins:[G.createMultiSelectionPlugin(this,[this._onRowSelectionChange,this])],columnSelect:[this._onGridTableColumnPress,this],rowSettingsTemplate:Z});this._createColumn=z.prototype._createColumn;this._sAggregation="rows";}this._updateTypeSettings();this._updateSelectionBehavior();var $=new D({sourceAggregation:"columns",targetAggregation:"columns",dropPosition:"Between",enabled:this.getP13nMode().indexOf("Column")>-1,drop:[this._onColumnRearrange,this]});$.bIgnoreMetadataCheck=true;this._oTable.addDragDropConfig($);this._oTable.setBusyIndicatorDelay(this.getBusyIndicatorDelay());this._oTable.attachPaste(this._onInnerTablePaste,this);if(this.isFilteringEnabled()){J(this);}};z.prototype._updateSelectionBehavior=function(){var Y=this._bMobileTable?R:G;Y.updateSelection(this);};z.prototype._onColumnRearrange=function(Y){var Z=Y.getParameter("draggedControl");var $=Y.getParameter("droppedControl");if(Z===$){return;}var _=Y.getParameter("dropPosition");var a1=this._oTable.indexOfColumn(Z);var b1=this._oTable.indexOfColumn($);var c1=b1+(_=="Before"?0:1)+(a1<b1?-1:0);T.moveColumn(this,a1,c1);};z.prototype._onColumnPress=function(Y){var Z,$=Y.getParent(),_;Z=$.indexOfColumn(Y);_=this.getColumns()[Z];this._fullyInitialized().then(function(){if(this.isSortingEnabled()){var a1=this.getPropertyHelper().getSortableProperties(_.getDataProperty()).map(function(d1){return new I({text:d1.getLabel(),key:d1.getName()});});if(a1.length>0){if(this._oPopover){this._oPopover.destroy();}this._oPopover=new c({items:[new d({items:a1,sort:[this._onCustomSort,this]})]});Y.addDependent(this._oPopover);}else if(this._oPopover){this._oPopover.destroy();}}var b1=this.getControlDelegate();var c1=b1.addColumnMenuItems&&b1.addColumnMenuItems(this,_);c1&&c1.forEach(function(d1){d1&&this._createPopover(d1,Y);}.bind(this));this._oPopover&&this._oPopover.openBy(Y);}.bind(this));};z.prototype._createPopover=function(Y,Z){if(this._oPopover){this._oPopover.addItem(Y);}else{this._oPopover=new c({items:Y});Z.addDependent(this._oPopover);}};z.prototype._onCustomSort=function(Y){var Z=Y.getParameter("property");T.createSort(this,Z,true);};z.prototype._onCustomGroup=function(Y){T.createGroup(this,Y);};z.prototype._onCustomAggregate=function(Y){T.createAggregation(this,Y);};z.prototype._insertInnerColumn=function(Y,Z){if(!this._oTable){return;}var $=this._createColumn(Y);X(this,Y,$,Z);var _=this.getControlDelegate();_&&_._onColumnChange&&_._onColumnChange(this);if(Z===undefined){this._oTable.addColumn($);}else{this._oTable.insertColumn($,Z);}};z.prototype._orderColumns=function(){var Y,Z=[],$=this.getColumns();$.forEach(function(_){Y=_.getInitialIndex();if(Y>-1){Z.push({index:Y,column:this.removeColumn(_)});}},this);Z.sort(function(_,a1){return _-a1;});Z.forEach(function(_){this.insertColumn(_.column,_.index);},this);};function X(Y,Z,$,_){var a1=Z.getTemplate(true);if(!Y._bMobileTable){var b1=Z.getCreationTemplate(true);[a1,b1].forEach(function(c1){if(!c1){return;}if(c1.setWrapping){c1.setWrapping(false);}if(c1.setRenderWhitespace){c1.setRenderWhitespace(false);}});$.setTemplate(a1);$.setCreationTemplate(b1);}else if(_>=0){Y._oTemplate.insertCell(a1,_);Y._oTable.getItems().forEach(function(c1){c1.insertAggregation("cells",new j(),_,true);});}else{Y._oTemplate.addCell(a1);}}z.prototype._createColumn=function(Y){return G.createColumn(Y.getId()+"-innerColumn",{width:Y.getWidth(),minWidth:Math.round(Y.getMinWidth()*parseFloat(M.BaseFontSize)),hAlign:Y.getHAlign(),label:Y.getColumnHeaderControl(this._bMobileTable)});};z.prototype._createMobileColumn=function(Y){return R.createColumn(Y.getId()+"-innerColumn",{width:Y.getWidth(),autoPopinWidth:Y.getMinWidth(),hAlign:Y.getHAlign(),header:Y.getColumnHeaderControl(this._bMobileTable),importance:Y.getImportance(),popinDisplay:"Inline"});};z.prototype.moveColumn=function(Y,Z){var $;this.removeAggregation("columns",Y,true);this.insertAggregation("columns",Y,Z,true);if(this._oTable){$=this._oTable.removeColumn(Y.getId()+"-innerColumn");this._oTable.insertColumn($,Z);if(this._bMobileTable){this._updateColumnTemplate(Y,Z);}}};z.prototype.removeColumn=function(Y){Y=this.removeAggregation("columns",Y,true);if(this._oTable){var Z=this._oTable.removeColumn(Y.getId()+"-innerColumn");Z.destroy();var $=this.getControlDelegate();$&&$._onColumnChange&&$._onColumnChange(this);if(this._bMobileTable){this._updateColumnTemplate(Y,-1);}}return Y;};z.prototype.addColumn=function(Y){this.addAggregation("columns",Y,true);this._insertInnerColumn(Y);return this;};z.prototype.insertColumn=function(Y,Z){this.insertAggregation("columns",Y,Z,true);this._insertInnerColumn(Y,Z);return this;};z.prototype._updateColumnTemplate=function(Y,Z){var $,_;if(this._oTemplate){$=Y.getTemplate(true);_=this._oTemplate.indexOfCell($);z._removeItemCell(this._oTemplate,_,Z);}if(_>-1){this._oTable.getItems().forEach(function(a1){if(a1.removeCell){z._removeItemCell(a1,_,Z);}});}};z._removeItemCell=function(Y,Z,$){var _=Y.removeCell(Z);if(_){if($>-1){Y.insertCell(_,$);}else{_.destroy();}}};z.prototype._onItemPress=function(Y){this.fireRowPress({bindingContext:Y.getParameter("listItem").getBindingContext()});};z.prototype._onSelectionChange=function(Y){var Z=Y.getParameter("selectAll");this.fireSelectionChange({bindingContext:Y.getParameter("listItem").getBindingContext(),selected:Y.getParameter("selected"),selectAll:Z});if(Z){var $=this.getRowBinding();if($&&this._oTable){var _=$.getLength();var a1=this._oTable.getItems().length;var b1=$.isLengthFinal();if(a1!=_||!b1){y("table.SELECTION_LIMIT_MESSAGE",[a1]);}}}};z.prototype._onResponsiveTableColumnPress=function(Y){this._onColumnPress(Y.getParameter("column"));};z.prototype._onCellClick=function(Y){this.fireRowPress({bindingContext:Y.getParameter("rowBindingContext")});};z.prototype._onRowActionPress=function(Y){var Z=Y.getParameter("row");this.fireRowPress({bindingContext:Z.getBindingContext()});};z.prototype._onRowSelectionChange=function(Y){if(!this._bSelectionChangedByAPI){this.fireSelectionChange({bindingContext:Y.getParameter("rowContext"),selected:Y.getSource().isIndexSelected(Y.getParameter("rowIndex")),selectAll:Y.getParameter("selectAll")});}};z.prototype._onGridTableColumnPress=function(Y){Y.preventDefault();this._onColumnPress(Y.getParameter("column"));};z.prototype.getSelectedContexts=function(){if(this._oTable){if(this._bMobileTable){return this._oTable.getSelectedContexts();}var Y=this._oTable.getPlugins()[0].getSelectedIndices();return Y.map(function(Z){return this._oTable.getContextByIndex(Z);},this);}return[];};z.prototype.clearSelection=function(){if(this._oTable){if(this._bMobileTable){this._oTable.removeSelections(true);}else{this._bSelectionChangedByAPI=true;this._oTable.getPlugins()[0].clearSelection();this._bSelectionChangedByAPI=false;}}};z.prototype._registerInnerFilter=function(Y){Y.attachSearch(function(){this.rebind();},this);};z.prototype.isTableBound=function(){return this._oTable?this._oTable.isBound(this._bMobileTable?"items":"rows"):false;};z.prototype.bindRows=function(){if(!this.bDelegateInitialized||!this._oTable){return;}var Y={};this.getControlDelegate().updateBindingInfo(this,this.getPayload(),Y);if(Y&&Y.path){this._oTable.setShowOverlay(false);if(this._bMobileTable&&this._oTemplate){Y.template=this._oTemplate;}else{delete Y.template;}if(!Y.parameters){Y.parameters={};}Y.sorter=this._getSorters();z._addBindingListener(Y,"dataRequested",this._onDataRequested.bind(this));z._addBindingListener(Y,"dataReceived",this._onDataReceived.bind(this));z._addBindingListener(Y,"change",this._onBindingChange.bind(this));this._updateColumnsBeforeBinding(Y);this.getControlDelegate().rebindTable(this,Y);this._updateInnerTableNoDataText();}};z.prototype._onDataRequested=function(){this._bIgnoreChange=true;};z.prototype._onDataReceived=function(){this._bIgnoreChange=false;this._updateHeaderText();this._updateExportState();};z.prototype._onBindingChange=function(){if(this._bIgnoreChange){return;}this._updateHeaderText();};z.prototype._updateHeaderText=function(){var Y,Z;if(!this._oNumberFormatInstance){this._oNumberFormatInstance=N.getFloatInstance();}if(this._oTitle&&this.getHeader()){Y=this.getHeader();if(this.getShowRowCount()){Z=this._getRowCount();var $=this._oNumberFormatInstance.format(Z);if($){Y+=" ("+$+")";}}this._oTitle.setText(Y);}if(!this._bIgnoreChange&&this._bAnnounceTableUpdate){this._bAnnounceTableUpdate=false;this._announceTableUpdate(Z);}};z.prototype._announceTableUpdate=function(Y){var Z=i.getInstance();if(Z){var $=e.getLibraryResourceBundle("sap.ui.mdc");var _=this.getHeader();if(Y===undefined&&this._getRowCount()>0){Z.announce($.getText("table.ANNOUNCEMENT_TABLE_UPDATED",[_]));}else if(Y>1){Z.announce($.getText("table.ANNOUNCEMENT_TABLE_UPDATED_MULT",[_,Y]));}else if(Y===1){Z.announce($.getText("table.ANNOUNCEMENT_TABLE_UPDATED_SING",[_,Y]));}else{Z.announce($.getText("table.ANNOUNCEMENT_TABLE_UPDATED_NOITEMS",[_]));}}};z.prototype._updateColumnsBeforeBinding=function(Y){var Z=[].concat(Y.sorter||[]);var $=this.getColumns();var _=this._bMobileTable;var a1=this.getPropertyHelper();$.forEach(function(b1){var c1=e.byId(b1.getId()+"-innerColumn");var d1=a1.getSortableProperties(b1.getDataProperty()).map(function(g1){return g1.getPath();});if(d1.length>0){var e1=Z.find(function(e1){return d1.indexOf(e1.sPath)>-1;});var f1=e1&&e1.bDescending?"Descending":"Ascending";if(_){c1.setSortIndicator(e1?f1:"None");}else{c1.setSorted(!!e1).setSortOrder(f1);}}});};z.prototype._getRowCount=function(){var Y=this._getRowBinding();if(!Y){return 0;}var Z;if(Y.isLengthFinal()){Z=Y.getLength();}if(Z<0||Z==="0"){Z=0;}return Z;};z.prototype.getRowBinding=function(){return this._getRowBinding();};z.prototype._getRowBinding=function(){if(this._oTable){return this._oTable.getBinding(this._sAggregation);}};z._addBindingListener=function(Y,Z,$){if(!Y.events){Y.events={};}if(!Y.events[Z]){Y.events[Z]=$;}else{var _=Y.events[Z];Y.events[Z]=function(){$.apply(this,arguments);_.apply(this,arguments);};}};z.prototype.rebindTable=function(){this.rebind();};z.prototype.rebind=function(){if(this._bFullyInitialized){this.bindRows();}else{this._fullyInitialized().then(this.rebind.bind(this));}};z.prototype._showSettings=function(Y){T.showPanel(this,"Columns",Y.getSource());};z.prototype._showSort=function(Y){T.showPanel(this,"Sort",Y.getSource());};z.prototype._showFilter=function(Y){T.showPanel(this,"Filter",Y.getSource());};z.prototype._showGroup=function(Y){T.showPanel(this,"Group",Y.getSource());};z.prototype._getSorters=function(){var Y=this.getSortConditions()?this.getSortConditions().sorters:[];var Z=[],$=this.getPropertyHelper();Y.forEach(function(_){var a1=$.getPath(_.name);Z.push(new S(a1,_.descending));});return Z;};z.prototype._onInnerTablePaste=function(Y){this.firePaste({data:Y.getParameter("data")});};z.prototype.exit=function(){if(this._oTemplate){this._oTemplate.destroy();}this._oTemplate=null;this._oTable=null;if(this._oToolbar&&!this._bTableExists){this._oToolbar.destroy();}this._oToolbar=null;this._oTitle=null;this._oNumberFormatInstance=null;B.forEach(function(Y){var Z=g(Y),$="_o"+Z;this[$]=null;},this);this._oTableReady=null;this._fReject=null;this._fResolve=null;this._pFullInitialize=null;this._fnRejectFullInit=null;this._fnResolveFullInit=null;C.prototype.exit.apply(this,arguments);};return z;});
