/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/mdc/condition/FilterOperatorUtil','./BaseController','sap/ui/mdc/p13n/P13nBuilder','sap/ui/mdc/p13n/FlexUtil','sap/base/Log'],function(F,B,P,a,L){"use strict";var b=B.extend("sap.ui.mdc.p13n.subcontroller.FilterController");b.prototype.getCurrentState=function(){var c=this.getAdaptationControl().getCurrentState();return c.hasOwnProperty("filter")?c.filter:{};};b.prototype.getContainerSettings=function(){return{title:sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc").getText("filter.PERSONALIZATION_DIALOG_TITLE"),afterClose:function(e){var d=e.getSource();if(d){d.removeAllContent();d.destroy();}}};};b.prototype.getChangeOperations=function(){return{add:"addCondition",remove:"removeCondition"};};b.prototype.getBeforeApply=function(A){var p=A?A.createConditionChanges():Promise.resolve([]);return p;};b.prototype.getFilterControl=function(){return this.getAdaptationControl().isA("sap.ui.mdc.IFilter")?this.getAdaptationControl():this.getAdaptationControl()._oP13nFilter;};b.prototype.initializeUI=function(){return this.getAdaptationUI().then(function(A){return A.createFilterFields();});};b.prototype.sanityCheck=function(s){b.checkConditionOperatorSanity(s);return s;};b.checkConditionOperatorSanity=function(c){for(var f in c){var C=c[f];for(var i=0;i<C.length;i++){var o=C[i];var O=o.operator;if(!F.getOperator(O)){C.splice(i,1);if(c[f].length==0){delete c[f];}L.warning("The provided conditions for field '"+f+"' contain unsupported operators - these conditions will be neglected.");}}}};b.prototype.getAdaptationUI=function(r){return this.getAdaptationControl().retrieveInbuiltFilter();};b.prototype.getDelta=function(p){return a.getConditionDeltaChanges(p);};b.prototype.setP13nData=function(p){var e=this.getCurrentState()||{};var o=P.prepareAdaptationData(p,function(i,c){var n=c.name;var E=e[n];i.isFiltered=E&&E.length>0?true:false;return!(c.filterable===false);});P.sortP13nData({visible:undefined,position:undefined},o.items);this.oP13nData=o;};return b;});
