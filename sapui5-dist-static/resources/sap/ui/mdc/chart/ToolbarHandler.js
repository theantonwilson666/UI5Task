/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/library","../ActionToolbar","sap/m/Title","sap/m/OverflowToolbarButton","sap/m/OverflowToolbarToggleButton","sap/ui/mdc/chart/ChartTypeButton","sap/ui/mdc/chart/ChartSettings","sap/ui/core/library","sap/ui/Device","sap/ui/core/ShortcutHintsMixin"],function(M,A,T,O,a,C,b,c,D,S){"use strict";var H=c.aria.HasPopup;var d=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");var e={createToolbar:function(o,u,i){u=u||[];if(!o.getAggregation("_toolbar")){var t=new A(o.getId()+"--toolbar",{design:"Transparent",begin:[new T(o.getId()+"-title",{text:o.getHeader()})],actions:u});o.setAggregation("_toolbar",t);if(i){this.initializeToolbarNotBound(o);}else{this.updateToolbar(o);}}},initializeToolbarNotBound:function(o){var t=o.getAggregation("_toolbar");if(!t){return;}if(!o.getIgnoreToolbarActions().length||o.getIgnoreToolbarActions().indexOf(M.ChartToolbarActionType.ZoomInOut)){var z,Z;z=new O({tooltip:d.getText("chart.TOOLBAR_ZOOM_IN"),icon:"sap-icon://zoom-in",enabled:false});Z=new O({tooltip:d.getText("chart.TOOLBAR_ZOOM_OUT"),icon:"sap-icon://zoom-out",enabled:false});t.addEnd(z);t.addEnd(Z);}if(!o.getIgnoreToolbarActions().length||o.getIgnoreToolbarActions().indexOf(M.ChartToolbarActionType.DrillDownUp)<0){o._oDrillDownBtn=new O(o.getId()+"-drillDown",{icon:"sap-icon://drill-down",enabled:false});t.addEnd(o._oDrillDownBtn);}if(!o.getIgnoreToolbarActions().length||o.getIgnoreToolbarActions().indexOf(M.ChartToolbarActionType.Legend)<0){t.addEnd(new a({type:"Transparent",text:d.getText("chart.LEGENDBTN_TEXT"),icon:"sap-icon://legend",enabled:false,pressed:false}));}var p=o.getP13nMode()||[];if(p.indexOf("Item")>-1){t.addEnd(new O(o.getId()+"-chart_settings",{icon:"sap-icon://action-settings",ariaHasPopup:H.ListBox,enabled:false}));}if(p.indexOf("Sort")>-1){t.addEnd(new O(o.getId()+"-sort_settings",{icon:"sap-icon://sort",ariaHasPopup:H.ListBox,enabled:false}));}if(p.indexOf("Type")>-1){t.addEnd(new O({id:o.getId()+"-btnChartType",icon:'sap-icon://vertical-bar-chart',enabled:false}));}t.setEnabled(false);},updateToolbar:function(o){var t=o.getAggregation("_toolbar");if(!t){return;}t.destroyEnd();if(!o.getIgnoreToolbarActions().length||o.getIgnoreToolbarActions().indexOf(M.ChartToolbarActionType.ZoomInOut)){var i=o.getAggregation("_chart"),z,Z;z=new O({tooltip:d.getText("chart.TOOLBAR_ZOOM_IN"),text:d.getText("chart.TOOLBAR_ZOOM_IN"),icon:"sap-icon://zoom-in",enabled:"{= ${$mdcChart>/_chart/getZoomInfo/enabled} && ${$mdcChart>/_chart/getZoomInfo/currentZoomLevel} < 1}",press:function g(f){this.handleZoomIn(i,z,Z);}.bind(this)});Z=new O({tooltip:d.getText("chart.TOOLBAR_ZOOM_OUT"),text:d.getText("chart.TOOLBAR_ZOOM_OUT"),icon:"sap-icon://zoom-out",enabled:"{= ${$mdcChart>/_chart/getZoomInfo/enabled} && ${$mdcChart>/_chart/getZoomInfo/currentZoomLevel} > 0}",press:function g(f){this.handleZoomOut(i,z,Z);}.bind(this)});t.addEnd(z);t.addEnd(Z);if(i){i.attachRenderComplete(function h(f){var g=i.getZoomInfo();this.handleInnerChartRenderCompleted(g,z,Z);},this);}}if(!o.getIgnoreToolbarActions().length||o.getIgnoreToolbarActions().indexOf(M.ChartToolbarActionType.DrillDownUp)<0){o._oDrillDownBtn=new O(o.getId()+"-drillDown",{icon:"sap-icon://drill-down",tooltip:d.getText("chart.CHART_DRILLDOWN_TITLE"),text:d.getText("chart.CHART_DRILLDOWN_TITLE"),press:[o._showDrillDown,o]});t.addEnd(o._oDrillDownBtn);}if(!o.getIgnoreToolbarActions().length||o.getIgnoreToolbarActions().indexOf(M.ChartToolbarActionType.Legend)<0){t.addEnd(new a({type:"Transparent",text:d.getText("chart.LEGENDBTN_TEXT"),tooltip:d.getText("chart.LEGENDBTN_TOOLTIP"),icon:"sap-icon://legend",pressed:"{$mdcChart>/legendVisible}"}));}var p=o.getP13nMode()||[];if(p.indexOf("Item")>-1){var B=new O(o.getId()+"-chart_settings",{icon:"sap-icon://action-settings",tooltip:d.getText('chart.PERSONALIZATION_DIALOG_TITLE'),text:d.getText('chart.PERSONALIZATION_DIALOG_TITLE'),press:function(E){var s=E.getSource();o._getPropertyData().then(function(P){b.showPanel(o,"Chart",s,P);});},ariaHasPopup:H.ListBox});t.addEnd(B);S.addConfig(B,{addAccessibilityLabel:true,messageBundleKey:D.os.macintosh?"mdc.PERSONALIZATION_SHORTCUT_MAC":"mdc.PERSONALIZATION_SHORTCUT"},o);}if(p.indexOf("Sort")>-1){t.addEnd(new O(o.getId()+"-sort_settings",{icon:"sap-icon://sort",tooltip:d.getText('sort.PERSONALIZATION_DIALOG_TITLE'),text:d.getText('sort.PERSONALIZATION_DIALOG_TITLE'),press:function(E){var s=E.getSource();o._getPropertyData().then(function(P){b.showPanel(o,"Sort",s,P);});},ariaHasPopup:H.ListBox}));}if(p.indexOf("Type")>-1){t.addEnd(new C(o));}t.setEnabled(true);},handleInnerChartRenderCompleted:function(z,Z,o){this.toggleZoomButtonsEnabledState(z,Z,o);},handleZoomIn:function(i,z,Z){i.zoom({direction:"in"});var o=i.getZoomInfo();this.toggleZoomButtonsEnabledState(o,z,Z);},handleZoomOut:function(i,z,Z){i.zoom({direction:"out"});var o=i.getZoomInfo();this.toggleZoomButtonsEnabledState(o,z,Z);},toggleZoomButtonsEnabledState:function(z,Z,o){var v=z.currentZoomLevel;if(v==null){Z.setEnabled(false);o.setEnabled(false);return;}if(v===0){Z.setEnabled(true);o.setEnabled(false);if(o.getFocusDomRef()===document.activeElement){Z.focus();}return;}if(v===1){o.setEnabled(true);Z.setEnabled(false);if(Z.getFocusDomRef()===document.activeElement){o.focus();}return;}Z.setEnabled(true);o.setEnabled(true);}};return e;});
