/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Component","sap/ui/model/resource/ResourceModel","sap/ui/thirdparty/jquery"],function(C,R,q){"use strict";var S=C.extend("sap.webanalytics.core.SAPWebAnalyticsFLPPlugin.Component",{metadata:{manifest:"json",i18n:"./i18n/i18n.properties",includes:["./css/style.css"]},init:function(){var p=this.getComponentData().config;var a="",T="",U="",A="",L="",b="",P="";a=p.SWA_PUB_TOKEN;T=p.SWA_BASE_URL;A=p.ANON_TRK_ON_DENY;L=p.SWA_CONSENT_LANGUAGE;b=p.SWA_CONSENT_STYLE;P=p.SWA_PRIVACY_LINK;if(p.SWA_USER==='true')U=sap.ushell.Container.getUser().getEmail();if(a!==""&&T!==""){var s=[a,T,U,A,L,b,P];this.setModel(new R({bundleName:"sap.webanalytics.core.SAPWebAnalyticsFLPPlugin.i18n.i18n"}),"i18n");this.loadSWAObject(s);this.loadConsentTextOnDemand();this.loadWebGUI();}},loadConsentTextOnDemand:function(){var t=this;var r=this._getRenderer();var e={title:t.getModel("i18n").getProperty("CUSTOM_CONSENT_OPTION"),icon:"sap-icon://approvals",value:function(){return q.Deferred().resolve("");},content:function(){var s=t.createContent(window.swa.isConsentBannerEnabled());return q.Deferred().resolve(s);},onSave:function(){if(window.swa.isConsentBannerEnabled()){if(window.swaConsentDecision===undefined)window.swaConsentDecision=window.sap.ui.getCore().getControl("swaConsentCheckBox").getSelected();if(window.swa.anonymousTrackingConsent&&window.swaConsentDecision){window.swa.saveConsentDecision(true);}else if(!window.swaConsentDecision&&window.swa.anonymousTrackingConsent){window.swa.saveConsentDecision(false);}else if(!window.swa.anonymousTrackingConsent&&window.swaConsentDecision&&!window.swa.getTrackingStatus()){window.swa.saveConsentDecision(true);}else if(!window.swa.anonymousTrackingConsent&&!window.swaConsentDecision&&window.swa.getTrackingStatus()){window.swa.saveConsentDecision(false);}}return q.Deferred().resolve("");},onCancel:function(){if(window.swa.isConsentBannerEnabled()){if(window.swa.getTrackingStatus()===true)sap.ui.getCore().getControl("swaConsentCheckBox").setSelected(true);else sap.ui.getCore().getControl("swaConsentCheckBox").setSelected(false);}}};r.then(function(o){o.addUserPreferencesEntry(e);},true,false,[sap.ushell.renderers.fiori2.RendererExtensions.LaunchpadState.Home]);},createContent:function(i){var s=new sap.m.Page("swaConsent",{content:"",showHeader:false});if(!i){var h=new sap.m.HBox("status",{});var a=new sap.m.Label("trackStatus",{text:window.swa.trackingStatusText});a.addStyleClass("statusLabel");h.addItem(a);var t=(window.swa.getTrackingStatus()===false)?window.swa.trackOffStatus:(window.swa.getTrackingStatus()===true)?window.swa.trackOnStatus:window.swa.trackAnonymousStatus;var b=new sap.m.Text("swaStatusText",{text:t});b.addStyleClass("trackStatus");h.addItem(b);s.addContent(h);}else{var c=(window.swa.anonymousTrackingConsent)?window.swa.anonymousConsentText:window.swa.consentOptInText;if(c.indexOf("<a")!==-1)c=c.substring(0,c.indexOf("<a")-1);var d=new sap.m.Text("swaConsentOptInOutText",{text:c});s.addContent(d);d.addStyleClass("text");if(window.swa.privacyLink!==null){var l=new sap.m.Link("swaPrivacyLink",{href:window.swa.privacyLink,target:"_blank",text:window.swa.privacyLinkText});l.addStyleClass("link");s.addContent(l);}var e=new sap.m.CheckBox("swaConsentCheckBox",{text:window.swa.consentAllowButton,select:this.onConsentChange,selected:(window.swa.getTrackingStatus()===true)?true:false});e.addStyleClass("checkBox");s.addContent(e);}return s;},onConsentChange:function(e){window.swaConsentDecision=(e.getSource().getSelected())?true:false;},_getRenderer:function(){var t=this,d=new q.Deferred(),r;t._oShellContainer=q.sap.getObject("sap.ushell.Container");if(!t._oShellContainer){d.reject("Illegal state: shell container not available; this component must be executed in a unified shell runtime context.");}else{r=t._oShellContainer.getRenderer();if(r){d.resolve(r);}else{t._onRendererCreated=function(e){r=e.getParameter("renderer");if(r){d.resolve(r);}else{d.reject("Illegal state: shell renderer not available after recieving 'rendererLoaded' event.");}};t._oShellContainer.attachRendererCreatedEvent(t._onRendererCreated);}}return d.promise();},loadSWAObject:function(a){window.swa={pubToken:a[0],baseUrl:a[1],subSiteId:this.setSubSiteId,owner:a[2],anonymousTrackingConsent:(a[3]==='true')?1:0,custom1:{ref:this.getCustomAttributes(a[2])[0]},custom2:{ref:this.getCustomAttributes(a[2])[1]},custom3:{ref:this.getCustomAttributes(a[2])[2]},custom4:{ref:this.getCustomAttributes(a[2])[3]},custom5:{ref:this.getCustomAttributes(a[2])[4]}};if(a[4]!==""&&a[4]!==undefined)window.swa.consentFormLanguage=a[4];if(a[5]!==""&&a[5]!==undefined)window.swa.consentStyle=a[5];if(a[6]!==""&&a[6]!==undefined)window.swa.privacyLink=a[6];var d=document,g=d.createElement("script"),s=d.getElementsByTagName("script")[0];g.type="text/javascript";g.defer=true;g.async=true;g.src=sap.ui.require.toUrl("sap/webanalytics/core/tracker/js/track.js");s.parentNode.insertBefore(g,s);if(sap.ui.version<"1.65.0"){window.onhashchange=function(){window.swa.trackLoad();};}},getCustomAttributes:function(u){var c=[];if(typeof sap!=="undefined"){if(u!=='')c[0]=sap.ushell.Container.getUser().getId();else c[0]="";c[1]=sap.ushell.Container.getLogonSystem().getClient();c[2]=sap.ushell.Container.getLogonSystem().getName();c[3]=(sap.ushell.services.AppConfiguration.getCurrentApplication()!==null)?sap.ushell.services.AppConfiguration.getCurrentApplication().inboundPermanentKey:"";c[4]=(sap.ushell.services.AppConfiguration.getCurrentApplication()!==null)?sap.ushell.services.AppConfiguration.getCurrentApplication().ui5ComponentName:"";}return c;},loadWebGUI:function(){var t=sap.ui.require.toUrl("sap/webanalytics/core/tracker/js/track.js");if(window.addEventListener){window.addEventListener("message",function(e){var g=JSON.parse(e.data);if(g.service==="sap.its.readyToListen"&&g.type==="announce"){var s=escape(window.parent.document.cookie);var b={"type":"request","service":"sap.its.trackSWA","pubToken":window.swa.pubToken,"owner":window.swa.owner,"baseUrl":window.swa.baseUrl,"trackAnonymous":window.swa.anonymousTrackingConsent,"message":"Response from SWA","isConsentGiven":true,"cookieVal":s,"trackingResourceUrl":t};e.source.postMessage(JSON.stringify(b),e.origin);}});}},setSubSiteId:function(){var s="";if(window.location.href.substring(window.location.href.indexOf("#"))!==-1){s=window.location.href.substring(window.location.href.indexOf("#")+1);}if(s.indexOf("&")!==-1){s=s.substring(0,s.indexOf("&"));}return(s!=="")?s:undefined;}});return S;});
