sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/library","sap/m/MessageBox","sap/apf/cloudFoundry/ui/utils/LaunchPageUtils","sap/ui/core/Fragment","sap/ui/core/IconPool","sap/ui/core/ValueState"],function(C,J,L,M,a,F,I,V){"use strict";var P="sap.apf.cloudFoundry.ui.sharedialog";return C.extend(P+".controller.ShareDialog",{onInit:function(){var c=this.getOwnerComponent();this.oCoreApi=c.oCoreApi;var v=this.getView();var o=v.getViewData();if(o.oController.configEditor.isSaved()){this.initializeDialog();}else{M.warning(this.translate("unsavedStateWarning"),{onClose:function(){v.destroy();this.destroy();}.bind(this)});}},initializeDialog:function(){var d=this.getDialog();var v=this.getView();var o=v.getViewData();this.config=o.oController._getNodeData({},"configuration").data;this.runtimeLink=a.generateRuntimeLink(this.config.AnalyticalConfiguration);this.ui=new J({TileHeader:this.config.name,TileHeaderDefault:this.config.name,TileSubheader:this.translate("bookmarkSubheaderDefault"),TileIcon:"",TileIconValueState:V.None,TileGroup:""});v.setModel(this.ui,"ui");this.updateTileTooltip();var t=v.byId("tilePreview");t.addDelegate({onAfterRendering:function(){var i=t.getDomRef().id;jQuery("#"+i).attr("tabindex",-1);}});d.open();},updateTileTooltip:function(){var t="";t+=this.translate("bookmarkTooltipHeader",this.ui.getProperty("/TileHeader"));t+="\n"+this.translate("bookmarkTooltipSubheader",this.ui.getProperty("/TileSubheader"));var i=this.ui.getProperty("/TileIcon");if(i!==""){t+="\n"+this.translate("bookmarkTooltipIcon",i);}var g=this.ui.getProperty("/TileGroup");if(g!==""){t+="\n"+this.translate("bookmarkTooltipGroup",g);}this.ui.setProperty("/TileTooltip",t);},selectText:function(c,s,e){var b=document.getElementById(c.getIdForLabel());b.select();b.setSelectionRange(s,e);},showLinkDialog:function(b){var t=this;var v=this.getView();F.load({id:v.getId(),name:P+".fragment.ShowLinkDialog",controller:{getView:function(){return v.byId("showLinkDialog");},translate:t.translate.bind(t),onBeforeOpen:function(){var c=v.byId("textAreaLink");c.setValue(b);},onAfterOpen:function(){var c=v.byId("textAreaLink");t.selectText(c,0,b.length);},onAfterClose:function(){this.getView().destroy();v.removeDependent(this.getView());},onButtonClosePress:function(){this.getView().close();}}}).then(function(d){v.addDependent(d);d.open();});},getBookmarkLink:function(){var v=this.getView();var h=v.byId("inputHeader").getValue();var s=v.byId("inputSubheader").getValue();var i=v.byId("inputIcon").getValue();var g=v.byId("inputGroup").getValue();var b=I.getIconInfo(i);if(b){i=b.uri;}else{i="";}return a.buildBookmarkLink(this.runtimeLink,h,s,i,g);},onShowLink:function(){var b=this.getBookmarkLink();this.showLinkDialog(b);},onSendEmail:function(){var h=this.ui.getProperty("/TileHeader");var b=this.getBookmarkLink();var H=this.translate("helpLink");var s=this.translate("emailTemplateSubject",h);var t=this.translate("emailTemplateText",h,b,H);L.URLHelper.triggerEmail("",s,t);},onMarkFavorite:function(){var h=this.ui.getProperty("/TileHeader");var s=this.ui.getProperty("/TileSubheader");var i=this.ui.getProperty("/TileIcon");var g=this.ui.getProperty("/TileGroup");a.setBookmarkTile(this.runtimeLink,h,s,i,g);},onHeaderChange:function(c){var h=c.getParameters().value;if(h==""){h=this.config.name;}this.ui.setProperty("/TileHeader",h);this.updateTileTooltip();},onSubheaderChange:function(c){var s=c.getParameters().value;if(s==""){s=this.translate("bookmarkSubheaderDefault");}this.ui.setProperty("/TileSubheader",s);this.updateTileTooltip();},onIconChange:function(c){var i=c.getParameters().value;var b=I.getIconInfo(i);if(i===""){this.ui.setProperty("/TileIcon","");this.ui.setProperty("/TileIconValueState",V.None);}else if(b){this.ui.setProperty("/TileIcon",b.uri);this.ui.setProperty("/TileIconValueState",V.None);}else{this.ui.setProperty("/TileIcon","");this.ui.setProperty("/TileIconValueState",V.Error);}this.updateTileTooltip();},onGroupChange:function(c){var g=c.getParameters().value;this.ui.setProperty("/TileGroup",g);this.updateTileTooltip();},onClose:function(){this.getDialog().close();this.getDialog().destroy();this.getView().destroy();this.destroy();},getDialog:function(){var v=this.getView();var d=v.byId("shareDialog");if(!d){d=sap.ui.xmlfragment(v.getId(),P+".fragment.ShareDialog",this);v.addDependent(d);}return d;},translate:function(k){return this.oCoreApi.getText(k,Array.prototype.slice.call(arguments,1));}});});
