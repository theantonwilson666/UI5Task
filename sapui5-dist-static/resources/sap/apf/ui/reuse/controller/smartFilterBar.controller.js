/*!
* SAP APF Analysis Path Framework
* 
 * (c) Copyright 2012-2018 SAP SE. All rights reserved
*/
sap.ui.define(['sap/ui/core/mvc/Controller','sap/ui/model/odata/ODataUtils','sap/ui/model/odata/v2/ODataModel','sap/ui/model/odata/CountMode'],function(B,O,a,C){'use strict';return B.extend("sap.apf.ui.reuse.controller.smartFilterBar",{onInit:function(){var c=this;var s=c.getView().getViewData().oSmartFilterBarConfiguration.service;var b=c.getView().getViewData().oCoreApi.getAnnotationsForService(s);var p={annotationURI:b,json:true};if(b&&b.length>0){p.loadAnnotationsJoined=true;}var d=c.getView().getViewData().oCoreApi.getStartParameterFacade().getSapSystem();if(d){s=O.setOrigin(s,{force:true,alias:d});}var m=new a(s,p);m.getMetaModel().loaded().then(function(){c.getView().getViewData().oCoreApi.getMetadata(s).done(function(e){if(e.getAllEntitySetsExceptParameterEntitySets().indexOf(c.getView().getViewData().oSmartFilterBarConfiguration.entitySet)<0){c.getView().getViewData().oCoreApi.putMessage(c.getView().getViewData().oCoreApi.createMessageObject({code:"5053",aParameters:[c.getView().getViewData().oSmartFilterBarConfiguration.entitySet,s]}));}m.setDefaultCountMode(C.None);c.byId("idAPFSmartFilterBar").setModel(m);});});m.attachMetadataFailed(function(){c.getView().getViewData().oCoreApi.putMessage(c.getView().getViewData().oCoreApi.createMessageObject({code:"5052",aParameters:[s]}));});},afterInitialization:function(){this.handleSplitterSize();this.setFilterData();this.validateFilters();this.registerSFBInstanceWithCore();},registerSFBInstanceWithCore:function(){var c=this;c.getView().getViewData().oCoreApi.registerSmartFilterBarInstance(c.byId("idAPFSmartFilterBar"));},handlePressOfGoButton:function(){var c=this;var s=this.byId("idAPFSmartFilterBar");if(!s._apfOpenPath&&c.getView().getViewData().oCoreApi.getActiveStep()){c.getView().getViewData().oUiApi.selectionChanged(true);}delete s._apfOpenPath;},setFilterData:function(){var c=this;var s=this.byId("idAPFSmartFilterBar");var n=c.getView().getViewData().oCoreApi.getStartParameterFacade().getAnalyticalConfigurationId();var b=c.getView().getViewData().oCoreApi.getStartParameterFacade().getXappStateId();var u=s.getUiState();var m=s.mProperties;s.setUiState(u,m);if((n!==undefined)||((b!==null)&&(b!==undefined))){var i=c.getView().getViewData().oCoreApi;var o=i.getComponent();var d=sap.ushell.Container.getService("CrossApplicationNavigation");var S=d.getStartupAppState(o);S.done(function(A){var f=A.getData();if(f){f=JSON.parse(JSON.stringify(f));var g=f.selectionVariant;var U=new sap.ui.comp.state.UIState({selectionVariant:g});var s=this.byId("idAPFSmartFilterBar");s.setUiState(U,{replace:true,strictMode:false});}}.bind(this));var e=s.getVariantManagement().STANDARDVARIANTKEY;s.getVariantManagement().setCurrentVariantId(e);}},validateFilters:function(){var s=this.byId("idAPFSmartFilterBar");var v=s.validateMandatoryFields();this.getView().getViewData().oUiApi.getAddAnalysisStepButton().setEnabled(v);this.getView().getViewData().oUiApi.getAddAnalysisStepButton().rerender();},handleSplitterSize:function(){var t=this;var s=this.byId("idAPFSmartFilterBar");var T=s.mAggregations.content[0];var f=T.mAggregations.content[2];f.attachPress(function(){var F=this.getParent().getParent();if(F.getFilterBarExpanded()){t.getView().getViewData().oUiApi.getLayoutView().byId("idSplitterLayoutData").setSize("127px");}else{t.getView().getViewData().oUiApi.getLayoutView().byId("idSplitterLayoutData").setSize("65px");}});}});});
