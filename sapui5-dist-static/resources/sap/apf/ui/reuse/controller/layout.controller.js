/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
(function(){"use strict";sap.ui.controller("sap.apf.ui.reuse.controller.layout",{onInit:function(){this.oCoreApi=this.getView().getViewData().oCoreApi;this.oUiApi=this.getView().getViewData().uiApi;this.oNavigationHandler=this.getView().getViewData().oNavigationHandler;var a;this.oCoreApi.getApplicationConfigProperties().done(function(b){if(b){a=b.appName;}this.applicationTitle=this.oCoreApi.getTextNotHtmlEncoded(a);this.getView().byId("applicationPage").setTitle(this.applicationTitle);this.loadLayout();}.bind(this));var s=this;this.oActionListPopover=new sap.m.Popover({id:this.createId("idAnalysisPathMenuPopOver"),showHeader:false,placement:sap.m.PlacementType.Bottom,contentWidth:"165px"});this.oActionListItem=s.oUiApi.getToolbar().addStyleClass("toolbarView");this.oActionListPopover.addContent(this.oActionListItem);this.oSavedPathName=this.getView().byId("analysisPathTitle");if(this.byId("analysisPath")){this.setPathTitle();}},showMenu:function(e){this.oActionListPopover.openBy(e.getSource());},getAnalysisPathTitleText:function(){this.getView.byId("analysisPathTitle");},setPathTitle:function(){var p=this.oCoreApi.getPathName();if(p.length==0){p=this.oCoreApi.getTextNotHtmlEncoded("unsaved");}if(this.oCoreApi.isDirty()){p='*'+p;}this.getView().byId("analysisPathTitle").setText(p);this.getView().byId("analysisPathTitle").setTooltip(p);},loadLayout:function(){this.oCoreApi.getSmartFilterBarConfigurationAsPromise().done(function(s){if(sap.ui.Device.system.desktop){this.getView().addStyleClass("sapUiSizeCompact");this.getView().byId("deviceFooter").destroy();}if(s===undefined){this.getView().byId("idSplitterLayoutData").setSize("0px");}var c=this.oUiApi.getStepContainer();var a=this.oUiApi.getAnalysisPath();this.getView().byId("applicationPage").setTitle(this.applicationTitle);this.getView().byId("stepContainer").addContent(c);this.getView().byId("analysisDynamicPage").setContent(a);if(this.getView().byId("menuButton")){this.getView().byId("menuButton").setTooltip(this.oCoreApi.getTextNotHtmlEncoded("options"));}this.addOpenInButton();}.bind(this));},onAfterRendering:function(){var s=this;if(!sap.ui.Device.system.desktop){var S=new sap.m.Button({text:this.oCoreApi.getTextNotHtmlEncoded("showAnalyticalPath"),press:function(){s.getView().byId("applicationView").showMaster();},type:"Transparent"});this.getView().byId("applicationView").attachAfterMasterClose(function(){if(s.getView().byId("masterFooter")&&s.getView().byId("masterFooter").getContentLeft().length===0){s.getView().byId("masterFooter").addContentLeft(S);}});this.getView().byId("applicationView").attachAfterMasterOpen(function(){if(s.getView().byId("masterFooter")){s.getView().byId("masterFooter").removeContentLeft(S);}});if(this.getView().byId("applicationView").isMasterShown()===false&&this.getView().byId("masterFooter").getContentLeft().length===0){this.addMasterFooterContentLeft(S);}}},hideMaster:function(){if(sap.ui.Device.system.phone||sap.ui.Device.system.tablet){this.getView().byId("applicationView").hideMaster();if(sap.ui.Device.system.phone){this.getView().byId("applicationView").toDetail(this.getView().byId("stepContainer").getId());}}},showMasterFooter:function(a,m,M){if(!sap.ui.Device.system.desktop){var s=this;s.getView().byId("analysisPath").showFooter=true;s.getView().byId("analysisPath").enableScrolling=true;s.getView().byId("deviceFooter").addContentLeft(a);s.getView().byId("deviceFooter").addContentLeft(m);s.getView().byId("deviceFooter").addContentLeft(M);}},showMaster:function(){this.getView().byId("applicationView").showMaster();},addMasterFooterContentLeft:function(c){this.getView().byId("masterFooter").addContentLeft(c);},addMasterFooterContentRight:function(c){if(this.getView().byId("masterFooter").getContentRight().length===0){this.getView().byId("masterFooter").insertContentRight(c);}else{this.addMasterFooterContent(c);}},addMasterFooterContent:function(c){var s=this;if(this.oActionListPopover===undefined){this.oActionListPopover=new sap.m.Popover({showHeader:false,placement:sap.m.PlacementType.Top});}if(typeof c.getWidth==="function"){c.setWidth("100%");}if(this.footerContentButton===undefined){this.getView().byId("masterFooter").getContentRight()[0].setWidth("71%");this.footerContentButton=new sap.m.Button({icon:"sap-icon://overflow",press:function(e){s.oActionListPopover.openBy(e.getSource());},type:"Transparent",tooltip:this.oCoreApi.getTextNotHtmlEncoded("moreIcon")});}this.oActionListPopover.addContent(c);this.getView().byId("masterFooter").insertContentRight(this.footerContentButton,1);},addDetailFooterContentLeft:function(c){this.getView().byId("masterFooter").addContentLeft(c);},addFacetFilter:function(f){this.getView().byId("subHeader").addContent(f);},enableDisableOpenIn:function(){var s=this;if(!s.openInBtn){return;}var r=false;var n=this.oNavigationHandler.getNavigationTargets();n.then(function(a){if(a.global.length===0&&a.stepSpecific.length===0){if(s.openInBtn.getEnabled()){r=true;s.openInBtn.setEnabled(false);}}else{if(!s.openInBtn.getEnabled()){r=true;s.openInBtn.setEnabled(true);}}if(r){s.openInBtn.rerender();}});},addOpenInButton:function(){var s=this;if(this.oNavListPopover===undefined){this.oNavListPopover=new sap.m.Popover({showHeader:false,placement:sap.m.PlacementType.Top});}this.openInBtn=new sap.m.Button({id:this.createId("idOpenInButton"),text:this.oCoreApi.getTextNotHtmlEncoded("openIn"),tooltip:this.oCoreApi.getTextNotHtmlEncoded("openIn"),type:"Transparent",enabled:false,press:function(e){s.oNavTargetsView=sap.ui.view({viewName:"sap.apf.ui.reuse.view.navigationTarget",type:sap.ui.core.mvc.ViewType.JS,viewData:{oNavigationHandler:s.oNavigationHandler,oNavListPopover:s.oNavListPopover,oOpenInButtonEventSource:e.getSource(),oUiApi:s.oUiApi,oCoreApi:s.oCoreApi}});}});this.getView().byId("masterFooter").insertContentRight(this.openInBtn,1);this.enableDisableOpenIn();},doOkOnNavAnalysisPath:function(){var s=this;var t=this.oUiApi.getAnalysisPath().getToolbar();this.oCoreApi.readPaths(function(r,m,a){var S=true;var p=r.paths;if(m!==undefined){t.maxNumberOfSteps=m.getEntityTypeMetadata().maximumNumberOfSteps;t.maxNumberOfPaths=m.getEntityTypeMetadata().maxOccurs;}if(a===undefined&&(typeof r==="object")){t.getController().getSaveDialog(S,function(){window.history.go(-1);},p);}else{var M=s.oCoreApi.createMessageObject({code:"6005",aParameters:[]});M.setPrevious(a);s.oCoreApi.putMessage(M);}});},handleNavBack:function(){var s=this;if(s.oUiApi.getLayoutView().getController().oSavedPathName.getText().slice(0,1)==="*"&&s.oCoreApi.getSteps().length!==0){var n=new sap.ui.jsfragment("sap.apf.ui.reuse.fragment.newMessageDialog",this);s.getView().byId("idYesButton").attachPress(function(){n.close();s.doOkOnNavAnalysisPath();});s.getView().byId("idNoButton").attachPress(function(){n.close();window.history.go(-1);});var c=new sap.m.Button(s.createId("idCancelButton"),{text:s.oCoreApi.getTextNotHtmlEncoded("cancel"),press:function(){n.close();}});n.addButton(c);if(sap.ui.Device.system.desktop){n.addStyleClass("sapUiSizeCompact");}n.setInitialFocus(n);n.open();}else{window.history.go(-1);}}});}());
