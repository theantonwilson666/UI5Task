/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2018 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/core/mvc/Controller','sap/apf/utils/trace'],function(B,t){"use strict";return B.extend("sap.apf.ui.reuse.controller.analysisPath",{refreshAnalysisPath:function(s){if(this.getView().getCarouselView().getController().oCoreApi.getSteps().length<2){this.getView().getCarouselView().getController().getView().moveDownButton.setEnabled(false);this.getView().getCarouselView().getController().getView().moveUpButton.setEnabled(false);}this.getView().getCarouselView().getController().showStepChartChartAfterUpdate();},isOpenPath:false,isNewPath:false,isBackNavigation:false,bLastValidState:false,onInit:function(){this.oCoreApi=this.getView().getViewData().oCoreApi;this.oUiApi=this.getView().getViewData().uiApi;if(sap.ui.Device.system.desktop){this.getView().addStyleClass("sapUiSizeCompact");}},refresh:function(s){t.logCall("AnalysisPath.refresh"," inx=",s);function a(){var n=this.oCoreApi.getSteps().indexOf(this.oCoreApi.getActiveStep());if(n>s){var c=this.oUiApi.getStepContainer();c.stepLayout.setBusy(true);}}a.bind(this)();if(!this.oCoreApi.isDirty()&&this.oCoreApi.getSteps().length!==0){this.oCoreApi.setDirtyState(true);this.oUiApi.getLayoutView().getController().setPathTitle();}t.logReturn("refresh");},updateCustomListView:function(c,n,s){this.getView().getCarouselView().getController().updateCustomListView(c,n,s);},callBackForUpdatePath:function(c,s){t.logCall("AnalysisPath.callBackForUpdatePath"," changed?",s," chart=",c.getSelectedRepresentation().chart?c.getSelectedRepresentation().chart.sId:"NULL");try{var n=this.oCoreApi.getSteps().indexOf(c);if(n===0){this.refreshAnalysisPath(n);}this.updateCurrentStep(c,n,s);this.updateCustomListView(c,n,s);}catch(e){window.console.error("sap.apf .. analysisPath.controller catch exception: ",e);window.console.trace("trace ");}t.logReturn("callBackForUpdatePath");},callBackForUpdatePathAndSetLastStepAsActive:function(c,s){t.logCall("AnalysisPath.callBackForUpdatePathAndSetLastStepAsActive"," changed?",s," chart=",c.getSelectedRepresentation().chart?c.getSelectedRepresentation().chart.sId:"NULL");try{var n=this.oCoreApi.getSteps().indexOf(c);if(n===0){var S=this.oCoreApi.getSteps()[this.oCoreApi.getSteps().length-1];this.oCoreApi.setActiveStep(S);this.refreshAnalysisPath();}this.updateCurrentStep(c,n,s);this.updateCustomListView(c,n,s);this.oUiApi.getLayoutView().setBusy(false);}catch(e){window.console.error("sap.apf .. analysisPath.controller catch exception: ",e);window.console.trace("trace ");}t.logReturn("AnalysisPath.callBackForUpdatePathAndSetLastStepAsActive");},getIsOpenPath:function(){return this.isOpenPath===true?true:false;},setIsOpenPath:function(o){this.isOpenPath=(o)?true:false;},updateCurrentStep:function(c,n,s){t.logCall("AnalysisPath.updateCurrentStep",", inx=",n,", changed?",s,", #core.path=",this.oCoreApi.getSteps().length);try{var a=this.oCoreApi.getSteps().indexOf(this.oCoreApi.getActiveStep());var i=(n===a);t.log("updateCurrentStep",", isOpenPath=",this.isOpenPath,", nActiveIndex=",a);if(i){this.drawMainChart(s,i);}if(this.isOpenPath&&(this.oCoreApi.getSteps().indexOf(c)===(this.oCoreApi.getSteps().length-1))){this.oUiApi.getLayoutView().setBusy(false);this.isOpenPath=false;}if(this.isBackNavigation&&(this.oCoreApi.getSteps().indexOf(c)===(this.oCoreApi.getSteps().length-1))){this.oUiApi.getLayoutView().setBusy(false);this.isBackNavigation=false;}if(this.bLastValidState&&(this.oCoreApi.getSteps().indexOf(c)===(this.oCoreApi.getSteps().length-1))){this.oUiApi.getLayoutView().setBusy(false);this.bLastValidState=false;}this.isNewPath=false;}catch(e){window.console.error("sap.apf .. analysisPath.controller catch exception: ",e);window.console.trace("trace ");}t.logReturn("updateCurrentStep",", isOpenPath="+this.isOpenPath);},drawMainChart:function(s,i){t.logCall("AnalysisPath.drawMainChart");var c=this.oUiApi.getStepContainer();c.getController().drawStepContent(s,i);t.logReturn("drawMainChart");},navigateToStep:function(i){this.getView().getCarouselView().getController().changeActiveStep(i);},apfDestroy:function(){t.logCall("AnalysisPath.apfDestroy ******");this.getView().getToolbar().getController().apfDestroy();this.getView().getCarouselView().getController().apfDestroy();}});});
