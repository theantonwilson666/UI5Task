/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.require("sap.apf.modeler.ui.utils.optionsValueModelBuilder");jQuery.sap.require("sap.apf.modeler.ui.utils.staticValuesBuilder");jQuery.sap.require('sap.apf.modeler.ui.utils.constants');jQuery.sap.require("sap.apf.modeler.ui.utils.textManipulator");jQuery.sap.require("sap.apf.modeler.ui.utils.nullObjectChecker");jQuery.sap.require("sap.apf.utils.utils");(function(){"use strict";var p='idSortProperty';var s='idSortDirection';var o=sap.apf.modeler.ui.utils.optionsValueModelBuilder;var t=sap.apf.modeler.ui.utils.textManipulator;var c=sap.apf.modeler.ui.utils.CONSTANTS.events;function _(C){C.byId("idSortLabel").setText(C.oTextReader("sortingField"));C.byId("idSortLabel").setTooltip(C.oTextReader("sortingField"));C.byId("idSortDirectionLabel").setText(C.oTextReader("direction"));C.byId("idSortDirectionLabel").setTooltip(C.oTextReader("direction"));C.byId("idAddPropertyIcon").setTooltip(C.oTextReader("addButton"));C.byId("idRemovePropertyIcon").setTooltip(C.oTextReader("deleteButton"));}function a(C){if(sap.ui.Device.browser.msie&&sap.ui.Device.browser.version>=11){C.byId("idAriaPropertyForSortGroup").setText(C.oTextReader("sorting"));}C.byId("idAriaPropertyForAdd").setText(C.oTextReader("ariaTextForAddIcon"));C.byId("idAriaPropertyForDelete").setText(C.oTextReader("ariaTextForDeleteIcon"));}function b(C){var h=C.byId(p);C.getAllPropertiesAsPromise().done(function(r){var m=o.convert(r.aAllProperties);h.setModel(m);h.setSelectedKey(r.sSelectedKey);});}function d(C){var h=C.byId(s);var i=new sap.apf.modeler.ui.utils.StaticValuesBuilder(C.oTextReader,o);var m=i.getSortDirections();h.setModel(m);h.setSelectedKey(C.getView().getViewData().oPropertyTypeData.sContext);}function e(C){var S=true,h=true;var P=C.getView().getViewData().oPropertyTypeState;var n=P.indexOfPropertyTypeViewId(C.getView().getId());if(P.indexOfPropertyTypeViewId(C.getView().getId())===0){h=false;}C.byId("idAddPropertyIcon").setVisible(S);C.byId("idRemovePropertyIcon").setVisible(h);if(n>0&&P.aProperties!==undefined){var i=P.getViewAt(n-1);i.oController.byId("idAddPropertyIcon").setVisible(false);}}function f(C,n){var P=C.getView().getViewData().oPropertyTypeState;if(P!==undefined){var h=P.aProperties.length;var i=P.getViewAt(n-1);var j=C.oConfigurationEditor.isSaved();if(n>1&&n==h&&j==false){i.oController.byId("idAddPropertyIcon").setVisible(true);i.oController.byId("idRemovePropertyIcon").setVisible(true);}if(n===1&&n==h&&j==false){i.oController.byId("idAddPropertyIcon").setVisible(true);}}}function g(C){C.byId("idAddPropertyIcon").attachEvent(c.SETFOCUSONADDICON,C.setFocusOnAddRemoveIcons.bind(C));}sap.ui.core.mvc.Controller.extend("sap.apf.modeler.ui.controller.sortPropertyType",{oConfigurationEditor:{},oParentObject:{},oStepPropertyMetadataHandler:{},oTextReader:{},onInit:function(){var C=this;C.oConfigurationEditor=C.getView().getViewData().oConfigurationEditor;C.oParentObject=C.getView().getViewData().oParentObject;C.oStepPropertyMetadataHandler=C.getView().getViewData().oStepPropertyMetadataHandler;C.oTextReader=C.getView().getViewData().oCoreApi.getText;C.setDetailData();},onAfterRendering:function(){var C=this;C.byId("idAddPropertyIcon").fireEvent(c.SETFOCUSONADDICON);},setDetailData:function(){var C=this;_(C);a(C);b(C);d(C);e(C);C.disableView();},handleChangeForSortProperty:function(h){var C=this;var S=t.removePrefixText(C.byId(p).getSelectedKey(),C.oTextReader(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));var P=C.getView().getViewData().oPropertyOrchestration;var v=C.getView().getId();return new Promise(function(r){C.getView().fireEvent(c.UPDATEPROPERTYVALUESTATE,{"sProperty":S});P.updatePropertyTypeRow(v,S);P.updateAllSelectControlsForPropertyType().then(function(){C.updateOfConfigurationObject();C.oConfigurationEditor.setIsUnsaved();r();});});},handleChangeForSortDirection:function(){var C=this;C.updateOfConfigurationObject();C.oConfigurationEditor.setIsUnsaved();},setFocusOnAddRemoveIcons:function(){var C=this;C.byId("idAddPropertyIcon").focus();},handlePressOfAddPropertyIcon:function(){var C=this;g(C);C.addPropertyAsPromise();},handlePressOfRemovePropertyIcon:function(){var C=this;var v=C.getView().getViewData();var P=C.getView().getViewData().oPropertyTypeState;if(P!==undefined){var n=P.indexOfPropertyTypeViewId(C.getView().getId());}return new Promise(function(r){C.getView().fireEvent(c.FOCUSONREMOVE);var h=v.oPropertyOrchestration;h.removePropertyTypeReference(C.getView().getId());h.updateAllSelectControlsForPropertyType().then(function(){C.updateOfConfigurationObject();v.oPropertyTypeHandlerBackLink.handlePressOfRemove({oSourceView:C.getView()});f(C,n);C.oConfigurationEditor.setIsUnsaved();C.getView().destroy();r();});});},updateOfConfigurationObject:function(){var C=this;var P=C.getView().getViewData().oPropertyOrchestration;var h=P.getSortPropertyInformationList(s);C.updateOfConfigurationObjectOfSubclass(h);},getSelectedSortProperty:function(){var C=this;var P=C.getView().getViewData().oPropertyTypeState;var h=P.getPropertyValueState();var n=P.indexOfPropertyTypeViewId(C.getView().getId());return h[n];},removeAllItemsFromDropDownList:function(){var C=this;var v=C.byId(p);v.getItems().forEach(function(i){v.removeItem(i);});},setItemsOfDropDownList:function(C,A,h){function i(m,n){return m.indexOf(n)!==-1;}var j=this;var v=j.byId(p);var k=(h===j.oTextReader("none"));var l=JSON.parse(JSON.stringify(C));v.addItem(new sap.ui.core.Item({key:j.oTextReader("none"),text:j.oTextReader("none")}));if(!i(l,h)&&!k){l.unshift(h);}l=l.filter(function(m){return m!==j.oTextReader("none");});l.forEach(function(V){var u=V;if(!i(A,V)&&!k){V=t.addPrefixText([V],j.oTextReader)[0];}var I=new sap.ui.core.Item({key:V,text:V});v.addItem(I);if(u===h){h=V;}});v.setSelectedKey(h);},updateOfConfigurationObjectOfSubclass:function(S){},getOrderBy:function(){},setNextPropertyInParentObject:function(){},removePropertyFromParentObject:function(){},disableView:function(){},addPropertyAsPromise:function(){return sap.apf.utils.createPromise();}});}());
