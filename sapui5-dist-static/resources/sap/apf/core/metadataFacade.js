/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(['sap/apf/utils/utils','sap/apf/core/metadataProperty'],function(u,M){'use strict';var a=function(I,A){this.type="metadataFacade";var m=I.instances.messageHandler;var b=I.instances.metadataFactory;var p;var c;var d={};this.getAllProperties=function(e){var f;var h;var j=0;var i;var k=[];if(p){e(p);}else{f=g();h=f.length;for(i=0;i<h;i++){b.getMetadata(f[i]).done(l);}}function l(n){j++;k=k.concat(n.getAllProperties());if(h==j){p=u.eliminateDuplicatesInArray(m,k);e(p);}}};this.getAllParameterEntitySetKeyProperties=function(e){var f;var h;var j=0;var i;var k=[];if(c){e(c);}else{f=g();h=f.length;for(i=0;i<h;i++){b.getMetadata(f[i]).done(l);}}function l(n){j++;k=k.concat(n.getParameterEntitySetKeyPropertiesForService());if(h==j){c=sap.apf.utils.eliminateDuplicatesInArray(m,k);e(c);}}};this.getPropertyMetadataByEntitySet=function(s,e,f){var h=jQuery.Deferred();b.getMetadata(s).done(function(i){var j=i.getPropertyMetadata(e,f);h.resolve(new M.constructor(j));});return h.promise();};this.getProperty=function(e){var f;var h;var j;var k=jQuery.Deferred();if(d[e]){k.resolve(d[e]);}else{f=g();j=f.length;for(var i=0;i<j;i++){b.getMetadata(f[i]).done(function(l){h=l.getAttributes(e);if(h.name){if(l.getParameterEntitySetKeyPropertiesForService().indexOf(e)>-1){h.isParameterEntitySetKeyProperty=true;}if(l.getAllKeys().indexOf(e)>-1){h.isKey=true;}for(var n in h){if(n==="dataType"){for(var o in h.dataType){h[o]=h.dataType[o];}}}d[e]=new M.constructor(h);k.resolve(d[e]);}});}}return k.promise();};function g(){if(typeof A==="string"){return[A];}return b.getServiceDocuments();}};sap.apf.core.MetadataFacade=a;return a;},true);
