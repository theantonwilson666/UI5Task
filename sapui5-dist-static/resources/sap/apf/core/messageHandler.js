/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2018 SAP AG. All rights reserved
 */
sap.ui.define(['sap/apf/core/constants','sap/apf/utils/utils','sap/apf/core/messageObject','sap/apf/utils/hashtable','sap/base/Log','sap/apf/core/messageDefinition'],function(c,u,M,H,L){'use strict';function a(l){var b={initial:0,startup:1,running:2,shutdown:3};var t=this;var T;var d=[];var n=0;var e;var m;var f;var o=false;var g=false;var h=false;var D=false;var j=false;var U="";var k={code:c.message.code.errorUnknown,severity:c.message.severity.error,rawText:"Unknown Error occurred"};var p=b.initial;var C=[];this.setLifeTimePhaseStartup=function(i){p=b.startup;};this.setLifeTimePhaseRunning=function(){p=b.running;};this.setLifeTimePhaseShutdown=function(){p=b.shutdown;};this.fatalErrorOccurredAtStartup=function(){var i;if(p!==b.startup){return false;}for(i=0;i<C.length;i++){if(C[i].getSeverity()===c.message.severity.fatal){return true;}}return false;};this.createMessageObject=function(i){var F=new M(i);if(l){if(F.getCode()===undefined){F.setCode(c.message.code.errorUnknown);}x.bind(this)(F);y(F,1);}else if(i.enrichInfoInMessageObject===true){x.bind(this)(F);}return F;};this.activateOnErrorHandling=function(O){o=O;if(o===true){jQuery(window).on("error",B);}else{jQuery(window).off("error");}};this.setTextResourceHandler=function(i){T=i;};this.loadConfig=function(F,R){if(e===undefined||R){e=new H(t);}for(var i=0;i<F.length;i++){A(F[i]);}};this.setMessageCallback=function(i){if(i!==undefined&&typeof i==="function"){m=i;}else{m=undefined;}};this.setCallbackForTriggeringFatal=function(i){if(i!==undefined&&typeof i==="function"){f=i;}else{f=undefined;}};this.putMessage=function(i){var P;var F=0;var G;if(i.getCode()===undefined){i.setCode(c.message.code.errorUnknown);}x.bind(this)(i);if(i.getSeverity()===c.message.severity.fatal){G=t.createMessageObject({code:c.message.code.errorExitTriggered});x.bind(this)(G);G.setSeverity(c.message.severity.fatal);if(G.getMessage()===""){G.setMessage("The app has stopped working due to a technical error.");}}P=i.getPrevious();while(P!==undefined&&P.type&&P.type==="messageObject"&&F<10){if(P.getCode()===undefined){P.setCode(c.message.code.errorUnknown);}x.bind(this)(P);P=P.getPrevious();F++;}if(G!==undefined){G.setPrevious(i);i=G;}if(!l){y(i,10);}C.push(i);if(g){return;}if(i.getSeverity()===c.message.severity.technError){return;}if(m!==undefined){if(p===b.shutdown||(p===b.startup&&i.getSeverity()!==c.message.severity.fatal)){return;}g=true;m(i);g=false;}if(f!==undefined&&h===false){h=true;f(i);h=false;}if(i.getSeverity()===c.message.severity.fatal&&p!==b.shutdown){if(sap.ui.Device.browser.firefox){j=true;}throw new Error(U);}};this.check=function(i,F,G){var I=G||c.message.code.errorCheck;if(!i){var J=this.createMessageObject({code:I,aParameters:[F]});t.putMessage(J);}};this.getConfigurationByCode=function(i){if(e===undefined){return undefined;}return e.getItem(i);};this.getLogMessages=function(){return jQuery.extend(true,[],d);};this.reset=function(){e=undefined;m=undefined;d=[];C=[];};this.isOwnException=function(i){return(i&&i.message&&i.message.search(U)>-1);};function q(i){if(sap.ui.Device.browser.firefox){return j;}return(i.originalEvent&&i.originalEvent.message&&i.originalEvent.message.search(U)>-1);}function r(i){return(i.originalEvent&&i.originalEvent.message&&i.originalEvent.message.search(U)===-1&&i.originalEvent.message.search(c.message.code.suppressFurtherException)>-1);}function s(){var i=u.createPseudoGuid(32);return c.message.code.suppressFurtherException+i;}function v(i){var F=parseInt(i,10);return(F==c.message.code.errorExitTriggered||F==c.message.code.errorUnknown||F==c.message.code.errorInMessageDefinition);}function w(i){var F=parseInt(i,10);return(F==c.message.code.errorExitTriggered||F==c.message.code.errorInMessageDefinition);}function x(i){function F(N,O){var Q=0;while(N.indexOf("{"+Q+"}")>-1){if(typeof O[Q]==="string"){N=N.replace("{"+Q+"}",O[Q]);}else{N=N.replace("{"+Q+"}","undefined");}Q++;}return N;}var G=i.getCode();var I=t.getConfigurationByCode(G);if(I===undefined){I=jQuery.extend(true,{},k);if(v(G)){if(i.hasRawText()){I.rawText=i.getRawText();}I.rawText+=' '+i.getParameters();if(w(G)){I.severity=c.message.severity.fatal;}}else{I.rawText="Message "+G+"  "+i.getParameters()+" (Message Code has no Configuration)";}if(!v(G)){i.setCode(I.code);}}if(I.severity!==undefined){i.setSeverity(I.severity);}else{i.setSeverity(c.message.severity.technError);}if(I.rawText){i.setMessage(I.rawText);}else{var P=i.getParameters();if(i.getSeverity()===c.message.severity.technError){var J=t.getConfigurationByCode(I.code).text;if(!J){J=t.getConfigurationByCode(I.code).description;}i.setMessage(F(J,P));}else{try{if(T&&I.key){i.setMessage(T.getMessageText(I.key,i.getParameters()));}else if(I.description){i.setMessage(F(I.description,P));}else{i.setMessage("Message Code: "+G+" "+P.toString());}}catch(K){if(I.description){i.setMessage(F(I.description,P));}else{i.setMessage("Message Code: "+G+" "+P.toString());}}}}}function y(i,F){var G="APF message ";var P="";var I=F-1;if(F===0){return;}var J=i.getPrevious();if(J!==undefined){y(J,I);P=" - (see previous message for more information)";}n++;var K=G+'('+n+'): '+i.getCode()+" - "+i.getMessage()+P;if(D){alert("Fatal Error during Log Writing "+K);return;}D=true;if(i.getSeverity()===c.message.severity.fatal){if(d.length<2){d.unshift(K);}}switch(i.getSeverity()){case c.message.severity.warning:L.warning(K);break;case c.message.severity.error:L.error(K);break;case c.message.severity.fatal:L.error(K);break;case c.message.severity.technError:L.error(K);break;default:L.info(K);}D=false;}function z(i){t.check(i!==undefined&&i.hasOwnProperty("code")!==false,"MessageHandler setItem: oItem is undefined or property 'code' is missing",c.message.code.errorInMessageDefinition);var F=e.setItem(i.code,i);t.check((F===undefined),"MessageHandler setItem: Configuration includes duplicated codes",c.message.code.errorInMessageDefinition);}function A(i){if(i.type===undefined){i.type="message";}z(i);}function B(i){var F;var G="";var I="";var J="";var K="";var N=true;if(sap.ui.Device.browser.firefox){N=false;}if(N&&i&&i.originalEvent){G=i.originalEvent.message;J=i.originalEvent.filename;I=i.originalEvent.lineno;}if(q(i)){i.stopImmediatePropagation();i.preventDefault();}else if(r(i)){return;}else if(g){K="";if(N){K=G+" (source: "+J+":"+I+")";}F=new M({code:"5070",aParameters:[K]});x.bind(this)(F);y(F,1);}else{K="";if(N){K=G+" (source: "+J+":"+I+")";}F=new M({code:"5070",aParameters:[K]});x.bind(this)(F);y(F,1);}}function E(){U=s();}E();}sap.apf=sap.apf||{};sap.apf.core=sap.apf.core||{};sap.apf.core.MessageHandler=a;return a;});
