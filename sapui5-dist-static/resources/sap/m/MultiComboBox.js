/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['./InputBase','./ComboBoxTextField','./ComboBoxBase','./Tokenizer','./Token','./List','./StandardListItem','./Popover','./GroupHeaderListItem','./library','sap/ui/core/EnabledPropagator','sap/ui/core/IconPool','sap/ui/core/library','sap/ui/Device','sap/ui/core/Item','sap/ui/core/SeparatorItem','sap/ui/core/ResizeHandler','./MultiComboBoxRenderer',"sap/ui/dom/containsOrEquals","sap/m/inputUtils/completeTextSelected","sap/m/inputUtils/inputsDefaultFilter","sap/m/inputUtils/typeAhead","sap/m/inputUtils/ListHelpers","sap/m/inputUtils/filterItems","sap/m/inputUtils/itemsVisibilityHandler","sap/ui/events/KeyCodes","sap/base/util/deepEqual","sap/base/assert","sap/base/Log","sap/ui/core/Core",'sap/ui/core/InvisibleText',"sap/ui/thirdparty/jquery","sap/ui/dom/jquery/cursorPos","sap/ui/dom/jquery/control"],function(I,C,a,T,b,L,S,P,G,l,E,c,d,D,e,f,R,M,g,h,j,t,k,m,n,K,o,p,q,r,s,Q){"use strict";var u=l.ListMode;var V=d.ValueState;var O=d.OpenState;var v=l.TokenizerRenderMode;var w=a.extend("sap.m.MultiComboBox",{metadata:{library:"sap.m",designtime:"sap/m/designtime/MultiComboBox.designtime",properties:{selectedKeys:{type:"string[]",group:"Data",defaultValue:[]},hasSelection:{type:"boolean",visibility:"hidden",defaultValue:false}},associations:{selectedItems:{type:"sap.ui.core.Item",multiple:true,singularName:"selectedItem"}},aggregations:{tokenizer:{type:"sap.m.Tokenizer",multiple:false,visibility:"hidden"}},events:{selectionChange:{parameters:{changedItem:{type:"sap.ui.core.Item"},selected:{type:"boolean"}}},selectionFinish:{parameters:{selectedItems:{type:"sap.ui.core.Item[]"}}}},dnd:{draggable:false,droppable:true}}});c.insertFontFaceStyle();E.apply(w.prototype,[true]);w.prototype.clone=function(i){var x=a.prototype.clone.apply(this,arguments),y=this._getList();if(y){x.syncPickerContent();}return x;};w.prototype.open=function(){if(!this.isOpen()){this._bPickerIsOpening=true;}this.syncPickerContent();return a.prototype.open.apply(this,arguments);};w.prototype.onsapend=function(i){if(i.isMarked("forwardFocusToParent")){this.focus();}};w.prototype.onsaphome=function(i){if(!this.getFocusDomRef().selectionStart){T.prototype.onsaphome.apply(this.getAggregation("tokenizer"),arguments);}i.setMarked();};w.prototype.onsapdown=function(i){if(!this.getEnabled()||!this.getEditable()){return;}i.setMarked();i.preventDefault();this.syncPickerContent();var x=k.getSelectableItems(this.getItems());var y=x[0];if(y&&this.isOpen()&&this.getValueStateLinks().length){this._handleFormattedTextNav();return;}else if(y&&this.isOpen()){setTimeout(function(){k.getListItem(y).focus();},0);return;}if(this.isFocusInTokenizer()){return;}this._oTraversalItem=this._getNextTraversalItem();if(this._oTraversalItem&&!this.isComposingCharacter()){this.updateDomValue(this._oTraversalItem.getText());this.selectText(0,this.getValue().length);}};w.prototype.onsapup=function(i){if(!this.getEnabled()||!this.getEditable()){return;}i.setMarked();i.preventDefault();this.syncPickerContent();if(this.isFocusInTokenizer()){return;}this._oTraversalItem=this._getPreviousTraversalItem();if(this._oTraversalItem){this.updateDomValue(this._oTraversalItem.getText());this.selectText(0,this.getValue().length);}};w.prototype.isFocusInTokenizer=function(){return Q.contains(this.getAggregation("tokenizer").getFocusDomRef(),document.activeElement);};w.prototype.onsapshow=function(i){this._handleItemToFocus();a.prototype.onsapshow.apply(this,arguments);};w.prototype._handlePopupOpenAndItemsLoad=function(){this._handleItemToFocus();a.prototype._handlePopupOpenAndItemsLoad.apply(this,arguments);};w.prototype._valueStateNavDelegate=function(i,F,x){var y=this;this.oValueStateNavDelegate={};this.oValueStateNavDelegate.onsapdown=function(){k.getListItem(y.getSelectableItems()[0]).focus();};this.oValueStateNavDelegate.onsapup=function(){y.getFocusDomRef().focus();};this.oValueStateNavDelegate.onsapend=function(z){z.preventDefault();var A=y.getSelectableItems();k.getListItem(y.getSelectableItems()[A.length-1]).focus();};this.oValueStateNavDelegate.onfocusout=function(z){i.removeStyleClass("sapMFocusable");if(!i.getDomRef().contains(z.relatedTarget)){x.forEach(function(A){A.getDomRef().setAttribute("tabindex","-1");});}if(D.browser.msie){F.removeStyleClass("sapMPseudoFocus");}};return this.oValueStateNavDelegate;};w.prototype._closePickerDelegate={onsaptabnext:function(){if(D.browser.msie){this.getPicker().getCustomHeader().getFormattedText().removeStyleClass("sapMPseudoFocus");}this.close();setTimeout(function(){this.closeValueStateMessage();}.bind(this),0);}};w.prototype._formattedTextLinksNav={onsapup:function(){this.focus();},onsapdown:function(){var i=k.getSelectableItems(this.getItems());if(i.length){i[0].focus();}}};w.prototype._handleFormattedTextNav=function(){var i=this.getPicker().getCustomHeader(),x=this.getValueStateLinks(),F=i.getFormattedText(),y=this.oValueStateNavDelegate||this._valueStateNavDelegate(i,F,x),z=x?x[x.length-1]:null,A=x?x[0]:null;if(!x.length||i.getDomRef()===document.activeElement){return;}i.getDomRef().setAttribute("tabindex","-1");i.addDelegate(y);i.addStyleClass("sapMFocusable");i.focus();if(D.browser.msie){F.addStyleClass("sapMPseudoFocus");}x.forEach(function(B){B.getDomRef().setAttribute("tabindex","0");B.addDelegate(this._formattedTextLinksNav,this);},this);this.oMoveFocusBackToVSHeader=!this.oMoveFocusBackToVSHeader?{onsaptabprevious:function(B){B.preventDefault();i.focus();i.addStyleClass("sapMFocusable");}}:this.oMoveFocusBackToVSHeader;z.addDelegate(this._closePickerDelegate,this);A.addDelegate(this.oMoveFocusBackToVSHeader,this);};w.prototype.onsaphide=w.prototype.onsapshow;w.prototype._selectItemByKey=function(x){var y,z,A,i,B,F,H=this.isOpen();if(!this.getEnabled()||!this.getEditable()){return;}if(x){x.setMarked();}y=this._getUnselectedItems(H?"":this.getValue());for(i=0;i<y.length;i++){F=!(y[i].getKey()===undefined||y[i].getKey()===null)&&!y[i].isA("sap.ui.core.SeparatorItem");if(y[i].getText().toUpperCase()===this.getValue().toUpperCase()&&F){A=y[i];B=true;break;}}if(B){z={item:A,id:A.getId(),key:A.getKey(),fireChangeEvent:true,fireFinishEvent:true,suppressInvalidate:true,listItemUpdated:false};this._bPreventValueRemove=false;if(this.getValue()===""||(typeof this.getValue()==="string"&&A.getText().toLowerCase().startsWith(this.getValue().toLowerCase()))){if(k.getListItem(A).isSelected()){this.setValue('');}else{this.setSelection(z);}}}else{this._bPreventValueRemove=true;}if(x){this.close();}};w.prototype.onsapenter=function(i){var x=this.getAggregation("tokenizer");I.prototype.onsapenter.apply(this,arguments);this._showAlreadySelectedVisualEffect();if(this.getValue()){this._selectItemByKey(i);}if(!this.getEditable()&&x.getHiddenTokensCount()&&i.target===this.getFocusDomRef()){x._togglePopup(x.getTokensPopup());}};w.prototype.onsaptabnext=function(i){var x=this.getValue();if(x){var y=this._getUnselectedItemsStartingText(x);if(y.length===1){this._selectItemByKey(i);}else{this._showWrongValueVisualEffect();}}};w.prototype.onsaptabprevious=w.prototype.onsaptabnext;w.prototype.onsapfocusleave=function(i){var x=this.isPlatformTablet(),y=r.byId(i.relatedControlId),F=y&&y.getFocusDomRef(),z=this.getValue(),A=this.getPicker(),B=this.getAggregation("tokenizer");if(!this._bPickerIsOpening&&(!A||!A.getFocusDomRef()||!F||!Q.contains(A.getFocusDomRef(),F))){this.setValue(null);if(z){this.fireChangeEvent("",{value:z});}if(!Q.contains(this.getDomRef(),document.activeElement)){B.setRenderMode(v.Narrow);}}if(A&&F){if(o(A.getFocusDomRef(),F)&&!x&&!this.isPickerDialog()){this.focus();}}};w.prototype.onfocusin=function(i){var x=this.getPicker();var y=false;var z=x&&x.getFocusDomRef();var A=(x&&x.oPopup.getOpenState())||O.CLOSED;var B=A===O.CLOSING||A===O.CLOSED;var F=this.getPickerType()==="Dropdown";var H=this.getAggregation("tokenizer");if(F){y=z&&Q.contains(z,i.relatedTarget);}if(this.getEditable()&&i.target===this.getDomRef("inner")){H.setRenderMode(v.Loose);}if(i.target===this.getFocusDomRef()){H.hasOneTruncatedToken()&&H.setFirstTokenTruncated(false);this.getEnabled()&&this.addStyleClass("sapMFocus");!B&&y&&this.handleInputValidation(i,false);}if(i.target===this.getOpenArea()&&F&&!this.isPlatformTablet()){this.focus();}if(!this.isOpen()&&this.shouldValueStateMessageBeOpened()){this.openValueStateMessage();}};w.prototype._handleItemTap=function(i){var x=Q(i.target).control(0);if(!x.isA("sap.m.CheckBox")&&!x.isA("sap.m.GroupHeaderListItem")){this._bCheckBoxClicked=false;}};w.prototype._handleItemPress=function(i){if(this.isOpen()&&this._isListInSuggestMode()&&this.getPicker().oPopup.getOpenState()!==O.CLOSING){this.clearFilter();var x=this._getLastSelectedItem();if(x){k.getListItem(x).focus();}}};w.prototype._handleSelectionLiveChange=function(i){var x=i.getParameter("listItem");var y=i.getParameter("selected");var N=k.getItemByListItem(this.getItems(),x);var z=this.isPickerDialog()?this.getPickerTextField():this;if(x.getType()==="Inactive"){return;}p(N,"The corresponding mapped item was not found on "+this);if(!N){return;}var A={item:N,id:N.getId(),key:N.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:true};if(y){this.fireChangeEvent(N.getText());this.setSelection(A);}else{this.fireChangeEvent(N.getText());this.removeSelection(A);}if(this._bCheckBoxClicked){z.setValue(this._sOldInput);if(this.isOpen()&&this.getPicker().oPopup.getOpenState()!==O.CLOSING){x.focus();}}else{this._bCheckBoxClicked=true;this.setValue("");this.close();}};w.prototype.onkeydown=function(i){var x=this.getEditable(),y=this.getAggregation("tokenizer"),z=y.getTokens().length;a.prototype.onkeydown.apply(this,arguments);if(!this.getEnabled()){return;}if((i.ctrlKey||i.metaKey)&&i.which===K.I&&z){i.preventDefault();if(x){this._togglePopover();}else{this._handleIndicatorPress();}return;}this._bIsPasteEvent=(i.ctrlKey||i.metaKey)&&(i.which===K.V);if(this.getValue().length===0&&(i.ctrlKey||i.metaKey)&&(i.which===K.A)&&this._hasTokens()){y.focus();y.selectAllTokens(true);i.preventDefault();}if(this.isPickerDialog()){this._sOldValue=this.getPickerTextField().getValue();this._iOldCursorPos=Q(this.getFocusDomRef()).cursorPos();}this._bDoTypeAhead=!D.os.android&&(i.which!==K.BACKSPACE)&&(i.which!==K.DELETE);};w.prototype.oninput=function(i){a.prototype.oninput.apply(this,arguments);var x=i.srcControl,y=this.isPickerDialog(),z=y?this.getPickerTextField():this,A=z.getValueState();if(A===V.Error&&this._bAlreadySelected){z.setValueState(this._sInitialValueState);z.setValueStateText(this._sInitialValueStateText);this._bAlreadySelected=false;}if(!this.getEnabled()||!this.getEditable()){return;}this.syncPickerContent();this.handleInputValidation(i,this.isComposingCharacter());if(this._bIsPasteEvent){x.updateDomValue(this._sOldValue||i.target.value||"");return;}if(this.isOpen()){setTimeout(this.highlightList.bind(this,this._sOldInput));}if(this._getItemsShownWithFilter()){this.toggleIconPressedStyle(true);}};w.prototype.filterItems=function(i){return m(this,i.items,i.value,true,false,this.fnFilter||j);};w.prototype.onkeyup=function(i){if(!this.getEnabled()||!this.getEditable()){return;}this._sOldValue=this.getValue();this._iOldCursorPos=Q(this.getFocusDomRef()).cursorPos();};w.prototype._showWrongValueVisualEffect=function(){var i=this._getSuggestionsPopover();var x=this._sInitialValueStateText;var y=this._sInitialValueState;var z=x||this._oRbC.getText("VALUE_STATE_ERROR");var A=this;if(y===V.Error){return;}if(i){i.updateValueState(V.Error,z,true);setTimeout(i.updateValueState.bind(i,A.getValueState(),z,true),1000);}if(!this.isPickerDialog()){this.setValueState(V.Error);this.setValueStateText(this.getValueStateText()||z);setTimeout(this["setValueState"].bind(this,y||V.Error),1000);}this._syncInputWidth(this.getAggregation("tokenizer"));};w.prototype._showAlreadySelectedVisualEffect=function(){var A=this._oRbM.getText("VALUE_STATE_ERROR_ALREADY_SELECTED");if(!this.getValue()){return;}var i=!!this.getSelectedItems().filter(function(x){return x.getText().toLowerCase()===this.getValue().toLowerCase();},this).length;var N=this.getItems().filter(function(x){return x.getText().toLowerCase()===this.getValue().toLowerCase();},this).length;if(i){this._sInitialValueState=this.getValueState();this._sInitialValueStateText=this.getValueStateText();this.setValueStateText(A);this._bAlreadySelected=true;this.setValueState("Error");return;}else if(N){return;}else{this._showWrongValueVisualEffect();}};w.prototype._hasShowSelectedButton=function(){return true;};w.prototype.forwardEventHandlersToSuggPopover=function(i){a.prototype.forwardEventHandlersToSuggPopover.apply(this,arguments);i.setShowSelectedPressHandler(this._filterSelectedItems.bind(this));};w.prototype.configPicker=function(i){var x=this.getRenderer(),y=x.CSS_CLASS_MULTICOMBOBOX;i.setHorizontalScrolling(false).addStyleClass(x.CSS_CLASS_COMBOBOXBASE+"Picker").addStyleClass(y+"Picker").addStyleClass(y+"Picker-CTX").attachBeforeOpen(this.onBeforeOpen,this).attachAfterOpen(this.onAfterOpen,this).attachBeforeClose(this.onBeforeClose,this).attachAfterClose(this.onAfterClose,this).addEventDelegate({onBeforeRendering:this.onBeforeRenderingPicker,onAfterRendering:this.onAfterRenderingPicker},this);};w.prototype._configureList=function(i){if(!i){return;}i.setMode(u.MultiSelect);i.setIncludeItemInSelection(true);i.attachBrowserEvent("tap",this._handleItemTap,this).attachSelectionChange(this._handleSelectionLiveChange,this).attachItemPress(this._handleItemPress,this);i.addEventDelegate({onAfterRendering:this.onAfterRenderingList,onfocusin:this.onFocusinList},this);};w.prototype._decoratePopupInput=function(i){a.prototype._decoratePopupInput.apply(this,arguments);if(!i||!i.isA(["sap.m.InputBase"])){return;}i.attachSubmit(function(x){var y=i.getValue();if(y){this.setValue(y);this._selectItemByKey();this.setValue(this._sOldInput);this.close();}}.bind(this));i.addEventDelegate({onfocusout:this._handleInputFocusOut},this);return i;};w.prototype.onBeforeRendering=function(){a.prototype.onBeforeRendering.apply(this,arguments);this._bInitialSelectedKeysSettersCompleted=true;this.getAggregation("tokenizer").setEnabled(this.getEnabled());if(this._getList()){this.syncPickerContent(true);}this._deregisterResizeHandler();this._synchronizeSelectedItemAndKey();this.setProperty("hasSelection",!!this.getSelectedItems().length,true);if(!this._bAlreadySelected){this._sInitialValueStateText=this.getValueStateText();}if(this.getValueState()!==V.Error){this._sInitialValueState=this.getValueState();}};w.prototype.syncPickerContent=function(F){var i,x,y=this.getPicker();if(!y){y=this.createPicker(this.getPickerType());this._updateSuggestionsPopoverValueState();F=true;}if(F){x=this._getList();i=this.getEditable()?this.getItems():this.getSelectedItems();this._synchronizeSelectedItemAndKey();x.destroyItems();this._clearTokenizer();this._fillList(i);if(x.getItemNavigation()){this._iFocusedIndex=x.getItemNavigation().getFocusedIndex();}}return y;};w.prototype._registerResizeHandler=function(){p(!this._iResizeHandlerId,"Resize handler already registered");this._iResizeHandlerId=R.register(this,this._onResize.bind(this));};w.prototype._deregisterResizeHandler=function(){if(this._iResizeHandlerId){R.deregister(this._iResizeHandlerId);this._iResizeHandlerId=null;}};w.prototype._onResize=function(){var i=this.getAggregation("tokenizer");i.setMaxWidth(this._calculateSpaceForTokenizer());this._syncInputWidth(i);this._handleNMoreAccessibility();};w.prototype.onBeforeRenderingPicker=function(){var i=this["_onBeforeRendering"+this.getPickerType()];if(i){i.call(this);}};w.prototype.onAfterRenderingPicker=function(){var i=this["_onAfterRendering"+this.getPickerType()];if(i){i.call(this);}};w.prototype.onBeforeOpen=function(){a.prototype.onBeforeOpen.apply(this,arguments);var i=this["_onBeforeOpen"+this.getPickerType()];this._resetCurrentItem();this.addContent();this._aInitiallySelectedItems=this.getSelectedItems();this._synchronizeSelectedItemAndKey();if(i){i.call(this);}};w.prototype.onAfterOpen=function(){var i=this.getFocusDomRef(),x=this.getValueStateLinks();i&&this.getFocusDomRef().setAttribute("aria-expanded","true");this._bPickerIsOpening=false;if(!this.isPlatformTablet()){this.getPicker().setInitialFocus(this);}x.forEach(function(y){y.addDelegate({onAfterRendering:function(){if(this.getFocusDomRef()){this.getFocusDomRef().setAttribute("tabindex","-1");}}},y);});this.closeValueStateMessage();};w.prototype.onBeforeClose=function(){a.prototype.onBeforeClose.apply(this,arguments);};w.prototype.onAfterClose=function(){var U=!Q.contains(this.getDomRef(),document.activeElement)||this.isPickerDialog(),i=this.getFocusDomRef();i&&this.getFocusDomRef().setAttribute("aria-expanded","false");this.toggleIconPressedStyle(false);this.clearFilter();!this.isComposingCharacter()&&!this._bPreventValueRemove&&this.setValue("");this._sOldValue="";this._sOldInput="";this._getSuggestionsPopover()._sTypedInValue="";if(this.isPickerDialog()){this.getPickerTextField().setValue("");this.getFilterSelectedButton()&&this.getFilterSelectedButton().setPressed(false);}this.fireSelectionFinish({selectedItems:this.getSelectedItems()});this.getAggregation("tokenizer").setRenderMode(U?v.Narrow:v.Loose);if(this.getValueState()==V.Error&&document.activeElement===this.getFocusDomRef()){this.selectText(0,this.getValue().length);}};w.prototype._onBeforeOpenDialog=function(){};w.prototype._onBeforeOpenDropdown=function(){var i=this.getPicker(),x=this.getDomRef(),W;if(x&&i){W=(x.offsetWidth/parseFloat(l.BaseFontSize))+"rem";i.setContentMinWidth(W);}};w.prototype.getFilterSelectedButton=function(){return this._getSuggestionsPopover().getFilterSelectedButton();};w.prototype._filterSelectedItems=function(i,F){var x=i.oSource,y,z,A=this.getPickerTextField()?this.getPickerTextField().getValue():"",B=(x&&x.getPressed&&x.getPressed())||F,H=k.getVisibleItems(this.getItems()),J=this.getItems(),N=this.getSelectedItems(),U=null;if(B){H.forEach(function(W){z=N.indexOf(W)>-1?true:false;y=k.getListItem(W);if(!y){return;}if(y.isA("sap.m.GroupHeaderListItem")){y.setVisible(false);U=y;}else{y.setVisible(z);if(z&&U){U.setVisible(true);}}},this);}else{n(this.getItems(),this.filterItems({value:A,items:J}));}};w.prototype.revertSelection=function(){this.setSelectedItems(this._aInitiallySelectedItems);};w.prototype.setSelection=function(i){var x=this._getList();if(i.item&&this.isItemSelected(i.item)){return;}if(!i.item){return;}if(!i.listItemUpdated&&k.getListItem(i.item)&&x){x.setSelectedItem(k.getListItem(i.item),true);}var y=new b({key:i.key});y.setText(i.item.getText());i.item.data(k.CSS_CLASS+"Token",y);this.getAggregation("tokenizer").addToken(y);this.setValue('');this.addAssociation("selectedItems",i.item,i.suppressInvalidate);var z=this.getSelectedKeys();var A=this.getKeys([i.item])[0];if(A===""||z.indexOf(A)===-1){z.push(A);this.setProperty("selectedKeys",z,i.suppressInvalidate);}if(i.fireChangeEvent){this.fireSelectionChange({changedItem:i.item,selected:true});}if(i.fireFinishEvent){if(!this.isOpen()){this.fireSelectionFinish({selectedItems:this.getSelectedItems()});}}};w.prototype.removeSelection=function(i){if(i.item&&!this.isItemSelected(i.item)){return;}if(!i.item){return;}this.removeAssociation("selectedItems",i.item,i.suppressInvalidate);var x=this.getSelectedKeys();var y=x.indexOf(i.item.getKey());x.splice(y,1);this.setProperty("selectedKeys",x,i.suppressInvalidate);if(!i.listItemUpdated&&k.getListItem(i.item)){var z=k.getListItem(i.item);this._getList().setSelectedItem(z,false);}if(!i.tokenUpdated){var A=this._getTokenByItem(i.item);i.item.data(k.CSS_CLASS+"Token",null);this.getAggregation("tokenizer").removeToken(A);}if(i.fireChangeEvent){this.fireSelectionChange({changedItem:i.item,selected:false});}if(i.fireFinishEvent){if(!this.isOpen()){this.fireSelectionFinish({selectedItems:this.getSelectedItems()});}}};w.prototype._synchronizeSelectedItemAndKey=function(){var x=this.getSelectedKeys();var y=this.getKeys(this.getSelectedItems());if(!x.length){q.info("Info: _synchronizeSelectedItemAndKey() the MultiComboBox control does not contain any item on ",this);return;}for(var i=0,z=null,A=null,B=x.length;i<B;i++){z=x[i];if(y.indexOf(z)>-1){continue;}A=this.getItemByKey(""+z);if(A){this.setSelection({item:A,id:A.getId(),key:A.getKey(),fireChangeEvent:false,suppressInvalidate:true,listItemUpdated:false});}}};w.prototype._getTokenByItem=function(i){return i?i.data(k.CSS_CLASS+"Token"):null;};w.prototype.updateItems=function(i){var x=function(B){return B&&B.getKey&&B.getKey();},y,z=this.getSelectedItems().map(x),A=this.getSelectedKeys();var U=a.prototype.updateItems.apply(this,arguments);z=this.getSelectedItems().map(x).filter(function(B){return z.indexOf(B)>-1;});y=A.concat(z);this.setSelectedKeys(y);return U;};w.prototype._getSelectedItemsOf=function(x){for(var i=0,y=x.length,z=[];i<y;i++){if(k.getListItem(x[i]).isSelected()){z.push(x[i]);}}return z;};w.prototype._getLastSelectedItem=function(){var i=this.getAggregation("tokenizer").getTokens();var x=i.length?i[i.length-1]:null;if(!x){return null;}return this._getItemByToken(x);};w.prototype._getFocusedListItem=function(){if(!document.activeElement){return null;}var F=r.byId(document.activeElement.id);if(this._getList()&&g(this._getList().getFocusDomRef(),F.getFocusDomRef())){return F;}return null;};w.prototype._getFocusedItem=function(){return k.getItemByListItem(this.getItems(),this._getFocusedListItem());};w.prototype._hasTokens=function(){return this.getAggregation("tokenizer").getTokens().length>0;};w.prototype._getCurrentItem=function(){if(!this._oCurrentItem){return this._getFocusedItem();}return this._oCurrentItem;};w.prototype._setCurrentItem=function(i){this._oCurrentItem=i;};w.prototype._resetCurrentItem=function(){this._oCurrentItem=null;};w.prototype._decorateListItem=function(i){i.addDelegate({onkeyup:function(x){var y=null;if(x.which==K.SPACE&&this.isOpen()&&this._isListInSuggestMode()){this.open();y=this._getLastSelectedItem();if(y){k.getListItem(y).focus();}return;}},onkeydown:function(x){var y=null,z=null;if(x.shiftKey&&x.which==K.ARROW_DOWN){z=this._getCurrentItem();y=this._getNextVisibleItemOf(z);}if(x.shiftKey&&x.which==K.ARROW_UP){z=this._getCurrentItem();y=this._getPreviousVisibleItemOf(z);}if(x.shiftKey&&x.which===K.SPACE){z=this._getCurrentItem();this._selectPreviousItemsOf(z);}if(y&&y!==z){if(k.getListItem(z).isSelected()){this.setSelection({item:y,id:y.getId(),key:y.getKey(),fireChangeEvent:true,suppressInvalidate:true});this._setCurrentItem(y);}else{this.removeSelection({item:y,id:y.getId(),key:y.getKey(),fireChangeEvent:true,suppressInvalidate:true});this._setCurrentItem(y);}return;}this._resetCurrentItem();if((x.ctrlKey||x.metaKey)&&x.which==K.A){x.setMarked();x.preventDefault();var A=k.getSelectableItems(this.getItems());var B=this._getSelectedItemsOf(A);if(B.length!==A.length){A.forEach(function(y){this.setSelection({item:y,id:y.getId(),key:y.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:false});},this);}else{A.forEach(function(y){this.removeSelection({item:y,id:y.getId(),key:y.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:false});},this);}}}},true,this);i.addEventDelegate({onsapbackspace:function(x){x.preventDefault();},onsapshow:function(x){x.setMarked();if(this.isOpen()){this.close();return;}if(this.hasContent()){this.open();}},onsaphide:function(x){this.onsapshow(x);},onsapenter:function(x){x.setMarked();this.close();},onsaphome:function(x){x.setMarked();x.preventDefault();if(this.getValueStateLinks().length){this._handleFormattedTextNav();x.stopPropagation(true);return;}var y=k.getSelectableItems(this.getItems());var z=y[0];k.getListItem(z).focus();},onsapend:function(x){x.setMarked();x.preventDefault();var y=k.getSelectableItems(this.getItems());var z=y[y.length-1];k.getListItem(z).focus();},onsapup:function(x){x.setMarked();x.preventDefault();var y=k.getSelectableItems(this.getItems());var z=y[0];var A=Q(document.activeElement).control()[0];if(A===k.getListItem(z)&&this.getValueStateLinks().length){this._handleFormattedTextNav();x.stopPropagation(true);return;}else if(A===k.getListItem(z)){this.focus();x.stopPropagation(true);}},onfocusin:function(x){this.addStyleClass(this.getRenderer().CSS_CLASS_MULTICOMBOBOX+"Focused");},onfocusout:function(x){this.removeStyleClass(this.getRenderer().CSS_CLASS_MULTICOMBOBOX+"Focused");},onsapfocusleave:function(x){var y=this.getAggregation("picker");var z=r.byId(x.relatedControlId);if(y&&z&&o(y.getFocusDomRef(),z.getFocusDomRef())){if(x.srcControl){x.srcControl.focus();}}},onsaptabnext:function(){this.getPicker().close();},onsaptabprevious:function(){this.getPicker().close();}},this);if(D.support.touch){i.addEventDelegate({ontouchstart:function(x){x.setMark("cancelAutoClose");}});}};w.prototype._handleInputFocusOut=function(){var i=this.isPickerDialog()?this.getPickerTextField():this,U=this._sOldInput||this._sOldValue||"";i.updateDomValue(U);this._bIsPasteEvent=null;};w.prototype.onItemChange=function(i){var x=a.prototype.onItemChange.apply(this,arguments);this._forwardItemInfoToToken(i);return x;};w.prototype._forwardItemInfoToToken=function(i){var x=i.getSource(),y=i.getParameters(),z=this._getTokenByItem(x);if(!z){return;}if(y.name==="enabled"){z.setVisible(y.newValue);}else if(z.getMetadata().hasProperty(y.name)){z.setProperty(y.name,y.newValue,false);}};w.prototype._handleIndicatorPress=function(){var i,x=this.getAggregation("tokenizer");if(this.getEditable()){this.syncPickerContent();this._filterSelectedItems({},true);this.focus();i=this.getPicker();i.open();}else{x._togglePopup(x.getTokensPopup());}if(this.isPickerDialog()){this.getFilterSelectedButton().setPressed(true);this.bOpenedByKeyboardOrButton=true;}};w.prototype._togglePopover=function(){var i=this.getPicker();if(!i){i=this.syncPickerContent(true);}if(i.isOpen()){i.close();}else{i.open();}};w.prototype._createTokenizer=function(){var i=new T({renderMode:v.Narrow}).attachTokenDelete(this._handleTokenDelete,this);i.getTokensPopup().attachAfterOpen(function(){if(i.hasOneTruncatedToken()){i.setFirstTokenTruncated(false);}}).attachAfterClose(function(){var x=i.getTokens();if(x.length===1&&!x[0].getTruncated()){i.setFirstTokenTruncated(true);}});i.addEventDelegate({onAfterRendering:this._onAfterRenderingTokenizer},this);return i;};w.prototype._onAfterRenderingTokenizer=function(){var i=this.getAggregation("tokenizer");if(this.getEditable()){i.addStyleClass("sapMTokenizerIndicatorDisabled");}else{i.removeStyleClass("sapMTokenizerIndicatorDisabled");}setTimeout(this._syncInputWidth.bind(this,i),0);setTimeout(this._handleNMoreAccessibility.bind(this),0);setTimeout(i["scrollToEnd"].bind(i),0);this._toggleTokenClass();};w.prototype._handleTokenDelete=function(i){var x=i.getParameter("tokens");var y=this.getSelectedItems();this._removeSelection(x);if(y.length!==k.getSelectableItems(this.getItems())){!this.isPickerDialog()&&!this.isFocusInTokenizer()&&this.focus();this.fireChangeEvent("");this.setProperty("hasSelection",!!this.getSelectedItems().length);}};w.prototype._removeSelection=function(i){var x=this.getAggregation("tokenizer");i.forEach(function(y){var z=(y&&this._getItemByToken(y));if(!this.getEditable()||!this.getEnabled()||!z||!this.isItemSelected(z)||!z.getEnabled()||!y.getEditable()){return;}this.removeSelection({item:z,id:z.getId(),key:z.getKey(),tokenUpdated:true,fireChangeEvent:true,fireFinishEvent:true,suppressInvalidate:true});y.destroy();if(this.getSelectedItems().length>0){var i=x.getTokens();i[i.length-1].focus();}else{this.focus();}},this);};w.prototype.onAfterRenderingList=function(){var i=this._getList();var x=document.activeElement===this.getFocusDomRef();if(this.getEditable()&&!x&&i&&i.getItems()[this._iFocusedIndex]){i.getItems()[this._iFocusedIndex].focus();this._iFocusedIndex=null;}};w.prototype.onFocusinList=function(){if(this._bListItemNavigationInvalidated&&this._getList().getItemNavigation()){this._getList().getItemNavigation().setSelectedIndex(this._iInitialItemFocus);this._bListItemNavigationInvalidated=false;}};w.prototype.onAfterRendering=function(){var i=this.getAggregation("tokenizer");a.prototype.onAfterRendering.apply(this,arguments);this._registerResizeHandler();setTimeout(function(){i.setMaxWidth(this._calculateSpaceForTokenizer());}.bind(this),0);};w.prototype.onfocusout=function(i){this.isOpen()&&this._handleInputFocusOut();this.removeStyleClass("sapMFocus");if(this.getValueState()===V.Error&&this.getValueStateText()===this._oRbM.getText("VALUE_STATE_ERROR_ALREADY_SELECTED")){this.setValueState(this._sInitialValueState);this.setValueStateText(this._sInitialValueStateText);}a.prototype.onfocusout.apply(this,arguments);};w.prototype.onpaste=function(i){var x;if(window.clipboardData){x=window.clipboardData.getData("Text");}else{x=i.originalEvent.clipboardData.getData('text/plain');}var y=x.split(/\r\n|\r|\n/g);if(y&&y.length>0){k.getSelectableItems(this.getItems()).forEach(function(z){if(y.indexOf(z.getText())>-1){this.setSelection({item:z,id:z.getId(),key:z.getKey(),fireChangeEvent:true,fireFinishEvent:true,suppressInvalidate:true,listItemUpdated:false});}},this);}};w.prototype.onsapbackspace=function(i){var x=this.getAggregation("tokenizer");var y=x.getTokens();var z=y.filter(function(A){return A.getSelected();});if(!this.getEnabled()||!this.getEditable()){i.preventDefault();return;}if(this.getCursorPosition()>0||this.getValue().length>0){return;}if(z.length>0){this._removeAllTokens();return;}if(document.activeElement===this.getFocusDomRef()){y[y.length-1]&&y[y.length-1].focus();}i.preventDefault();};w.prototype._removeAllTokens=function(){var i=this.getAggregation("tokenizer");var x=i.getTokens().filter(function(y){return y.getSelected();});if(!x.length){return;}this._removeSelection(x);this.fireChangeEvent("");this.invalidate();};w.prototype.onsapdelete=w.prototype.onsapbackspace;w.prototype.onsapnext=function(i){var x=this.getAggregation("tokenizer");if(i.isMarked()){return;}var F=Q(document.activeElement).control()[0];if(!F){return;}if(F===x||x.$().find(F.$()).length>0&&this.getEditable()){x.scrollToEnd();this.focus();}};w.prototype.onsapprevious=function(i){if(this.getCursorPosition()===0&&!h(this.getFocusDomRef())){if(i.srcControl===this){T.prototype.onsapprevious.apply(this.getAggregation("tokenizer"),arguments);}}};w.prototype.onclick=function(i){var x=this.getEditable(),y=this.getEnabled(),N=i.target.className.indexOf("sapMTokenizerIndicator")>-1;if(x&&y&&N){i.preventDefault();this._handleIndicatorPress();}};w.prototype.ontap=function(i){a.prototype.ontap.apply(this,arguments);var x=this.getOpenArea();if(!this.getEnabled()||!this.getEditable()){return;}i.setMarked();if(this.isPickerDialog()&&x.contains(i.target)){this.open();}};w.prototype.getOpenArea=function(){if(this.isPickerDialog()){return this.getDomRef();}else{return a.prototype.getOpenArea.apply(this,arguments);}};w.prototype._getItemsStartingWithPerTerm=function(i,x){var y=[],z=x?k.getEnabledItems(this.getItems()):k.getSelectableItems(this.getItems()),F=this.fnFilter?this.fnFilter:j;z.forEach(function(A){if(F(i,A)){y.push(A);}},this);return y;};w.prototype._getItemsStartingWith=function(i,x){var y=[],z=x?k.getEnabledItems(this.getItems()):k.getSelectableItems(this.getItems());z.forEach(function(A){if(typeof i==="string"&&i!==""&&A.getText().toLowerCase().startsWith(i.toLowerCase())){y.push(A);}},this);return y;};w.prototype._getUnselectedItemsStartingText=function(i){var x=[];this._getUnselectedItems().forEach(function(y){if(typeof i==="string"&&i!==""&&y.getText().toLowerCase().startsWith(i.toLowerCase())){x.push(y);}},this);return x;};w.prototype.getCursorPosition=function(){return this._$input.cursorPos();};w.prototype._selectPreviousItemsOf=function(i){var x;do{x=true;var y=this._getPreviousVisibleItemOf(i);if(y){var z=k.getListItem(y);if(z){x=k.getListItem(y).getSelected();}}this.setSelection({item:i,id:i.getId(),key:i.getKey(),fireChangeEvent:true,suppressInvalidate:true});i=y;}while(!x);};w.prototype._getNextVisibleItemOf=function(i){var x=k.getSelectableItems(this.getItems());var y=x.indexOf(i)+1;if(y<=0||y>x.length-1){return null;}return x[y];};w.prototype._getPreviousVisibleItemOf=function(i){var x=k.getSelectableItems(this.getItems());var y=x.indexOf(i)-1;if(y<0){return null;}return x[y];};w.prototype._getNextUnselectedItemOf=function(i){var x=this._getUnselectedItems();var y=x.indexOf(i)+1;if(y<=0||y>x.length-1){return null;}return x[y];};w.prototype._getPreviousUnselectedItemOf=function(i){var x=this._getUnselectedItems();var y=x.indexOf(i)-1;if(y<0){return null;}return x[y];};w.prototype._getNextTraversalItem=function(){var i=this.getValue();var x=i?this._getItemsStartingWithPerTerm(i):[];var y=this._getUnselectedItems();if(x.indexOf(this._oTraversalItem)>-1&&this._oTraversalItem.getText()===this.getValue()){return this._getNextUnselectedItemOf(this._oTraversalItem);}if(x.length&&x[0].getText()===this.getValue()){return this._getNextUnselectedItemOf(x[0]);}return x.length?x[0]:y[0];};w.prototype._getPreviousTraversalItem=function(){var i=this.getValue();var x=i?this._getItemsStartingWithPerTerm(i):[];if(x.indexOf(this._oTraversalItem)>-1&&this._oTraversalItem.getText()===this.getValue()){return this._getPreviousUnselectedItemOf(this._oTraversalItem);}if(x.length&&x[x.length-1].getText()===this.getValue()){return this._getPreviousUnselectedItemOf(x[x.length-1]);}if(x.length){return x[x.length-1];}else{var y=this._getUnselectedItems();if(y.length>0){return y[y.length-1];}else{return null;}}};w.prototype.setSelectedItems=function(i){this.removeAllSelectedItems();if(!i||!i.length){return this;}if(!Array.isArray(i)){q.warning("Warning: setSelectedItems() has to be an array of sap.ui.core.Item instances or of valid sap.ui.core.Item IDs",this);return this;}i.forEach(function(x){if(!(x instanceof e)&&(typeof x!=="string")){q.warning("Warning: setSelectedItems() has to be an array of sap.ui.core.Item instances or of valid sap.ui.core.Item IDs",this);return;}if(typeof x==="string"){x=r.byId(x);}this.setSelection({item:x?x:null,id:x?x.getId():"",key:x?x.getKey():"",suppressInvalidate:true});},this);return this;};w.prototype.addSelectedItem=function(i){if(!i){return this;}if(typeof i==="string"){i=r.byId(i);}this.setSelection({item:i?i:null,id:i?i.getId():"",key:i?i.getKey():"",fireChangeEvent:false,suppressInvalidate:true});return this;};w.prototype.removeSelectedItem=function(i){if(!i){return null;}if(typeof i==="string"){i=r.byId(i);}if(!this.isItemSelected(i)){return null;}this.removeSelection({item:i,id:i.getId(),key:i.getKey(),fireChangeEvent:false,suppressInvalidate:true});return i;};w.prototype.removeAllSelectedItems=function(){var i=[];var x=this.getAssociation("selectedItems",[]);x.forEach(function(y){var z=this.removeSelectedItem(y);if(z){i.push(z.getId());}},this);return i;};w.prototype.removeSelectedKeys=function(i){var x,y=[];if(!i||!i.length||!Array.isArray(i)){return y;}i.forEach(function(z){x=this.getItemByKey(z);if(x){this.removeSelection({item:x?x:null,id:x?x.getId():"",key:x?x.getKey():"",fireChangeEvent:false,suppressInvalidate:true});y.push(x);}},this);return y;};w.prototype.setSelectedKeys=function(i){if(this._bInitialSelectedKeysSettersCompleted){this.setProperty("selectedKeys",[],true);this.removeAllSelectedItems();}this.addSelectedKeys(i);this._bInitialSelectedKeysSettersCompleted=true;return this;};w.prototype.addSelectedKeys=function(i){var x,y=[];i=this.validateProperty("selectedKeys",i);i.forEach(function(z){var A=this.getItemByKey(z);if(A){this.addSelectedItem(A);}else if(z!=null){y.push(z);}},this);if(y.length>0){x=this.getProperty("selectedKeys").filter(function(z){return y.indexOf(z)===-1;});y=x.concat(y);this.setProperty("selectedKeys",y,true);}return this;};w.prototype._getUnselectedItems=function(){var i=Q(k.getSelectableItems(this.getItems())).not(this.getSelectedItems()).get();if(!this.isOpen()){return i.filter(function(x){return!x.isA("sap.ui.core.SeparatorItem");});}return i;};w.prototype.getSelectedItems=function(){var i=[],x=this.getAssociation("selectedItems")||[];x.forEach(function(y){var z=r.byId(y);if(z){i.push(z);}},this);return i;};w.prototype.getWidth=function(){return this.getProperty("width")||"100%";};w.prototype.setEditable=function(i){var x=this._getList(),y=this.getAggregation("tokenizer");a.prototype.setEditable.apply(this,arguments);y.setEditable(i);if(x){this.syncPickerContent(true);this._updatePopoverBasedOnEditMode(i);}return this;};w.prototype._updatePopoverBasedOnEditMode=function(i){var x=this._getList(),y=this._getSuggestionsPopover();if(!x){return;}if(i){y.addContent(x);}};w.prototype._mapItemToListItem=function(i){var x,y,z,A=this.getRenderer();if(!i){return null;}x=k.createListItemFromCoreItem(i,this.getShowSecondaryValues());if(i.isA("sap.ui.core.SeparatorItem")){return x;}y=A.CSS_CLASS_MULTICOMBOBOX+"Item";z=(this.isItemSelected(i))?y+"Selected":"";x.addStyleClass(y+" "+z);if(z){var B=new b({key:i.getKey()});B.setText(i.getText());i.data(k.CSS_CLASS+"Token",B);this.getAggregation("tokenizer").addToken(B,true);}this.setSelectable(i,i.getEnabled());this._decorateListItem(x);return x;};w.prototype.setSelectable=function(i,x){a.prototype.setSelectable.call(this,i,x);var y=this._getTokenByItem(i);if(y){y.setVisible(x);}};w.prototype._fillList=function(x){if(!x){return null;}if(!this._oListItemEnterEventDelegate){this._oListItemEnterEventDelegate={onsapenter:function(A){if(A.srcControl.isSelected()){A.setMarked();}}};}for(var i=0,y,z=x.length;i<z;i++){y=this._mapItemToListItem(x[i]);y.removeEventDelegate(this._oListItemEnterEventDelegate);y.addDelegate(this._oListItemEnterEventDelegate,true,this,true);this._getList().addAggregation("items",y,true);if(this.isItemSelected(x[i])){this._getList().setSelectedItem(y,true);}}};w.prototype.handleInputValidation=function(i,x){var y=i.target.value,z=this.isValueValid(y),A,B,F;var H=i.srcControl;if(!z&&y!==""&&!x){this._handleFieldValidationState(H);return;}F=this._getItemsStartingWith(y,true);if(!x||this._bIsPasteEvent){this._handleTypeAhead(y,F,H);}A=this.getItems();if(this.isPickerDialog()){B=this.getFilterSelectedButton();if(B!=null&&B.getPressed()){B.setPressed(false);}}n(this.getItems(),this.filterItems({value:y,items:A}));this._sOldInput=y;if((!this.getValue()||!z)&&!this.bOpenedByKeyboardOrButton&&!this.isPickerDialog()){this.close();}else{this.open();}};w.prototype.isValueValid=function(i){var x=this._getItemsStartingWith(i,true);var y=this._getItemsStartingWithPerTerm(i,true);return x.length||y.length;};w.prototype._handleTypeAhead=function(i,x,y){var z,F;if(!this._bDoTypeAhead){return;}z=this.getSelectedItems();F=x.filter(function(A){return z.indexOf(A)===-1;});t(i,y,F);};w.prototype._handleFieldValidationState=function(i){if(this._sOldInput&&this.isValueValid(this._sOldInput)){i.updateDomValue(this._sOldInput);}else if(this._sOldValue&&this.isValueValid(this._sOldValue)){i.updateDomValue(this._sOldValue);}else{i.updateDomValue("");}if(this._iOldCursorPos){Q(i.getFocusDomRef()).cursorPos(this._iOldCursorPos);}this._showWrongValueVisualEffect();};w.prototype.init=function(){this._oRb=r.getLibraryResourceBundle("sap.m");a.prototype.init.apply(this,arguments);this._bInitialSelectedKeysSettersCompleted=false;this._bListItemNavigationInvalidated=false;this._iInitialItemFocus=-1;this._bCheckBoxClicked=true;this._bPreventValueRemove=false;this._oTokenizer=this._createTokenizer();this.setAggregation("tokenizer",this._oTokenizer);this._aInitiallySelectedItems=[];this._oRbM=r.getLibraryResourceBundle("sap.m");this._oRbC=r.getLibraryResourceBundle("sap.ui.core");this._fillList();};w.prototype.clearSelection=function(){this.removeAllSelectedItems();};w.prototype.insertItem=function(i,x){this.insertAggregation("items",i,x,true);if(i){i.attachEvent("_change",this.onItemChange,this);}if(this._getList()){this._getList().insertItem(this._mapItemToListItem(i),x);}return this;};w.prototype.removeItem=function(i){i=this.removeAggregation("items",i);if(this._getList()){this._getList().removeItem(i&&k.getListItem(i));}this.removeSelection({item:i,id:i?i.getId():"",key:i?i.getKey():"",fireChangeEvent:false,suppressInvalidate:true,listItemUpdated:true});return i;};w.prototype.isItemSelected=function(i){return this.getSelectedItems().indexOf(i)>-1;};w.prototype._clearTokenizer=function(){this.getAggregation("tokenizer").destroyTokens();};w.prototype._toggleTokenClass=function(){this.toggleStyleClass("sapMMultiComboBoxHasToken",this._hasTokens());};w.prototype.exit=function(){a.prototype.exit.apply(this,arguments);this._deregisterResizeHandler();if(this._oTokenizer){this._oTokenizer.destroy();this._oTokenizer=null;}this._oRbC=null;this._oRbM=null;this._oListItemEnterEventDelegate=null;this._sInitialValueState=null;};w.prototype.destroyItems=function(){this.destroyAggregation("items");this.setProperty("selectedKeys",[],true);if(this._getList()){this._getList().destroyItems();}this.getAggregation("tokenizer").destroyTokens();return this;};w.prototype.removeAllItems=function(){var i=this.removeAllAggregation("items");this.removeAllSelectedItems();if(this._getList()){this._getList().removeAllItems();}return i;};w.prototype._getItemByToken=function(i){return k.getItemBy(this.getItems(),i,"Token");};w.prototype._getItemByValue=function(x){var y=k.getSelectableItems(this.getItems());for(var i=0;i<y.length;i++){if(y[i].getText().toLowerCase()===x.toLowerCase()){return y[i];}}};w.prototype._handleItemToFocus=function(){if(this.isOpen()){return;}this.syncPickerContent();var i,x,y=r.byId(document.activeElement.id),z=this.getSelectedItems(),A=k.getSelectableItems(this.getItems()),B=this._getList(),F=B&&B.getItemNavigation(),H=this.getValue(),J=this.getPicker();if(y&&y.isA("sap.m.Token")){x=this._getItemByToken(y);}else if(H){x=this._getItemByValue(H);}if(!x){x=z.length?k.getItemByListItem(this.getItems(),this._getList().getSelectedItems()[0]):A[0];}i=A.indexOf(x);if(F){F.setSelectedIndex(i);}else{this._bListItemNavigationInvalidated=true;this._iInitialItemFocus=i;}J.setInitialFocus(B);};w.prototype.getAccessibilityInfo=function(){var i=this.getSelectedItems().map(function(y){return y.getText();}).join(" ");var x=a.prototype.getAccessibilityInfo.apply(this,arguments);x.type=r.getLibraryResourceBundle("sap.m").getText("ACC_CTR_TYPE_MULTICOMBO");x.description=((x.description||"")+" "+i).trim();return x;};w.prototype._calculateSpaceForTokenizer=function(){if(this.getDomRef()){var i,x=this.getDomRef().offsetWidth,y=this._calculateIconsSpace(),z=this.$().find(".sapMInputBaseInner"),A=["min-width","padding-right","padding-left"],B=A.reduce(function(F,H){return F+(parseInt(z.css(H))||0);},0);i=x-(y+B);i=i<0?0:i;return i+"px";}else{return null;}};w.prototype._syncInputWidth=function(i){var F=this.getDomRef('inner'),x,y;if(!F||(i&&!i.getDomRef())){return;}y=parseFloat(i.getDomRef().getBoundingClientRect().width.toFixed(2));x=this._calculateIconsSpace();F.style.width='calc(100% - '+parseFloat(x+y)+"px)";};w.prototype._handleNMoreAccessibility=function(){var i=s.getStaticId("sap.m","MULTICOMBOBOX_OPEN_NMORE_POPOVER"),x=this.getAggregation("tokenizer"),F=this.getFocusDomRef(),A=(F&&F.getAttribute("aria-describedby")),y=A?A.split(" "):[],N=y.indexOf(i),z=this.getEnabled(),B=!this.getEditable()&&x&&x.getHiddenTokensCount();if(B&&N===-1){y.push(i);z&&this.getFocusDomRef().setAttribute("aria-keyshortcuts","Enter");}else if(N!==-1&&!B){y.splice(N,1);this.getFocusDomRef().removeAttribute("aria-keyshortcuts");}if(F&&y.length){F.setAttribute("aria-describedby",y.join(" ").trim());}};w.prototype.applyShowItemsFilters=function(){this.syncPickerContent();n(this.getItems(),this.filterItems({value:this.getValue()||"_",items:this.getItems()}));};w.prototype.showItems=function(F){var H=true,i=this.fnFilter;if(typeof F==="function"){this.syncPickerContent();this.setFilterFunction(F||function(){return true;});H=this.filterItems({value:this.getValue()||"_",items:this.getItems()}).items.length>0;this.setFilterFunction(i);}if(H){a.prototype.showItems.apply(this,arguments);}};return w;});
