sap.ui.define(["sap/m/Dialog","sap/m/Button","sap/ovp/cards/PayLoadUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/ovp/cards/rta/SettingsDialogConstants","sap/ovp/cards/CommonUtils","sap/ui/Device","sap/m/MessagePopover","sap/m/MessagePopoverItem","sap/m/Link","sap/m/MessageBox","sap/ovp/cards/AnnotationHelper","sap/ui/core/mvc/ViewType","sap/ui/model/json/JSONModel","sap/ovp/app/resources","sap/ovp/app/OVPUtils","sap/base/util/merge","sap/ovp/cards/ovpLogger"],function(D,B,P,O,S,C,a,M,b,L,c,A,V,J,d,e,m,o){"use strict";var r=d;var l=new o("OVP.cards.SettingsUtils");function f(i,q,k1){var l1=i.getComponentInstance(),m1=l1.getComponentData(),n1=m1.appComponent,o1=m1.mainComponent,p1=(k1)?"":m1.cardId,q1=p1+"Dialog",r1=(k1)?"":m1.modelName,s1=(!r1)?undefined:n1.getModel(r1),t1=q.getModel().getData(),u1={cards:{}};u1.cards[q1]={template:t1.template,settings:t1};if(j1.bNewKPICardFlag){var v1=t1.selectedKPI;s1=new sap.ui.model.odata.v2.ODataModel(v1.ODataURI,{'annotationURI':v1.ModelURI,'defaultCountMode':sap.ui.model.odata.CountMode.None});r1=C._getLayerNamespace()+".kpi_card_model_"+j(v1.ODataURI);}if(s1&&!!r1){u1.cards[q1].model=r1;q.setModel(s1,r1);}u1.cards[q1]=o1._getTemplateForChart(u1.cards[q1]);q.getController()._oManifest=u1;if(j1.bNewKPICardFlag){s1.getMetaModel().loaded().then(function(){var w1=O.createCardComponent(q,u1,"dialogCard");w1.then(function(){q.setBusy(false);}).catch(function(){n(u1.cards[q1].settings,"OVP_KEYUSER_ANNOTATION_FAILURE");k(q,u1,q1);});},function(w1){l.error(w1);});s1.attachMetadataFailed(function(){n(u1.cards[q1].settings,"OVP_KEYUSER_METADATA_FAILURE");k(q,u1,q1);});}else{O.createCardComponent(q,u1,"dialogCard");}}function s(i,q){if(!this.oNewDataSources[i]){this.oNewDataSources[i]={uri:q};}}function g(i){if(this.oNewDataSources[i]){delete this.oNewDataSources[i];}}function h(i){var q=this.oAppComponent.getMetadata(),k1=q.getManifestEntry("sap.app").dataSources;if(this.oNewDataSources[i]){return this.oNewDataSources;}return k1;}function j(i){var q=i.split("/");return q[q.length-1]?q[q.length-1]:q[q.length-2];}function k(i,q,k1){q.cards[k1].template="sap.ovp.cards.error";q.cards[k1].model=undefined;var l1=O.createCardComponent(i,q,"dialogCard");var m1=i.getController();l1.then(function(){i.setBusy(false);m1.setBusy(false);}).catch(function(){i.setBusy(false);m1.setBusy(false);});}function n(i,q){if(i){i.errorStatusText=d.getText(q);}}function p(i){if(i.indexOf('#')!==-1){return i.split('#')[1];}else{return"Default";}}function t(i,q){if(i){var k1,l1,m1;if(i.indexOf("{")===0&&i.indexOf("}")===i.length-1){i=i.slice(1,-1);if(i.indexOf(">")!=-1){k1=i.split(">");m1=k1[0];l1=k1[1];}else if(i.indexOf("&gt;")!=-1){k1=i.split("&gt;");m1=k1[0];l1=k1[1];}if(!!l1&&m1==="@i18n"&&j1.oi18nModel){return j1.oi18nModel.getProperty(l1);}else{return i;}}else{return i;}}else{return q;}}function u(i,q,k1,l1){if(q[i]&&q[i][k1]){var m1=typeof q[i][k1]==="string"?q[i][k1]:q[i][k1].String;return t(m1,l1);}else{return l1;}}function v(i,q){var k1=p(q),l1=d.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[k1]);l1=(l1)?l1:k1;if(q.indexOf(",")!==-1){q=q.split(",")[0];}if(q.indexOf(".Identification")!==-1){if(i[q]){var m1=A.sortCollectionByImportance(i[q]);for(var n1=0;n1<m1.length;n1++){var o1=m1[n1];if(o1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(o1&&o1["Label"]){return t(o1["Label"].String,l1);}else{return o1["SemanticObject"].String+"-"+o1["Action"].String;}}if(o1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){if(o1&&o1["Label"]){return t(o1["Label"].String,l1);}else{return o1["Url"].String;}}}}return d.getText("OVP_KEYUSER_LABEL_NO_NAVIGATION");}else if(q.indexOf(".LineItem")!==-1){var p1=A.sortCollectionByImportance(i[q]);p1.forEach(function(s1,n1){if(s1["RecordType"]&&s1["RecordType"].indexOf(".DataField")!==-1&&s1["Label"]){p1[n1]["Label"]={String:t(s1["Label"].String,l1)};}});return p1;}else if(q.indexOf(".HeaderInfo")!==-1){if(i[q]&&i[q]["Description"]&&i[q]["Description"].Label){return t(i[q]["Description"].Label.String,l1);}else{return l1;}}else if(q.indexOf(".PresentationVariant")!==-1||q.indexOf(".SelectionVariant")!==-1||q.indexOf(".SelectionPresentationVariant")!==-1){return u(q,i,"Text",l1);}else if(q.indexOf(".DataPoint")!==-1){return u(q,i,"Title",l1);}else if(q.indexOf(".Chart")!==-1){return u(q,i,"Description",l1);}else if(q.indexOf(".FieldGroup")!==-1){return u(q,i,"Label",l1);}else{var q1="";if(k1!=="Default"){q1="#"+k1;}var r1="com.sap.vocabularies.Common.v1.Label"+q1;if(i[q]&&i[q][r1]){return t(i[q][r1].String,l1);}else{return l1;}}}function w(q,k1){var l1=p(k1),m1=d.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[l1]);m1=(m1)?m1:l1;if(k1.indexOf(",")!==-1){k1=k1.split(",")[0];}if(k1.indexOf(".Identification")!==-1){if(q[k1]){var n1=A.sortCollectionByImportance(q[k1]);for(var i=0;i<n1.length;i++){var o1=n1[i];if(o1.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(o1&&o1["Label"]){return t(o1["Label"],m1);}else{return o1["SemanticObject"]+"-"+o1["Action"];}}if(o1.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){if(o1&&o1["Label"]){return t(o1["Label"],m1);}else{return o1["Url"];}}}}return d.getText("OVP_KEYUSER_LABEL_NO_NAVIGATION");}else if(k1.indexOf(".LineItem")!==-1){var n1=A.sortCollectionByImportance(q[k1]);n1.forEach(function(r1,i){if(r1["$Type"]&&r1["$Type"].indexOf(".DataField")!==-1&&r1["Label"]){n1[i]["Label"]=t(r1["Label"],m1);}});return n1;}else if(k1.indexOf(".HeaderInfo")!==-1){if(q[k1]&&q[k1]["Description"]&&q[k1]["Description"].Label){return t(q[k1]["Description"].Label,m1);}else{return m1;}}else if(k1.indexOf(".PresentationVariant")!==-1||k1.indexOf(".SelectionVariant")!==-1||k1.indexOf(".SelectionPresentationVariant")!==-1){return u(k1,q,"Text",m1);}else if(k1.indexOf(".DataPoint")!==-1){return u(k1,q,"Title",m1);}else if(k1.indexOf(".Chart")!==-1){return u(k1,q,"Description",m1);}else if(k1.indexOf(".FieldGroup")!==-1){return u(k1,q,"Label",m1);}else{var p1="";if(l1!=="Default"){p1="#"+l1;}var q1="com.sap.vocabularies.Common.v1.Label"+p1;if(q[k1]&&q[k1][q1]){return t(q[k1][q1],m1);}else{return m1;}}}function x(i,q,k1){switch(q){case"cardPreview":return(O.getSupportedCardTypes().indexOf(i)!==-1);case"noOfRows":case"noOfColumns":case"stopResizing":var l1=["sap.ovp.cards.stack"];return(l1.indexOf(i)===-1);case"listType":case"listFlavor":var m1=["sap.ovp.cards.list","sap.ovp.cards.v4.list"];return(m1.indexOf(i)!==-1);case"listFlavorForLinkList":var n1=["sap.ovp.cards.linklist"];return(n1.indexOf(i)!==-1);case"isViewSwitchSupportedCard":case"showViewSwitch":case"kpiHeader":var o1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table","sap.ovp.cards.charts.analytical","sap.ovp.cards.charts.smart.chart","sap.ovp.cards.charts.bubble","sap.ovp.cards.charts.donut","sap.ovp.cards.charts.line"];return(o1.indexOf(i)!==-1);case"chartSPVorKPI":case"chart":var p1=["sap.ovp.cards.charts.analytical","sap.ovp.cards.charts.smart.chart","sap.ovp.cards.charts.bubble","sap.ovp.cards.charts.donut","sap.ovp.cards.charts.line"];return(p1.indexOf(i)!==-1);case"sortOrder":case"sortBy":case"lineItem":if(!k1){var q1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table"];return(q1.indexOf(i)!==-1);}else{var q1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table","sap.ovp.cards.charts.analytical","sap.ovp.cards.linklist","sap.ovp.cards.stack"];return(q1.indexOf(i)!==-1);}break;case"identification":var r1=["sap.ovp.cards.stack"];return(r1.indexOf(i)!==-1);case"addViewSwitch":var s1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table"];return(s1.indexOf(i)!==-1);case"addKPIHeader":var s1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table","sap.ovp.cards.charts.analytical"];return(s1.indexOf(i)!==-1);case"selecionOrPresentation":var t1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table","sap.ovp.cards.linklist"];return(t1.indexOf(i)!==-1);case"addODataSelect":var u1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table","sap.ovp.cards.stack"];return(u1.indexOf(i)!==-1);case"addCustomActions":var u1=["sap.ovp.cards.stack"];return(u1.indexOf(i)!==-1);case"setCardProperties":if(k1){var q1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table","sap.ovp.cards.linklist","sap.ovp.cards.stack"];return(q1.indexOf(i)!==-1);}break;default:break;}}function y(i){return!!i.kpiAnnotationPath;}function z(i){return!!i.selectionPresentationAnnotationPath;}function E(i){return z(i)||y(i);}function F(i){return i.substring(i.lastIndexOf("_")+1,i.length).indexOf("C")!==-1;}function G(i){if(i.NewKPICard){return i.NewKPICard;}else if(i.selectedKPICardID){return i.selectedKPICardID.indexOf("newKPICard")!==-1;}else{return false;}}function H(i,q,k1,l1,m1){var n1=true;var o1=true;var p1=false;var q1=false;var r1=false;if(k1){if(i.mainViewSelected){o1=false;}else{n1=false;}}if(i.addNewCard&&i.model){var q1=true;if(i.template){r1=true;if(i.entitySet){p1=true;}}}var s1;switch(q){case"cardPreview":s1=x(i.template,"cardPreview");break;case"noOfRows":case"noOfColumns":case"stopResizing":s1=n1&&x(i.template,q);break;case"title":s1=n1;break;case"dynamicSwitchSubTitle":s1=n1&&!!i.dynamicSubTitle;break;case"dynamicSwitchStateSubTitle":s1=!!i.dynamicSubtitleAnnotationPath;break;case"subTitle":if(!i.addNewCard){if(!i.subTitle){i.subTitle=" ";s1=true;}else{s1=n1&&!i.dynamicSubtitleAnnotationPath;}}else{s1=n1;}break;case"dynamicSubTitle":s1=n1&&!!i.dynamicSubtitleAnnotationPath;break;case"valueSelectionInfo":if(!i.addNewCard){if(!i.valueSelectionInfo){i.valueSelectionInfo=" ";}s1=n1&&(x(i.template,"kpiHeader")&&!!i.dataPointAnnotationPath)&&!G(i);}else{s1=n1&&q1&&r1&&p1&&i.addKPIHeaderCheckBox&&x(i.template,"addKPIHeader");}break;case"dataPoint":if(!i.addNewCard){s1=o1&&!y(i)&&(x(i.template,"kpiHeader")&&!!i.dataPointAnnotationPath);}else{s1=o1&&q1&&r1&&p1&&i.addKPIHeaderCheckBox&&x(i.template,"addKPIHeader");}break;case"listType":case"listFlavor":case"listFlavorForLinkList":if(!i.addNewCard){s1=n1&&x(i.template,q);}else{s1=n1&&q1&&r1&&p1&&x(i.template,q);}break;case"identification":if(!i.addNewCard){s1=o1&&(!i.staticContent)&&!x(i.template,q);}else{s1=o1&&q1&&r1&&p1&&!x(i.template,q);}break;case"selectionPresentationVariant":if(!i.addNewCard){s1=o1&&z(i)&&!y(i)&&x(i.template,"kpiHeader");}else{s1=o1&&q1&&r1&&p1&&x(i.template,"selecionOrPresentation")&&!!(Array.isArray(i.selectionPresentationVariant)&&i.selectionPresentationVariant.length);}break;case"KPI":case"dataPointSelectionMode":if(!i.addNewCard){s1=o1&&y(i)&&!z(i)&&x(i.template,"chart")&&!G(i);}else{s1=o1&&q1&&r1&&p1&&x(i.template,"chart");}break;case"presentationVariant":case"selectionVariant":if(!i.addNewCard){s1=o1&&!E(i)&&(!i.staticContent)&&x(i.template,"kpiHeader");}else{s1=o1&&q1&&r1&&p1&&!(Array.isArray(i.selectionPresentationVariant)&&i.selectionPresentationVariant.length)&&x(i.template,"selecionOrPresentation");}break;case"kpiHeader":s1=n1&&!y(i)&&x(i.template,q);break;case"lineItem":case"chart":if(!i.addNewCard){s1=o1&&!E(i)&&x(i.template,q);}else{s1=o1&&q1&&r1&&p1&&x(i.template,q,i.addNewCard);}break;case"chartSPVorKPI":s1=o1&&E(i)&&!G(i)&&x(i.template,q);break;case"presentationVariantSPVorKPI":case"selectionVariantSPVorKPI":s1=o1&&E(i)&&!G(i)&&(!i.staticContent)&&x(i.template,"kpiHeader");break;case"showViewName":s1=k1&&o1;break;case"showDefaultView":if(k1&&o1){if(i.defaultViewSelected!=i.selectedKey){s1=true;}}else{s1=false;}break;case"showEntitySet":if(k1&&o1){if(i.selectedKey>0&&i.tabs[i.selectedKey-1].entitySet){s1=true;}else{s1=false;}}else{s1=false;}break;case"showMore":case"removeVisual":case"lineItemSubTitle":case"lineItemTitle":case"staticLink":case"links":var t1=(i.template==="sap.ovp.cards.linklist"&&!!i.staticContent);if(q==="staticLink"){s1=(t1&&!!i.staticContent[l1].targetUri);}else if(q==="links"){s1=(t1&&!!i.staticContent[l1].semanticObject);}else if(q==="removeVisual"){s1=(t1&&(!!i.staticContent[l1].targetUri||!!i.staticContent[l1].semanticObject));}else{s1=t1;}break;case"selectCardType":s1=n1&&q1;break;case"addKPIHeader":s1=n1&&q1&&r1&&x(i.template,q);break;case"setEntitySet":s1=o1&&q1&&r1;break;case"setCardProperties":s1=n1&&q1&&r1&&p1&&x(i.template,q,i.addNewCard);break;case"setGeneralCardProperties":s1=n1&&q1&&r1&&p1;break;case"setAnnotationCardProperties":s1=o1&&q1&&r1&&p1;break;case"subTitleRequired":s1=q1&&r1&&p1&&i.addKPIHeaderCheckBox;break;case"addODataSelect":if(!i.addNewCard){s1=o1&&x(i.template,q);}else{s1=o1&&q1&&r1&&p1&&x(i.template,q);}break;case"isViewSwitchSupportedCard":case"showViewSwitch":s1=q1&&r1&&(p1||!!i.showViewSwitchButton)&&x(i.template,q);break;case"dataSource":s1=n1;break;case"dataSourceExisting":s1=!i.newDataSource;break;case"dataSourceNew":s1=i.newDataSource;break;case"addCustomActions":s1=n1&&x(i.template,q);break;default:break;}return s1;}function I(i){var q=false;this.oVisibility.viewSwitchEnabled=false;this.oVisibility.showViewSwitch=false;if(!this.bAddNewCardFlag){if(x(i.template,"isViewSwitchSupportedCard")&&!G(i)){if(i.tabs&&i.tabs.length){q=true;this.oVisibility.showViewSwitch=true;}this.oVisibility.viewSwitchEnabled=true;}}else{if(i.tabs&&i.tabs.length){q=true;this.oVisibility.showViewSwitch=H(i,"showViewSwitch");}this.oVisibility.viewSwitchEnabled=H(i,"isViewSwitchSupportedCard");}this.oVisibility.cardPreview=H(i,"cardPreview");this.oVisibility.stopResizing=H(i,"stopResizing",q);this.oVisibility.noOfRows=H(i,"noOfRows",q);this.oVisibility.noOfColumns=H(i,"noOfColumns",q);this.oVisibility.title=H(i,"title",q);this.oVisibility.subTitle=H(i,"subTitle",q);this.oVisibility.valueSelectionInfo=H(i,"valueSelectionInfo",q);this.oVisibility.listType=H(i,"listType",q);this.oVisibility.listFlavor=H(i,"listFlavor",q);this.oVisibility.listFlavorForLinkList=H(i,"listFlavorForLinkList",q);if(i.template==="sap.ovp.cards.linklist"&&!!i.staticContent){var k1=i.staticContent,l1={},m1={},n1={},o1={};for(var p1=0;p1<k1.length;p1++){var q1=k1[p1].index;l1[q1]=H(i,"staticLink",null,p1);m1[q1]=H(i,"links",null,p1);n1[q1]=H(i,"removeVisual",null,p1);o1[q1]=H(i,"showMore",null,p1);}this.oVisibility.staticLink=l1;this.oVisibility.links=m1;this.oVisibility.removeVisual=n1;this.oVisibility.showMore=o1;}this.oVisibility.lineItemTitle=H(i,"lineItemTitle");this.oVisibility.lineItemSubTitle=H(i,"lineItemSubTitle");this.oVisibility.showViewName=H(i,"showViewName",q);this.oVisibility.showDefaultView=H(i,"showDefaultView",q);this.oVisibility.showEntitySet=H(i,"showEntitySet",q);this.aVariantNames.forEach(function(s1){this.oVisibility[s1.sPath]=H(i,s1.sPath,q)&&!!i[s1.sPath]&&!!i[s1.sPath].length;}.bind(this));this.oVisibility.kpiHeader=H(i,"kpiHeader",q)&&!!i["dataPoint"]&&!!i["dataPoint"].length;this.oVisibility.dynamicSwitchSubTitle=H(i,"dynamicSwitchSubTitle",q);this.oVisibility.dynamicSwitchStateSubTitle=H(i,"dynamicSwitchStateSubTitle",q);this.oVisibility.dataSource=H(i,"dataSource",q);this.oVisibility.dataSourceExisting=H(i,"dataSourceExisting",q);this.oVisibility.dataSourceNew=H(i,"dataSourceNew",q);this.oVisibility.selectCardType=H(i,"selectCardType",q);this.oVisibility.addKPIHeader=H(i,"addKPIHeader",q);this.oVisibility.setEntitySet=H(i,"setEntitySet",q);this.oVisibility.setCardProperties=H(i,"setCardProperties",q);this.oVisibility.setGeneralCardProperties=H(i,"setGeneralCardProperties",q);this.oVisibility.subTitleRequired=H(i,"subTitleRequired",q);this.oVisibility.dataPointSelectionMode=H(i,"dataPointSelectionMode",q);var r1;for(var p1=0;p1<this.aVisiblePropertiesForAnnotation.length;p1++){if(this.oVisibility[this.aVisiblePropertiesForAnnotation[p1].sProperty]){r1=true;break;}}this.oVisibility.setAnnotationCardProperties=r1?H(i,"setAnnotationCardProperties",q):false;this.oVisibility.addODataSelect=H(i,"addODataSelect",q);this.oVisibility.addCustomActions=H(i,"addCustomActions",q);this.oVisibility.moveToTheTop=false;this.oVisibility.moveUp=false;this.oVisibility.moveDown=false;this.oVisibility.moveToTheBottom=false;this.oVisibility.delete=false;}function K(i){var q=i.getProperty("/staticContent");for(var k1=0;k1<q.length;k1++){q[k1].index="Index--"+(k1+1);}i.setProperty("/staticContent",q);}function N(q){var k1=0;for(var i=q.length-1;i>=0;i--){if(/^\d+$/.test(q[i])){k1=parseInt(q[i],10);break;}}return k1;}function Q(i){var q=i&&i.metaModel&&i.metaModel.oModel;var k1=C.isODataV4(q);if(i.lineItem){i.lineItem.forEach(function(m1){if((k1&&m1.value==="@"+i.annotationPath)||m1.value===i.annotationPath){i.lineItemQualifier=m1.name;}});}if(i.tabs&&i.tabs.length&&i.selectedKey){i.viewName=i.tabs[i.selectedKey-1].value;i.isDefaultView=false;if(i.selectedKey===i.defaultViewSelected){i.isDefaultView=true;}}var l1=i.sortOrder;i.sortOrder="descending";if(l1&&l1.toLowerCase()!=="descending"){i.sortOrder="ascending";}i.isExtendedList=false;if(i.listType==="extended"){i.isExtendedList=true;}i.isBarList=false;if(i.listFlavor==="bar"){i.isBarList=true;}i.hasKPIHeader=false;if(i.dataPointAnnotationPath){i.hasKPIHeader=true;}return i;}function R(i){var q=i&&i.metaModel&&i.metaModel.oModel;var k1=C.isODataV4(q);var l1=i.kpiAnnotationPath;var m1=i.template;var n1=k1?i.entityType.$Type:i.entityType;var o1="";if(l1&&n1&&m1==="sap.ovp.cards.charts.analytical"){var p1=n1[l1];var q1=p1&&p1.Detail;if(q1&&q1.RecordType==="com.sap.vocabularies.UI.v1.KPIDetailType"&&q1.SemanticObject&&q1.Action){o1="#"+q1.SemanticObject.String+"-"+q1.Action.String;}}i["KPINav"]=o1;}function T(i){var q=[],k1=i.metaModel,l1=!!k1?k1.getODataEntityContainer().entitySet:[],m1=k1&&k1.getODataEntityContainer().namespace+".";l1.forEach(function(n1){if(!i.addNewCard){var o1=d.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[n1.name]),p1=k1.getODataEntityType(n1.entityType)["sap:label"];q.push({name:t(p1,o1),value:n1.name});}else{var o1=d.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[n1.name]),p1=k1.getODataEntityType(n1.entityType)["sap:label"],q1=n1.entityType.split(m1)[1];q.push({name:t(p1,o1),value:n1.name,entityType:q1});}});if(q.length>0){i["allEntitySet"]=q;}}function U(q){var k1=q.metaModel,l1=k1.getObject("/"),m1=Object.keys(l1),n1=[],o1=[];for(var i=0;i<m1.length;i++){if(m1[i].startsWith("$")){continue;}n1.push({name:m1[i],entityType:l1[m1[i]].$Type});}var p1=k1.getData();var q1=p1.$EntityContainer;var r1=q1?q1.split("."):"";r1.pop();var s1=r1.join(".")+".";n1.forEach(function(t1){var u1=d.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[t1.name]);var v1=p1&&p1[t1.entityType]&&p1[t1.entityType]["sap:label"];if(!q.addNewCard){o1.push({name:t(v1,u1),value:t1.name});}else{var w1=t1.entityType.split(s1)[1];o1.push({name:t(v1,u1),value:t1.name,entityType:w1});}});if(o1.length>0){q["allEntitySet"]=o1;}}function W(i){var q=i.metaModel&&i.metaModel.getObject('/dataServices/schema')&&i.metaModel.getObject('/dataServices/schema')[0].entityType;if(q){q.forEach(function(k1){var l1=0;this.aVariantNames.forEach(function(m1){for(var n1 in k1){if(n1.indexOf(m1.sVariant)!==-1){l1++;}}});if(!l1){i.allEntitySet=i.allEntitySet.filter(function(m1){return m1.entityType!==k1.name;});}}.bind(this));}}function X(i){var q=i&&i.metaModel&&i.metaModel.oModel;var k1=C.isODataV4(q);var l1;if(k1){l1=i.metaModel.getData()["$Annotations"][i.entityType.$Type];}else{l1=i.entityType;}if(!i["allEntitySet"]){if(k1){U(i);}else{T(i);}}R(i);if(i.addNewCard){W.call(this,i);}this.aVariantNames.forEach(function(q1){var r1=[],s1=1;for(var t1 in l1){if(l1.hasOwnProperty(t1)&&t1.indexOf(q1.sVariant)!==-1){if(q1.sVariant===".LineItem"){var u1={name:r.getText("OVP_KEYUSER_LABEL_LINEITEM_OPTIONS",[s1]),value:k1?t1.substring(1):t1,fields:k1?w(l1,t1):v(l1,t1)};r1.push(u1);s1++;}else{r1.push({name:k1?w(l1,t1):v(l1,t1),value:k1?t1.substring(1):t1});}}}if(r1.length!==0){i[q1.sPath]=r1;}});if(k1){var m1=i1(i);i["modelProperties"]=m1.map(function(q1){return{name:q1,value:q1};});}else if(i.entityType&&i.entityType.property){i["modelProperties"]=i.entityType.property.map(function(q1){return{name:q1.name,value:q1.name};});}if(!!i.tabs&&i.tabs.length){var n1=false,o1=i.tabs[i.tabs.length-1].value,p1=o1.split(' ');i.newViewCounter=N(p1);i.defaultViewSelected=i.selectedKey;i.isViewResetEnabled=false;i.aViews=[{text:r&&r.getText("OVP_KEYUSER_LABEL_MAIN_VIEW"),key:0,isLaterAddedView:false,isViewResetEnabled:false}];n1=i.tabs.some(function(q1){return q1.dataPointAnnotationPath;});i.tabs.forEach(function(q1,r1){var s1=q1.value;if(n1&&!q1.dataPointAnnotationPath&&q1.dataPoint&&q1.dataPoint.length){q1.dataPointAnnotationPath=q1.dataPoint[0].value;}if(r1+1===i.selectedKey){s1=q1.value;if(r){s1+=" ("+r.getText("OVP_KEYUSER_LABEL_DEFAULT_VIEW")+")";}else{s1+=" (Default view)";}}i.aViews.push({text:s1,key:r1+1,initialSelectedKey:r1+1,isLaterAddedView:false,isViewResetEnabled:false});});}else if(x(i.template,"isViewSwitchSupportedCard")){i.newViewCounter=0;i.aViews=[{text:r.getText("OVP_KEYUSER_SHOWS_DIFFERENT_VIEWS"),key:0,initialSelectedKey:0,isLaterAddedView:false,isViewResetEnabled:false}];}return i;}function Y(q){var k1=q.getData();if(sap.ushell&&sap.ushell.Container){sap.ushell.Container.getService("CrossApplicationNavigation").getLinks().done(function(l1){var m1=[],n1={};for(var i=0;i<l1.length;i++){m1.push(l1[i].intent);n1[l1[i].intent]=l1[i].text;}sap.ushell.Container.getService("CrossApplicationNavigation").isIntentSupported(m1).done(function(o1){var l1=[];for(var p1 in o1){if(o1.hasOwnProperty(p1)&&o1[p1].supported===true&&n1&&n1[p1]){l1.push({name:n1[p1],value:p1});}}var q1=k1;if(l1.length!==0||l1.length!==0){q1["links"]=l1;}q.refresh();}).fail(function(o1){l.error(o1);});}).fail(function(i){l.error(i);});}}function Z(i){this.oResetButton.setEnabled(i);}function $(i){this.oSaveButton.setEnabled(i);var q=this.oMessagePopOver.getModel(),k1=q.getProperty("/Counter/Error");this.bError=(k1>0);}function _(i){var q=new RegExp("http(s)?:\/\/(www\.)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?","i");return q.test(i);}function a1(i,q){if(q==="targetUri"){return!_(i)&&(!!i||i==="");}else{return!(i.trim().length);}}function b1(q){var k1=q.getParameter("path"),l1="",m1,i,n1,o1,p1,q1;if(k1==="/title"||k1==="title"||k1==="/viewName"||k1==="targetUri"||k1==="value"){var r1=q.getParameter("value"),s1=a1(r1,k1),t1,u1=q.getParameter("context");if(k1==="/viewName"){t1=q.getSource().getProperty("/selectedKey");l1=d.getText("OVP_KEYUSER_INPUT_ERROR_VIEW_NAME");k1="/tabs/"+(t1-1)+"/value";}if(k1==="value"){l1=d.getText("OVP_KEYUSER_INPUT_ERROR_VIEW_NAME");k1=u1.getPath()+"/"+k1;}if(k1.indexOf("/title")!==-1){l1=d.getText("OVP_KEYUSER_INPUT_ERROR");}if(u1&&u1.getPath().indexOf("staticContent")!==-1){m1=u1.getPath().split("/");if(k1==="title"){l1=d.getText("OVP_KEYUSER_INPUT_ERROR_RECORD_TITLE")+(parseInt(m1[m1.length-1],10)+1);}else if(k1==="targetUri"){l1=d.getText("OVP_KEYUSER_INPUT_ERROR_RECORD_URL")+" "+(parseInt(m1[m1.length-1],10)+1);}k1=u1.getPath()+"/"+k1;}n1=this.oMessagePopOver.getModel();o1=n1.getProperty("/Messages");p1=n1.getProperty("/Counter/All");q1=n1.getProperty("/Counter/Error");if(s1){$.bind(this)(true);for(i=0;i<o1.length;i++){if(o1[i].fieldName===k1){o1.splice(i,1);p1--;q1--;i--;}}o1.push({"type":"Error","title":l1,"fieldName":k1,"counter":q1+1});p1++;q1++;}else{$.bind(this)(true);for(i=0;i<o1.length;i++){if(o1[i].fieldName===k1){o1.splice(i,1);p1--;q1--;i--;}}}n1.setProperty("/Messages",o1);n1.setProperty("/Counter/All",p1);n1.setProperty("/Counter/Error",q1);n1.refresh(true);}else if(k1==="/staticContent,title"||k1==="/staticContent,targetUri"||k1==="/tabs,value"){m1=k1.split(",");n1=this.oMessagePopOver.getModel();o1=n1.getProperty("/Messages");p1=n1.getProperty("/Counter/All");q1=n1.getProperty("/Counter/Error");$.bind(this)(true);for(i=0;i<o1.length;i++){if(o1[i].fieldName.indexOf(m1[0])!==-1&&o1[i].fieldName.indexOf(m1[1])!==-1){o1.splice(i,1);p1--;q1--;i--;}}n1.setProperty("/Messages",o1);n1.setProperty("/Counter/All",p1);n1.setProperty("/Counter/Error",q1);n1.refresh(true);}}function c1(){var i=this.oMessagePopOver.getModel();i.setProperty("/Messages",[]);i.setProperty("/Counter/All",0);i.setProperty("/Counter/Error",0);i.setProperty("/Counter/Success",0);i.setProperty("/Counter/Warning",0);i.setProperty("/Counter/Information",0);i.refresh(true);}function d1(){var i=new L({text:"Show more information",href:"",target:"_blank"});var q=new b({type:"{type}",title:"{title}",description:"{description}",subtitle:"{subtitle}",counter:"{counter}",fieldName:"{fieldName}",link:i});this.oMessagePopOver=new M({items:{path:"/Messages",template:q}});var k1={"Counter":{"All":0,"Error":0,"Success":0,"Warning":0,"Information":0},"Messages":[]};var l1=new J(k1);this.oMessagePopOver.setModel(l1);this.oMessagePopOverButton.setModel(l1);}function e1(i,q){var k1=i.byId("sapOvpSettingsForm");if(k1){var l1=k1.getDomRef();if(l1){l1.style.width=q;}}}function f1(i){var q=this.dialogBox.getContent()[0],k1=q.getModel(),l1=q.getModel("deviceMediaProperties");switch(i.name){case"S":case"M":l1.setProperty("/deviceMedia","Column");e1(q,"100%");break;case"L":case"XL":default:l1.setProperty("/deviceMedia","Row");e1(q,"calc(100% - "+(k1.getProperty("/dialogBoxWidth")+1)+"rem)");break;}l1.refresh(true);}function g1(){a.media.detachHandler(f1.bind(this),null,"SettingsViewRangeSet");a.media.removeRangeSet("SettingsViewRangeSet");}function h1(){a.media.initRangeSet("SettingsViewRangeSet",[520,760,960],"px",["S","M","L","XL"]);a.media.attachHandler(f1.bind(this),null,"SettingsViewRangeSet");f1.bind(this)(a.media.getCurrentRange("SettingsViewRangeSet"));}function i1(i){var q=i.entitySet,k1=i.metaModel,l1=k1.getObject("/"+q),m1=l1.$Type,n1=k1.getObject("/"+m1),o1=Object.keys(n1);var p1=o1.filter(function(q1){return!q1.startsWith("$");});return p1;}var j1={dialogBox:undefined,oSaveButton:undefined,oResetButton:undefined,oMessagePopOverButton:undefined,oMessagePopOver:undefined,oAppDescriptor:undefined,oOriginalAppDescriptor:undefined,oMainComponent:undefined,oAppComponent:undefined,oNewDataSources:{},sApplicationId:"",oi18nModel:undefined,iContentHeightForDialog:38,iContentHeightForDialogWithViewSwitch:33,aVariantNames:S.aVariantNames,aVisiblePropertiesForAnnotation:S.aVisiblePropertiesForAnnotation,getDataSources:h,removeDataSources:g,setDataSources:s,attachWindowResizeHandler:h1,detachWindowResizeHandler:g1,settingFormWidth:e1,addKPINavApplicationName:R,addManifestSettings:Q,setVisibilityForFormElements:I,getVisibilityOfElement:H,checkForEmptyString:t,enableResetButton:Z,enableSaveButton:$,checkClonedCard:F,resetErrorHandling:c1,createErrorCard:k,setErrorMessage:n,getQualifier:p,getTrimmedDataURIName:j,addSupportingObjects:X,oVisibility:S.oVisibility,bError:false,bNewStaticLinkListCardFlag:false,bNewKPICardFlag:false,bAddNewCardFlag:false,aListType:S.aListType,aListFlavour:S.aListFlavour,aDataPointSelectionMode:S.aDataPointSelectionMode,aSortOrder:S.aSortOrder,aCardType:S.aCardType,aLinkListFlavour:S.aLinkListFlavour,getDialogBox:function(i){return new Promise(function(k1,l1){if(!this.dialogBox){this.oSaveButton=new B("settingsSaveBtn",{text:d.getText("save"),type:"Emphasized"});var m1=new B("settingsCancelBtn",{text:d.getText("cancelBtn")});this.oResetButton=new B("settingsResetBtn",{text:d.getText("resetCardBtn")});this.oMessagePopOverButton=new B("settingsMessagePopOverBtn",{text:"{/Counter/All}",type:"Emphasized",icon:"sap-icon://message-popup",visible:"{= ${/Counter/All} === 0 ? false : true}"}).addStyleClass("sapOvpSettingsMessagePopOverBtn");this.dialogBox=new D("settingsDialog",{title:d.getText("settingsDialogTitle"),buttons:[this.oMessagePopOverButton,this.oSaveButton,m1,this.oResetButton],afterClose:function(d2){var b2=this.dialogBox.getContent()[0],e2=b2.byId("sapOvpSettingsLineItemTitle"),f2=b2.byId("sapOvpSettingsLineItemSubTitle");if(e2){e2.destroy();}if(f2){f2.destroy();}this.bNewStaticLinkListCardFlag=false;this.bNewKPICardFlag=false;this.bAddNewCardFlag=false;this.newDataSource=false;this.dialogBox.destroyContent();this.detachWindowResizeHandler();}.bind(this)});this.dialogBox.setBusyIndicatorDelay(0);m1.attachPress(function(d2){this.dialogBox.close();}.bind(this));}this.oResetButton.setVisible(!this.bNewKPICardFlag);d1.bind(this)();var n1=this.bNewStaticLinkListCardFlag||this.bNewKPICardFlag||this.bAddNewCardFlag;var o1=i.getComponentInstance(),p1=o1.getRootControl().getModel("ovpCardProperties"),q1;this.oi18nModel=o1.getComponentData().i18n;if(this.bNewStaticLinkListCardFlag){q1={"title":"New Title","subTitle":"New Subtitle","staticContent":[],"listFlavor":"standard","template":"sap.ovp.cards.linklist","layoutDetail":p1.getProperty("/layoutDetail")};}else if(this.bNewKPICardFlag){var r1=o1.getComponentData().mainComponent.getView().getModel("JSONModelForSSB").getProperty("/d/results"),s1=r1[0];q1={"entitySet":s1.ODataEntityset,"kpiAnnotationPath":"com.sap.vocabularies.UI.v1.KPI#"+s1.KPIQualifier,"title":s1.GroupTitle,"subTitle":s1.KPITitle,"template":"sap.ovp.cards.charts.analytical","layoutDetail":p1.getProperty("/layoutDetail"),"selectedKPI":s1,"errorStatusText":undefined,"KPIData":r1};}else if(this.bAddNewCardFlag){q1={"addNewCard":true,"newDataSource":false,"title":"","subTitle":"","cardType":this.aCardType,"aListType":this.aListType,"aListFlavour":this.aListFlavour,"valueSelectionInfo":"","navigation":this.aDataPointSelectionMode,"aLinkListFlavour":this.aLinkListFlavour,"authorization":""};}else{q1=p1.getData();}var t1=m({},q1);t1=X.call(this,t1);t1=this.addManifestSettings(t1);var u1=new J(t1),v1=i.getDomRef().offsetHeight,w1=new J(a.system),x1=new J({"deviceMedia":"Row"}),y1=o1.getComponentData(),z1=y1.mainComponent,A1=y1.appComponent,B1=(n1)?"":y1.cardId;this.oAppComponent=A1;this.oAppDescriptor=z1._getCardFromManifest(B1);this.sApplicationId=z1._getApplicationId();this.oMainComponent=z1;this.oOriginalAppDescriptor=A1._getOvpCardOriginalConfig(B1);w1.setDefaultBindingMode("OneWay");t1.dialogBoxHeight=v1;t1.dialogBoxWidth=20;var C1=C._getLayer();if(C1===e.Layers.vendor){u1.setProperty("/layer",C1);var D1=[];if(t1.customParams||t1.staticParameters){u1.setProperty("/addCustomParameters",true);if(t1.staticParameters&&Object.keys(t1.staticParameters).length){for(var E1 in t1.staticParameters){D1.push({"key":E1,"value":t1.staticParameters[E1]});}u1.setProperty("/aAllStaticParameters",D1);}}else{u1.setProperty("/addCustomParameters",false);}if(t1.objectStreamCardsSettings&&t1.objectStreamCardsSettings.customActions){u1.setProperty("/addCustomActions",true);}else{u1.setProperty("/addCustomActions",false);}var F1=sap.ui.getCore().byId("mainView").getModel("i18n").oData.bundle.aCustomBundles;if(F1[0]&&F1[0].aPropertyFiles[0]&&F1[0].aPropertyFiles[0].mProperties){var G1=F1[0].aPropertyFiles[0].mProperties;var H1=[];var I1=[];var J1=[];var K1=[];if(!t1.addNewCard){var L1=S.oI18nKeyValueProperty;for(var E1 in L1){if(E1==="title"){I1.push({key:"",value:t1[E1]});}if(E1==="subTitle"){J1.push({key:"",value:t1[E1]});}if(E1==="valueSelectionInfo"){K1.push({key:"",value:t1[E1]});}}for(var E1 in G1){if(G1.hasOwnProperty(E1)){I1.push({key:E1,value:G1[E1]});}}for(var E1 in G1){if(G1.hasOwnProperty(E1)){J1.push({key:E1,value:G1[E1]});}}for(var E1 in G1){if(G1.hasOwnProperty(E1)){K1.push({key:E1,value:G1[E1]});}}u1.setProperty("/ai18nPropertiesAndTitle",I1);u1.setProperty("/ai18nPropertiesAndSubTitle",J1);u1.setProperty("/ai18nPropertiesAndValSelInfo",K1);}for(var E1 in G1){if(G1.hasOwnProperty(E1)){H1.push({key:E1,value:G1[E1]});}}u1.setProperty("/ai18nProperties",H1);}}if(t1.template==="sap.ovp.cards.linklist"){u1.setProperty("/listFlavorName",d.getText("OVP_KEYUSER_CAROUSEL"));}else{u1.setProperty("/listFlavorName",d.getText("OVP_KEYUSER_BARLIST"));}if(t1.layoutDetail==="resizable"){var M1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table"];if(!t1.defaultSpan){t1.defaultSpan={};u1.setProperty("/defaultSpan/cols",u1.getProperty("/cardLayout/colSpan"));u1.setProperty("/defaultSpan/rows",M1.indexOf(t1.template)?u1.getProperty("/cardLayout/noOfItems"):u1.getProperty("/cardLayout/rowSpan"));}else{if(!t1.defaultSpan.rows){u1.setProperty("/defaultSpan/rows",M1.indexOf(t1.template)?u1.getProperty("/cardLayout/noOfItems"):u1.getProperty("/cardLayout/rowSpan"));}if(!t1.defaultSpan.cols){u1.setProperty("/defaultSpan/cols",u1.getProperty("/cardLayout/colSpan"));}}t1.NoOfColumns=[];var N1=1,O1=6;for(var q=N1;q<=O1;q++){t1.NoOfColumns.push({value:q});}if(x(t1.template,'chart')||t1.template==='sap.ovp.cards.linklist'){var P1=i.getComponentInstance().getComponentData().mainComponent,Q1=P1.getLayout(),R1=Q1.getDashboardLayoutUtil(),S1=z1._getCardId(i.getId()),T1=R1.calculateCardProperties(S1),U1=R1._getCardController(S1).getView().byId('bubbleText')?43:0,V1=T1.headerHeight+T1.dropDownHeight+U1+50,W1=Math.ceil(T1.minCardHeight/R1.getRowHeightPx())+1;t1.NoOfRows=[];t1.NoOfRows.push({name:"None",value:0});t1.NoOfRows.push({name:"Small",value:W1});t1.NoOfRows.push({name:"Standard",value:Math.ceil((V1+480)/R1.getRowHeightPx())+1});if(this.bNewStaticLinkListCardFlag||this.bNewKPICardFlag){u1.setProperty("/defaultSpan/cols",1);u1.setProperty("/defaultSpan/rows",W1);}}}if(t1.addNewCard){u1.setProperty("/addViewSwitchCheckBox",false);u1.setProperty("/addKPIHeaderCheckBox",false);var X1=[];var Y1=z1.oCardsModels;if(Y1){for(var E1 in Y1){if(E1.indexOf("kpi_card_model_")<0){X1.push(Object.assign({},{Title:E1},Y1[E1]));}}u1.setProperty("/datasources",X1);u1.setProperty("/datasourcesFromManifest",X1);}}var Z1={};var $1=new J(Z1);Y($1);if(t1.template==="sap.ovp.cards.linklist"&&t1.staticContent){K(u1);u1.setProperty("/lineItemId","linkListItem--1");u1.setProperty("/lineItemIdCounter",t1.staticContent.length);}if(t1.template==="sap.ovp.cards.charts.analytical"){var _1=z1._getCardId(i.getId());u1.setProperty("/NewKPICard",this.bNewKPICardFlag);u1.setProperty("/selectedKPICardID",_1);}this.setVisibilityForFormElements(t1);var a2=new J(this.oVisibility);if(!this.bAddNewCardFlag){u1.attachPropertyChange(b1.bind(this));}var b2=new sap.ui.core.mvc.XMLView("settingsView",{viewName:"sap.ovp.cards.rta.SettingsDialog",type:V.XML,preprocessors:{xml:{bindingContexts:{ovpCardProperties:u1.createBindingContext("/")},models:{ovpCardProperties:u1,deviceSystemProperties:w1}}}});b2.setModel($1,"staticCardProperties");var c2=d.oResourceModel;b2.setModel(u1);b2.setModel(c2,"ovpResourceModel");b2.setModel(x1,"deviceMediaProperties");b2.setModel(a2,"visibility");if(this.oi18nModel){b2.setModel(this.oi18nModel,"@i18n");}this.dialogBox.addContent(b2);this.attachWindowResizeHandler();b2.loaded().then(function(d2){if(!this.bAddNewCardFlag){var e2=d2.byId("dialogCard");if(!e2.getVisible()){e2=d2.byId("dialogCardNoPreview");var f2=b2.getModel().getProperty("/template").split("."),g2=f2[f2.length-1],h2=d.getText("OVP_KEYUSER_NO_CARD_PREVIEW_MSG",[g2]);e2.setText(h2);}else{e2.setWidth(t1.dialogBoxWidth+"rem");}}f(i,d2,n1);this.dialogBox.open();d2.getController().settingsResolve=k1;}.bind(this));}.bind(this));}};j1.fnEditCardHandler=function(i,q){var k1=i.getComponentInstance().getComponentData().mainComponent,l1=k1.getLayout(),m1=k1.getUIModel();return j1.getDialogBox(i).then(function(n1){var o1=[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_changeCard",content:n1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"editCardSettings",content:n1.flexibilityChange}}];if(n1.viewSwitchChange){o1.push({selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{changeType:"viewSwitch",content:n1.viewSwitchChange}});}if(m1.getProperty('/containerLayout')==='resizable'){var p1=l1.getDashboardLayoutModel(),q1=l1.getDashboardLayoutUtil(),r1=k1._getCardId(i.getId()),s1=p1.getCardById(r1),t1=q1.calculateCardProperties(r1),u1=p1.getColCount(),v1='C'+u1,w1=n1.flexibilityChange.newAppDescriptor.settings.defaultSpan,x1,y1=[];if(w1&&w1.cols){o1.forEach(function(A1){if(A1.changeSpecificData.changeType==='editCardSettings'){var B1=A1.changeSpecificData.content.oldAppDescriptor;B1.settings.defaultSpan={rowSpan:s1.dashboardLayout.rowSpan,colSpan:s1.dashboardLayout.colSpan,showOnlyHeader:s1.dashboardLayout.showOnlyHeader};}});if(w1.rows===0){s1.dashboardLayout.autoSpan=false;x1=Math.ceil((t1.headerHeight+2*q1.CARD_BORDER_PX)/q1.getRowHeightPx());}else{s1.dashboardLayout.autoSpan=true;var z1=['sap.ovp.cards.list','sap.ovp.cards.table','sap.ovp.cards.v4.list','sap.ovp.cards.v4.table'];if(z1.indexOf(s1.template>-1)){s1.dashboardLayout.noOfItems=w1.rows;}else{x1=w1.rows;}}p1._arrangeCards(s1,{row:x1,column:w1.cols},'resize',y1);p1._removeSpaceBeforeCard(y1);y1.forEach(function(A1){var B1={};B1.dashboardLayout={};B1.cardId=A1.content.cardId;B1.dashboardLayout[v1]=A1.content.dashboardLayout;o1.push({selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{changeType:"dragOrResize",content:B1}});});}}return o1;});};j1.fnCloneCardHandler=function(i,q){return P.getPayLoadForCloneCard(i).then(function(k1){return[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:k1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:k1.flexibilityChange}}];});};j1.fnAddStaticLinkListCardHandler=function(i,q){j1.bNewStaticLinkListCardFlag=true;return j1.getDialogBox(i).then(function(k1){return[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:k1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:k1.flexibilityChange}}];});};j1.fnAddKPICardHandler=function(i,q){j1.bNewKPICardFlag=true;return j1.getDialogBox(i).then(function(k1){var l1=[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:k1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:k1.flexibilityChange}}];if(k1.addODataAnnotation){l1.push({appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_app_addAnnotationsToOData",content:k1.addODataAnnotation}});}return l1;});};j1.fnAddNewCardHandler=function(i,q){j1.bAddNewCardFlag=true;return j1.getDialogBox(i).then(function(k1){var l1=[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:k1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:k1.flexibilityChange}}];if(k1.addODataAnnotation){l1.push({appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_app_addAnnotationsToOData",content:k1.addODataAnnotation}});}return l1;});};j1.fnRemoveCardHandler=function(i,q){return new Promise(function(k1,l1){c.confirm(d.getText("OVP_KEYUSER_MESSAGE_BOX_WARNING_MESSAGE_DELETE"),{actions:[c.Action.DELETE,c.Action.CANCEL],icon:c.Icon.WARNING,title:d.getText("OVP_KEYUSER_MESSAGE_BOX_TITLE_DELETE"),initialFocus:c.Action.CANCEL,onClose:function(m1){if(m1==="DELETE"){k1(P.getPayLoadForRemoveCard(i));}else{l1(null);}}});}).then(function(k1){var l1=[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_removeCard",content:k1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"removeCardContainer",content:k1.flexibilityChange}}];if(k1.removeDataSourceChange){k1.removeDataSourceChange.forEach(function(m1){l1.push({appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_app_removeDataSource",content:m1}});});}return l1;},function(k1){return[];});};return j1;},true);
