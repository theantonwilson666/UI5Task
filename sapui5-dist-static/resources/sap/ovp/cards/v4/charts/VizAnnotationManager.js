sap.ui.define(["sap/ui/thirdparty/jquery","sap/ovp/cards/v4/charts/Utils","sap/ui/model/odata/CountMode","sap/ovp/cards/v4/V4AnnotationHelper","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/viz/ui5/api/env/Format","sap/viz/ui5/controls/VizTooltip","sap/ovp/cards/CommonUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/core/Element","sap/ovp/app/resources","sap/ovp/app/OVPUtils","sap/base/util/each","sap/base/util/merge","sap/ovp/cards/ovpLogger","sap/base/util/isEmptyObject"],function(q,U,C,a,N,D,V,b,c,O,e,M,F,g,h,l,n,o,p,t){"use strict";var u={LABEL_KEY:"sap:label",LABEL_KEY_V4:"com.sap.vocabularies.Common.v1.Label",TEXT_KEY:"sap:text",TEXT_KEY_V4:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT_ANNO:"com.sap.vocabularies.UI.v1.TextArrangement",TYPE_KEY:"$Type",DISPLAY_FORMAT_KEY:"sap:display-format",SEMANTICS_KEY:"sap:semantics",UNIT_KEY:"sap:unit",UNIT_KEY_V4_ISOCurrency:"Org.OData.Measures.V1.ISOCurrency",UNIT_KEY_V4_Unit:"Org.OData.Measures.V1.Unit",CURRENCY_CODE:"currency-code",NAME_KEY:"name",NAME_CAP_KEY:"Name",EDM_TYPE:"type",EDM_INT32:"Edm.Int32",EDM_INT64:"Edm.Int64",SCATTER_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Scatter",BUBBLE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bubble",LINE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Line",COLUMNSTACKED_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked",VERTICALBULLET_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/VerticalBullet",COLUMN_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Column",BAR_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bar",COMBINATION_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Combination",DONUT_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Donut"};var w={CARD_WARNING:"OVP-AC: Analytic card: Warning: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",DATA_ANNO_ERROR:"OVP-AC: Analytic card Error:",CARD_ANNO_ERROR:"OVP-AC: Analytic card: Error ",CHART_ANNO_ERROR:"OVP-AC: Analytic card: Error ",INVALID_CHART_ANNO:"OVP-AC: Analytic Cards: Invalid Chart Annotation.",ANALYTICAL_CONFIG_ERROR:"Analytic card configuration error",CACHING_ERROR:"no model defined while caching OdataMetaData",INVALID_MAXITEMS:"maxItems is Invalid. ",NO_DATASET:"OVP-AC: Analytic Cards: Could not obtain dataset.",SORTORDER_WARNING:"SortOrder is present in PresentationVariant, but it is empty or not well formed.",BOOLEAN_ERROR:"Boolean value is not present in PresentationVariant.",IS_MANDATORY:"is mandatory.",IS_MISSING:"is missing.",NOT_WELL_FORMED:"is not found or not well formed)",MISSING_CHARTTYPE:"Missing ChartType in ",CHART_ANNO:"Chart Annotation.",DATA_ANNO:"Data Annotation",CARD_ANNO:"card annotation.",CARD_CONFIG:"card configuration.",CARD_CONFIG_ERROR:"Could not obtain configuration for ",CARD_CONTAINER_ERROR:"Could not obtain card container. ",DATA_UNAVAIALABLE:"No data available.",CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",ENTER_INTEGER:"Please enter an Integer.",NO_CARD_MODEL:"Could not obtain Cards model.",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_REDUNDANT:"Invalid/redundant role configured for ",CHART_IS:"chart is/are ",CARD_CONFIG_JSON:"card from config.json",ALLOWED_ROLES:"Allowed role(s) for ",DIMENSIONS_MANDATORY:"DimensionAttributes are mandatory.",MEASURES_MANDATORY:"MeasureAttributes are mandatory.",CARD_LEAST:"card: Enter at least ",CARD_MOST:"card: Enter at most ",FEEDS:"feed(s).",MIN_FEEDS:"Minimum number of feeds required for ",FEEDS_OBTAINED:"card is not configured. Obtained ",FEEDS_REQUIRED:"feed(s), Required: ",INVALID_SEMANTIC_MEASURES:"More than one measure is being semantically coloured",INVALID_IMPROVEMENT_DIR:"No Improvement Direction Found",INVALID_CRITICALITY:"Invalid criticality values",INVALID_DIMMEAS:"Invalid number of Measures or Dimensions",INVALID_FORECAST:"Invalid/Redundant Datapoint or Forecast measure",INVALID_TARGET:"Invalid/Redundant Datapoint or Target measure",ERROR_MISSING_AXISSCALES:"Minimum and Maximum values are mandatory for AxisScale MinMax to work"};var S=["year","yearweek","yearmonth","yearquarter"];var G;var L=new p("OVP.charts.VizAnnotationManager");function y(d,s,f){var i=d.getMetaModel().getObject("/"+s+"/"+f+"@");return i["@com.sap.vocabularies.Common.v1.IsCalendarYear"]||i["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]||i["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]||i["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"];}function z(f,j,v,x,C1,D1,E1){var F1="{";if(!f||!f.getSetting('ovpCardProperties')){L.error(w.ANALYTICAL_CONFIG_ERROR);F1+="}";return F1;}var G1=f.getSetting("dataModel");var H1;if(E1&&E1.$EnumMember){H1=E1.$EnumMember.split("/");if(H1&&(H1[1]!='Donut')&&(C1===undefined)){return null;}}var I1=[];var J1=[];var K1=[];var L1=[];var M1=[];var N1=[];var O1=[];var P1=v&&v.Parameters;var Q1=x&&x.SortOrder;var R1=x&&x.MaxItems,S1=null;var T1;var U1;var V1;var W1=null;var X1=u.TEXT_KEY;var Y1=u.TEXT_KEY_V4;var Z1=u.UNIT_KEY;var $1=u.UNIT_KEY_V4_ISOCurrency;var _1=u.UNIT_KEY_V4_Unit;var a2={};if(R1){S1=R1.Int32?R1.Int32:R1.Int;}if(S1){if(S1==="0"){L.error("OVP-AC: Analytic card Error: maxItems is configured as "+S1);F1+="}";return F1;}if(!/^\d+$/.test(S1)){L.error("OVP-AC: Analytic card Error: maxItems is Invalid. Please enter an Integer.");F1+="}";return F1;}}var b2=f.getSetting('ovpCardProperties'),c2=b2.getProperty('/parameters');var d2=b2.getProperty("/metaModel");var e2=b2.getProperty("/measureAggregate");P1=P1||!!c2;if(P1){var f2=a.resolveParameterizedEntitySet(G1,j,v,c2);F1+="path: '"+f2+"'";}else{F1+="path: '/"+j.$Type.split(".")[1]+"'";}var g2=[];W1=f.getSetting('ovpCardProperties').getProperty("/entitySet");if(!G1||!W1){return F1;}var h2=q1(G1,W1);var i2=f.getSetting('ovpCardProperties').getProperty("/cardLayout");var j2=1,k2;var l2=Y();var m2;var n2;if(C1&&i2&&i2.colSpan&&i2.colSpan>1){k2=i2.colSpan-j2;for(var o2 in l2){if((n2=l2[o2].reference)&&l2[n2]){var p2=o({},l2[n2]);l2[o2]=p2;}if(o2===H1[1]||(l2[o2].time&&l2[o2].time.type===H1[1].toLowerCase())){m2=l2[o2];break;}}var q2=Z(C1,m2,G1,W1);if(q2){m2=m2.time;}else{m2=m2.default;}var r2=f.getSetting('ovpCardProperties').getProperty("/dataStep");if(!r2){if(m2.resize&&m2.resize.hasOwnProperty("dataStep")&&!isNaN(m2.resize.dataStep)){r2=m2.resize.dataStep;}}r2=parseInt(r2,10);if(k2>0&&r2&&!isNaN(r2)){S1=parseInt(S1,10)+r2*k2;}}if(v){var b2=f.getSetting('ovpCardProperties');g2=a.getFilters(b2,v);}if(g2.length>0){F1+=", filters: "+JSON.stringify(g2);}if(Q1){var s2=x.SortOrder;if(!s2.length){s2=U.getSortAnnotationCollection(G1,x,j);}if(s2.length<1){L.warning(w.CARD_WARNING+w.SORTORDER_WARNING);}else{var t2="";var u2;var v2;var w2;for(var i=0;i<s2.length;i++){u2=s2[i];w2=u2.Property.PropertyPath;O1.push(w2);if(typeof u2.Descending==="undefined"){v2='true';}else{var g1=u2.Descending.Bool||u2.Descending.Boolean;if(!g1){L.warning(w.CARD_WARNING+w.BOOLEAN_ERROR);v2='true';}else{v2=g1.toLowerCase()==='true'?'true':'false';}}t2=t2+"{path: '"+w2+"',descending: "+v2+"},";}F1+=", sorter: ["+t2.substring(0,t2.length-1)+"]";}}var x2=f.getSetting("ovpCardProperties").getProperty("/entityType");n(D1,function(i,m){T1=m.Measure.$PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var d=x2[m.DataPoint.AnnotationPath.substring(1)];if(d.ForecastValue&&(d.ForecastValue.PropertyPath||d.ForecastValue.Path)){var r=(d.ForecastValue.PropertyPath||d.ForecastValue.Path);M1.push((d.ForecastValue.PropertyPath||d.ForecastValue.Path));if(h2&&h2[r]){var s;if(h2[r][$1]){s=h2[r][$1].Path?h2[r][$1].Path:undefined;}else if(h2[r][_1]){s=h2[r][_1].Path?h2[r][_1].Path:undefined;}else if(h2[r][Z1]){s=h2[r][Z1];}if(s){if((M1?Array.prototype.indexOf.call(M1,s):-1)===-1){M1.push(s);}}}}if(d.TargetValue&&(d.TargetValue.PropertyPath||d.TargetValue.Path)){var D2=(d.TargetValue.PropertyPath||d.TargetValue.Path);M1.push((d.TargetValue.PropertyPath||d.TargetValue.Path));if(h2&&h2[D2]){var s;if(h2[D2][$1]){s=h2[D2][$1].Path?h2[D2][$1].Path:undefined;}else if(h2[D2][_1]){s=h2[D2][_1].Path?h2[D2][_1].Path:undefined;}else if(h2[D2][Z1]){s=h2[D2][Z1];}if(s){if((M1?Array.prototype.indexOf.call(M1,s):-1)===-1){M1.push(s);}}}}}M1.push(T1);if(h2&&h2[T1]){if(h2[T1][Y1]){if(h2[T1][Y1].String&&T1!=h2[T1][Y1].String){M1.push(h2[T1][Y1].String?h2[T1][Y1].String:T1);}else if(h2[T1][Y1].Path&&T1!=h2[T1][Y1].Path){M1.push(h2[T1][Y1].Path?h2[T1][Y1].Path:T1);}}else if(h2[T1][X1]&&T1!=h2[T1][X1]){M1.push(h2[T1][X1]?h2[T1][X1]:T1);}}if(h2&&h2[T1]){var s;if(h2[T1][$1]){s=h2[T1][$1].Path?h2[T1][$1].Path:undefined;}else if(h2[T1][_1]){s=h2[T1][_1].Path?h2[T1][_1].Path:undefined;}else if(h2[T1][Z1]){s=h2[T1][Z1];}if(s){if((M1?Array.prototype.indexOf.call(M1,s):-1)===-1){M1.push(s);}}}});n(C1,function(i,d){T1=d.Dimension.$PropertyPath;I1.push(T1);if(h2&&h2[T1]){if(h2[T1][Y1]){if(h2[T1][Y1].String&&T1!=h2[T1][Y1].String){I1.push(h2[T1][Y1].String?h2[T1][Y1].String:T1);}else if(h2[T1][Y1].Path&&T1!=h2[T1][Y1].Path){V1=h2[T1][Y1].Path;var m=V1.split("/");if(m.length>1){U1=A(d2,x2,V1);if(U1!==""){I1.push(V1);J1.push(U1);L1=B(d2,x2,V1);if(L1.length>0){K1=K1.concat(L1);}}}else{I1.push(V1?V1:T1);}}}else if(h2[T1][X1]&&T1!=h2[T1][X1]){I1.push(h2[T1][X1]?h2[T1][X1]:T1);}}});if(K1.length>0){var k=0;while(k<K1.length){if(I1.indexOf(K1[k])!==-1){K1.splice(k,1);}else{k++;}}}if(M1.length>0){n(M1,function(i,m){a2[m]=true;});}if(I1.length>0){n(I1,function(i,d){a2[d]=true;});}F1+=", parameters: {$apply:'groupby(("+I1.join(",")+"),";F1+="aggregate(";var y2=[];M1.forEach(function(m,i){var s=e2&&e2["Axis"+(i+1)];var d=s?s:"sum";var r=[m," with ",d," as ",m,"Aggregate"].join('');y2.push(r);});F1+=y2.join(',');F1+="))";var z2=d2.getObject("/"+j.$Type);if(z2){var A2=a.getRequestFields(x);if(A2&&A2.length>0){n(A2,function(i,r){if(!a2.hasOwnProperty(r)){a2[r]=true;N1.push(r);}});if(N1.length>0){F1+=","+N1.join(",");}}}if(O1.length>0){var B2=[];n(O1,function(i,s){if(!a2.hasOwnProperty(s)){B2.push(s);}});if(B2.length>0){F1+=","+B2.join(",");}}if(J1.length>0){F1+="'"+","+" expand:'"+J1.join(',');}var C2=a.checkFilterPreference(f.getSetting("ovpCardProperties"));if(C2){F1+="', custom: {cardId: '"+f.getSetting("ovpCardProperties").getProperty("/cardId")+"'}}";}else{F1+="'}";}if(H1&&(H1[1]==='Donut')&&(C1===undefined)){F1+=", length: 1";}else if(H1&&(H1[1]==='Donut')&&(C1)&&S1){F1+=", length: "+(parseInt(S1,10)+1);}else if(S1){F1+=", length: "+S1;}F1+="}";return F1;}z.requiresIContext=true;function A(m,d,s){var f="";var j=s.split("/");if(j.length>1){for(var i=0;i<(j.length-1);i++){var k=m.getODataAssociationEnd(d,j[i]);if(k){d=m.getODataEntityType(k.type);if(f){f=f+"/";}f=f+j[i];}else{return f;}}}return f;}function B(m,d,s){var f=[];var k=[];var r;var v=s.split("/");if(v.length>1){for(var i=0;i<(v.length-1);i++){var x=m.getODataAssociationEnd(d,v[i]);if(x){d=m.getODataEntityType(x.type);if(d){k=d&&d.key&&d.key.propertyRef;for(var j=0;j<k.length;j++){r=v[i]+"/"+k[j].name;f.push(r);}}}}}return f;}function E(m,d){var f=false;var r;if(m.DataPoint&&m.DataPoint.AnnotationPath){var i=d[m.DataPoint.AnnotationPath.substring(1)];if(i&&i.ForecastValue&&(i.ForecastValue.PropertyPath||i.ForecastValue.Path)){f=true;r=m;}}if(f===true){return r;}else{L.warning(w.CARD_WARNING+w.INVALID_FORECAST);return undefined;}}function H(m,d){var f=false;var r;if(m.DataPoint&&m.DataPoint.AnnotationPath){var i=d[m.DataPoint.AnnotationPath.substring(1)];if(i&&i.TargetValue&&(i.TargetValue.PropertyPath||i.TargetValue.Path)){f=true;r=m;}}if(f===true){return r;}else{L.warning(w.CARD_WARNING+w.INVALID_TARGET);return undefined;}}function I(m,d){var f;n(d,function(i,v){if(v.name===m){if(v["com.sap.vocabularies.Common.v1.Label"]){f=v["com.sap.vocabularies.Common.v1.Label"].String?v["com.sap.vocabularies.Common.v1.Label"].String:v["com.sap.vocabularies.Common.v1.Label"].Path;}else if(v["sap:label"]){f=v["sap:label"];}return false;}});return f;}function J(f,d){var j=true;if(d==="line"||d==="column"||d==="bar"){n(f,function(i,v){if((v.getUid()==='valueAxis')||(v.getUid()==='categoryAxis')){if(v.getValues().length!=1){j=false;L.warning(w.CARD_WARNING+w.INVALID_DIMMEAS);return false;}}});}else if(d==="vertical_bullet"){n(f,function(i,v){if((v.getUid()==='actualValues')||(v.getUid()==='categoryAxis')){if(v.getValues().length!=1){j=false;L.warning(w.CARD_WARNING+w.INVALID_DIMMEAS);return false;}}});}if(j===true){return true;}}function K(m,s,v){var d=u.TYPE_KEY;if(!m||!m[s]||!m[s][d]){return v;}var f=["Edm.Int","Edmt.Int16","Edm.Int32","Edm.Int64","Edm.Decimal"];var i=m[s][d];if((f?Array.prototype.indexOf.call(f,i):-1)!==-1){return Number(v);}return v;}function P(d){if(d){return d;}return"";}function Q(r){var d={locale:function(){},format:function(v,f){var i="";if(f){i=f.split('/');}if(i.length>0){var m,s;if(i.length===3){m=Number(i[1]);s=Number(i[2]);if(isNaN(m)){m=-1;}if(isNaN(s)){s=0;}}else{m=2;s=0;}if(i[0]==="axisFormatter"||(i[0]==="ShortFloat")){var j;j=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m?m:1});if(i[0]==="ShortFloat"){j=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});}if(m===-1){j=N.getFloatInstance({style:'short'});}return j.format(Number(v));}else if(i[0]==="tooltipNoScaleFormatter"){var k=N.getFloatInstance({style:'short',currencyCode:false,shortRefNumber:s,showScale:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){k=N.getFloatInstance({minFractionDigits:0,currencyCode:false});}return k.format(Number(v));}else if(i[0]==="CURR"){var x=N.getCurrencyInstance({style:'short',currencyCode:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){x=N.getCurrencyInstance({style:'short',currencyCode:false});}return x.format(Number(v));}else if(i[0].search("%")!==-1){var C1=N.getPercentInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});if(m===-1){C1=N.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1});}v=C1.format(Number(v));return v;}}if(v.constructor===Date){var D1=D.getDateTimeInstance({pattern:f});if(f==="YearMonthDay"){D1=D.getDateInstance({style:"medium"});}if(f==="YearMonth"||f==="MMM"){D1=D.getDateTimeInstance({format:"MMM"});}if(f==="YearQuarter"||f==="Quarter"){D1=D.getDateTimeInstance({format:"QQQ"});}if(f==="YearWeek"||f==="Week"){D1=D.getDateTimeInstance({format:"www"});}if(r&&f==="hh:mm"){var E1=v.toLocaleTimeString();var F1=E1.split(":");v=F1[0]+":"+F1[1];return v;}var G1=r?false:true;v=D1.format(new Date(v),G1);}return v;}};V.numericFormatter(d);}function R(v,f){var d=v.getModel();var k=v.getVizType();if(k!="line"&&k!="bubble"){return;}if(!f){f=k==="line"?"categoryAxis":"valueAxis";}var m=v.getModel('ovpCardProperties').getProperty("/entitySet");if(!d||!m){return;}var r=q1(d,m);var s=v.getFeeds();for(var i=0;i<s.length;i++){if(s[i].getUid()===f){var x=s[i].getValues();if(!x){return;}for(var j=0;j<x.length;j++){if(r[x[j][u.TYPE_KEY]]!="Edm.DateTime"){return;}}v.setVizProperties({categoryAxis:{title:{visible:false}}});return;}}}function T(d,f,i,m,j,k){m=typeof m==="undefined"?false:m;var r=false;var s;if(!d&&m){L.error(j+w.CARD_ERROR+i+w.IS_MANDATORY);return r;}if(!d){L.warning(j+w.CARD_WARNING+i+w.IS_MISSING);r=true;return r;}s=f[d];if(!s||typeof s!=="object"){var v=m?L.error:L.warning;v(j+w.CARD_ERROR+"in "+i+". ("+d+" "+w.NOT_WELL_FORMED);return r;}if(k&&k==="sap.ovp.cards.charts.analytical.analyticalChart"&&i==="Chart Annotation"&&(!s.ChartType||!s.ChartType.EnumMember)){L.error(j+w.CARD_ERROR+w.MISSING_CHARTTYPE+w.CHART_ANNO);return r;}r=true;return r;}function W(d){var r=false;if(!d){return r;}var s;var f;var i;var j;var k;var m;var v;var x="";var C1;var D1=d.getView();if(D1){x="["+D1.getId()+"] ";}if(!(C1=d.getCardPropertiesModel())){L.error(x+w.CARD_ERROR+"in "+w.CARD_CONFIG+w.NO_CARD_MODEL);return r;}v=C1.getProperty("/entityType");if(!v||t(v)){L.error(x+w.CARD_ERROR+"in "+w.CARD_ANNO);return r;}s=C1.getProperty("/selectionAnnotationPath");f=C1.getProperty("/chartAnnotationPath");j=C1.getProperty("/presentationAnnotationPath");k=C1.getProperty("/identificationAnnotationPath");m=C1.getProperty("/dataPointAnnotationPath");i=C1.getProperty("/contentFragment");r=T(s,v,"Selection Variant",false,x);r=T(f,v,"Chart Annotation",true,x,i)&&r;r=T(j,v,"Presentation Variant",false,x)&&r;r=T(k,v,"Identification Annotation",true,x)&&r;r=T(m,v,"Data Point",false,x)&&r;return r;}function X(d,f,v){}function Y(d){return U.getConfig(d);}function Z(d,f,i,j){var r=false;var m;var k;var s;var v;var x;var C1;if(!f.time||t(f.time)){return r;}if(!d){return r;}for(var D1=0;D1<d.length;D1++){if(!d[D1].Dimension||!(k=d[D1].Dimension.$PropertyPath)){return r;}m=q1(i,j);if(m&&m[k]){s=m[k][u.TYPE_KEY];v=m[k][u.DISPLAY_FORMAT_KEY];x=m[k][u.SEMANTICS_KEY];C1=y(i,j,k);}if(s&&s.lastIndexOf("Edm.Date",0)===0){if(s.toLowerCase()==="edm.datetime"){if(v&&v.toLowerCase()==="date"){r=true;}}else{r=true;}}if(s==="Edm.String"&&(C1||x&&S.indexOf(x)>-1)){r=true;}if(r){d.unshift(d.splice(D1,1)[0]);break;}}return r;}function $(i,d,f){var r="";var j=Y(d);var k,m;if(!j){return r;}r=j.default.type;k=i.getSetting("dataModel");m=i.getSetting('ovpCardProperties').getProperty("/entitySet");if(Z(f,j,k,m)){r=j.time.type;}return r;}$.requiresIContext=true;function _(d,j,k){if(!d.length){return;}var m=k==="dimension"?"Dimension":"Measure";var r=[];n(d,function(i,v){if(!v||!v[m]||!v[m].PropertyPath){L.error(w.INVALID_CHART_ANNO);return false;}r.push(v[m].PropertyPath);});var s=q.map(j.feeds,function(f){if(f.type===k){if(f.role){return f.role.split("|");}return[];}});s=q.grep(s,function(f,i){return(s?Array.prototype.indexOf.call(s,f):-1)===i;}).join(", ");L.error(w.CARD_ERROR+w.INVALID_REDUNDANT+k+"(s) "+r.join(", ")+". "+w.ALLOWED_ROLES+j.type+w.CHART_IS+s);}function a1(v,i){var d;if(v){if(v.String){d=v.String;}else if(v.Boolean||v.Bool){d=b1(v);}else{d=c1(v,i);}}return d;}function b1(v,d){if(v&&v.Boolean){if(v.Boolean.toLowerCase()==="true"){return true;}else if(v.Boolean.toLowerCase()==="false"){return false;}}else if(v&&v.Bool){if(v.Bool.toLowerCase()==="true"){return true;}else if(v.Bool.toLowerCase()==="false"){return false;}}return d;}function c1(v,i){var d;if(v){if(v.String){d=Number(v.String);}else if(v.Int){d=Number(v.Int);}else if(v.Decimal){d=Number(v.Decimal);}else if(v.Double){d=Number(v.Double);}else if(v.Single){d=Number(v.Single);}}if(i){var f=N.getFloatInstance({style:'short',minFractionDigits:2,maxFractionDigits:2});if(d){d=f.format(Number(d));}}return d;}function d1(i,d){function f1(C1){if(C1){if(C1.Path){return"{path:'"+C1.Path+"'}";}else{return a1(C1);}}else{return"";}}var v=i[i.measureNames];if(d&&d.CriticalityCalculation&&d.CriticalityCalculation.ImprovementDirection){var s=d.CriticalityCalculation.ImprovementDirection.EnumMember;var f=f1(d.CriticalityCalculation.DeviationRangeLowValue);var j=f1(d.CriticalityCalculation.DeviationRangeHighValue);var k=f1(d.CriticalityCalculation.ToleranceRangeLowValue);var m=f1(d.CriticalityCalculation.ToleranceRangeHighValue);return a._calculateCriticalityState(v,s,f,j,k,m,a.criticalityConstants.StateValues);}else{var r=d.Criticality.EnumMember;var x=r?r.split("/"):[];if(x){return x[1];}}}function e1(d,m,f){var j,k;n(m,function(i,v){if(v["com.sap.vocabularies.Common.v1.Label"]&&v["com.sap.vocabularies.Common.v1.Label"].String===d.measureNames){j=v.name;return false;}else if(v["com.sap.vocabularies.Common.v1.Label"]&&v["com.sap.vocabularies.Common.v1.Label"].Path===d.measureNames){j=v.name;return false;}else if(v["sap:label"]===d.measureNames){j=v.name;return false;}});n(f,function(i,v){if(v.Measure.PropertyPath===j){if(!v.DataPoint||!v.DataPoint.AnnotationPath){return false;}k=v.DataPoint.AnnotationPath;return false;}});return k;}function f1(i,d){if(i){if(i.Path){return i.Path;}else{return a1(i,d);}}else{return"";}}function g1(m,d){function f(s,i){return s&&s.indexOf(i,s.length-i.length)!==-1;}var j=false;n(m,function(i,v){if(v.DataPoint&&v.DataPoint.AnnotationPath){var k=d[v.DataPoint.AnnotationPath.substring(1)];if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.ImprovementDirection&&k.CriticalityCalculation.ImprovementDirection.EnumMember){var s=k.CriticalityCalculation.ImprovementDirection.EnumMember;var r=f1(k.CriticalityCalculation.DeviationRangeLowValue);var x=f1(k.CriticalityCalculation.DeviationRangeHighValue);var C1=f1(k.CriticalityCalculation.ToleranceRangeLowValue);var D1=f1(k.CriticalityCalculation.ToleranceRangeHighValue);if(f(s,"Minimize")||f(s,"Minimizing")){if(D1&&x){j=true;return false;}else{L.warning(w.CARD_WARNING+w.INVALID_CRITICALITY);}}else if(f(s,"Maximize")||f(s,"Maximizing")){if(C1&&r){j=true;return false;}else{L.warning(w.CARD_WARNING+w.INVALID_CRITICALITY);}}else if(f(s,"Target")){if(C1&&r&&D1&&x){j=true;return false;}else{L.warning(w.CARD_WARNING+w.INVALID_CRITICALITY);}}}else if(k&&k.Criticality){j=true;return false;}else{L.warning(w.CARD_WARNING+w.INVALID_IMPROVEMENT_DIR);}}});if(j===true&&m.length>1){L.warning(w.CARD_WARNING+w.INVALID_SEMANTIC_MEASURES);}return j;}function h1(m,d,f,v){function i(H1,I1){return H1&&H1.indexOf(I1,H1.length-I1.length)!==-1;}var r=[null,null];var j=true;var k=m.Measure.PropertyPath;if(f[k]){if(f[k][u.LABEL_KEY_V4]){k=p1(f[k][u.LABEL_KEY_V4].String?f[k][u.LABEL_KEY_V4].String:f[k][u.LABEL_KEY_V4].Path,v,f);}else if(f[k][u.LABEL_KEY]){k=f[k][u.LABEL_KEY];}else if(k){k=k;}}var s=m.DataPoint.AnnotationPath;var x=d[s.substring(1)];if(!x.CriticalityCalculation||!x.CriticalityCalculation.ImprovementDirection||!x.CriticalityCalculation.ImprovementDirection.EnumMember){return r;}var C1=x.CriticalityCalculation.ImprovementDirection.EnumMember;var D1=f1(x.CriticalityCalculation.DeviationRangeLowValue,j);var E1=f1(x.CriticalityCalculation.DeviationRangeHighValue,j);var F1=f1(x.CriticalityCalculation.ToleranceRangeLowValue,j);var G1=f1(x.CriticalityCalculation.ToleranceRangeHighValue,j);if(i(C1,"Minimize")||i(C1,"Minimizing")){if(G1&&E1){r[0]=h.getText("MINIMIZING_LESS",[k,G1]);r[1]=h.getText("MINIMIZING_MORE",[k,E1]);r[2]=h.getText("MINIMIZING_CRITICAL",[G1,k,E1]);}}else if(i(C1,"Maximize")||i(C1,"Maximizing")){if(F1&&D1){r[0]=h.getText("MAXIMISING_MORE",[k,F1]);r[1]=h.getText("MAXIMISING_LESS",[k,D1]);r[2]=h.getText("MAXIMIZING_CRITICAL",[D1,k,F1]);}}else if(i(C1,"Target")){if(F1&&D1&&G1&&E1){r[0]=h.getText("TARGET_BETWEEN",[F1,k,G1]);r[1]=h.getText("TARGET_AROUND",[k,D1,E1]);r[2]=h.getText("TARGET_CRITICAL",[D1,k,F1,G1,E1]);}}return r;}function i1(m,v,d){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var f=d[v.DataPoint.AnnotationPath.substring(1)];var i,j;if(f&&f.ValueFormat){i=f.ValueFormat;}else if(f&&f.NumberFormat){i=f.NumberFormat;}if(i&&i.NumberOfFractionalDigits&&i.NumberOfFractionalDigits.Int){j=i.NumberOfFractionalDigits.Int;if(m<Number(j)){m=Number(j);}}}return m;}function j1(m,v,d){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var f=d[v.DataPoint.AnnotationPath.substring(1)];var s,i;if(f&&f.ValueFormat){s=f.ValueFormat;}else if(f&&f.NumberFormat){s=f.NumberFormat;}if(s){if(s.ScaleFactor&&s.ScaleFactor.Decimal){i=Number(s.ScaleFactor.Decimal);}else if(s.ScaleFactor&&s.ScaleFactor.Int){i=Number(s.ScaleFactor.Int);}if(!isNaN(i)){if(m===undefined){m=Number(i);}else if(m>Number(i)){m=Number(i);}}}}return m;}function k1(m,s){if(m&&m[s]&&(m[s]["Org.OData.Measures.V1.ISOCurrency"]||(m[s][u.SEMANTICS_KEY]&&m[s][u.SEMANTICS_KEY]===u.CURRENCY_CODE))){return true;}return false;}function l1(m,v,f){if(m[v[f].PropertyPath][u.EDM_TYPE]===u.EDM_INT32){return true;}return false;}function m1(m,v,f){if(m[v[f].PropertyPath][u.EDM_TYPE]===u.EDM_INT64){return true;}return false;}function n1(d,f,m,r){var s,x,C1,D1,E1;var F1,G1,H1,I1,J1,K1=false;var L1;var M1,N1,O1;var P1,Q1=[],R1=[];var S1;var T1;var U1=r&&r.getView();var V1,W1;var X1=U1&&U1.getModel("ui");var Y1=X1&&X1.getProperty("/chartSettings");s=d.getModel('ovpCardProperties');if(O.checkIfAPIIsUsed(r)){K1=s&&s.getData()&&s.getData().showDataLabel;}E1=Y1?Y1.showDataLabel:K1;F1=d.getVizType();G1=Y();for(var Z1 in G1){if((T1=G1[Z1].reference)&&G1[T1]){var $1=o({},G1[T1]);G1[Z1]=$1;}if(G1[Z1].default.type===F1||(G1[Z1].time&&G1[Z1].time.type===F1)){H1=G1[Z1];break;}}if(!H1){L.error(w.CARD_ERROR+"in "+w.CARD_CONFIG+w.CARD_CONFIG_ERROR+F1+" "+w.CARD_CONFIG_JSON);return;}if(!s){L.error(w.CARD_ERROR+"in "+w.CARD_CONFIG+w.NO_CARD_MODEL);return;}var _1=d.getModel();var a2=s.getProperty("/entitySet");if(!_1||!a2){return;}x=r.getMetaModel().getData()["$Annotations"];if(!x){L.error(w.CARD_ANNO_ERROR+"in "+w.CARD_ANNO);return;}var b2=q1(_1,a2);C1=s.getProperty("/chartAnnotationPath");if(!C1||!(D1=x[s.getProperty("/entityType").$Type]["@"+C1])){L.error(w.CARD_ANNO_ERROR+"in "+w.CARD_ANNO);return;}if(!(I1=D1.DimensionAttributes)||!I1.length){L.error(w.CHART_ANNO_ERROR+"in "+w.CHART_ANNO+" "+w.DIMENSIONS_MANDATORY);return;}var c2;if(!(J1=D1.MeasureAttributes)||!J1.length){L.error(w.CHART_ANNO_ERROR+"in "+w.CHART_ANNO+" "+w.MEASURES_MANDATORY);return;}else{var d2=J1[0].DataPoint?x[J1[0].DataPoint.AnnotationPath.substring(1)]:null;var e2=d2&&d2.ValueFormat&&d2.ValueFormat.NumberOfFractionalDigits&&d2.ValueFormat.NumberOfFractionalDigits.Int;c2=e2?e2:0;}S1=Z(I1,H1,_1,a2);if(S1){H1=H1.time;}else{H1=H1.default;}var f2=s.getProperty("/ChartProperties")||s.getProperty("/chartProperties");if(s&&s.getProperty("/tabs")&&(f2===undefined)){V1=U1.byId("ovp_card_dropdown");W1=parseInt(V1.getSelectedKey(),10);f2=s.getProperty("/tabs")&&s.getProperty("/tabs")[W1-1]&&(s.getProperty("/tabs")[W1-1]["ChartProperties"]||s.getProperty("/tabs")[W1-1]["chartProperties"]);}var g2=false;var h2=c2>0?"tooltipNoScaleFormatter/"+c2.toString()+"/":'tooltipNoScaleFormatter/-1/';var i2=new b({formatString:h2});i2.connect(d.getVizUid());i2.connect(d.getVizUid());d._oOvpVizFrameTooltip=i2;[H1.dimensions,H1.measures].forEach(function(j,i){var k=i?J1:I1;var v=i?"measure(s)":"dimension(s)";if(j.min&&k.length<j.min){L.error(w.CARD_ERROR+"in "+F1+" "+w.CARD_LEAST+j.min+" "+v);g2=true;}if(j.max&&k.length>j.max){L.error(w.CARD_ERROR+"in "+F1+w.CARD_MOST+j.max+" "+v);g2=true;}});if(g2){return;}var j2=true;if(H1.properties&&H1.properties.hasOwnProperty("hideLabel")&&!H1.properties["hideLabel"]){j2=false;}var k2=true;var l2=false;if(F1==='donut'){l2=true;}d.removeAllAggregation();L1={legend:{isScrollable:false},title:{visible:false},interaction:{noninteractiveMode:k2?false:true,selectability:{legendSelection:l2?true:false,axisLabelSelection:false,mode:'EXCLUSIVE',plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:'disabled'}},plotArea:{window:{start:'firstDataPoint',end:'lastDataPoint'},dataLabel:{visible:E1||l2?true:false,type:'value'},dataPoint:{invalidity:'ignore'},alignment:{vertical:'top'}},categoryAxis:{label:{truncatedLabelRatio:0.15}},general:{groupData:false,showAsUTC:true}};if(H1.properties&&H1.properties.semanticColor===true&&g1(J1,x)){var m2=h.getText("GOOD");var n2=h.getText("BAD");var o2=h.getText("CRITICAL");var p2=h.getText("OTHERS");if(J1.length===1){var q2=h1(J1[0],x,b2,d);var m2=q2[0]||m2,n2=q2[1]||n2,o2=q2[2]||o2,p2=h.getText("OTHERS");}L1.plotArea.dataPointStyle={rules:[{callback:function(i){var j=e1(i,b2,J1);if(!j){return false;}var k=x[j.substring(1)];var v=d1(i,k);if(v===a.criticalityConstants.StateValues.Positive){return true;}else if(v==="Positive"){return true;}},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},"displayName":m2},{callback:function(i){var j=e1(i,b2,J1);if(!j){return false;}var k=x[j.substring(1)];var v=d1(i,k);if(v===a.criticalityConstants.StateValues.Critical){return true;}else if(v==="Critical"){return true;}},properties:{color:"sapUiChartPaletteSemanticCriticalLight1"},"displayName":o2},{callback:function(i){var j=e1(i,b2,J1);if(!j){return false;}var k=x[j.substring(1)];var v=d1(i,k);if(v===a.criticalityConstants.StateValues.Negative){return true;}else if(v==="Negative"){return true;}},properties:{color:"sapUiChartPaletteSemanticBadLight1"},"displayName":n2},{callback:function(i){var j=e1(i,b2,J1);if(!j){return false;}var k=x[j.substring(1)];var v=d1(i,k);if(v===a.criticalityConstants.StateValues.None){return true;}else if(v==="Neutral"){return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},"displayName":p2}]};}var r2=s.getProperty("/bEnableStableColors");var s2=s.getProperty("/colorPalette");var t2;if(!r2&&(D1.ChartType.EnumMember===u.COLUMNSTACKED_CHARTTYPE||D1.ChartType.EnumMember===u.DONUT_CHARTTYPE||D1.ChartType.EnumMember===u.COLUMN_CHARTTYPE||D1.ChartType.EnumMember===u.BAR_CHARTTYPE||D1.ChartType.EnumMember===u.VERTICALBULLET_CHARTTYPE||D1.ChartType.EnumMember===u.LINE_CHARTTYPE||D1.ChartType.EnumMember===u.COMBINATION_CHARTTYPE||D1.ChartType.EnumMember===u.BUBBLE_CHARTTYPE)&&s2&&Object.keys(s2).length>=2&&Object.keys(s2).length<=4){n(I1,function(i,j){if(j&&j.Role&&j.Role.EnumMember==="com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"){t2=j.Dimension&&j.Dimension.PropertyPath;return;}});var u2;if(t2){if(b2&&b2[t2]){if(b2[t2][u.LABEL_KEY_V4]){u2=p1(b2[t2][u.LABEL_KEY_V4].String?b2[t2][u.LABEL_KEY_V4].String:b2[t2][u.LABEL_KEY_V4].Path,d,b2);}else if(b2[t2][u.LABEL_KEY]){u2=b2[t2][u.LABEL_KEY];}else if(t2){u2=t2;}}if(s2 instanceof Array){var v2=s2.map(function(v){return v.color;});var w2=s2.map(function(v){return v.legendText;});var x2=w2[0]!=undefined?w2[0]:h.getText("OTHERS");var y2=w2[1]!=undefined?w2[1]:h.getText("BAD");var z2=w2[2]!=undefined?w2[2]:h.getText("CRITICAL");var A2=w2[3]!=undefined?w2[3]:h.getText("GOOD");}L1.plotArea.dataPointStyle={rules:[{callback:function(i){if(i&&(i[u2]==="3"||i[u2]===3)){if(s2 instanceof Array){if(s2.length<4){return false;}}else if(s2&&!s2.hasOwnProperty(3)){return false;}return true;}},properties:{color:s2 instanceof Array&&v2.length?v2[3]:s2[3]&&s2[3]["color"]},"displayName":A2||s2[3]&&s2[3]["legendText"]},{callback:function(i){if(i&&(i[u2]==="2"||i[u2]===2)){if(s2 instanceof Array){if(s2.length<3){return false;}}else if(s2&&!s2.hasOwnProperty(2)){return false;}return true;}},properties:{color:s2 instanceof Array&&v2.length?v2[2]:s2[2]&&s2[2]["color"]},"displayName":z2||s2[2]&&s2[2]["legendText"]},{callback:function(i){if(i&&(i[u2]==="1"||i[u2]===1)){return true;}},properties:{color:s2 instanceof Array&&v2.length?v2[1]:s2[1]&&s2[1]["color"]},"displayName":y2||s2[1]&&s2[1]["legendText"]},{callback:function(i){if(i&&(i[u2]==="0"||i[u2]===0)){return true;}},properties:{color:s2 instanceof Array&&v2.length?v2[0]:s2[0]&&s2[0]["color"]},"displayName":x2||s2[0]&&s2[0]["legendText"]}]};}}var B2=false;var C2=false;if(D1.ChartType.$EnumMember===u.SCATTER_CHARTTYPE||D1.ChartType.$EnumMember===u.BUBBLE_CHARTTYPE||D1.ChartType.$EnumMember===u.LINE_CHARTTYPE){if(D1&&D1.AxisScaling&&D1.AxisScaling.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"){var D2=D1.AxisScaling;if(D2.AutoScaleBehavior&&D2.AutoScaleBehavior.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisAutoScaleBehaviorType"){var E2=D2.AutoScaleBehavior;if(E2.ZeroAlwaysVisible&&E2.ZeroAlwaysVisible.Bool=="true"){L1.plotArea.adjustScale=false;B2=true;}else if(E2.DataScope){L1.plotArea.adjustScale=true;B2=true;}}else if(D2.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"&&D2.ScaleBehavior&&D2.ScaleBehavior.EnumMember){var F2=D2.ScaleBehavior.EnumMember;var G2=F2.substring(F2.lastIndexOf('/')+1,F2.length);if(G2=="FixedScale"){C2=true;}}}else if(D1&&D1.AxisScaling&&D1.AxisScaling.EnumMember){var H2=D1.AxisScaling.EnumMember.substring(D1.AxisScaling.EnumMember.lastIndexOf('/')+1,D1.AxisScaling.EnumMember.length);switch(H2){case"AdjustToDataIncluding0":L1.plotArea.adjustScale=false;B2=true;break;case"AdjustToData":L1.plotArea.adjustScale=true;B2=true;break;case"MinMaxValues":C2=true;break;default:break;}}if(C2){var I2=[];if(D1["MeasureAttributes"][0]&&D1["MeasureAttributes"][0].DataPoint&&D1["MeasureAttributes"][0].DataPoint.AnnotationPath){var J2=D1["MeasureAttributes"][0].DataPoint.AnnotationPath;var K2=J2.substring(J2.lastIndexOf('@')+1,J2.length);if(x&&x[K2]){var L2=x[K2];if(L2&&L2.MaximumValue&&L2.MaximumValue.Decimal&&L2.MinimumValue&&L2.MinimumValue.Decimal){I2.push({feed:"valueAxis",max:L2.MaximumValue.Decimal,min:L2.MinimumValue.Decimal});B2=true;}else{L.error(w.ERROR_MISSING_AXISSCALES);}}}if(D1.ChartType.EnumMember!==u.LINE_CHARTTYPE&&D1["MeasureAttributes"][1]&&D1["MeasureAttributes"][1].DataPoint&&D1["MeasureAttributes"][1].DataPoint.AnnotationPath){var J2=D1["MeasureAttributes"][1].DataPoint.AnnotationPath;var K2=J2.substring(J2.lastIndexOf('@')+1,J2.length);if(x&&x[K2]){var L2=x[K2];if(L2&&L2.MaximumValue&&L2.MaximumValue.Decimal&&L2.MinimumValue&&L2.MinimumValue.Decimal){I2.push({feed:"valueAxis2",max:L2.MaximumValue.Decimal,min:L2.MinimumValue.Decimal});B2=true;}else{L.error(w.ERROR_MISSING_AXISSCALES);}}}d.setVizScales(I2);}}N1=I1.slice();O1=J1.slice();var M2=0;var N2=0;var O2;var P2;var Q2=false;var R2=false;var S2;var T2=[];var U2=[],V2=[];if((F1==="column"||F1==="bar"||F1==="vertical_bullet")&&H1.feeds&&(H1.feeds.length>0)){var W2;for(W2=0;W2<H1.feeds.length;W2++){if(H1.feeds[W2].uid==="color"){H1.feeds.splice(W2,1);break;}}for(W2=0;W2<H1.feeds.length;W2++){if(H1.feeds[W2].uid==="categoryAxis"){delete H1.feeds[W2].role;break;}}if(s.getProperty("/colorPalette")){for(W2=0;W2<H1.feeds.length;W2++){if(H1.feeds[W2].uid==="categoryAxis"){H1.feeds[W2].role="Category";break;}}H1.feeds.push({"uid":"color","min":1,"type":"dimension","role":"Series"});}}n(H1.feeds,function(i,v){var c3=v.uid;var d3=[];if(v.type){var e3,f3,g3;if(v.type==="dimension"){e3=I1.length;f3="Dimension";g3="dimensions";M1=N1;P1=Q1;}else{e3=J1.length;f3="Measure";g3="measures";M1=O1;P1=R1;}var h3=0,i3=e3;if(v.min){h3=h3>v.min?h3:v.min;}if(v.max){i3=i3<v.max?i3:v.max;}if(!v.role){var j3=M1.length;for(var j=0;j<j3&&d3.length<i3;++j){var k3=M1[j];M1.splice(j,1);--j3;--j;d3.push(k3);if(b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency]){S2=b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency].Path?b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency].Path:undefined;}else if(b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_Unit]){S2=b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_Unit].Path?b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_Unit].Path:undefined;}else if(b2[k3[f3].$PropertyPath][u.UNIT_KEY]){S2=b2[k3[f3].$PropertyPath][u.UNIT_KEY];}if(k1(b2,S2)){Q2=true;}else{R2=true;}if(!Q2){M2=i1(M2,k3,x);O2=j1(O2,k3,x);}else{N2=i1(N2,k3,x);P2=j1(P2,k3,x);}}}else{var l3=v.role.split("|");n(l3,function(j,F3){if(d3.length===i3){return false;}var j3=M1.length;for(var k=0;k<j3&&d3.length<i3;++k){var k3=M1[k];if(k3&&k3.Role&&k3.Role.$EnumMember&&k3.Role.$EnumMember.split("/")&&k3.Role.$EnumMember.split("/")[1]){var G3=k3.Role.$EnumMember.split("/")[1];if(G3===F3){M1.splice(k,1);--j3;--k;d3.push(k3);if(b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency]){S2=b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency].Path?b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency].Path:undefined;}else if(b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_Unit]){S2=b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_Unit].Path?b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_Unit].Path:undefined;}else if(b2[k3[f3].$PropertyPath][u.UNIT_KEY]){S2=b2[k3[f3].$PropertyPath][u.UNIT_KEY];}if(k1(b2,S2)){Q2=true;}else{R2=true;}if(!Q2){M2=i1(M2,k3,x);O2=j1(O2,k3,x);}else{N2=i1(N2,k3,x);P2=j1(P2,k3,x);}}}else if((P1?Array.prototype.indexOf.call(P1,k3):-1)===-1){P1.push(k3);}}});if(d3.length<i3){n(P1,function(k,k3){var F3;var W2;if((F3=H1[g3].defaultRole)&&((l3?Array.prototype.indexOf.call(l3,F3):-1)!==-1)&&(W2=(M1?Array.prototype.indexOf.call(M1,k3):-1)!==-1)){M1.splice(W2,1);d3.push(k3);if(b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency]){S2=b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency].Path?b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency].Path:undefined;}else if(b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_Unit]){S2=b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_Unit].Path?b2[k3[f3].$PropertyPath][u.UNIT_KEY_V4_Unit].Path:undefined;}else if(b2[k3[f3].$PropertyPath][u.UNIT_KEY]){S2=b2[k3[f3].$PropertyPath][u.UNIT_KEY];}if(k1(b2,S2)){Q2=true;}else{R2=true;}if(!Q2){M2=i1(M2,k3,x);O2=j1(O2,k3,x);}else{N2=i1(N2,k3,x);P2=j1(P2,k3,x);}if(d3.length===i3){return false;}}});}if(d3.length<h3){L.error(w.CARD_ERROR+w.MIN_FEEDS+F1+" "+w.FEEDS_OBTAINED+d3.length+" "+w.FEEDS_REQUIRED+h3+" "+w.FEEDS);return false;}}if(d3.length){var m3=[];var n3;if(!(n3=d.getDataset())){L.error(w.NO_DATASET);return false;}G=x;var o3=s.getProperty("/entityType").$Type;n(d3,function(i,k3){if(!k3||!k3[f3]||!k3[f3].$PropertyPath){L.error(w.INVALID_CHART_ANNO);return false;}var k=k3[f3].$PropertyPath;var u2=k;var F3=k;var G3=null;if(x[o3+"/"+k]){if(x[o3+"/"+k]["@"+u.LABEL_KEY_V4]){if(x[o3+"/"+k]["@"+u.LABEL_KEY_V4].String){u2=p1(x[o3+"/"+k]["@"+u.LABEL_KEY_V4].String,d,b2);}else if(x[o3+"/"+k]["@"+u.LABEL_KEY_V4].$Path){u2=x[o3+"/"+k]["@"+u.LABEL_KEY_V4].$Path;}else{u2=x[o3+"/"+k]["@"+u.LABEL_KEY_V4];}}else if(x[o3+"/"+k][u.LABEL_KEY]){u2=x[o3+"/"+k][u.LABEL_KEY];}else if(k){u2=k;}if(x[o3+"/"+k][u.TEXT_KEY_V4]){F3=x[o3+"/"+k][u.TEXT_KEY_V4].String?x[o3+"/"+k][u.TEXT_KEY_V4].String:x[o3+"/"+k][u.TEXT_KEY_V4].$Path;}else if(x[o3+"/"+k][u.TEXT_KEY]){F3=x[o3+"/"+k][u.TEXT_KEY];}else if(k){F3=k;}G3=b2[k].$Type||null;}var H3;if((G3==="Edm.DateTime"||G3==="Edm.DateTimeOffset")&&F3===k){H3="{path:'"+k+"', formatter: 'sap.ovp.cards.charts.VizAnnotationManager.returnDateFormat'}";}else{if(x[o3+"/"+k]&&x[o3+"/"+k][u.TEXT_KEY_V4]&&x[o3+"/"+k][u.TEXT_KEY_V4][u.TEXT_ARRANGEMENT_ANNO]){var I3,J3;I3=x[o3+"/"+k][u.TEXT_ARRANGEMENT_ANNO];J3=I3&&I3.EnumMember;if(!J3){I3=x[o3+"/"+k][u.TEXT_KEY_V4][u.TEXT_ARRANGEMENT_ANNO];J3=I3&&I3.EnumMember;}if(!J3){var K3=G;I3=K3&&K3[u.TEXT_ARRANGEMENT_ANNO];J3=I3&&I3.EnumMember;}switch(J3){case"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst":H3="{"+F3+"}"+" "+"("+"{"+k+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast":H3="{"+k+"}"+" "+"("+"{"+F3+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly":H3="{"+F3+"}";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeperate":H3="{"+k+"}"+" "+"("+"{"+F3+"}"+")";break;default:H3="{"+k+"}";break;}}else{H3="{"+F3+"}";}}m3.push(u2);if(f3==="Dimension"){if(c3==="waterfallType"){var L3=new e({name:u2,value:"{"+k+"}"});}else{var L3=new e({name:u2,value:"{"+k+"}",displayValue:H3});}var M3=b2[k][u.SEMANTICS_KEY];var N3=y(d.getModel(),a2,k);if(S1&&(G3==="Edm.DateTime"||N3||G3==="Edm.DateTimeOffset"||(M3&&M3.lastIndexOf("year",0)===0))){L3.setDataType("date");}n3.addDimension(L3);if((V2?Array.prototype.indexOf.call(V2,u2):-1)===-1){V2.push(u2);}}else{n3.addMeasure(new M({name:u2,value:"{"+k+"}"}));if(((U2?Array.prototype.indexOf.call(U2,u2):-1)===-1)&&(c3!="bubbleWidth")){U2.push(u2);}}});d.addFeed(new F({'uid':c3,'type':f3,'values':m3}));if(c3==="categoryAxis"){L1[c3]={title:{visible:j2?false:true,text:m3.join(", ")},label:{formatString:Q2?'CURR':'axisFormatter',truncatedLabelRatio:0.15}};}else{L1[c3]={title:{visible:j2?false:true,text:m3.join(", ")},label:{formatString:Q2?'CURR':'axisFormatter'}};}T2.push(L1[c3]);if(H1.hasOwnProperty("vizProperties")){var p3=0;var q3=H1.vizProperties.length;var r3;var s3;for(;p3<q3;p3++){if(H1.vizProperties[p3].hasOwnProperty("value")){s3=H1.vizProperties[p3].value;}if(H1.vizProperties[p3].hasOwnProperty("path")){r3=(H1.vizProperties[p3].path).split(".");var t3=r3.length;var u3,v3;var w3;for(var x3=0,w3=r3[0],u3=L1,v3=f2;x3<t3;++x3){if(x3===t3-1){if(v3&&v3.hasOwnProperty(w3)){if(F1==='donut'&&(v3[w3]==="value"||v3[w3]==="percentage")){s3=v3[w3];}else if(F1!='donut'){s3=v3[w3];}}if((B2&&(w3!="adjustScale"))||(!B2&&(w3==="adjustScale"))||(!B2&&(w3!="adjustScale"))){u3[w3]=s3;}break;}u3[w3]=u3[w3]||{};u3=u3[w3];if(v3){v3[w3]=v3[w3]||{};v3=v3[w3];}w3=r3[x3+1];}}}}if(v.hasOwnProperty("vizProperties")){var i=0;var y3=v.vizProperties.length;var z3;var A3;var B3;for(;i<y3;i++){if(v.vizProperties[i].hasOwnProperty("method")){A3=v.vizProperties[i].method;switch(A3){case'count':z3=m3.length;if(v.vizProperties[i].hasOwnProperty("min")&&z3<=v.vizProperties[i].min){z3=v.vizProperties[i].min;}else if(v.vizProperties[i].hasOwnProperty("max")&&z3>=v.vizProperties[i].max){z3=v.vizProperties[i].max;}break;default:break;}}else if(v.vizProperties[i].hasOwnProperty("value")){z3=v.vizProperties[i].value;}if(v.vizProperties[i].hasOwnProperty("path")){B3=(v.vizProperties[i].path).split(".");var C3=B3.length;for(var j=0,D3=B3[0],E3=L1;j<C3;++j){if(j===C3-1){E3[D3]=z3;break;}E3[D3]=E3[D3]||{};E3=E3[D3];D3=B3[j+1];}}}}}}});var X2=d.getFeeds();if(H1.properties&&H1.properties.semanticPattern===true&&J(X2,F1)){n(X2,function(i,v){if(X2[i].getType()==='Measure'&&((X2[i].getUid()==='valueAxis')||(X2[i].getUid()==='actualValues'))){var j;n(J1,function(W2,h3){var i3=I(h3.Measure.PropertyPath,b2);if(i3===X2[i].getValues()[0]){j=E(h3,x);return false;}});if(j){var k=I(j.Measure.PropertyPath,b2);var c3=(x[j.DataPoint.AnnotationPath.substring(1)].ForecastValue.PropertyPath||x[j.DataPoint.AnnotationPath.substring(1)].ForecastValue.Path);var d3=I(c3,b2);var e3=h.getText("ACTUAL",[k]);var f3=h.getText("FORECAST",[d3]);L1.plotArea.dataPointStyle={rules:[{dataContext:{MeasureNamesDimension:k},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"line",lineColor:"sapUiChartPaletteSequentialHue1Light1"},displayName:e3},{dataContext:{MeasureNamesDimension:d3},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"dotted",lineColor:"sapUiChartPaletteSequentialHue1Light1",pattern:"diagonalLightStripe"},displayName:f3}]};d.getDataset().addMeasure(new M({name:d3,value:"{"+c3+"}"}));var g3=X2[i].getValues();g3.push(d3);X2[i].setValues(g3);}return false;}});}if(H1.properties&&H1.properties.semanticPattern===true&&J(X2,F1)&&d.getVizType()==="vertical_bullet"){n(X2,function(i,v){if(X2[i].getType()==='Measure'&&((X2[i].getUid()==='valueAxis')||(X2[i].getUid()==='actualValues'))){var j;n(J1,function(W2,d3){var e3=I(d3.Measure.PropertyPath,b2);if(e3===X2[i].getValues()[0]){j=H(d3,x);return false;}});if(j){var k=(x[j.DataPoint.AnnotationPath.substring(1)].TargetValue.PropertyPath||x[j.DataPoint.AnnotationPath.substring(1)].TargetValue.Path);var c3=I(k,b2);d.getDataset().addMeasure(new M({name:c3,value:"{"+k+"}"}));d.addFeed(new F({'uid':"targetValues",'type':"Measure",'values':[c3]}));}return false;}});}if(Q2&&R2){L.warning(h.getText("Currency_non_currency_measure"));}n(X2,function(i,k){var v=k.getProperty("type");if(v==="Measure"){var c3=k.getProperty("values");var d3=true;var e3=D1.MeasureAttributes.filter(function(j){return c3.indexOf(b2[j[v]["$PropertyPath"]][u.LABEL_KEY])>=0||c3.indexOf(b2[j[v]["$PropertyPath"]][u.LABEL_KEY_V4])>=0;});n(e3,function(j,f3){if(l1(b2,f3,v)||m1(b2,f3,v)){d3=false;}else{d3=true;return false;}});if(!d3){L1[k.getProperty('uid')]['label']['allowDecimals']=false;}}});var Y2;if(P2===undefined){P2="";}if(O2===undefined){O2="";}if(Q2){Y2=s1(P2,Q2);}else{Y2=s1(O2,Q2);}if(f){f.setScale(Y2);}r1(U2,V2,m);var Z2="";n(X2,function(i,j){var k="-1";var v=j.getProperty("type");if(v==="Measure"){var c3=T2.filter(function(f3){var g3=f3["title"]["text"].split(",").filter(function(h3){if(j.getValues().indexOf(h3.trim())>=0){return true;}else{return false;}});if(g3.length>0){return true;}else{return false;}});if(c3&&c3.length){var d3=j.getValues();if(d3&&d3.length){n(d3,function(i,f3){var g3=f3.trim();var h3=J1.filter(function(l3){if(l3["Measure"]&&l3["Measure"]["PropertyPath"]){var m3=l3["Measure"]["PropertyPath"];if((b2[m3]&&b2[m3][u.LABEL_KEY]===g3)||(b2[m3]&&b2[m3][u.LABEL_KEY_V4]===g3)){return true;}else{return false;}}});if(h3&&h3.length){var i3=h3[0];if(!l1(b2,i3,v)&&!m1(b2,i3,v)){var j3="";if(i3&&i3["DataPoint"]&&i3["DataPoint"]["AnnotationPath"]&&i3["DataPoint"]["AnnotationPath"]){j3=i3["DataPoint"]["AnnotationPath"]&&i3["DataPoint"]["AnnotationPath"].substring(1);if(j3!=""){var k3;k3=x[j3]&&x[j3]["ValueFormat"]&&x[j3]["ValueFormat"]["NumberOfFractionalDigits"]&&x[j3]["ValueFormat"]["NumberOfFractionalDigits"]["Int"];k=k3>k?k3:k;}}}else{k=k<"0"?"0":k;}}});}}if(c3&&c3[0]&&c3[0].label&&c3[0].label.formatString){var e3=c3[0].label.formatString;}Z2="";if(Q2){if(e3==='CURR'){Z2='CURR/'+k.toString()+"/";}else{Z2='axisFormatter/'+k.toString()+"/";}}else{Z2='axisFormatter/'+k.toString()+"/";}if(c3&&c3[0]){c3[0].label.formatString=Z2;}}});if(F1==="vertical_bullet"){L1["valueAxis"]={title:{visible:j2?false:true},label:{formatString:Z2}};}var $2="";var _2="";if(Q2){$2=N2.toString();_2='CURR/'+N2.toString()+"/";}else{$2=M2.toString();_2='axisFormatter/'+M2.toString()+"/";}if(F1==="donut"||E1){if(F1==="donut"){L1.legendGroup={layout:{height:0.1}};}L1.plotArea.dataLabel.formatString=_2;if(L1.plotArea.dataLabel.type==="percentage"){L1.plotArea.dataLabel.formatString="0.0%/"+$2+"/";}}_(N1,H1,"dimension");_(O1,H1,"measure");if(S1){var a3=I1[0].Dimension.$PropertyPath;var b3=d.getModel().getMetaModel().getObject("/"+a2+"/"+a3+"@");if(b3["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){L1.timeAxis.levels=["year","month"];}else if(b3["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){L1.timeAxis.levels=["year","quarter"];}else if(b3["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){L1.timeAxis.levels=["year","week"];}else if(b3["@com.sap.vocabularies.Common.v1.IsCalendarYear"]){L1.timeAxis.levels=["year"];}}d.setVizProperties(L1);}function o1(v,d,f,j){if(v&&(v.getVizType()==="bubble"||v.getVizType()==="scatter")){return;}var k,r,s,x;var C1;var D1=u.UNIT_KEY;var E1=u.UNIT_KEY_V4_ISOCurrency;var F1=u.UNIT_KEY_V4_Unit;var G1;var H1=[];if(!(k=v.getModel('ovpCardProperties'))){L.error(w.CARD_ERROR+"in "+w.CARD_CONFIG+w.NO_CARD_MODEL);return;}var I1=v.getModel();var J1=k.getProperty("/entitySet");if(!I1||!J1){return;}r=j[k.getProperty("/entityType").$Type];if(!r){L.error(w.CARD_ANNO_ERROR+"in "+w.CARD_ANNO);return;}var K1=q1(I1,J1);s=k.getProperty("/chartAnnotationPath");if(!s||!(x=r["@"+s])){L.error(w.CARD_ANNO_ERROR+"in "+w.CARD_ANNO);return;}if(!(C1=x.MeasureAttributes)||!C1.length){L.error(w.CHART_ANNO_ERROR+"in "+w.CHART_ANNO+" "+w.MEASURES_MANDATORY);return;}n(C1,function(i,m){G1=m.Measure.$PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var T1=r[m.DataPoint.AnnotationPath.substring(1)];if(T1.ForecastValue&&(T1.ForecastValue.PropertyPath||T1.ForecastValue.Path)){H1.push((T1.ForecastValue.PropertyPath||T1.ForecastValue.Path));}}H1.push(G1);});var L1=d?d:null;var M1="";var N1=true;var O1=[];var P1=v.getFeeds();n(P1,function(i,m){if(m.getType()==="Measure"){O1=O1.concat(m.getValues());}});if(L1){n(H1,function(i,m){var T1="";if(K1&&K1[m]){if(K1[m][u.LABEL_KEY_V4]){T1=p1(K1[m][u.LABEL_KEY_V4].String?K1[m][u.LABEL_KEY_V4].String:K1[m][u.LABEL_KEY_V4].Path,v,K1);}else if(K1[m][u.LABEL_KEY]){T1=K1[m][u.LABEL_KEY];}else if(m){T1=m;}}if((O1?Array.prototype.indexOf.call(O1,T1):-1)!=-1){if(K1&&K1[m]){var U1;if(K1[m][E1]){U1=K1[m][E1].Path?K1[m][E1].Path:K1[m][E1].String;}else if(K1[m][F1]){U1=K1[m][F1].Path?K1[m][F1].Path:K1[m][F1].String;}else if(K1[m][D1]){U1=K1[m][D1];}if(!U1){N1=false;return false;}if(U1&&K1[U1]){for(var i=0;i<L1.length;i++){var V1=L1[i];if(N1){if(M1&&V1[U1]&&(V1[U1]!="")&&(M1!="")&&(M1!=V1[U1])){N1=false;break;}}M1=V1[U1];}}}}});}var Q1="";if(N1){if(M1!=""){Q1=h.getText("IN_NO_SCALE",[M1]);Q1=" "+Q1;}if(f){f.setText(Q1);f.data("aria-label",Q1,true);var R1=v.data("aria-label");if(R1&&Q1&&R1.indexOf(Q1)===-1){var S1=R1+Q1;v.data("aria-label",S1,true);}}}}function p1(f,v,m){var r;var s;var d;if(f&&f.indexOf("{")===0){f=f.slice(1,-1);if(f.indexOf(">")!=-1){d=f.split(">");r=d[0];s=d[1];}else if(f.indexOf("&gt;")!=-1){d=f.split("&gt;");r=d[0];s=d[1];}try{f=v.getModel(r).getProperty(s);}catch(i){f=m[f][u.LABEL_KEY_V4].String;L.error("Unable to read labels from resource file",i);}}return f;}function q1(m,d){var f=U.cacheODataMetadata(m);if(!f){return undefined;}return f[d];}function r1(m,d,f){var j="",k="",r="";if(f){j=f.getText();}if(m&&(m.length>1)){for(var i=0;i<m.length-1;i++){if(k!=""){k+=", ";}k+=m[i];}k=h.getText("MEAS_DIM_TITLE",[k,m[i]]);}else if(m){k=m[0];}if(d&&(d.length>1)){for(var i=0;i<d.length-1;i++){if(r!=""){r+=", ";}r+=d[i];}r=h.getText("MEAS_DIM_TITLE",[r,d[i]]);}else if(d){r=d[0];}if(f&&(j==="")){j=h.getText("NO_CHART_TITLE",[k,r]);f.setText(j);f.data("aria-label",j,true);}}function s1(m,i){var d=1;var s;if(i){var f=N.getCurrencyInstance({style:'short',currencyCode:false,shortRefNumber:m});s=f.format(Number(d));}else{var j=N.getFloatInstance({style:'short',shortRefNumber:m});s=j.format(Number(d));}var k=s.slice(-1);return k;}function t1(v,d){v.attachSelectData(function(f){var s=l.bCRTLPressed?l.constants.explace:l.constants.inplace;l.bCRTLPressed=false;var m=v.getModel('ovpCardProperties');var C1=v.getModel();var D1=m.getProperty("/entitySet");var E1=q1(C1,D1);var F1=[],G1=[];var H1={},I1={};var J1=v.getDataset().getDimensions();var K1;var L1=m.getProperty("/entityType");var M1=d.getMetaModel().getData()["$Annotations"];for(var i=0;i<J1.length;i++){F1.push(J1[i].getName());}var N1=v.getDataset().getBinding("data").getCurrentContexts().map(function(x){return x.getObject();});if(f.getParameter("data")&&f.getParameter("data")[0]&&f.getParameter("data")[0].data){G1=Object.keys(f.getParameter("data")[0].data);K1=f.getParameter("data")[0].data._context_row_number;var O1=v.getDataset().getBinding("data").getContexts()[K1];var P1=d.getEntityNavigationEntries(O1)[0];if(N1[K1].$isOthers&&N1[K1].$isOthers===true){var Q1={},R1=[];for(var j=0;j<F1.length;j++){for(var k=0;k<G1.length;k++){if(F1[j]===G1[k]){for(var S1 in E1){if(E1.hasOwnProperty(S1)){var T1=E1[S1][u.LABEL_KEY]||E1[S1][u.NAME_KEY]||E1[S1][u.NAME_CAP_KEY];if(T1===G1[k]){R1.push(S1);}}}}}}for(var i=0;i<R1.length;i++){Q1[R1[i]]=[];for(var j=0;j<N1.length-1;j++){if(j!=K1){Q1[R1[i]].push(N1[j][R1[i]]);}}}var U1={$isOthers:true};var V1={getObject:function(){return U1;},getOtherNavigationDimensions:function(){return Q1;}};if(O.checkIfAPIIsUsed(d)){if(d.checkAPINavigation()){c.onContentClicked(V1);}}else{if(P1){d.doNavigation(V1,P1,s);}}}else{for(var j=0;j<F1.length;j++){for(var k=0;k<G1.length;k++){if(F1[j]===G1[k]){for(var S1 in E1){if(M1[L1.$Type+"/"+S1]){var T1=M1[L1.$Type+"/"+S1]["@"+u.LABEL_KEY_V4]||M1[L1.$Type+"/"+S1][u.LABEL_KEY]||M1[L1.$Type+"/"+S1][u.NAME_KEY]||M1[L1.$Type+"/"+S1][u.NAME_CAP_KEY]||S1;if(T1.match(/{@i18n>.+}/gi)){var W1=this.getModel("@i18n").getResourceBundle();T1=W1.getText(T1.substring(T1.indexOf(">")+1,T1.length-1));}if(T1===G1[k]){H1[S1]=N1[K1][S1];}}}}for(var S1 in N1[K1]){if(E1.hasOwnProperty(S1)){I1[S1]=N1[K1][S1];}}}}if(H1){n(Object.keys(H1),function(i,S1){if(E1[S1]["$Type"]==="Edm.String"){if(E1[S1]["sap:semantics"]==="yearmonth"||E1[S1]["annotations"]["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){H1[S1]=(H1[S1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYMM"}).format(H1[S1]):H1[S1]);}else if(E1[S1]["sap:semantics"]==="yearquarter"||E1[S1]["annotations"]["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){H1[S1]=(H1[S1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYQ"}).format(H1[S1]):H1[S1]);}else if(E1[S1]["sap:semantics"]==="yearweek"||E1[S1]["annotations"]["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){H1[S1]=(H1[S1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYww"}).format(H1[S1]):H1[S1]);}}});}if(I1){n(Object.keys(I1),function(i,S1){if(E1[S1]["$Type"]==="Edm.String"){if(E1[S1]["sap:semantics"]==="yearmonth"||E1[S1]["annotations"]["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){I1[S1]=(I1[S1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYMM"}).format(I1[S1]):I1[S1]);}else if(E1[S1]["sap:semantics"]==="yearquarter"||E1[S1]["annotations"]["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){I1[S1]=(I1[S1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYQ"}).format(I1[S1]):I1[S1]);}else if(E1[S1]["sap:semantics"]==="yearweek"||E1[S1]["annotations"]["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){I1[S1]=(I1[S1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYww"}).format(I1[S1]):I1[S1]);}}});}var X1=L1[m.getProperty('/presentationAnnotationPath')];if(L1){var Y1=a.getRequestFields(X1);if(Y1&&Y1.length>0){n(Y1,function(i,r){if(!H1.hasOwnProperty(r)){H1[r]=N1[K1][r];}});}}var V1={getObject:function(){return H1;},getAllData:function(){return I1;}};if(O.checkIfAPIIsUsed(d)){if(d.checkAPINavigation()){c.onContentClicked(V1);}}else{if(P1){d.doNavigation(V1,P1,s);}}}}});}function u1(d){if(d.$EnumMember.endsWith("Bubble")){return true;}else{return false;}}function v1(d){var r=false;if(!d||d.constructor!=Array||d.length<1||d[0].constructor!=Object||!d[0].Dimension||!d[0].Dimension.$PropertyPath){L.error(w.CHART_ANNO_ERROR+"in "+w.CHART_ANNO+" "+w.DIMENSIONS_MANDATORY);return r;}r=true;return r;}function w1(m){var r=false;if(!m||m.constructor!=Array||m.length<1||m[0].constructor!=Object||!m[0].Measure||!m[0].Measure.$PropertyPath){L.error(w.CHART_ANNO_ERROR+"in "+w.CHART_ANNO+" "+w.MEASURES_MANDATORY);return r;}r=true;return r;}function x1(d){d=d["$Type"];return d;}function y1(d){if(d&&d.indexOf("#")!=-1){var f=d.split("#");if(f.length>1){return f[1];}}return"";}function z1(d,v){var f=v.getModel('ovpCardProperties');var i=A1(v);var m=+i.itemsLength;var j=+f.getProperty("/dataStep");if(m&&j){var k=d.colSpan-1;if(k>=0){m+=j*k;B1(v,m);}}}function A1(v){var d=v.getModel('ovpCardProperties');var f=d.getProperty("/entityType");var i=d.getProperty("/presentationAnnotationPath");var j=f.hasOwnProperty(i)&&f[i];var m=j&&j.MaxItems;if(m){var k=m.Int32?m.Int32:m.Int;return{itemsLength:+k,dataStep:+d.getProperty("/dataStep")};}}function B1(v,d){var f,j={},k=[];var r=v.getVizType();var s=v.getModel('ovpCardProperties');var x=s.getProperty("/entityType");var C1=s.getProperty("/chartAnnotationPath");var D1=x[C1];var E1=v.getParent();var F1=E1.getBinding("data");j.path=F1.getPath();j.parameters={};if(F1.mParameters&&F1.mParameters.select){j.parameters.select=F1.mParameters.select;}j.filters=F1.aApplicationFilters;j.sorter=F1.aSorters;j.length=(r==="donut")?d+1:d;j.template=new g();E1.bindAggregation("data",j);if(r==="donut"){n(D1.MeasureAttributes,function(i,m){k.push(m.Measure.PropertyPath);});f={};f.path=F1.getPath();f.parameters={};f.parameters.select=k.join(",");f.filters=F1.aApplicationFilters;f.sorter=F1.aSorters;f.length=1;f.template=new g();E1.bindAggregation("aggregateData",f);}E1.updateBindingContext();}return{constants:u,errorMessages:w,formatItems:z,formatByType:K,returnDateFormat:P,formatChartAxes:Q,hideDateTimeAxis:R,checkExists:T,validateCardConfiguration:W,checkNoData:X,getConfig:Y,hasTimeSemantics:Z,getChartType:$,getPrimitiveValue:a1,formThePathForCriticalityStateCalculation:d1,checkFlag:g1,buildVizAttributes:n1,setChartUoMTitle:o1,getMetadata:q1,getSelectedDataPoint:t1,checkBubbleChart:u1,dimensionAttrCheck:v1,measureAttrCheck:w1,getEntitySet:x1,getAnnotationQualifier:y1,reprioritizeContent:z1,getMaxItems:A1,getLabelFromAnnotationPath:p1};},true);
