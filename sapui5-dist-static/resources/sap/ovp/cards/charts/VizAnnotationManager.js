sap.ui.define(["sap/ui/thirdparty/jquery","sap/ovp/cards/charts/Utils","sap/ui/model/odata/CountMode","sap/ovp/cards/AnnotationHelper","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/viz/ui5/api/env/Format","sap/viz/ui5/controls/VizTooltip","sap/ovp/cards/CommonUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/core/Element","sap/ovp/app/resources","sap/ovp/app/OVPUtils","sap/base/util/each","sap/base/util/merge","sap/ovp/cards/ovpLogger","sap/base/util/isEmptyObject"],function(q,U,C,a,N,D,V,b,c,O,e,M,F,g,h,l,n,o,p,t){"use strict";var u={LABEL_KEY:"sap:label",LABEL_KEY_V4:"com.sap.vocabularies.Common.v1.Label",TEXT_KEY:"sap:text",TEXT_KEY_V4:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT_ANNO:"com.sap.vocabularies.UI.v1.TextArrangement",TYPE_KEY:"type",DISPLAY_FORMAT_KEY:"sap:display-format",SEMANTICS_KEY:"sap:semantics",UNIT_KEY:"sap:unit",UNIT_KEY_V4_ISOCurrency:"Org.OData.Measures.V1.ISOCurrency",UNIT_KEY_V4_Unit:"Org.OData.Measures.V1.Unit",CURRENCY_CODE:"currency-code",NAME_KEY:"name",NAME_CAP_KEY:"Name",EDM_TYPE:"type",EDM_INT32:"Edm.Int32",EDM_INT64:"Edm.Int64",SCATTER_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Scatter",BUBBLE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bubble",LINE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Line",COLUMNSTACKED_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked",VERTICALBULLET_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/VerticalBullet",COLUMN_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Column",BAR_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bar",COMBINATION_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Combination",DONUT_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Donut"};var w={CARD_WARNING:"OVP-AC: Analytic card: Warning: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",DATA_ANNO_ERROR:"OVP-AC: Analytic card Error:",CARD_ANNO_ERROR:"OVP-AC: Analytic card: Error ",CHART_ANNO_ERROR:"OVP-AC: Analytic card: Error ",INVALID_CHART_ANNO:"OVP-AC: Analytic Cards: Invalid Chart Annotation.",ANALYTICAL_CONFIG_ERROR:"Analytic card configuration error",CACHING_ERROR:"no model defined while caching OdataMetaData",INVALID_MAXITEMS:"maxItems is Invalid. ",NO_DATASET:"OVP-AC: Analytic Cards: Could not obtain dataset.",SORTORDER_WARNING:"SortOrder is present in PresentationVariant, but it is empty or not well formed.",BOOLEAN_ERROR:"Boolean value is not present in PresentationVariant.",IS_MANDATORY:"is mandatory.",IS_MISSING:"is missing.",NOT_WELL_FORMED:"is not found or not well formed)",MISSING_CHARTTYPE:"Missing ChartType in ",CHART_ANNO:"Chart Annotation.",DATA_ANNO:"Data Annotation",CARD_ANNO:"card annotation.",CARD_CONFIG:"card configuration.",CARD_CONFIG_ERROR:"Could not obtain configuration for ",CARD_CONTAINER_ERROR:"Could not obtain card container. ",DATA_UNAVAIALABLE:"No data available.",CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",ENTER_INTEGER:"Please enter an Integer.",NO_CARD_MODEL:"Could not obtain Cards model.",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_REDUNDANT:"Invalid/redundant role configured for ",CHART_IS:"chart is/are ",CARD_CONFIG_JSON:"card from config.json",ALLOWED_ROLES:"Allowed role(s) for ",DIMENSIONS_MANDATORY:"DimensionAttributes are mandatory.",MEASURES_MANDATORY:"MeasureAttributes are mandatory.",CARD_LEAST:"card: Enter at least ",CARD_MOST:"card: Enter at most ",FEEDS:"feed(s).",MIN_FEEDS:"Minimum number of feeds required for ",FEEDS_OBTAINED:"card is not configured. Obtained ",FEEDS_REQUIRED:"feed(s), Required: ",INVALID_SEMANTIC_MEASURES:"More than one measure is being semantically coloured",INVALID_IMPROVEMENT_DIR:"No Improvement Direction Found",INVALID_CRITICALITY:"Invalid criticality values",INVALID_DIMMEAS:"Invalid number of Measures or Dimensions",INVALID_FORECAST:"Invalid/Redundant Datapoint or Forecast measure",INVALID_TARGET:"Invalid/Redundant Datapoint or Target measure",ERROR_MISSING_AXISSCALES:"Minimum and Maximum values are mandatory for AxisScale MinMax to work"};var S=["year","yearweek","yearmonth","yearquarter"];var G;var L=new p("OVP.charts.VizAnnotationManager");function y(f,j,v,x,B1,C1,D1){var E1="{";if(!f||!f.getSetting('ovpCardProperties')){L.error(w.ANALYTICAL_CONFIG_ERROR);E1+="}";return E1;}var F1=f.getSetting("dataModel");var G1;if(D1&&D1.EnumMember){G1=D1.EnumMember.split("/");if(G1&&(G1[1]==='Donut')){F1.setDefaultCountMode(C.Inline);}if(G1&&(G1[1]!='Donut')&&(B1===undefined)){return null;}}var H1=[];var I1=[];var J1=[];var K1=[];var L1=[];var M1=[];var N1=[];var O1=v&&v.Parameters;var P1=x&&x.SortOrder;var Q1=x&&x.MaxItems,R1=null;var S1;var T1;var U1;var V1=null;var W1=u.TEXT_KEY;var X1=u.TEXT_KEY_V4;var Y1=u.UNIT_KEY;var Z1=u.UNIT_KEY_V4_ISOCurrency;var $1=u.UNIT_KEY_V4_Unit;var _1={};if(Q1){R1=Q1.Int32?Q1.Int32:Q1.Int;}if(R1){if(R1==="0"){L.error("OVP-AC: Analytic card Error: maxItems is configured as "+R1);E1+="}";return E1;}if(!/^\d+$/.test(R1)){L.error("OVP-AC: Analytic card Error: maxItems is Invalid. Please enter an Integer.");E1+="}";return E1;}}var a2=f.getSetting('ovpCardProperties'),b2=a2.getProperty('/parameters');var c2=a2.getProperty("/metaModel");O1=O1||!!b2;if(O1){var d2=a.resolveParameterizedEntitySet(F1,j,v,b2);E1+="path: '"+d2+"'";}else{E1+="path: '/"+j.name+"'";}var e2=[];V1=f.getSetting('ovpCardProperties').getProperty("/entitySet");if(!F1||!V1){return E1;}var f2=p1(F1,V1);var g2=f.getSetting('ovpCardProperties').getProperty("/cardLayout");var h2=1,i2;var j2=X();var k2;var l2;if(B1&&g2&&g2.colSpan&&g2.colSpan>1){i2=g2.colSpan-h2;for(var m2 in j2){if((l2=j2[m2].reference)&&j2[l2]){var n2=o({},j2[l2]);j2[m2]=n2;}if(m2===G1[1]||(j2[m2].time&&j2[m2].time.type===G1[1].toLowerCase())){k2=j2[m2];break;}}var o2=Y(B1,k2,F1,V1);if(o2){k2=k2.time;}else{k2=k2.default;}var p2=f.getSetting('ovpCardProperties').getProperty("/dataStep");if(!p2){if(k2.resize&&k2.resize.hasOwnProperty("dataStep")&&!isNaN(k2.resize.dataStep)){p2=k2.resize.dataStep;}}p2=parseInt(p2,10);if(i2>0&&p2&&!isNaN(p2)){R1=parseInt(R1,10)+p2*i2;}}if(v){var a2=f.getSetting('ovpCardProperties');e2=a.getFilters(a2,v);}if(e2.length>0){E1+=", filters: "+JSON.stringify(e2);}if(P1){var q2=x.SortOrder;if(!q2.length){q2=U.getSortAnnotationCollection(F1,x,j);}if(q2.length<1){L.warning(w.CARD_WARNING+w.SORTORDER_WARNING);}else{var r2="";var s2;var t2;var u2;for(var i=0;i<q2.length;i++){s2=q2[i];u2=s2.Property.PropertyPath;N1.push(u2);if(typeof s2.Descending==="undefined"){t2='true';}else{var f1=s2.Descending.Bool||s2.Descending.Boolean;if(!f1){L.warning(w.CARD_WARNING+w.BOOLEAN_ERROR);t2='true';}else{t2=f1.toLowerCase()==='true'?'true':'false';}}r2=r2+"{path: '"+u2+"',descending: "+t2+"},";}E1+=", sorter: ["+r2.substring(0,r2.length-1)+"]";}}var v2=f.getSetting("ovpCardProperties").getProperty("/entityType");n(C1,function(i,m){S1=m.Measure.PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var d=v2[m.DataPoint.AnnotationPath.substring(1)];if(d.ForecastValue&&(d.ForecastValue.PropertyPath||d.ForecastValue.Path)){var r=(d.ForecastValue.PropertyPath||d.ForecastValue.Path);L1.push((d.ForecastValue.PropertyPath||d.ForecastValue.Path));if(f2&&f2[r]){var s;if(f2[r][Z1]){s=f2[r][Z1].Path?f2[r][Z1].Path:undefined;}else if(f2[r][$1]){s=f2[r][$1].Path?f2[r][$1].Path:undefined;}else if(f2[r][Y1]){s=f2[r][Y1];}if(s){if((L1?Array.prototype.indexOf.call(L1,s):-1)===-1){L1.push(s);}}}}if(d.TargetValue&&(d.TargetValue.PropertyPath||d.TargetValue.Path)){var A2=(d.TargetValue.PropertyPath||d.TargetValue.Path);L1.push((d.TargetValue.PropertyPath||d.TargetValue.Path));if(f2&&f2[A2]){var s;if(f2[A2][Z1]){s=f2[A2][Z1].Path?f2[A2][Z1].Path:undefined;}else if(f2[A2][$1]){s=f2[A2][$1].Path?f2[A2][$1].Path:undefined;}else if(f2[A2][Y1]){s=f2[A2][Y1];}if(s){if((L1?Array.prototype.indexOf.call(L1,s):-1)===-1){L1.push(s);}}}}}L1.push(S1);if(f2&&f2[S1]){if(f2[S1][X1]){if(f2[S1][X1].String&&S1!=f2[S1][X1].String){L1.push(f2[S1][X1].String?f2[S1][X1].String:S1);}else if(f2[S1][X1].Path&&S1!=f2[S1][X1].Path){L1.push(f2[S1][X1].Path?f2[S1][X1].Path:S1);}}else if(f2[S1][W1]&&S1!=f2[S1][W1]){L1.push(f2[S1][W1]?f2[S1][W1]:S1);}}if(f2&&f2[S1]){var s;if(f2[S1][Z1]){s=f2[S1][Z1].Path?f2[S1][Z1].Path:undefined;}else if(f2[S1][$1]){s=f2[S1][$1].Path?f2[S1][$1].Path:undefined;}else if(f2[S1][Y1]){s=f2[S1][Y1];}if(s){if((L1?Array.prototype.indexOf.call(L1,s):-1)===-1){L1.push(s);}}}});n(B1,function(i,d){S1=d.Dimension.PropertyPath;H1.push(S1);if(f2&&f2[S1]){if(f2[S1][X1]){if(f2[S1][X1].String&&S1!=f2[S1][X1].String){H1.push(f2[S1][X1].String?f2[S1][X1].String:S1);}else if(f2[S1][X1].Path&&S1!=f2[S1][X1].Path){U1=f2[S1][X1].Path;var m=U1.split("/");if(m.length>1){T1=z(c2,v2,U1);if(T1!==""){H1.push(U1);I1.push(T1);K1=A(c2,v2,U1);if(K1.length>0){J1=J1.concat(K1);}}}else{H1.push(U1?U1:S1);}}}else if(f2[S1][W1]&&S1!=f2[S1][W1]){H1.push(f2[S1][W1]?f2[S1][W1]:S1);}}});if(J1.length>0){var k=0;while(k<J1.length){if(H1.indexOf(J1[k])!==-1){J1.splice(k,1);}else{k++;}}}if(L1.length>0){n(L1,function(i,m){_1[m]=true;});}if(H1.length>0){n(H1,function(i,d){_1[d]=true;});}E1+=", parameters: {select:'"+[].concat(H1,L1).join(",");var w2=c2.getODataEntityType(j.entityType);if(w2){var x2=a.getRequestFields(x);if(x2&&x2.length>0){n(x2,function(i,r){if(!_1.hasOwnProperty(r)){_1[r]=true;M1.push(r);}});if(M1.length>0){E1+=","+M1.join(",");}}}if(N1.length>0){var y2=[];n(N1,function(i,s){if(!_1.hasOwnProperty(s)){y2.push(s);}});if(y2.length>0){E1+=","+y2.join(",");}}if(I1.length>0){E1+="'"+","+" expand:'"+I1.join(',');}var z2=a.checkFilterPreference(f.getSetting("ovpCardProperties"));if(z2){E1+="', custom: {cardId: '"+f.getSetting("ovpCardProperties").getProperty("/cardId")+"'}}";}else{E1+="'}";}if(G1&&(G1[1]==='Donut')&&(B1===undefined)){E1+=", length: 1";}else if(G1&&(G1[1]==='Donut')&&(B1)&&R1){E1+=", length: "+(parseInt(R1,10)+1);}else if(R1){E1+=", length: "+R1;}E1+="}";return E1;}y.requiresIContext=true;function z(m,d,s){var f="";var j=s.split("/");if(j.length>1){for(var i=0;i<(j.length-1);i++){var k=m.getODataAssociationEnd(d,j[i]);if(k){d=m.getODataEntityType(k.type);if(f){f=f+"/";}f=f+j[i];}else{return f;}}}return f;}function A(m,d,s){var f=[];var k=[];var r;var v=s.split("/");if(v.length>1){for(var i=0;i<(v.length-1);i++){var x=m.getODataAssociationEnd(d,v[i]);if(x){d=m.getODataEntityType(x.type);if(d){k=d&&d.key&&d.key.propertyRef;for(var j=0;j<k.length;j++){r=v[i]+"/"+k[j].name;f.push(r);}}}}}return f;}function B(m,d){var f=false;var r;if(m.DataPoint&&m.DataPoint.AnnotationPath){var i=d[m.DataPoint.AnnotationPath.substring(1)];if(i&&i.ForecastValue&&(i.ForecastValue.PropertyPath||i.ForecastValue.Path)){f=true;r=m;}}if(f===true){return r;}else{L.warning(w.CARD_WARNING+w.INVALID_FORECAST);return undefined;}}function E(m,d){var f=false;var r;if(m.DataPoint&&m.DataPoint.AnnotationPath){var i=d[m.DataPoint.AnnotationPath.substring(1)];if(i&&i.TargetValue&&(i.TargetValue.PropertyPath||i.TargetValue.Path)){f=true;r=m;}}if(f===true){return r;}else{L.warning(w.CARD_WARNING+w.INVALID_TARGET);return undefined;}}function H(m,d){var f;n(d,function(i,v){if(v.name===m){if(v["com.sap.vocabularies.Common.v1.Label"]){f=v["com.sap.vocabularies.Common.v1.Label"].String?v["com.sap.vocabularies.Common.v1.Label"].String:v["com.sap.vocabularies.Common.v1.Label"].Path;}else if(v["sap:label"]){f=v["sap:label"];}return false;}});return f;}function I(f,d){var j=true;if(d==="line"||d==="column"||d==="bar"){n(f,function(i,v){if((v.getUid()==='valueAxis')||(v.getUid()==='categoryAxis')){if(v.getValues().length!=1){j=false;L.warning(w.CARD_WARNING+w.INVALID_DIMMEAS);return false;}}});}else if(d==="vertical_bullet"){n(f,function(i,v){if((v.getUid()==='actualValues')||(v.getUid()==='categoryAxis')){if(v.getValues().length!=1){j=false;L.warning(w.CARD_WARNING+w.INVALID_DIMMEAS);return false;}}});}if(j===true){return true;}}function J(m,s,v){var d=u.TYPE_KEY;if(!m||!m[s]||!m[s][d]){return v;}var f=["Edm.Int","Edmt.Int16","Edm.Int32","Edm.Int64","Edm.Decimal"];var i=m[s][d];if((f?Array.prototype.indexOf.call(f,i):-1)!==-1){return Number(v);}return v;}function K(d){if(d){return d;}return"";}function P(r){var d={locale:function(){},format:function(v,f){var i="";if(f){i=f.split('/');}if(i.length>0){var m,s;if(i.length===3){m=Number(i[1]);s=Number(i[2]);if(isNaN(m)){m=-1;}if(isNaN(s)){s=0;}}else{m=2;s=0;}if(i[0]==="axisFormatter"||(i[0]==="ShortFloat")){var j;j=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m?m:1});if(i[0]==="ShortFloat"){j=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});}if(m===-1){j=N.getFloatInstance({style:'short'});}return j.format(Number(v));}else if(i[0]==="tooltipNoScaleFormatter"){var k=N.getFloatInstance({style:'short',currencyCode:false,shortRefNumber:s,showScale:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){k=N.getFloatInstance({minFractionDigits:0,currencyCode:false});}return k.format(Number(v));}else if(i[0]==="CURR"){var x=N.getCurrencyInstance({style:'short',currencyCode:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){x=N.getCurrencyInstance({style:'short',currencyCode:false});}return x.format(Number(v));}else if(i[0].search("%")!==-1){var B1=N.getPercentInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});if(m===-1){B1=N.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1});}v=B1.format(Number(v));return v;}}if(v.constructor===Date){var C1=D.getDateTimeInstance({pattern:f});if(f==="YearMonthDay"){C1=D.getDateInstance({style:"medium"});}if(f==="YearMonth"||f==="MMM"){C1=D.getDateTimeInstance({format:"MMM"});}if(f==="YearQuarter"||f==="Quarter"){C1=D.getDateTimeInstance({format:"QQQ"});}if(f==="YearWeek"||f==="Week"){C1=D.getDateTimeInstance({format:"www"});}if(r&&f==="hh:mm"){var D1=v.toLocaleTimeString();var E1=D1.split(":");v=E1[0]+":"+E1[1];return v;}var F1=r?false:true;v=C1.format(new Date(v),F1);}return v;}};V.numericFormatter(d);}function Q(v,f){var d=v.getModel();var k=v.getVizType();if(k!="line"&&k!="bubble"){return;}if(!f){f=k==="line"?"categoryAxis":"valueAxis";}var m=v.getModel('ovpCardProperties').getProperty("/entitySet");if(!d||!m){return;}var r=p1(d,m);var s=v.getFeeds();for(var i=0;i<s.length;i++){if(s[i].getUid()===f){var x=s[i].getValues();if(!x){return;}for(var j=0;j<x.length;j++){if(r[x[j][u.TYPE_KEY]]!="Edm.DateTime"){return;}}v.setVizProperties({categoryAxis:{title:{visible:false}}});return;}}}function R(d,f,i,m,j,k){m=typeof m==="undefined"?false:m;var r=false;var s;if(!d&&m){L.error(j+w.CARD_ERROR+i+w.IS_MANDATORY);return r;}if(!d){L.warning(j+w.CARD_WARNING+i+w.IS_MISSING);r=true;return r;}s=f[d];if(!s||typeof s!=="object"){var v=m?L.error:L.warning;v(j+w.CARD_ERROR+"in "+i+". ("+d+" "+w.NOT_WELL_FORMED);return r;}if(k&&k==="sap.ovp.cards.charts.analytical.analyticalChart"&&i==="Chart Annotation"&&(!s.ChartType||!s.ChartType.EnumMember)){L.error(j+w.CARD_ERROR+w.MISSING_CHARTTYPE+w.CHART_ANNO);return r;}r=true;return r;}function T(d){var r=false;if(!d){return r;}var s;var f;var i;var j;var k;var m;var v;var x="";var B1;var C1=d.getView();if(C1){x="["+C1.getId()+"] ";}if(!(B1=d.getCardPropertiesModel())){L.error(x+w.CARD_ERROR+"in "+w.CARD_CONFIG+w.NO_CARD_MODEL);return r;}v=B1.getProperty("/entityType");if(!v||t(v)){L.error(x+w.CARD_ERROR+"in "+w.CARD_ANNO);return r;}s=B1.getProperty("/selectionAnnotationPath");f=B1.getProperty("/chartAnnotationPath");j=B1.getProperty("/presentationAnnotationPath");k=B1.getProperty("/identificationAnnotationPath");m=B1.getProperty("/dataPointAnnotationPath");i=B1.getProperty("/contentFragment");r=R(s,v,"Selection Variant",false,x);r=R(f,v,"Chart Annotation",true,x,i)&&r;r=R(j,v,"Presentation Variant",false,x)&&r;r=R(k,v,"Identification Annotation",true,x)&&r;r=R(m,v,"Data Point",false,x)&&r;return r;}function W(d,f,v){}function X(d){return U.getConfig(d);}function Y(d,f,i,j){var r=false;var m;var k;var s;var v;var x;var B1;if(!f.time||t(f.time)){return r;}if(!d){return r;}for(var C1=0;C1<d.length;C1++){if(!d[C1].Dimension||!(k=d[C1].Dimension.PropertyPath)){return r;}m=p1(i,j);if(m&&m[k]){s=m[k][u.TYPE_KEY];v=m[k][u.DISPLAY_FORMAT_KEY];x=m[k][u.SEMANTICS_KEY];B1=m[k]["com.sap.vocabularies.Common.v1.IsCalendarYear"]||m[k]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]||m[k]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]||m[k]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"];}if(s&&s.lastIndexOf("Edm.Date",0)===0){if(s.toLowerCase()==="edm.datetime"){if(v&&v.toLowerCase()==="date"){r=true;}}else{r=true;}}if(s==="Edm.String"&&(B1||x&&S.indexOf(x)>-1)){r=true;}if(r){d.unshift(d.splice(C1,1)[0]);break;}}return r;}function Z(i,d,f){var r="";var j=X(d);var k,m;if(!j){return r;}r=j.default.type;k=i.getSetting("dataModel");m=i.getSetting('ovpCardProperties').getProperty("/entitySet");if(Y(f,j,k,m)){r=j.time.type;}return r;}Z.requiresIContext=true;function $(d,j,k){if(!d.length){return;}var m=k==="dimension"?"Dimension":"Measure";var r=[];n(d,function(i,v){if(!v||!v[m]||!v[m].PropertyPath){L.error(w.INVALID_CHART_ANNO);return false;}r.push(v[m].PropertyPath);});var s=q.map(j.feeds,function(f){if(f.type===k){if(f.role){return f.role.split("|");}return[];}});s=q.grep(s,function(f,i){return(s?Array.prototype.indexOf.call(s,f):-1)===i;}).join(", ");L.error(w.CARD_ERROR+w.INVALID_REDUNDANT+k+"(s) "+r.join(", ")+". "+w.ALLOWED_ROLES+j.type+w.CHART_IS+s);}function _(v,i){var d;if(v){if(v.String){d=v.String;}else if(v.Boolean||v.Bool){d=a1(v);}else{d=b1(v,i);}}return d;}function a1(v,d){if(v&&v.Boolean){if(v.Boolean.toLowerCase()==="true"){return true;}else if(v.Boolean.toLowerCase()==="false"){return false;}}else if(v&&v.Bool){if(v.Bool.toLowerCase()==="true"){return true;}else if(v.Bool.toLowerCase()==="false"){return false;}}return d;}function b1(v,i){var d;if(v){if(v.String){d=Number(v.String);}else if(v.Int){d=Number(v.Int);}else if(v.Decimal){d=Number(v.Decimal);}else if(v.Double){d=Number(v.Double);}else if(v.Single){d=Number(v.Single);}}if(i){var f=N.getFloatInstance({style:'short',minFractionDigits:2,maxFractionDigits:2});if(d){d=f.format(Number(d));}}return d;}function c1(i,d){function e1(B1){if(B1){if(B1.Path){return"{path:'"+B1.Path+"'}";}else{return _(B1);}}else{return"";}}var v=i[i.measureNames];if(d&&d.CriticalityCalculation&&d.CriticalityCalculation.ImprovementDirection){var s=d.CriticalityCalculation.ImprovementDirection.EnumMember;var f=e1(d.CriticalityCalculation.DeviationRangeLowValue);var j=e1(d.CriticalityCalculation.DeviationRangeHighValue);var k=e1(d.CriticalityCalculation.ToleranceRangeLowValue);var m=e1(d.CriticalityCalculation.ToleranceRangeHighValue);return a._calculateCriticalityState(v,s,f,j,k,m,a.criticalityConstants.StateValues);}else{var r=d.Criticality.EnumMember;var x=r?r.split("/"):[];if(x){return x[1];}}}function d1(d,m,f){var j,k;n(m,function(i,v){if(v["com.sap.vocabularies.Common.v1.Label"]&&v["com.sap.vocabularies.Common.v1.Label"].String===d.measureNames){j=v.name;return false;}else if(v["com.sap.vocabularies.Common.v1.Label"]&&v["com.sap.vocabularies.Common.v1.Label"].Path===d.measureNames){j=v.name;return false;}else if(v["sap:label"]===d.measureNames){j=v.name;return false;}});n(f,function(i,v){if(v.Measure.PropertyPath===j){if(!v.DataPoint||!v.DataPoint.AnnotationPath){return false;}k=v.DataPoint.AnnotationPath;return false;}});return k;}function e1(i,d){if(i){if(i.Path){return i.Path;}else{return _(i,d);}}else{return"";}}function f1(m,d){function f(s,i){return s&&s.indexOf(i,s.length-i.length)!==-1;}var j=false;n(m,function(i,v){if(v.DataPoint&&v.DataPoint.AnnotationPath){var k=d[v.DataPoint.AnnotationPath.substring(1)];if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.ImprovementDirection&&k.CriticalityCalculation.ImprovementDirection.EnumMember){var s=k.CriticalityCalculation.ImprovementDirection.EnumMember;var r=e1(k.CriticalityCalculation.DeviationRangeLowValue);var x=e1(k.CriticalityCalculation.DeviationRangeHighValue);var B1=e1(k.CriticalityCalculation.ToleranceRangeLowValue);var C1=e1(k.CriticalityCalculation.ToleranceRangeHighValue);if(f(s,"Minimize")||f(s,"Minimizing")){if(C1&&x){j=true;return false;}else{L.warning(w.CARD_WARNING+w.INVALID_CRITICALITY);}}else if(f(s,"Maximize")||f(s,"Maximizing")){if(B1&&r){j=true;return false;}else{L.warning(w.CARD_WARNING+w.INVALID_CRITICALITY);}}else if(f(s,"Target")){if(B1&&r&&C1&&x){j=true;return false;}else{L.warning(w.CARD_WARNING+w.INVALID_CRITICALITY);}}}else if(k&&k.Criticality){j=true;return false;}else{L.warning(w.CARD_WARNING+w.INVALID_IMPROVEMENT_DIR);}}});if(j===true&&m.length>1){L.warning(w.CARD_WARNING+w.INVALID_SEMANTIC_MEASURES);}return j;}function g1(m,d,f,v){function i(G1,H1){return G1&&G1.indexOf(H1,G1.length-H1.length)!==-1;}var r=[null,null];var j=true;var k=m.Measure.PropertyPath;if(f[k]){if(f[k][u.LABEL_KEY_V4]){k=o1(f[k][u.LABEL_KEY_V4].String?f[k][u.LABEL_KEY_V4].String:f[k][u.LABEL_KEY_V4].Path,v,f);}else if(f[k][u.LABEL_KEY]){k=f[k][u.LABEL_KEY];}else if(k){k=k;}}var s=m.DataPoint.AnnotationPath;var x=d[s.substring(1)];if(!x.CriticalityCalculation||!x.CriticalityCalculation.ImprovementDirection||!x.CriticalityCalculation.ImprovementDirection.EnumMember){return r;}var B1=x.CriticalityCalculation.ImprovementDirection.EnumMember;var C1=e1(x.CriticalityCalculation.DeviationRangeLowValue,j);var D1=e1(x.CriticalityCalculation.DeviationRangeHighValue,j);var E1=e1(x.CriticalityCalculation.ToleranceRangeLowValue,j);var F1=e1(x.CriticalityCalculation.ToleranceRangeHighValue,j);if(i(B1,"Minimize")||i(B1,"Minimizing")){if(F1&&D1){r[0]=h.getText("MINIMIZING_LESS",[k,F1]);r[1]=h.getText("MINIMIZING_MORE",[k,D1]);r[2]=h.getText("MINIMIZING_CRITICAL",[F1,k,D1]);}}else if(i(B1,"Maximize")||i(B1,"Maximizing")){if(E1&&C1){r[0]=h.getText("MAXIMISING_MORE",[k,E1]);r[1]=h.getText("MAXIMISING_LESS",[k,C1]);r[2]=h.getText("MAXIMIZING_CRITICAL",[C1,k,E1]);}}else if(i(B1,"Target")){if(E1&&C1&&F1&&D1){r[0]=h.getText("TARGET_BETWEEN",[E1,k,F1]);r[1]=h.getText("TARGET_AROUND",[k,C1,D1]);r[2]=h.getText("TARGET_CRITICAL",[C1,k,E1,F1,D1]);}}return r;}function h1(m,v,d){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var f=d[v.DataPoint.AnnotationPath.substring(1)];var i,j;if(f&&f.ValueFormat){i=f.ValueFormat;}else if(f&&f.NumberFormat){i=f.NumberFormat;}if(i&&i.NumberOfFractionalDigits&&i.NumberOfFractionalDigits.Int){j=i.NumberOfFractionalDigits.Int;if(m<Number(j)){m=Number(j);}}}return m;}function i1(m,v,d){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var f=d[v.DataPoint.AnnotationPath.substring(1)];var s,i;if(f&&f.ValueFormat){s=f.ValueFormat;}else if(f&&f.NumberFormat){s=f.NumberFormat;}if(s){if(s.ScaleFactor&&s.ScaleFactor.Decimal){i=Number(s.ScaleFactor.Decimal);}else if(s.ScaleFactor&&s.ScaleFactor.Int){i=Number(s.ScaleFactor.Int);}if(!isNaN(i)){if(m===undefined){m=Number(i);}else if(m>Number(i)){m=Number(i);}}}}return m;}function j1(m,s){if(m&&m[s]&&(m[s]["Org.OData.Measures.V1.ISOCurrency"]||(m[s][u.SEMANTICS_KEY]&&m[s][u.SEMANTICS_KEY]===u.CURRENCY_CODE))){return true;}return false;}function k1(m,v,f){if(m[v[f].PropertyPath][u.EDM_TYPE]===u.EDM_INT32){return true;}return false;}function l1(m,v,f){if(m[v[f].PropertyPath][u.EDM_TYPE]===u.EDM_INT64){return true;}return false;}function m1(d,f,m,r){var s,x,B1,C1,D1;var E1,F1,G1,H1,I1,J1=false;var K1;var L1,M1,N1;var O1,P1=[],Q1=[];var R1;var S1;var T1=r&&r.getView();var U1,V1;var W1=T1&&T1.getModel("ui");var X1=W1&&W1.getProperty("/chartSettings");s=d.getModel('ovpCardProperties');if(O.checkIfAPIIsUsed(r)){J1=s&&s.getData()&&s.getData().showDataLabel;}D1=X1?X1.showDataLabel:J1;E1=d.getVizType();F1=X();for(var Y1 in F1){if((S1=F1[Y1].reference)&&F1[S1]){var Z1=o({},F1[S1]);F1[Y1]=Z1;}if(F1[Y1].default.type===E1||(F1[Y1].time&&F1[Y1].time.type===E1)){G1=F1[Y1];break;}}if(!G1){L.error(w.CARD_ERROR+"in "+w.CARD_CONFIG+w.CARD_CONFIG_ERROR+E1+" "+w.CARD_CONFIG_JSON);return;}if(!s){L.error(w.CARD_ERROR+"in "+w.CARD_CONFIG+w.NO_CARD_MODEL);return;}var $1=d.getModel();var _1=s.getProperty("/entitySet");if(!$1||!_1){return;}x=s.getProperty("/entityType");if(!x){L.error(w.CARD_ANNO_ERROR+"in "+w.CARD_ANNO);return;}var a2=p1($1,_1);B1=s.getProperty("/chartAnnotationPath");if(!B1||!(C1=x[B1])){L.error(w.CARD_ANNO_ERROR+"in "+w.CARD_ANNO);return;}if(!(H1=C1.DimensionAttributes)||!H1.length){L.error(w.CHART_ANNO_ERROR+"in "+w.CHART_ANNO+" "+w.DIMENSIONS_MANDATORY);return;}var b2;if(!(I1=C1.MeasureAttributes)||!I1.length){L.error(w.CHART_ANNO_ERROR+"in "+w.CHART_ANNO+" "+w.MEASURES_MANDATORY);return;}else{var c2=I1[0].DataPoint?x[I1[0].DataPoint.AnnotationPath.substring(1)]:null;var d2=c2&&c2.ValueFormat&&c2.ValueFormat.NumberOfFractionalDigits&&c2.ValueFormat.NumberOfFractionalDigits.Int;b2=d2?d2:0;}R1=Y(H1,G1,$1,_1);if(R1){G1=G1.time;}else{G1=G1.default;}var e2=s.getProperty("/ChartProperties")||s.getProperty("/chartProperties");if(s&&s.getProperty("/tabs")&&(e2===undefined)){U1=T1.byId("ovp_card_dropdown");V1=parseInt(U1.getSelectedKey(),10);e2=s.getProperty("/tabs")&&s.getProperty("/tabs")[V1-1]&&(s.getProperty("/tabs")[V1-1]["ChartProperties"]||s.getProperty("/tabs")[V1-1]["chartProperties"]);}var f2=false;var g2=b2>0?"tooltipNoScaleFormatter/"+b2.toString()+"/":'tooltipNoScaleFormatter/-1/';var h2=new b({formatString:g2});h2.connect(d.getVizUid());h2.connect(d.getVizUid());d._oOvpVizFrameTooltip=h2;[G1.dimensions,G1.measures].forEach(function(j,i){var k=i?I1:H1;var v=i?"measure(s)":"dimension(s)";if(j.min&&k.length<j.min){L.error(w.CARD_ERROR+"in "+E1+" "+w.CARD_LEAST+j.min+" "+v);f2=true;}if(j.max&&k.length>j.max){L.error(w.CARD_ERROR+"in "+E1+w.CARD_MOST+j.max+" "+v);f2=true;}});if(f2){return;}var i2=true;if(G1.properties&&G1.properties.hasOwnProperty("hideLabel")&&!G1.properties["hideLabel"]){i2=false;}var j2=true;var k2=false;if(E1==='donut'){k2=true;}d.removeAllAggregation();K1={legend:{isScrollable:false},title:{visible:false},interaction:{noninteractiveMode:j2?false:true,selectability:{legendSelection:k2?true:false,axisLabelSelection:false,mode:'EXCLUSIVE',plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:'disabled'}},plotArea:{window:{start:'firstDataPoint',end:'lastDataPoint'},dataLabel:{visible:D1||k2?true:false,type:'value'},dataPoint:{invalidity:'ignore'},alignment:{vertical:'top'}},categoryAxis:{label:{truncatedLabelRatio:0.15}},general:{groupData:false,showAsUTC:true}};if(G1.properties&&G1.properties.semanticColor===true&&f1(I1,x)){var l2=h.getText("GOOD");var m2=h.getText("BAD");var n2=h.getText("CRITICAL");var o2=h.getText("OTHERS");if(I1.length===1){var p2=g1(I1[0],x,a2,d);var l2=p2[0]||l2,m2=p2[1]||m2,n2=p2[2]||n2,o2=h.getText("OTHERS");}K1.plotArea.dataPointStyle={rules:[{callback:function(i){var j=d1(i,a2,I1);if(!j){return false;}var k=x[j.substring(1)];var v=c1(i,k);if(v===a.criticalityConstants.StateValues.Positive){return true;}else if(v==="Positive"){return true;}},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},"displayName":l2},{callback:function(i){var j=d1(i,a2,I1);if(!j){return false;}var k=x[j.substring(1)];var v=c1(i,k);if(v===a.criticalityConstants.StateValues.Critical){return true;}else if(v==="Critical"){return true;}},properties:{color:"sapUiChartPaletteSemanticCriticalLight1"},"displayName":n2},{callback:function(i){var j=d1(i,a2,I1);if(!j){return false;}var k=x[j.substring(1)];var v=c1(i,k);if(v===a.criticalityConstants.StateValues.Negative){return true;}else if(v==="Negative"){return true;}},properties:{color:"sapUiChartPaletteSemanticBadLight1"},"displayName":m2},{callback:function(i){var j=d1(i,a2,I1);if(!j){return false;}var k=x[j.substring(1)];var v=c1(i,k);if(v===a.criticalityConstants.StateValues.None){return true;}else if(v==="Neutral"){return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},"displayName":o2}]};}var q2=s.getProperty("/bEnableStableColors");var r2=s.getProperty("/colorPalette");var s2;if(!q2&&(C1.ChartType.EnumMember===u.COLUMNSTACKED_CHARTTYPE||C1.ChartType.EnumMember===u.DONUT_CHARTTYPE||C1.ChartType.EnumMember===u.COLUMN_CHARTTYPE||C1.ChartType.EnumMember===u.BAR_CHARTTYPE||C1.ChartType.EnumMember===u.VERTICALBULLET_CHARTTYPE||C1.ChartType.EnumMember===u.LINE_CHARTTYPE||C1.ChartType.EnumMember===u.COMBINATION_CHARTTYPE||C1.ChartType.EnumMember===u.BUBBLE_CHARTTYPE)&&r2&&Object.keys(r2).length>=2&&Object.keys(r2).length<=4){n(H1,function(i,j){if(j&&j.Role&&j.Role.EnumMember==="com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"){s2=j.Dimension&&j.Dimension.PropertyPath;return;}});var t2;if(s2){if(a2&&a2[s2]){if(a2[s2][u.LABEL_KEY_V4]){t2=o1(a2[s2][u.LABEL_KEY_V4].String?a2[s2][u.LABEL_KEY_V4].String:a2[s2][u.LABEL_KEY_V4].Path,d,a2);}else if(a2[s2][u.LABEL_KEY]){t2=a2[s2][u.LABEL_KEY];}else if(s2){t2=s2;}}if(r2 instanceof Array){var u2=r2.map(function(v){return v.color;});var v2=r2.map(function(v){return v.legendText;});var w2=v2[0]!=undefined?v2[0]:h.getText("OTHERS");var x2=v2[1]!=undefined?v2[1]:h.getText("BAD");var y2=v2[2]!=undefined?v2[2]:h.getText("CRITICAL");var z2=v2[3]!=undefined?v2[3]:h.getText("GOOD");}K1.plotArea.dataPointStyle={rules:[{callback:function(i){if(i&&(i[t2]==="3"||i[t2]===3)){if(r2 instanceof Array){if(r2.length<4){return false;}}else if(r2&&!r2.hasOwnProperty(3)){return false;}return true;}},properties:{color:r2 instanceof Array&&u2.length?u2[3]:r2[3]&&r2[3]["color"]},"displayName":z2||r2[3]&&r2[3]["legendText"]},{callback:function(i){if(i&&(i[t2]==="2"||i[t2]===2)){if(r2 instanceof Array){if(r2.length<3){return false;}}else if(r2&&!r2.hasOwnProperty(2)){return false;}return true;}},properties:{color:r2 instanceof Array&&u2.length?u2[2]:r2[2]&&r2[2]["color"]},"displayName":y2||r2[2]&&r2[2]["legendText"]},{callback:function(i){if(i&&(i[t2]==="1"||i[t2]===1)){return true;}},properties:{color:r2 instanceof Array&&u2.length?u2[1]:r2[1]&&r2[1]["color"]},"displayName":x2||r2[1]&&r2[1]["legendText"]},{callback:function(i){if(i&&(i[t2]==="0"||i[t2]===0)){return true;}},properties:{color:r2 instanceof Array&&u2.length?u2[0]:r2[0]&&r2[0]["color"]},"displayName":w2||r2[0]&&r2[0]["legendText"]}]};}}var A2=false;var B2=false;if(C1.ChartType.EnumMember===u.SCATTER_CHARTTYPE||C1.ChartType.EnumMember===u.BUBBLE_CHARTTYPE||C1.ChartType.EnumMember===u.LINE_CHARTTYPE){if(C1&&C1.AxisScaling&&C1.AxisScaling.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"){var C2=C1.AxisScaling;if(C2.AutoScaleBehavior&&C2.AutoScaleBehavior.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisAutoScaleBehaviorType"){var D2=C2.AutoScaleBehavior;if(D2.ZeroAlwaysVisible&&D2.ZeroAlwaysVisible.Bool=="true"){K1.plotArea.adjustScale=false;A2=true;}else if(D2.DataScope){K1.plotArea.adjustScale=true;A2=true;}}else if(C2.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"&&C2.ScaleBehavior&&C2.ScaleBehavior.EnumMember){var E2=C2.ScaleBehavior.EnumMember;var F2=E2.substring(E2.lastIndexOf('/')+1,E2.length);if(F2=="FixedScale"){B2=true;}}}else if(C1&&C1.AxisScaling&&C1.AxisScaling.EnumMember){var G2=C1.AxisScaling.EnumMember.substring(C1.AxisScaling.EnumMember.lastIndexOf('/')+1,C1.AxisScaling.EnumMember.length);switch(G2){case"AdjustToDataIncluding0":K1.plotArea.adjustScale=false;A2=true;break;case"AdjustToData":K1.plotArea.adjustScale=true;A2=true;break;case"MinMaxValues":B2=true;break;default:break;}}if(B2){var H2=[];if(C1["MeasureAttributes"][0]&&C1["MeasureAttributes"][0].DataPoint&&C1["MeasureAttributes"][0].DataPoint.AnnotationPath){var I2=C1["MeasureAttributes"][0].DataPoint.AnnotationPath;var J2=I2.substring(I2.lastIndexOf('@')+1,I2.length);if(x&&x[J2]){var K2=x[J2];if(K2&&K2.MaximumValue&&K2.MaximumValue.Decimal&&K2.MinimumValue&&K2.MinimumValue.Decimal){H2.push({feed:"valueAxis",max:K2.MaximumValue.Decimal,min:K2.MinimumValue.Decimal});A2=true;}else{L.error(w.ERROR_MISSING_AXISSCALES);}}}if(C1.ChartType.EnumMember!==u.LINE_CHARTTYPE&&C1["MeasureAttributes"][1]&&C1["MeasureAttributes"][1].DataPoint&&C1["MeasureAttributes"][1].DataPoint.AnnotationPath){var I2=C1["MeasureAttributes"][1].DataPoint.AnnotationPath;var J2=I2.substring(I2.lastIndexOf('@')+1,I2.length);if(x&&x[J2]){var K2=x[J2];if(K2&&K2.MaximumValue&&K2.MaximumValue.Decimal&&K2.MinimumValue&&K2.MinimumValue.Decimal){H2.push({feed:"valueAxis2",max:K2.MaximumValue.Decimal,min:K2.MinimumValue.Decimal});A2=true;}else{L.error(w.ERROR_MISSING_AXISSCALES);}}}d.setVizScales(H2);}}M1=H1.slice();N1=I1.slice();var L2=0;var M2=0;var N2;var O2;var P2=false;var Q2=false;var R2;var S2=[];var T2=[],U2=[];if((E1==="column"||E1==="bar"||E1==="vertical_bullet")&&G1.feeds&&(G1.feeds.length>0)){var V2;for(V2=0;V2<G1.feeds.length;V2++){if(G1.feeds[V2].uid==="color"){G1.feeds.splice(V2,1);break;}}for(V2=0;V2<G1.feeds.length;V2++){if(G1.feeds[V2].uid==="categoryAxis"){delete G1.feeds[V2].role;break;}}if(s.getProperty("/colorPalette")){for(V2=0;V2<G1.feeds.length;V2++){if(G1.feeds[V2].uid==="categoryAxis"){G1.feeds[V2].role="Category";break;}}G1.feeds.push({"uid":"color","min":1,"type":"dimension","role":"Series"});}}n(G1.feeds,function(i,v){var a3=v.uid;var b3=[];if(v.type){var c3,d3,e3;if(v.type==="dimension"){c3=H1.length;d3="Dimension";e3="dimensions";L1=M1;O1=P1;}else{c3=I1.length;d3="Measure";e3="measures";L1=N1;O1=Q1;}var f3=0,g3=c3;if(v.min){f3=f3>v.min?f3:v.min;}if(v.max){g3=g3<v.max?g3:v.max;}if(!v.role){var h3=L1.length;for(var j=0;j<h3&&b3.length<g3;++j){var i3=L1[j];L1.splice(j,1);--h3;--j;b3.push(i3);if(a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_ISOCurrency]){R2=a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_ISOCurrency].Path?a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_ISOCurrency].Path:undefined;}else if(a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_Unit]){R2=a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_Unit].Path?a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_Unit].Path:undefined;}else if(a2[i3[d3].PropertyPath][u.UNIT_KEY]){R2=a2[i3[d3].PropertyPath][u.UNIT_KEY];}if(j1(a2,R2)){P2=true;}else{Q2=true;}if(!P2){L2=h1(L2,i3,x);N2=i1(N2,i3,x);}else{M2=h1(M2,i3,x);O2=i1(O2,i3,x);}}}else{var j3=v.role.split("|");n(j3,function(j,C3){if(b3.length===g3){return false;}var h3=L1.length;for(var k=0;k<h3&&b3.length<g3;++k){var i3=L1[k];if(i3&&i3.Role&&i3.Role.EnumMember&&i3.Role.EnumMember.split("/")&&i3.Role.EnumMember.split("/")[1]){var D3=i3.Role.EnumMember.split("/")[1];if(D3===C3){L1.splice(k,1);--h3;--k;b3.push(i3);if(a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_ISOCurrency]){R2=a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_ISOCurrency].Path?a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_ISOCurrency].Path:undefined;}else if(a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_Unit]){R2=a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_Unit].Path?a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_Unit].Path:undefined;}else if(a2[i3[d3].PropertyPath][u.UNIT_KEY]){R2=a2[i3[d3].PropertyPath][u.UNIT_KEY];}if(j1(a2,R2)){P2=true;}else{Q2=true;}if(!P2){L2=h1(L2,i3,x);N2=i1(N2,i3,x);}else{M2=h1(M2,i3,x);O2=i1(O2,i3,x);}}}else if((O1?Array.prototype.indexOf.call(O1,i3):-1)===-1){O1.push(i3);}}});if(b3.length<g3){n(O1,function(k,i3){var C3;var V2;if((C3=G1[e3].defaultRole)&&((j3?Array.prototype.indexOf.call(j3,C3):-1)!==-1)&&(V2=(L1?Array.prototype.indexOf.call(L1,i3):-1)!==-1)){L1.splice(V2,1);b3.push(i3);if(a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_ISOCurrency]){R2=a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_ISOCurrency].Path?a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_ISOCurrency].Path:undefined;}else if(a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_Unit]){R2=a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_Unit].Path?a2[i3[d3].PropertyPath][u.UNIT_KEY_V4_Unit].Path:undefined;}else if(a2[i3[d3].PropertyPath][u.UNIT_KEY]){R2=a2[i3[d3].PropertyPath][u.UNIT_KEY];}if(j1(a2,R2)){P2=true;}else{Q2=true;}if(!P2){L2=h1(L2,i3,x);N2=i1(N2,i3,x);}else{M2=h1(M2,i3,x);O2=i1(O2,i3,x);}if(b3.length===g3){return false;}}});}if(b3.length<f3){L.error(w.CARD_ERROR+w.MIN_FEEDS+E1+" "+w.FEEDS_OBTAINED+b3.length+" "+w.FEEDS_REQUIRED+f3+" "+w.FEEDS);return false;}}if(b3.length){var k3=[];var l3;if(!(l3=d.getDataset())){L.error(w.NO_DATASET);return false;}G=x;n(b3,function(i,i3){if(!i3||!i3[d3]||!i3[d3].PropertyPath){L.error(w.INVALID_CHART_ANNO);return false;}var k=i3[d3].PropertyPath;var t2=k;var C3=k;var D3=null;if(a2&&a2[k]){if(a2[k][u.LABEL_KEY_V4]){if(a2[k][u.LABEL_KEY_V4].String){t2=o1(a2[k][u.LABEL_KEY_V4].String,d,a2);}else if(a2[k][u.LABEL_KEY_V4].Path){t2=a2[k][u.LABEL_KEY_V4].Path;}else{t2=k;}}else if(a2[k][u.LABEL_KEY]){t2=a2[k][u.LABEL_KEY];}else if(k){t2=k;}if(a2[k][u.TEXT_KEY_V4]){C3=a2[k][u.TEXT_KEY_V4].String?a2[k][u.TEXT_KEY_V4].String:a2[k][u.TEXT_KEY_V4].Path;}else if(a2[k][u.TEXT_KEY]){C3=a2[k][u.TEXT_KEY];}else if(k){C3=k;}D3=a2[k][u.TYPE_KEY]||null;}var E3;if((D3==="Edm.DateTime"||D3==="Edm.DateTimeOffset")&&C3===k){E3="{path:'"+k+"', formatter: 'sap.ovp.cards.charts.VizAnnotationManager.returnDateFormat'}";}else{if(a2[k]&&a2[k][u.TEXT_KEY_V4]&&a2[k][u.TEXT_KEY_V4][u.TEXT_ARRANGEMENT_ANNO]){var F3,G3;F3=a2[k][u.TEXT_ARRANGEMENT_ANNO];G3=F3&&F3.EnumMember;if(!G3){F3=a2[k][u.TEXT_KEY_V4][u.TEXT_ARRANGEMENT_ANNO];G3=F3&&F3.EnumMember;}if(!G3){var H3=G;F3=H3&&H3[u.TEXT_ARRANGEMENT_ANNO];G3=F3&&F3.EnumMember;}switch(G3){case"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst":E3="{"+C3+"}"+" "+"("+"{"+k+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast":E3="{"+k+"}"+" "+"("+"{"+C3+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly":E3="{"+C3+"}";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeperate":E3="{"+k+"}"+" "+"("+"{"+C3+"}"+")";break;default:E3="{"+k+"}";break;}}else{E3="{"+C3+"}";}}k3.push(t2);if(d3==="Dimension"){if(a3==="waterfallType"){var I3=new e({name:t2,value:"{"+k+"}"});}else{var I3=new e({name:t2,value:"{"+k+"}",displayValue:E3});}var J3=a2[k][u.SEMANTICS_KEY];var K3=a2[k]["com.sap.vocabularies.Common.v1.IsCalendarYear"]&&a2[k]["com.sap.vocabularies.Common.v1.IsCalendarYear"].Bool||a2[k]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]&&a2[k]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"].Bool||a2[k]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]&&a2[k]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"].Bool||a2[k]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]&&a2[k]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"].Bool;if(R1&&(D3==="Edm.DateTime"||K3||D3==="Edm.DateTimeOffset"||(J3&&J3.lastIndexOf("year",0)===0))){I3.setDataType("date");}l3.addDimension(I3);if((U2?Array.prototype.indexOf.call(U2,t2):-1)===-1){U2.push(t2);}}else{l3.addMeasure(new M({name:t2,value:"{"+k+"}"}));if(((T2?Array.prototype.indexOf.call(T2,t2):-1)===-1)&&(a3!="bubbleWidth")){T2.push(t2);}}});d.addFeed(new F({'uid':a3,'type':d3,'values':k3}));if(a3==="categoryAxis"){K1[a3]={title:{visible:i2?false:true,text:k3.join(", ")},label:{formatString:P2?'CURR':'axisFormatter',truncatedLabelRatio:0.15}};}else{K1[a3]={title:{visible:i2?false:true,text:k3.join(", ")},label:{formatString:P2?'CURR':'axisFormatter'}};}S2.push(K1[a3]);if(G1.hasOwnProperty("vizProperties")){var m3=0;var n3=G1.vizProperties.length;var o3;var p3;for(;m3<n3;m3++){if(G1.vizProperties[m3].hasOwnProperty("value")){p3=G1.vizProperties[m3].value;}if(G1.vizProperties[m3].hasOwnProperty("path")){o3=(G1.vizProperties[m3].path).split(".");var q3=o3.length;var r3,s3;var t3;for(var u3=0,t3=o3[0],r3=K1,s3=e2;u3<q3;++u3){if(u3===q3-1){if(s3&&s3.hasOwnProperty(t3)){if(E1==='donut'&&(s3[t3]==="value"||s3[t3]==="percentage")){p3=s3[t3];}else if(E1!='donut'){p3=s3[t3];}}if((A2&&(t3!="adjustScale"))||(!A2&&(t3==="adjustScale"))||(!A2&&(t3!="adjustScale"))){r3[t3]=p3;}break;}r3[t3]=r3[t3]||{};r3=r3[t3];if(s3){s3[t3]=s3[t3]||{};s3=s3[t3];}t3=o3[u3+1];}}}}if(v.hasOwnProperty("vizProperties")){var i=0;var v3=v.vizProperties.length;var w3;var x3;var y3;for(;i<v3;i++){if(v.vizProperties[i].hasOwnProperty("method")){x3=v.vizProperties[i].method;switch(x3){case'count':w3=k3.length;if(v.vizProperties[i].hasOwnProperty("min")&&w3<=v.vizProperties[i].min){w3=v.vizProperties[i].min;}else if(v.vizProperties[i].hasOwnProperty("max")&&w3>=v.vizProperties[i].max){w3=v.vizProperties[i].max;}break;default:break;}}else if(v.vizProperties[i].hasOwnProperty("value")){w3=v.vizProperties[i].value;}if(v.vizProperties[i].hasOwnProperty("path")){y3=(v.vizProperties[i].path).split(".");var z3=y3.length;for(var j=0,A3=y3[0],B3=K1;j<z3;++j){if(j===z3-1){B3[A3]=w3;break;}B3[A3]=B3[A3]||{};B3=B3[A3];A3=y3[j+1];}}}}}}});var W2=d.getFeeds();if(G1.properties&&G1.properties.semanticPattern===true&&I(W2,E1)){n(W2,function(i,v){if(W2[i].getType()==='Measure'&&((W2[i].getUid()==='valueAxis')||(W2[i].getUid()==='actualValues'))){var j;n(I1,function(V2,f3){var g3=H(f3.Measure.PropertyPath,a2);if(g3===W2[i].getValues()[0]){j=B(f3,x);return false;}});if(j){var k=H(j.Measure.PropertyPath,a2);var a3=(x[j.DataPoint.AnnotationPath.substring(1)].ForecastValue.PropertyPath||x[j.DataPoint.AnnotationPath.substring(1)].ForecastValue.Path);var b3=H(a3,a2);var c3=h.getText("ACTUAL",[k]);var d3=h.getText("FORECAST",[b3]);K1.plotArea.dataPointStyle={rules:[{dataContext:{MeasureNamesDimension:k},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"line",lineColor:"sapUiChartPaletteSequentialHue1Light1"},displayName:c3},{dataContext:{MeasureNamesDimension:b3},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"dotted",lineColor:"sapUiChartPaletteSequentialHue1Light1",pattern:"diagonalLightStripe"},displayName:d3}]};d.getDataset().addMeasure(new M({name:b3,value:"{"+a3+"}"}));var e3=W2[i].getValues();e3.push(b3);W2[i].setValues(e3);}return false;}});}if(G1.properties&&G1.properties.semanticPattern===true&&I(W2,E1)&&d.getVizType()==="vertical_bullet"){n(W2,function(i,v){if(W2[i].getType()==='Measure'&&((W2[i].getUid()==='valueAxis')||(W2[i].getUid()==='actualValues'))){var j;n(I1,function(V2,b3){var c3=H(b3.Measure.PropertyPath,a2);if(c3===W2[i].getValues()[0]){j=E(b3,x);return false;}});if(j){var k=(x[j.DataPoint.AnnotationPath.substring(1)].TargetValue.PropertyPath||x[j.DataPoint.AnnotationPath.substring(1)].TargetValue.Path);var a3=H(k,a2);d.getDataset().addMeasure(new M({name:a3,value:"{"+k+"}"}));d.addFeed(new F({'uid':"targetValues",'type':"Measure",'values':[a3]}));}return false;}});}if(P2&&Q2){L.warning(h.getText("Currency_non_currency_measure"));}n(W2,function(i,k){var v=k.getProperty("type");if(v==="Measure"){var a3=k.getProperty("values");var b3=true;var c3=C1.MeasureAttributes.filter(function(j){return a3.indexOf(a2[j[v]["PropertyPath"]][u.LABEL_KEY])>=0||a3.indexOf(a2[j[v]["PropertyPath"]][u.LABEL_KEY_V4])>=0;});n(c3,function(j,d3){if(k1(a2,d3,v)||l1(a2,d3,v)){b3=false;}else{b3=true;return false;}});if(!b3){K1[k.getProperty('uid')]['label']['allowDecimals']=false;}}});var X2;if(O2===undefined){O2="";}if(N2===undefined){N2="";}if(P2){X2=r1(O2,P2);}else{X2=r1(N2,P2);}if(f){f.setScale(X2);}q1(T2,U2,m);var Y2="";n(W2,function(i,j){var k="-1";var v=j.getProperty("type");if(v==="Measure"){var a3=S2.filter(function(d3){var e3=d3["title"]["text"].split(",").filter(function(f3){if(j.getValues().indexOf(f3.trim())>=0){return true;}else{return false;}});if(e3.length>0){return true;}else{return false;}});if(a3&&a3.length){var b3=j.getValues();if(b3&&b3.length){n(b3,function(i,d3){var e3=d3.trim();var f3=I1.filter(function(j3){if(j3["Measure"]&&j3["Measure"]["PropertyPath"]){var k3=j3["Measure"]["PropertyPath"];if((a2[k3]&&a2[k3][u.LABEL_KEY]===e3)||(a2[k3]&&a2[k3][u.LABEL_KEY_V4]===e3)){return true;}else{return false;}}});if(f3&&f3.length){var g3=f3[0];if(!k1(a2,g3,v)&&!l1(a2,g3,v)){var h3="";if(g3&&g3["DataPoint"]&&g3["DataPoint"]["AnnotationPath"]&&g3["DataPoint"]["AnnotationPath"]){h3=g3["DataPoint"]["AnnotationPath"]&&g3["DataPoint"]["AnnotationPath"].substring(1);if(h3!=""){var i3;i3=x[h3]&&x[h3]["ValueFormat"]&&x[h3]["ValueFormat"]["NumberOfFractionalDigits"]&&x[h3]["ValueFormat"]["NumberOfFractionalDigits"]["Int"];k=i3>k?i3:k;}}}else{k=k<"0"?"0":k;}}});}}if(a3&&a3[0]&&a3[0].label&&a3[0].label.formatString){var c3=a3[0].label.formatString;}Y2="";if(P2){if(c3==='CURR'){Y2='CURR/'+k.toString()+"/";}else{Y2='axisFormatter/'+k.toString()+"/";}}else{Y2='axisFormatter/'+k.toString()+"/";}if(a3&&a3[0]){a3[0].label.formatString=Y2;}}});if(E1==="vertical_bullet"){K1["valueAxis"]={title:{visible:i2?false:true},label:{formatString:Y2}};}var Z2="";var $2="";if(P2){Z2=M2.toString();$2='CURR/'+M2.toString()+"/";}else{Z2=L2.toString();$2='axisFormatter/'+L2.toString()+"/";}if(E1==="donut"||D1){if(E1==="donut"){K1.legendGroup={layout:{height:0.1}};}K1.plotArea.dataLabel.formatString=$2;if(K1.plotArea.dataLabel.type==="percentage"){K1.plotArea.dataLabel.formatString="0.0%/"+Z2+"/";}}$(M1,G1,"dimension");$(N1,G1,"measure");if(R1){var _2=H1[0].Dimension.PropertyPath;if(a2[_2][u.SEMANTICS_KEY]==='yearmonth'||a2[_2]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){K1.timeAxis.levels=["year","month"];}else if(a2[_2][u.SEMANTICS_KEY]==='yearquarter'||a2[_2]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){K1.timeAxis.levels=["year","quarter"];}else if(a2[_2][u.SEMANTICS_KEY]==='yearweek'||a2[_2]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){K1.timeAxis.levels=["year","week"];}else if(a2[_2][u.SEMANTICS_KEY]==='year'||a2[_2]["com.sap.vocabularies.Common.v1.IsCalendarYear"]){K1.timeAxis.levels=["year"];}}d.setVizProperties(K1);}function n1(v,d,f){if(v&&(v.getVizType()==="bubble"||v.getVizType()==="scatter")){return;}var j,k,r,s;var x;var B1=u.UNIT_KEY;var C1=u.UNIT_KEY_V4_ISOCurrency;var D1=u.UNIT_KEY_V4_Unit;var E1;var F1=[];if(!(j=v.getModel('ovpCardProperties'))){L.error(w.CARD_ERROR+"in "+w.CARD_CONFIG+w.NO_CARD_MODEL);return;}var G1=v.getModel();var H1=j.getProperty("/entitySet");if(!G1||!H1){return;}k=j.getProperty("/entityType");if(!k){L.error(w.CARD_ANNO_ERROR+"in "+w.CARD_ANNO);return;}var I1=p1(G1,H1);r=j.getProperty("/chartAnnotationPath");if(!r||!(s=k[r])){L.error(w.CARD_ANNO_ERROR+"in "+w.CARD_ANNO);return;}if(!(x=s.MeasureAttributes)||!x.length){L.error(w.CHART_ANNO_ERROR+"in "+w.CHART_ANNO+" "+w.MEASURES_MANDATORY);return;}n(x,function(i,m){E1=m.Measure.PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var R1=k[m.DataPoint.AnnotationPath.substring(1)];if(R1.ForecastValue&&(R1.ForecastValue.PropertyPath||R1.ForecastValue.Path)){F1.push((R1.ForecastValue.PropertyPath||R1.ForecastValue.Path));}}F1.push(E1);});var J1=d?d.results:null;var K1="";var L1=true;var M1=[];var N1=v.getFeeds();n(N1,function(i,m){if(m.getType()==="Measure"){M1=M1.concat(m.getValues());}});if(J1){n(F1,function(i,m){var R1="";if(I1&&I1[m]){if(I1[m][u.LABEL_KEY_V4]){R1=o1(I1[m][u.LABEL_KEY_V4].String?I1[m][u.LABEL_KEY_V4].String:I1[m][u.LABEL_KEY_V4].Path,v,I1);}else if(I1[m][u.LABEL_KEY]){R1=I1[m][u.LABEL_KEY];}else if(m){R1=m;}}if((M1?Array.prototype.indexOf.call(M1,R1):-1)!=-1){if(I1&&I1[m]){var S1;if(I1[m][C1]){S1=I1[m][C1].Path?I1[m][C1].Path:I1[m][C1].String;}else if(I1[m][D1]){S1=I1[m][D1].Path?I1[m][D1].Path:I1[m][D1].String;}else if(I1[m][B1]){S1=I1[m][B1];}if(!S1){L1=false;return false;}if(S1&&I1[S1]){for(var i=0;i<J1.length;i++){var T1=J1[i];if(L1){if(K1&&T1[S1]&&(T1[S1]!="")&&(K1!="")&&(K1!=T1[S1])){L1=false;break;}}K1=T1[S1];}}}}});}var O1="";if(L1){if(K1!=""){O1=h.getText("IN_NO_SCALE",[K1]);O1=" "+O1;}if(f){f.setText(O1);f.data("aria-label",O1,true);var P1=v.data("aria-label");if(P1&&O1&&P1.indexOf(O1)===-1){var Q1=P1+O1;v.data("aria-label",Q1,true);}}}}function o1(f,v,m){var r;var s;var d;if(f&&f.indexOf("{")===0){f=f.slice(1,-1);if(f.indexOf(">")!=-1){d=f.split(">");r=d[0];s=d[1];}else if(f.indexOf("&gt;")!=-1){d=f.split("&gt;");r=d[0];s=d[1];}try{f=v.getModel(r).getProperty(s);}catch(i){f=m[f][u.LABEL_KEY_V4].String;L.error("Unable to read labels from resource file",i);}}return f;}function p1(m,d){var f=U.cacheODataMetadata(m);if(!f){return undefined;}return f[d];}function q1(m,d,f){var j="",k="",r="";if(f){j=f.getText();}if(m&&(m.length>1)){for(var i=0;i<m.length-1;i++){if(k!=""){k+=", ";}k+=m[i];}k=h.getText("MEAS_DIM_TITLE",[k,m[i]]);}else if(m){k=m[0];}if(d&&(d.length>1)){for(var i=0;i<d.length-1;i++){if(r!=""){r+=", ";}r+=d[i];}r=h.getText("MEAS_DIM_TITLE",[r,d[i]]);}else if(d){r=d[0];}if(f&&(j==="")){j=h.getText("NO_CHART_TITLE",[k,r]);f.setText(j);f.data("aria-label",j,true);}}function r1(m,i){var d=1;var s;if(i){var f=N.getCurrencyInstance({style:'short',currencyCode:false,shortRefNumber:m});s=f.format(Number(d));}else{var j=N.getFloatInstance({style:'short',shortRefNumber:m});s=j.format(Number(d));}var k=s.slice(-1);return k;}function s1(v,d){v.attachSelectData(function(f){var s=l.bCRTLPressed?l.constants.explace:l.constants.inplace;l.bCRTLPressed=false;var m=v.getModel('ovpCardProperties');var B1=v.getModel();var C1=m.getProperty("/entitySet");var D1=p1(B1,C1);var E1=[],F1=[];var G1={},H1={};var I1=v.getDataset().getDimensions();var J1;for(var i=0;i<I1.length;i++){E1.push(I1[i].getName());}var K1=v.getDataset().getBinding("data").getCurrentContexts().map(function(x){return x.getObject();});if(f.getParameter("data")&&f.getParameter("data")[0]&&f.getParameter("data")[0].data){F1=Object.keys(f.getParameter("data")[0].data);J1=f.getParameter("data")[0].data._context_row_number;var L1=v.getDataset().getBinding("data").getContexts()[J1];var M1=d.getEntityNavigationEntries(L1)[0];if(K1[J1].$isOthers&&K1[J1].$isOthers===true){var N1={},O1=[];for(var j=0;j<E1.length;j++){for(var k=0;k<F1.length;k++){if(E1[j]===F1[k]){for(var P1 in D1){if(D1.hasOwnProperty(P1)){var Q1=D1[P1][u.LABEL_KEY]||D1[P1][u.NAME_KEY]||D1[P1][u.NAME_CAP_KEY];if(Q1===F1[k]){O1.push(P1);}}}}}}for(var i=0;i<O1.length;i++){N1[O1[i]]=[];for(var j=0;j<K1.length-1;j++){if(j!=J1){N1[O1[i]].push(K1[j][O1[i]]);}}}var R1={$isOthers:true};var S1={getObject:function(){return R1;},getOtherNavigationDimensions:function(){return N1;}};if(O.checkIfAPIIsUsed(d)){if(d.checkAPINavigation()){c.onContentClicked(S1);}}else{if(M1){d.doNavigation(S1,M1,s);}}}else{for(var j=0;j<E1.length;j++){for(var k=0;k<F1.length;k++){if(E1[j]===F1[k]){for(var P1 in D1){if(D1.hasOwnProperty(P1)){var Q1=(D1[P1][u.LABEL_KEY_V4]&&D1[P1][u.LABEL_KEY_V4].String)||D1[P1][u.LABEL_KEY]||D1[P1][u.NAME_KEY]||D1[P1][u.NAME_CAP_KEY];if(Q1.match(/{@i18n>.+}/gi)){var T1=this.getModel("@i18n").getResourceBundle();Q1=T1.getText(Q1.substring(Q1.indexOf(">")+1,Q1.length-1));}if(Q1===F1[k]){G1[P1]=K1[J1][P1];}}}}for(var P1 in K1[J1]){if(D1.hasOwnProperty(P1)){H1[P1]=K1[J1][P1];}}}}if(G1){n(Object.keys(G1),function(i,P1){if(D1[P1]["type"]==="Edm.String"){if(D1[P1]["sap:semantics"]==="yearmonth"||D1[P1]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){G1[P1]=(G1[P1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYMM"}).format(G1[P1]):G1[P1]);}else if(D1[P1]["sap:semantics"]==="yearquarter"||D1[P1]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){G1[P1]=(G1[P1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYQ"}).format(G1[P1]):G1[P1]);}else if(D1[P1]["sap:semantics"]==="yearweek"||D1[P1]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){G1[P1]=(G1[P1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYww"}).format(G1[P1]):G1[P1]);}}});}if(H1){n(Object.keys(H1),function(i,P1){if(D1[P1]["type"]==="Edm.String"){if(D1[P1]["sap:semantics"]==="yearmonth"||D1[P1]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){H1[P1]=(H1[P1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYMM"}).format(H1[P1]):H1[P1]);}else if(D1[P1]["sap:semantics"]==="yearquarter"||D1[P1]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){H1[P1]=(H1[P1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYQ"}).format(H1[P1]):H1[P1]);}else if(D1[P1]["sap:semantics"]==="yearweek"||D1[P1]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){H1[P1]=(H1[P1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYww"}).format(H1[P1]):H1[P1]);}}});}var U1=m.getProperty("/entityType"),V1=U1[m.getProperty('/presentationAnnotationPath')];if(U1){var W1=a.getRequestFields(V1);if(W1&&W1.length>0){n(W1,function(i,r){if(!G1.hasOwnProperty(r)){G1[r]=K1[J1][r];}});}}var S1={getObject:function(){return G1;},getAllData:function(){return H1;}};if(O.checkIfAPIIsUsed(d)){if(d.checkAPINavigation()){c.onContentClicked(S1);}}else{if(M1){d.doNavigation(S1,M1,s);}}}}});}function t1(d){if(d.EnumMember.endsWith("Bubble")){return true;}else{return false;}}function u1(d){var r=false;if(!d||d.constructor!=Array||d.length<1||d[0].constructor!=Object||!d[0].Dimension||!d[0].Dimension.PropertyPath){L.error(w.CHART_ANNO_ERROR+"in "+w.CHART_ANNO+" "+w.DIMENSIONS_MANDATORY);return r;}r=true;return r;}function v1(m){var r=false;if(!m||m.constructor!=Array||m.length<1||m[0].constructor!=Object||!m[0].Measure||!m[0].Measure.PropertyPath){L.error(w.CHART_ANNO_ERROR+"in "+w.CHART_ANNO+" "+w.MEASURES_MANDATORY);return r;}r=true;return r;}function w1(d){return d.name;}function x1(d){if(d&&d.indexOf("#")!=-1){var f=d.split("#");if(f.length>1){return f[1];}}return"";}function y1(d,v){var f=v.getModel('ovpCardProperties');var i=z1(v);var m=+i.itemsLength;var j=+f.getProperty("/dataStep");if(m&&j){var k=d.colSpan-1;if(k>=0){m+=j*k;A1(v,m);}}}function z1(v){var d=v.getModel('ovpCardProperties');var f=d.getProperty("/entityType");var i=d.getProperty("/presentationAnnotationPath");var j=f.hasOwnProperty(i)&&f[i];var m=j&&j.MaxItems;if(m){var k=m.Int32?m.Int32:m.Int;return{itemsLength:+k,dataStep:+d.getProperty("/dataStep")};}}function A1(v,d){var f,j={},k=[];var r=v.getVizType();var s=v.getModel('ovpCardProperties');var x=s.getProperty("/entityType");var B1=s.getProperty("/chartAnnotationPath");var C1=x[B1];var D1=v.getParent();var E1=D1.getBinding("data");j.path=E1.getPath();j.parameters={};if(E1.mParameters&&E1.mParameters.select){j.parameters.select=E1.mParameters.select;}j.filters=E1.aApplicationFilters;j.sorter=E1.aSorters;j.length=(r==="donut")?d+1:d;j.template=new g();D1.bindAggregation("data",j);if(r==="donut"){n(C1.MeasureAttributes,function(i,m){k.push(m.Measure.PropertyPath);});f={};f.path=E1.getPath();f.parameters={};f.parameters.select=k.join(",");f.filters=E1.aApplicationFilters;f.sorter=E1.aSorters;f.length=1;f.template=new g();D1.bindAggregation("aggregateData",f);}D1.updateBindingContext();}return{constants:u,errorMessages:w,formatItems:y,formatByType:J,returnDateFormat:K,formatChartAxes:P,hideDateTimeAxis:Q,checkExists:R,validateCardConfiguration:T,checkNoData:W,getConfig:X,hasTimeSemantics:Y,getChartType:Z,getPrimitiveValue:_,formThePathForCriticalityStateCalculation:c1,checkFlag:f1,buildVizAttributes:m1,setChartUoMTitle:n1,getMetadata:p1,getSelectedDataPoint:s1,checkBubbleChart:t1,dimensionAttrCheck:u1,measureAttrCheck:v1,getEntitySet:w1,getAnnotationQualifier:x1,reprioritizeContent:y1,getMaxItems:z1,getLabelFromAnnotationPath:o1};},true);
