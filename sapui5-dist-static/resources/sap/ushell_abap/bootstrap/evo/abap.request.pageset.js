// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["./abap.bootstrap.utils","sap/ui/thirdparty/jquery","sap/base/util/UriParameters"],function(a,q,U){"use strict";var p={},S="/sap/opu/odata/UI2/PAGE_BUILDER_PERS",b="Pages/PageChipInstances/Chip/ChipBags/ChipProperties,"+"Pages/PageChipInstances/RemoteCatalog,"+"Pages/PageChipInstances/ChipInstanceBags/ChipInstanceProperties,"+"AssignedPages,DefaultPage",c="PageSets('%2FUI2%2FFiori2LaunchpadHome')";var s=a.isSapStatisticsSet();function r(o,n){if(n){return;}var P=g(o),D=f(P);h(P,o,function(i,C,R){e(D,i,C,R);});}function g(o){var u=a.getUrlParameterValue("sap-ui2-cache-disable");if(u&&o&&o.services&&o.services.pbFioriHome){o.services.pbFioriHome["sap-ui2-cache-disable"]=u;}return d(o,"pbFioriHome",S,c,b);}function d(o,i,F,j,k){var l,m,n=false;if(o.services){if(o.services[i]){m=o.services[i];}else{m={};o.services[i]=m;n=true;}}else{m={};o.services={};o.services[i]=m;n=true;}if(!m.baseUrl||!m.relativeUrl){m.baseUrl=F;m.relativeUrl=j;n=true;}if(n){q.sap.log.warning("URL for "+i+" service not found in startup service result; fallback to default; cache invalidation might fail",null,"sap.ushell_abap.bootstrap");}if(m.baseUrl.lastIndexOf("/")!==m.baseUrl.length-1){m.baseUrl+="/";}if(m.relativeUrl[0]==="/"){m.relativeUrl=m.relativeUrl.slice(1);}l=m.baseUrl+m.relativeUrl;if(!/\$expand=/.test(l)&&k){l+=(l.indexOf("?")<0?"?":"&")+"$expand="+k;}if(m.cacheId){l+=(l.indexOf("?")<0?"?":"&")+"sap-cache-id="+m.cacheId;}if(m["sap-ui2-cache-disable"]){l+=(l.indexOf("?")<0?"?":"&")+"sap-ui2-cache-disable="+m["sap-ui2-cache-disable"];}return l;}function e(D,i,C,R){if(i===200){D.resolve(JSON.parse(R).d,C);}else{D.reject(R);}}function f(u){var D=new q.Deferred();sap.ui.require(["sap/ui/thirdparty/datajs"],function(i){OData.read.$cache=OData.read.$cache||new sap.ui2.srvc.Map();OData.read.$cache.put(u,D.promise());});return D;}function h(u,o,C){var x;x=a.createAndOpenXHR(u,o);x.setRequestHeader("X-CSRF-Token","fetch");if(s){x.setRequestHeader("sap-statistics","true");}x.onreadystatechange=function(){if(this.readyState!==4){return;}C(x.status,x.getResponseHeader("x-csrf-token"),x.responseText);};x.send();}p.requestPageSet=r;p._getAndAdjustServiceURL=d;p._getAndAdjustPageSetServiceURL=g;p._setSapStatistics=function(v){s=v;};return p;});
