//@ui5-bundle sap/collaboration/library-preload.js
/*
* ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
*/
sap.ui.predefine('sap/collaboration/components/controls/FeedEntryEmbedded',['jquery.sap.global','sap/ui/core/Control','sap/collaboration/components/utils/LanguageBundle','sap/collaboration/components/controls/PlaceholderUtility','sap/collaboration/components/utils/MediaTypeToSAPIcon','sap/m/Link','sap/ui/model/json/JSONModel','sap/m/VBox','sap/m/Image','sap/ui/core/Icon','sap/m/HBox'],function(q,C,L,P,M,a,J,V,I,b,H){"use strict";
var F=C.extend("sap.collaboration.components.controls.FeedEntryEmbedded",{metadata:{interfaces:[],library:"sap.m",properties:{"feedEntry":{type:"object",group:"data"},"serviceUrl":{type:"string",group:"data"}},events:{"atMentionClick":{parameters:{link:{type:"object"}}},"expandCollapseClick":{},"previewLoad":{}},aggregations:{}}});
F.prototype.init=function(){this.nMaxCollapsedLength=200;this.CONTENT_MAX_HEIGHT=128;this._oLangBundle=new L();this._oTimelineItemContent;q.sap.includeStyleSheet(q.sap.getModulePath("sap.collaboration.components.resources.css.EmbeddedControl",".css"));};
F.prototype.onBeforeRendering=function(){};
F.prototype.onAfterRendering=function(){this._$ExpandedTextDiv=q('#'+this.getId()+'-expanded-text');var e=this._$ExpandedTextDiv.html();if(e!=undefined){this._$ExpandedTextDiv.html(this._renderLinks(e));}if(this.oExpandLink&&this.oCollapseLink){this._$FeedEntryDiv=q('#'+this.getId());this._$CollapsedTextDiv=q('#'+this.getId()+'-collapsed-text');var c=this._$CollapsedTextDiv.html();if(c!=undefined){this._$CollapsedTextDiv.html(this._renderLinks(c));}q(this._$ExpandedTextDiv).detach();}if(this._oTimelineItemContent.getItems()[0]&&this._oTimelineItemContent.getItems()[0].getMetadata().getName()==='sap.m.Image'){var i=this._oTimelineItemContent.getItems()[0];i.getDomRef().addEventListener("load",function(){var m=this._oTimelineItemContent.getDomRef().clientWidth;var d=this.CONTENT_MAX_HEIGHT;var f=i.getDomRef().width;var g=i.getDomRef().height;var h=f/g;if(!(g<=d&&f<=m)){if(g>d){f=h*d;g=d;}if(f>m){g=m/h;f=m;}i.setWidth(f+"px");i.setHeight(g+"px");i.rerender();}this.firePreviewLoad();}.bind(this));}};
F.prototype.exit=function(){this._destroyAtMentionLinks();if(this.oExpandLink){this.oExpandLink.destroy();}if(this.oCollapseLink){this.oCollapseLink.destroy();}if(this._oTimelineItemContent){this._oTimelineItemContent.destroy();}};
F.prototype.setFeedEntry=function(f){this.setProperty("feedEntry",f);this._sText=f.Text;this._sTextWithPlaceholders=f.TextWithPlaceholders;this._destroyAtMentionLinks();this._mAtMentionsLinks={};var A=P.getAtMentionsValues(this._sText,this._sTextWithPlaceholders);for(var i=0;i<A.length;i++){this._mAtMentionsLinks[A[i].placeholder]=this._createAtMentionLink(A[i],f);}this._oTimelineItemContent=this._createTimelineItemContent();return this;};
F.prototype.getCollapsedText=function(){this.oExpandLink;this.oCollapseLink;var t=0;var T=0;var i=0;var s="";var r=/@@.\{\d+\}/;var c=this._splitByPlaceholders(this._sTextWithPlaceholders);var d=P.getAtMentionsValues(this._sText,this._sTextWithPlaceholders);do{if(r.test(c[i])){if(d[T].placeholder===c[i]){t+=d[T].value.length;s+=d[T].placeholder;T++;}}else{t+=c[i].length;s+=c[i];}i++;}while(t<=this.nMaxCollapsedLength);s=s.substring(0,this.nMaxCollapsedLength);var n=s.lastIndexOf(" ");if(n>0){this._sCollapsedTextWithPlaceholders=s.substr(0,n);}else{this._sCollapsedTextWithPlaceholders=s;}};
F.prototype.createExpandCollapseLink=function(l){var e=new a({id:this.getId()+"-"+l,text:this._oLangBundle.getText(l),press:[function(c){var s=c.getSource().getId();if(s.indexOf("-TE_MORE")>-1){q(this._$CollapsedTextDiv).detach();q(this._$ExpandedTextDiv).prependTo(this._$FeedEntryDiv);}else{q(this._$ExpandedTextDiv).detach();q(this._$CollapsedTextDiv).prependTo(this._$FeedEntryDiv);}this.fireExpandCollapseClick();},this]}).addStyleClass("alignMiddle");return e;};
F.prototype._shouldTextBeRendered=function(){var f=this.getFeedEntry();if(f.Text==undefined||f.Text==""||f.ConsolidatedCount>1||((!q.isEmptyObject(f.TargetObjectReference))&&(f.TargetObjectReference.Type=="Task"||f.TargetObjectReference.Type=="ForumItem"||f.TargetObjectReference.Type=="Event"||f.TargetObjectReference.FullPath=="ContentItem/BlogEntry"||f.TargetObjectReference.FullPath=="ContentItem/Page"||f.TargetObjectReference.FullPath=="ContentItem/Poll"))){return false;}else{return true;}};
F.prototype._shouldContentBeRendered=function(){return(this._oTimelineItemContent.getItems().length>0);};
F.prototype._splitByPlaceholders=function(t){return P.splitByPlaceholders(t);};
F.prototype._renderLinks=function(t){var r=/(^|[\s\n]|<br\/?>)((?:https?|ftp):\/\/[\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~()_|])/gi;return t.replace(r,"$1<a href='$2' target='_blank'>$2</a>");};
F.prototype._createAtMentionLink=function(p,f){var s=p.value.slice(1);var i=p.placeholder.replace(/[@a-z{}]/g,"");var m=new J({feedId:f.Id,placeholderIndex:i,placeholderValue:p.value});var l=new a({id:"at_mention_link-"+this.getId()+"-"+i,text:"{/placeholderValue}",press:[function(c){this.fireAtMentionClick({link:c.getSource()});},this]}).addStyleClass("sapCollaborationAtMentionLink");l.setModel(m);return l;};
F.prototype._destroyAtMentionLinks=function(){if(this._mAtMentionsLinks){for(var p in this._mAtMentionsLinks){if(this._mAtMentionsLinks.hasOwnProperty(p)){this._mAtMentionsLinks[p].destroy();}}this._mAtMentionsLinks=undefined;}};
F.prototype._createTimelineItemContent=function(){var t=new V(this.getId()+"-content",{}).addStyleClass("sapUiTinyMarginTopBottom");var f=this.getFeedEntry();if((!q.isEmptyObject(f.TargetObjectReference)&&f.TargetObjectReference.Type!==undefined&&f.TargetObjectReference.Type!=="FeedEntry")||f.ConsolidatedCount>1){t.addItem(this._createFeedEntryContent(f));}return t;};
F.prototype._createFeedEntryContent=function(f){var i="";var l="";var s="";if(f.ConsolidatedCount>1){i="sap-icon://documents";l=this._oLangBundle.getText("TE_CONSOLIDATED_FEED_TEXT");s=f.WebURL;}else{s=f.TargetObjectReference.WebURL;switch(f.TargetObjectReference.Type){case"ContentItem":if(f.TargetObjectReference.ContentType){if(f.TargetObjectReference.ContentType.indexOf('image')>-1){var p=new I(this.getId()+"-preview",{src:this.getServiceUrl()+"/FeedEntries('"+f.Id+"')/PreviewImage/$value",press:[function(e){window.open(s,'_blank');},this]});return p;}i=M.getSAPIconForMediaType(f.TargetObjectReference.ContentType);l=P.getContentItemName(f.Action,f.ActionWithPlaceholders);}else{switch(f.TargetObjectReference.FullPath){case"ContentItem/Poll":i="sap-icon://horizontal-bar-chart";break;case"ContentItem/Page":i="sap-icon://e-learning";break;case"ContentItem/BlogEntry":i="sap-icon://request";break;default:i="";break;}l=f.TargetObjectReference.Title;}break;case"ForumItem":i=this._getForumItemIconSrc(f.TargetObjectReference);l=f.TargetObjectReference.Title;break;case"Task":i="sap-icon://task";l=f.TargetObjectReference.Title;break;case"Event":i="sap-icon://calendar";l=f.TargetObjectReference.Title;break;default:i="sap-icon://action";l=f.TargetObjectReference.Title;break;}}var c="2.5em";var o=new b({src:i,size:c}).addStyleClass("sapUiTinyMarginBeginEnd");var d=new a({text:l,target:"_blank",href:s,tooltip:l,wrapping:true,width:"95%"}).addStyleClass("RightToLeftParenthesisStyling");var h=new H({});h.addItem(o);var v=new V({width:"100%"}).addStyleClass("sapUiTinyMarginBeginEnd");v.addItem(d);h.addItem(v);return h;};
F.prototype._getForumItemIconSrc=function(f){var s=f.FullPath;switch(s){case"ForumItem/Inquiry":case"ForumItem/Question":return"sap-icon://question-mark";case"ForumItem/Idea":return"sap-icon://lightbulb";case"ForumItem/Discussion":return"sap-icon://discussion";default:return"";}};
return F;});
sap.ui.predefine('sap/collaboration/components/controls/FeedEntryEmbeddedRenderer',["sap/ui/core/HTML"],function(H){"use strict";var F={};
F.render=function(r,f){r.write("<div");r.writeControlData(f);r.write(">");if(f._shouldTextBeRendered()){var i=f.getId();r.write("<div id='"+i+"'>");if(f._sText.length>f.nMaxCollapsedLength){f.getCollapsedText();r.write("<div id='"+i+"-collapsed-text'");r.addClass("sapUiTinyMarginBottom sapCollaborationEmbeddedText");r.writeClasses();r.write(">");this._renderText(r,f,f._sCollapsedTextWithPlaceholders);r.write("<span");r.addClass("sapCollaborationEmbeddedTextSpace");r.writeClasses();r.write("></span>");if(f.oExpandLink===undefined){f.oExpandLink=f.createExpandCollapseLink("TE_MORE");r.renderControl(f.oExpandLink);}else{r.renderControl(f.oExpandLink);}r.write("</div>");r.write("<div id='"+i+"-expanded-text'");r.addClass("sapUiTinyMarginBottom sapCollaborationEmbeddedText");r.writeClasses();r.write(">");this._renderText(r,f,f._sTextWithPlaceholders);r.write("<span");r.addClass("sapCollaborationEmbeddedTextSpace");r.writeClasses();r.write("></span>");if(f.oCollapseLink===undefined){f.oCollapseLink=f.createExpandCollapseLink("TE_LESS");r.renderControl(f.oCollapseLink);}else{r.renderControl(f.oCollapseLink);}r.write("</div>");}else{r.write("<div id='"+i+"-expanded-text'");r.addClass("sapUiTinyMarginBottom sapCollaborationEmbeddedText");r.writeClasses();r.write(">");this._renderText(r,f,f._sTextWithPlaceholders);r.write("</div>");}r.write("</div>");}if(f._shouldContentBeRendered()){r.renderControl(f._oTimelineItemContent);}r.write("</div>");};
F._renderText=function(r,f,t){var T=f._splitByPlaceholders(t);for(var i=0;i<T.length;i++){var a=/@@.\{\d+\}/;if(a.test(T[i])){r.renderControl(f._mAtMentionsLinks[T[i]]);}else if(f.getProperty("feedEntry").ContentType==="text/html"){var h="<span>"+T[i]+"</span>";var d=jQuery.parseHTML(h)[0];var $=jQuery(d).find("a");if($.length!==0){$.attr("target","_blank");h=d.outerHTML;}r.renderControl(new H({content:h,sanitizeContent:true}));}else{r.writeEscaped(T[i],true);}}};
return F;},true);
sap.ui.predefine('sap/collaboration/components/controls/FilterPopover',['sap/ui/core/Control','sap/m/List','sap/m/library','sap/m/ResponsivePopover','sap/ui/base/ManagedObject'],function(C,L,m,R,M){"use strict";var P=m.PlacementType;var a=m.ListMode;
var F=C.extend("sap.collaboration.components.controls.FilterPopover",{metadata:{interfaces:[],library:"sap.collaboration.components.controls.FilterPopover",properties:{title:{type:"string",group:"Appearance",defaultValue:null},noDataText:{type:"string",group:"Appearance",defaultValue:null},},events:{selectionChange:{parameters:{listItem:{type:"sap.m.ListItemBase"},}},},defaultAggregation:"items",aggregations:{items:{type:"sap.m.ListItemBase",multiple:true,singularName:"item",bindable:"bindable"},}}});
F.prototype.init=function(){this._oList=new L(this.getId()+"-list",{mode:a.SingleSelectMaster,includeItemInSelection:true,selectionChange:[this._selectionChange,this]});this._oResponsivePop=new R(this.getId()+"-popover",{placement:P.Auto,contentWidth:"15rem",content:[this._oList]});};
F.prototype.exit=function(){this._oList=null;if(this._oResponsivePop){this._oResponsivePop.destroy();this._oResponsivePop=null;}};
F.prototype.openBy=function(c){this._oResponsivePop.openBy(c);return this;};
F.prototype.setTitle=function(t){this.setProperty("title",t,true);this._oResponsivePop.setTitle(t);return this;};
F.prototype.setNoDataText=function(n){this.setProperty("noDataText",n,true);this._oList.setNoDataText(n);return this;};
F.prototype.setSelectedItem=function(l){this._oList.setSelectedItem(l);return this;};
F.prototype.getSelectedItem=function(){return this._oList.getSelectedItem();};
F.prototype._setModel=F.prototype.setModel;
F.prototype.setModel=function(o,s){var A=Array.prototype.slice.call(arguments);this._oResponsivePop.setModel(o,s);F.prototype._setModel.apply(this,A);return this;};
F.prototype.bindAggregation=function(){var b=Array.prototype.slice.call(arguments);this._callMethodInManagedObject.apply(this,["bindAggregation"].concat(b));return this;};
F.prototype.validateAggregation=function(A,o,b){return this._callMethodInManagedObject("validateAggregation",A,o,b);};
F.prototype.setAggregation=function(A,o,s){this._callMethodInManagedObject("setAggregation",A,o,s);return this;};
F.prototype.getAggregation=function(A,d){return this._callMethodInManagedObject("getAggregation",A,d);};
F.prototype.indexOfAggregation=function(A,o){return this._callMethodInManagedObject("indexOfAggregation",A,o);};
F.prototype.insertAggregation=function(A,o,i,s){this._callMethodInManagedObject("insertAggregation",A,o,i,s);return this;};
F.prototype.addAggregation=function(A,o,s){this._callMethodInManagedObject("addAggregation",A,o,s);return this;};
F.prototype.removeAggregation=function(A,o,s){this._callMethodInManagedObject("removeAggregation",A,o,s);return this;};
F.prototype.removeAllAggregation=function(A,s){return this._callMethodInManagedObject("removeAllAggregation",A,s);};
F.prototype.destroyAggregation=function(A,s){this._callMethodInManagedObject("destroyAggregation",A,s);return this;};
F.prototype._callMethodInManagedObject=function(f,A){var b=Array.prototype.slice.call(arguments);if(A==="items"){return this._oList[f].apply(this._oList,b.slice(1));}else{return M.prototype[f].apply(this,b.slice(1));}};
F.prototype._selectionChange=function(c){this._oResponsivePop.close();var s=c.getParameter("listItem");this.fireSelectionChange({listItem:s});};
return F;});
sap.ui.predefine('sap/collaboration/components/controls/PlaceholderUtility',['sap/ui/base/Object'],function(B){"use strict";var c="sap.collaboration.components.controls.PlaceholderUtility";var a=/@@.\{\d+\}/;var b=/@@[o]\{\d+\}/;var p=B.extend(c,{});
p.getAtMentionsValues=function(t,T){var P=new RegExp(a);var s=this.splitByPlaceholders(T);var d=t;var e=[];var f=0;for(var i=0;i<s.length;i++){var g=s[i];if(P.test(g)==true){var n=s[i+1];var h="";if(n==""){var j=s[i+2];if(j==undefined){h=d;d=d.slice(d.indexOf(n));}else if(P.test(j)==true){h=this._findFirstPlaceholderValueInText(d);d=d.slice(h.length);}}else if(n==" "){h=this._findFirstPlaceholderValueInText(d);d=d.slice(h.length);}else{h=d.slice(0,d.indexOf(n));d=d.slice(d.indexOf(n));}if(!P.test(h)){e.push({placeholder:"@@m{"+f+"}",value:h});f++;}}else{d=d.slice(g.length);}}return e;};
p.getContentItemName=function(A,s){var d=A;var e=s.split(b);for(var i=0;i<e.length;i++){d=d.replace(e[i],"");}var C=d.trim();return C;};
p.splitByPlaceholders=function(t){var s=[];if(t){var d=/@@.\{\d+\}/g;var S=t.split(d);var P=t.match(d);var e=P==null?0:P.length;for(var i=0;i<S.length+e;i++){if(i%2==0){s.push(S[i/2]);}else{s.push(P[Math.floor(i/2)]);}}}return s;};
p._findFirstPlaceholderValueInText=function(t){var P;if(t.search(a)==0){P=t.match(a)[0];}else{P=t[0]+t[1];for(var i=2;i<t.length;i++){if(t[i]==="\u200E"||t[i]==="\u200F"||t[i]==='@'){break;}P+=t[i];}}P=P.trim();return P;};
Object.freeze(p);return p;},true);
sap.ui.predefine('sap/collaboration/components/controls/ReplyPopover',["jquery.sap.global","../utils/LanguageBundle","sap/ui/Device","sap/ui/core/Control","sap/ui/core/library","sap/ui/core/mvc/View","sap/ui/model/json/JSONModel","sap/m/App","sap/m/Bar","sap/m/Button","sap/m/FeedListItem","sap/m/Label","sap/m/library","sap/m/Link","sap/m/List","sap/m/Page","sap/m/ResponsivePopover"],function(q,L,D,C,c,V,J,A,B,a,F,b,m,d,e,P,R){"use strict";var f=c.mvc.ViewType;var g=m.ListSeparators;var h=m.PlacementType;q.sap.includeStyleSheet(q.sap.getModulePath("sap.collaboration.components.resources.css.SocialProfile",".css"));q.sap.includeStyleSheet(q.sap.getModulePath("sap.collaboration.components.resources.css.ReplyPopover",".css"));
var j=C.extend("sap.collaboration.components.controls.ReplyPopover",{metadata:{library:"sap.collaboration",events:{postReplyPress:{parameters:{value:{type:"string"}}},moreRepliesPress:{},afterClose:{},},aggregations:{socialTextArea:{type:"sap.collaboration.components.controls.SocialTextArea",multiple:false},}},});
j.prototype.init=function(){this._oLangBundle=new L();this._oJSONModelData=[];this._oJSONModel=new J(this._oJSONModelData);this._oControlToReceiveFocus;this._oSocialProfileView;this._oReplyApp;this._oReplyPage;this._oReplyTextArea;this._oReplyList;this._oReplyButton;this._oReplyHeaderBar;this._oReplyPopover=this._oReplyPopover||this._createReplyPopover();};
j.prototype.exit=function(){if(this._oReplyPopover){this._oReplyPopover.destroy();}};
j.prototype.addReply=function(r){if(!q.isEmptyObject(r)){if(r.Text){r.Text=this._replaceCarriageReturnWithBRTag(r.Text);}this._oJSONModelData.push(r);this._oJSONModel.setData(this._oJSONModelData,true);}else{this._oReplyTextArea.focus();}};
j.prototype.addReplies=function(r){var k=r&&r.data;if(k&&k.length!==0){var l=this._oReplyList.getItems().length;var n=k.length;for(var i=0;i<k.length;i++){if(k[i].Text){k[i].Text=this._replaceCarriageReturnWithBRTag(k[i].Text);k[i].Text="\u200E"+k[i].Text+"\u200E";}}this._oJSONModelData=k.concat(this._oJSONModelData);this._oJSONModel.setData(this._oJSONModelData,true);if(l!==0){this._oControlToReceiveFocus=this._oReplyList.getItems()[n];}if(r.more){this._oShowMoreBar.setVisible(true);}else{this._oShowMoreBar.setVisible(false);}}};
j.prototype.openBy=function(o){if(!this._oReplyTextArea){this._oReplyTextArea=this.getSocialTextArea();this._oReplyTextArea.addStyleClass("replyTextAreaToBottom").addStyleClass("replyTextArea");this._oControlToReceiveFocus=this._oReplyTextArea;this._oReplyPage.addContent(this._oShowMoreBar).addContent(this._addList()).addContent(this._oReplyTextArea);this._oReplyPopover.setInitialFocus(this._oReplyTextArea);}this._oReplyPopover.openBy(o);return this;};
j.prototype.setBusyIndicatorDelay=function(i){this._oReplyPage.setBusyIndicatorDelay(i);return this;};
j.prototype.setBusy=function(i){this._oReplyPage.setBusy(i);return this;};
j.prototype.getTextArea=function(){return this._oReplyTextArea;};
j.prototype._createReplyPopover=function(){var r=new R({showHeader:false,placement:h.Vertical,contentWidth:"25rem",contentHeight:"455px",content:this._addApp(),afterClose:[function(){this._oReplyApp.backToTop();this._oReplyList.destroyItems();this._oJSONModelData=[];this._oJSONModel.setData(this._oJSONModelData);this._oShowMoreBar.setVisible(false);this._oControlToReceiveFocus=this._oReplyTextArea;this.fireAfterClose();},this]});return r;};
j.prototype._addList=function(){var t=this;var r=new F({text:"{Text}",icon:"{Creator/ThumbnailImage}",sender:"{Creator/FullName}",timestamp:"{CreatedAt}",iconActive:false,senderPress:function(E){var o=E.getSource().getBindingContext().getObject();var M=o.Creator.Email;t._oSocialProfileView.getViewData().memberId=M;t._oSocialProfileView.rerender();t._oReplyApp.to(t._oSocialProfilePage);}}).addStyleClass("replyFeedListItem");if(!this._oReplyList){this._oReplyList=new e({width:"100%",items:[],noDataText:this._oLangBundle.getText("ST_REPLY_LIST_AREA"),showNoData:true,showSeparators:g.None,updateFinished:function(E){var l=t._oReplyList.getItems().length;if(l!==0&&t._oControlToReceiveFocus===t._oReplyTextArea){t._oReplyList.getItems()[l-1].focus();}if(t._oReplyList.getItems().length===0){t._oReplyTextArea.addStyleClass("replyTextAreaToBottom");t._oReplyTextArea._oPop.setOffsetX(0);}else{var i=q(t._oReplyList.getDomRef()).height();var k=q(t._oReplyPopover.getDomRef("cont")).height();var n=q(t._oReplyPage.getCustomHeader().getDomRef()).height();var o=parseInt(t._oReplyTextArea.getHeight());var p=q(t._oReplyPage.getFooter().getDomRef()).height();if(i>(k-n-o-p)){t._oReplyTextArea.removeStyleClass("replyTextAreaToBottom");t._oReplyTextArea._oPop.setOffsetX(9);}else{t._oReplyTextArea.addStyleClass("replyTextAreaToBottom");t._oReplyTextArea._oPop.setOffsetX(0);}}t._oControlToReceiveFocus.focus();}});}this._oReplyList.setModel(this._oJSONModel);this._oReplyList.bindItems({path:"/",template:r});return this._oReplyList;},j.prototype._addSocialProfile=function(){var t=this;this._oSocialProfileView=new sap.ui.view({viewData:{langBundle:this._oLangBundle,popoverPrefix:this.getId(),afterUserInfoRetrieved:function(u){if(u){t._sUserProfileURL=u.WebURL;}}},type:f.JS,viewName:"sap.collaboration.components.socialprofile.SocialProfile"});return this._oSocialProfileView;},j.prototype.enableButton=function(i){this._oReplyButton.setEnabled(i);};
j.prototype._addApp=function(){var t=this;if(this._oReplyApp){return this._oReplyApp;}this._oReplyButton=new a({text:this._oLangBundle.getText("ST_REPLY_POST"),enabled:false,press:this._postReply.bind(t)});this._oShowMoreLink=new d({text:this._oLangBundle.getText("ST_SHOW_MORE_REPLIES"),press:this._showMoreReplies.bind(t)});this._oShowMoreBar=new B({contentMiddle:[this._oShowMoreLink],visible:false}).addStyleClass("showMoreReplies");this._oReplyPage=new P({showHeader:true,showSubHeader:false,showFooter:true,customHeader:new B({contentMiddle:[new b({text:this._oLangBundle.getText("ST_REPLY_TITLE")})]}),footer:new B({contentRight:[this._createMentionButton(),this._oReplyButton]}),});this._oSocialProfileButton=new a({text:this._oLangBundle.getText("SP_OPEN_JAM_BUTTON"),press:function(){window.open(t._sUserProfileURL,"_blank");}});this._oSocialProfilePage=new P({title:this._oLangBundle.getText("SP_TITLE"),showNavButton:true,showHeader:true,showSubHeader:false,showFooter:true,navButtonPress:function(E){t._oReplyApp.back();},footer:new B({contentRight:[this._oSocialProfileButton]}),content:[this._addSocialProfile()]});this._oReplyApp=new A({backgroundColor:"#ffffff",pages:[this._oReplyPage,this._oSocialProfilePage]});return this._oReplyApp;};
j.prototype._createMentionButton=function(){if(D.system.phone){return;}var M=new a({text:"@",tooltip:this._oLangBundle.getText("ST_MENTION_TOOLTIP"),press:[function(){this._oReplyTextArea.atMentionsButtonPressed();},this]});return M;};
j.prototype._replaceCarriageReturnWithBRTag=function(t){var s;if(typeof t==="string"){s=t.replace(/[\n\r]/g,'<br>');}return s;};
j.prototype._postReply=function(){var v=this._oReplyTextArea.convertTextWithFullNamesToEmailAliases();this.firePostReplyPress({value:v});this._oControlToReceiveFocus=this._oReplyTextArea;};
j.prototype._showMoreReplies=function(){this.fireMoreRepliesPress();};
return j;});
sap.ui.predefine('sap/collaboration/components/controls/SocialTextArea',['jquery.sap.global','sap/ui/model/json/JSONModel','sap/m/TextArea','sap/m/Popover','sap/m/List','sap/m/StandardListItem','./SuggestionUtility','../utils/LanguageBundle','sap/m/library','sap/ui/Device'],function(q,J,T,P,L,S,a,b,m,D){var c=m.ListSeparators;var d=m.ListMode;var e=m.PlacementType;q.sap.includeStyleSheet(q.sap.getResourcePath("sap/collaboration/components/resources/css/SocialTextArea",".css"));
var f=T.extend("sap.collaboration.components.controls.SocialTextArea",{
metadata:{library:"sap.collaboration",properties:{initialValue:{type:"string",group:"Data",defaultValue:null},enableNotifyAll:{type:"boolean",group:"Behavior",defaultValue:true},suggestionPlacement:{type:"sap.m.PlacementType",group:"Misc",defaultValue:e.VerticalPreferedBottom},suggestionHeight:{type:"sap.ui.core.CSSSize",group:"Appearance"},},events:{suggest:{parameters:{value:{type:"string"}}},afterSuggestionClose:{}}},
renderer:{}
});
f.prototype.init=function(){T.prototype.init.apply(this);this.addStyleClass("sapCollaborationSocialTextArea");this._sTextAreaOldValue="";this._sTextAreaCurrentValue="";this._aAtMentionBuffer=[];this._mCurrentAtMention=undefined;this._oModel=new J();var s=new S({title:"{fullName}",description:"{email}",icon:"{userImage}"});this._oList=new L(this.getId()+"-list",{mode:d.SingleSelectMaster,rememberSelections:false,showSeparators:c.None}).setModel(this._oModel).bindItems("/",s);this._oPop=new P(this.getId()+"-pop",{showHeader:false,showArrow:false,content:[this._oList],}).setInitialFocus(this);this._oSuggestionUtil=a;this._oLangBundle=new b();this._oList.attachSelectionChange(this.onSelectionChange.bind(this));};
f.prototype.exit=function(){this._oPop.destroy();this._oPop=undefined;this._oSuggestionUtil=undefined;};
f.prototype.onBeforeRendering=function(){this._oPop.setPlacement(this.getSuggestionPlacement());this.getEnableNotifyAll()?this._oList.setProperty("noDataText",this._oLangBundle.getText("ST_NO_SUGGESTIONS",["@@notify"])):this._oList.setProperty("noDataText",this._oLangBundle.getText("ST_ADD_POST_NO_SUGGESTIONS"));};
f.prototype.onAfterRendering=function(){T.prototype.onAfterRendering.apply(this);this._oPop.setContentWidth((q(this.getDomRef()).width()).toString()+"px");var E=q("#"+this.getId()).children()[0];if(E){q("#"+E.id).css({'height':'100%'});}q("#"+this.getId()).css({'padding-top':'0','padding-bottom':'0'});};
f.prototype.oninput=function(g){T.prototype.oninput.apply(this,[g]);if(g.isMarked("invalid")){return;}this._sTextAreaCurrentValue=this.getValue();if(this._sTextAreaCurrentValue.trim()===""){this._aAtMentionBuffer=[];this.closeSuggestionPopover();}else{this._triggerSuggestions(this._sTextAreaCurrentValue,this._sTextAreaOldValue);}this._sTextAreaOldValue=this._sTextAreaCurrentValue;};
f.prototype.onSelectionChange=function(g){var l=g.getParameter("listItem");var F=l.getProperty("title");var E=l.getProperty("description");this._sTextAreaCurrentValue=this._oSuggestionUtil.getTextAreaValueAfterSuggestionSelected(F,E,this._mCurrentAtMention,this._aAtMentionBuffer,this._sTextAreaCurrentValue,F==="@@notify");this.setValue(this._sTextAreaCurrentValue);this._sTextAreaOldValue=this._sTextAreaCurrentValue;this.closeSuggestionPopover();this.selectText(this._mCurrentAtMention.endIndex+2,this._mCurrentAtMention.endIndex+2);this._oList.removeSelections();};
f.prototype.showSuggestions=function(s){if(s.length!==0&&s[s.length-1].fullName!=="@@notify"&&this.getEnableNotifyAll()){s.push({fullName:"@@notify",email:this._oLangBundle.getText("ST_ATATNOTIFY_DESCRIPTION"),userImage:"sap-icon://world"});}if(s.length!==0){this._oPop.close();}this._oModel.setData(s);this._oPop.openBy(this);return this;};
f.prototype.setInitialValue=function(t){this.setProperty("initialValue",t,true);this.setValue(t);this._aAtMentionBuffer=[];this._sTextAreaCurrentValue=t;this._sTextAreaOldValue=t;return this;};
f.prototype.setSuggestionHeight=function(h){this.setProperty("suggestionHeight",h,true);this._oPop.setContentHeight(h);return this;};
f.prototype.closeSuggestionPopover=function(){this._oPop.close();this.fireAfterSuggestionClose();return this;};
f.prototype.clearText=function(){this._sTextAreaCurrentValue="";this._sTextAreaOldValue="";this._aAtMentionBuffer=[];this.setValue("");return this;};
f.prototype.convertTextWithFullNamesToEmailAliases=function(){return this._oSuggestionUtil.convertTextWithFullNamesToEmailAliases(this.getValue(),this._aAtMentionBuffer);};
f.prototype.atMentionsButtonPressed=function(){var C=this.getDomRef("inner").selectionStart;var A=this._oSuggestionUtil.atMentionsButtonPressed(this.getValue(),C);this.setValue(A.newValue);this._sTextAreaCurrentValue=this.getValue();this.focus();this.selectText(A.cursorPosition,A.cursorPosition);this._triggerSuggestions(this._sTextAreaCurrentValue,this._sTextAreaOldValue);this._sTextAreaOldValue=this._sTextAreaCurrentValue;return this;};
f.prototype._triggerSuggestions=function(t,g){if(!D.system.phone){var o=this._oSuggestionUtil.getChangesInTextArea(t,g);if(o.operation==="addChar"){this._handleAddedCharacters(o,t);}else if(o.operation==="deleteChar"){this._handleDeletedCharacters(o,t,this._aAtMentionBuffer);}}};
f.prototype._handleAddedCharacters=function(t,g){var h=t.changeIndex;var s=t.charactersChanged;var A=this._aAtMentionBuffer.length;var I=this.getEnableNotifyAll();if(I&&s[0]==="@"&&g[h-1]==="@"&&(g[h-2]===" "||g[h-2]==="\n"||g[h-2]===undefined)){this.showSuggestions([{fullName:"@@notify",email:this._oLangBundle.getText("ST_ATATNOTIFY_DESCRIPTION"),userImage:"sap-icon://world"}]);for(var i=0;i<A;i++){if(this._aAtMentionBuffer[i].startIndex===h-1){this._aAtMentionBuffer[i].endIndex+=s.length;}else if(h<this._aAtMentionBuffer[i].startIndex){this._oSuggestionUtil.maintainAtMentionIndices(this._aAtMentionBuffer[i],s.length);}}}else if(s[0]==="@"||(s[0]===" "&&s[1]==="@")){if(s[1]==="@"){h+=1;}var C=this._oSuggestionUtil.addToAtMentionBuffer(this._aAtMentionBuffer,h,s);this._mCurrentAtMention=this._aAtMentionBuffer[C];if(s==="@ "){this._mCurrentAtMention.endIndex-=1;}var j=g[this._mCurrentAtMention.startIndex-1];var n=this._mCurrentAtMention.endIndex+1;if(j===" "||j===undefined||j==='\n'){var N=g[n];while(N!==" "&&N!==undefined&&N!=='\n'){n+=1;N=g[n];}this._mCurrentAtMention.endIndex=n-1;this.fireSuggest({value:g.substring(h+1,n)});}else{this.closeSuggestionPopover();}}else{for(var i=A-1;i>=0;i--){if(h>this._aAtMentionBuffer[i].startIndex){var k=this._oSuggestionUtil.getStringAfterAtMention(h+s.length-1,g,this._aAtMentionBuffer[i]);var l=this._oSuggestionUtil.getStringBeforeAtMention(this._aAtMentionBuffer[i],g,h);var Q=l+s+k;var r=new RegExp("^"+Q);if(I&&r.test("@notify")){this._aAtMentionBuffer[i].endIndex=this._aAtMentionBuffer[i].endIndex+s.length;this._mCurrentAtMention=this._aAtMentionBuffer[i];this.showSuggestions([{fullName:"@@notify",email:this._oLangBundle.getText("ST_ATATNOTIFY_DESCRIPTION"),userImage:"sap-icon://world"}]);}else if(!Q.match(/ /g)||(Q.match(/ /g)&&Q.match(/ /g).length===1)){if((this._aAtMentionBuffer[i].atMentioned===true||this._aAtMentionBuffer[i].notifyAll===true)&&h<=this._aAtMentionBuffer[i].endIndex){var o=this._aAtMentionBuffer[i].startIndex;var p=g.slice(0,o)+" "+g.slice(o+1,g.length);this.setValue(p);this._sTextAreaCurrentValue=p;this._aAtMentionBuffer.splice(i,1);this.selectText(h+1,h+1);this.closeSuggestionPopover();}else if(Q.search("\n")===-1&&Q.search("@")===-1){this._aAtMentionBuffer[i].endIndex=this._aAtMentionBuffer[i].startIndex+Q.length;this._mCurrentAtMention=this._aAtMentionBuffer[i];var j=g[this._mCurrentAtMention.startIndex-1];if(j===" "||j===undefined||j==='\n'){this.fireSuggest({value:Q});}}else{this.closeSuggestionPopover();}}else{this.closeSuggestionPopover();}break;}this._oSuggestionUtil.maintainAtMentionIndices(this._aAtMentionBuffer[i],s.length);if(i===0){this.closeSuggestionPopover();}}}};
f.prototype._handleDeletedCharacters=function(t,g){var i=t.changeIndex;var s=t.charactersChanged;var C=undefined;var A=this._oSuggestionUtil.isDeletedCharPartOfAtMentioned(this._aAtMentionBuffer,i);if(A!==undefined){if(this._aAtMentionBuffer[A].atMentioned===true||this._aAtMentionBuffer[A].notifyAll===true){this.closeSuggestionPopover();this._sTextAreaCurrentValue=this._sTextAreaCurrentValue.substr(0,this._aAtMentionBuffer[A].startIndex)+this._sTextAreaCurrentValue.substr(this._aAtMentionBuffer[A].endIndex-t.numberOfCharsChanged+1);this.setValue(this._sTextAreaCurrentValue);this.selectText(this._aAtMentionBuffer[A].startIndex,this._aAtMentionBuffer[A].startIndex);this._sTextAreaOldValue=this._sTextAreaCurrentValue;C=1+this._aAtMentionBuffer[A].endIndex-this._aAtMentionBuffer[A].startIndex;this._aAtMentionBuffer.splice(A,1);}else{C=t.numberOfCharsChanged;var h=g[this._aAtMentionBuffer[A].startIndex-1];if(s.search("@")!==-1&&g[t.changeIndex-1]!=="@"){this.closeSuggestionPopover();this._aAtMentionBuffer.splice(A,1);}else if(h===" "||h===undefined||h==='\n'){this._aAtMentionBuffer[A].endIndex-=C;var v=g.substring(this._aAtMentionBuffer[A].startIndex+1,this._aAtMentionBuffer[A].endIndex+1);var r=new RegExp("^"+v);if(v!==""&&r.test("@notify")){this.showSuggestions([{fullName:"@@notify",email:this._oLangBundle.getText("ST_ATATNOTIFY_DESCRIPTION"),userImage:"sap-icon://world"}]);}else{this.fireSuggest({value:v});}}}}A=A||0;C=C||t.numberOfCharsChanged;for(var j=A;j<this._aAtMentionBuffer.length;j++){if(i<this._aAtMentionBuffer[j].startIndex){this._oSuggestionUtil.maintainAtMentionIndices(this._aAtMentionBuffer[j],-C);}}};
return f;});
sap.ui.predefine('sap/collaboration/components/controls/SuggestionUtility',["sap/ui/base/Object"],function(B){"use strict";
var S=B.extend("sap.collaboration.components.controls.SuggestionUtility",{});
S.maintainAtMentionIndices=function(a,l){a.startIndex=a.startIndex+l;a.endIndex=a.endIndex+l;};
S.getChangesInTextArea=function(t,a){if(a!==""){var l=t.length>a.length?t.length:a.length;var c=Math.abs(t.length-a.length);var g=function(c,s){return t.substring(s,s+c);};var G=function(c,s){return a.substring(s,s+c);};for(var i=0;i<l;i++){if(t[i]!==a[i]){return t.length>a.length?{operation:"addChar",charactersChanged:g(c,i),changeIndex:i,numberOfCharsChanged:c}:{operation:"deleteChar",charactersChanged:G(c,i),changeIndex:i,numberOfCharsChanged:c};}}}else{return{operation:"addChar",charactersChanged:t,changeIndex:0};}};
S.convertTextWithFullNamesToEmailAliases=function(v,a){var t="";var b=a.length;var s=0;if(b!==0){for(var i=0;i<b;i++){if(a[i].atMentioned){var e="@"+a[i].email.split("@")[0];t=t+v.substring(s,a[i].startIndex)+e;}else{t=t+v.substring(s,a[i].endIndex+1);}s=a[i].endIndex+1;}t=t+v.substring(a[b-1].endIndex+1,v.length);return t;}return v;};
S.getStringAfterAtMention=function(i,t,a){var s="";var b=i;function c(){while(t[b+1]!==" "&&t[b+1]!==undefined&&t[b+1]!=='\n'){s=s.concat(t[b+1]);b+=1;}}c();if(a.atMentioned&&t[b+1]===" "&&t[b+1]<=a.endIndex){s=s.concat(t[b+1]);b+=1;c();}return s;};
S.getStringBeforeAtMention=function(a,t,b){var s=t.substring(a.startIndex+1,b);return s;};
S.addToAtMentionBuffer=function(a,t,b){var A=0;var c=a.length;if(c===0){a.push({startIndex:t,endIndex:t+b.length-1,atMentioned:false});A=0;}else{for(var i=0;i<c;i++){if(t<=a[i].startIndex){this.maintainAtMentionIndices(a[i],b.length);}}for(var i=c-1;i>=0;i--){if(t>a[i].startIndex){a.splice(i+1,0,{startIndex:t,endIndex:t+b.length-1,atMentioned:false});A=i+1;break;}else if(i===0){a.splice(0,0,{startIndex:t,endIndex:t+b.length-1,atMentioned:false});A=0;}}}return A;};
S.isDeletedCharPartOfAtMentioned=function(a,t){var A=a.length;for(var i=0;i<A;i++){if(t>=a[i].startIndex&&t<=a[i].endIndex){return i;}}};
S.getTextAreaValueAfterSuggestionSelected=function(f,e,c,a,t,n){var s=c.startIndex;var b=c.endIndex;var d=t.length;var N;var A="@notify";if(n){N=t.substr(0,s+1)+A+" "+t.substr(b+1);c.endIndex=s+A.length;c.notifyAll=true;}else{N=t.substr(0,s+1)+f+" "+t.substr(b+1);c.endIndex=s+f.length;c.atMentioned=true;c.email=e;}var g=N.length;var D=g-d;var I=a.indexOf(c);for(var i=I+1;i<a.length;i++){this.maintainAtMentionIndices(a[i],D);}return N;};
S.atMentionsButtonPressed=function(t,c){var C;var T=t.slice(0,c);var s=t.slice(c,t.length);var a="";if(t[c-1]===" "||t[c-1]==="\n"||t[c-1]===undefined){a="@";C=c+1;}else{a=" @";C=c+2;}var n=T+a+s;return{newValue:n,cursorPosition:C};};
return S;});
sap.ui.predefine('sap/collaboration/components/controls/TimelineEntryEmbedded',['jquery.sap.global','sap/ui/core/Control','sap/collaboration/components/utils/LanguageBundle','sap/m/Text','sap/m/Link','sap/m/List','sap/m/FeedListItem','sap/m/Popover','sap/m/library'],function(q,C,L,T,a,b,F,P,m){"use strict";var c=m.PlacementType;
var d=C.extend("sap.collaboration.components.controls.TimelineEntryEmbedded",{metadata:{interfaces:[],library:"sap.m",properties:{"timelineEntry":{type:"object",group:"data"}},events:{},aggregations:{}}});
d.prototype.init=function(){this._oLangBundle=new L();q.sap.includeStyleSheet(q.sap.getModulePath("sap.collaboration.components.resources.css.EmbeddedControl",".css"));this._aTimelineItemTextDisplay;};
d.prototype.onBeforeRendering=function(){if(!this._aTimelineItemTextDisplay){this._createTimelineItemText();}};
d.prototype.exit=function(){if(this._aTimelineItemTextDisplay){this._aTimelineItemTextDisplay.forEach(function(o){o.destroy();});}if(this._oPopover){this._oPopover.destroy();}};
d.prototype._getTimelineItemTextControls=function(){return this._aTimelineItemTextDisplay;};
d.prototype._createTimelineItemText=function(){var t=this.getTimelineEntry();this._aTimelineItemTextDisplay=[];if(t.timelineEntryDetails!=undefined&&t.timelineEntryDetails.length>0){var f=this._parseTimelineEntryDetail(t.timelineEntryDetails[0]);this._aTimelineItemTextDisplay.push(new T({text:f+" "}).addStyleClass("alignMiddle"));if(t.timelineEntryDetails.length>1){var l=this._createTLEntryDetailsLink(t.timelineEntryDetails).addStyleClass("alignMiddle");this._aTimelineItemTextDisplay.push(l);}}else{this._aTimelineItemTextDisplay.push(new T({text:t.text}).addStyleClass("alignMiddle"));}};
d.prototype._renderTimelineItemText=function(r){var s="&nbsp;";if(this._aTimelineItemTextDisplay.length>0){r.write("<div");r.writeControlData(this);r.write(">");for(var i=0;i<this._aTimelineItemTextDisplay.length;i++){var e=this._aTimelineItemTextDisplay[i].getMetadata().getName();switch(e){case"sap.m.Text":var t=this._aTimelineItemTextDisplay[i].getText();if(t.search(/\s/)==0){var f=t.search(/\S/);do{r.write(s);f--;}while(f>0);}r.renderControl(this._aTimelineItemTextDisplay[i]);if(t[t.length-1]==" "){var g=t.length-1;var h=t[g];do{r.write(s);h=t[--g];}while(h==" "&&h!=undefined);}break;case"sap.m.Link":case"sap.ui.core.HTML":default:r.renderControl(this._aTimelineItemTextDisplay[i]);}}r.write("</div>");}};
d.prototype._createTLEntryDetailsLink=function(t){var e=this;var A=t.length-1;var l=this._oLangBundle.getText("TE_LINK_TEXT",A);var o=new a(this.getId()+"_PopoverLink",{text:l});o.attachPress(function(){if(!e._oPopover){e._oPopover=e._createTLEntryDetailsPopover(t);}e._oPopover.openBy(o);});return o;};
d.prototype._createTLEntryDetailsPopover=function(t){var o=new b(this.getId()+"_ChangeList",{inset:false});for(var e in t){var E=this._parseTimelineEntryDetail(t[e]);var l=new F({text:E,showIcon:false});o.addItem(l);}var S="20em";var p=new P(this.getId()+"_Popover",{contentWidth:S,placement:c.Auto,title:this._oLangBundle.getText("TE_DETAILS_POPOVER_HEADER")+"("+t.length+")",content:[o]});return p;};
d.prototype._parseTimelineEntryDetail=function(D){var t="";switch(D.changeType){case"U":t=this._oLangBundle.getText("TE_DETAILS_CHANGED",[D.propertyLabel,D.beforeValue,D.afterValue]);break;case"I":t=this._oLangBundle.getText("TE_DETAILS_SET",[D.propertyLabel,D.afterValue]);break;case"D":t=this._oLangBundle.getText("TE_DETAILS_CLEARED",[D.propertyLabel,D.beforeValue]);break;}return t;};
return d;});
sap.ui.predefine('sap/collaboration/components/controls/TimelineEntryEmbeddedRenderer',[],function(){var T={};
T.render=function(r,t){var n=t._getTimelineItemTextControls().length;if(n>0){t._renderTimelineItemText(r);}};
return T;},true);
sap.ui.predefine('sap/collaboration/components/feed/BOMode',["./Mode","sap/collaboration/components/utils/PendingRequestsUtil","sap/ui/model/odata/ODataModel"],function(M,P,O){"use strict";
var B=M.extend("sap.collaboration.components.feed.BOMode",{constructor:function(f){M.apply(this,[f]);this._sJamBOId=undefined;this._oPendingRequestsUtil=new P();this._oSMIModel=this._oFeedController.getModel("smi");this._oLanguageBundle=this._oFeedController.getLanguageBundle();this._oList.setModel(this._oJamModel);this.FILTER_CONSTANTS={GROUP_WALL:"Group Wall",GROUP_OBJECT_WALL:"Group Object Wall"};f.byId("filter_popover").attachSelectionChange(this.onFilterSelection,this);}});
B._sSMIv2ServiceUrl="/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV";
B.prototype.start=function(f){if(!(this._oCommonUtil.isObject(f)&&this._oCommonUtil.isString(f.appContext)&&this._oCommonUtil.isString(f.odataServicePath)&&this._oCommonUtil.isString(f.collection)&&this._oCommonUtil.isString(f.key)&&this._oCommonUtil.isString(f.name))){var e="The feedSources' data object is invalid.";this._oFeedController.logError(e);throw new Error(e);}this._sendRequestMapInternalBOToExternalBO(f.appContext,f.collection,f.key,f.odataServicePath).then((function(d,r){return this._sendRequestExternalObjects_FindByExidAndObjectType(d.MapInternalBOToExternalBO.Exid,d.MapInternalBOToExternalBO.ObjectType);}).bind(this),(function(E){this._oFeedController.logError("The internal to external mapping for the business object could not be performed.");this._oFeedController.displayErrorMessage(this._oLanguageBundle.getText("SMIV2_INTERNAL_TO_EXTERNAL_BO_MAPPING_COULD_NOT_BE_PERFORMED"));return null;}).bind(this)).then((function(d,r){this._sJamBOId=this._oCommonUtil.getODataResult(d).Id;this._oList.attachUpdateFinished(this.onGroupSelectorUpdateFinished,this);this._oList.bindItems({path:"/ExternalObjects('"+this._oCommonUtil.getODataResult(d).Id+"')/Groups",template:this._oListItemTemplate});}).bind(this),(function(E){if(E!==null){this._oFeedController.logError("An external object associated with the given Exid and ObjectType could not be found.");this._oFeedController.displayErrorMessage(this._oLanguageBundle.getText("JAM_EXTERNAL_OBJECT_COULD_NOT_BE_FOUND"));}}).bind(this));this._oFeedController.enableGroupFeed();this._oViewDataModel.setProperty("/filterEnabled",true);this._setFilterOptions(f.name);this._oList.attachUpdateFinished(this.onUpdateFinished,this);};
B.prototype.stop=function(){this._oPendingRequestsUtil.abortAll();this._oViewDataModel.setProperty("/filterEnabled",false);this._oList.detachUpdateFinished(this.onUpdateFinished,this);};
B.prototype._sendFunctionImportODataRequest=function(o,s,p){var d=jQuery.Deferred();var a=o.callFunction(s,{urlParameters:p,success:function(D,r){d.resolve(D,r);},error:function(e){d.reject(e);}});var A=d.promise(a);this._oPendingRequestsUtil.add(A);d.always((function(){this._oPendingRequestsUtil.remove(A);}).bind(this));return A;};
B.prototype._sendRequestMapInternalBOToExternalBO=function(a,o,s,b){return this._sendFunctionImportODataRequest(this._oSMIModel,"/MapInternalBOToExternalBO",{ApplicationContext:a,ODataCollection:o,ODataKeyPredicate:s,ODataServicePath:b});};
B.prototype._sendRequestExternalObjects_FindByExidAndObjectType=function(E,a){return this._sendFunctionImportODataRequest(this._oJamModel,"/ExternalObjects_FindByExidAndObjectType",{Exid:E,ObjectType:a});};
B.prototype._setFilterOptions=function(a){var i;a?i=this._oLanguageBundle.getText("GF_FILTER_OBJECT",a):i=this._oLanguageBundle.getText("GF_FILTER_OBJECT_DEFAULT");var f=[{Name:this._oLanguageBundle.getText("GF_FILTER_GROUP"),key:this.FILTER_CONSTANTS.GROUP_WALL},{Name:i,key:this.FILTER_CONSTANTS.GROUP_OBJECT_WALL}];this._oViewDataModel.setProperty("/filter",f);var F=this._oFeedController.byId("filter_popover");F.setSelectedItem(F.getItems()[0]);};
B.prototype.getAddPostPath=function(){var g=this._oViewDataModel.getProperty("/groupSelected/Id");return"/GroupExternalObjects(GroupId='"+g+"',ExternalObjectId='"+this._sJamBOId+"')/FeedEntries";};
B.prototype.displayFeedSourceSelectorPopover=function(c){this._oList.setBusy(true);this._oJamModel.refresh(true);this._oGroupSelectPopover.openBy(c);};
B.prototype.onGroupSelected=function(e){var g=e.getSource().getSelectedItem().getBindingContext().getObject();this._oViewDataModel.setProperty("/groupSelected",{Id:g.Id,Name:g.Name,WebURL:g.WebURL});this._oViewDataModel.setProperty("/feedEndpoint","/Groups('"+g.Id+"')/FeedEntries");this._oViewDataModel.setProperty("/filterMessage","");var f=this._oFeedController.byId("filter_popover");f.setSelectedItem(f.getItems()[0]);this._oGroupSelectPopover.close();};
B.prototype.onBatchCompleted=function(e){};
B.prototype.onGroupSelectorUpdateFinished=function(){var l=this._oList.getItems();var f;var F;if(l.length>0){f=l[0];this._oList.setSelectedItem(f);F=f.getBindingContext().getObject();this._oViewDataModel.setProperty("/groupSelected",F);this._oViewDataModel.setProperty("/feedEndpoint","/Groups('"+F.Id+"')/FeedEntries");}this._oList.detachUpdateFinished(this.onGroupSelectorUpdateFinished,this);};
B.prototype.onUpdateFinished=function(){this._oList.setBusy(false);};
B.prototype.onFilterSelection=function(c){var s=c.getParameter("listItem");var f=s.getBindingContext().getObject();var g=this._oViewDataModel.getProperty("/groupSelected/Id");switch(f.key){case this.FILTER_CONSTANTS.GROUP_WALL:this._oViewDataModel.setProperty("/filterMessage","");this._oViewDataModel.setProperty("/feedEndpoint","/Groups('"+g+"')/FeedEntries");break;case this.FILTER_CONSTANTS.GROUP_OBJECT_WALL:this._oViewDataModel.setProperty("/filterMessage",this._oLanguageBundle.getText("ST_FILTER_TEXT")+" "+f.Name);this._oViewDataModel.setProperty("/feedEndpoint","/GroupExternalObjects(GroupId='"+g+"',ExternalObjectId='"+this._sJamBOId+"')/FeedEntries");break;}};
B.prototype.getFeedUpdatesLatestCount=function(){var l=this._oFeedController.byId("timeline").getContent()[0];var L=l?l.getModel().getProperty("/TopLevelId"):"";var g=this._oViewDataModel.getProperty("/groupSelected/Id");if(this._oViewDataModel.getProperty("/filterMessage")===""){return this._sendRequestGroup_SinceLatestCount(L,g);}else{var e=this._sJamBOId;return this._sendRequestGroupExternalObject_SinceLatestCount(L,g,e);}};
B.prototype._sendRequestGroup_SinceLatestCount=function(L,G){return this._sendFunctionImportODataRequest(this._oJamModel,"/Group_FeedLatestCount",{LatestTopLevelId:L,Id:G});};
B.prototype._sendRequestGroupExternalObject_SinceLatestCount=function(L,G,E){return this._sendFunctionImportODataRequest(this._oJamModel,"/GroupExternalObject_FeedLatestCount",{LatestTopLevelId:L,GroupId:G,ExternalObjectId:E});};
B.prototype._initializeModels=function(){M.prototype._initializeModels.apply(this);var s=new O(B._sSMIv2ServiceUrl,true);this._oFeedController.setSmiModel(s);};
B.prototype.getSMIv2ServiceUrl=function(){return B._sSMIv2ServiceUrl;};
return B;});
sap.ui.predefine('sap/collaboration/components/feed/Component',["sap/ui/core/UIComponent","sap/suite/ui/commons/library","jquery.sap.global","sap/ui/core/mvc/View","sap/ui/core/library"],function(U,c,q,V,a){"use strict";var b=a.mvc.ViewType;var T=c.TimelineAxisOrientation;var C="sap.collaboration.components.feed.Component";var F=U.extend(C,{metadata:{stereotype:"component",version:"1.0",includes:["../resources/css/MorePopover.css"],dependencies:{libs:[],components:[],ui5version:""},library:"sap.collaboration",properties:{"axisOrientation":{type:"sap.suite.ui.commons.TimelineAxisOrientation",group:"Misc",defaultValue:T.Vertical},"feedSources":{type:"object|string[]"},"enableScroll":{type:"boolean",defaultValue:true}},rootView:null,publicMethods:["setSettings","getSelectedGroup"],aggregations:{},routing:{},config:{},customizing:{}},init:function(){this._logger=new q.sap.log.getLogger(C);U.prototype.init.apply(this);},exit:function(){},onBeforeRendering:function(){},onAfterRendering:function(){},createContent:function(){this._view=sap.ui.view({id:this.createId("group_feed_view"),height:"100%",type:b.XML,viewName:"sap.collaboration.components.feed.views.GroupFeed"});this.setAxisOrientation(this.getAxisOrientation());return this._view;},setSettings:function(s){for(var k in s){if(s.hasOwnProperty(k)){this._setProperty(k,s[k]);}}},getSelectedGroup:function(){return this._view.getModel().getProperty("/groupSelected");},_setProperty:function(p,d){this._logger.info(p+": "+d);this._view.getModel().setProperty("/"+p,d);this.setProperty(p,d);},setAxisOrientation:function(d){this._setProperty("axisOrientation",d);return this;},setFeedSources:function(f){this._setProperty("feedSources",f);},setEnableScroll:function(e){this._setProperty("enableScroll",e);return this;}});return F;});
sap.ui.predefine('sap/collaboration/components/feed/GroupIDsMode',["jquery.sap.global","./Mode","sap/collaboration/components/utils/PendingRequestsUtil"],function(q,M,P){"use strict";
var G=M.extend("sap.collaboration.components.feed.GroupIDsMode",{constructor:function(f){M.apply(this,[f]);this._oPendingRequestsUtil=new P();this._iOpenGroupRequests;this._aGroupsToLoad;this.oResult;this._oList.setModel(this._oViewDataModel);}});
G.prototype.start=function(f){if(!this._oCommonUtil.isArrayOfStrings(f)){var e="The feedSources' data object is invalid.";this._oFeedController.logError(e);throw new Error(e);}if(f.length===0){this._oFeedController.disableGroupFeed();return;}f=f.filter(function(g,i){return f.indexOf(g)===i&&g.trim()!=="";});this._oViewDataModel.setProperty("/groups",[]);this._oViewDataModel.setProperty("/groupSelected/Id",undefined);this._iOpenGroupRequests=0;this._aGroupsToLoad=q.merge([],f);this._oList.bindItems({path:"/groups",template:this._oListItemTemplate});this._oGroupSelectPopover.setBusyIndicatorDelay(0).setBusy(true);this._fillGroupInfo();};
G.prototype.onBatchCompleted=function(e){this._oJamModel.setUseBatch(false);if(this._iOpenGroupRequests===0){if(this._oGroupSelectPopover!==undefined){this._oGroupSelectPopover.setBusy(false);}}};
G.prototype.stop=function(){this._oPendingRequestsUtil.abortAll();};
G.prototype.getAddPostPath=function(){var g=this._oViewDataModel.getProperty("/groupSelected/Id");return"/Groups('"+g+"')/FeedEntries";};
G.prototype.displayFeedSourceSelectorPopover=function(c){this._oGroupSelectPopover.openBy(c);};
G.prototype.onGroupSelected=function(e){var g=e.getSource().getSelectedItem().getBindingContext().getObject();this._oViewDataModel.setProperty("/groupSelected",g);this._oViewDataModel.setProperty("/feedEndpoint","/Groups('"+g.Id+"')/FeedEntries");this._oGroupSelectPopover.close();};
G.prototype._fillGroupInfo=function(){var b=10;var B=0;var i=0;var g=0;var a=20;this._oJamModel.setUseBatch(true);var f="$filter=Id eq '";for(var l=0,c=this._aGroupsToLoad.length;l<c;l++){if(!(l%a==0)){f=f.concat(" or Id eq '"+this._aGroupsToLoad[l].replace(/'/g,"''")+"'");}else{f=f.concat(this._aGroupsToLoad[l].replace(/'/g,"''")+"'");};g++;if(g===a||l+1===c){this._iOpenGroupRequests++;var r=undefined;this._loadGroups(f,B).done((function(d,R){r=this._oCommonUtil.getODataResult(d);if(!q.isEmptyObject(r)){if(r.length!=undefined){var I=this._aGroupsToLoad.indexOf(r[0].Id);for(var C=0,o=r.length;C<o;C++){this._oViewDataModel.setProperty("/groups/"+I,r[C]);I++;};}else{this._oViewDataModel.setProperty("/groups/"+this._aGroupsToLoad.indexOf(r.Id),r);}};this._iOpenGroupRequests--;if(this._iOpenGroupRequests===0){if(this._oViewDataModel.getProperty("/groups/").length===0){this._oFeedController.disableGroupFeed();q.sap.log.warning("No group information was retrieved for the current user.");}else{this._oFeedController.enableGroupFeed();var e=this._oViewDataModel.getProperty("/groups/");e=e.filter(function(h){return h!==undefined&&h!==null});this._oViewDataModel.setProperty("/groups/",e);this._oViewDataModel.setProperty("/groupSelected",e[0]);this._oViewDataModel.setProperty("/feedEndpoint","/Groups('"+e[0].Id+"')/FeedEntries");}};}).bind(this));i++;g=0;f="$filter=Id eq '";};if(i==b){B++;i=0;}};};
G.prototype._loadGroups=function(f,b){if(!this.isJamServiceAvailable()){return;}var t=this;var l=q.Deferred();var p="/Groups/";var m={"urlParameters":f+"&$select=Id,Name,WebURL","success":function(d,a){l.resolveWith(t,[d,a]);},"error":function(e){l.rejectWith(t,[e]);t._oFeedController.logError("The group information was not retrieved.");},"batchGroupId":b};var r=this._oJamModel.read(p,m);this._oPendingRequestsUtil.add(r);var o=l.promise(r);o.always(function(){this._oPendingRequestsUtil.remove(r);});return o;};
return G;});
sap.ui.predefine('sap/collaboration/components/feed/Mode',["sap/ui/base/Object","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/collaboration/components/utils/CommonUtil","sap/ui/model/odata/v2/ODataModel"],function(B,F,a,b,C,O){"use strict";
var M=B.extend("sap.collaboration.components.feed.Mode",{constructor:function(f){this._oCommonUtil=new C();this._oFeedController=f;this._initializeModels();this._oViewDataModel=this._oFeedController.getModel();this._oJamModel=this._oFeedController.getModel("jam");var g=this._getGroupSelectorFragmentId();sap.ui.xmlfragment(g,"sap.collaboration.components.feed.fragments.GroupSelector",this);this._oGroupSelectPopover=b.byId(g,"responsivePopover");this._oGroupSelectPopover.setModel(this._oFeedController.getModel("i18n"),"i18n");this._oList=b.byId(g,"list");this._oList.addStyleClass("RightToLeftParenthesisStyling");this._oList.setBusyIndicatorDelay(0);this._oListItemTemplate=sap.ui.xmlfragment("sap.collaboration.components.feed.fragments.CustomListItem",this);}});
M._bJamServiceAvailable=true;M._sJamServiceUrl="/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1/OData";M._nextGroupSelectorFragmentIdIndex=0;
M.prototype._getGroupSelectorFragmentId=function(){return this._oFeedController.createId("groupSelectorFragment")+M._nextGroupSelectorFragmentIdIndex++;};
M.prototype.getFeedEntries=function(p,s){var l=jQuery.Deferred();var P={"urlParameters":{"$expand":"Creator,TargetObjectReference"},"success":function(d,r){l.resolve(d,r);},"error":function(e){l.reject(e);}};if(s){P.urlParameters.$skiptoken=s;}return l.promise(this._oJamModel.read(p,P));};
M.prototype.onGroupSearch=function(e){var f=new F("Name",a.Contains,e.getParameter("newValue"));this._oList.getBinding("items").filter([f]);};
M.prototype.addPost=function(c){var p=jQuery.Deferred();var P=this.getAddPostPath();var d={"Text":c};var m={"success":function(D,r){p.resolve(D,r);},"error":function(e){p.reject(e);}};return{"path":P,"payload":d,"promise":p.promise(this._oJamModel.create(P,d,m))};};
M.prototype.getFeedUpdatesLatestCount=function(){var g=jQuery.Deferred();var l=this._oFeedController.byId("timeline").getContent()[0];var L=l?l.getModel().getProperty("/TopLevelId"):"";var G=this._oViewDataModel.getProperty("/groupSelected/Id");var p="/Group_FeedLatestCount";var P={"urlParameters":{LatestTopLevelId:L,Id:G},"success":function(d,r){g.resolve(d,r);},"error":function(e){g.reject(e);}};return g.promise(this._oJamModel.callFunction(p,P));};
M.prototype._initializeModels=function(){var j=new O(M._sJamServiceUrl);j.attachMetadataFailed(this._oFeedController._onMetadataFailed,this._oFeedController);j.attachRequestCompleted(this._oFeedController._onJamRequestCompleted,this._oFeedController);j.attachRequestFailed(this._oFeedController._onJamRequestFailed,this._oFeedController);j.attachRequestSent(this._oFeedController._onJamRequestSent,this._oFeedController);j.attachBatchRequestCompleted(this._oFeedController._onBatchCompleted,this._oFeedController);j.attachBatchRequestFailed(this._oFeedController._onBatchFailed,this._oFeedController);j.attachBatchRequestSent(this._oFeedController._onBatchSent,this._oFeedController);this._oFeedController.setJamModel(j);};
M.prototype.getJamServiceUrl=function(){return M._sJamServiceUrl;};
M.prototype.isJamServiceAvailable=function(){return M._bJamServiceAvailable;};
M.prototype.setJamServiceAvailable=function(j){M._bJamServiceAvailable=j;};
return M;});
sap.ui.predefine('sap/collaboration/components/feed/ModeFactory',["./GroupIDsMode","./BOMode","./UserMode","sap/collaboration/library"],function(G,B,U,l){"use strict";var F=l.FeedType;var M=function(){this._oFeedTypeToModeClass={};this._oFeedTypeToModeClass[F.GroupIds]=G;this._oFeedTypeToModeClass[F.BusinessObjectGroups]=B;this._oFeedTypeToModeClass[F.UserGroups]=U;};M._instance=null;
M.getInstance=function(){if(M._instance===null){M._instance=new M();}return M._instance;};
M.prototype.createMode=function(f,o){var a=this._oFeedTypeToModeClass[f];if(a===undefined){var e=f+" is not a valid value for the feedSources mode property.\n";e+="It must be equal to the value of either one of the following:\n";e+="sap.collaboration.FeedType.GroupIds\n";e+="sap.collaboration.FeedType.BusinessObjectGroups\n";e+="sap.collaboration.FeedType.UserGroups";o.logError(e);o.byId("timeline").destroy();throw new Error(e);}return new a(o);};
return M;},true);
sap.ui.predefine('sap/collaboration/components/feed/UserMode',["./Mode"],function(M){"use strict";
var U=M.extend("sap.collaboration.components.feed.UserMode",{constructor:function(f){M.apply(this,[f]);this._oList.setModel(this._oJamModel);}});
U.prototype.start=function(){this._oList.attachUpdateFinished(this.onGroupSelectorUpdateFinished,this);this._oList.attachUpdateFinished(this.onUpdateFinished,this);this._oList.bindItems({path:"/Groups",template:this._oListItemTemplate});this._oFeedController.enableGroupFeed();};
U.prototype.stop=function(){this._oList.detachUpdateFinished(this.onUpdateFinished,this);};
U.prototype._updateSelectedGroupInViewDataModel=function(g){this._oViewDataModel.setProperty("/groupSelected",{Id:g.Id,Name:g.Name,WebURL:g.WebURL});this._oViewDataModel.setProperty("/feedEndpoint","/Groups('"+g.Id+"')/FeedEntries");};
U.prototype.getAddPostPath=function(){return"/Groups('"+this._oViewDataModel.getProperty("/groupSelected/Id")+"')/FeedEntries";};
U.prototype.displayFeedSourceSelectorPopover=function(c){this._oList.setBusy(true);this._oJamModel.refresh(true);this._oGroupSelectPopover.openBy(c);};
U.prototype.onGroupSelected=function(e){var g=e.getSource().getSelectedItem().getBindingContext().getObject();this._updateSelectedGroupInViewDataModel(g);this._oGroupSelectPopover.close();};
U.prototype.onBatchCompleted=function(){};
U.prototype.onGroupSelectorUpdateFinished=function(){var l=this._oList.getItems();var f;var F;if(l.length>0){f=l[0];this._oList.setSelectedItem(f);F=f.getBindingContext().getObject();this._updateSelectedGroupInViewDataModel(F);}this._oList.detachUpdateFinished(this.onGroupSelectorUpdateFinished,this);};
U.prototype.onUpdateFinished=function(){this._oList.setBusy(false);};
return U;});
sap.ui.predefine('sap/collaboration/components/feed/views/GroupFeed.controller',["jquery.sap.global","sap/ui/core/mvc/Controller","sap/suite/ui/commons/TimelineItem","sap/m/MessageBox","sap/collaboration/components/utils/LanguageBundle","sap/collaboration/components/utils/DateUtil","sap/collaboration/components/controls/FeedEntryEmbedded","sap/collaboration/components/controls/ReplyPopover","sap/collaboration/components/controls/SocialTextArea","sap/collaboration/components/controls/FilterPopover","sap/collaboration/components/utils/CommonUtil","sap/collaboration/components/feed/ModeFactory","sap/ui/model/json/JSONModel","sap/m/ToolbarSpacer","sap/m/Button","sap/m/library","sap/ui/core/Fragment","sap/m/ResponsivePopover","sap/ui/Device","sap/ui/core/CustomData","sap/m/Link","sap/ui/core/library","sap/m/List","sap/m/CustomListItem","sap/collaboration/library"],function(q,C,T,M,L,D,F,R,S,a,b,c,J,d,B,m,e,f,g,h,j,k,l,n,o){"use strict";var p=o.FeedType;var r=k.MessageType;var P=m.PlacementType;var s=m.ButtonType;var t="sap.collaboration.components.feed.views.GroupFeed";var G=C.extend(t,{onInit:function(){this._initializeUtilities();this._initializeRequestStateData();this._initializeSystemData();this._initializeModels();this._initializeTimeline();},onBeforeRendering:function(){if(!this._oMode.isJamServiceAvailable()){this.displayErrorMessage();}},onAfterRendering:function(){},onExit:function(){this._abortAllPendingRequests();this.byId("filter_popover").destroy();this.byId("addPost_popover").destroy();this._stopAutoCheckingForNewUpdates();},_initializeUtilities:function(){this._oCommonUtil=new b();this._oLogger=new q.sap.log.getLogger(t);this._oLanguageBundle=new L();this._oDateUtil=new D();},_initializeSystemData:function(){this._oModes={};this._mCurrentUser;},_initializeRequestStateData:function(){this._oNextLinks={"feedEntriesNextLink":"","repliesNextLink":""};this._oPendingRequests={"loadingFeedEntriesRequest":undefined,"loadingRepliesRequest":undefined,"loadingSuggestionsRequest":undefined,"loadingFeedAtMentions":undefined,"refreshingSecurityToken":undefined};this._oPostRequestData={"path":undefined,"payload":undefined,"parameters":undefined};},_initializeModels:function(){var i=this._oLanguageBundle.createResourceModel();this.getView().setModel(i,"i18n");this._i18nModel=i;var v=new J();v.setData({"feedSources":undefined,"axisOrientation":undefined,"enableSocial":true,"enableScroll":undefined,"forceGrowing":false,"growingThreshold":20,"groupSelectorEnabled":false,"groupSelected":{},"groups":[],"filterEnabled":false,"filter":[],"filterMessage":"","feedEndpoint":undefined,"addPostButtonEnabled":false,});v.bindProperty("/feedSources").attachChange(this._onFeedSourcesChange,this);v.bindProperty("/feedEndpoint").attachChange(this._onFeedEndpointChange,this);v.bindProperty("/filterMessage").attachChange(this._onFilterMessageChange,this);this.getView().setModel(v);this._oViewDataModel=v;},_initializeTimeline:function(){var i=this.byId("timeline");i.setContent([]);this._modifyHeaderBar();this._createSocialProfile();},_modifyHeaderBar:function(){var H=this.byId("timeline").getHeaderBar();H.removeAllContent();var i=this._createGroupSelector();H.insertContent(i,0);var u=new d(this.createId("header_spacer"));H.insertContent(u,1);var v=this._createFilterButton();H.insertContent(v,2);var A=this._createAddPostButton();H.insertContent(A,3);},_createGroupSelector:function(){var i=new B(this.createId("groupSelect_button"),{icon:"sap-icon://slim-arrow-down",iconFirst:false,text:"{/groupSelected/Name}",width:"20em",enabled:"{/groupSelectorEnabled}",type:s.Transparent,press:[this.onGroupSelectorButtonPress,this]});i.setModel(this._oViewDataModel);return i;},_createFilterButton:function(){if(!this.byId("filter_popover")){var i=sap.ui.xmlfragment("sap.collaboration.components.feed.fragments.CustomListItem",this);new a(this.createId("filter_popover"),{title:this._oLanguageBundle.getText("ST_FILTER_HEADER"),}).setModel(this._oViewDataModel).bindItems("/filter",i);}var u=new B(this.createId("filter_button"),{enabled:"{/filterEnabled}",visible:"{/filterEnabled}",icon:"sap-icon://filter",type:s.Transparent,press:[function(){this.byId("filter_popover").openBy(this.byId("filter_button"));},this]}).setModel(this._oViewDataModel);return u;},_createAddPostButton:function(){if(this.byId("addPost_popover")===undefined){new f(this.createId("addPost_popover"),{placement:P.Auto,title:this._oLanguageBundle.getText("ST_ADD_POST_TITLE"),contentWidth:"25rem",contentHeight:"10rem",content:new S(this.createId("social_TextArea"),{height:"10rem",width:"100%",liveChange:[function(E){E.getParameter("value").trim()!==""?this.byId("addPost_postButton").setEnabled(true):this.byId("addPost_postButton").setEnabled(false);},this],suggest:[this.onSuggest,this],afterSuggestionClose:[function(){this._oPendingRequests.loadingSuggestionsRequest&&this._oPendingRequests.loadingSuggestionsRequest.abort();},this]}),endButton:new B(this.createId("addPost_postButton"),{text:this._oLanguageBundle.getText("ST_ADD_POST_BUTTON"),enabled:false,press:[this.onAddPost,this],}),}).setInitialFocus(this.byId("social_TextArea"));if(!g.system.phone){this.byId("addPost_popover").setBeginButton(new B(this.createId("addPost_atMentionButton"),{text:"@",press:[function(){this.byId("social_TextArea").atMentionsButtonPressed();},this]}));}}var A=new B(this.createId("addPost_button"),{enabled:"{/addPostButtonEnabled}",icon:"sap-icon://add",type:s.Transparent,press:[function(){this.byId("addPost_popover").openBy(this.byId("addPost_button"));},this]});A.setModel(this._oViewDataModel);return A;},_clearTimeline:function(){var i=this.byId("timeline");i.destroyContent();},_createTimelineItem:function(i){var u=new J(i);var v=new F(this.createId(i.Id+"_embedded"),{"feedEntry":"{/}","serviceUrl":this._oMode.getJamServiceUrl(),"expandCollapseClick":[function(){this.byId("timeline").adjustUI();},this],"atMentionClick":[this.onAtMentionClicked,this],"previewLoad":[function(z){this.byId('timeline').adjustUI();},this]});var w=new R(this.createId("replyPostPopover_"+i.Id),{socialTextArea:new S({height:"80px",width:"100%",suggestionPlacement:P.Top,suggest:[this.onSuggest,this],afterSuggestionClose:[function(){this._oPendingRequests.loadingSuggestionsRequest&&this._oPendingRequests.loadingSuggestionsRequest.abort();},this]}),postReplyPress:[this.onPostReplyPress,this],moreRepliesPress:[function(E){var y=E.getSource().getParent();this._getReplies(undefined,y.getModel().getData().Replies.__next,y);},this],afterClose:[function(){if(this._oPendingRequests.loadingRepliesRequest){this._oPendingRequests.loadingRepliesRequest.abort();}this._bReplyPopoverIsOpen=false;},this]});w.getSocialTextArea().attachLiveChange(function(E){E.getParameter("value").trim()!==""?this.enableButton(true):this.enableButton(false);}.bind(w));var x=new h({key:"1",value:this._oLanguageBundle.getText("ST_MORE_CUSTOM_ACTION")});var y=new T(this.createId(i.Id),{"dateTime":"{/CreatedAt}","userName":"{/Creator/FullName}","title":"{/Action}","text":"{/Text}","icon":"sap-icon://post","userNameClickable":this._oViewDataModel.getProperty("/enableSocial"),"userNameClicked":[this.onUserNameClicked,this],"userPicture":{path:"/Creator/Id",formatter:this._buildThumbnailImageURL.bind(this)},"replyCount":"{/RepliesCount}","embeddedControl":v,"customReply":w,"replyListOpen":[this.onReplyListOpen,this],"customAction":x,"customActionClicked":[this.onMoreClicked,this]});y.setModel(u);y.setTitle("\u200E"+y.getTitle()+"\u200E");return y;},_addFeedEntriesToTimeline:function(i){var u=this.byId("timeline");i.forEach(function(v){var w=this._createTimelineItem(v);u.addContent(w);},this);},_processFeedEntries:function(i){if(i.length>0){this._addFeedEntriesToTimeline(i);}else{this._oViewDataModel.setProperty("/forceGrowing",false);}this._setTimelineToNotBusy();},_processAtMentions:function(){if(this._oPendingRequests.loadingFeedAtMentions&&this._oPendingRequests.loadingFeedAtMentions.state("pending")){this._oPendingRequests.loadingFeedAtMentions.abort();}var i=this;var u;var v={"async":true,"success":function(x,y){w.resolveWith(i,[x,y]);},"error":function(E){i._oLogger.error('Failed to retrieve the @mentions.');w.rejectWith(i,[E]);}};if(this._oAtMention.atMentionsNextLink){u="/"+this._oAtMention.atMentionsNextLink;v.urlParameters=this._extractUrlParams(decodeURIComponent(this._oAtMention.atMentionsNextLink));}else{u="/FeedEntries("+q.sap.encodeURL("'"+this._oAtMention.feedId+"'")+")/AtMentions";}var w=q.Deferred();w.done(function(x,y){i._oAtMention.atMentionsNextLink=x.__next;i._oAtMention.aAtMentions=i._oCommonUtil.getODataResult(x).concat(i._oAtMention.aAtMentions);if(i._oAtMention.atMentionsNextLink){i._processAtMentions();}else{var z={openingControl:i._oAtMention.oUserNameLink,memberId:i._oAtMention.aAtMentions[i._oAtMention.placeholderIndex].Email};i._oSocialProfile.setSettings(z);i._oSocialProfile.open();}});this._oPendingRequests.loadingFeedAtMentions=w.promise(this._oJamModel.read(u,v));},_createSocialProfile:function(){this._oSocialProfile=new sap.ui.getCore().createComponent("sap.collaboration.components.socialprofile");return this._oSocialProfile;},_setTimelineToBusy:function(){var i=this.byId("timeline");i.setBusyIndicatorDelay(0).setBusy(true);},_setTimelineToNotBusy:function(){var i=this.byId("timeline");i.setBusyIndicatorDelay(0).setBusy(false);},_showFeedUpdatesInTimeline:function(i){var u=this.byId("timeline");var v=u.getMessageStrip();if(i>0){if(!this.byId("refreshLink")){var w=new j(this.createId("refreshLink"),{text:this._oLanguageBundle.getText("GF_REFRESH_FEED"),press:[function(){var x=this._oViewDataModel.getProperty("/feedEndpoint");this._initialLoadFeedEntries(x);},this]});v.setLink(w);v.setType(r.Information);v.setShowIcon(true);}i==1?u.setCustomMessage(this._oLanguageBundle.getText("GF_NEW_FEED_UPDATE")):u.setCustomMessage(this._oLanguageBundle.getText("GF_NEW_FEED_UPDATES",i));v.setVisible(true);u.rerender();}},_hideFeedUpdatesInTimeline:function(){var i=this.byId("timeline").getMessageStrip();i.close();},onGrow:function(E){if(!this._oPendingRequests.loadingFeedEntriesRequest||!this._oPendingRequests.loadingFeedEntriesRequest.state()!="pending"){var i=this._oViewDataModel.getProperty("/feedEndpoint");this._loadFeedEntries(i).done(this._loadFeedEntriesSuccess.bind(this));}},onGroupSelectorButtonPress:function(E){this._oMode.displayFeedSourceSelectorPopover(E.getSource());},onAddPost:function(i){this.byId("addPost_popover").close();var u=this.byId("social_TextArea").convertTextWithFullNamesToEmailAliases();if(u&&u.trim()!==""){this._getLoggedInUser().done(function(){this._setTimelineToBusy();var v=function(y,z){this.byId("social_TextArea").clearText();this.byId("addPost_postButton").setEnabled(false);this._setTimelineToNotBusy();var E=this._oCommonUtil.getODataResult(y);E.Creator=this._mCurrentUser;var H=this._createTimelineItem(E);this.byId("timeline").insertContent(H,0);};var w=function(E){this._oLogger.error("Error occured when adding a post.",E.stack);};var A=this._oMode.addPost(u);this._oPostRequestData={"path":A.path,"payload":A.payload};this._oPostRequestData.parameters={success:v,error:w};var x=A.promise;x.then(v.bind(this),w.bind(this));}.bind(this));}else{this._oLogger.info('Posting an empty comment is not allowed, no feed entry will be created.');}},onReplyListOpen:function(E){var i=E.getSource().getCustomReply();i.getTextArea().focus();if(!this._bReplyPopoverIsOpen){this._bReplyPopoverIsOpen=true;var u=E.getSource();var v=u.getModel().getProperty("/Id");this._getReplies(v,undefined,u);}},onPostReplyPress:function(E){var i=this;var v=E.getParameter("value");var u=E.getSource().getParent();var w=u.getCustomReply();var x=u.getModel().getData().Id;var y="/FeedEntries('"+q.sap.encodeURL(x)+"')/Replies";var z={"Text":v};this._getLoggedInUser();this._getLoggedInUser().done(function(){var A={"async":true,"success":function(H,I){w.getTextArea().clearText();w.enableButton(false);w.setBusy(false);var K=i._oCommonUtil.getODataResult(H);var N={"CreatedAt":i._oDateUtil.formatDateToString(K.CreatedAt),"Text":K.Text,"Creator":i._mCurrentUser};N.Creator.ThumbnailImage=i._buildThumbnailImageURL(i._mCurrentUser.Id);w.addReply(N);u.getModel().setProperty("/RepliesCount",u.getModel().getProperty("/RepliesCount")+1);},"error":function(H){i._oLogger.error("Failed to post reply: "+H.statusText,H.stack);}};w.getTextArea().focus();w.setBusyIndicatorDelay(0).setBusy(true);this._oPostRequestData={"path":y,"payload":z,"parameters":A};this._oJamModel.create(y,z,A);}.bind(this));},onSuggest:function(E){var u=this;if(this._oPendingRequests.loadingSuggestionsRequest){this._oPendingRequests.loadingSuggestionsRequest.abort();}var v=E.getSource();var V=E.getParameter("value");if(V.trim()===""){v.showSuggestions([]);}else{var w="/Members_Autocomplete";var x=this._oViewDataModel.getProperty("/groupSelected/Id");var y={"async":true,"urlParameters":{"Query":"'"+V+"'","GroupId":"'"+x+"'","$top":"4"},"success":function(i,A){z.resolveWith(u,[i,A]);},"error":function(i){u._oLogger.error("Failed to get suggestions: "+i.statusText);z.rejectWith(u,[i]);}};var z=q.Deferred();z.done(function(A,H){var I=u._oCommonUtil.getODataResult(A);if(I.length===0){v.closeSuggestionPopover();}else{var K=[];var N=I.length;for(var i=0;i<N;i++){K.push({fullName:I[i].FullName,email:I[i].Email,userImage:u._buildThumbnailImageURL(I[i].Id)});}v.showSuggestions(K);}});this._oPendingRequests.loadingSuggestionsRequest=z.promise(this._oJamModel.read(w,y));}},onUserNameClicked:function(i){var u=i.getParameter("uiElement");var v=i.getSource().getModel();var w=v.getProperty("/Creator/Email");this._oSocialProfile.setSettings({openingControl:u,memberId:w});this._oSocialProfile.open();},onMoreClicked:function(i){var u=i.getSource().getModel().getProperty("/WebURL");var v=i.getSource().getModel().getProperty("/Id");var w=i.getSource().getParent().getModel().getProperty("/groupSelected/Name");var x=i.getSource().getParent().getModel().getProperty("/groupSelected/WebURL");var y=this.byId(this.createId("moreListPopover_"+v));if(y===undefined){var z=new l(this.createId("moreList_"+v),{});var A=new j(this.createId("groupNameLink_"+v),{text:this._oLanguageBundle.getText("ST_GROUP_NAME_LINK",w),target:"_blank",href:x,width:"15em"}).addStyleClass("sapCollaborationCustomLinkPadding");var E=new n(this.createId(v+"_groupNameLinkListItem"),{content:A});z.addItem(E);var H=new j(this.createId("feedEntryLink_"+v),{text:this._oLanguageBundle.getText("ST_FEED_ENTRY_LINK"),target:"_blank",href:u,width:"15em"}).addStyleClass("sapCollaborationCustomLinkPadding");var I=new n(this.createId("feedEntryLinkListItem_"+v),{content:H});z.addItem(I);var K=false;if(g.system.phone){K=true;}y=new f(this.createId("moreListPopover_"+v),{content:z,showHeader:K,title:this._oLanguageBundle.getText("ST_MORE_CUSTOM_ACTION"),showCloseButton:true,placement:P.VerticalPreferedBottom,contentWidth:"15em"});var N=function(){this.close();};A.attachPress(N.bind(y));H.attachPress(N.bind(y));}y.openBy(i.getParameter("linkObj"));},onAtMentionClicked:function(i){var u=i.getSource().getModel().getProperty("/Id");var U=i.getParameter("link");var v=U.getModel().getProperty("/placeholderIndex");this._oAtMention={"feedId":u,"oUserNameLink":U,"placeholderIndex":v,"aAtMentions":[],"atMentionsNextLink":undefined};this._processAtMentions();},_onFeedEndpointChange:function(i){var u=i.getSource().getValue();this._initialLoadFeedEntries(u);},_onFeedSourcesChange:function(E){var i;var u=E.getSource().getValue();if(Array.isArray(u)){u={mode:p.GroupIds,data:u};}if(this._oMode){this._oMode.stop();}if(this._oCommonUtil.isString(u.mode)){if(this._oModes[u.mode]===undefined){this._oModes[u.mode]=c.getInstance().createMode(u.mode,this);}}else{i="The mode must be a string.";this.logError(i);this.byId("timeline").destroy();throw new Error(i);}this._oMode=this._oModes[u.mode];this._oMode.start(u.data);},_onFilterMessageChange:function(i){var u=i.getSource().getValue();this.byId("timeline").setCustomMessage(u);this.byId("timeline").rerender();},_onMetadataFailed:function(E){switch(E.oSource.sServiceUrl){case this._oMode.getJamServiceUrl():this._oLogger.error("Failed to load Jam metadata. Service unavailable or possible missing JAM configuration.");this._displayJamConnectionErrorMessage();this._oMode.setJamServiceAvailable(false);break;case this._oMode.getSMIv2ServiceUrl():this._oLogger.error("Failed to load SMIv2 metadata.");this.displayErrorMessage();break;}this.disableGroupFeed();},_onJamRequestCompleted:function(E){var i=E.getParameter("method");if(E.success&&i==="POST"){this._oPendingRequests.refreshingSecurityToken=undefined;}},_onJamRequestFailed:function(E){this._setTimelineToNotBusy();var i=E.getParameter("method");var u=parseInt(E.getParameter("response").statusCode,10);var v=E.getParameter("feedEndpoint");if(!v){v=E.getParameter("url");}if(/ExternalObjects_FindByExidAndObjectType/.test(v)){this.disableGroupFeed();return;}switch(u){case 403:if(i==="POST"){if(this._oPendingRequests.refreshingSecurityToken===undefined){this._refreshSecurityToken().done(function(w,x){this._oJamModel.create(this._oPostRequestData.path,this._oPostRequestData.payload,this._oPostRequestData.parameters);});}else{this._oPendingRequests.refreshingSecurityToken=undefined;this.displayErrorMessage(this._oLanguageBundle.getText('JAM_NO_ACCESS_TO_POST_TO_GROUP'));}}else{this.displayErrorMessage(this._oLanguageBundle.getText('JAM_FORBIDDEN_ACCESS'));}break;case 404:if(/Groups\(.*\)\/FeedEntries/.test(v)){this.displayErrorMessage(this._oLanguageBundle.getText('JAM_NO_ACCESS_TO_GROUP'));this.disableGroupFeed();}else if(/Groups\(.*\)/.test(v)){this.displayErrorMessage(this._oLanguageBundle.getText('JAM_NO_ACCESS_TO_GROUP'));this.disableGroupFeed();}else if(/GroupExternalObject_FeedLatestCount|Group_FeedLatestCount/.test(v)){this._stopAutoCheckingForNewUpdates();}else{this.displayErrorMessage();}break;case 500:case 503:this._displayJamConnectionErrorMessage();break;default:this.displayErrorMessage();}},_onJamRequestSent:function(E){},_onBatchCompleted:function(E){this._oJamModel.setUseBatch(false);this._oMode.onBatchCompleted(E);},_onBatchFailed:function(E){},_onBatchSent:function(E){},_abortAllPendingRequests:function(){if(this._oPendingRequests.loadingFeedEntriesRequest){this._oPendingRequests.loadingFeedEntriesRequest.abort();}if(this._oPendingRequests.loadingRepliesRequest){this._oPendingRequests.loadingRepliesRequest.abort();}if(this._oPendingRequests.loadingSuggestionsRequest){this._oPendingRequests.loadingSuggestionsRequest.abort();}},_refreshSecurityToken:function(){var i=this;var u=q.Deferred();return this._oPendingRequests.refreshingSecurityToken=u.promise(this._oJamModel.refreshSecurityToken(function(v,w){i._oLogger.info("Security token refreshed");u.resolveWith(i,[v,w]);},function(v){i._oLogger.error("Security token error: "+v.statusText);u.rejectWith([v],i);}));},_getLoggedInUser:function(){var i=q.Deferred();if(!this._mCurrentUser){var u="/Self";var v={"success":function(w,x){this._mCurrentUser=this._oCommonUtil.getODataResult(w);i.resolve(w,x);}.bind(this),"error":function(E){this._oLogger.error('Failed to get the logged in user',E.stack);i.reject(E);}.bind(this)};return i.promise(this._oJamModel.read(u,v));}return i.resolve();},_loadFeedEntries:function(i){var u=undefined;if(!this._oMode.isJamServiceAvailable()){return;}this._setTimelineToBusy();var N=this._oNextLinks.feedEntriesNextLink;if(N!==""){N=decodeURIComponent(N);u=this._extractUrlParams(N).$skiptoken;}return this._oPendingRequests.loadingFeedEntriesRequest=this._oMode.getFeedEntries(i,u);},_loadFeedEntriesSuccess:function(i,u){this._oNextLinks.feedEntriesNextLink=i.__next;var v=this._oCommonUtil.getODataResult(i);this._processFeedEntries(v);},_initialLoadFeedEntries:function(i){if(this._oPendingRequests.loadingFeedEntriesRequest){this._oPendingRequests.loadingFeedEntriesRequest.abort();}this._initializeRequestStateData();this._oViewDataModel.setProperty("/forceGrowing",true);this._hideFeedUpdatesInTimeline();this._stopAutoCheckingForNewUpdates();this._loadFeedEntries(i).done([this._clearTimeline.bind(this),this._loadFeedEntriesSuccess.bind(this),this._startAutoCheckingForNewUpdates.bind(this)]);},_getReplies:function(i,N,u){var v=this;var w;var x={"async":true,"urlParameters":{'$orderby':'CreatedAt desc','$expand':'Creator'},"success":function(A,E){v._oLogger.info("Replies were successfully retrieved.");z.resolveWith(v,[A,E]);},"error":function(E){v._oLogger.error("Failed to retrieve replies: "+E.statusText);z.rejectWith(v,[E]);}};var y=u.getCustomReply();if(N){w="/"+N;x.urlParameters=this._extractUrlParams(decodeURIComponent(N));x.urlParameters.$orderby=x.urlParameters.$orderby.replace("+"," ");}else{w="/FeedEntries('"+q.sap.encodeURL(i)+"')/Replies";}var z=q.Deferred();z.done(function(A,E){var H=v._oCommonUtil.getODataResult(A).reverse();H.forEach(function(I){I.Creator.ThumbnailImage=v._buildThumbnailImageURL(I.Creator.Id);I.CreatedAt=v._oDateUtil.formatDateToString(I.CreatedAt);});y.addReplies({data:H,more:A.__next?true:false});u.getModel().getData().Replies.__next=A.__next;}).always(function(){y.setBusy(false);}).fail(function(){y._oReplyPopover.close();});y.setBusyIndicatorDelay(0).setBusy(true);this._oPendingRequests.loadingRepliesRequest=z.promise(this._oJamModel.read(w,x));},logError:function(E){this._oLogger.error(E);},getModel:function(N){return this.getView().getModel(N);},setModel:function(i,N){this.getView().setModel(i,N);},getLanguageBundle:function(){return this._oLanguageBundle;},setJamModel:function(i){this._oJamModel=i;this.setModel(i,"jam");},setSmiModel:function(i){this._oSMIModel=i;this.setModel(i,"smi");},displayErrorMessage:function(E){var i=E||this._oLanguageBundle.getText("SYSTEM_ERROR_MESSAGEBOX_GENERAL_TEXT");M.error(i);},_displayJamConnectionErrorMessage:function(){var i=this._oLanguageBundle.getText("JAM_CONNECTION_ERROR_MESSAGEBOX_TEXT");M.error(i);},disableGroupFeed:function(){this._abortAllPendingRequests();var i=this.byId("timeline");if(!q.isEmptyObject(i)){i.setBusyIndicatorDelay(0).setBusy(false);this._clearTimeline();this._oViewDataModel.setProperty("/groupSelectorEnabled",false);this._oViewDataModel.setProperty("/addPostButtonEnabled",false);this._oViewDataModel.setProperty("/forceGrowing",false);}},enableGroupFeed:function(){var i=this.byId("timeline");if(!q.isEmptyObject(i)){i.setBusyIndicatorDelay(0).setBusy(false);this._oViewDataModel.setProperty("/groupSelectorEnabled",true);this._oViewDataModel.setProperty("/addPostButtonEnabled",true);this._oViewDataModel.setProperty("/forceGrowing",true);}},_startAutoCheckingForNewUpdates:function(){this._iNewFeedUpdatesCheckerTimeDelay=120000;this._sNewFeedUpdatesCheckerTimeoutId=q.sap.delayedCall(this._iNewFeedUpdatesCheckerTimeDelay,this,this._checkForNewFeedUpdates);},_stopAutoCheckingForNewUpdates:function(){q.sap.clearDelayedCall(this._sNewFeedUpdatesCheckerTimeoutId);},_checkForNewFeedUpdates:function(){var i=function(u,v){this._showFeedUpdatesInTimeline(u);this._sNewFeedUpdatesCheckerTimeoutId=q.sap.delayedCall(this._iNewFeedUpdatesCheckerTimeDelay,this,this._checkForNewFeedUpdates);};var E=function(u){this._oLogger.error("Failed to check for new feed updates.");this._sNewFeedUpdatesCheckerTimeoutId=q.sap.delayedCall(this._iNewFeedUpdatesCheckerTimeDelay,this,this._checkForNewFeedUpdates);};this._oMode.getFeedUpdatesLatestCount().done(i.bind(this)).fail(E.bind(this));},_extractUrlParams:function(u){var U=u.slice(u.indexOf("?")+1);var i=U.split("&");var v={};i.forEach(function(w){var x=w.indexOf("=");v[w.slice(0,x)]=w.slice(x+1);});return v;},_buildThumbnailImageURL:function(u){return this._oJamModel.sServiceUrl+"/Members('"+q.sap.encodeURL(u)+"')/ThumbnailImage/$value";}});return G;},true);
sap.ui.predefine('sap/collaboration/components/fiori/sharing/dialog/Component',['sap/collaboration/components/utils/CommonUtil','sap/ui/core/UIComponent','sap/ui/core/mvc/View','sap/ui/core/library','sap/m/Dialog','sap/m/Button','sap/ui/Device','jquery.sap.global'],function(C,U,V,c,D,B,a,q){"use strict";var b=c.mvc.ViewType;
var d=U.extend("sap.collaboration.components.fiori.sharing.dialog.Component",{
metadata:{includes:["../../../resources/css/Sharing.css"],properties:{attachments:{type:"object"},object:{type:"object"},externalObject:{type:"object"}},aggregations:{},events:{}},
systemSettings:{width:"400px",height:"",oDataServiceUrl:"/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV",collaborationHostODataServiceUrl:"/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1/OData",collaborationHostRestService:{url:"/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1",urlParams:""}},
init:function(){this.oCommonUtil=new C();this.oLangBundle=this.oCommonUtil.getLanguageBundle();},
setSettings:function(s){this.setObject(s.object);this.setAttachments(s.attachments);if(JSON.stringify(s.externalObject)==='{}'){this.setExternalObject(undefined);}else{this.setExternalObject(s.externalObject);}},
_createSharingView:function(){var s=this;var o;var O;var e;var f=this.getObject();if(f){e=s._handleObjectId(f.id);o=f.display;O=f.share;}var n=function(){s.close();s.openoNoGroupsDialog(s.oSharingView.getController().sJamUrl);};if(!this.oSharingView){this.oSharingView=sap.ui.view({id:this.getId()+"_SharingView",viewData:{controlId:this.getId(),odataServiceUrl:this.systemSettings.oDataServiceUrl,collaborationHostODataServiceUrl:this.systemSettings.collaborationHostODataServiceUrl,collaborationHostRestService:this.systemSettings.collaborationHostRestService,langBundle:this.oLangBundle,jamGroups:this.aJamGroups,sharingDialog:this._oSharingDialog,noGroupsCallBack:n,objectDisplay:o,objectShare:O,objectId:e,attachments:this.getAttachments(),externalObject:this.getExternalObject()},type:b.JS,viewName:"sap.collaboration.components.fiori.sharing.Sharing"});}else{this.oSharingView.getViewData().objectId=e;this.oSharingView.getViewData().objectShare=O;this.oSharingView.getViewData().objectDisplay=o;this.oSharingView.getViewData().externalObject=this.getExternalObject();this.oSharingView.getViewData().attachments=this.getAttachments();}},
_createSharingDialog:function(){var s=new D(this.getId()+"_SharingDialog",{title:this.oLangBundle.getText("SHARING_PAGE_TITLE"),contentWidth:this.systemSettings.width,stretch:false,afterClose:function(){}}).addStyleClass("sapUiPopupWithPadding");return s;},
createNoGroupsDialog:function(j){if(!this.oNoGroupsView){this.oNoGroupsView=sap.ui.view({id:this.getId()+"_NoGroupsView",viewData:{controlId:this.getId(),langBundle:this.oLangBundle,jamUrl:j},type:b.JS,viewName:"sap.collaboration.components.fiori.sharing.NoGroups"});}var n=new D(this.getId()+"_NoGroupsDialog",{title:this.oLangBundle.getText("SHARING_PAGE_TITLE"),stretch:false,content:this.oNoGroupsView,beginButton:new B(this.getId()+"_CloseButton",{text:this.oLangBundle.getText("CLOSE_BUTTON_TEXT"),press:function(){n.close();}})}).addStyleClass("sapUiPopupWithPadding");return n;},
open:function(){if(this.bStopRendering===undefined||this.bStopRendering===false){if(!this._oSharingDialog){this._logComponentProperties();this._oSharingDialog=this._createSharingDialog();}try{this._createSharingView();this._oSharingDialog.addAriaLabelledBy(this.getId()+"_SharingView");this._oSharingDialog.addContent(this.oSharingView);this._oSharingDialog.setInitialFocus(this.oSharingView);this._createDialogButtons();if(a.system.phone){this._oSharingDialog.setStretch(true);}this._oSharingDialog.open();}catch(e){q.sap.log.error(e);this.oCommonUtil.displayError();}}},
close:function(){if(this._oSharingDialog){this._oSharingDialog.close();}},
openoNoGroupsDialog:function(j){this._oSharingDialog.removeAllContent();if(!this.oNoGroupsDialog){this.oNoGroupsDialog=this.createNoGroupsDialog(j);}this.oNoGroupsDialog.open();},
_createDialogButtons:function(){if(!this.oMentionButton){this.oMentionButton=new B(this.getId()+"_mentionButton",{text:"@",enabled:false,press:[function(){this.oSharingView.getController().atMentionsButtonPressed();},this]});this._oSharingDialog.addButton(this.oMentionButton);}if(a.system.phone){this.oMentionButton.setVisible(false);}if(!this.oLeftButton){this.oLeftButton=new B(this.getId()+"_LeftButton",{text:this.oLangBundle.getText("OK_BUTTON_TEXT"),enabled:false,press:[function(){this.oSharingView.getController().shareToJam();this._oSharingDialog.close();},this]});this._oSharingDialog.addButton(this.oLeftButton);}if(!this.oRightButton){this.oRightButton=new B(this.getId()+"_RightButton",{text:this.oLangBundle.getText("CANCEL_BUTTON_TEXT"),press:[function(){this._oSharingDialog.close();},this]});this._oSharingDialog.addButton(this.oRightButton);}},
setDialogButtons:function(){},
setCloseButton:function(){this._oSharingDialog.destroyBeginButton();this._oSharingDialog.setEndButton(this.oCloseButton);},
_handleObjectId:function(o){var O=typeof o;var s;switch(O){case"undefined":case"":case"string":s=o;break;case"function":s=o();if(typeof s=="string"){break;};default:q.sap.log.error("object->id is not a sting or callback function that returns a string");throw new Error();};return s;},
_logComponentProperties:function(){q.sap.log.debug("Share Component properties:","","sap.collaboration.components.fiori.sharing.Component._logComponentProperties()");q.sap.log.debug("width: "+this.systemSettings.width);q.sap.log.debug("height: "+this.systemSettings.height);q.sap.log.debug("oDataServiceUrl: "+this.systemSettings.oDataServiceUrl);q.sap.log.debug("collaborationHostODataServiceUrl: "+this.systemSettings.collaborationHostODataServiceUrl);q.sap.log.debug("collaborationHostRestService: "+this.systemSettings.collaborationHostRestService.url+this.systemSettings.collaborationHostRestService.urlParams);if(this.getObject()){q.sap.log.debug("object->id: "+this.getObject().id);q.sap.log.debug("object->display: "+this.getObject().display);q.sap.log.debug("object->share: "+this.getObject().share);}else{q.sap.log.debug("object: undefined");}if(this.getAttachments()&&this.getAttachments().attachmentsArray){q.sap.log.debug("Attachments:");var e=this.getAttachments().attachmentsArray;for(var i=0;i<e.length;i++){q.sap.log.debug("Attachments"+(i+1)+":");q.sap.log.debug(e[i].mimeType);q.sap.log.debug(e[i].name);q.sap.log.debug(e[i].url);}}else{q.sap.log.debug("attachments: undefined");}if(this.getExternalObject()){q.sap.log.debug("externalObject->appContext: "+this.getExternalObject().appContext);q.sap.log.debug("externalObject->odataServicePath: "+this.getExternalObject().odataServicePath);q.sap.log.debug("externalObject->collection: "+this.getExternalObject().collection);q.sap.log.debug("externalObject->key: "+this.getExternalObject().key);q.sap.log.debug("object->name: "+this.getExternalObject().name);q.sap.log.debug("object->summary: "+this.getExternalObject().summary);}else{q.sap.log.debug("externalObject: undefined");}}
});
return d;});
sap.ui.predefine('sap/collaboration/components/socialtimeline/controls/TimelineItemEmbedded',['sap/ui/core/Control','sap/collaboration/components/controls/TimelineEntryEmbedded','sap/collaboration/components/controls/FeedEntryEmbedded'],function(C,T,F){"use strict";
var a=C.extend("sap.collaboration.components.socialtimeline.controls.TimelineItemEmbedded",{metadata:{interfaces:[],library:"sap.m",properties:{"timelineItem":{type:"object",group:"data"}},events:{atMentionClick:{parameters:{link:{type:"object"},}},expandCollapseClick:{}},aggregations:{}}});
a.prototype.init=function(){this._oEmbeddedControl;};
a.prototype.onBeforeRendering=function(){var t=this.getTimelineItem();if(t._feedEntryData!==undefined){this._oEmbeddedControl=new F({"feedEntry":t._feedEntryData,"atMentionClick":[this.onAtMentionClicked,this],"expandCollapseClick":[this.onExpandCollapseClick,this]});}else{this._oEmbeddedControl=new T({"timelineEntry":t.timelineItemData,});}};
a.prototype.exit=function(){};
a.prototype.getEmbeddedControl=function(){return this._oEmbeddedControl;};
a.prototype.onExpandCollapseClick=function(){this.fireExpandCollapseClick();};
a.prototype.onAtMentionClicked=function(c){this.fireAtMentionClick(c.getParameters());};
return a;});
sap.ui.predefine('sap/collaboration/components/socialtimeline/controls/TimelineItemEmbeddedRenderer',[],function(){"use strict";var T={};
T.render=function(r,c){r.renderControl(c.getEmbeddedControl());};
return T;},true);
sap.ui.predefine('sap/collaboration/components/utils/DateUtil',['sap/ui/base/Object',"sap/collaboration/components/utils/LanguageBundle","sap/ui/core/format/DateFormat"],function(B,L,D){"use strict";
var a=B.extend("sap.collaboration.components.util.DateUtil",{
constructor:function(){this._oLanguageBundle=new L();},
formatDateToString:function(d){var o=D.getDateInstance({style:"short",relative:true},sap.ui.getCore().getConfiguration().getLocale());var t=D.getTimeInstance({style:"short"},sap.ui.getCore().getConfiguration().getLocale());var s=o.format(d)+" "+this._oLanguageBundle.getText("ST_GROUP_SELECT_AT")+" "+t.format(d);var p=/[A-Za-z]/;if(s.charAt(0).match(p)){s=s.charAt(0).toUpperCase()+s.slice(1);}return s;},
});
return a;});
sap.ui.predefine('sap/collaboration/components/utils/LanguageBundle',['jquery.sap.global','sap/ui/base/Object','sap/ui/model/resource/ResourceModel'],function(q,B,R){"use strict";var r=q.sap.getModulePath("sap.collaboration.components")+"/resources/i18n/messagebundle.properties";
var L=B.extend("sap.collaboration.components.util.LanguageBundle",{
constructor:function(){this.i18nModel=new R({bundleUrl:r});this.oLangBundle=this.i18nModel.getResourceBundle();},
getText:function(t,v){return this.oLangBundle.getText(t,v);},
createResourceModel:function(){return this.i18nModel;}
});
return L;});
sap.ui.predefine('sap/collaboration/components/utils/MediaTypeToSAPIcon',["sap/ui/base/Object"],function(B){"use strict";
var M=B.extend("sap.collaboration.components.utils.MediaTypeToSAPIcon",{});
M.getSAPIconForMediaType=function(m){var D="sap-icon://document";var t=m.split("/");var T=t[0];var s=t[1];switch(T){case"audio":return"sap-icon://attachment-audio";case"video":return"sap-icon://attachment-video";case"image":return"sap-icon://attachment-photo";case"text":return"sap-icon://document";case"application":switch(s){case"msword":case"vnd.openxmlformats-officedocument.wordprocessingml.document":case"vnd.openxmlformats-officedocument.wordprocessingml.template":case"vnd.ms-word.document.macroEnabled.12":case"vnd.ms-word.template.macroEnabled.12":return"sap-icon://doc-attachment";case"vnd.ms-excel":case"vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"vnd.openxmlformats-officedocument.spreadsheetml.template":case"vnd.ms-excel.sheet.macroEnabled.12":case"vnd.ms-excel.template.macroEnabled.12":case"vnd.ms-excel.addin.macroEnabled.12":case"vnd.ms-excel.sheet.binary.macroEnabled.12":return"sap-icon://excel-attachment";case"vnd.ms-powerpoint":case"vnd.openxmlformats-officedocument.presentationml.presentation":case"vnd.openxmlformats-officedocument.presentationml.template":case"vnd.openxmlformats-officedocument.presentationml.slideshow":case"vnd.ms-powerpoint.addin.macroEnabled.12":case"vnd.ms-powerpoint.presentation.macroEnabled.12":case"vnd.ms-powerpoint.template.macroEnabled.12":case"vnd.ms-powerpoint.slideshow.macroEnabled.12":return"sap-icon://ppt-attachment";case"pdf":return"sap-icon://pdf-attachment";case"mp4":return"sap-icon://attachment-video";default:return D;}default:return D;}};
return M;});
sap.ui.predefine('sap/collaboration/components/utils/PendingRequestsUtil',function(){"use strict";var P=function(){this._aPendingRequests=[];};
P.prototype.contains=function(r){for(var i=0;i<this._aPendingRequests.length;++i){if(this._aPendingRequests[i]===r){return true;}return false;}};
P.prototype.add=function(r){if(this.contains(r)){return false;}else{this._aPendingRequests.push(r);return true;}};
P.prototype.remove=function(r){for(var i=0;i<this._aPendingRequests.length;++i){if(this._aPendingRequests[i]===r){this._aPendingRequests.splice(i,1);return true;}}return false;};
P.prototype.abortAll=function(){var r;while((r=this._aPendingRequests.pop())!==undefined){r.abort();}};
return P;},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.predefine('sap/collaboration/components/fiori/feed/Component',['sap/collaboration/components/utils/CommonUtil','sap/collaboration/library','sap/ui/core/UIComponent','sap/ui/model/odata/ODataModel','jquery.sap.global','sap/ui/core/mvc/View','sap/ui/core/library'],function(C,l,U,O,q,V,c){"use strict";var F=l.FeedType;var a=c.mvc.ViewType;var A=l.AppType;
var b=U.extend("sap.collaboration.components.fiori.feed.Component",{
metadata:{properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:""},height:{type:"sap.ui.core.CSSSize",defaultValue:""},oDataServiceUrl:{type:"sap.ui.core.URI",defaultValue:"/sap/opu/odata/sap/SM_INTEGRATION_SRV"},feedType:{type:"string"},groupIds:{type:"string"},object:{type:"object"}},aggregations:{},events:{}},
init:function(){this.CollaborationFeedConstants={defaultWidth:'100%',defaultHeight:'100%'};this.setWidth(this.CollaborationFeedConstants.defaultWidth);this.setHeight(this.CollaborationFeedConstants.defaultHeight);this.mode=A.widget;this.oCommonUtil=new C();this.oLangBundle=this.oCommonUtil.getLanguageBundle();U.prototype.init.apply(this);},
setSettings:function(s){this.setODataServiceUrl(s.oDataServiceUrl);this.setFeedType(s.feedType);this.setGroupIds(s.groupIds);this.setObject(s.object);},
onBeforeRendering:function(){var d=true;try{this.bStopRendering=false;this.validateInputParameters();this.sODataServiceUrl=this.getODataServiceUrl();if(!this.oOdataModel){this.oOdataModel=new O(this.sODataServiceUrl,d);}}catch(e){q.sap.log.error(e,"","sap.collaboration.components.fiori.feed.Component.onBeforeRendering()");this.bStopRendering=true;this.oCommonUtil.displayError(e);}if(sap.ui.getCore().byId(this.getId()+"_oAppView")){sap.ui.getCore().byId(this.getId()+"_oAppView").destroy();}if(sap.ui.getCore().byId(this.getId()+"_oSplitAppView")){sap.ui.getCore().byId(this.getId()+"_oSplitAppView").destroy();}},
onAfterRendering:function(){if(!this.bStopRendering){q.sap.log.debug("Feed Component properties:","","sap.collaboration.components.fiori.feed.Component.onAfterRendering()");q.sap.log.debug("width: "+this.getWidth());q.sap.log.debug("height: "+this.getHeight());q.sap.log.debug("oDataServiceUrl: "+this.getODataServiceUrl());q.sap.log.debug("feedType: "+this.getFeedType());q.sap.log.debug("groupIds: "+this.getGroupIds());q.sap.log.debug("object: "+JSON.stringify(this.getObject()));try{if(this.getMode()===A.widget){var o=sap.ui.view({id:this.getId()+"_oAppView",viewData:{controlId:this.getId(),odataModel:this.oOdataModel,appType:this.getMode(),feedType:this.getFeedType(),groupIds:this.getGroupIds(),object:this.getObject(),langBundle:this.oLangBundle},type:a.JS,viewName:"sap.collaboration.components.fiori.feed.app.App"});o.placeAt(this.getId());}else if(this.getMode()===A.split){var s=sap.ui.view({id:this.getId()+"_oSplitAppView",viewData:{controlId:this.getId(),odataModel:this.oOdataModel,appType:this.getMode(),object:this.getObject(),langBundle:this.oLangBundle},type:a.JS,viewName:"sap.collaboration.components.fiori.feed.splitApp.SplitApp"});s.placeAt(this.getId());}}catch(e){q.sap.log.error(e,"","sap.collaboration.components.fiori.feed.Component.onAfterRendering()");this.oCommonUtil.displayError(e);}}},
render:function(r){r.write("<div id='"+this.getId()+"' style='width:"+this.getWidth()+";height:"+this.getHeight()+"'");r.write(">");r.write("</div>");},
getMode:function(){return this.mode;},
validateInputParameters:function(){var e;if(this.getFeedType()==F.object||this.getFeedType()==F.objectGroup){if(!this.getObject()){e=new Error("Object is undefined or null");q.sap.log.error(e,"","sap.collaboration.components.fiori.feed.Component.validateInputParameters()");throw e;}else if(!this.getObject().id){e=new Error("Missing Object ID");q.sap.log.error(e,"","sap.collaboration.components.fiori.feed.Component.validateInputParameters()");throw e;}}if(this.getFeedType()==F.object){if(!this.getObject().type){e=new Error("Missing Object Type");q.sap.log.error(e,"","sap.collaboration.components.fiori.feed.Component.validateInputParameters()");throw e;}}}
});
return b;});
sap.ui.predefine('sap/collaboration/components/fiori/feed/app/App.controller',["sap/ui/core/mvc/Controller","jquery.sap.global","sap/collaboration/components/utils/OdataUtil","sap/collaboration/components/utils/CommonUtil","sap/ui/core/mvc/View","sap/ui/core/library","sap/collaboration/library"],function(C,q,O,a,V,c,l){"use strict";var F=l.FeedType;var b=c.mvc.ViewType;sap.ui.controller("sap.collaboration.components.fiori.feed.app.App",{onInit:function(){this.oApp=this.getView().oApp;this.oOdataModel=this.getView().getViewData().odataModel;this.oLangBundle=this.getView().getViewData().langBundle;this.sPrefixId=this.getView().getViewData().controlId;this.sAppType=this.getView().getViewData().appType;this.sFeedType=this.getView().getViewData().feedType;this.sGroupIds=this.getView().getViewData().groupIds;this.oBusinessObject=this.getView().getViewData().object;},onBeforeRendering:function(){try{this.initializeUtils();this.createDetailPage();}catch(e){q.sap.log.error(e,"","sap.collaboration.components.fiori.feed.app.App.controller.onBeforeRendering()");this.oCommonUtil.displayError();}},initializeUtils:function(){if(!this.oODataUtil){this.oODataUtil=new O();}if(!this.oCommonUtil){this.oCommonUtil=this.oCommonUtil=new a();}},createDetailPage:function(){try{var v=this.sPrefixId+"detailView";if(!this.oApp.getPage(v)){this.initOData();var d=sap.ui.view({id:v,viewData:{controlId:this.sPrefixId,jamURL:this.sJamUrl,jamToken:this.sJamToken,appType:this.sAppType,feedType:this.sFeedType,groupIds:this.sGroupIds,object:this.oBusinessObject,langBundle:this.oLangBundle},type:b.JS,viewName:"sap.collaboration.components.fiori.feed.commons.Detail"});this.oApp.addPage(d);this.oApp.setInitialPage(d);}}catch(e){q.sap.log.error(e,"","sap.collaboration.components.fiori.feed.app.App.controller.createDetailPage()");throw e;}},getGroupIds:function(){var g;if(this.sFeedType===F.group&&(this.sGroupIds===undefined||this.sGroupIds==="")){g=this.oODataUtil.getGroupsData(this.oOdataModel,"/Groups");this.sGroupIds=this.oODataUtil.getGroupIds(g);}else if(this.sFeedType===F.objectGroup&&(this.sGroupIds===undefined||this.sGroupIds==="")){g=this.oODataUtil.getGroupsData(this.oOdataModel,"/BusinessObjects('"+this.oBusinessObject.id+"')/AssignedGroups");this.sGroupIds=this.oODataUtil.getGroupIds(g);}else if(this.sFeedType===F.objectGroup&&!(this.sGroupIds===undefined||this.sGroupIds==="")){g=this.oODataUtil.getGroupsData(this.oOdataModel,"/BusinessObjects('"+this.oBusinessObject.id+"')/AssignedGroups");var s=this.oODataUtil.getGroupIds(g);this.sGroupIds=this.filterGroupIds(s);}},filterGroupIds:function(s){var g;var d=s.split(",");var I=this.sGroupIds.split(",");for(var i=0;i<I.length;i++){if(d.indexOf(I[i])===-1){I.splice(i,1);i=i-1;}}if(I.length!==0){g=I.join();}else{g="";}return g;},initOData:function(){var s=this;var B=[];var A=false;var p=function(d){s.parseBatchResults(d);};var f=function(e){q.sap.log.error(e,"","sap.collaboration.components.fiori.feed.dialog.Component.initOdata(), fnBatchErrorCallback()");throw e;};try{B=this.createBatchRequests();this.oODataUtil.executeODataBatchRequest(this.oOdataModel,B,p,A,f);}catch(i){q.sap.log.error(i,"","sap.collaboration.components.fiori.feed.app.App.controller.initOdata()");throw i;}},createBatchRequests:function(){var s=this;var B=[];try{if(!s.sJamUrl){B.push(s.oODataUtil.createJamUrlBatchOperation(s.oOdataModel));}B.push(s.oODataUtil.createJamTokenBatchOperation(s.oOdataModel));switch(s.sFeedType){case F.object:B=B.concat(s.createExternalUrlBatchRequest(s.oODataUtil,s.oBusinessObject));break;case F.group:B.push(s.oODataUtil.createGetGroupsDataBatchOperation(s.oOdataModel));break;case F.objectGroup:B.push(s.createObjectGroupBatchRequest(s.oODataUtil,s.oBusinessObject));break;}}catch(o){q.sap.log.error(o,"","sap.collaboration.components.fiori.feed.app.App.controller.createBatchRequests()");throw o;}return B;},createExternalUrlBatchRequest:function(o,B){var s=this;var d=[];if(o&&B){if(B.id){d.push(o.createExternalOdataUrlBatchOperation(s.oOdataModel,B.id));}if(B.type){d.push(o.createExternalOdataUrlBatchOperation(s.oOdataModel,B.type));}}return d;},createObjectGroupBatchRequest:function(o,B){var s=this;var d;if(o&&B&&B.id){d=o.createGetObjectGroupsBatchOperation(s.oOdataModel,B.id);}else{var e=new Error("Missing parameters. Cannot create a batch request for Object Group.");q.sap.log.error(e,"","sap.collaboration.components.fiori.feed.app.App.controller.createObjectGroupBatchRequest()");throw e;}return d;},parseBatchResults:function(B){var s=this;var i=0;if(!s.sJamUrl){if(B[i].error){throw new Error(B[i].error);}else{s.sJamUrl=B[i][s.oODataUtil.OdataUtilConstants.EndPoint.GetCollaborationHostUrl].Url;}i++;}if(B[i].error){throw new Error(B[i].error);}else{s.sJamToken=B[i][s.oODataUtil.OdataUtilConstants.EndPoint.GetSingleUseToken].Id;}i++;if(s.sFeedType==F.object){if(B[i].error){throw new Error(B[i].error);}else{s.oBusinessObject.id=B[i][s.oODataUtil.OdataUtilConstants.EndPoint.GetExternalODataURL].URL;s.oBusinessObject.odata_url=s.oBusinessObject.id;}i++;if(B[i].error){throw new Error(B[i].error);}else{s.oBusinessObject.type=B[i][s.oODataUtil.OdataUtilConstants.EndPoint.GetExternalODataURL].URL;s.oBusinessObject.metadata_url=s.oBusinessObject.type;}}else if(s.sFeedType==F.group||s.sFeedType==F.objectGroup){if(B[i].error){throw new Error(B[i].error);}else{var d=s.oODataUtil.getGroupIds(B[i].results);if(!s.sGroupIds){s.sGroupIds=d;}else{s.sGroupIds=s.filterGroupIds(d);}}}}});});
sap.ui.predefine('sap/collaboration/components/fiori/feed/app/App.view',["sap/ui/core/mvc/JSView","sap/m/App"],function(J,A){"use strict";sap.ui.jsview("sap.collaboration.components.fiori.feed.app.App",{getControllerName:function(){return"sap.collaboration.components.fiori.feed.app.App";},createContent:function(c){this.sPrefixId=this.getViewData().controlId;this.oApp=new A(this.sPrefixId+"app");return this.oApp;}});});
sap.ui.predefine('sap/collaboration/components/fiori/feed/commons/Detail.controller',['sap/collaboration/components/utils/JamUtil','sap/ui/core/mvc/Controller','sap/collaboration/library','jquery.sap.global'],function(J,C,l,q){"use strict";var F=l.FeedType;var A=l.AppType;sap.ui.controller("sap.collaboration.components.fiori.feed.commons.Detail",{onInit:function(){this.sJamToken=this.getView().getViewData().jamToken;this.sJamURL=this.getView().getViewData().jamURL;this.oLangBundle=this.getView().getViewData().langBundle;this.sPrefixId=this.getView().getViewData().controlId;this.oBusinessObject=this.getView().getViewData().businessObject;this.bJamWidgetInitialized=false;if(this.getView().getViewData().appType===A.split){this.sFeedType=F.follows;}else{this.sFeedType=this.getView().getViewData().feedType;this.getView().oDetailPage.setShowHeader(false);}this.oJamUtil=new J();},onBeforeRendering:function(){},onAfterRendering:function(){try{this.loadFeedWidget(this.sJamURL);}catch(e){q.sap.log.error(e,"","sap.collaboration.components.fiori.feed.commons.Detail.onInit()");throw e;}},loadFeedWidget:function(j){var s=this;try{var g=s.getView().getViewData().groupIds;var w=this.oJamUtil.prepareWidgetData(s.sJamToken,s.sFeedType,g,s.oBusinessObject);var L=function(r){q.sap.log.info("Jam Feed Widget Loaded Successfully","sap.collaboration.components.fiori.feed.commons.Detail.onInit()");s.oJamUtil.initializeJamWidget(s.sJamURL);s.bJamWidgetInitialized=true;s.oJamUtil.createJamWidget(s.sPrefixId+"widgetContainer",w);};var f=function(e){q.sap.log.error(e,"","sap.collaboration.components.fiori.feed.commons.Detail.loadFeedWidgetScript()");throw e;};if(this.bJamWidgetInitialized===false){this.oJamUtil.loadFeedWidgetScript(j,L,f);}else{this.oJamUtil.createJamWidget(s.sPrefixId+"widgetContainer",w);}}catch(e){q.sap.log.error(e,"","sap.collaboration.components.fiori.feed.commons.Detail.loadFeedWidgetScript()");throw e;}}});});
sap.ui.predefine('sap/collaboration/components/fiori/feed/commons/Detail.view',["sap/ui/core/mvc/JSView","sap/m/Page","sap/m/ScrollContainer"],function(J,P,S){"use strict";sap.ui.jsview("sap.collaboration.components.fiori.feed.commons.Detail",{getControllerName:function(){return"sap.collaboration.components.fiori.feed.commons.Detail";},createContent:function(c){var l=this.getViewData().langBundle;this.sPrefixId=this.getViewData().controlId;this.oDetailPage=new P(this.sPrefixId+"feedDetailsPage",{title:l.getText("FRV_DOMAIN_DATA_FEED_TYPES_FOLLOWS"),enableScrolling:false,content:[new S(this.sPrefixId+"widgetContainer",{width:"100%",height:"100%",horizontal:false,vertical:false})]});return this.oDetailPage;}});});
sap.ui.predefine('sap/collaboration/components/fiori/feed/dialog/Component',['sap/collaboration/components/utils/CommonUtil','sap/collaboration/components/utils/JamUtil','sap/collaboration/components/utils/OdataUtil','sap/collaboration/library','sap/ui/core/UIComponent','jquery.sap.global','sap/ui/model/odata/ODataModel','sap/ui/core/mvc/View','sap/ui/core/library','sap/m/Dialog','sap/m/Button','sap/ui/Device'],function(C,J,O,l,U,q,a,V,c,D,B,b){"use strict";var d=c.mvc.ViewType;var A=l.AppType;var F=l.FeedType;
var e=U.extend("sap.collaboration.components.fiori.feed.dialog.Component",{
metadata:{includes:["../../../resources/css/Sharing.css"],properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"575px"},height:{type:"sap.ui.core.CSSSize",defaultValue:"605px"},feedType:{type:"string",defaultValue:F.object},groupIds:{type:"string"},object:{type:"object"},businessObject:{type:"object"}},aggregations:{},events:{}},
systemSettings:{oDataServiceUrl:"/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV",oCollaborationHostRestService:"/sap/bc/ui2/smi/rest_tunnel/Jam//v1",oCollaborationHostODataService:"/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1/OData"},
init:function(){this.oCommonUtil=new C();this.oJamUtil=new J();this.oLangBundle=this.oCommonUtil.getLanguageBundle();this.sJamUrl=undefined;this.sJamToken=undefined;this.oOdataModel=undefined;this.oODataUtil=undefined;this.oBusinessObject={};U.prototype.init.apply(this);},
setSettings:function(s){if(s){this.setFeedType(s.feedType);this.setGroupIds(s.groupIds);this.setObject(s.object);this.setBusinessObject(s.businessObject);}else{var E=new Error("Settings object is undefined");q.sap.log.error(E.stack);}},
open:function(){this._logComponentProperties();try{this._validateInputParameters(this.mProperties);this._createFeedDialog();this._requestWidgetData();this.oFeedDialog.open();}catch(E){q.sap.log.error(E.stack);this.oCommonUtil.displayError();}},
onBeforeRendering:function(){},
onAfterRendering:function(){},
render:function(r){},
_requestWidgetData:function(){var s=this._getCSRFToken();var f=this;var g=true;var h=this.systemSettings.oCollaborationHostRestService;this._initOData();if(this.getObject()){this._getObjectWithoutMapping();}else if(this.getBusinessObject()){this._getObjectWithMapping();}var i=function(){if(this.readyState==4){if(this.status==201){f.sJamToken=this.responseXML.getElementsByTagName('single_use_token')[0].attributes[0].value;if(f.sJamUrl&&f.oBusinessObject.odata_url&&f.oBusinessObject.metadata_url){f._createFeedView();f.oFeedDialog.addContent(f.oFeedView);setTimeout(function(){f.oFeedDialog.setBusy(false);},3000);}}else{var E="The single use token from SAP Jam was not returned successfully";q.sap.log.error(E,"","sap.collaboration.components.utils.JamUtil.getJamSinglelUseTokens()");if(f.oFeedDialog.isOpen()===true){f.oFeedDialog.close();}f.oCommonUtil.displayError();}}};this.oJamUtil.getJamSinglelUseTokens(h,i,g,s);},
_getObjectWithoutMapping:function(){var s=this;var f=true;var g=[];var p=function(i){s._parseBatchResults(i);if(s.sJamToken){s._createFeedView();s.oFeedDialog.addContent(s.oFeedView);setTimeout(function(){s.oFeedDialog.setBusy(false);},3000);}};var h=function(E){q.sap.log.error(E,"","sap.collaboration.components.fiori.feed.dialog.Component._getObjectWithoutMapping(), fnBatchErrorCallback()");throw E;};g=this._createBatchRequests();this.oODataUtil.executeODataBatchRequest(this.oOdataModel,g,p,f,h);},
_getObjectWithMapping:function(){var s=this;var g=new q.Deferred();g.done(function(j){s.sJamUrl=j;});var f=new q.Deferred();f.done(function(m){s._setMappedObject(m);});q.when(g,f).fail(function(S){if(s.oFeedDialog&&s.oFeedDialog.isOpen()){s.oFeedDialog.close();}s.oCommonUtil.displayError();});this.oODataUtil.getJamUrl(this.oOdataModel,g);this.oODataUtil.getExternalObjectMapping(this.oOdataModel,this.getBusinessObject(),f);},
_setMappedObject:function(m){var s=this;this.oBusinessObject.id=m.Exid;this.oBusinessObject.type=m.ObjectType;this.oBusinessObject.odata_url=this.oBusinessObject.id;this.oBusinessObject.metadata_url=this.oBusinessObject.type;if(this.sJamToken){this._createFeedView();this.oFeedDialog.addContent(this.oFeedView);setTimeout(function(){s.oFeedDialog.setBusy(false);},3000);}},
_initOData:function(){var f=true;var o=this.systemSettings.oDataServiceUrl;if(!this.oOdataModel){this.oOdataModel=new a(o,f);}if(!this.oOdataModel.oMetadata.oMetadata){var E=new Error("Metadata is undefined");q.sap.log.error(E,"","sap.collaboration.components.fiori.feed.dialog.Component._requestWidgetData()");throw E;}if(!this.oODataUtil){this.oODataUtil=new O();}},
_getCSRFToken:function(){var s="";var o=this.systemSettings.oCollaborationHostODataService;var f=function(g){if(this.readyState==4){if(this.status==200){s=this.getResponseHeader('x-csrf-token');}}};this.oJamUtil.getCSRFToken(o,f,false);return s;},
_createBatchRequests:function(){var s=this;var f=[];if(!s.sJamUrl){f.push(s.oODataUtil.createJamUrlBatchOperation(s.oOdataModel));}f=f.concat(s._createExternalUrlBatchRequest(s.oODataUtil,s.getObject()));return f;},
_createExternalUrlBatchRequest:function(o,f){var s=this;var g=[];if(o&&f){if(f.id){g.push(o.createExternalOdataUrlBatchOperation(s.oOdataModel,f.id));}if(f.type){g.push(o.createExternalOdataUrlBatchOperation(s.oOdataModel,f.type));}}return g;},
_parseBatchResults:function(f){var s=this;var i=0;if(!s.sJamUrl){if(f[i].error){throw new Error(f[i].error);}else{s.sJamUrl=f[i][s.oODataUtil.OdataUtilConstants.EndPoint.GetCollaborationHostUrl].URL;}i++;}if(f[i].error){throw new Error(f[i].error);}else{s.oBusinessObject.id=f[i][s.oODataUtil.OdataUtilConstants.EndPoint.GetExternalODataURL].URL;s.oBusinessObject.odata_url=s.oBusinessObject.id;}i++;if(f[i].error){throw new Error(f[i].error);}else{s.oBusinessObject.type=f[i][s.oODataUtil.OdataUtilConstants.EndPoint.GetExternalODataURL].URL;s.oBusinessObject.metadata_url=s.oBusinessObject.type;}},
_createFeedView:function(){var s=this;if(!s.oFeedView){s.oFeedView=sap.ui.view({id:s.getId()+"_FeedView",height:"100%",viewData:{controlId:s.getId(),jamURL:s.sJamUrl,jamToken:s.sJamToken,appType:A.widget,feedType:s.getFeedType(),groupIds:s.getGroupIds(),businessObject:s.oBusinessObject,langBundle:s.oLangBundle},type:d.JS,viewName:"sap.collaboration.components.fiori.feed.commons.Detail"});}else{s.oFeedView.getController().sFeedType=s.getFeedType();s.oFeedView.getViewData().groupIds=s.getGroupIds();s.oFeedView.getController().oBusinessObject=s.oBusinessObject;}},
_createFeedDialog:function(){var s=this;if(!this.oFeedDialog){this.oFeedDialog=new D(this.getId()+"FeedDialog",{title:this.oLangBundle.getText("FEED_DIALOG_TITLE"),stretch:false,contentWidth:this.getWidth(),contentHeight:this.getHeight(),content:[],endButton:new B({text:this.oLangBundle.getText("CLOSE_BUTTON_TEXT"),press:function(){s.oFeedDialog.close();}})});if(b.system.phone){this.oFeedDialog.setStretch(true);}}this.oFeedDialog.setBusy(true);},
_validateInputParameters:function(i){var E;if(!i){E=new Error("Input paremeters are undefined");q.sap.log.error(E.stack);throw E;}else if(i.businessObject){var f=i.businessObject;if(q.isEmptyObject(f)){E=new Error("Business Object is empty");q.sap.log.error(E.stack);throw E;}if(!f.appContext){E=new Error("Application context is undefined");q.sap.log.error(E.stack);throw E;}if(!f.odataServicePath){E=new Error("OData Service Path is undefined");q.sap.log.error(E.stack);throw E;}if(!f.collection){E=new Error("Collection is undefined");q.sap.log.error(E.stack);throw E;}if(!f.key){E=new Error("Key is undefined");q.sap.log.error(E.stack);throw E;}if(!f.name){E=new Error("Name is undefined");q.sap.log.error(E.stack);throw E;}}else if(i.object){var o=i.object;if(q.isEmptyObject(o)){E=new Error("Business Object is empty");q.sap.log.error(E.stack);throw E;}if(!o.id){E=new Error("Object is undefined");q.sap.log.error(E.stack);throw E;}if(!o.type){E=new Error("Missing Object Type");q.sap.log.error(E.stack);throw E;}}else{E=new Error("Neither an Object nor a Business Object was passed");throw E;}},
_logComponentProperties:function(){q.sap.log.debug("Share Component properties:","","sap.collaboration.components.fiori.dialog.Component._logComponentProperties()");q.sap.log.debug("width: "+this.getWidth());q.sap.log.debug("height: "+this.getHeight());q.sap.log.debug("oDataServiceUrl: "+this.systemSettings.oDataServiceUrl);q.sap.log.debug("feedType: "+this.getFeedType());q.sap.log.debug("groupIds: "+this.getGroupIds());q.sap.log.debug("object: "+JSON.stringify(this.getObject()));q.sap.log.debug("businessObject: "+JSON.stringify(this.getBusinessObject()));}
});
return e;});
sap.ui.predefine('sap/collaboration/components/fiori/feed/splitApp/FeedTypeMaster.controller',["sap/ui/core/mvc/Controller","sap/collaboration/library","sap/collaboration/components/utils/JamUtil"],function(C,l,J){"use strict";var F=l.FeedType;sap.ui.controller("sap.collaboration.components.fiori.feed.splitApp.FeedTypeMaster",{onInit:function(){this.sJamToken=this.getView().getViewData().jamToken;this.sPrefixId=this.getView().getViewData().controlId;this.oBusinessObject=this.getView().getViewData().object;},listItemPress:function(f){if(f===F.follows||f===F.company){this.getJamWidget(f);this.setDetailPageTitle(f);}else{this.navigateToGroupMaster(f);}},getJamWidget:function(f){var j=new J();var w=j.prepareWidgetData(this.sJamToken,f,"",this.oBusinessObject);j.createJamWidget(this.sPrefixId+"widgetContainer",w);},setDetailPageTitle:function(f){var d;f===F.follows?d=this.getView().oLangBundle.getText("FRV_DOMAIN_DATA_FEED_TYPES_FOLLOWS"):d=this.getView().oLangBundle.getText("FRV_DOMAIN_DATA_FEED_TYPES_COMPANY");sap.ui.getCore().byId(this.sPrefixId+"feedDetailsPage").setTitle(d);},navigateToGroupMaster:function(f){var n=this.createNavigationData(f);sap.ui.getCore().getEventBus().publish("nav","to",n);},createNavigationData:function(f){var d;f===F.group?d={viewName:"sap.collaboration.components.fiori.feed.splitApp.GroupMaster",viewId:this.sPrefixId+"groupMasterView",data:{feedType:F.group,lanBundle:this.getView().oLangBundle,groupMasterPageTitle:this.getView().oLangBundle.getText("GROUP_MASTER_PAGE_GROUP_TITLE")}}:d={viewName:"sap.collaboration.components.fiori.feed.splitApp.GroupMaster",viewId:this.sPrefixId+"groupMasterView",data:{feedType:F.object,lanBundle:this.getView().oLangBundle,groupMasterPageTitle:this.getView().oLangBundle.getText("GROUP_MASTER_PAGE_BO_TITLE")}};return d;}});});
sap.ui.predefine('sap/collaboration/components/fiori/feed/splitApp/FeedTypeMaster.view',["sap/ui/core/mvc/JSView","sap/m/Page","sap/m/List","sap/m/StandardListItem","sap/m/library"],function(J,P,L,S,m){"use strict";var a=m.ListType;sap.ui.jsview("sap.collaboration.components.fiori.feed.splitApp.FeedTypeMaster",{getControllerName:function(){return"sap.collaboration.components.fiori.feed.splitApp.FeedTypeMaster";},createContent:function(c){this.oLangBundle=this.getViewData().langBundle;this.sPrefixId=this.getViewData().controlId;return new P(this.sPrefixId+"feedTypePage",{title:this.oLangBundle.getText("FEED_MASTER_PAGE_TITLE"),content:[new L(this.sPrefixId+"FeedTypes",{inset:true,items:[new S({title:this.oLangBundle.getText("FRV_DOMAIN_DATA_FEED_TYPES_FOLLOWS"),type:a.Active,selected:true,press:function(){c.listItemPress("follows");}}),new S({title:this.oLangBundle.getText("FRV_DOMAIN_DATA_FEED_TYPES_COMPANY"),type:a.Active,press:function(){c.listItemPress("company");}}),new S({title:this.oLangBundle.getText("FRV_DOMAIN_DATA_FEED_TYPES_GROUP"),type:a.Active,press:function(){c.listItemPress("group");}}),new S({title:this.oLangBundle.getText("FRV_DOMAIN_DATA_FEED_TYPES_BO"),type:a.Active,press:function(){c.listItemPress("context");}})]})]});}});});
sap.ui.predefine('sap/collaboration/components/fiori/feed/splitApp/GroupMaster.controller',["sap/ui/core/mvc/Controller","sap/m/StandardListItem","sap/m/library","sap/collaboration/components/utils/OdataUtil","sap/collaboration/components/utils/JamUtil","sap/collaboration/library","sap/ui/model/json/JSONModel"],function(C,S,m,O,J,l,a){"use strict";var F=l.FeedType;var L=m.ListType;sap.ui.controller("sap.collaboration.components.fiori.feed.splitApp.GroupMaster",{onInit:function(){this.oOdataModel=this.getView().getViewData().odataModel;this.oBusinessObject=this.getView().getViewData().object;this.sFeedType=this.getView().getViewData().feedType;this.sPageTitle=this.getView().getViewData().pageTitle;this.sJamToken=this.getView().getViewData().jamToken;this.oLangBundle=this.getView().getViewData().langBundle;this.sPrefixId=this.getView().getViewData().controlId;},onBeforeRendering:function(){var s=this;this.getView().groupMasterPage.setTitle(this.sPageTitle);this.initializeUtils();this.setViewModel();var o=new S();o.bindProperty("title","Name");o.setType(L.Active);o.attachPress(function(){var g=this.getBindingContext().getProperty(this.getBindingContext().getPath()).Id;var G=this.getBindingContext().getProperty(this.getBindingContext().getPath()).Name;var w=s.oJamUtil.prepareWidgetData(s.sJamToken,s.sFeedType,g);s.oJamUtil.createJamWidget(s.sPrefixId+"widgetContainer",w);sap.ui.getCore().byId(s.sPrefixId+"feedDetailsPage").setTitle(G);});sap.ui.getCore().byId(this.sPrefixId+"groupsList").bindItems("/groupsData",o);var b=new S({title:this.oLangBundle.getText("GROUP_MASTER_LIST_All_GROUPS")});b.setType(L.Active);b.attachPress(function(){var g=s.oODataUtil.getGroupIds(s.aGroupData);var w=s.oJamUtil.prepareWidgetData(s.sJamToken,s.sFeedType,g);s.oJamUtil.createJamWidget(s.sPrefixId+"widgetContainer",w);sap.ui.getCore().byId(s.sPrefixId+"feedDetailsPage").setTitle(s.oLangBundle.getText("GROUP_MASTER_LIST_All_GROUPS"));});sap.ui.getCore().byId(this.sPrefixId+"groupsList").insertItem(b,0);},onAfterRendering:function(){},initializeUtils:function(){this.oODataUtil=new O();this.oJamUtil=new J();},setViewModel:function(){this.aGroupData;this.sFeedType===F.group?this.aGroupData=this.oODataUtil.getGroupsData(this.oOdataModel,"/Groups"):this.aGroupData=this.oODataUtil.getGroupsData(this.oOdataModel,"/BusinessObjects('"+this.oBusinessObject.id+"')/AssignedGroups");this.oViewData={groupsData:this.aGroupData};this.oViewModel=new a(this.oViewData);this.getView().setModel(this.oViewModel);},onNavButtonTap:function(){sap.ui.getCore().getEventBus().publish("nav","back");}});});
sap.ui.predefine('sap/collaboration/components/fiori/feed/splitApp/GroupMaster.view',["sap/ui/core/mvc/JSView","sap/m/Page","sap/m/List"],function(J,P,L){"use strict";sap.ui.jsview("sap.collaboration.components.fiori.feed.splitApp.GroupMaster",{getControllerName:function(){return"sap.collaboration.components.fiori.feed.splitApp.GroupMaster";},createContent:function(c){this.sPrefixId=this.getViewData().controlId;this.groupMasterPage=new P(this.sPrefixId+"groupPage",{title:this.getViewData().groupMasterpageTitle,showNavButton:true,navButtonPress:c.onNavButtonTap,content:[new L(this.sPrefixId+"groupsList",{inset:true})]});return this.groupMasterPage;}});});
sap.ui.predefine('sap/collaboration/components/fiori/feed/splitApp/SplitApp.controller',["sap/ui/core/mvc/Controller","sap/collaboration/components/utils/OdataUtil","sap/ui/core/mvc/View","sap/ui/core/library","jquery.sap.global"],function(C,O,V,c,q){"use strict";var a=c.mvc.ViewType;sap.ui.controller("sap.collaboration.components.fiori.feed.splitApp.SplitApp",{onInit:function(){this.oSplitApp=this.getView().oSplitApp;this.sAppType=this.getView().getViewData().appType;this.oOdataModel=this.getView().getViewData().odataModel;this.oBusinessObject=this.getView().getViewData().object;this.oLangBundle=this.getView().getViewData().langBundle;this.sPrefixId=this.getView().getViewData().controlId;this.oEventBus=sap.ui.getCore().getEventBus();this.oEventBus.subscribe("nav","to",this.navToHandler,this);this.oEventBus.subscribe("nav","back",this.navBackHandler,this);},onBeforeRendering:function(){this.createMasterDetail();},createMasterDetail:function(){var o=new O();var j=o.getJamUrl(this.oOdataModel);this.sJamToken=o.getJamToken(this.oOdataModel);var m=sap.ui.view({id:this.sPrefixId+"masterView",viewData:{controlId:this.sPrefixId,jamToken:this.sJamToken,langBundle:this.oLangBundle,object:this.oBusinessObject},type:a.JS,viewName:"sap.collaboration.components.fiori.feed.splitApp.FeedTypeMaster"});var d=sap.ui.view({id:this.sPrefixId+"detailView",viewData:{controlId:this.sPrefixId,appType:this.sAppType,jamURL:j,jamToken:this.sJamToken,langBundle:this.oLangBundle,object:this.oBusinessObject},type:a.JS,viewName:"sap.collaboration.components.fiori.feed.commons.Detail"});this.oSplitApp.addDetailPage(d);this.oSplitApp.addMasterPage(m);this.oSplitApp.setInitialDetail(d);this.oSplitApp.setInitialMaster(m);},navToHandler:function(s,e,d){if(d&&d.viewId===this.sPrefixId+"groupMasterView"){if(!sap.ui.getCore().byId(d.viewId)){var v=sap.ui.view({id:d.viewId,viewData:{controlId:this.sPrefixId,odataModel:this.oOdataModel,object:this.oBusinessObject,feedType:d.data.feedType,pageTitle:d.data.groupMasterPageTitle,jamToken:this.sJamToken,langBundle:this.oLangBundle},type:a.JS,viewName:d.viewName});this.oSplitApp.addMasterPage(v);}else{sap.ui.getCore().byId(d.viewId).getController().sFeedType=d.data.feedType;sap.ui.getCore().byId(d.viewId).getController().sPageTitle=d.data.groupMasterPageTitle;sap.ui.getCore().byId(d.viewId).rerender();}this.oSplitApp.to(d.viewId);}else{q.sap.log.error("nav-to event cannot be processed. Invalid data: "+d);}},navBackHandler:function(){this.oSplitApp.backMaster();}});});
sap.ui.predefine('sap/collaboration/components/fiori/feed/splitApp/SplitApp.view',["sap/ui/core/mvc/JSView","sap/m/SplitApp"],function(J,S){"use strict";sap.ui.jsview("sap.collaboration.components.fiori.feed.splitApp.SplitApp",{getControllerName:function(){return"sap.collaboration.components.fiori.feed.splitApp.SplitApp";},createContent:function(c){this.sPrefixId=this.getViewData().controlId;this.oSplitApp=new S(this.sPrefixId+"splitApp");return this.oSplitApp;}});});
sap.ui.predefine('sap/collaboration/components/fiori/notification/Component',['sap/collaboration/components/utils/CommonUtil','sap/collaboration/library','sap/ui/core/UIComponent','jquery.sap.global','sap/ui/core/mvc/View','sap/ui/core/library'],function(C,l,U,q,V,c){"use strict";var a=c.mvc.ViewType;
var b=U.extend("sap.collaboration.components.fiori.notification.Component",{
metadata:{properties:{oDataServiceUrl:{type:"sap.ui.core.URI",defaultValue:"/sap/opu/odata/sap/SM_INTEGRATION_SRV"},numberOfNotifications:{type:"int",defaultValue:10},transitionInterval:{type:"int",defaultValue:10},refreshInterval:{type:"int",defaultValue:300},notificationsTargetUrl:{type:"sap.ui.core.URI"}}},
init:function(){this.iMillisecondsPerSecond=1000;this.oCommonUtil=new C();this.oLangBundle=this.oCommonUtil.getLanguageBundle();this.sStyleClassPrefix="sapClbNotif";},
onBeforeRendering:function(){},
onAfterRendering:function(){q.sap.log.debug("Notification Component properties:",this.mProperties.toString(),"sap.collaboration.components.fiori.notification.Component.onAfterRendering()");q.sap.log.debug("oDataServiceUrl: "+this.getODataServiceUrl());q.sap.log.debug("numberOfNotifications: "+this.getNumberOfNotifications());q.sap.log.debug("transitionInterval: "+this.getTransitionInterval());q.sap.log.debug("refreshInterval: "+this.getRefreshInterval());q.sap.log.debug("notificationsTargetUrl: "+this.getNotificationsTargetUrl());if(!this.oNotificationView){this.oNotificationView=sap.ui.view({id:this.getId()+"_NotificationView",viewData:{controlId:this.getId(),langBundle:this.oLangBundle,oDataServiceUrl:this.getODataServiceUrl(),numberOfNotifications:this.getNumberOfNotifications(),transitionInterval:this.getTransitionInterval()*this.iMillisecondsPerSecond,refreshInterval:this.getRefreshInterval()*this.iMillisecondsPerSecond,notificationsTargetUrl:this.getNotificationsTargetUrl(),styleClassPrefix:this.sStyleClassPrefix},type:a.JS,viewName:"sap.collaboration.components.fiori.notification.Notification"});}this.oNotificationView.placeAt(this.getId());},
exit:function(){this.deactivateNotificationRefreshAndTransition();this.oNotificationView.destroy();},
render:function(r){r.write("<div id='"+this.getId()+"'");r.addClass(this.sStyleClassPrefix+"Component");r.addClass(this.sStyleClassPrefix+"CursorPointer");r.writeClasses();r.write(">");r.write("</div>");},
deactivateNotificationRefreshAndTransition:function(){this.oNotificationView.getController().deactivateNotificationTransition();this.oNotificationView.getController().deactivateNotificationRefresh();}
});
return b;});
sap.ui.predefine('sap/collaboration/components/fiori/notification/Notification.controller',['sap/collaboration/components/utils/CommonUtil','sap/collaboration/components/utils/NotificationTypeUtil','sap/collaboration/components/utils/OdataUtil','sap/ui/core/mvc/Controller','sap/ui/model/odata/ODataModel','sap/ui/Global'],function(C,N,O,a,b,G){"use strict";sap.ui.controller("sap.collaboration.components.fiori.notification.Notification",{onInit:function(){this.initializeRefreshAndTransitionState();this.sPrefixId=this.getView().getViewData().controlId;this.oView=this.getView();this.oLangBundle=this.oView.oLangBundle;this.sOdataServiceUrl=this.getView().getViewData().oDataServiceUrl;this.iTransitionInterval=this.getView().getViewData().transitionInterval;this.iRefreshInterval=this.getView().getViewData().refreshInterval;this.sProfilePhotoHiddenStyleClass=this.oView.sStyleClassPrefix+"ProfileImageHidden";this.sLoadingAnimationDummyTextStyleClass=this.oView.sStyleClassPrefix+"LoadingText";this.sNewNotificationTextStyleClass=this.oView.sStyleClassPrefix+"NewNotificationText";this.sErrorTextStyleClass=this.oView.sStyleClassPrefix+"ErrorText";this.oView.oNotificationNewNotificationOrErrorText.addStyleClass(this.sLoadingAnimationDummyTextStyleClass);this.oView.oNotificationNewNotificationOrErrorText.setText(". . . . . . . . . . . .");this.oView.oNotificationNewNotificationOrErrorText.setBusy(true);this.oNotificationTypeUtil=new N();},initializeRefreshAndTransitionState:function(){this.bErrorInUnreadCountODataResponse=true;this.bErrorInNoticesODataResponse=true;this.bErrorInODataResponse=true;this.iNotificationCurrentIndex=undefined;this.iNotificationPreviousIndex=undefined;this.aNotifications=undefined;this.bIsTransitionActive=false;this.iNotificationsTransitionCallbackRegistrationId=undefined;this.bIsRefreshActive=false;this.iNotificationsRefreshCallbackRegistrationId=undefined;this.iNotificationUnreadCount=undefined;this.iMaxNotificationsToDisplay=this.getView().getViewData().numberOfNotifications;this.aImageControls=this.getView().getViewData().aProfilePhotos;this.iNotificationsToDisplay=undefined;this.aUsedImageControls=[];},onBeforeRendering:function(){this.initializeCommonUtil();this.initializeOdataModel();this.initializeOdataUtils();},onAfterRendering:function(){this.fetchNotificationData();},initializeOdataModel:function(){var c=true;this.oOdataModel=new b(this.sOdataServiceUrl,c);},initializeOdataUtils:function(){this.oODataUtil=new O();},initializeCommonUtil:function(){this.oCommonUtil=new C();},fetchNotificationData:function(){var r=[];var n=this.oODataUtil.createNotificationUnreadCountBatchOperation(this.oOdataModel);var o=this.oODataUtil.createNotificationBatchOperation(this.oOdataModel,this.iMaxNotificationsToDisplay);r.push(n);r.push(o);var p=this.getFunctionParseResult();var e=this.getFunctionErrorCallBack();this.oODataUtil.executeODataBatchRequest(this.oOdataModel,r,p,true,e);},getFunctionParseResult:function(){var s=this;return function(r){s.oView.oNotificationNewNotificationOrErrorText.setBusy(false);s.oView.oNotificationNewNotificationOrErrorText.setText("");s.oView.oNotificationNewNotificationOrErrorText.removeStyleClass(s.sLoadingAnimationDummyTextStyleClass);s.initializeRefreshAndTransitionState();if(r[0].error&&!r[1].error){s.bErrorInNoticesODataResponse=false;s.aNotifications=r[1].results;s.clearAllUiTexts();s.hideAllProfilePhotoControls();s.setUiContent();s.activateNotificationRefresh();}else if(!r[0].error&&r[1].error){s.bErrorInUnreadCountODataResponse=false;s.iNotificationUnreadCount=r[0].GetNoticeUnreadCount.UnreadCount;s.clearAllUiTexts();s.hideAllProfilePhotoControls();s.setUiContent();s.activateNotificationRefresh();}else if(r[0].error&&r[1].error){s.clearAllUiTexts();s.hideAllProfilePhotoControls();s.setUiContent();s.activateNotificationRefresh();}else{s.bErrorInUnreadCountODataResponse=false;s.bErrorInNoticesODataResponse=false;s.bErrorInODataResponse=false;s.aNotifications=r[1].results;s.iNotificationUnreadCount=r[0].GetNoticeUnreadCount.UnreadCount;if(s.iMaxNotificationsToDisplay>0){if(s.aNotifications.length>0){if(s.iNotificationUnreadCount>0){s.iNotificationsToDisplay=Math.min(s.iMaxNotificationsToDisplay,s.aNotifications.length,s.iNotificationUnreadCount);s.iNotificationCurrentIndex=0;s.iNotificationPreviousIndex=s.iNotificationsToDisplay-1;s.clearAllUiTexts();s.hideAllProfilePhotoControls();s.setProfilePhotosSrc();s.setUiContent();s.activateNotificationTransition();s.activateNotificationRefresh();}else{s.iNotificationsToDisplay=1;s.iNotificationCurrentIndex=0;s.iNotificationPreviousIndex=s.iNotificationsToDisplay-1;s.clearAllUiTexts();s.hideAllProfilePhotoControls();s.setProfilePhotosSrc();s.setUiContent();s.activateNotificationRefresh();}}else{s.iNotificationsToDisplay=0;s.clearAllUiTexts();s.hideAllProfilePhotoControls();s.activateNotificationRefresh();}}else{s.iNotificationsToDisplay=0;s.clearAllUiTexts();s.hideAllProfilePhotoControls();}}};},getFunctionErrorCallBack:function(){var s=this;return function(e){s.initializeRefreshAndTransitionState();s.clearAllUiTexts();s.hideAllProfilePhotoControls();s.setUiContent();s.activateNotificationRefresh();};},setProfilePhotosSrc:function(){var s;var S;var p;for(var i=0;i<this.iNotificationsToDisplay;++i){s=this.aNotifications[i].SenderId;S=this.aNotifications[i].SenderFullName;p=this.getProfilePhotoURL(S,s);this.oView.aProfilePhotos[i].addStyleClass(this.sProfilePhotoHiddenStyleClass);this.oView.aProfilePhotos[i].setSrc(p);}},getProfilePhotoURL:function(s,S){if(s!==""){return this.sOdataServiceUrl+"/Members("+S+")/ProfilePhoto/$value";}else{return sap.ui.resource('sap.collaboration.components',"images/Anonymous.png");}},hideAllProfilePhotoControls:function(){for(var i=0;i<this.oView.aProfilePhotos.length;++i){this.oView.aProfilePhotos[i].addStyleClass(this.sProfilePhotoHiddenStyleClass);}},clearAllUiTexts:function(){this.oView.oNotificationTypeText.setText("");this.oView.oNotificationMessageText.setText("");this.oView.oNotificationUnreadCountText.setText("");this.oView.oNotificationNewNotificationOrErrorText.setText("");this.oView.oNotificationAgeText.setText("");this.oView.oNotificationGroupText.setText("");},setUiContent:function(){if(this.bErrorInODataResponse){this.oView.oNotificationNewNotificationOrErrorText.removeStyleClass(this.sNewNotificationTextStyleClass);this.oView.oNotificationNewNotificationOrErrorText.addStyleClass(this.sErrorTextStyleClass);this.oView.oNotificationNewNotificationOrErrorText.setText(this.oLangBundle.getText("NOTIF_ERROR_MESSAGE"));}else{var n=this.aNotifications[this.iNotificationCurrentIndex];var s="NOTIF_"+n.EventType.toUpperCase();var c=n.Message;var d;if(this.iNotificationUnreadCount>999){d=this.oLangBundle.getText("NOTIF_MORE_THAN_999_NEW_NOTIFICATIONS");}else{d=this.iNotificationUnreadCount;}var e=n.CreatedAt;var g=n.GroupName;var f=this.oNotificationTypeUtil.getRequiredNotificationPropertyNames(n.EventType);var h=this.getNotificationPropertyValues(f,n);this.oView.oNotificationTypeText.setText(this.oLangBundle.getText(s,h));this.oView.oNotificationMessageText.setText(c);this.oView.aProfilePhotos[this.iNotificationPreviousIndex].addStyleClass(this.sProfilePhotoHiddenStyleClass);this.oView.aProfilePhotos[this.iNotificationCurrentIndex].removeStyleClass(this.sProfilePhotoHiddenStyleClass);this.oView.oNotificationUnreadCountText.setText(d);this.oView.oNotificationNewNotificationOrErrorText.removeStyleClass(this.sErrorTextStyleClass);this.oView.oNotificationNewNotificationOrErrorText.addStyleClass(this.sNewNotificationTextStyleClass);this.oView.oNotificationNewNotificationOrErrorText.setText(this.oLangBundle.getText("NOTIF_NEW_NOTIFICATIONS"));var i=this.calculateNotificationAge(e,g).split("\n");var j=i[0];var k="";if(i.length>1){k=i[1];}this.oView.oNotificationAgeText.setText(j);this.oView.oNotificationGroupText.setText(k);this.iNotificationPreviousIndex=this.iNotificationCurrentIndex;this.iNotificationCurrentIndex=(this.iNotificationCurrentIndex+1)%this.iNotificationsToDisplay;}},getNotificationPropertyValues:function(n,o){var c=[];for(var i=0;i<n.length;i++){c.push(o[n[i]]);}return c;},calculateNotificationAge:function(c,g){if(!this.oCommonUtil.isValidDate(c)){return"";}var n=new Date();c.setMilliseconds(0);n.setMilliseconds(0);var d=60000;var e=d*60;var f=e*24;var h=n.getTime()-c.getTime();if(h>=f){var i=Math.round(parseFloat(h/f,10));if(i===1){if(g!==""){return this.oLangBundle.getText("NOTIF_DAY_AGO_GRP",[i.toString(),g]);}else{return this.oLangBundle.getText("NOTIF_DAY_AGO_NO_GRP",[i.toString()]);}}else{if(g!==""){return this.oLangBundle.getText("NOTIF_DAYS_AGO_GRP",[i.toString(),g]);}else{return this.oLangBundle.getText("NOTIF_DAYS_AGO_NO_GRP",[i.toString()]);}}}else if(h>=e){var j=Math.round(parseFloat(h/e,10));if(j===1){if(g!==""){return this.oLangBundle.getText("NOTIF_HOUR_AGO_GRP",[j.toString(),g]);}else{return this.oLangBundle.getText("NOTIF_HOUR_AGO_NO_GRP",[j.toString()]);}}else{if(g!==""){return this.oLangBundle.getText("NOTIF_HOURS_AGO_GRP",[j.toString(),g]);}else{return this.oLangBundle.getText("NOTIF_HOURS_AGO_NO_GRP",[j.toString()]);}}}else{var k=Math.round(parseFloat(h/d,10));if(k===1){if(g!==""){return this.oLangBundle.getText("NOTIF_MINUTE_AGO_GRP",[k.toString(),g]);}else{return this.oLangBundle.getText("NOTIF_MINUTE_AGO_NO_GRP",[k.toString()]);}}else{if(g!==""){return this.oLangBundle.getText("NOTIF_MINUTES_AGO_GRP",[k.toString(),g]);}else{return this.oLangBundle.getText("NOTIF_MINUTES_AGO_NO_GRP",[k.toString()]);}}}},activateNotificationTransition:function(){if(!this.bIsTransitionActive){this.iNotificationsTransitionCallbackRegistrationId=this.getTransitionRegistrationId();this.bIsTransitionActive=true;}},getTransitionRegistrationId:function(){return setInterval(this.setUiContent.bind(this),this.iTransitionInterval);},deactivateNotificationTransition:function(){if(this.bIsTransitionActive){clearInterval(this.iNotificationsTransitionCallbackRegistrationId);this.bIsTransitionActive=false;}},activateNotificationRefresh:function(){if(!this.bIsRefreshActive){this.iNotificationsRefreshCallbackRegistrationId=this.getRefreshRegistrationId();this.bIsRefreshActive=true;}},getRefreshRegistrationId:function(){return setInterval(this.refreshNotification.bind(this),this.iRefreshInterval);},deactivateNotificationRefresh:function(){if(this.bIsRefreshActive){clearInterval(this.iNotificationsRefreshCallbackRegistrationId);this.bIsRefreshActive=false;}},refreshNotification:function(){this.deactivateNotificationTransition();this.deactivateNotificationRefresh();this.fetchNotificationData();}});});
sap.ui.predefine('sap/collaboration/components/fiori/notification/Notification.view',['./NotificationContainer','sap/collaboration/library','sap/ui/core/mvc/JSView','sap/m/Image','sap/m/Text','sap/m/VBox','sap/ui/core/library'],function(N,l,J,I,T,V,c){"use strict";var a=c.TextAlign;sap.ui.jsview("sap.collaboration.components.fiori.notification.Notification",{getControllerName:function(){return"sap.collaboration.components.fiori.notification.Notification";},createContent:function(C){this.sPrefixId=this.getViewData().controlId;this.oLangBundle=this.getViewData().langBundle;this.sStyleClassPrefix=this.getViewData().styleClassPrefix;this.iNumberOfNotifications=this.getViewData().numberOfNotifications;this.sNotificationsTargetURL=this.getViewData().notificationsTargetUrl;var o=this.createContainerBox();return o;},createContainerBox:function(){var s=this;this.aProfilePhotos=this.createProfilePhotos();this.oNotificationTypeText=this.createNotificationTypeText();this.oNotificationMessageText=this.createNotificationMessageText();var n=this.createNotificationUnreadCountVBox();var A=this.createNotificationAgeAndGroupVBox();var C=new N(this.sPrefixId+"_ContainerBox");for(var i=0;i<this.aProfilePhotos.length;++i){C.addContent(this.aProfilePhotos[i]);}C.addContent(this.oNotificationTypeText);C.addContent(this.oNotificationMessageText);C.addContent(n);C.addContent(A);return C;},createProfilePhotos:function(){var p=[];for(var i=0;i<this.iNumberOfNotifications;++i){p.push(new I(this.sPrefixId+"_ProfileImage"+i,{densityAware:false,decorative:true}).addStyleClass(this.sStyleClassPrefix+"ProfileImage").addStyleClass(this.sStyleClassPrefix+"ProfileImageHidden").addStyleClass(this.sStyleClassPrefix+"CursorPointer"));}return p;},createNotificationTypeText:function(){return new T(this.sPrefixId+"_NotificationType").addStyleClass(this.sStyleClassPrefix+"NotificationTypeText").addStyleClass(this.sStyleClassPrefix+"CursorPointer");},createNotificationMessageText:function(){return new T(this.sPrefixId+"_NotificationMessage").addStyleClass(this.sStyleClassPrefix+"NotificationMessageText").addStyleClass(this.sStyleClassPrefix+"CursorPointer");},createNotificationUnreadCountText:function(){return new T(this.sPrefixId+"_NotificationUnreadCount").addStyleClass(this.sStyleClassPrefix+"NotificationUnreadCountText").addStyleClass(this.sStyleClassPrefix+"CursorPointer");},createNotificationNewNotificationOrErrorText:function(){return new T(this.sPrefixId+"_NewNotificationOrErrorText").addStyleClass(this.sStyleClassPrefix+"CursorPointer");},createNotificationUnreadCountVBox:function(){this.oNotificationUnreadCountText=this.createNotificationUnreadCountText();this.oNotificationNewNotificationOrErrorText=this.createNotificationNewNotificationOrErrorText();var n=new V(this.sPrefixId+"_UnreadCountVBox",{items:[this.oNotificationUnreadCountText,this.oNotificationNewNotificationOrErrorText]}).addStyleClass(this.sStyleClassPrefix+"NotificationUnreadContainer");return n;},createNotificationAgeAndGroupVBox:function(){this.oNotificationAgeText=new T(this.sPrefixId+"_NotificationAge",{textAlign:a.Right,}).addStyleClass(this.sStyleClassPrefix+"NotificationAgeAndGroupText").addStyleClass(this.sStyleClassPrefix+"CursorPointer");this.oNotificationGroupText=new T(this.sPrefixId+"_NotificationGroup",{textAlign:a.Right,}).addStyleClass(this.sStyleClassPrefix+"NotificationAgeAndGroupText").addStyleClass(this.sStyleClassPrefix+"CursorPointer");var A=new V(this.sPrefixId+"_AgeAndGroupVBox",{items:[this.oNotificationAgeText,this.oNotificationGroupText]}).addStyleClass(this.sStyleClassPrefix+"NotificationAgeAndGroupContainer");return A;},ontap:function(){window.open(this.sNotificationsTargetURL,window.name);}});});
sap.ui.predefine('sap/collaboration/components/fiori/notification/NotificationContainer',["sap/ui/core/Control"],function(C){"use strict";
var N=C.extend("sap.collaboration.components.fiori.notification.NotificationContainer",{
metadata:{aggregations:{"content":{singularName:"content"}}},
renderer:function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapClbNotifContainerBox");r.writeClasses();r.writeStyles();r.write(">");var a=c.getContent();for(var i=0,l=a.length;i<l;i++){r.renderControl(a[i]);}r.write("</div>");}
});
return N;});
sap.ui.predefine('sap/collaboration/components/fiori/sharing/Component',['sap/collaboration/components/utils/CommonUtil','sap/collaboration/library','sap/ui/core/UIComponent','sap/ui/core/mvc/View','sap/ui/core/library','jquery.sap.global'],function(C,l,U,V,c,q){"use strict";var a=c.mvc.ViewType;
var b=U.extend("sap.collaboration.components.fiori.sharing.Component",{
metadata:{includes:["../../resources/css/Sharing.css"],properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},oDataServiceUrl:{type:"sap.ui.core.URI",defaultValue:"/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV"},collaborationHostODataServiceUrl:{type:"sap.ui.core.URI",defaultValue:"/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1/OData"},tunnelServiceUrl:{type:"sap.ui.core.URI",defaultValue:"/sap/bc/z_sail_httproxy/Jam/api/v1/OData"},object:{type:"object"},attachments:{type:"object"},externalObject:{type:"object"}}},
init:function(){this.oCommonUtil=new C();this.oLangBundle=this.oCommonUtil.getLanguageBundle();this.sODataServiceUrl=undefined;this.sTunnelServiceUrl=undefined;this.sJamUrl=undefined;this.oODataUtil=undefined;this.oSharingView=undefined;this.oView=undefined;this.aJamGroups=[];this.bOdataOn=true;},
onBeforeRendering:function(){},
onAfterRendering:function(){this.logComponentProperties();if(this.bStopRendering===undefined||this.bStopRendering===false){this.oSharingView=this.getSharingView();this.oSharingView.placeAt(this.getId());}},
exit:function(){this.oSharingView.destroy();},
setSettings:function(s){this.setODataServiceUrl(s.oDataServiceUrl);this.setTunnelServiceUrl(s.tunnelServiceUrl);this.setObject(s.object);this.setAttachments(s.attachments);this.setExternalObject(s.externalObject);},
render:function(r){r.write("<div id='"+this.getId()+"' style='width:"+this.getWidth()+";height:"+this.getHeight()+"'");r.write(">");r.write("</div>");},
getSharingView:function(){var o;var O;var s;var d=this.getObject();if(d){s=d.id;o=d.display;O=d.share;}var e=this.getComponentData();if(e){this.oDialogComponent=e.dialogComponent;}var f=this;var n=function(){if(!f.oNoGroupsView){f.oNoGroupsView=sap.ui.view({id:f.getId()+"_NoGroupsView",viewData:{controlId:f.getId(),langBundle:f.oLangBundle,jamUrl:f.oSharingView.getController().sJamUrl,},type:a.JS,viewName:"sap.collaboration.components.fiori.sharing.NoGroups"});}f.oSharingView.destroy();f.oSharingView=undefined;f.oNoGroupsView.placeAt(f.getId());};if(!this.oSharingView){this.oSharingView=sap.ui.view({id:this.getId()+"_SharingView",viewData:{controlId:this.getId(),odataServiceUrl:this.systemSettings.oDataServiceUrl,collaborationHostODataServiceUrl:this.systemSettings.collaborationHostODataServiceUrl,collaborationHostRestService:this.systemSettings.collaborationHostRestService,langBundle:this.oLangBundle,jamGroups:this.aJamGroups,sharingDialog:undefined,noGroupsCallBack:n,objectDisplay:o,objectShare:O,objectId:s,attachments:this.getAttachments(),externalObject:this.getExternalObject()},type:a.JS,viewName:"sap.collaboration.components.fiori.sharing.Sharing"});}else{this.oSharingView.getViewData().objectId=s;this.oSharingView.getViewData().objectShare=O;this.oSharingView.getViewData().objectDisplay=o;this.oSharingView.getViewData().externalObject=this.getExternalObject();}if(this.oNoGroupsView){this.oNoGroupsView.destroy();this.oNoGroupsView=undefined;}return this.oSharingView;},
shareToJam:function(){this.oSharingView.getController().shareToJam();},
logComponentProperties:function(){q.sap.log.debug("Share Component properties:","","sap.collaboration.components.fiori.sharing.Component.logComponentProperties()");q.sap.log.debug("width: "+this.getWidth());q.sap.log.debug("height: "+this.getHeight());q.sap.log.debug("oDataServiceUrl: "+this.getODataServiceUrl());q.sap.log.debug("tunnelServiceUrl: "+this.getTunnelServiceUrl());if(this.getObject()){q.sap.log.debug("object->id: "+this.getObject().id);q.sap.log.debug("object->display: "+this.getObject().display);q.sap.log.debug("object->share: "+this.getObject().share);}else{q.sap.log.debug("object: undefined");}if(this.getAttachments()&&this.getAttachments().attachmentsArray){q.sap.log.debug("Attachments:");var d=this.getAttachments().attachmentsArray;for(var i=0;i<d.length;i++){q.sap.log.debug("Attachments"+(i+1)+":");q.sap.log.debug(d[i].mimeType);q.sap.log.debug(d[i].name);q.sap.log.debug(d[i].url);}}else{q.sap.log.debug("attachments: undefined");}if(this.getExternalObject()){q.sap.log.debug("externalObject->appContext: "+this.getObject().appContext);q.sap.log.debug("externalObject->odataServicePath: "+this.getObject().odataServicePath);q.sap.log.debug("externalObject->collection: "+this.getObject().collection);q.sap.log.debug("externalObject->key: "+this.getObject().key);q.sap.log.debug("object->name: "+this.getObject().name);q.sap.log.debug("object->summary: "+this.getObject().summary);}else{q.sap.log.debug("externalObject: undefined");}}
});
return b;});
sap.ui.predefine('sap/collaboration/components/fiori/sharing/FolderSelection.controller',["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/StandardListItem","sap/m/library"],function(C,J,S,m){"use strict";var L=m.ListType;sap.ui.controller("sap.collaboration.components.fiori.sharing.FolderSelection",{constants:{top:20},onInit:function(){this.oLangBundle=this.getView().getViewData().languageBundle;this.oODataModel=this.getView().getViewData().oDataModel;this.oODataUtil=this.getView().getViewData().oDataUtil;this.sGroupId=this.getView().getViewData().groupId;this.oFolderSelectionDialog=this.getView().getViewData().folderSelectionDialog;this.sCurrentFolderId='';this.aFolderBuffer=[];},onBeforeRendering:function(){this.refreshFolderSelection(this.sCurrentFolderId);},onAfterRendering:function(){},refreshFolderSelection:function(c){var f=this.buildFolderList(c);this.setViewModel(f);this.bindFoldersList();this.refreshHeaderBar(c);},buildFolderList:function(f){var s=[];var F=this.getFolder(f);s=this.getSubFolders(F);if(F.subFolderCount>s.length){var d=F.subFolderCount-s.length;for(var i=0;i<d;i++){s.push({});}}return s;},setViewModel:function(f){this.oViewData={folders:f};this.oViewModel=new J(this.oViewData);this.getView().setModel(this.oViewModel);},bindFoldersList:function(){var s=this;var i=new S({title:"{name}",icon:"{icon}",type:L.Navigation,press:s.selectFolder()});this.getView().oFoldersList.bindAggregation("items","/folders",i);},refreshHeaderBar:function(f){if(!f==""){var F=this.getFolder(f);this.setFolderSelectionDialogTitle(F.name);this.setFolderSelectionDialogBackButtonVisibility(true);}else{this.setFolderSelectionDialogTitle(this.oLangBundle.getText("TARGET_FOLDER_FIELD_TEXT"));this.setFolderSelectionDialogBackButtonVisibility(false);}},selectFolder:function(e){var s=this;return function(e){var f=e.oSource.getBindingContext().getObject().id;s.refreshFolderSelection(f);s.sCurrentFolderId=f;};},navigateBack:function(e){var c=this.getFolder(this.sCurrentFolderId);var p=c.parent;this.refreshFolderSelection(p);this.sCurrentFolderId=p;},setFolderSelectionDialogTitle:function(f){var h=this.oFolderSelectionDialog.getCustomHeader();var t=h.getContentMiddle()[0];t.setText(f);},setFolderSelectionDialogBackButtonVisibility:function(i){var h=this.oFolderSelectionDialog.getCustomHeader();var b=h.getContentLeft()[0];b.setVisible(i);},getCurrentFolder:function(){if(this.sCurrentFolderId===''){return{name:this.oLangBundle.getText("TARGET_FOLDER_FIELD_TEXT"),id:""};}return this.getFolder(this.sCurrentFolderId);},updateStarted:function(c){if(c.mParameters.reason=='Growing'){var s=[];var f=this.getFolderFromBuffer(this.sCurrentFolderId);var a=this.getSubFoldersFromBuffer(this.sCurrentFolderId).length;if(f.subFolderCount!=a){s=this.fetchSubFolders(this.sCurrentFolderId,a);}if(s.length>0){this.addFoldersToBuffer(s);for(var i=0;i<s.length;i++){this.oViewData.folders[i+a]=s[i];}}}},addFoldersToBuffer:function(f){if(!this.aFolderBuffer){this.aFolderBuffer=[];}for(var i=0;i<f.length;i++){this.aFolderBuffer.push(f[i]);}},getSubFoldersFromBuffer:function(f){var i='';if(f){i=f;}var h=function(a){return a.parent==i;};return this.aFolderBuffer.filter(h);},getFolderFromBuffer:function(f){var h=function(a){return a.id==f;};var F=this.aFolderBuffer.filter(h);return F[0];},getFolder:function(f){var a=this.getFolderFromBuffer(f);if(!a&&f==''){var r=this.oODataUtil.getSubFolders(this.oODataModel,this.sGroupId,null,'0',this.constants.top);a={name:this.oLangBundle.getText("TARGET_FOLDER_FIELD_TEXT"),id:'',parent:'0',subFolderCount:r.count,icon:"sap-icon://folder"};this.addFoldersToBuffer([a]);var s=this.convertFolderEntities(r.folders,'');this.addFoldersToBuffer(s);}if(a.subFolderCount==undefined){var r=this.oODataUtil.getSubFolders(this.oODataModel,null,f,'0',this.constants.top);a.subFolderCount=r.count;var s=this.convertFolderEntities(r.folders,f);this.addFoldersToBuffer(s);}return a;},getSubFolders:function(f){var s=[];if(f.subFolderCount>0){s=this.getSubFoldersFromBuffer(f.id);}return s;},convertFolderEntities:function(f,p){var c=[];for(var i=0;i<f.length;i++){c.push({name:f[i].Name,id:f[i].Id,parent:p,icon:"sap-icon://folder"});}return c;},fetchSubFolders:function(f,s){var a=[];if(!f||f==''){a=this.oODataUtil.getSubFolders(this.oODataModel,this.sGroupId,null,s,this.constants.top).folders;a=this.convertFolderEntities(a,'');}else{a=this.oODataUtil.getSubFolders(this.oODataModel,null,f,s,this.constants.top).folders;a=this.convertFolderEntities(a,f);}return a;},clearFolderBuffer:function(){this.oFolderSelectionDialog.getContent()[0].getController().clearFolderBuffer();}});});
sap.ui.predefine('sap/collaboration/components/fiori/sharing/FolderSelection.view',["sap/ui/core/mvc/JSView","sap/m/List","sap/m/VBox"],function(J,L,V){"use strict";sap.ui.jsview("sap.collaboration.components.fiori.sharing.FolderSelection",{getControllerName:function(){return"sap.collaboration.components.fiori.sharing.FolderSelection";},createContent:function(c){var p=this.getViewData().controlId;this.oFoldersList=new L(p+"_FoldersList",{inset:false,showNoData:true,noDataText:this.getViewData().languageBundle.getText("FOLDER_EMPTY"),growing:true,growingThreshold:c.constants.top,updateStarted:function(C){c.updateStarted(C);}});var d=new V(p+"_DisplayFoldersLayout",{width:"100%",height:"100%",items:[this.oFoldersList]});return d;}});});
sap.ui.predefine('sap/collaboration/components/fiori/sharing/NoGroups.controller',["sap/ui/core/mvc/Controller"],function(C){"use strict";sap.ui.controller("sap.collaboration.components.fiori.sharing.NoGroups",{onInit:function(){},onBeforeRendering:function(){},onAfterRendering:function(){},onExit:function(){this.getView().destroyContent();}});});
sap.ui.predefine('sap/collaboration/components/fiori/sharing/NoGroups.view',["sap/ui/core/mvc/JSView","sap/m/VBox","sap/ui/layout/VerticalLayout","sap/ui/core/HTML","sap/m/library","sap/m/Link"],function(J,V,a,H,m,L){"use strict";var F=m.FlexAlignItems;sap.ui.jsview("sap.collaboration.components.fiori.sharing.NoGroups",{getControllerName:function(){return"sap.collaboration.components.fiori.sharing.NoGroups";},createContent:function(c){var p=this.getViewData().controlId;this.oNoGroupsVBox=new V(p+"_NoGroupsVbox");this.oNoGroupsVBox.addItem(this.createNoDataLayout());return this.oNoGroupsVBox;},createNoDataLayout:function(c){var p=this.getViewData().controlId;var l=this.getViewData().langBundle;var j=this.getViewData().jamUrl;this.oNoDataLayout=new a(p+"_NoDataLayout",{width:"100%",content:[new H(p+"_NoDataDiv",{content:"<div>"+l.getText("NO_GROUPS_ERROR")+"</div>"}),new V(p+"_LinkVbox",{alignItems:F.End,items:[new L(p+"_JamLink",{text:l.getText("JAM_URL_TEXT"),target:"_blank",href:j})]}).addStyleClass("linkVBox")]});return this.oNoDataLayout;}});});
sap.ui.predefine('sap/collaboration/components/fiori/sharing/Sharing.controller',['./helper/AttachmentsUtil','./helper/ShareUtil','sap/collaboration/components/utils/CommonUtil','sap/collaboration/components/utils/OdataUtil','sap/ui/core/mvc/Controller','jquery.sap.global','sap/ui/model/odata/ODataModel','sap/ui/model/odata/CountMode','sap/m/StandardListItem','sap/m/library'],function(A,S,C,O,a,q,b,c,d,m){"use strict";var L=m.ListType;sap.ui.controller("sap.collaboration.components.fiori.sharing.Sharing",{onInit:function(){this.oNoteTextArea=this.getView().oNoteTextArea;this.oAttachmentsInput=this.getView().oAttachmentsInput;this.oTargetFolderInput=this.getView().oTargetFolderInput;this.oODataUtil=undefined;this.sPrefixId=this.getView().getViewData().controlId;this.oLangBundle=this.getView().getViewData().langBundle;this.iJamGroupsCount=0;this.sObjectId=this.getView().getViewData().objectId;this.sObjectShare=this.getView().getViewData().objectShare;this.oObjectDisplay=this.getView().getViewData().objectDisplay;this.oExternalObject=undefined;this.oMappedExternalObject=undefined;this.sMemberEmail=undefined;this.oSharingDialog=this.getView().getViewData().sharingDialog;this.fNoGroupsCallBack=this.getView().getViewData().noGroupsCallBack;this.oCommonUtil=new C();this.oAttachments=this.getView().getViewData().attachments;this.bAttachmentsCB=false;this.aFiles=[];this.aSelectedFiles=[];this.sSelectedFolderId='';this.oItemTemplate=undefined;this.oSelectedGroup=undefined;this.gettingSuggestions=undefined;},onBeforeRendering:function(){try{this.sSelectedGroupId='';this.sSelectedGroupName='';if(!this.oSMIODataModel){this.initializeOdataModel();}if(!this.oODataUtil){this.initializeOdataUtils();}if(!this.oAttachmentsUtil){this.initializeAttachmentsUtil();}this.initializeShareUtil();this.preRenderSetup();this.fetchData();this.clearAttachmentsData();this.oAttachments=this.getView().getViewData().attachments;if(this.oAttachments&&this.oAttachments.attachmentsArray){this.aFiles=this.oAttachments.attachmentsArray;if(this.aFiles.length>0){this.getView().oAttachmentsInput.setEnabled(true);}else{this.getView().oAttachmentsInput.setEnabled(false);}if(this.oFileSelectionDialog){var o=this.oAttachmentsUtil.createAttachmentsModel(this.aFiles);this.oFileSelectionDialog.setModel(o);}this.showAttachmentsFields(true);}else{this.showAttachmentsFields(false);}if(this.sObjectId!=this.getView().getViewData().objectId){this.sObjectId=this.getView().getViewData().objectId;}if(this.sObjectShare!=this.getView().getViewData().objectShare||sap.ui.getCore().byId(this.sPrefixId+"_NoteTextArea").setValue!==this.getView().getViewData().objectShare){this.sObjectShare=this.getView().getViewData().objectShare;sap.ui.getCore().byId(this.sPrefixId+"_NoteTextArea").setInitialValue(this.sObjectShare);}if(this.oObjectDisplay!=this.getView().getViewData().objectDisplay){if(this.oObjectDisplay!=undefined){this.getView().oSharingVBox.removeItem(0);}this.oObjectDisplay=this.getView().getViewData().objectDisplay;this.getView().oSharingVBox.insertItem(this.oObjectDisplay,0);}}catch(e){if(this.oSharingDialog){throw e;}this.oCommonUtil.displayError(e);}},onAfterRendering:function(){setTimeout(function(){sap.ui.getCore().byId(this.sPrefixId+"_GroupSelect").focus();}.bind(this),1);},onExit:function(){this.getView().destroyContent();},preRenderSetup:function(){this.getView().oGroupSelect.setEnabled(false);this.setGroupSelectionText("");if(this.oAttachments&&this.oAttachments.attachmentsArray){this.getView().oTargetFolderInput.setEnabled(false);}this.getView().oNoteTextArea.setEnabled(false);if(this.oSharingDialog){this.oSharingDialog.getButtons()[0].setEnabled(false);this.oSharingDialog.getButtons()[1].setEnabled(false);}},fetchData:function(){var s=this;var g=new q.Deferred();g.done(function(i){s.iJamGroupsCount=i;if(s.iJamGroupsCount>0){s.postFetchSetup();setTimeout(function(){s.getView().getContent()[0].getItems()[1].getContent()[1].focus();},50);}else{if(s.fNoGroupsCallBack){s.fNoGroupsCallBack();}}});var e=new q.Deferred();e.done(function(u){if(!s.sJamUrl){s.sJamUrl=u;}});var f=new q.Deferred();f.done(function(i){s.oMappedExternalObject=i;});f.fail(function(){s.oMappedExternalObject=undefined;q.sap.log.debug('Mapping Internal BO to External BO failed');});var h=new q.Deferred();h.done(function(i){if(!s.sMemberEmail){s.sMemberEmail=i;}});q.when(g,e,f).fail(function(E){if(s.oSharingDialog){s.oSharingDialog.close();}if(E.statusCode===401||E.statusCode===403){s.oCommonUtil.displayError(s.oLangBundle.getText("SHARE_AUTHORIZATION_FAILURE_MSG"));}else{s.oCommonUtil.displayError();}});this.oJamODataModel.read('/Groups/$count',{success:function(D,r){g.resolve(parseInt(r.body));},error:function(E){g.reject(E.response);}});this.oJamODataModel.read('/Self',{success:function(D,r){h.resolve(this.oCommonUtil.getODataResult(D).Email);}.bind(this),error:function(E){h.reject(E.response);}});if(!this.sJamUrl){this.oSMIODataModel.read('/GetCollaborationHostURL',{success:function(D,r){e.resolve(D.GetCollaborationHostURL.URL);},error:function(E){e.reject(E.response);}});}else{e.resolve();}this.oExternalObject=this.getView().getViewData().externalObject;if(this.oExternalObject){this.oSMIODataModel.read('/MapInternalBOToExternalBO',{urlParameters:{ApplicationContext:"'"+s.oExternalObject.appContext+"'",ODataCollection:"'"+s.oExternalObject.collection+"'",ODataKeyPredicate:"'"+s.oExternalObject.key+"'",ODataServicePath:"'"+s.oExternalObject.odataServicePath+"'"},success:function(D,r){f.resolve(D.MapInternalBOToExternalBO);},error:function(E){f.reject(E.response);}});}},postFetchSetup:function(){this.setGroupSelectionEnabled(true);},initializeOdataModel:function(){var e=true;this.sSMIODataServiceUrl=this.getView().getViewData().odataServiceUrl;this.oSMIODataModel=new b(this.sSMIODataServiceUrl,e);this.sJamODataServiceUrl=this.getView().getViewData().collaborationHostODataServiceUrl;this.oJamODataModel=new b(this.sJamODataServiceUrl,e);this.oJamODataModel.setDefaultCountMode(c.Inline);},initializeOdataUtils:function(){this.oODataUtil=new O();},initializeAttachmentsUtil:function(){this.oAttachmentsUtil=new A(this.oLangBundle,this.oODataUtil,this.oJamODataModel);},initializeShareUtil:function(){this.oShareUtil=new S(this.oLangBundle,this.oODataUtil,this.oSMIODataModel,this.oCommonUtil,this.oJamODataModel,this.getView().getViewData().collaborationHostRestService);},setGroupSelectionText:function(t){var g=sap.ui.getCore().byId(this.sPrefixId+"_GroupSelect");g.setValue(t);},setGroupSelectionEnabled:function(e){var g=sap.ui.getCore().byId(this.sPrefixId+"_GroupSelect");g.setEnabled(e);},setFolderSelectionEnabled:function(e){this.oTargetFolderInput.setEnabled(e);},showAttachmentsFields:function(v){this.getView().AttachmentsInputLayout.setVisible(v);this.getView().oTargetFolderInputLayout.setVisible(v);this.getView().oAttachmentCB.setVisible(v);},clearAttachmentsData:function(){this.aFiles=[];this.aSelectedFiles=[];this.sSelectedFolderId='';this.bAttachmentsCB=false;this.oAttachmentsInput.setValue("");this.getView().oAttachmentCB.setSelected(this.bAttachmentsCB);this.getView().oAttachmentCB.setEnabled(false);this.oTargetFolderInput.setValue("");if(this.oFolderSelectionDialog){this.oAttachmentsUtil.resetFolderSelection(this.getSelectedGroupId());}},onAttachmentsValueHelpPress:function(o){if(this.oSharingDialog){var s=this.oSharingDialog.getContent()[0].getDomRef().offsetHeight;var i=this.oSharingDialog.getContent()[0].getDomRef().offsetWidth;}if(!this.oFileSelectionDialog){var e=this.oAttachmentsUtil.createAttachmentsModel(this.aFiles);this.oFileSelectionDialog=this.oAttachmentsUtil.createFileSelectionDialog(this.sPrefixId,e,this.onFileSelectionDialogConfirm(),i,s);}var B=this.oFileSelectionDialog.getBinding("items");B.filter([]);this.oFileSelectionDialog.open();},onFileSelectionDialogConfirm:function(){var s=this;return function(e){s.aSelectedFiles=[];var f=e.getParameter("selectedContexts");for(var i=0;i<f.length;i++){s.aSelectedFiles.push(f[i].getObject());}if(s.aSelectedFiles&&s.aSelectedFiles.length>0){s.postFileSelectionSetup(true);}else{s.postFileSelectionSetup(false);}};},postFileSelectionSetup:function(f){if(f===true){if(this.aSelectedFiles.length==1){this.oAttachmentsInput.setValue(this.oLangBundle.getText("SELECTED_ATTACHMENT_FIELD_TEXT",[this.aSelectedFiles.length]));}else{this.oAttachmentsInput.setValue(this.oLangBundle.getText("SELECTED_ATTACHMENTS_FIELD_TEXT",[this.aSelectedFiles.length]));}this.getView().oAttachmentCB.setEnabled(true);if(this.sSelectedGroupId!==''){this.setFolderSelectionEnabled(true);}}else{this.oAttachmentsInput.setValue("");this.bAttachmentsCB=false;this.getView().oAttachmentCB.setSelected(this.bAttachmentsCB);this.postAttachmentCheckBoxSelection();this.getView().oAttachmentCB.setEnabled(false);this.setFolderSelectionEnabled(false);}},onGroupSelectValueHelpPress:function(e){if(!this.oItemTemplate){this.oItemTemplate=new d({title:{parts:["Name","GroupType"],formatter:function(n,g){return n+" ("+g+")";}},type:L.Active,tooltip:"{Name}"});}if(this.oSharingDialog){var s=this.oSharingDialog.getContent()[0].getDomRef().offsetHeight;var i=this.oSharingDialog.getContent()[0].getDomRef().offsetWidth;}if(!this.oGroupSelectionDialog){this.oGroupSelectionDialog=this.oShareUtil.createGroupSelectionDialog(this.sPrefixId,this.oItemTemplate,this._onGroupSelectionDialogConfirm(),i,s,this.oJamODataModel);}else{this.oGroupSelectionDialog.setModel(this.oJamODataModel);this.oGroupSelectionDialog.bindAggregation("items","/Groups",this.oItemTemplate);}this.oGroupSelectionDialog.open();},_onGroupSelectionDialogConfirm:function(){var s=this;return function(e){var f=e.getParameter("selectedContexts");for(var i=0;i<f.length;i++){s.oSelectedGroup=f[i].getObject();}if(s.oSelectedGroup){s.postGroupSelectionSetup(true);}else{s.postGroupSelectionSetup(false);}};},postGroupSelectionSetup:function(g){if(g===true){if(this.oSelectedGroup!==undefined){this.sSelectedGroupId=this.oSelectedGroup.Id.toString();this.sSelectedGroupName=this.oSelectedGroup.Name.toString();this.setGroupSelectionText(this.sSelectedGroupName);}if(this.oAttachments&&this.oAttachments.attachmentsArray){this.sSelectedFolderId='';this.oAttachmentsUtil.resetFolderSelection(this.getSelectedGroupId());var s=this.oAttachmentsUtil.getCurrentFolder();this.oTargetFolderInput.setValue(s.name);}if(this.aSelectedFiles&&this.aSelectedFiles.length>0){this.setFolderSelectionEnabled(true);}if(this.bAttachmentsCB===false){this.getView().oNoteTextArea.setEnabled(true);}if(this.oSharingDialog){this.oSharingDialog.getButtons()[0].setEnabled(true);this.oSharingDialog.getButtons()[1].setEnabled(true);}}else{this.setFolderSelectionEnabled(false);this.getView().oNoteTextArea.setEnabled(false);}},onTargetFolderValueHelpPress:function(o){if(this.oSharingDialog){var s=this.oSharingDialog.getContent()[0].getDomRef().offsetHeight;var i=this.oSharingDialog.getContent()[0].getDomRef().offsetWidth;}if(!this.oFolderSelectionDialog){this.oFolderSelectionDialog=this.oAttachmentsUtil.createFolderSelectionDialog(this.sPrefixId,this.getSelectedGroupId(),this.onFolderSelectionDialogConfirm(),this.onFolderSelectionDialogCancel(),i,s);this.sSelectedFolderId='';}this.oFolderSelectionDialog.getContent()[0].oController.setFolderSelectionDialogTitle(this.oTargetFolderInput.getValue());this.oFolderSelectionDialog.open();},onFolderSelectionDialogConfirm:function(e){var s=this;return function(){var o=s.oAttachmentsUtil.getCurrentFolder();s.sSelectedFolderId=o.id;s.oTargetFolderInput.setValue(o.name);};},onFolderSelectionDialogCancel:function(e){var s=this;return function(e){s.oAttachmentsUtil.setCurrentFolderId(s.sSelectedFolderId);};},onAttachmentCheckBoxSelected:function(){this.bAttachmentsCB=this.getView().oAttachmentCB.getSelected();this.postAttachmentCheckBoxSelection();},atMentionsButtonPressed:function(){this.getView().oNoteTextArea.atMentionsButtonPressed();},onSuggestion:function(e){if(this.gettingSuggestions){this.gettingSuggestions.abort();}var t=this;var v=e.getParameter("value");var n=this.getView().oNoteTextArea;if(v.trim()===""){n.showSuggestions([]);n.setSuggestionHeight(undefined);return;}var g=this.getSelectedGroupId();var p="/Members_Autocomplete";var P={"async":true,"urlParameters":{"Query":"'"+v+"'","GroupId":"'"+g+"'","$top":"4"},"success":function(D,r){var j=t.oCommonUtil.getODataResult(D);if(j.length===0){n.closeSuggestionPopover();n.setSuggestionHeight(undefined);}else{var s=[];var J=j.length;for(var i=0;i<J;i++){s.push({fullName:j[i].FullName,email:j[i].Email,userImage:t._buildThumbnailImageURL(j[i].Id)});}n.showSuggestions(s);J>=3?n.setSuggestionHeight("12rem"):n.setSuggestionHeight(undefined);}},"error":function(E){q.sap.log.error("Failed to get suggestions: "+E.statusText);}};this.gettingSuggestions=this.oJamODataModel.read(p,P);},postAttachmentCheckBoxSelection:function(){if(this.bAttachmentsCB===true){this.getView().oNoteTextArea.setEnabled(false);}else{if(this.sSelectedGroupId!==''){this.getView().oNoteTextArea.setEnabled(true);}}},getSharingData:function(){var f;if((this.oNoteTextArea.getValue()!==undefined&&this.oNoteTextArea.getValue()!=="")||(this.sObjectId!==undefined&&this.sObjectId!=="")){f={note:this.oNoteTextArea.convertTextWithFullNamesToEmailAliases(),uiUrl:this.sObjectId};}if(JSON.stringify(this.oExternalObject)==='{}'){this.oExternalObject=undefined;}return{feedContent:f,groupId:this.getSelectedGroupId(),folderId:this.getSelectedFolderId(),aFilesToUpload:this.aSelectedFiles,externalObject:this.oExternalObject,mappedExternalObject:this.oMappedExternalObject,groupName:this.getSelectedGroupName(),memberEmail:this.sMemberEmail};},getSelectedGroupId:function(){return this.sSelectedGroupId;},getSelectedGroupName:function(){return this.sSelectedGroupName;},getSelectedFolderId:function(){return this.sSelectedFolderId;},shareToJam:function(){var s=this.getSharingData();var e=this;if(s.aFilesToUpload.length===0&&(!s.feedContent||(!s.feedContent.uiUrl&&s.feedContent.note.trim()===""))&&!s.externalObject){var r=e.oLangBundle.getText("SHARING_NOTHING_TO_SHARE_MSG");this.oCommonUtil.showMessage(r,{duration:3000,autoclose:false});}else{if(!this.bAttachmentsCB){this.oShareUtil.shareBusinessObject(s);}if(s.aFilesToUpload.length>0){this.oShareUtil.uploadAttachments(s);var r=this.oLangBundle.getText("SHARING_ACKNOWLEDGMENT_MSG");setTimeout(function(){e.oCommonUtil.showMessage(r,{duration:3000,width:"30em",autoClose:false});},500);}}},_buildThumbnailImageURL:function(u){return this.oJamODataModel.sServiceUrl+"/Members('"+q.sap.encodeURL(u)+"')/ThumbnailImage/$value";}});});
sap.ui.predefine('sap/collaboration/components/fiori/sharing/Sharing.view',["sap/ui/core/mvc/JSView","sap/m/VBox","sap/m/Label","sap/m/Input","sap/m/library","sap/ui/layout/VerticalLayout","sap/m/FlexItemData","sap/collaboration/components/controls/SocialTextArea","sap/m/CheckBox"],function(J,V,L,I,m,a,F,S,C){"use strict";var P=m.PlacementType;var b=m.InputType;sap.ui.jsview("sap.collaboration.components.fiori.sharing.Sharing",{getControllerName:function(){return"sap.collaboration.components.fiori.sharing.Sharing";},createContent:function(c){var p=this.getViewData().controlId;this.oSharingVBox=new V(p+"_SharingVbox");this.createSharingVBoxContent(c);return this.oSharingVBox;},createSharingVBoxContent:function(c){var p=this.getViewData().controlId;var l=this.getViewData().langBundle;var j=this.getViewData().jamUrl;this.oObjectDisplay=this.getViewData().objectDisplay;if(this.oObjectDisplay){this.oSharingVBox.addItem(this.oObjectDisplay);}var g=new L(p+"_GroupLabel",{text:l.getText("GRP_SELECT_LABEL"),required:true,width:"100%"});this.oGroupSelect=new I(p+"_GroupSelect",{width:"100%",type:b.Text,placeholder:l.getText("GRP_SELECT_BUTTON_TEXT"),showValueHelp:true,enabled:true,editable:true,valueHelpOnly:true,valueHelpRequest:function(e){c.onGroupSelectValueHelpPress(e);},ariaLabelledBy:p+"_GroupLabel"});var G=new a(p+"_GroupSelectionLayout",{width:"100%",layoutData:new F({growFactor:1}),content:[g,this.oGroupSelect]}).addStyleClass("sharingVBox");this.oSharingVBox.addItem(G);var A=new L(p+"_AttachmentsLabel",{text:l.getText("ATTACHMENTS_LABEL"),required:false,width:"100%"});this.oAttachmentsInput=new I(p+"_AttachmentsInput",{width:"100%",type:b.Text,placeholder:l.getText("ATTACHMENTS_FIELD_TEXT",[""]),showValueHelp:true,enabled:true,editable:true,valueHelpOnly:true,valueHelpRequest:function(e){c.onAttachmentsValueHelpPress(e);},ariaLabelledBy:p+"_AttachmentsLabel"});this.AttachmentsInputLayout=new a(p+"_AttachmentsInputLayout",{width:"100%",layoutData:new F({growFactor:1}),content:[A,this.oAttachmentsInput]}).addStyleClass("sharingVBox");this.oSharingVBox.addItem(this.AttachmentsInputLayout);var t=new L(p+"_TargetFolderLabel",{text:l.getText("TARGET_FOLDER_LABEL"),required:false,width:"100%"});this.oTargetFolderInput=new I(p+"_TargetFolderInput",{width:"100%",type:b.Text,placeholder:l.getText("TARGET_FOLDER_FIELD_TEXT"),showValueHelp:true,enabled:true,editable:true,valueHelpOnly:true,valueHelpRequest:function(e){c.onTargetFolderValueHelpPress(e);},ariaLabelledBy:p+"_TargetFolderLabel"});this.oTargetFolderInputLayout=new a(p+"_TargetFolderInputLayout",{width:"100%",layoutData:new F({growFactor:1}),content:[t,this.oTargetFolderInput]}).addStyleClass("sharingVBox");this.oSharingVBox.addItem(this.oTargetFolderInputLayout);var n=new L(p+"_NoteLabel",{text:l.getText("ADD_NOTE_LABEL"),width:"100%"});var o;this.getViewData().objectId?o=this.getViewData().objectId.length:o=0;var N=1000-o-1;this.oNoteTextArea=new S(p+"_NoteTextArea",{initialValue:this.getViewData().objectShare,rows:6,width:"100%",suggestionPlacement:P.Top,maxLength:N,suggest:c.onSuggestion.bind(c),ariaLabelledBy:p+"_NoteLabel"});var d=new a(p+"_NoteLayout",{width:"100%",layoutData:new F({growFactor:2}),content:[n,this.oNoteTextArea]}).addStyleClass("sharingVBox");this.oSharingVBox.addItem(d);this.oAttachmentCB=new C(p+"_AttchmentCB",{text:l.getText("SHARE_ATTACHMENTS_ONLY_LABEL"),enabled:false,select:function(){c.onAttachmentCheckBoxSelected();},ariaLabelledBy:p+"_AttchmentCB"});this.oSharingVBox.addItem(this.oAttachmentCB);}});});
sap.ui.predefine('sap/collaboration/components/fiori/sharing/attachment/Attachment',['./InvalidAttachmentConstructorArgumentsException','./InvalidAttachmentParameterException','sap/ui/base/Object'],function(I,a,B){"use strict";
var A=B.extend("sap.collaboration.components.fiori.sharing.attachment.Attachment",{
constructor:function(n,m,u){if(arguments.length===3&&Object.prototype.toString.call(n)==="[object String]"&&Object.prototype.toString.call(m)==="[object String]"&&Object.prototype.toString.call(u)==="[object String]"){this.name=n;this.mimeType=m;this.url=u;}else{throw new I();}},
getName:function(){return this.name;},
getMimeType:function(){return this.mimeType;},
getUrl:function(){return this.url;},
setName:function(n){if(arguments.length===1&&Object.prototype.toString.call(n)==="[object String]"){this.name=n;}else{throw new a("name");}},
setMimeType:function(m){if(arguments.length===1&&Object.prototype.toString.call(m)==="[object String]"){this.mimeType=m;}else{throw new a("mimeType");}},
setUrl:function(u){if(arguments.length===1&&Object.prototype.toString.call(u)==="[object String]"){this.url=u;}else{throw new a("url");}}
});
return A;});
sap.ui.predefine('sap/collaboration/components/fiori/sharing/attachment/InvalidAttachmentConstructorArgumentsException',["sap/ui/base/Object"],function(B){"use strict";
var I=B.extend("sap.collaboration.components.fiori.sharing.attachment.InvalidAttachmentConstructorArgumentsException",{constructor:function(){this.exceptionName="InvalidAttachmentConstructorArgumentsException";}});
return I;});
sap.ui.predefine('sap/collaboration/components/fiori/sharing/attachment/InvalidAttachmentParameterException',["sap/ui/base/Object"],function(B){"use strict";
var I=B.extend("sap.collaboration.components.fiori.sharing.attachment.InvalidAttachmentParameterException",{constructor:function(p){this.exceptionName="InvalidAttachmentParameterException: "+p;}});
return I;});
sap.ui.predefine('sap/collaboration/components/fiori/sharing/helper/AttachmentsUtil',['sap/collaboration/components/utils/CommonUtil','sap/ui/base/Object','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/m/SelectDialog','sap/m/StandardListItem','sap/m/library','sap/ui/model/json/JSONModel','sap/m/Bar','sap/m/Button','sap/m/Label','sap/m/Dialog','sap/ui/Device','sap/ui/core/mvc/View','sap/ui/core/library'],function(C,B,F,a,S,b,m,J,c,d,L,D,e,V,f){"use strict";var g=f.mvc.ViewType;var h=m.ButtonType;var j=m.ListType;
var A=B.extend("sap.collaboration.components.fiori.sharing.helper.AttachmentsUtil",{
constructor:function(l,o,i){this.oCommonUtil=new C();this.oLangBundle=l;this.oODataUtil=o;this.oJamODataModel=i;},
createFileSelectionDialog:function(p,o,O,w,H){var i=function(E){var v=E.getParameter("value");var k=new F("name",a.Contains,v);var l=E.getSource().getBinding("items");l.filter([k]);};this.oFileSelectionDialog=new S(p+"_FileSelectionDialog",{multiSelect:true,rememberSelections:true,title:this.oLangBundle.getText("ATTACHMENTS_FIELD_TEXT",[""]),confirm:O,search:i,liveChange:i});if(w){this.oFileSelectionDialog.setContentWidth(w.toString()+"px");}if(H){this.oFileSelectionDialog.setContentHeight(H.toString()+"px");}var I=new b({title:"{name}",icon:"{icon}",iconDensityAware:false,iconInset:true,type:j.Active});this.oFileSelectionDialog.setModel(o);this.oFileSelectionDialog.bindAggregation("items","/attachments",I);return this.oFileSelectionDialog;},
createAttachmentsModel:function(k){var l=[];for(var i=0;i<k.length;i++){l.push({name:k[i].getName(),mimeType:k[i].getMimeType(),url:k[i].getUrl(),icon:this.oCommonUtil.getIconFromMimeType(k[i].getMimeType())});}var o=new J({attachments:l});return o;},
createFolderSelectionDialog:function(p,G,o,O,w,H){var s=this;var i=function(E){s.oFolderSelectionDialog.getContent()[0].getController().navigateBack();};var k=new c(p+"_FolderSelectionDialogHeaderBar",{contentLeft:[new d(p+"_FolderSelectionDialogHeaderBarBackButton",{type:h.Back,visible:false,press:i})],contentMiddle:[new L(p+"_FolderSelectionDialogHeaderBarTitle",{text:this.oLangBundle.getText("TARGET_FOLDER_FIELD_TEXT")})]});var l=new d(p+"_FolderSelectionDialogOKButton",{text:this.oLangBundle.getText("OK_BUTTON_TEXT"),press:function(r){o(r);s.oFolderSelectionDialog.close();}});var n=new d(p+"_FolderSelectionDialogCancelButton",{text:this.oLangBundle.getText("CANCEL_BUTTON_TEXT"),press:function(r){O(r);s.oFolderSelectionDialog.close();}});this.oFolderSelectionDialog=new D(p+"_FolderSelectionDialog",{beginButton:l,endButton:n,customHeader:k}).addStyleClass("sapUiPopupWithPadding");var q=this.createFolderSelectionView(p,G,w,H);this.oFolderSelectionDialog.addContent(q);if(e.system.phone){this.oFolderSelectionDialog.setStretch(true);}return this.oFolderSelectionDialog;},
createFolderSelectionView:function(p,G,w,H){var o=sap.ui.view({id:p+"_FolderSelectionView",viewData:{controlId:p,groupId:G,languageBundle:this.oLangBundle,oDataUtil:this.oODataUtil,oDataModel:this.oJamODataModel,folderSelectionDialog:this.oFolderSelectionDialog},type:g.JS,viewName:"sap.collaboration.components.fiori.sharing.FolderSelection"});if(w){o.setWidth(w.toString()+"px");}if(H){o.setHeight(H.toString()+"px");}return o;},
getCurrentFolder:function(){if(this.oFolderSelectionDialog){return this.oFolderSelectionDialog.getContent()[0].getController().getCurrentFolder();}return{name:this.oLangBundle.getText("TARGET_FOLDER_FIELD_TEXT"),id:""};},
getCurrentGroupId:function(){return this.oFolderSelectionDialog.getContent()[0].getController().sGroupId;},
resetFolderSelection:function(G){if(this.oFolderSelectionDialog){this.oFolderSelectionDialog.getContent()[0].getController().sGroupId=G;this.oFolderSelectionDialog.getContent()[0].getController().sCurrentFolderId='';this.oFolderSelectionDialog.getContent()[0].getController().aFolderBuffer=[];}},
setCurrentFolderId:function(s){this.oFolderSelectionDialog.getContent()[0].getController().sCurrentFolderId=s;}
});
return A;});
sap.ui.predefine('sap/collaboration/components/fiori/sharing/helper/ShareUtil',["jquery.sap.global","sap/ui/base/Object","sap/m/SelectDialog"],function(q,B,S){"use strict";
var a=B.extend("sap.collaboration.components.fiori.sharing.helper.ShareUtil",{
constructor:function(l,o,s,c,j,C){this._bIsOkToRefreshSecurityToken=true;this.iGrowingThreshold=10;this.oLangBundle=l;this.oODataUtil=o;this.oSMIODataModel=s;this.oJamODataModel=j;this.oCollaborationHostRestService=C;this.oCommonUtil=c;this.bShareError=false;this.bShareBusinessObjShared;this.bFileUploaded;this.aUploadAttachmentsUploaded=[];this.IdisplaySuccessMessageIntervalId;},
shareBusinessObject:function(s){var t=this;if(s.mappedExternalObject){if(s.feedContent!==undefined&&s.feedContent.uiUrl!==undefined){var p=s.mappedExternalObject;p.Name=s.externalObject.name;p.Groups=[{__metadata:{uri:"Groups('"+s.groupId+"')"}}];p.Permalink=s.feedContent.uiUrl;var P={async:true,success:function(d,r){t._bIsOkToRefreshSecurityToken=true;t._createGroupFeedEntry_SharedExternalObject(s);},error:function(e){if(e.response.statusCode===409){t._createGroupFeedEntry_SharedExternalObject(s);}else if(e.response.statusCode===403&&t._bIsOkToRefreshSecurityToken){t.oJamODataModel.refreshSecurityToken(function(){t._bIsOkToRefreshSecurityToken=false;t.shareBusinessObject(s);},function(e){t._checkAuthorizationAndDisplayErrorMessage(e.response.statusCode);},true);}else{t._bIsOkToRefreshSecurityToken=true;t._checkAuthorizationAndDisplayErrorMessage(e.response.statusCode);}},};this.oJamODataModel.create("/ExternalObjects",p,P);}else{q.sap.log.error("feedContent.uiUrl parameter should not be undefined when sharing an external object","sap.collaboration.components.fiori.sharing.helper.ShareUtil.shareBusinessObject()");this.displayErrorMessage();}}else{this._createFeedEntry_ShareObjectLink(s);}},
_createGroupFeedEntry_SharedExternalObject:function(s){var x='<?xml version="1.0" encoding="UTF-8"?>'+'<feed xmlns="http://www.w3.org/2005/Atom" xmlns:activity="http://activitystrea.ms/spec/1.0/">'+'<entry>'+'<title> </title>'+'<content type="html">'+q.sap.encodeXML(s.feedContent.note)+'</content>'+'<author>'+'<email>'+q.sap.encodeXML(s.memberEmail)+'</email>'+'<activity:object-type>http://activitystrea.ms/schema/1.0/person</activity:object-type>'+'</author>'+'<activity:verb>http://activitystrea.ms/schema/1.0/share</activity:verb>'+'<activity:object>'+'<id>'+q.sap.encodeXML(s.mappedExternalObject.Exid)+'</id>'+'<title type="html">'+q.sap.encodeXML(s.externalObject.name)+'</title>'+'<activity:object-type>'+q.sap.encodeXML(s.mappedExternalObject.ObjectType)+'</activity:object-type>'+'<link type="text/html" rel="alternate" href="'+q.sap.encodeXML(s.feedContent.uiUrl)+'"/>'+'<link rel="http://www.odata.org" href="'+q.sap.encodeXML(s.mappedExternalObject.ODataLink)+'"/>'+'<link rel="http://www.odata.org/metadata" href="'+q.sap.encodeXML(s.mappedExternalObject.ODataMetadata)+'"/>'+'<link rel="http://www.odata.org/annotation" href="'+q.sap.encodeXML(s.mappedExternalObject.ODataAnnotations)+'"/>'+'<source>'+'<id>tag:www.cubetree.com,2013:/groups/'+q.sap.encodeXML(s.groupId)+'</id>'+'</source>'+'</activity:object>'+'</entry>'+'</feed>';var t=this;var o=function(){if(this.readyState==4){if(this.status==200){t.bShareBusinessObjShared=true;t.displaySuccessMessage(s.groupName);}else{t._checkAuthorizationAndDisplayErrorMessage(this.status);}}};this._createFeedEntryViaRestAPI(x,o);},
_createFeedEntry_ShareObjectLink:function(s){this.bShareBusinessObjShared=false;if(s.feedContent){if(s.feedContent.note!==undefined){var c=s.feedContent.note;if(s.feedContent.uiUrl){c=c+"<br/><a href='"+s.feedContent.uiUrl.replace(/'/g,"&apos;")+"'>"+this.oLangBundle.getText("SHARE_OBJECT_LINK")+'</a>';}var x='<?xml version="1.0" encoding="UTF-8"?>'+'<feed xmlns="http://www.w3.org/2005/Atom" xmlns:activity="http://activitystrea.ms/spec/1.0/">'+'<entry>'+'<title>'+q.sap.encodeXML(this.oLangBundle.getText("SHARE_OBJECT_LINK_TITLE"))+'</title>'+'<content type="html">'+q.sap.encodeXML(c)+'</content>'+'<author>'+'<email>'+q.sap.encodeXML(s.memberEmail)+'</email>'+'<activity:object-type>http://activitystrea.ms/schema/1.0/person</activity:object-type>'+'</author>'+'<activity:verb>http://activitystrea.ms/schema/1.0/share</activity:verb>'+'<activity:object>'+'<source>'+'<id>tag:www.cubetree.com,2013:/groups/'+q.sap.encodeXML(s.groupId)+'</id>'+'</source>'+'</activity:object>'+'</entry>'+'</feed>';var b=this;var o=function(){if(this.readyState==4){if(this.status==200){b.bShareBusinessObjShared=true;b._bIsOkToRefreshSecurityToken=true;b.displaySuccessMessage(s.groupName);}else{if(this.status==403&&b._bIsOkToRefreshSecurityToken){b.oJamODataModel.refreshSecurityToken(function(){b._bIsOkToRefreshSecurityToken=false;b._createFeedEntry_ShareObjectLink(s);},function(e){b._checkAuthorizationAndDisplayErrorMessage(e.response.statusCode);},true);}else{b._bIsOkToRefreshSecurityToken=true;b._checkAuthorizationAndDisplayErrorMessage(this.status);}}}};this._createFeedEntryViaRestAPI(x,o);}else{q.sap.log.error("feedContent.note parameter should not be undefined","sap.collaboration.components.fiori.sharing.helper.ShareUtil._createFeedEntry_ShareObjectLink()");this.displayErrorMessage();}}else{q.sap.log.error("feedContent parameter should not be undefined","sap.collaboration.components.fiori.sharing.helper.ShareUtil._createFeedEntry_ShareObjectLink()");this.displayErrorMessage();}},
_createFeedEntryViaRestAPI:function(x,o){var b={'Accept':'application/atom+xml','Content-Type':'application/atom+xml','x-csrf-token':this.oJamODataModel.getSecurityToken()};var f=this.oCollaborationHostRestService.url+"/feed/post";if(this.oCollaborationHostRestService.urlParams!=undefined&&this.oCollaborationHostRestService.urlParams!=""){f=f+"?"+this.oCollaborationHostRestService.urlParams;}var c=new window.XMLHttpRequest();c.open("POST",f,true);for(var h in b){c.setRequestHeader(h,b[h]);}c.onreadystatechange=o;c.send(x);},
uploadAttachments:function(s){var b=this;var g=s.groupId;var f=s.folderId;for(var i in s.aFilesToUpload){this.oSMIODataModel.create('/UploadTargetFile',null,{async:true,success:function(d,r){q.sap.log.debug('File was uploaded',"sap.collaboration.components.fiori.sharing.helper.ShareUtil.uploadAttachments()");},error:function(e){q.sap.log.error('Error, file was not uploaded',"sap.collaboration.components.fiori.sharing.helper.ShareUtil.uploadAttachments()");},urlParameters:{FileMimeType:"'"+s.aFilesToUpload[i].mimeType+"'",FileName:"'"+s.aFilesToUpload[i].name+"'",FileURL:"'"+s.aFilesToUpload[i].url+"'",FolderId:"'"+s.folderId+"'",GroupId:"'"+s.groupId+"'"}});}},
createGroupSelectionDialog:function(p,i,s,w,h,o){var b=this;var c=function(e){var v=e.getParameter("value");b.oGroupSelectionDialog.bindAggregation("items","/Groups/?$filter=substringof('"+v.replace(/'/g,"''")+"',Name)",i);};this.oGroupSelectionDialog=new S(p+"_GroupSelectionDialog",{multiSelect:false,noDataText:this.oLangBundle.getText("GRP_NO_GROUPS_FOUND_TEXT"),rememberSelections:false,growingThreshold:this.iGrowingThreshold,title:this.oLangBundle.getText("GROUP_SELECTION_DIALOG_TITLE"),confirm:s,search:c,liveChange:c}).addStyleClass("sapUiPopupWithPadding");if(w){this.oGroupSelectionDialog.setContentWidth(w.toString()+"px");}if(h){this.oGroupSelectionDialog.setContentHeight(h.toString()+"px");}this.oGroupSelectionDialog.setModel(o);this.oGroupSelectionDialog.bindAggregation("items","/Groups",i);return this.oGroupSelectionDialog;},
displaySuccessMessage:function(g){var b=true;if(!(this.bShareBusinessObjShared===true||this.bShareBusinessObjShared===undefined)){b=false;}var f=true;if(!(this.bFileUploaded===true||this.bFileUploaded===undefined)){b=false;}if(this.bShareError===false){if(b===true&&f===true){this.oCommonUtil.showMessage(this.oLangBundle.getText("SHARING_SUCCESS_MSG",[g]),{width:"20em",autoClose:false});clearInterval(this.IdisplaySuccessMessageIntervalId);}}else{clearInterval(this.IdisplaySuccessMessageIntervalId);}},
displayErrorMessage:function(){if(!this.bShareError){var e=this.oLangBundle.getText("SHARING_FAILURE_MSG");this.oCommonUtil.displayError(e);}this.bShareError=true;},
_checkAuthorizationAndDisplayErrorMessage:function(s){var b=this;if(s==401||s==403){b.oCommonUtil.displayError(b.oLangBundle.getText("SHARE_AUTHORIZATION_FAILURE_MSG"));}else{b.displayErrorMessage();}}
});
return a;});
sap.ui.predefine('sap/collaboration/components/socialprofile/Component',['sap/collaboration/components/utils/CommonUtil','sap/ui/core/UIComponent','sap/m/library','jquery.sap.global','sap/ui/core/mvc/View','sap/ui/core/library','sap/m/Bar','sap/m/Text','sap/m/ResponsivePopover','sap/m/Button'],function(C,U,m,q,V,c,B,T,R,a){"use strict";var b=c.mvc.ViewType;var P=m.PlacementType;
var d=U.extend("sap.collaboration.components.socialprofile.Component",{
metadata:{version:"1.0",includes:["../resources/css/SocialProfile.css"],aggregations:{},properties:{placement:{type:"sap.m.PlacementType",group:"Misc",defaultValue:P.Auto},memberId:{type:"string",group:"Misc"},memberInfo:{type:"object",group:"Misc"},openingControl:{type:"object",group:"Misc"},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"380px"},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"300px"}}},
_defaultAttributes:{collaborationHostServiceUrl:"/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1/OData",smiServiceUrl:"/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV"},
init:function(){this._oCommonUtil=new C();this._oLangBundle=this._oCommonUtil.getLanguageBundle();this._sUserProfileURL;this._sCurrentUserEmail;},
exit:function(){},
onBeforeRendering:function(){},
onAfterRendering:function(){},
open:function(){try{this._logComponentProperties();this._validateInputParameters();this._createView();this._createSocialPopover();this._oPopover.openBy(this.getOpeningControl());}catch(e){q.sap.log.error(e.stack);this._oCommonUtil.displayError();}},
setSettings:function(s){try{if(s){this.setPlacement(s.placement);this.setMemberId(s.memberId);this.setMemberInfo(s.memberInfo);this.setOpeningControl(s.openingControl);this.setHeight(s.height);this.setWidth(s.width);}else{throw new Error("Settings object is undefined");}}catch(e){q.sap.log.error(e.stack);this._oCommonUtil.displayError();}},
_createView:function(){var t=this;if(!this._oPopoverView){this._oPopoverView=new sap.ui.view({id:this.getId()+"_PopoverView",viewData:{collaborationHostServiceUrl:this._defaultAttributes.collaborationHostServiceUrl,smiServiceUrl:this._defaultAttributes.smiServiceUrl,langBundle:this._oLangBundle,memberId:this.getMemberId(),memberInfo:this.getMemberInfo(),popoverPrefix:this.getId(),afterUserInfoRetrieved:function(u){if(u){t._sUserProfileURL=u.WebURL;var j=sap.ui.getCore().byId(t.getId()+"_JamButton");j.setEnabled(true);j.rerender();j.focus();}}},type:b.JS,viewName:"sap.collaboration.components.socialprofile.SocialProfile"});}else{this._oPopoverView.getViewData().memberId=this.getMemberId();this._oPopoverView.getViewData().memberInfo=this.getMemberInfo();}},
_createSocialPopover:function(){var t=this;if(!this._oPopover){var h=new B(this.getId()+"_HeaderBar",{contentMiddle:new T({text:this._oLangBundle.getText("SP_TITLE")}).addStyleClass("popoverheader")});this._oPopover=new R(this.getId()+"_Popover",{placement:this.getPlacement(),showCloseButton:true,contentHeight:this.getHeight(),contentWidth:this.getWidth(),content:[this._oPopoverView],customHeader:h,beginButton:new a(this.getId()+"_JamButton",{text:this._oLangBundle.getText("SP_OPEN_JAM_BUTTON"),enabled:false,press:function(){window.open(t._sUserProfileURL,"_blank");}}),beforeOpen:function(){if(t._sCurrentUserEmail!==t.getMemberId()){sap.ui.getCore().byId(t.getId()+"_JamButton").setEnabled(false);}t._sCurrentUserEmail=t.getMemberId();}}).addStyleClass("popover");}if(this._oPopover.getPlacement()!==this.getPlacement()){this._oPopover.setPlacement(this.getPlacement());}if(this._oPopover.getContentHeight()!==this.getHeight()){this._oPopover.setContentHeight(this.getHeight());}if(this._oPopover.getContentWidth()!==this.getWidth()){this._oPopover.setContentWidth(this.getWidth());}},
_logComponentProperties:function(){q.sap.log.debug("Social Profile Component properties:","","sap.collaboration.components.socialprofile.Component._logComponentProperties()");q.sap.log.debug("placement: "+this.getPlacement());q.sap.log.debug("memberId: "+this.getMemberId());q.sap.log.debug("openingControl: "+this.getOpeningControl());q.sap.log.debug("height: "+this.getHeight());q.sap.log.debug("width: "+this.getWidth());},
_validateInputParameters:function(){if(!this.getMemberId()){throw new Error("MemberId is undefined");}if(!this.getOpeningControl()){throw new Error("Opening control is undefined");}}
});
return d;});
sap.ui.predefine('sap/collaboration/components/socialprofile/SocialProfile.controller',['sap/collaboration/components/utils/CommonUtil','sap/collaboration/components/utils/OdataUtil','sap/ui/core/mvc/Controller','sap/ui/model/odata/ODataModel','sap/ui/model/json/JSONModel','jquery.sap.global'],function(C,O,a,b,J,q){"use strict";sap.ui.controller("sap.collaboration.components.socialprofile.SocialProfile",{onInit:function(){this.getView().getViewData().collaborationHostServiceUrl?this._sJamODataServiceUrl=this.getView().getViewData().collaborationHostServiceUrl:this._sJamODataServiceUrl="/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1/OData";this.getView().getViewData().smiServiceUrl?this._sSMIODataServiceUrl=this.getView().getViewData().smiServiceUrl:this._sSMIODataServiceUrl="/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV";this._oODataUtil=new O();this._oCommonUtil=new C();this._sPrefixId=this.getView().getId();this._sJamURL="";this._sJamUserId="";this._sPopoverPrefix=this.getView().getViewData().popoverPrefix;this._fnUserInfoFetchedCallback=this.getView().getViewData().afterUserInfoRetrieved;this._initializeModels();},onBeforeRendering:function(){if(this._memberId!==this.getView().getViewData().memberId){this.getView().resetHeader();this._clearViewData();this._memberId=this.getView().getViewData().memberId;var m=this.getView().getViewData().memberInfo;if(q.isEmptyObject(m)){this._getMember();}else{this._setMember(m);if(this._fnUserInfoFetchedCallback){this._fnUserInfoFetchedCallback(m);}}}},_initializeModels:function(){var A=true;this._oJamODataModel=new b(this._sJamODataServiceUrl,A);this._oJSONModel=new J({});this.getView().setModel(this._oJSONModel);},_getMember:function(){var t=this;if(this._oSocialProfileRequest){this._oSocialProfileRequest.abort();}var p="Members_FindByEmail";var P={};P.urlParameters={"Email":"'"+t._memberId+"'","$expand":"MemberProfile/PhoneNumbers","$select":"Id,FullName,Title,Email,WebURL,MemberProfile"};P.success=function(d,r){var m=t._oCommonUtil.getODataResult(d);if(!q.isEmptyObject(m)){var c=m.MemberProfile.PhoneNumbers.results;var e=c.length;for(var i=0;i<e;i++){if(c[i]['PhoneNumberType']==='Work'){m.MemberProfile.WorkPhoneNumber=c[i]['PhoneNumber'];}if(c[i]['PhoneNumberType']==='Mobile'){m.MemberProfile.MobilePhoneNumber=c[i]['PhoneNumber'];}}t._oJSONModel.setData(m);t._sJamUserId=m.Id;var I=t._buildThumbnailImageURL(t._sJamUserId);sap.ui.getCore().byId(t._sPrefixId+"_HeaderUserImage").setSrc(I);if(t._fnUserInfoFetchedCallback){t._fnUserInfoFetchedCallback(m);}}};P.error=function(e){if(e.response&&e.response.statusCode){q.sap.log.error("SAP Jam request failed at sap.collaboration.components.socialprofile.SocialProfileController._getMember()");t.getView().setHeaderNoUser();}};this._oSocialProfileRequest=this._oJamODataModel.read(p,P);},_setMember:function(m){var M={"UserImage":m.picture,"Id":m.id,"FullName":m.fullname,"Title":m.title,"Email":m.email,"MemberProfile":{"Address":m.address,"WorkPhoneNumber":m.workPhoneNumber,"MobilePhoneNumber":m.mobilePhoneNumber}};this._sJamUserId=m.id;this._oJSONModel.setData(M);},_clearViewData:function(){sap.ui.getCore().byId(this._sPrefixId+"_HeaderUserImage").setSrc();sap.ui.getCore().byId(this._sPrefixId+"_FullName").setText();sap.ui.getCore().byId(this._sPrefixId+"_Role").setText();sap.ui.getCore().byId(this._sPrefixId+"_MobileNumber").setText();sap.ui.getCore().byId(this._sPrefixId+"_WorkNumber").setText();sap.ui.getCore().byId(this._sPrefixId+"_Email").setText();sap.ui.getCore().byId(this._sPrefixId+"_CompanyAddress").setText();},_buildThumbnailImageURL:function(u){return this._sJamODataServiceUrl+"/Members('"+q.sap.encodeURL(u)+"')/ThumbnailImage/$value";}});});
sap.ui.predefine('sap/collaboration/components/socialprofile/SocialProfile.view',["sap/ui/core/mvc/JSView","sap/m/VBox","sap/m/Label","sap/m/Text","sap/m/Link","sap/m/HBox","sap/m/Image","sap/m/ObjectStatus"],function(J,V,L,T,a,H,I,O){"use strict";sap.ui.jsview("sap.collaboration.components.socialprofile.SocialProfile",{getControllerName:function(){return"sap.collaboration.components.socialprofile.SocialProfile";},createContent:function(c){this._sPrefixId=this.getId();this._oVBox=new V(this._sPrefixId+"_VBox").addStyleClass("vbox");this._createVBoxContent();return this._oVBox;},_createVBoxContent:function(){this._oVBox.addItem(this._createHBoxHeader());var c=new L(this._sPrefixId+"_ContactDetailsLabel",{text:this.getViewData().langBundle.getText("SP_CONTACT_DETAILS_LABEL")}).addStyleClass("heading");var m=new T(this._sPrefixId+"_MobileNumber",{text:"{/MemberProfile/MobilePhoneNumber}"});var M=new L(this._sPrefixId+"_MobileLabel",{text:this.getViewData().langBundle.getText("SP_MOBILE_LABEL"),labelFor:m.getId()}).addStyleClass("label");var w=new T(this._sPrefixId+"_WorkNumber",{text:"{/MemberProfile/WorkPhoneNumber}"});var W=new L(this._sPrefixId+"_WorkLabel",{text:this.getViewData().langBundle.getText("SP_WORK_LABEL"),labelFor:w.getId()}).addStyleClass("label");var e=new a(this._sPrefixId+"_Email",{text:"{/Email}",press:function(){this.setHref("mailto:"+this.getText());}});var E=new L(this._sPrefixId+"_EmailLabel",{text:this.getViewData().langBundle.getText("SP_EMAIL_LABEL"),labelFor:e.getId()}).addStyleClass("label");var C=new L(this._sPrefixId+"_CompanyDetailsLabel",{text:this.getViewData().langBundle.getText("SP_COMPANY_DETAILS_LABEL")}).addStyleClass("heading");var o=new T(this._sPrefixId+"_CompanyAddress",{text:"{/MemberProfile/Address}"});var b=new L(this._sPrefixId+"_CompanyAddressLabel",{text:this.getViewData().langBundle.getText("SP_COMPANY_ADDRESS_LABEL"),labelFor:o.getId()}).addStyleClass("label");this._oVBox.addItem(c).addItem(M).addItem(m).addItem(W).addItem(w).addItem(E).addItem(e).addItem(C).addItem(b).addItem(o);},_createHBoxHeader:function(){var h=new V(this._sPrefixId+"_HeaderVBox").addStyleClass("headervbox");var f=new T(this._sPrefixId+"_FullName",{text:"{/FullName}",width:"200px",maxLines:1}).addStyleClass("fullname");var r=new T(this._sPrefixId+"_Role",{text:"{/Title}",width:"200px",maxLines:1}).addStyleClass("role");h.addItem(f).addItem(r);var o=new H(this._sPrefixId+"_HeaderHBox",{height:"48px"});var u=new I(this._sPrefixId+"_HeaderUserImage",{src:"{/UserImage}",alt:"{/FullName}",width:"48px",height:"48px"}).addStyleClass("image");var n=new O(this._sPrefixId+"_NoUserHeader",{text:this.getViewData().langBundle.getText("SP_NO_USER"),state:"Warning",icon:"sap-icon://alert",visible:false});o.addItem(u).addItem(h).addItem(n);return o;},resetHeader:function(){var n=sap.ui.getCore().byId(this._sPrefixId+"_NoUserHeader");if(n.getVisible()===true){n.setVisible(false);sap.ui.getCore().byId(this._sPrefixId+"_HeaderVBox").setVisible(true);sap.ui.getCore().byId(this._sPrefixId+"_HeaderUserImage").setVisible(true);}},setHeaderNoUser:function(){var u=sap.ui.getCore().byId(this._sPrefixId+"_HeaderUserImage");if(u.getVisible()===true){u.setVisible(false);sap.ui.getCore().byId(this._sPrefixId+"_HeaderVBox").setVisible(false);sap.ui.getCore().byId(this._sPrefixId+"_NoUserHeader").setVisible(true);}}});});
sap.ui.predefine('sap/collaboration/components/socialtimeline/annotations/Metadata',['sap/ui/base/Object'],function(B){"use strict";
var M=B.extend("sap.collaboration.components.socialtimeline.annotations.Metadata",{
constructor:function(o){this._oIncludedSchemaAliasMap={};this._oSchemaAliasMap={};this._oODataMetadata=o;this._parseODataMetadata();},
_parseODataMetadata:function(){this._parseReferenceElements(this._oODataMetadata.extensions);this._parseDataServicesElement(this._oODataMetadata.dataServices);},
_parseReferenceElements:function(r){for(var R in r){this._parseReferenceElement(r[R]);}},
_parseReferenceElement:function(r){for(var R in r.children){this._parseReferenceElementChild(r.children[R]);}},
_parseReferenceElementChild:function(r){if(r.name==="Include"){this._parseIncludeElement(r);}else{return;}},
_parseIncludeElement:function(i){var I=null;var s=null;for(var a in i.attributes){if(i.attributes[a].name==="Namespace"){I=i.attributes[a].value;}else{s=i.attributes[a].value;}}this._oIncludedSchemaAliasMap[I]=s;},
_parseDataServicesElement:function(d){this._parseSchemaElements(d.schema);},
_parseSchemaElements:function(s){for(var S in s){this._parseSchemaElement(s[S]);}},
_parseSchemaElement:function(s){if(s.alias===undefined){this._oSchemaAliasMap[s.namespace]=null;}else{this._oSchemaAliasMap[s.namespace]=s.alias;}this._parseEntityTypeElements(s.entityType);},
_parseEntityTypeElements:function(e){for(var E in e){this._parseEntityTypeElement(e[E]);}},
_parseEntityTypeElement:function(){},
isSchemaIncluded:function(n){return(this._oIncludedSchemaAliasMap[n]!==undefined);}
});
return M;});
sap.ui.predefine('sap/collaboration/components/socialtimeline/annotations/MetadataException',['sap/ui/base/Object'],function(B){"use strict";
var M=B.extend("sap.collaboration.components.socialtimeline.annotations.MetadataException",{constructor:function(e){this._sClassName="sap.collaboration.components.socialtimeline.annotations.MetadataException";this._sExceptionMessage=e;}});
return M;});
sap.ui.predefine('sap/collaboration/components/utils/CommonUtil',['./MessageQueueUtil','sap/m/MessageBox','sap/ui/base/Object','jquery.sap.resources','jquery.sap.global'],function(M,a,B,q){"use strict";
var C=B.extend("sap.collaboration.components.utils.CommonUtil",{
constructor:function(){this.MessageQueueUtil=new M();},
getLanguageBundle:function(){if(!this.oLangBundle){var l=sap.ui.getCore().getConfiguration().getLanguage();this.oLangBundle=q.sap.resources({url:q.sap.getModulePath("sap.collaboration.components")+"/resources/i18n/messagebundle.properties",locale:l});}return this.oLangBundle;},
displayError:function(e){var s=this;var m="";var o={icon:a.Icon.ERROR,title:s.getLanguageBundle().getText("SYSTEM_ERROR_MESSAGEBOX_TITLE")};if(!e||e===""){m=s.getLanguageBundle().getText("SYSTEM_ERROR_MESSAGEBOX_GENERAL_TEXT");}else{m=e;}this.MessageQueueUtil.displayMessage(m,o,"MBox");},
showMessage:function(m,o){this.MessageQueueUtil.displayMessage(m,o,"MToast");},
isValidDate:function(d){if(Object.prototype.toString.call(d)!=="[object Date]"||isNaN(d.getTime())){q.sap.log.error("DateUtils invalid date="+d);return false;}return true;},
isString:function(o){return Object.prototype.toString.call(o)==="[object String]";},
isObject:function(o){return Object.prototype.toString.call(o)==="[object Object]";},
isFunction:function(o){return Object.prototype.toString.call(o)==="[object Function]";},
isArrayOfStrings:function(o){var i;if(Array.isArray(o)){for(i in o){if(!this.isString(o[i])){return false;}}return true;}else{return false;}},
getIconFromMimeType:function(v){var i="";if(!v){return"sap-icon://document";}if(v.indexOf('image')===0){i="sap-icon://attachment-photo";}else if(v.indexOf('video')===0){i="sap-icon://attachment-video";}else if(v.indexOf('text')===0){i="sap-icon://attachment-text-file";}else if(v.indexOf('audio')===0){i="sap-icon://attachment-audio";}else if(v.indexOf('audio')===0){i="sap-icon://attachment-audio";}else if(v.indexOf('application')===0){switch(v){case'application/vnd.openxmlformats-officedocument.presentationml.presentation':case'application/vnd.ms-powerpoint':case'application/vnd.openxmlformats-officedocument.presentationml.template':i="sap-icon://ppt-attachment";break;case'application/msword':case'application/vnd.openxmlformats-officedocument.wordprocessingml.document':case'application/vnd.openxmlformats-officedocument.wordprocessingml.template':i="sap-icon://doc-attachment";break;case'application/vnd.ms-excel':case'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet':case'application/vnd.openxmlformats-officedocument.spreadsheetml.template':i="sap-icon://excel-attachment";break;case'application/pdf':i="sap-icon://pdf-attachment";break;case'application/xhtml+xml':i="sap-icon://attachment-html";break;case'application/zip':case'application/gzip':i="sap-icon://attachment-zip-file";break;default:i="sap-icon://document";}}else{i="sap-icon://document";}return i;},
areArraysEqual:function(b,c){var o=function(x,y){var o=true;for(var p in x){if(x[p]!==y[p]){o=false;break;}}return o;};if(b.length!==c.length){return false;}for(var i=0;i<b.length;i++){if(!o(b[i],c[i])){return false;}}return true;},
b64toBlob:function(b,c,s){c=c||'';s=s||512;var d=window.atob(b);var e=[];for(var o=0;o<d.length;o+=s){var f=d.slice(o,o+s);var g=new Array(f.length);for(var i=0;i<f.length;i++){g[i]=f.charCodeAt(i);}var h=new window.Uint8Array(g);e.push(h);}var j=new window.Blob(e,{type:c});return j;},
getODataResult:function(d){return d.results?d.results:d;},
});
return C;});
sap.ui.predefine('sap/collaboration/components/utils/JamUtil',["sap/ui/base/Object","jquery.sap.global","sap/collaboration/library"],function(BaseObject,jQuery,library){"use strict";var FeedType=library.FeedType;
var JamUtil=BaseObject.extend("sap.collaboration.components.utils.JamUtil",{
FeedRenderedControllerConstants:{jamWidgetCSS:{avatar:false,skin:"gr",post_mode:"inline",reply_mode:"inline",mobile_mode:true,live_update:true}},
JamFeedType:{Follows:"follows",Company:"company",Group:"group",ObjectGroup:"context",Object:"external"},
JamCallback:{autocomplete:"autocomplete",post_status:"post_status",link:"link"},
JamEventType:{mouseover:"mouseover",mouseout:"mouseout",click:"click"},
loadFeedWidgetScript:function(j,l,L){var s=this;var S=j+"/assets/feed_widget_v1.js";jQuery.sap.includeScript(S,"sap.collaboration.feed.JamFeedWidget",l,L);jQuery.sap.log.info("Jam Feed Widget Script Loading Asynchronously","sap.collaboration.components.utils.JamUtil.loadFeedWidgetScript()");},
initializeJamWidget:function(sJamURL){try{this.sapjam=eval('sapjam');this.sapjam.feedWidget.init(sJamURL+"/widget/v1/feed","single_use_token");jQuery.sap.log.info("Jam Feed Widget Initialized","sap.collaboration.components.utils.JamUtil.initializeJamWidget()");}catch(oError){jQuery.sap.log.error(oError,"","sap.collaboration.components.utils.JamUtil.initializeJamWidget()");throw oError;}},
createJamWidget:function(sWidgetContainerID,oWidgetData){try{jQuery.sap.log.debug("Jam Feed Widget Properties:","","sap.collaboration.components.utils.JamUtil.createJamWidget()");jQuery.sap.log.debug("type: "+JSON.stringify(oWidgetData.type));jQuery.sap.log.debug("group_id: "+JSON.stringify(oWidgetData.group_id));jQuery.sap.log.debug("external_id: "+JSON.stringify(oWidgetData.external_id));jQuery.sap.log.debug("external_type: "+JSON.stringify(oWidgetData.external_type));jQuery.sap.log.debug("external_object: "+JSON.stringify(oWidgetData.external_object));this.sapjam=eval('sapjam');this.sapjam.feedWidget.create(sWidgetContainerID,oWidgetData);}catch(oError){jQuery.sap.log.error(oError,"","sap.collaboration.components.utils.JamUtil.createJamWidget()");throw oError;}},
prepareWidgetData:function(j,f,g,b){var w;w={type:f,avatar:this.FeedRenderedControllerConstants.jamWidgetCSS.avatar,live_update:this.FeedRenderedControllerConstants.jamWidgetCSS.live_update,post_mode:this.FeedRenderedControllerConstants.jamWidgetCSS.post_mode,reply_mode:this.FeedRenderedControllerConstants.jamWidgetCSS.reply_mode,mobile_mode:this.FeedRenderedControllerConstants.jamWidgetCSS.mobile_mode,hide_bookmark:true,single_use_token:j};switch(f){case FeedType.follows:case FeedType.company:w.type=f;break;case FeedType.group:case FeedType.objectGroup:w.type=this.JamFeedType.Group;w.group_id=g;break;case FeedType.object:w.type=this.JamFeedType.Object;if(!b){var E=new Error("Object is undefined");jQuery.sap.log.error(E,"","sap.collaboration.components.utils.JamUtil.prepareWidgetData()");throw E;}if(!b.id){var o=new Error("Property 'id' is undefined");jQuery.sap.log.error(o,"","sap.collaboration.components.utils.JamUtil.prepareWidgetData()");throw o;}if(!b.type){var a=new Error("Property 'type' is undefined");jQuery.sap.log.error(a,"","sap.collaboration.components.utils.JamUtil.prepareWidgetData()");throw a;}try{w.external_id=b.id;w.external_type=b.type;w.external_object=b;}catch(c){jQuery.sap.log.error(c,"","sap.collaboration.components.utils.JamUtil.prepareWidgetData()");throw c;}break;default:var e="Feed Type not supported";jQuery.sap.log.error(e,"","sap.collaboration.components.utils.JamUtil.prepareWidgetData()");throw new Error(e);}return w;},
getJamSinglelUseTokens:function(c,a,A,C){var s=this;var x=new window.XMLHttpRequest();var S=c+"/single_use_tokens";x.open("POST",S,A);x.onreadystatechange=a;x.setRequestHeader("x-csrf-token",C);x.send();},
getCSRFToken:function(e,a,A){var s=this;var x=new window.XMLHttpRequest();x.open("GET",e,A);x.onreadystatechange=a;x.setRequestHeader("x-csrf-token","fetch");x.send();}
});
return JamUtil;});
sap.ui.predefine('sap/collaboration/components/utils/MessageQueueUtil',['sap/m/MessageBox','sap/m/MessageToast','sap/ui/base/Object'],function(M,a,B){"use strict";
var b=B.extend("sap.collaboration.components.utils.MessageQueueUtil",{
messageTypes:{messageToast:"MToast",messageBox:"MBox"},
aMessageQueue:[],
displayMessage:function(m,o,t){var l=o;l.onClose=this.afterMessageClose();this.addMessageToQueue(m,l,t);if(this.aMessageQueue.length==1){if(this.aMessageQueue[0].type==this.messageTypes.messageBox){M.show(this.aMessageQueue[0].message,this.aMessageQueue[0].options);}else if(this.aMessageQueue[0].type==this.messageTypes.messageToast){a.show(this.aMessageQueue[0].message,this.aMessageQueue[0].options);}}},
addMessageToQueue:function(m,l,t){this.aMessageQueue.push({message:m,options:l,type:t});},
afterMessageClose:function(){var s=this;return function(){s.aMessageQueue.shift();if(s.aMessageQueue.length!=0){if(s.aMessageQueue[0].type==s.messageTypes.messageBox){M.show(s.aMessageQueue[0].message,s.aMessageQueue[0].options);}else if(s.aMessageQueue[0].type==s.messageTypes.messageToast){a.show(s.aMessageQueue[0].message,s.aMessageQueue[0].options);}}};}
});
return b;});
sap.ui.predefine('sap/collaboration/components/utils/NotificationTypeUtil',["sap/ui/base/Object"],function(B){"use strict";
var N=B.extend("sap.collaboration.components.utils.NotificationTypeUtil",{
map:{AbuseReported:[],AcceptAddedAsAssistant:["SenderFullName"],AcceptAddedAsMgr:["SenderFullName"],AcceptAddedAsReport:["SenderFullName"],AddedAsAssistant:["SenderFullName"],AddedAsMgr:["SenderFullName"],AddedAsReport:["SenderFullName"],AutoGroupAdmin:["SenderFullName"],AutoGroupMember:["SenderFullName"],CommentInDiscussion:["SenderFullName"],CrossCompanyInviteToGroup:["SenderFullName","ObjName"],FeatureInGroup:["SenderFullName"],GoalMigrated:[],GroupContentPendingApproval:[],GroupAccessRequest:["ObjName"],InviteToFollow:["SenderFullName"],InviteToInactiveGroup:["SenderFullName"],InviteToGroup:["SenderFullName"],Like:["SenderFullName"],MarkComment:["SenderFullName"],MarkCommentSimple:["SenderFullName"],MentionInFeed:["SenderFullName"],ReceiveKudoType:["SenderFullName","ObjName"],ReceivedKudo:["SenderFullName","ObjName"],ReceiveKudo:["SenderFullName","ObjName"],RejectAddedAsAssistant:["SenderFullName"],RejectAddedAsMgr:["SenderFullName"],RejectAddedAsReport:["SenderFullName"],ReplyInFeed:["SenderFullName"],RemovedAsAssistant:["SenderFullName"],RemovedAsMgr:["SenderFullName"],RemovedAsReport:["SenderFullName"],RejectPendingContent:["ObjName"],RequestToBeGroupAdmin:["SenderFullName"],SkillNudge:["SenderFullName"],SubscribedToFeed:["SenderFullName"],SuggestTopic:["SenderFullName","ObjName"],send_nudge:["custom_brand_name"],TaskAssigned:["SenderFullName"],TaskNudge:["SenderFullName"],user_new_features:["custom_brand_name"]},
getRequiredNotificationPropertyNames:function(n){return this.map[n]?this.map[n]:[];}
});
return N;});
sap.ui.predefine('sap/collaboration/components/utils/OdataUtil',['./CommonUtil','sap/ui/base/Object','jquery.sap.global'],function(C,B,q){"use strict";
var O=B.extend("sap.collaboration.components.utils.OdataUtil",{
OdataUtilConstants:{HttpStatusCode:{success:200,created:201},EndPoint:{AssignedGroups:"AssignedGroups",BusinessObjects:"BusinessObjects",ContentItems:"ContentItems",PostContentItem:"PostContentItem",Feed:"Feed",Folders:"Folders",GetCollaborationHostUrl:"GetCollaborationHostURL",MapInternalBOToExternalBO:"MapInternalBOToExternalBO",GetExternalODataURL:"GetExternalODataURL",GetSingleUseToken:"GetSingleUseToken",Groups:"Groups",GroupsCount:"Groups/$count",GetNotificationUnreadCount:"GetNoticeUnreadCount",Notifications:"Notices",FeaturedExternalObjects:"FeaturedExternalObjects",GroupsAsFeatured:"GroupsAsFeatured",ExternalObjects:"ExternalObjects",Activities:"Activities",ExternalObjects_FindByExidAndObjectType:"ExternalObjects_FindByExidAndObjectType"},HttpMethod:{GET:"GET",POST:"POST"},ResponseType:{blob:"blob",arraybuffer:"arraybuffer"}},
constructor:function(){this.oCommonUtil=new C();this.bError=false;},
getJamUrl:function(o,p,a){var e="";var j="";var s=function(d,r){if(p){p.resolve(d.GetCollaborationHostURL.URL);}else{j=d.GetCollaborationHostURL.URL;}};var E=function(b){q.sap.log.error(JSON.stringify(b));e=b.response.statusCode;if(p){p.reject(e);}};o.read("/"+this.OdataUtilConstants.EndPoint.GetCollaborationHostUrl,{success:s,error:E,async:a});if(!p){return j;}},
createJamUrlBatchOperation:function(o){var d=null;var p=null;var b;try{b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.GetCollaborationHostUrl,this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){q.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createJamUrlBatchOperation()");throw e;}return b;},
getJamToken:function(o){var j="";var e="";var s=function(d,r){j=d.GetSingleUseToken.Id;};var E=function(a){q.sap.log.error(JSON.stringify(a));e=a.response.statusCode;};o.read("/"+this.OdataUtilConstants.EndPoint.GetSingleUseToken,null,null,false,s,E);if(e){throw new Error(e);}return j;},
createJamTokenBatchOperation:function(o){var d=null;var p=null;var b;try{b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.GetSingleUseToken,this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){q.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createJamTokenBatchOperation()");throw e;}return b;},
getGroupsData:function(o,s){var g;var e="";var S=function(d,r){g=this.oCommonUtil.getODataResult(d);}.bind(this);var E=function(a){q.sap.log.error(JSON.stringify(a));e=a.response.statusCode;};o.read(s,null,null,false,S,E);if(e){throw new Error(e);}return g;},
createGetGroupsDataBatchOperation:function(o){var d=null;var p=null;var b;try{b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.Groups,this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){q.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createGetGroupsDataBatchOperation()");throw e;}return b;},
createGetGroupsCountBatchOperation:function(o){var d=null;var p=null;var b;try{b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.GroupsCount,this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){q.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createGetGroupsCountDataBatchOperation()");throw e;}return b;},
createGetGroupsLinkedToBOBatchOperation:function(o,e){var d=null;var p=null;var b;var s="/"+this.OdataUtilConstants.EndPoint.ExternalObjects+"(ApplicationContext='"+q.sap.encodeURL(e.appContext.replace(/'/g,"''"))+"',"+"OdataServicePath='"+q.sap.encodeURL(e.odataServicePath.replace(/'/g,"''"))+"',"+"OdataCollection='"+q.sap.encodeURL(e.collection.replace(/'/g,"''"))+"',"+"OdataKey='"+q.sap.encodeURL(e.key.replace(/'/g,"''"))+"')/"+this.OdataUtilConstants.EndPoint.GroupsAsFeatured;b=o.createBatchOperation(s,this.OdataUtilConstants.HttpMethod.GET,d,p);return b;},
createGetObjectGroupsBatchOperation:function(o,b){var d=null;var p=null;var a;try{a=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.BusinessObjects+"('"+q.sap.encodeURL(b)+"')/"+this.OdataUtilConstants.EndPoint.AssignedGroups,this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){q.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createGetObjectGroupsBatchOperation()");throw e;}return a;},
getGroupIds:function(g){var G="";for(var i=0;i<g.length;i++){if(i==0){G+=g[i].Id;}else{G+=","+g[i].Id;}}return G;},
createGroupFeed:function(o,g,f){var s="/"+this.OdataUtilConstants.EndPoint.Groups+"("+q.sap.encodeURL(g)+")/"+this.OdataUtilConstants.EndPoint.Feed;var p={"Text":f};var S=undefined;var a=function(){S=true;};var e=function(E){q.sap.log.error(JSON.stringify(E.response.body));S=false;};o.create(s,p,null,a,e);return S;},
executeODataBatchRequest:function(o,r,p,a,e){var s=this;var R;var S=function(d){R=s.parseBatchResponse(d.__batchResponses);p(R);};var E=function(d){if(d.response){q.sap.log.error(JSON.stringify(d.response.body));}else{q.sap.log.error(JSON.stringify(d.message));}e(d);};var b=[];var c=[];for(var i in r){if(r[i].method==this.OdataUtilConstants.HttpMethod.GET){b.push(r[i]);}else if(r[i].method==this.OdataUtilConstants.HttpMethod.POST){c.push(r[i]);}}if(b.length>0){o.addBatchReadOperations(b);}for(var i=0;i<c.length;i++){o.addBatchChangeOperations([c[i]]);}if(a===true){o.submitBatch(S,E,true);}else{o.submitBatch(S,E,false);}},
parseBatchResponse:function(b){var s=this;var r=[];q.sap.each(b,function(i,R){if(R.statusCode&&R.statusCode.match(s.OdataUtilConstants.HttpStatusCode.success)){r.push(R.data);}else if(R.__changeResponses){for(var i=0;i<R.__changeResponses.length;i++){if(R.__changeResponses[i].statusCode&&(R.__changeResponses[i].statusCode.match(s.OdataUtilConstants.HttpStatusCode.created)||R.__changeResponses[i].statusCode.match(s.OdataUtilConstants.HttpStatusCode.success))){r.push(R.__changeResponses[i].data);}else{r.push({error:R.__changeResponses[i].response.body});q.sap.log.error(JSON.stringify(R.__changeResponses[i].response.body),"sap.collaboration.components.utils.OdataUtil.parseBatchResponse()");}}}else{r.push({error:R.response.body});q.sap.log.error(JSON.stringify(R.response.body),"sap.collaboration.components.utils.OdataUtil.parseBatchResponse()");}});return r;},
createExternalOdataUrlBatchOperation:function(o,r){var p=null;var d=null;var b;try{b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.GetExternalODataURL+"/?RelativePath='"+q.sap.encodeURL(r)+"'",this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){q.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createExternalOdataUrlBatchOperation()");throw e;}return b;},
getExternalOdataUrl:function(o,r){var e="";var E="";var u={};u["RelativePath"]="'"+r+"'";var s=function(d,a){e=d.GetExternalODataURL.URL;};var f=function(a){q.sap.log.error(JSON.stringify(a));E=a.response.statusCode;};o.read("/"+this.OdataUtilConstants.EndPoint.GetExternalODataURL,null,u,false,s,f);if(E){throw new Error(E);}return e;},
createNotificationUnreadCountBatchOperation:function(o){var d=null;var p=null;var b;try{b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.GetNotificationUnreadCount,this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){q.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createNotificationUnreadCountBatchOperation()");throw e;}return b;},
createNotificationBatchOperation:function(o,n){var d=null;var p=null;var b;try{b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.Notifications+"?$top="+q.sap.encodeURL(n.toString()),this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){q.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createNotificationBatchOperation()");throw e;}return b;},
createGroupFeedBatchOperation:function(o,g,f){var s="/"+this.OdataUtilConstants.EndPoint.Groups+"("+q.sap.encodeURL(g)+")/"+this.OdataUtilConstants.EndPoint.Feed;var d={"Text":f.note,"UiUrl":f.uiUrl};var p=null;var b;try{b=o.createBatchOperation(s,this.OdataUtilConstants.HttpMethod.POST,d,p);}catch(e){q.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createGroupFeedBatchOperation()");throw e;}return b;},
createUploadFileBatchOperation:function(o,a,g,f){var d=null;var p=null;var b;b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.PostContentItem+"/?name='"+q.sap.encodeURL(a.name)+"'&"+"groupId='"+q.sap.encodeURL(g)+"'&"+"mimeType='"+q.sap.encodeURL(a.mimeType)+"'&"+"folderId='"+q.sap.encodeURL(f)+"'&"+"url='"+q.sap.encodeURL(a.url)+"'",this.OdataUtilConstants.HttpMethod.POST,d,p);return b;},
uploadFile:function(o,a,g,f,s,e,A){var b=this.OdataUtilConstants.EndPoint.PostContentItem;var u=function(){s();};var U=function(){q.sap.log.error(a.name+" was not uploaded","","sap.collaboration.components.utils.OdataUtil.uploadFile()");e();};o.callFunction(b,'POST',{name:a.name,groupId:g,mimeType:a.mimeType,url:a.url,folderId:f},null,u,U,A);},
getSubFolders:function(o,g,f,s,t){var a;if(!f&&g){a="/"+this.OdataUtilConstants.EndPoint.Groups+"('"+q.sap.encodeURL(g)+"')/"+this.OdataUtilConstants.EndPoint.Folders;}else{a="/"+this.OdataUtilConstants.EndPoint.Folders+"(Id='"+q.sap.encodeURL(f)+"',FolderType='Folder')/"+this.OdataUtilConstants.EndPoint.Folders;}a=a+'?$skip='+s+'&$top='+t+'&$inlinecount=allpages';var F=[];var c=0;var e="";var S=function(d,r){if(d){F=this.oCommonUtil.getODataResult(d);c=parseInt(JSON.parse(r.body).d.__count);}}.bind(this);var E=function(b){q.sap.log.error(JSON.stringify(b));e=b.response.statusCode;};o.read(a,null,null,false,S,E);if(e){throw new Error(e);}return{folders:F,count:c};},
createShareFeaturedObjectBatchOperation:function(o,e,g){var s="/"+this.OdataUtilConstants.EndPoint.Groups+"("+q.sap.encodeURL(g)+")/"+this.OdataUtilConstants.EndPoint.FeaturedExternalObjects;var d={"ApplicationContext":e.appContext,"OdataServicePath":e.odataServicePath,"OdataCollection":e.collection,"OdataKey":e.key,"Name":e.name,"Summary":e.summary,"UiUrl":e.uiUrl,"Comment":e.note};var p=null;var b;b=o.createBatchOperation(s,this.OdataUtilConstants.HttpMethod.POST,d,p);return b;},
getExternalObjectMapping:function(o,i,p){var s="/"+this.OdataUtilConstants.EndPoint.MapInternalBOToExternalBO;var u={};u["ApplicationContext"]="'"+i.appContext+"'";u["ODataCollection"]="'"+i.collection+"'";u["ODataKeyPredicate"]="'"+i.key+"'";u["ODataServicePath"]="'"+i.odataServicePath+"'";var e="";var S=function(d,r){p.resolve(d.MapInternalBOToExternalBO);};var E=function(a){q.sap.log.error(JSON.stringify(a));e=a.response.statusCode;p.reject(e);};o.read(s,null,u,true,S,E);},
_GetJamExternalObject:function(o,e,E,s,f){var a="/"+this.OdataUtilConstants.EndPoint.ExternalObjects_FindByExidAndObjectType+"/?Exid='"+q.sap.encodeURL(e)+"'&"+"ObjectType='"+q.sap.encodeURL(E);var S=function(){s();};var b=function(c){q.sap.log.error(JSON.stringify(c.response.body));f();};o.read(a,null,null,false,S,b);}
});
return O;});
sap.ui.predefine('sap/collaboration/library',['sap/ui/core/Core'],function(C){"use strict";sap.ui.getCore().initLibrary({name:"sap.collaboration",dependencies:["sap.ui.core","sap.suite.ui.commons"],types:["sap.collaboration.AppType","sap.collaboration.DisplayFeedType","sap.collaboration.FeedType"],interfaces:[],controls:[],elements:[],version:"1.88.0"});sap.collaboration.AppType={split:"split",widget:"widget"};sap.collaboration.DisplayFeedType={BusinessRecordFeed:"BusinessRecordFeed",GroupFeedsWhereBusinessRecordIsLinked:"GroupFeedsWhereBusinessRecordIsLinked"};sap.collaboration.FeedType={follows:"follows",company:"company",group:"group",objectGroup:"objectGroup",object:"object",GroupIds:"GroupIds",BusinessObjectGroups:"BusinessObjectGroups",UserGroups:"UserGroups"};return sap.collaboration;});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2014 SAP AG. All rights reserved
 */
sap.ui.predefine('sap/collaboration/components/socialtimeline/Component',['jquery.sap.global','../controls/FilterPopover','../controls/ReplyPopover','../controls/SocialTextArea','./controls/TimelineItemEmbedded','./datahandlers/JamDataHandler','./datahandlers/SMIntegrationDataHandler','./datahandlers/ServiceDataHandler','./datahandlers/TimelineDataHandler','./filter/FilterType','./validation/InputValidator','../utils/CommonUtil','../utils/DateUtil','sap/suite/ui/commons/library','sap/suite/ui/commons/Timeline','sap/suite/ui/commons/TimelineItem','sap/ui/core/CustomData','sap/ui/core/library','sap/ui/core/Item','sap/ui/core/UIComponent','sap/ui/model/json/JSONModel','sap/ui/model/odata/ODataModel','sap/m/Button','sap/m/library','sap/m/Link','sap/m/Popover','sap/m/ResponsivePopover','sap/m/SelectList','sap/m/StandardListItem'],function(q,F,R,S,T,J,a,b,c,d,I,C,D,e,f,g,h,j,k,U,l,O,B,m,L,P,n,o,p){"use strict";var M=j.MessageType;var r=m.ButtonType;var s=m.PlacementType;var t=e.TimelineAxisOrientation;var u=e.TimelineAlignment;
var v=U.extend("sap.collaboration.components.socialtimeline.Component",{
metadata:{version:"1.0",includes:["../resources/css/SocialTimeline.css"],dependencies:{libs:["sap.collaboration"],components:[],ui5version:""},config:{},customizing:{},rootView:null,publicMethods:["setBusinessObject","setBusinessObjectKey","setBusinessObjectMap","updateTimelineEntry","deleteTimelineEntry"],aggregations:{},properties:{"enableSocial":{type:"boolean",group:"Social",defaultValue:true},"alignment":{type:"sap.suite.ui.commons.TimelineAlignment",group:"Misc",defaultValue:u.Right},"axisOrientation":{type:"sap.suite.ui.commons.TimelineAxisOrientation",group:"Misc",defaultValue:t.Vertical},"noDataText":{type:"string",group:"Misc",defaultValue:null},"showIcons":{type:"boolean",group:"Misc",defaultValue:true},"visible":{type:"boolean",group:"Appearance",defaultValue:true},"width":{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'100%'},"customFilter":{type:"object[]",group:"Social"}},events:{"customActionPress":{}}},
_defaultAttributes:{collaborationHostServiceUrl:"/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1/OData",smiServiceUrl:"/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV",pageSize:10,jamOnly:false},
init:function(){this._oLogger=q.sap.log.getLogger("sap.collaboration.components.socialtimeline.Component");this._oCollaborationHostModel;this._oSMIntegrationModel;this._oTimeline;this._oTimelineModelData={enableSocial:true,alignment:u.Right,axisOrientation:t.Vertical,enableBackendFilter:true,enableScroll:true,forceGrowing:true,noDataText:null,showIcons:true,sort:true,visible:true,width:'100%',timelineData:[],suggestions:[]};this._oTimelineModel=new l(this._oTimelineModelData);this._oTimelineModel.setSizeLimit(10000);this._oTimelineModel.bindProperty("/enableSocial").attachChange(this._onEnableSocialChange,this);this._iGrowingThreshold=this._defaultAttributes.pageSize;this._oFilterIcon;this._oContextSelect;this._oAddPostButton;this._oBusinessObjectMap={};this._oBusinessObject={};this._oCommonUtil=new C();this._oDateUtil=new D();this._oLanguageBundle=this._oCommonUtil.getLanguageBundle();this._oTimelineDataHandler;this._oJamDataHandler;this._oSMIntegrationDataHandler;this._oFilterPopover;this._oFilterConstants=new d();this._oFilter={};this._oRepliesData;this._oReplyPopover;this._oAddPostPopover;this._oSocialProfile;this._oTimelineUser={};this._oInputValidator;this._oGettingTimelineData;this._initialize();this._oInputValidator=new I(this);U.prototype.init.apply(this);},
exit:function(){if(this._oTimeline){this._oTimeline.destroy();}if(this._oAddPostPopover){this._oAddPostPopover.destroy();}if(this._oReplyPopover){this._oReplyPopover.destroy();}if(this._oFilterPopover){this._oFilterPopover.destroy();}if(this._oSocialProfile){this._oSocialProfile.destroy();}if(this._oInputValidator){this._oInputValidator.destroy();}if(this._oFilterIcon){this._oFilterIcon.destroy();}if(this._oContextSelect){this._oContextSelect.destroy();}if(this._oAddPostButton){this._oAddPostButton.destroy();}},
onBeforeRendering:function(){if(this._oInputValidator.areSocialFeaturesEnabled()===true){if(!this._oBusinessObject.key||this._oBusinessObject.key===""){this._oTimeline._filterIcon.setEnabled(false);this._oContextSelect.setEnabled(false);}}else{if(!this._oBusinessObject.key||this._oBusinessObject.key===""){this._oTimeline._filterIcon.setEnabled(false);}this._oContextSelect.setVisible(false);this._oAddPostButton.setVisible(false);}this._getLoggedInUser();this._bindTemplates();},
onAfterRendering:function(){},
createContent:function(){return this._createTimeline();},
setProperty:function(i,w){U.prototype.setProperty.call(this,i,w);this._oLogger.info(i+": "+w);switch(i){case'enableSocial':var E=w;if(E===true){E=this._oInputValidator.validateEnableSocial();}this._oTimelineModel.setProperty("/"+i,E);break;case'customFilter':var x=w;this._oInputValidator.validateCustomFilter();if(x&&x.length!==0){this._oTimeline.setCustomFilter(this._getFilter());this._oTimeline._filterIcon.setEnabled(true);}else{this._oTimeline._filterIcon.setEnabled(false);}break;default:this._oTimelineModel.setProperty("/"+i,w);break;}},
setSettings:function(i){for(var w in i){if(i.hasOwnProperty(w)){this.setProperty(w,i[w]);}}},
setBusinessObjectMap:function(i){this._oLogger.info("servicePath: "+i.servicePath);this._oLogger.info("collection: "+i.collection);this._oLogger.info("applicationContext: "+i.applicationContext);this._oBusinessObjectMap=i;this._validateBusinessObjectMap();this._defaultAttributes.jamOnly=q.isEmptyObject(this._oBusinessObjectMap.serviceModel);var w;var x;if(this._defaultAttributes.jamOnly){this._oFilter={type:this._oFilterConstants.FILTER_TYPE.feedUpdates};this._oContextSelect.setVisible(false);this._oTimeline._filterIcon.setVisible(false);}else{this._oContextSelect.setVisible(true);this._oTimeline._filterIcon.setVisible(true);w=this._oInputValidator.createTermsUtilityForBackend(this._oBusinessObjectMap.serviceModel);x=new b(this._oBusinessObjectMap.serviceModel,w);}this._oTimelineDataHandler=new c(this._oBusinessObjectMap,this._oJamDataHandler,this._oSMIntegrationDataHandler,x,w,this._iGrowingThreshold,this._oInputValidator.areSocialFeaturesEnabled(),this._oInputValidator.areBackendFeaturesEnabled());},
setBusinessObjectKey:function(K){this._oLogger.info("Business Object Key: "+K);if(!this._oTimelineDataHandler){this._oLogger.error("Function setBusinessObjectMap must be called before calling setBusinessObjectKey for the first time.");}this._oTimeline._filterIcon.setEnabled(true);this._oAddPostButton.setEnabled(false);this._oContextSelect.setEnabled(true);this._oBusinessObject={key:K,name:K};this._oTimelineDataHandler.setBusinessObject(this._oBusinessObject);if(!this._defaultAttributes.jamOnly){this._resetFilterAndContextSelector();}this._refreshTimelineModel();},
setBusinessObject:function(i){this._oBusinessObject=i;this._oLogger.info("Business Object Key: "+this._oBusinessObject.key);this._oLogger.info("Business Object Name: "+this._oBusinessObject.name);if(!this._oTimelineDataHandler){this._oLogger.error("Function setBusinessObjectMap must be called before calling setBusinessObject for the first time.");}this._validateBusinessObject();if(this._defaultAttributes.jamOnly){this._oAddPostButton.setEnabled(true);}else{this._oTimeline._filterIcon.setEnabled(true);this._oAddPostButton.setEnabled(false);this._oContextSelect.setEnabled(true);this._oTimelineDataHandler.setBusinessObject(this._oBusinessObject);}if(!this._defaultAttributes.jamOnly){this._resetFilterAndContextSelector();}this._refreshTimelineModel();},
updateTimelineEntry:function(w,x){var y=sap.ui.getCore().byId(x);var E=y.getAggregation('embeddedControl');var z=E._oFlexbox.getItems();z[0].setText(w);if(z.length>1){for(var i=1;i<z.length;i++){z[i].destroy();}}var A=y.getModel();var G=this._oTimeline.getContent().indexOf(y);A.getData().timelineData[G].timelineItemData.text=w;A.getData().timelineData[G].timelineItemData.timelineEntryDetails=[];},
deleteTimelineEntry:function(i){var w=sap.ui.getCore().byId(i);var x=w.getModel();var y=this._oTimeline.getContent().indexOf(w);x.getData().timelineData.splice(y,1);w.destroy();},
_initialize:function(){var i=true;if(!this._oCollaborationHostModel){this._oCollaborationHostModel=new O(this._defaultAttributes.collaborationHostServiceUrl,i);}if(!this._oSMIntegrationModel){this._oSMIntegrationModel=new O(this._defaultAttributes.smiServiceUrl,i);}if(!this._oJamDataHandler){this._oJamDataHandler=new J(this._oCollaborationHostModel);}if(!this._oSMIntegrationDataHandler){this._oSMIntegrationDataHandler=new a(this._oSMIntegrationModel);}},
_createTimeline:function(){this._oTimeline=new f(this.getId()+"_timeline",{enableSocial:"{/enableSocial}",alignment:"{/alignment}",axisOrientation:"{/axisOrientation}",enableBackendFilter:"{/enableBackendFilter}",enableScroll:"{/enableScroll}",forceGrowing:"{/forceGrowing}",noDataText:"{/noDataText}",showIcons:"{/showIcons}",visible:"{/visible}",width:"{/width}",sort:"{/sort}",data:[],grow:this._onGrow.bind(this),});this._modifyHeaderBar();this._oTimeline.setModel(this._oTimelineModel);return this._oTimeline;},
_modifyHeaderBar:function(){var H=this._oTimeline.getHeaderBar();var i=H.getContent();this._oFilterIcon=i[i.length-1];this._oContextSelect=this._createContextSelector();H.insertContent(this._oContextSelect,0);this._oAddPostButton=this._createAddPostButton();H.insertContent(this._oAddPostButton,3);},
_createContextSelector:function(){var i=function(E){var w=sap.ui.getCore().byId(this.getId()+"_context_select");var x=sap.ui.getCore().byId(this.getId()+"_context_select_popover");if(x==undefined){var y=[];y.push({context_type:this._oFilterConstants.FILTER_TYPE.systemUpdates,context_text:this._oLanguageBundle.getText("ST_CONTEXT_SYSTEM_UPDATES")});y.push({context_type:this._oFilterConstants.FILTER_TYPE.feedUpdates,context_text:this._oLanguageBundle.getText("ST_CONTEXT_DISCUSSION_POSTS")});var z=new l(y);this.setModel(z,"timeline_context");var A=new k({key:"{context_type}",text:"{context_text}"});var G=new o(this.getId()+"_context_select_list",{selectedKey:this._oFilterConstants.FILTER_TYPE.systemUpdates,selectionChange:[this._onContextSelect,this],width:"15rem"});G.bindAggregation("items",{path:"/",template:A});G.setModel(z);x=new P(this.getId()+"_context_select_popover",{placement:s.VerticalPreferedBottom,title:this._oLanguageBundle.getText("ST_CONTEXT_SELECT_HEADER")});x.addContent(G);}x.getContent()[0].setSelectedKey(this._oFilter.type);x.openBy(w);};var w=new B(this.getId()+"_context_select",{icon:"sap-icon://navigation-down-arrow",iconFirst:false,text:this._oLanguageBundle.getText("ST_CONTEXT_SYSTEM_UPDATES"),type:r.Transparent,press:[i,this]});return w;},
_createAddPostButton:function(){if(this._oAddPostPopover===undefined){this._oAddPostPopover=new n(this.createId("_addPostPopover"),{placement:s.Auto,title:this._oLanguageBundle.getText("ST_ADD_POST_TITLE"),contentWidth:"25rem",contentHeight:"10rem",content:new S(this.createId("social_TextArea"),{height:"10rem",width:"100%",enableNotifyAll:false,liveChange:[function(E){E.getParameter("value").trim()!==""?this.byId("addPost_postButton").setEnabled(true):this.byId("addPost_postButton").setEnabled(false);},this],suggest:[this._onSuggest,this],afterSuggestionClose:[function(){if(this.gettingSuggestions){this.gettingSuggestions.request.abort();}},this]}),endButton:new B(this.createId("addPost_postButton"),{text:this._oLanguageBundle.getText("ST_ADD_POST_BUTTON"),enabled:false,press:[this._onAddPost,this],}),beginButton:new B(this.createId("addPost_atMentionButton"),{text:"@",press:[function(){this.byId("social_TextArea").atMentionsButtonPressed();},this]})}).setInitialFocus(this.byId("social_TextArea"));}var A=new B(this.createId("_addPostButton"),{icon:"sap-icon://add",type:r.Transparent,enabled:false,press:[function(){this._oAddPostPopover.openBy(this.byId("_addPostButton"));},this]});return A;},
_refreshTimelineModel:function(){var i=this;this._oTimeline.setBusyIndicatorDelay(0).setBusy(true);this._oGettingTimelineData=this._oTimelineDataHandler.getTimelineData(this._oFilter,this._defaultAttributes.jamOnly?this._oBusinessObject:null).then(function(w){i._oTimeline.setBusy(false);i._oFilter.text===undefined||i._oFilter.text===i._oLanguageBundle.getText("ST_FILTER_ALL")?i._oTimeline.setCustomMessage(""):i._oTimeline.setCustomMessage(i._oLanguageBundle.getText("ST_FILTER_TEXT")+" "+i._oFilter.text);i._oTimeline.destroyContent();i._oTimelineModelData.timelineData=w;i._oTimelineModel.setData(i._oTimelineModelData);i._setReplies();},function(E){i._oCommonUtil.displayError();i._oTimeline.setBusy(false);});},
_bindTemplates:function(){if(this._oTimeline.getBinding("content").getPath()!=="/timelineData"){var i=new h({key:"{key}",value:"{value}"});var w=new g({dateTime:"{timelineItemData/dateTime}",userName:"{timelineItemData/userName}",title:"{timelineItemData/title}",icon:"{timelineItemData/icon}",filterValue:"{timelineItemData/filterValue}",userNameClickable:"{/enableSocial}",userNameClicked:this._onUserNameClicked,userPicture:"{timelineItemData/userPicture}",embeddedControl:this._createEmbeddedControl(),customAction:{template:i,path:"timelineItemData/customActionData"},customActionClicked:this._onCustomActionClicked.bind(this),replyCount:"{timelineItemData/replyCount}",replyListOpen:this._onReplyListOpen.bind(this)});this._oTimeline.bindAggregation("content",{path:"/timelineData",template:w});}},
_createEmbeddedControl:function(i){var w=(i===undefined)?"{}":i;var E=new T({timelineItem:w,expandCollapseClick:[function(){this._oTimeline.adjustUI();},this],atMentionClick:[this._getAtMentionClicked,this]});return E;},
_getFilter:function(){var w=this.getCustomFilter();var x=w.length;for(var i=0;i<x;i++){w[i].type=this._oFilterConstants.FILTER_TYPE.custom;}var y=[{text:this._oLanguageBundle.getText("ST_FILTER_ALL"),type:this._oFilterConstants.FILTER_TYPE.systemUpdates}].concat(w);if(!this._oFilterPopover){var z=new l({filter:y});var A=new p({title:"{text}"});this._oFilterPopover=new F(this.getId()+"_filterPopover",{title:this._oLanguageBundle.getText("ST_FILTER_HEADER"),selectionChange:[function(E){this._oFilter=E.getParameter("listItem").getBindingContext().getObject();this._oTimelineDataHandler.reset();this._refreshTimelineModel();},this]}).setModel(z).bindItems("/filter",A);this._oFilterPopover.setSelectedItem(this._oFilterPopover.getItems()[0]);}else{this._oFilterPopover.getModel().setProperty("/filter",y);}return this._oFilterPopover;},
_resetFilterAndContextSelector:function(){this._resetFilter();this._oContextSelect.setText(this._oLanguageBundle.getText("ST_CONTEXT_SYSTEM_UPDATES"));},
_resetFilter:function(){this._oTimelineModel.setProperty("/sort",true);this._oFilter={type:this._oFilterConstants.FILTER_TYPE.systemUpdates};if(this._oFilterPopover){this._oFilterPopover.setSelectedItem(this._oFilterPopover.getItems()[0]);}},
_setReplies:function(){var i=this;var w=this._oTimeline.getContent();w.forEach(function(x){var y=x.getBindingContext().getObject();if(!y._feedEntryData){i._hideReply(x);}else{x.setCustomReply(i._createReplyPopover());}});},
_hideReply:function(i){i._replyLink.setVisible(false);},
_showSocialProfile:function(i,w,E){if(i){var x=i.getParent().getParent().getParent();if(!x._oSocialProfile){x._oSocialProfile=sap.ui.getCore().createComponent({name:"sap.collaboration.components.socialprofile",id:this.getId()+"_socialProfile"});x._oSocialProfile._defaultAttributes=x._defaultAttributes;}var y={openingControl:w,memberId:E};x._oSocialProfile.setSettings(y);x._oSocialProfile.open();}},
_getFeedId:function(i){var w=i.getBindingContext().getPath();var x=w.split("/");var y=x[x.length-1];var z=i.getModel().getData().timelineData[y]._feedEntryData.Id;return z;},
_getLoggedInUser:function(){var i=this;var G=this._oJamDataHandler.getSender();G.promise.done(function(w,x){i._oTimelineUser=w;});G.promise.fail(function(E){i._oLogger.error('Failed to get the sender',E.stack);});},
_addTimelineItemToTimeline:function(i){var w=this._oTimeline.getModel().getData();w.timelineData.push(i);var x=new g({dateTime:i.timelineItemData.dateTime,userName:i.timelineItemData.userName,title:i.timelineItemData.title,text:i.timelineItemData.text,icon:i.timelineItemData.icon,userNameClickable:true,userNameClicked:this._onUserNameClicked,userPicture:i.timelineItemData.userPicture,embeddedControl:this._createEmbeddedControl(i),replyCount:i.timelineItemData.replyCount,replyListOpen:this._onReplyListOpen.bind(this),customReply:this._createReplyPopover(),});this._oTimeline.insertContent(x,0);var y=w.timelineData.indexOf(i);var z=x.getParent().getModel().createBindingContext("/timelineData/"+y);x.setBindingContext(z);},
_validateInputParameters:function(){this._oInputValidator=new I(this);if(!this._oInputValidator.areCustomFiltersValid()){this.destroy();}return this._oInputValidator;},
_validateBusinessObjectMap:function(){if(!this._oInputValidator){this._validateInputParameters();}if(!this._oInputValidator.isBusinessObjectMapValid(this._oBusinessObjectMap)){this.destroy();}},
_validateBusinessObject:function(){if(!this._oInputValidator){this._validateInputParameters();}if(!this._oInputValidator.isBusinessObjectValid(this._oBusinessObject)){this.destroy();}},
_onContextSelect:function(E){var i=E.getParameter("selectedItem");this._oFilter={type:i.getKey()};if(i.getKey()==this._oFilterConstants.FILTER_TYPE.feedUpdates){this._oTimelineModel.setProperty("/sort",false);this._oFilterIcon.setEnabled(false);this._oAddPostButton.setEnabled(true);}else{if(!this._defaultAttributes.jamOnly){this._resetFilter();}this._oFilterIcon.setEnabled(true);this._oAddPostButton.setEnabled(false);}this._oTimelineDataHandler.reset();this._refreshTimelineModel();var w=sap.ui.getCore().byId(this.getId()+"_context_select_popover");w.close();this._oContextSelect.setText(i.getText());},
_onGrow:function(){var i=this;if(!this._oGettingTimelineData||this._oGettingTimelineData.state()!="pending"){this._oGettingTimelineData=this._oTimelineDataHandler.getTimelineData(this._oFilter).then(function(w){var x=i._oTimelineModel.getData();x.timelineData=x.timelineData.concat(w);i._oTimelineModel.setData(x);i._setReplies();},function(E){i._oCommonUtil.displayError();});}else{this._oLogger.info("A previous request is still pending.");}},
_onUserNameClicked:function(i){var w=i.getSource().getParent().getParent();var x=i.getSource().getParent();var y=i.getSource();if(!w._oSocialProfile){w._oSocialProfile=sap.ui.getCore().createComponent({name:"sap.collaboration.components.socialprofile",id:this.getId()+"_socialProfile"});w._oSocialProfile._defaultAttributes=w._defaultAttributes;}var z=x.getContent().indexOf(y);var A={openingControl:y._userNameLink,memberId:x.getModel().getData().timelineData[z].timelineItemData.userEmail};w._oSocialProfile.setSettings(A);w._oSocialProfile.open();},
_onAddPost:function(i){var w=this;var x=this.byId("social_TextArea").convertTextWithFullNamesToEmailAliases();this.byId("_addPostPopover").close();if(x&&x.trim()!==""){this._oTimeline.setBusyIndicatorDelay(0).setBusy(true);this._oJamDataHandler.addPostToExternalObject(x,this._oTimelineDataHandler.getCurrentExternalBO()).then(function(y){w.byId("social_TextArea").clearText();w.byId("addPost_postButton").setEnabled(false);if(w._oFilter.type!==w._oFilterConstants.FILTER_TYPE.systemUpdates&&w._oFilter.type!==w._oFilterConstants.FILTER_TYPE.custom){var z=w._oTimelineDataHandler._mapFeedEntriesToTimelineItems([y])[0];w._addTimelineItemToTimeline(z);if(!w._oTimelineDataHandler.getUserInfoFromBuffer(y.Creator.Email)){w._oTimelineDataHandler.addUserInfoToBuffer(y.Creator);}}}).always(function(){w._oTimeline.setBusy(false);}).fail(function(){w._oCommonUtil.displayError(w._oLanguageBundle.getText("ST_POST_TO_JAM_FAILED"));});}else{this._oLogger.info('Posting an empty comment is not allowed, no feed entry will be created.');}},
_onSuggest:function(E){var w=this;if(this.gettingSuggestions){this.gettingSuggestions.request.abort();}var x=E.getSource();var V=E.getParameter("value");if(V.trim()===""){x.showSuggestions([]);}else{this.gettingSuggestions=this._oJamDataHandler.getSuggestions(V);this.gettingSuggestions.promise.done(function(y,z){var A=y.results;if(A.length===0){x.closeSuggestionPopover();}else{var G=[];for(var i=0;i<A.length;i++){G.push({fullName:A[i].FullName,email:A[i].Email,userImage:w._buildThumbnailImageURL(A[i].Id)});}x.showSuggestions(G);}});this.gettingSuggestions.promise.fail(function(i){if(i.response&&i.response.statusCode){w._oCommonUtil.displayError(w._oLanguageBundle.getText("ST_GET_SUGGESTIONS_FAILED"));}});}},
_onCustomActionClicked:function(i){var w={};var x=i.getSource().getBindingContext();var y=x.getPath();var z=i.getSource().getModel().getProperty(y+"/timelineItemData/customActionData/oDataEntry");w.oDataEntry=z;w.timelineEntryId=i.getParameters().id;w.key=i.getParameters().key;this.fireCustomActionPress(w);},
_getAtMentionClicked:function(i){var w=this;var A=[];var x=i.getSource();var y=i.getParameter("link");var z=this._oJamDataHandler.getAtMentions(y.getModel().getData().feedId);z.promise.done(function(E,G){var H=y.getModel().getProperty("/placeholderIndex");A=E.results;w._showSocialProfile(x,y,A[H].Email);});z.promise.fail(function(){w._oLogger.error('Failed to retrieve the @mentions.');w._oCommonUtil.displayError(w._oCommonUtil.getLanguageBundle().getText('ST_GET_ATMENTIONS_FAILED'));});},
_onReplyListOpen:function(E){if(!this._bReplyPopoverIsOpen){this._bReplyPopoverIsOpen=true;var i=E.getSource();try{var w=this._getFeedId(i);if(!w){throw new Error('Failed to get the feed entry ID.');}}catch(x){this._oLogger.error('Failed to get the feed entry ID');this._oCommonUtil.displayError(this._oLanguageBundle.getText('ST_GET_REPLIES_FAILED'));return;}this._getReplies(w,undefined,i);}},
_getReplies:function(i,N,w){var x=this;w.getCustomReply().setBusyIndicatorDelay(0).setBusy(true);this.gettingReplies=this._oJamDataHandler.getReplies(i,N);this.gettingReplies.promise.done(function(y,z){x._oRepliesData=y;var A=y.results.reverse();A.forEach(function(E){E.Creator.ThumbnailImage=x._oTimelineDataHandler.buildImageUrl(E.Creator);E.CreatedAt=x._oDateUtil.formatDateToString(E.CreatedAt);});w.getCustomReply().addReplies({data:A,more:x._oRepliesData.__next?true:false});w.getCustomReply().setBusy(false);});this.gettingReplies.promise.fail(function(E){if(E.response&&E.response.statusCode){x._oCommonUtil.displayError(x._oCommonUtil.getLanguageBundle().getText('ST_GET_REPLIES_FAILED'));}});},
_createReplyPopover:function(){this._oReplyPopover=new R({socialTextArea:new S({height:"80px",width:"100%",enableNotifyAll:false,suggestionPlacement:s.Top,suggest:[this._onSuggest,this],afterSuggestionClose:[function(){if(this.gettingSuggestions){this.gettingSuggestions.request.abort();}},this]}),postReplyPress:[this._onPostReplyPress,this],moreRepliesPress:[function(E){var i=E.getSource().getParent();if(this._oRepliesData.__next){this._getReplies(undefined,this._oRepliesData.__next,i);}},this],afterClose:[function(E){if(this.gettingReplies){this.gettingReplies.request.abort();}this._bReplyPopoverIsOpen=false;},this],});this._oReplyPopover.getSocialTextArea().attachLiveChange(function(E){E.getParameter("value").trim()!==""?this.enableButton(true):this.enableButton(false);}.bind(this._oReplyPopover));return this._oReplyPopover;},
_onPostReplyPress:function(E){var i=this;var V=E.getParameter("value");var w=E.getSource().getParent();var x=w.getBindingContext().getObject();var y=x.timelineItemData.feedId;var z=w.getCustomReply();z.setBusyIndicatorDelay(0).setBusy(true);var A=this._oJamDataHandler.postReply(y,V);z._oReplyTextArea.focus();A.promise.done(function(G,H){z.getTextArea().clearText();z.enableButton(false);var K={Text:G.results.Text,Creator:{Email:i._oTimelineUser.Email,FullName:i._oTimelineUser.FullName},CreatedAt:i._oDateUtil.formatDateToString(G.results.CreatedAt),};var N=i._oTimelineDataHandler.getUserPicture(i._oTimelineUser.Email);N?K.Creator.ThumbnailImage=N:K.Creator.ThumbnailImage=i._oTimelineDataHandler.buildImageUrl(G.results);z.addReply(K);z.setBusy(false);w.setReplyCount(w.getReplyCount()+1);});A.promise.fail(function(G){z.setBusy(false);i._oCommonUtil.displayError(i._oLanguageBundle.getText("ST_POST_REPLY_FAILED"));});},
_onEnableSocialChange:function(E){var i=E.getSource().getValue();(i===true)?this._oAddPostButton.setVisible(true):this._oAddPostButton.setVisible(false)},
_showFeedUpdatesInTimeline:function(i){var w=this._oTimeline.getMessageStrip();if(i>0){if(!this.byId("refreshLink")){var x=new L(this.createId("refreshLink"),{text:this._oLanguageBundle.getText("GF_REFRESH_FEED"),press:[function(){this._hideFeedUpdatesInTimeline();this._oTimelineDataHandler.reset();this._refreshTimelineModel();},this]});w.setLink(x);w.setType(M.Information);w.setShowIcon(true);}i==1?w.setText(this._oLanguageBundle.getText("GF_NEW_FEED_UPDATE")):w.setText(this._oLanguageBundle.getText("GF_NEW_FEED_UPDATES",i));w.setVisible(true);this._oTimeline.rerender();}},
_hideFeedUpdatesInTimeline:function(){var i=this._oTimeline.getMessageStrip();i.close();},
_startAutoCheckingForNewUpdates:function(){this._iNewFeedUpdatesCheckerTimeDelay=120000;this._sNewFeedUpdatesCheckerTimeoutId=q.sap.delayedCall(this._iNewFeedUpdatesCheckerTimeDelay,this,this._checkForNewFeedUpdates);},
_stopAutoCheckingForNewUpdates:function(){q.sap.clearDelayedCall(this._sNewFeedUpdatesCheckerTimeoutId);},
_checkForNewFeedUpdates:function(){var i=function(z,A){this._showFeedUpdatesInTimeline(z);this._sNewFeedUpdatesCheckerTimeoutId=q.sap.delayedCall(this._iNewFeedUpdatesCheckerTimeDelay,this,this._checkForNewFeedUpdates);};var E=function(z){this._oLogger.error("Failed to check for new feed updates.");this._sNewFeedUpdatesCheckerTimeoutId=q.sap.delayedCall(this._iNewFeedUpdatesCheckerTimeDelay,this,this._checkForNewFeedUpdates);};var w=this._oTimeline.getContent()[0];var x=w?w.getBindingContext().getObject()._feedEntryData.TopLevelId:'';var y=this._oTimelineDataHandler.getCurrentExternalBO().Id;this._oJamDataHandler.getFeedUpdatesLatestCount(x,y).done(i.bind(this)).fail(E.bind(this));},
_buildThumbnailImageURL:function(i){return this._defaultAttributes.collaborationHostServiceUrl+"/Members('"+i+"')/ThumbnailImage/$value";}
});
return v;});
sap.ui.predefine('sap/collaboration/components/socialtimeline/annotations/TimelineTermsUtility',['./MetadataException','sap/ui/base/Object','jquery.sap.global'],function(M,B,q){"use strict";
var T=B.extend("sap.collaboration.components.socialtimeline.annotations.TimelineTermsUtility",{
constructor:function(s,S){this._oLogger=q.sap.log.getLogger("sap.collaboration.components.socialtimeline.annotations.TimelineTermsUtility");this._oServiceMetadata=s;this._oServiceAnnotations=S;this._oEntityMappings={};this.sSchemaNamespace="com.sap.vocabularies.Timeline.v1";var o=this._getIncludedSchema(this.sSchemaNamespace);if(!(o&&o.schemaNamespace===this.sSchemaNamespace)){var e="Schema with namespace "+this.sSchemaNamespace+" wasn't in an Include in the service's metadata document.";this._oLogger.error(e);throw new M(e);}},
getTimelineEntryNavigationPath:function(e){if(!e){var E=new Error('Parameter sEntityCollection is undefined');this._oLogger.error(E.message);throw E;}var m=this._oEntityMappings[e];if(!m){m=this._buildMapping(e);}return m.timelineEntryNavigationPath;},
getTimelineEntryFields:function(e){if(!e){var E=new Error('Parameter sEntityCollection is undefined');this._oLogger.error(E.message);throw E;}var m=this._oEntityMappings[e];if(!m){m=this._buildMapping(e);}var t=this._oEntityMappings[e].timelineEntryFields;if(!t){var o=this._oServiceAnnotations[m.timelineEntryEntityTypeFull][this.sSchemaNamespace+".TimelineEntry"];if(!o){o=this._oServiceAnnotations[m.timelineEntryEntityTypeFull][this._getCollaborationAlias()+".TimelineEntry"];}t=this._mapEntityFields(o);this._oEntityMappings[e].timelineEntryFields=t;}return t;},
getTimelineEntryDetailFields:function(e){if(!e){var E=new Error('Parameter sEntityCollection is undefined');this._oLogger.error(E.message);throw E;}var m=this._oEntityMappings[e];if(!m){m=this._buildMapping(e);}var t=this._oEntityMappings[e].timelineEntryDetailFields;if(!t){var o=this._oServiceAnnotations[m.timelineEntryDetailEntityTypeFull][this.sSchemaNamespace+".TimelineDetailPropertyValueChange"];if(!o){o=this._oServiceAnnotations[m.timelineEntryDetailEntityTypeFull][this._getCollaborationAlias()+".TimelineDetailPropertyValueChange"];}t=this._mapEntityFields(o);this._oEntityMappings[e].timelineEntryDetailFields=t;}return t;},
_buildMapping:function(e){this._oEntityMappings[e]={};this._oEntityMappings[e].entityCollection=e;this._oEntityMappings[e].entityTypeFull=this._getEntityTypeFull(e);this._oEntityMappings[e].namespace=this._oEntityMappings[e].entityTypeFull.split(".")[0];this._oEntityMappings[e].entityType=this._oEntityMappings[e].entityTypeFull.split(".")[1];var E=this._oServiceAnnotations[this._oEntityMappings[e].entityTypeFull][this.sSchemaNamespace+".TimelineNavigationPath"];if(!E){E=this._oServiceAnnotations[this._oEntityMappings[e].entityTypeFull][this._getCollaborationAlias()+".TimelineNavigationPath"];}this._oEntityMappings[e].timelineEntryNavigationPath=E.NavigationPropertyPath;this._oEntityMappings[e].timelineEntryEntityTypeFull=this._getChildEntityTypeFull(this._oEntityMappings[e].entityType,this._oEntityMappings[e].timelineEntryNavigationPath);this._oEntityMappings[e].timelineEntryEntityType=this._oEntityMappings[e].timelineEntryEntityTypeFull.split(".")[1];this._oEntityMappings[e].timelineEntryFields=undefined;var t=this._oServiceAnnotations[this._oEntityMappings[e].timelineEntryEntityTypeFull][this.sSchemaNamespace+".TimelineEntry"];if(!t){t=this._oServiceAnnotations[this._oEntityMappings[e].timelineEntryEntityTypeFull][this._getCollaborationAlias()+".TimelineEntry"];}this._oEntityMappings[e].timelineEntryDetailNavigationPath=t.TimelineDetailNavigationPath.NavigationPropertyPath;this._oEntityMappings[e].timelineEntryDetailEntityTypeFull=this._getChildEntityTypeFull(this._oEntityMappings[e].timelineEntryEntityType,this._oEntityMappings[e].timelineEntryDetailNavigationPath);this._oEntityMappings[e].timelineEntryDetailFields=undefined;return this._oEntityMappings[e];},
_getEntityTypeFull:function(e){for(var i=this._oServiceMetadata.dataServices.schema.length-1;i>=0;i--){var m=this._oServiceMetadata.dataServices.schema[i];if(m.entityContainer){var E=m.entityContainer[0].entitySet;for(var j=E.length-1;j>=0;j--){if(E[j].name===e){return E[j].entityType;}}}}throw new Error("Entity collection '"+e+"' could not be found in service");},
_getChildEntityTypeFull:function(e,n){var E=this._getEntityTypeObject(e);var N=this._getNavigationProperty(E,n);var a=this._getAssociationEnd(N.toRole);return a.type;},
_getEntityTypeObject:function(e){for(var i=this._oServiceMetadata.dataServices.schema.length-1;i>=0;i--){var m=this._oServiceMetadata.dataServices.schema[i];if(m.entityType){var E=m.entityType;for(var j=E.length-1;j>=0;j--){if(E[j].name===e){return E[j];}}}}throw new Error("Entity Type '"+e+"' could not be found in service");},
_getNavigationProperty:function(e,n){if(e.navigationProperty){for(var k=e.navigationProperty.length-1;k>=0;k--){if(e.navigationProperty[k].name===n){return e.navigationProperty[k];}}}throw new Error("Navigation property '"+n+"' could not be found for entity '"+e.name+"'.");},
_getAssociationEnd:function(r){for(var i=this._oServiceMetadata.dataServices.schema.length-1;i>=0;i--){var m=this._oServiceMetadata.dataServices.schema[i];if(m.association){for(var j=m.association.length-1;j>=0;j--){for(var k=m.association[j].end.length-1;k>=0;k--){if(m.association[j].end[k].role===r){return m.association[j].end[k];}}}}}throw new Error("Association with role '"+r+"' could not be found in service.");},
_mapEntityFields:function(e){var f={};for(var p in e){if(e.hasOwnProperty(p)){if(e[p].Path){f[p]=e[p].Path;}else if(e[p].PropertyPath){f[p]=e[p].PropertyPath;}else if(e[p].EnumMember){f[p]=e[p].EnumMember;}else if(e[p].NavigationPropertyPath){f[p]=e[p].NavigationPropertyPath;}}}return f;},
_getCollaborationAlias:function(){var a=this._oServiceAnnotations.aliasDefinitions;for(var b in a){if(a[b].indexOf("com.sap.vocabularies.Timeline.v1")>-1){return b;}}},
_getIncludedSchema:function(s){var i=0;var j=0;var k=0;var r;var R;var I;var S={schemaNamespace:undefined,schemaAlias:undefined};if(this._oServiceMetadata&&this._oServiceMetadata.extensions){for(i=0;i<this._oServiceMetadata.extensions.length;++i){r=this._oServiceMetadata.extensions[i];for(j=0;j<r.children.length;++j){R=r.children[j];if(R.name=="Include"){for(k=0;k<R.attributes.length;++k){I=R.attributes[k];if(I.name=="Namespace"){S.schemaNamespace=I.value;}if(I.name=="Alias"){S.schemaAlias=I.value;}}if(S.schemaNamespace==s){return S;}}}}return undefined;}return undefined;}
});
return T;});
sap.ui.predefine('sap/collaboration/components/socialtimeline/datahandlers/JamDataHandler',['sap/ui/base/Object','sap/collaboration/components/utils/OdataUtil','jquery.sap.global'],function(B,O,q){"use strict";
var J=B.extend("sap.collaboration.components.socialtimeline.datahandlers.JamDataHandler",{
constructor:function(c){this._oLogger=q.sap.log.getLogger("sap.collaboration.components.socialtimeline.datahandlers.JamDataHandler");this._oOdataUtil=new O();this._oCollabModel=c;this._oExternalBObuffer={};},
_requestsData:{getGroups:{url:function(e){return"/ExternalObjects('"+q.sap.encodeURL(e)+"')/Groups";},urlParameters:function(){return{};},successLog:function(d,r){return"Groups were successfully retrieved.";},errorLog:function(e){this._oLogger.error("Failed to retrieve groups: "+e.response.statusText);}},getExternalObjectByExidAndObjectType:{url:function(e,o,n){return n?n:"/ExternalObjects_FindByExidAndObjectType";},urlParameters:function(e,o){return{"Exid":"'"+e.replace(/'/g,"''")+"'","ObjectType":"'"+o.replace(/'/g,"''")+"'","$expand":"FeedEntries/Creator"};},successLog:function(d,r){return"External object found: "+d.results.Name;},errorLog:function(e){this._oLogger.error(e.response.statusText);}},getFeedEntries:{url:function(e,n){return n?n:"/ExternalObjects"+"('"+q.sap.encodeURL(e)+"')/FeedEntries";},urlParameters:function(){return{"$expand":"Creator/MemberProfile"};},successLog:function(d,r){return"Feed entries were successfully retrieved.";},errorLog:function(e){this._oLogger.error("Failed to retrieve feed entries: "+e.response.statusText);}},getSuggestions:{url:function(){return"/Members_Autocomplete";},urlParameters:function(v,g){var u={"Query":"'"+v+"'","$top":"4"};if(g){u.GroupId="'"+g+"'";}return u;},successLog:function(d,r){return"";},errorLog:function(e){this._oLogger.error("");}},getAtMentions:{url:function(f){return"/FeedEntries('"+q.sap.encodeURL(f)+"')/AtMentions";},urlParameters:function(){return{};},successLog:function(d,r){return"@mentions were successfully retrieved.";},errorLog:function(e){this._oLogger.error("Failed to retrieve the @mentions: "+e.response.statusText,e.stack);}},getReplies:{url:function(f,n){return n?n:"/FeedEntries('"+q.sap.encodeURL(f)+"')/Replies";},urlParameters:function(){return{'$orderby':'CreatedAt desc','$expand':'Creator'};},successLog:function(d,r){return"Replies were successfully retrieved.";},errorLog:function(e){if(e.response){this._oLogger.error("Failed to retrieve replies: "+e.response.statusText,e.stack);}}}},
_doAllTheThings:function(r,u){var t=this;var a=this._requestsData[r];var b=Array.prototype.slice.apply(arguments);b.shift();b.shift();var d=new q.Deferred();var s=function(D,f){t._oLogger.info(a.successLog.apply(t,[D,f]));d.resolve(D,f);};var e=function(E){a.errorLog.apply(t,[E]);d.reject(E);};var c=a.urlParameters.apply(t,b);if(Object.prototype.toString.apply(u)==="[object Object]"){for(var U in u){c[U]=u[U];}}var p={context:null,urlParameters:c,async:true,filters:[],sorters:[],success:s,error:e};return{request:this._oCollabModel.read(a.url.apply(t,b),p),promise:d.promise()};},
getGroups:function(e,n,u){return this._doAllTheThings("getGroups",u,e,n);},
getExternalObjectByExidAndObjectType:function(e,n){var b=e.ObjectType+e.Exid;this._oExternalBObuffer[b]=e;return this._doAllTheThings("getExternalObjectByExidAndObjectType",null,e.Exid,e.ObjectType,n);},
getFeedEntries:function(e,n){return this._doAllTheThings("getFeedEntries",null,e,n);},
getSuggestions:function(v,g){return this._doAllTheThings("getSuggestions",null,v,g);},
getAtMentions:function(f){return this._doAllTheThings("getAtMentions",null,f);},
getReplies:function(f,n){return this._doAllTheThings("getReplies",null,f,n);},
getExternalObject:function(e){var t=this;var b=e.ObjectType+e.Exid;var p=q.Deferred();if(!this._oExternalBObuffer[b]){var c=this.postExternalObject(e);c.promise.done(function(d,r){var E=d.results;t._oExternalBObuffer[b]=E;p.resolve(E);});c.promise.fail(function(E){p.reject(E);});}else{p.resolve(this._oExternalBObuffer[b]);}return p.promise();},
getFeedEntryFromActivity:function(a){var t=this;var e="/Activities('"+q.sap.encodeURL(a)+"')/FeedEntry";var p=q.Deferred();var s=function(d,r){p.resolve(d,r);};var E=function(o){t._oLogger.error("Failed to get the feed entry: "+o.response.statusText);p.reject(o);};var P={urlParameters:{$expand:"Creator"},async:true,success:s,error:E};this._oCollabModel.read(e,P);return p.promise();},
getUserInfoBatch:function(u){var t=this;var b=[];u.forEach(function(U){var E="/Members_Autocomplete?Query='"+q.sap.encodeURL(U)+"'&$expand=MemberProfile";var m="GET";var d=null;var P=null;b.push(t._oCollabModel.createBatchOperation(E,m,d,P));});this._oCollabModel.addBatchReadOperations(b);var a=true;var i=true;var p=q.Deferred();var s=function(d,r){var R=t._oOdataUtil.parseBatchResponse(d.__batchResponses);p.resolve(R,r);};var e=function(E){if(E.response.statusCode===403&&i){t._oCollabModel.refreshSecurityToken(function(){i=false;t._oCollabModel.addBatchReadOperations(b);t._oCollabModel.submitBatch(s,e,a);},function(r){t._oLogger.error("Failed to get member information: "+r.response.statusText);p.reject(r);},true);}else{t._oLogger.error("Failed to get member information: "+E.response.statusText);p.reject(E);}};return{request:this._oCollabModel.submitBatch(s,e,a),promise:p.promise()};},
getAtMentionsBatch:function(f){var t=this;var m=10;var b=[];f.forEach(function(F,c){if(c<m){var E="/FeedEntries('"+q.sap.encodeURL(F)+"')/AtMentions";var M="GET";var d=null;var P=null;b.push(t._oCollabModel.createBatchOperation(E,M,d,P));}});this._oCollabModel.addBatchReadOperations(b);var a=true;var i=true;var p=new q.Deferred();var s=function(d,r){var R=t._oOdataUtil.parseBatchResponse(d.__batchResponses);p.resolve(R,r);};var e=function(E){if(E.response.statusCode===403&&i){t._oCollabModel.refreshSecurityToken(function(){i=false;t._oCollabModel.addBatchReadOperations(b);t._oCollabModel.submitBatch(s,e,a);},function(r){t._oLogger.error("Failed to get the feeds @mentions: "+r.response.statusText);p.reject(r);},true);}else{t._oLogger.error("Failed to get the feeds @mentions: "+E.response.statusText);p.reject(E);}};return{request:this._oCollabModel.submitBatch(s,e,a),promise:p};},
getSender:function(){var t=this;var e="/Self";var p=q.Deferred();var s=function(d,r){t._oLogger.info("The reply was successfully posted.");p.resolve(d.results);};var E=function(o){t._oLogger.error("Failed to retrieve the sender: "+o.response.statusText,o.stack);p.reject(o);};var P={urlParameters:null,async:true,success:s,error:E};return{request:this._oCollabModel.read(e,P),promise:p.promise()};},
getGroupFeedEntries:function(g,n){var t=this;var e="";if(n){e=n;}else{e="/Groups('"+q.sap.encodeURL(g)+"')/FeedEntries";}var p=q.Deferred();var s=function(d,r){t._oLogger.info("The feed entries for the group '"+g+"' were retrieved.");p.resolve(d,r);};var E=function(o){t._oLogger.error("Failed to get feed entries for the group '"+g+"'.");p.reject(o);};var P={context:null,urlParameters:{$expand:"Group,Creator,TargetObjectReference"},async:true,success:s,error:E};return{request:this._oCollabModel.read(e,P),promise:p.promise()};},
getGroupExternalObjectFeedEntries:function(g,e,n){var t=this;var E="";var p=q.Deferred();if(n){E=n;}else{E="/GroupExternalObjects(GroupId='"+q.sap.encodeURL(g)+"',ExternalObjectId='"+q.sap.encodeURL(e)+"')/FeedEntries";}var s=function(d,r){t._oLogger.info("The feed entries for the group object wall was retrieved. Group Id is:'"+g+"', External Object Id is:"+e+".");p.resolve(d,r);};var f=function(o){t._oLogger.error("Failed to get feed entries for the group object wall. Group Id is:'"+g+"', External Object Id is:"+e+".");p.reject(o);};var P={context:null,urlParameters:{$expand:"Group,Creator,TargetObjectReference"},async:true,success:s,error:f};return{request:this._oCollabModel.read(E,P),promise:p.promise()};},
addPostToExternalObject:function(c,e){var t=this;var p=this.postFeedEntryToObject(e,c).promise.then(function(d,r){var a=d.results;return t.getFeedEntryFromActivity(a.Id);}).then(function(d,r){var f=d.results;return f;}).fail(function(E){return E;});return p.promise();},
postExternalObject:function(e){var t=this;var E="/ExternalObjects";var d=e;var p=q.Deferred();var a=function(D,r){t._oLogger.info("External object created. "+D.results.Name);p.resolve(D,r);};var b=function(o){t._oLogger.error("Failed to create external object: "+o.response.statusText);p.reject(o);};var P={context:null,urlParameters:null,async:true,success:a,error:b};return{request:this._oCollabModel.create(E,d,P),promise:p.promise()};},
postFeedEntryToObject:function(e,c){var t=this;var E="/Activities";var o={};o.__metadata=e.__metadata;var d={"Content":c,"Object":o,"Verb":"comment"};var i=true;var p=q.Deferred();var s=function(D,r){p.resolve(D,r);};var f=function(a){if(a.response.statusCode===403&&i){t._oCollabModel.refreshSecurityToken(function(){i=false;t._oCollabModel.create(E,d,P);},function(r){t._oLogger.error("Failed to get the activity: "+r.response.statusText);p.reject(r);},true);}else{t._oLogger.error("Failed to get the activity: "+a.response.statusText);p.reject(a);}};var P={context:null,urlParameters:null,async:true,success:s,error:f};return{request:this._oCollabModel.create(E,d,P),promise:p.promise()};},
postReply:function(f,r){var t=this;var e="/FeedEntries('"+q.sap.encodeURL(f)+"')/Replies";var d={"Text":r};var i=true;var p=q.Deferred();var s=function(D,a){t._oLogger.info("The reply was successfully posted.");p.resolve(D);};var E=function(o){if(o.response.statusCode===403&&i){t._oCollabModel.refreshSecurityToken(function(){i=false;t._oCollabModel.create(e,d,P);},function(R){t._oLogger.error("Failed to post reply: "+R.response.statusText,R.stack);p.reject(R);},true);}else{t._oLogger.error("Failed to post reply: "+o.response.statusText,o.stack);p.reject(o);}};var P={context:null,urlParameters:null,async:true,success:s,error:E};return{request:this._oCollabModel.create(e,d,P),promise:p.promise()};},
postGroupFeedEntry:function(g,t){var a=this;var e="/Groups('"+q.sap.encodeURL(g)+"')/FeedEntries";var d={"Text":t};var p=q.Deferred();var s=function(D,r){a._oLogger.info("Feed entry was successfully posted to Group '"+g+"'.");p.resolve(D,r);};var E=function(o){a._oLogger.error("Failed to post feed entry to group '"+g+"'.");p.reject(o);};var P={context:null,urlParameters:null,async:true,success:s,error:E};return{request:this._oCollabModel.create(e,d,P),promise:p.promise()};},
postGroupExternalObjectFeedEntry:function(g,e,t){var a=this;var E="/GroupExternalObjects(GroupId='"+q.sap.encodeURL(g)+"',ExternalObjectId='"+q.sap.encodeURL(e)+"')/FeedEntries";var d={"Text":t};var p=q.Deferred();var s=function(D,r){a._oLogger.info("Feed entry was successfully posted to group object wall. Group Id is:'"+g+"', External Object Id is:"+e+".");p.resolve(D,r);};var f=function(o){a._oLogger.error("Failed to post feed entry to group object wall. Group Id is:'"+g+"', External Object Id is:"+e+".");p.reject(o);};var P={context:null,urlParameters:null,async:true,success:s,error:f};return{request:this._oCollabModel.create(E,d,P),promise:p.promise()};},
getFeedUpdatesLatestCount:function(L,E){var g=q.Deferred();var p="/ExternalObject_FeedLatestCount";var P={"urlParameters":{LatestTopLevelId:"'"+L+"'",Id:"'"+E+"'"},"success":function(d,r){g.resolve(d,r);},"error":function(e){g.reject(e);}};return g.promise(this._oCollabModel.read(p,P));}
});
return J;});
sap.ui.predefine('sap/collaboration/components/socialtimeline/datahandlers/SMIntegrationDataHandler',['sap/ui/base/Object','sap/collaboration/components/utils/OdataUtil','jquery.sap.global'],function(B,O,q){"use strict";
var S=B.extend("sap.collaboration.components.socialtimeline.datahandlers.SMIntegrationDataHandler",{
constructor:function(s){this._oLogger=q.sap.log.getLogger("sap.collaboration.components.socialtimeline.datahandlers.SMIntegrationDataHandler");this._oSMIntegrationModel=s;this._oOdataUtil=new O();this.oJamConfigurationStatusMap={configurationOk:0,configuartionError:1};},
mapInternalBOToExternalBO:function(i){var p=this.getExternalObjectMapping(i).promise.then(function(d){this._oLogger.info("External business object mapping was found.");return d.MapInternalBOToExternalBO;}.bind(this));return p.promise();},
getJamConfigurationStatus:function(c,C){var o="/GetJamConfigurationStatus";var t=this;var p={async:false,success:function(d,r){if(d.GetJamConfigurationStatus.StatusCode===t.oJamConfigurationStatusMap.configurationOk){c(true);}else{c(false);}},error:function(e){t._oLogger.error(JSON.stringify(e));C();}};this._oSMIntegrationModel.read(o,p);},
getExternalObjectMapping:function(i){var t=this;var e="/MapInternalBOToExternalBO";var p=q.Deferred();var u={};u["ApplicationContext"]="'"+i.appContext+"'";u["ODataCollection"]="'"+i.collection+"'";u["ODataKeyPredicate"]="'"+i.key+"'";u["ODataServicePath"]="'"+i.odataServicePath+"'";var s=function(d,r){t._oLogger.info("External object mapping found");p.resolve(d,r);};var E=function(o){t._oLogger.error(o.response.statusText);p.reject(o);};var P={context:null,urlParameters:u,async:true,filters:[],sorters:[],success:s,error:E};return{request:this._oSMIntegrationModel.read(e,P),promise:p.promise()};}
});
return S;});
sap.ui.predefine('sap/collaboration/components/socialtimeline/datahandlers/ServiceDataHandler',['sap/ui/base/Object','jquery.sap.global'],function(B,q){"use strict";
var S=B.extend("sap.collaboration.components.socialtimeline.datahandlers.ServiceDataHandler",{
constructor:function(b,t){this._oLogger=q.sap.log.getLogger("sap.collaboration.components.socialtimeline.datahandlers.ServiceDataHandler");this._oBOModel=b;this._oTimelineTermsUtility=t;},
readTimelineEntries:function(e,b,o,s,t){var a=this;var p=q.Deferred();var E=this._buildTimelineEntriesEndpoint(e,b,o,s,t);var P={context:null,urlParameters:null,async:true,filters:[],sorters:[],success:function(d,r){p.resolve(d);},error:function(c){if(c.response&&c.response.statusCode){a._oLogger.error(c.body);p.reject(c);}}};return{request:this._oBOModel.read(E,P),promise:p.promise()};},
_buildTimelineEntriesEndpoint:function(e,b,o,s,t){var a="/"+e+"("+q.sap.encodeURL(b)+")"+"/"+this._oTimelineTermsUtility.getTimelineEntryNavigationPath(e)+"?$expand="+this._oTimelineTermsUtility.getTimelineEntryFields(e).TimelineDetailNavigationPath;if(s!=undefined){a+="&$skip="+s;}if(t!=undefined){a+="&$top="+t;}if(o!=undefined){a+="&$filter="+o;}this._oLogger.info("Timeline Entries Endpoint: "+a);return a;}
});
return S;});
sap.ui.predefine('sap/collaboration/components/socialtimeline/datahandlers/TimelineDataHandler',['sap/ui/base/Object','jquery.sap.global','sap/collaboration/components/socialtimeline/filter/FilterType'],function(B,q,F){"use strict";
var T=B.extend("sap.collaboration.components.socialtimeline.datahandlers.TimelineDataHandler",{
constructor:function(b,j,s,S,t,p,a,c){this._oLogger=q.sap.log.getLogger("sap.collaboration.components.socialtimeline.datahandlers.TimelineDataHandler");this._oFilterConstants=new F();this._oBusinessObjectMap=b;this._oJamDataHandler=j;this._oServiceDataHandler=S;this._oTimelineTermsUtility=t;this._oSMIntegrationDataHandler=s;this._bSocialFeaturesEnabled=a;this._bBackendFeaturesEnabled=c;this._iPageSize=p;this._iPageSize=p;this._iTimelineEntriesPageSize=p;this._iTimelineEntriesSkip=0;this._iFeedEntriesPageSize=p*2;this._sBusinessObjectKey="";this._sFeedEntriesNextLink="";this._fCustomActionCallBack=b.customActionCallback;this._aTimelineEntries=[];this._aFeedEntries=[];this._oExternalBO={};this._oMemberDataBuffer={};this._oExternalBOMapping={};},
setBusinessObject:function(o){this._setBusinessObjectValues(o);this._resetBusinessObjectData();this.getExternalBOMapping();},
reset:function(){this._iTimelineEntriesSkip=0;this._iTimelineEntriesPageSize=this._iPageSize;this._sFeedEntriesNextLink="";this._aTimelineEntries=[];this._aFeedEntries=[];},
getTimelineData:function(f,b){var p=q.Deferred();var t=this;if(f.type===this._oFilterConstants.FILTER_TYPE.feedUpdates){if(b){this._setBusinessObjectValues(b);this._resetBusinessObjectData();p=this.getExternalBOMapping().then(function(){return t._getExternalObjectJamOnlyFeedEntries();});}else{p=this._getExternalObjectFeedEntries();}}else if(f.type===this._oFilterConstants.FILTER_TYPE.systemUpdates||f.type===this._oFilterConstants.FILTER_TYPE.custom){p=this._getTimelineEntries(f);}else{this._oLogger.error("The filter type is invalid.");p.resolve([]);}return p.promise();},
getExternalBOMapping:function(){var i={"appContext":this._oBusinessObjectMap.applicationContext,"collection":this._oBusinessObjectMap.collection,"name":this._sBusinessObjectName,"key":this._sBusinessObjectKey,"odataServicePath":this._oBusinessObjectMap.servicePath};var p=this._oSMIntegrationDataHandler.mapInternalBOToExternalBO(i).then(function(e){this._oExternalBOMapping=e;this._oExternalBOMapping.Name=this._sBusinessObjectName;}.bind(this));return p.promise();},
_setBusinessObjectValues:function(b){this._sBusinessObjectKey=b.key;this._sBusinessObjectName=b.name;},
_resetBusinessObjectData:function(){this.reset();if(this._oTimelineEntriesReadRequest){this._oTimelineEntriesReadRequest.abort();}if(this._oFeedEntriesReadRequest){this._oFeedEntriesReadRequest.abort();}},
_getExternalObjectFeedEntries:function(){var t=this;var p=this._oJamDataHandler.getExternalObject(this._oExternalBOMapping).then(function(e){t._oExternalBO=e;if(t._sFeedEntriesNextLink==undefined){var g=q.Deferred();g.resolve({"results":[]},null);return{request:null,promise:g};}else if(t._sFeedEntriesNextLink==""){return t._oJamDataHandler.getFeedEntries(e.Id);}else{return t._oJamDataHandler.getFeedEntries(null,t._sFeedEntriesNextLink);}}).then(function(g){t._oFeedEntriesReadRequest=g.request;return g.promise;}).then(function(f){t._sFeedEntriesNextLink=f.__next;return f.results;}).then(function(f){return t._mapFeedEntriesToTimelineItems(f);});return p.promise();},
_getExternalObjectJamOnlyFeedEntries:function(){var g=function(){var p=q.Deferred();if(this._sFeedEntriesNextLink===undefined){var a=q.Deferred();a.resolve({"results":[]},null);p={request:null,promise:a};}else if(this._sFeedEntriesNextLink===""){p=this._oJamDataHandler.getExternalObjectByExidAndObjectType(this._oExternalBOMapping);}else{p=this._oJamDataHandler.getExternalObjectByExidAndObjectType(null,this._sFeedEntriesNextLink);}return p.promise;}.bind(this);var p=g().then(function(e){this._oExternalBO=e.results;var f=e.results.FeedEntries;this._sFeedEntriesNextLink=f.__next;return this._mapFeedEntriesToTimelineItems(f.results);}.bind(this));return p.promise();},
_getTimelineEntries:function(f){var t=this;var b=f.type;if(b!==this._oFilterConstants.FILTER_TYPE.custom){b=undefined;}else{b=f.value;}var r=this._oServiceDataHandler.readTimelineEntries(this._oBusinessObjectMap.collection,this._sBusinessObjectKey,b,this._iTimelineEntriesSkip,this._iTimelineEntriesPageSize);this._oTimelineEntriesReadRequest=r.request;var g=r.promise.then(function(a){var c=a.results;t._iTimelineEntriesPageSize=c.length;t._iTimelineEntriesSkip+=t._iTimelineEntriesPageSize;return t._mapTimelineEntriesToTimelineItems(c);}).then(function(a){if(t._bSocialFeaturesEnabled===true){return t._fillPicturesForTimelineItems(a);}return a;});return g.promise();},
_fillPicturesForTimelineItems:function(t){var a=this;var p=q.Deferred();var e=[];t.forEach(function(o){if(!o.timelineItemData.userPicture){e.push(o.timelineItemData.userEmail);}});var u=e.filter(function(b,i){return e.indexOf(b)==i;});if(u.length>0){var g=this._oJamDataHandler.getUserInfoBatch(u);g.promise.done(function(U){var b=q.grep(U,function(o){return o.results.length>0;});b.forEach(function(o){a.addUserInfoToBuffer(o.results[0]);});t.forEach(function(o){if(!o.timelineItemData.userPicture){o.timelineItemData.userPicture=a.getUserPicture(o.timelineItemData.userEmail);}});p.resolve(t);});g.promise.fail(function(E){p.resolve(t);});}else{p.resolve(t);}return p.promise();},
_getAtMentions:function(f){var a={};var g=this._oJamDataHandler.getAtMentions(f.Id);g.promise.done(function(j,r){var J=j.results;for(var i=0;i<J.length;i++){if(J[i]){a[i]=J[i];}}});g.promise.fail(function(){this._oLogger.error('Failed to get the @mentions.');});return a;},
_mapFeedEntriesToTimelineItems:function(f){var t=this;var o=[];f.forEach(function(a){var b={};b.timelineItemData=t._mapFeedEntryToTimelineItem(a);b._feedEntryData=a;if(a.ConsolidatedCount>1){b._feedEntryData._consolidatedUrl="<collaboration_host_url>"+a.Id;}o.push(b);});return o;},
_mapFeedEntryToTimelineItem:function(f){var P="sap-icon://post";if(!this.getUserInfoFromBuffer(f.Creator.Email)){this.addUserInfoToBuffer(f.Creator);}var t={feedId:f.Id,dateTime:f.CreatedAt,userName:f.Creator.FullName,userEmail:f.Creator.Email,title:f.Action,text:f.Text,textWithPlaceholders:f.TextWithPlaceholders,replyCount:f.RepliesCount,icon:P};t.userPicture=this.getUserPicture(t.userEmail);return t;},
_mapTimelineEntriesToTimelineItems:function(t){var a=this;var o=[];t.forEach(function(b){var c={};c.timelineItemData=a._mapTimelineEntryToTimelineItem(b);var C=undefined;if(a._fCustomActionCallBack){C=a._fCustomActionCallBack(b);if(C){var d=true;if(!q.isArray(C)){a._oLogger.error("The type defined for the return statement of the function 'customActionCallback' is "+typeof(C)+", expected type is array. Custom actions have been removed.");d=false;}else{for(var i=0;i<C.length;i++){if(typeof(C[i])!=='object'){a._oLogger.error("The function 'customActionCallback' returned the item "+JSON.stringify(C[i])+" of type "+typeof(C[i])+", expected type is object. Custom actions have been removed.");d=false;break;}else if(!C[i].key||!C[i].value){a._oLogger.error("The function 'customActionCallback' returned the item "+JSON.stringify(C[i])+" with the property 'key' or 'value' as undefined. Custom actions have been removed.");d=false;break;}else if(typeof(C[i].value)!=='string'){a._oLogger.error("The function 'customActionCallback' returned the item "+JSON.stringify(C[i])+" with the property 'value' as type "+typeof(C[i].value)+", expected type is string. Custom actions have been removed.");d=false;break;}}}if(d){C.oDataEntry=b;c.timelineItemData.customActionData=C;}}}o.push(c);});return o;},
_mapTimelineEntryToTimelineItem:function(t){var o=this._oTimelineTermsUtility.getTimelineEntryFields(this._oBusinessObjectMap.collection);var a={dateTime:t[o.TimeStamp],userName:t[o.ActorName],userEmail:t[o.ActorExtID].toLowerCase(),title:t[o.ActionText],text:t[o.SummaryText],icon:t[o.Icon],timelineEntryDetails:this._processTimelineEntryDetails(t[o.TimelineDetailNavigationPath].results,this._oBusinessObjectMap.collection)};a.userPicture=this.getUserPicture(a.userEmail);return a;},
_processTimelineEntryDetails:function(t,e){var a=this;var b=[];var o=a._oTimelineTermsUtility.getTimelineEntryDetailFields(e);t.forEach(function(c){var d={};d.afterValue=c[o.AfterValue];d.beforeValue=c[o.BeforeValue];d.changeType=c[o.ChangeType];d.propertyLabel=c[o.PropertyLabel];b.push(d);});return b;},
getUserPicture:function(u){var m=this.getUserInfoFromBuffer(u);if(!m){return"";}return m.picture;},
buildImageUrl:function(o){return this._oJamDataHandler._oCollabModel.sServiceUrl+"/"+o.__metadata.uri+"/ThumbnailImage/$value";},
addUserInfoToBuffer:function(m){var u=this.buildImageUrl(m);var U=m.Email.toLowerCase();this._oMemberDataBuffer[U]={"email":U,"fullname":m.FullName,"id":m.Id,"address":m.MemberProfile.Address,"title":m.Title,"role":m.Role,"picture":u};},
getUserInfoFromBuffer:function(u){var U=u.toLowerCase();return this._oMemberDataBuffer[U];},
getCurrentExternalBO:function(){return this._oExternalBO;}
});
return T;});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2015 SAP AG. All rights reserved
 */
sap.ui.predefine('sap/collaboration/components/socialtimeline/filter/FilterType',['sap/ui/base/Object'],function(B){"use strict";
var F=B.extend("sap.collaboration.components.socialtimeline.filter.FilterType",{
constructor:function(){if(Object.freeze){Object.freeze(this);}},
FILTER_TYPE:{feedUpdates:"FeedUpdates",systemUpdates:"SystemUpdates",custom:"Custom"}
});
return F;});
sap.ui.predefine('sap/collaboration/components/socialtimeline/validation/InputValidator',['sap/collaboration/library','sap/ui/base/Object','jquery.sap.global','sap/collaboration/components/socialtimeline/annotations/TimelineTermsUtility'],function(l,B,q,T){"use strict";
var I=B.extend("sap.collaboration.components.socialtimeline.validation.InputValidator",{
constructor:function(s){this._oLogger=q.sap.log.getLogger("sap.collaboration.components.socialtimeline.validation.InputValidator");this._bCustomFilterValid=true;this._bSocialFeaturesEnabled=true;this._bBackendFeaturesEnabled=true;this._oSocialTimeline=s;},
areCustomFiltersValid:function(){return this._bCustomFilterValid;},
areSocialFeaturesEnabled:function(){return this._bSocialFeaturesEnabled;},
areBackendFeaturesEnabled:function(){return this._bBackendFeaturesEnabled;},
isBusinessObjectMapValid:function(b){var i=true;if(typeof(b)!=='object'){this._oLogger.error("The argument passed to the function 'setBusinessObjectMap' is of type "+typeof(b)+", expected type is object.");i=false;}else if(!b.collection||!b.applicationContext||!b.servicePath){this._oLogger.error("The object passed to the method setBusinessObjectMap has property 'collection', 'applicationContext', or 'servicePath' as undefined.");i=false;}else if(typeof(b.collection)!=='string'||typeof(b.applicationContext)!=='string'||typeof(b.servicePath)!=='string'){this._oLogger.error("The property 'collection', 'applicationContext', or 'servicePath' in the object passed to the method setBusinessObjectMap is not a string.");i=false;}else if(b.customActionCallback&&typeof(b.customActionCallback)!=='function'){this._oLogger.error("The type defined for the property 'customActionCallback' is "+typeof(b.customActionCallback)+", expected type is function.");i=false;}return i;},
isBusinessObjectValid:function(b){var i=true;if(!b.key){this._oLogger.error("The key in the object passed to the function 'setBusinessObject' is undefined.");i=false;}else if(typeof(b.key)!=='string'){this._oLogger.error("The key in the object passed to the function 'setBusinessObject' is not of type string.");i=false;}if(!b.name){this._oLogger.error("The name in the object passed to the function 'setBusinessObject' is undefined.");i=false;}else if(typeof(b.name)!=='string'){this._oLogger.error("The name in the object passed to the function 'setBusinessObject' is not of type string.");i=false;}return i;},
createTermsUtilityForBackend:function(s){var t;try{t=new T(s.getServiceMetadata(),s.getServiceAnnotations());this._bBackendFeaturesEnabled=true;}catch(e){t=undefined;this._bBackendFeaturesEnabled=false;this._oLogger.error("The Business Object Service is not configured properly.");this._oSocialTimeline._oCommonUtil.displayError();}return t;},
validateEnableSocial:function(){if(this._oSocialTimeline.getEnableSocial()===true){return this._bSocialFeaturesEnabled=this._checkJamConfiguration();}else{return this._bSocialFeaturesEnabled=false;}},
validateCustomFilter:function(){var c=this._oSocialTimeline.getCustomFilter();this._bCustomFilterValid=true;if(!q.isEmptyObject(c)){if(!q.isArray(c)){this._oLogger.error("The type defined for the property 'customFilter' is "+typeof(c)+", expected type is array.");this._bCustomFilterValid=false;}else{for(var i=0;i<c.length;i++){if(!c[i].value||!c[i].text||typeof(c[i].value)!=="string"||typeof(c[i].text)!=="string"){this._oLogger.error("The type defined for the property 'text' or 'value' for the filter "+JSON.stringify(c[i])+" is undefined or not of type 'string'.");this._bCustomFilterValid=false;}}}}return this._bCustomFilterValid;},
_checkJamConfiguration:function(){var s=true;var t=this;var S=function(c){if(c===false){s=false;}};var e=function(E){t._oSocialTimeline._oCommonUtil.displayError();};this._oSocialTimeline._oSMIntegrationDataHandler.getJamConfigurationStatus(S,e);return s;},
});
return I;});
sap.ui.require.preload({
	"sap/collaboration/components/feed/fragments/CustomListItem.fragment.xml":'<core:FragmentDefinition xmlns="sap.m" xmlns:core="sap.ui.core"><CustomListItem><content><Label text="{Name}" width="20em" class="sapUiTinyMarginBeginEnd sapUiTinyMarginTopBottom"/></content></CustomListItem></core:FragmentDefinition>',
	"sap/collaboration/components/feed/fragments/GroupSelector.fragment.xml":'<core:FragmentDefinition xmlns="sap.m" xmlns:core="sap.ui.core"><ResponsivePopover id="responsivePopover" placement="Vertical" contentWidth="20em" title="{i18n&gt;ST_GROUP_SELECT_HEADER}"><content><SearchField liveChange=".onGroupSearch" width="100%"/><List id="list" mode="SingleSelectMaster" noDataText="{i18n&gt;GRP_NO_GROUPS_FOUND_TEXT}" growing="true" growingThreshold="5" growingScrollToLoad="false" selectionChange=".onGroupSelected"/></content></ResponsivePopover></core:FragmentDefinition>',
	"sap/collaboration/components/feed/views/GroupFeed.view.xml":'<mvc:View xmlns:core="sap.ui.core" xmlns:mvc="sap.ui.core.mvc" xmlns:m="sap.m" xmlns:commons="sap.suite.ui.commons" xmlns:collaboration="sap.collaboration" controllerName="sap.collaboration.components.feed.views.GroupFeed" xmlns:html="http://www.w3.org/1999/xhtml"><commons:Timeline id="timeline" enableSocial="{/enableSocial}" axisOrientation="{/axisOrientation}" enableScroll="{/enableScroll}" forceGrowing="{/forceGrowing}" growingThreshold="{/growingThreshold}" sort="false" grow=".onGrow"/></mvc:View>',
	"sap/collaboration/manifest.json":'{"_version":"1.21.0","sap.app":{"id":"sap.collaboration","type":"library","embeds":[],"applicationVersion":{"version":"1.88.0"},"title":"SAP UI library: SAP Collaboration for Social Media Integration.","description":"SAP UI library: SAP Collaboration for Social Media Integration.","ach":"CA-UI5-BS-SM","resources":"resources.json","offline":true},"sap.ui":{"technology":"UI5","supportedThemes":["base","sap_belize","sap_belize_hcb","sap_belize_hcw","sap_belize_plus","sap_bluecrystal","sap_fiori_3","sap_fiori_3_dark","sap_fiori_3_hcb","sap_fiori_3_hcw"]},"sap.ui5":{"dependencies":{"minUI5Version":"1.88","libs":{"sap.ui.core":{"minVersion":"1.88.0"},"sap.suite.ui.commons":{"minVersion":"1.88.0"}}},"library":{"i18n":false,"content":{"controls":[],"elements":[],"types":["sap.collaboration.AppType","sap.collaboration.DisplayFeedType","sap.collaboration.FeedType"],"interfaces":[]}}}}'
},"sap/collaboration/library-preload"
);
//# sourceMappingURL=library-preload.js.map