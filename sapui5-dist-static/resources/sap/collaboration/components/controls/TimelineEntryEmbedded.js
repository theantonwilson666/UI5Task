/*
* ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
*/
sap.ui.define(['jquery.sap.global','sap/ui/core/Control','sap/collaboration/components/utils/LanguageBundle','sap/m/Text','sap/m/Link','sap/m/List','sap/m/FeedListItem','sap/m/Popover','sap/m/library'],function(q,C,L,T,a,b,F,P,m){"use strict";var c=m.PlacementType;var d=C.extend("sap.collaboration.components.controls.TimelineEntryEmbedded",{metadata:{interfaces:[],library:"sap.m",properties:{"timelineEntry":{type:"object",group:"data"}},events:{},aggregations:{}}});d.prototype.init=function(){this._oLangBundle=new L();q.sap.includeStyleSheet(q.sap.getModulePath("sap.collaboration.components.resources.css.EmbeddedControl",".css"));this._aTimelineItemTextDisplay;};d.prototype.onBeforeRendering=function(){if(!this._aTimelineItemTextDisplay){this._createTimelineItemText();}};d.prototype.exit=function(){if(this._aTimelineItemTextDisplay){this._aTimelineItemTextDisplay.forEach(function(o){o.destroy();});}if(this._oPopover){this._oPopover.destroy();}};d.prototype._getTimelineItemTextControls=function(){return this._aTimelineItemTextDisplay;};d.prototype._createTimelineItemText=function(){var t=this.getTimelineEntry();this._aTimelineItemTextDisplay=[];if(t.timelineEntryDetails!=undefined&&t.timelineEntryDetails.length>0){var f=this._parseTimelineEntryDetail(t.timelineEntryDetails[0]);this._aTimelineItemTextDisplay.push(new T({text:f+" "}).addStyleClass("alignMiddle"));if(t.timelineEntryDetails.length>1){var l=this._createTLEntryDetailsLink(t.timelineEntryDetails).addStyleClass("alignMiddle");this._aTimelineItemTextDisplay.push(l);}}else{this._aTimelineItemTextDisplay.push(new T({text:t.text}).addStyleClass("alignMiddle"));}};d.prototype._renderTimelineItemText=function(r){var s="&nbsp;";if(this._aTimelineItemTextDisplay.length>0){r.write("<div");r.writeControlData(this);r.write(">");for(var i=0;i<this._aTimelineItemTextDisplay.length;i++){var e=this._aTimelineItemTextDisplay[i].getMetadata().getName();switch(e){case"sap.m.Text":var t=this._aTimelineItemTextDisplay[i].getText();if(t.search(/\s/)==0){var f=t.search(/\S/);do{r.write(s);f--;}while(f>0);}r.renderControl(this._aTimelineItemTextDisplay[i]);if(t[t.length-1]==" "){var g=t.length-1;var h=t[g];do{r.write(s);h=t[--g];}while(h==" "&&h!=undefined);}break;case"sap.m.Link":case"sap.ui.core.HTML":default:r.renderControl(this._aTimelineItemTextDisplay[i]);}}r.write("</div>");}};d.prototype._createTLEntryDetailsLink=function(t){var e=this;var A=t.length-1;var l=this._oLangBundle.getText("TE_LINK_TEXT",A);var o=new a(this.getId()+"_PopoverLink",{text:l});o.attachPress(function(){if(!e._oPopover){e._oPopover=e._createTLEntryDetailsPopover(t);}e._oPopover.openBy(o);});return o;};d.prototype._createTLEntryDetailsPopover=function(t){var o=new b(this.getId()+"_ChangeList",{inset:false});for(var e in t){var E=this._parseTimelineEntryDetail(t[e]);var l=new F({text:E,showIcon:false});o.addItem(l);}var S="20em";var p=new P(this.getId()+"_Popover",{contentWidth:S,placement:c.Auto,title:this._oLangBundle.getText("TE_DETAILS_POPOVER_HEADER")+"("+t.length+")",content:[o]});return p;};d.prototype._parseTimelineEntryDetail=function(D){var t="";switch(D.changeType){case"U":t=this._oLangBundle.getText("TE_DETAILS_CHANGED",[D.propertyLabel,D.beforeValue,D.afterValue]);break;case"I":t=this._oLangBundle.getText("TE_DETAILS_SET",[D.propertyLabel,D.afterValue]);break;case"D":t=this._oLangBundle.getText("TE_DETAILS_CLEARED",[D.propertyLabel,D.beforeValue]);break;}return t;};return d;});
