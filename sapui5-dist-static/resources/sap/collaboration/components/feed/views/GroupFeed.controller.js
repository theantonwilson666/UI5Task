/*
* ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
*/
sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/Controller","sap/suite/ui/commons/TimelineItem","sap/m/MessageBox","sap/collaboration/components/utils/LanguageBundle","sap/collaboration/components/utils/DateUtil","sap/collaboration/components/controls/FeedEntryEmbedded","sap/collaboration/components/controls/ReplyPopover","sap/collaboration/components/controls/SocialTextArea","sap/collaboration/components/controls/FilterPopover","sap/collaboration/components/utils/CommonUtil","sap/collaboration/components/feed/ModeFactory","sap/ui/model/json/JSONModel","sap/m/ToolbarSpacer","sap/m/Button","sap/m/library","sap/ui/core/Fragment","sap/m/ResponsivePopover","sap/ui/Device","sap/ui/core/CustomData","sap/m/Link","sap/ui/core/library","sap/m/List","sap/m/CustomListItem","sap/collaboration/library"],function(q,C,T,M,L,D,F,R,S,a,b,c,J,d,B,m,e,f,g,h,j,k,l,n,o){"use strict";var p=o.FeedType;var r=k.MessageType;var P=m.PlacementType;var s=m.ButtonType;var t="sap.collaboration.components.feed.views.GroupFeed";var G=C.extend(t,{onInit:function(){this._initializeUtilities();this._initializeRequestStateData();this._initializeSystemData();this._initializeModels();this._initializeTimeline();},onBeforeRendering:function(){if(!this._oMode.isJamServiceAvailable()){this.displayErrorMessage();}},onAfterRendering:function(){},onExit:function(){this._abortAllPendingRequests();this.byId("filter_popover").destroy();this.byId("addPost_popover").destroy();this._stopAutoCheckingForNewUpdates();},_initializeUtilities:function(){this._oCommonUtil=new b();this._oLogger=new q.sap.log.getLogger(t);this._oLanguageBundle=new L();this._oDateUtil=new D();},_initializeSystemData:function(){this._oModes={};this._mCurrentUser;},_initializeRequestStateData:function(){this._oNextLinks={"feedEntriesNextLink":"","repliesNextLink":""};this._oPendingRequests={"loadingFeedEntriesRequest":undefined,"loadingRepliesRequest":undefined,"loadingSuggestionsRequest":undefined,"loadingFeedAtMentions":undefined,"refreshingSecurityToken":undefined};this._oPostRequestData={"path":undefined,"payload":undefined,"parameters":undefined};},_initializeModels:function(){var i=this._oLanguageBundle.createResourceModel();this.getView().setModel(i,"i18n");this._i18nModel=i;var v=new J();v.setData({"feedSources":undefined,"axisOrientation":undefined,"enableSocial":true,"enableScroll":undefined,"forceGrowing":false,"growingThreshold":20,"groupSelectorEnabled":false,"groupSelected":{},"groups":[],"filterEnabled":false,"filter":[],"filterMessage":"","feedEndpoint":undefined,"addPostButtonEnabled":false,});v.bindProperty("/feedSources").attachChange(this._onFeedSourcesChange,this);v.bindProperty("/feedEndpoint").attachChange(this._onFeedEndpointChange,this);v.bindProperty("/filterMessage").attachChange(this._onFilterMessageChange,this);this.getView().setModel(v);this._oViewDataModel=v;},_initializeTimeline:function(){var i=this.byId("timeline");i.setContent([]);this._modifyHeaderBar();this._createSocialProfile();},_modifyHeaderBar:function(){var H=this.byId("timeline").getHeaderBar();H.removeAllContent();var i=this._createGroupSelector();H.insertContent(i,0);var u=new d(this.createId("header_spacer"));H.insertContent(u,1);var v=this._createFilterButton();H.insertContent(v,2);var A=this._createAddPostButton();H.insertContent(A,3);},_createGroupSelector:function(){var i=new B(this.createId("groupSelect_button"),{icon:"sap-icon://slim-arrow-down",iconFirst:false,text:"{/groupSelected/Name}",width:"20em",enabled:"{/groupSelectorEnabled}",type:s.Transparent,press:[this.onGroupSelectorButtonPress,this]});i.setModel(this._oViewDataModel);return i;},_createFilterButton:function(){if(!this.byId("filter_popover")){var i=sap.ui.xmlfragment("sap.collaboration.components.feed.fragments.CustomListItem",this);new a(this.createId("filter_popover"),{title:this._oLanguageBundle.getText("ST_FILTER_HEADER"),}).setModel(this._oViewDataModel).bindItems("/filter",i);}var u=new B(this.createId("filter_button"),{enabled:"{/filterEnabled}",visible:"{/filterEnabled}",icon:"sap-icon://filter",type:s.Transparent,press:[function(){this.byId("filter_popover").openBy(this.byId("filter_button"));},this]}).setModel(this._oViewDataModel);return u;},_createAddPostButton:function(){if(this.byId("addPost_popover")===undefined){new f(this.createId("addPost_popover"),{placement:P.Auto,title:this._oLanguageBundle.getText("ST_ADD_POST_TITLE"),contentWidth:"25rem",contentHeight:"10rem",content:new S(this.createId("social_TextArea"),{height:"10rem",width:"100%",liveChange:[function(E){E.getParameter("value").trim()!==""?this.byId("addPost_postButton").setEnabled(true):this.byId("addPost_postButton").setEnabled(false);},this],suggest:[this.onSuggest,this],afterSuggestionClose:[function(){this._oPendingRequests.loadingSuggestionsRequest&&this._oPendingRequests.loadingSuggestionsRequest.abort();},this]}),endButton:new B(this.createId("addPost_postButton"),{text:this._oLanguageBundle.getText("ST_ADD_POST_BUTTON"),enabled:false,press:[this.onAddPost,this],}),}).setInitialFocus(this.byId("social_TextArea"));if(!g.system.phone){this.byId("addPost_popover").setBeginButton(new B(this.createId("addPost_atMentionButton"),{text:"@",press:[function(){this.byId("social_TextArea").atMentionsButtonPressed();},this]}));}}var A=new B(this.createId("addPost_button"),{enabled:"{/addPostButtonEnabled}",icon:"sap-icon://add",type:s.Transparent,press:[function(){this.byId("addPost_popover").openBy(this.byId("addPost_button"));},this]});A.setModel(this._oViewDataModel);return A;},_clearTimeline:function(){var i=this.byId("timeline");i.destroyContent();},_createTimelineItem:function(i){var u=new J(i);var v=new F(this.createId(i.Id+"_embedded"),{"feedEntry":"{/}","serviceUrl":this._oMode.getJamServiceUrl(),"expandCollapseClick":[function(){this.byId("timeline").adjustUI();},this],"atMentionClick":[this.onAtMentionClicked,this],"previewLoad":[function(z){this.byId('timeline').adjustUI();},this]});var w=new R(this.createId("replyPostPopover_"+i.Id),{socialTextArea:new S({height:"80px",width:"100%",suggestionPlacement:P.Top,suggest:[this.onSuggest,this],afterSuggestionClose:[function(){this._oPendingRequests.loadingSuggestionsRequest&&this._oPendingRequests.loadingSuggestionsRequest.abort();},this]}),postReplyPress:[this.onPostReplyPress,this],moreRepliesPress:[function(E){var y=E.getSource().getParent();this._getReplies(undefined,y.getModel().getData().Replies.__next,y);},this],afterClose:[function(){if(this._oPendingRequests.loadingRepliesRequest){this._oPendingRequests.loadingRepliesRequest.abort();}this._bReplyPopoverIsOpen=false;},this]});w.getSocialTextArea().attachLiveChange(function(E){E.getParameter("value").trim()!==""?this.enableButton(true):this.enableButton(false);}.bind(w));var x=new h({key:"1",value:this._oLanguageBundle.getText("ST_MORE_CUSTOM_ACTION")});var y=new T(this.createId(i.Id),{"dateTime":"{/CreatedAt}","userName":"{/Creator/FullName}","title":"{/Action}","text":"{/Text}","icon":"sap-icon://post","userNameClickable":this._oViewDataModel.getProperty("/enableSocial"),"userNameClicked":[this.onUserNameClicked,this],"userPicture":{path:"/Creator/Id",formatter:this._buildThumbnailImageURL.bind(this)},"replyCount":"{/RepliesCount}","embeddedControl":v,"customReply":w,"replyListOpen":[this.onReplyListOpen,this],"customAction":x,"customActionClicked":[this.onMoreClicked,this]});y.setModel(u);y.setTitle("\u200E"+y.getTitle()+"\u200E");return y;},_addFeedEntriesToTimeline:function(i){var u=this.byId("timeline");i.forEach(function(v){var w=this._createTimelineItem(v);u.addContent(w);},this);},_processFeedEntries:function(i){if(i.length>0){this._addFeedEntriesToTimeline(i);}else{this._oViewDataModel.setProperty("/forceGrowing",false);}this._setTimelineToNotBusy();},_processAtMentions:function(){if(this._oPendingRequests.loadingFeedAtMentions&&this._oPendingRequests.loadingFeedAtMentions.state("pending")){this._oPendingRequests.loadingFeedAtMentions.abort();}var i=this;var u;var v={"async":true,"success":function(x,y){w.resolveWith(i,[x,y]);},"error":function(E){i._oLogger.error('Failed to retrieve the @mentions.');w.rejectWith(i,[E]);}};if(this._oAtMention.atMentionsNextLink){u="/"+this._oAtMention.atMentionsNextLink;v.urlParameters=this._extractUrlParams(decodeURIComponent(this._oAtMention.atMentionsNextLink));}else{u="/FeedEntries("+q.sap.encodeURL("'"+this._oAtMention.feedId+"'")+")/AtMentions";}var w=q.Deferred();w.done(function(x,y){i._oAtMention.atMentionsNextLink=x.__next;i._oAtMention.aAtMentions=i._oCommonUtil.getODataResult(x).concat(i._oAtMention.aAtMentions);if(i._oAtMention.atMentionsNextLink){i._processAtMentions();}else{var z={openingControl:i._oAtMention.oUserNameLink,memberId:i._oAtMention.aAtMentions[i._oAtMention.placeholderIndex].Email};i._oSocialProfile.setSettings(z);i._oSocialProfile.open();}});this._oPendingRequests.loadingFeedAtMentions=w.promise(this._oJamModel.read(u,v));},_createSocialProfile:function(){this._oSocialProfile=new sap.ui.getCore().createComponent("sap.collaboration.components.socialprofile");return this._oSocialProfile;},_setTimelineToBusy:function(){var i=this.byId("timeline");i.setBusyIndicatorDelay(0).setBusy(true);},_setTimelineToNotBusy:function(){var i=this.byId("timeline");i.setBusyIndicatorDelay(0).setBusy(false);},_showFeedUpdatesInTimeline:function(i){var u=this.byId("timeline");var v=u.getMessageStrip();if(i>0){if(!this.byId("refreshLink")){var w=new j(this.createId("refreshLink"),{text:this._oLanguageBundle.getText("GF_REFRESH_FEED"),press:[function(){var x=this._oViewDataModel.getProperty("/feedEndpoint");this._initialLoadFeedEntries(x);},this]});v.setLink(w);v.setType(r.Information);v.setShowIcon(true);}i==1?u.setCustomMessage(this._oLanguageBundle.getText("GF_NEW_FEED_UPDATE")):u.setCustomMessage(this._oLanguageBundle.getText("GF_NEW_FEED_UPDATES",i));v.setVisible(true);u.rerender();}},_hideFeedUpdatesInTimeline:function(){var i=this.byId("timeline").getMessageStrip();i.close();},onGrow:function(E){if(!this._oPendingRequests.loadingFeedEntriesRequest||!this._oPendingRequests.loadingFeedEntriesRequest.state()!="pending"){var i=this._oViewDataModel.getProperty("/feedEndpoint");this._loadFeedEntries(i).done(this._loadFeedEntriesSuccess.bind(this));}},onGroupSelectorButtonPress:function(E){this._oMode.displayFeedSourceSelectorPopover(E.getSource());},onAddPost:function(i){this.byId("addPost_popover").close();var u=this.byId("social_TextArea").convertTextWithFullNamesToEmailAliases();if(u&&u.trim()!==""){this._getLoggedInUser().done(function(){this._setTimelineToBusy();var v=function(y,z){this.byId("social_TextArea").clearText();this.byId("addPost_postButton").setEnabled(false);this._setTimelineToNotBusy();var E=this._oCommonUtil.getODataResult(y);E.Creator=this._mCurrentUser;var H=this._createTimelineItem(E);this.byId("timeline").insertContent(H,0);};var w=function(E){this._oLogger.error("Error occured when adding a post.",E.stack);};var A=this._oMode.addPost(u);this._oPostRequestData={"path":A.path,"payload":A.payload};this._oPostRequestData.parameters={success:v,error:w};var x=A.promise;x.then(v.bind(this),w.bind(this));}.bind(this));}else{this._oLogger.info('Posting an empty comment is not allowed, no feed entry will be created.');}},onReplyListOpen:function(E){var i=E.getSource().getCustomReply();i.getTextArea().focus();if(!this._bReplyPopoverIsOpen){this._bReplyPopoverIsOpen=true;var u=E.getSource();var v=u.getModel().getProperty("/Id");this._getReplies(v,undefined,u);}},onPostReplyPress:function(E){var i=this;var v=E.getParameter("value");var u=E.getSource().getParent();var w=u.getCustomReply();var x=u.getModel().getData().Id;var y="/FeedEntries('"+q.sap.encodeURL(x)+"')/Replies";var z={"Text":v};this._getLoggedInUser();this._getLoggedInUser().done(function(){var A={"async":true,"success":function(H,I){w.getTextArea().clearText();w.enableButton(false);w.setBusy(false);var K=i._oCommonUtil.getODataResult(H);var N={"CreatedAt":i._oDateUtil.formatDateToString(K.CreatedAt),"Text":K.Text,"Creator":i._mCurrentUser};N.Creator.ThumbnailImage=i._buildThumbnailImageURL(i._mCurrentUser.Id);w.addReply(N);u.getModel().setProperty("/RepliesCount",u.getModel().getProperty("/RepliesCount")+1);},"error":function(H){i._oLogger.error("Failed to post reply: "+H.statusText,H.stack);}};w.getTextArea().focus();w.setBusyIndicatorDelay(0).setBusy(true);this._oPostRequestData={"path":y,"payload":z,"parameters":A};this._oJamModel.create(y,z,A);}.bind(this));},onSuggest:function(E){var u=this;if(this._oPendingRequests.loadingSuggestionsRequest){this._oPendingRequests.loadingSuggestionsRequest.abort();}var v=E.getSource();var V=E.getParameter("value");if(V.trim()===""){v.showSuggestions([]);}else{var w="/Members_Autocomplete";var x=this._oViewDataModel.getProperty("/groupSelected/Id");var y={"async":true,"urlParameters":{"Query":"'"+V+"'","GroupId":"'"+x+"'","$top":"4"},"success":function(i,A){z.resolveWith(u,[i,A]);},"error":function(i){u._oLogger.error("Failed to get suggestions: "+i.statusText);z.rejectWith(u,[i]);}};var z=q.Deferred();z.done(function(A,H){var I=u._oCommonUtil.getODataResult(A);if(I.length===0){v.closeSuggestionPopover();}else{var K=[];var N=I.length;for(var i=0;i<N;i++){K.push({fullName:I[i].FullName,email:I[i].Email,userImage:u._buildThumbnailImageURL(I[i].Id)});}v.showSuggestions(K);}});this._oPendingRequests.loadingSuggestionsRequest=z.promise(this._oJamModel.read(w,y));}},onUserNameClicked:function(i){var u=i.getParameter("uiElement");var v=i.getSource().getModel();var w=v.getProperty("/Creator/Email");this._oSocialProfile.setSettings({openingControl:u,memberId:w});this._oSocialProfile.open();},onMoreClicked:function(i){var u=i.getSource().getModel().getProperty("/WebURL");var v=i.getSource().getModel().getProperty("/Id");var w=i.getSource().getParent().getModel().getProperty("/groupSelected/Name");var x=i.getSource().getParent().getModel().getProperty("/groupSelected/WebURL");var y=this.byId(this.createId("moreListPopover_"+v));if(y===undefined){var z=new l(this.createId("moreList_"+v),{});var A=new j(this.createId("groupNameLink_"+v),{text:this._oLanguageBundle.getText("ST_GROUP_NAME_LINK",w),target:"_blank",href:x,width:"15em"}).addStyleClass("sapCollaborationCustomLinkPadding");var E=new n(this.createId(v+"_groupNameLinkListItem"),{content:A});z.addItem(E);var H=new j(this.createId("feedEntryLink_"+v),{text:this._oLanguageBundle.getText("ST_FEED_ENTRY_LINK"),target:"_blank",href:u,width:"15em"}).addStyleClass("sapCollaborationCustomLinkPadding");var I=new n(this.createId("feedEntryLinkListItem_"+v),{content:H});z.addItem(I);var K=false;if(g.system.phone){K=true;}y=new f(this.createId("moreListPopover_"+v),{content:z,showHeader:K,title:this._oLanguageBundle.getText("ST_MORE_CUSTOM_ACTION"),showCloseButton:true,placement:P.VerticalPreferedBottom,contentWidth:"15em"});var N=function(){this.close();};A.attachPress(N.bind(y));H.attachPress(N.bind(y));}y.openBy(i.getParameter("linkObj"));},onAtMentionClicked:function(i){var u=i.getSource().getModel().getProperty("/Id");var U=i.getParameter("link");var v=U.getModel().getProperty("/placeholderIndex");this._oAtMention={"feedId":u,"oUserNameLink":U,"placeholderIndex":v,"aAtMentions":[],"atMentionsNextLink":undefined};this._processAtMentions();},_onFeedEndpointChange:function(i){var u=i.getSource().getValue();this._initialLoadFeedEntries(u);},_onFeedSourcesChange:function(E){var i;var u=E.getSource().getValue();if(Array.isArray(u)){u={mode:p.GroupIds,data:u};}if(this._oMode){this._oMode.stop();}if(this._oCommonUtil.isString(u.mode)){if(this._oModes[u.mode]===undefined){this._oModes[u.mode]=c.getInstance().createMode(u.mode,this);}}else{i="The mode must be a string.";this.logError(i);this.byId("timeline").destroy();throw new Error(i);}this._oMode=this._oModes[u.mode];this._oMode.start(u.data);},_onFilterMessageChange:function(i){var u=i.getSource().getValue();this.byId("timeline").setCustomMessage(u);this.byId("timeline").rerender();},_onMetadataFailed:function(E){switch(E.oSource.sServiceUrl){case this._oMode.getJamServiceUrl():this._oLogger.error("Failed to load Jam metadata. Service unavailable or possible missing JAM configuration.");this._displayJamConnectionErrorMessage();this._oMode.setJamServiceAvailable(false);break;case this._oMode.getSMIv2ServiceUrl():this._oLogger.error("Failed to load SMIv2 metadata.");this.displayErrorMessage();break;}this.disableGroupFeed();},_onJamRequestCompleted:function(E){var i=E.getParameter("method");if(E.success&&i==="POST"){this._oPendingRequests.refreshingSecurityToken=undefined;}},_onJamRequestFailed:function(E){this._setTimelineToNotBusy();var i=E.getParameter("method");var u=parseInt(E.getParameter("response").statusCode,10);var v=E.getParameter("feedEndpoint");if(!v){v=E.getParameter("url");}if(/ExternalObjects_FindByExidAndObjectType/.test(v)){this.disableGroupFeed();return;}switch(u){case 403:if(i==="POST"){if(this._oPendingRequests.refreshingSecurityToken===undefined){this._refreshSecurityToken().done(function(w,x){this._oJamModel.create(this._oPostRequestData.path,this._oPostRequestData.payload,this._oPostRequestData.parameters);});}else{this._oPendingRequests.refreshingSecurityToken=undefined;this.displayErrorMessage(this._oLanguageBundle.getText('JAM_NO_ACCESS_TO_POST_TO_GROUP'));}}else{this.displayErrorMessage(this._oLanguageBundle.getText('JAM_FORBIDDEN_ACCESS'));}break;case 404:if(/Groups\(.*\)\/FeedEntries/.test(v)){this.displayErrorMessage(this._oLanguageBundle.getText('JAM_NO_ACCESS_TO_GROUP'));this.disableGroupFeed();}else if(/Groups\(.*\)/.test(v)){this.displayErrorMessage(this._oLanguageBundle.getText('JAM_NO_ACCESS_TO_GROUP'));this.disableGroupFeed();}else if(/GroupExternalObject_FeedLatestCount|Group_FeedLatestCount/.test(v)){this._stopAutoCheckingForNewUpdates();}else{this.displayErrorMessage();}break;case 500:case 503:this._displayJamConnectionErrorMessage();break;default:this.displayErrorMessage();}},_onJamRequestSent:function(E){},_onBatchCompleted:function(E){this._oJamModel.setUseBatch(false);this._oMode.onBatchCompleted(E);},_onBatchFailed:function(E){},_onBatchSent:function(E){},_abortAllPendingRequests:function(){if(this._oPendingRequests.loadingFeedEntriesRequest){this._oPendingRequests.loadingFeedEntriesRequest.abort();}if(this._oPendingRequests.loadingRepliesRequest){this._oPendingRequests.loadingRepliesRequest.abort();}if(this._oPendingRequests.loadingSuggestionsRequest){this._oPendingRequests.loadingSuggestionsRequest.abort();}},_refreshSecurityToken:function(){var i=this;var u=q.Deferred();return this._oPendingRequests.refreshingSecurityToken=u.promise(this._oJamModel.refreshSecurityToken(function(v,w){i._oLogger.info("Security token refreshed");u.resolveWith(i,[v,w]);},function(v){i._oLogger.error("Security token error: "+v.statusText);u.rejectWith([v],i);}));},_getLoggedInUser:function(){var i=q.Deferred();if(!this._mCurrentUser){var u="/Self";var v={"success":function(w,x){this._mCurrentUser=this._oCommonUtil.getODataResult(w);i.resolve(w,x);}.bind(this),"error":function(E){this._oLogger.error('Failed to get the logged in user',E.stack);i.reject(E);}.bind(this)};return i.promise(this._oJamModel.read(u,v));}return i.resolve();},_loadFeedEntries:function(i){var u=undefined;if(!this._oMode.isJamServiceAvailable()){return;}this._setTimelineToBusy();var N=this._oNextLinks.feedEntriesNextLink;if(N!==""){N=decodeURIComponent(N);u=this._extractUrlParams(N).$skiptoken;}return this._oPendingRequests.loadingFeedEntriesRequest=this._oMode.getFeedEntries(i,u);},_loadFeedEntriesSuccess:function(i,u){this._oNextLinks.feedEntriesNextLink=i.__next;var v=this._oCommonUtil.getODataResult(i);this._processFeedEntries(v);},_initialLoadFeedEntries:function(i){if(this._oPendingRequests.loadingFeedEntriesRequest){this._oPendingRequests.loadingFeedEntriesRequest.abort();}this._initializeRequestStateData();this._oViewDataModel.setProperty("/forceGrowing",true);this._hideFeedUpdatesInTimeline();this._stopAutoCheckingForNewUpdates();this._loadFeedEntries(i).done([this._clearTimeline.bind(this),this._loadFeedEntriesSuccess.bind(this),this._startAutoCheckingForNewUpdates.bind(this)]);},_getReplies:function(i,N,u){var v=this;var w;var x={"async":true,"urlParameters":{'$orderby':'CreatedAt desc','$expand':'Creator'},"success":function(A,E){v._oLogger.info("Replies were successfully retrieved.");z.resolveWith(v,[A,E]);},"error":function(E){v._oLogger.error("Failed to retrieve replies: "+E.statusText);z.rejectWith(v,[E]);}};var y=u.getCustomReply();if(N){w="/"+N;x.urlParameters=this._extractUrlParams(decodeURIComponent(N));x.urlParameters.$orderby=x.urlParameters.$orderby.replace("+"," ");}else{w="/FeedEntries('"+q.sap.encodeURL(i)+"')/Replies";}var z=q.Deferred();z.done(function(A,E){var H=v._oCommonUtil.getODataResult(A).reverse();H.forEach(function(I){I.Creator.ThumbnailImage=v._buildThumbnailImageURL(I.Creator.Id);I.CreatedAt=v._oDateUtil.formatDateToString(I.CreatedAt);});y.addReplies({data:H,more:A.__next?true:false});u.getModel().getData().Replies.__next=A.__next;}).always(function(){y.setBusy(false);}).fail(function(){y._oReplyPopover.close();});y.setBusyIndicatorDelay(0).setBusy(true);this._oPendingRequests.loadingRepliesRequest=z.promise(this._oJamModel.read(w,x));},logError:function(E){this._oLogger.error(E);},getModel:function(N){return this.getView().getModel(N);},setModel:function(i,N){this.getView().setModel(i,N);},getLanguageBundle:function(){return this._oLanguageBundle;},setJamModel:function(i){this._oJamModel=i;this.setModel(i,"jam");},setSmiModel:function(i){this._oSMIModel=i;this.setModel(i,"smi");},displayErrorMessage:function(E){var i=E||this._oLanguageBundle.getText("SYSTEM_ERROR_MESSAGEBOX_GENERAL_TEXT");M.error(i);},_displayJamConnectionErrorMessage:function(){var i=this._oLanguageBundle.getText("JAM_CONNECTION_ERROR_MESSAGEBOX_TEXT");M.error(i);},disableGroupFeed:function(){this._abortAllPendingRequests();var i=this.byId("timeline");if(!q.isEmptyObject(i)){i.setBusyIndicatorDelay(0).setBusy(false);this._clearTimeline();this._oViewDataModel.setProperty("/groupSelectorEnabled",false);this._oViewDataModel.setProperty("/addPostButtonEnabled",false);this._oViewDataModel.setProperty("/forceGrowing",false);}},enableGroupFeed:function(){var i=this.byId("timeline");if(!q.isEmptyObject(i)){i.setBusyIndicatorDelay(0).setBusy(false);this._oViewDataModel.setProperty("/groupSelectorEnabled",true);this._oViewDataModel.setProperty("/addPostButtonEnabled",true);this._oViewDataModel.setProperty("/forceGrowing",true);}},_startAutoCheckingForNewUpdates:function(){this._iNewFeedUpdatesCheckerTimeDelay=120000;this._sNewFeedUpdatesCheckerTimeoutId=q.sap.delayedCall(this._iNewFeedUpdatesCheckerTimeDelay,this,this._checkForNewFeedUpdates);},_stopAutoCheckingForNewUpdates:function(){q.sap.clearDelayedCall(this._sNewFeedUpdatesCheckerTimeoutId);},_checkForNewFeedUpdates:function(){var i=function(u,v){this._showFeedUpdatesInTimeline(u);this._sNewFeedUpdatesCheckerTimeoutId=q.sap.delayedCall(this._iNewFeedUpdatesCheckerTimeDelay,this,this._checkForNewFeedUpdates);};var E=function(u){this._oLogger.error("Failed to check for new feed updates.");this._sNewFeedUpdatesCheckerTimeoutId=q.sap.delayedCall(this._iNewFeedUpdatesCheckerTimeDelay,this,this._checkForNewFeedUpdates);};this._oMode.getFeedUpdatesLatestCount().done(i.bind(this)).fail(E.bind(this));},_extractUrlParams:function(u){var U=u.slice(u.indexOf("?")+1);var i=U.split("&");var v={};i.forEach(function(w){var x=w.indexOf("=");v[w.slice(0,x)]=w.slice(x+1);});return v;},_buildThumbnailImageURL:function(u){return this._oJamModel.sServiceUrl+"/Members('"+q.sap.encodeURL(u)+"')/ThumbnailImage/$value";}});return G;},true);
